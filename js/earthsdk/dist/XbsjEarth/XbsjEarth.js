/*!
 * 
 * ------------------------------------------
 * 
 * XbsjEarth.js
 * 
 * https://www.cesiumlab.com/
 * 
 * 版本日期：2020-3-31 16:39:53
 * 授权使用：-
 * 网址限制：-
 * 
 * Copyright @2019 Beijing Xibushijie Co.,Ltd.
 * 版权所有 @2019 北京西部世界科技有限公司
 * 
 * -------------------------------------------
 * 
 */
var XbsjEarth =
/******/ (function(modules) { // webpackBootstrap
/******/ 	function hotDisposeChunk(chunkId) {
/******/ 		delete installedChunks[chunkId];
/******/ 	}
/******/ 	var parentHotUpdateCallback = window["webpackHotUpdateXbsjEarth"];
/******/ 	window["webpackHotUpdateXbsjEarth"] = 
/******/ 	function webpackHotUpdateCallback(chunkId, moreModules) { // eslint-disable-line no-unused-vars
/******/ 		hotAddUpdateChunk(chunkId, moreModules);
/******/ 		if(parentHotUpdateCallback) parentHotUpdateCallback(chunkId, moreModules);
/******/ 	} ;
/******/ 	
/******/ 	function hotDownloadUpdateChunk(chunkId) { // eslint-disable-line no-unused-vars
/******/ 		var head = document.getElementsByTagName("head")[0];
/******/ 		var script = document.createElement("script");
/******/ 		script.type = "text/javascript";
/******/ 		script.charset = "utf-8";
/******/ 		script.src = __webpack_require__.p + "" + chunkId + "." + hotCurrentHash + ".hot-update.js";
/******/ 		;
/******/ 		head.appendChild(script);
/******/ 	}
/******/ 	
/******/ 	function hotDownloadManifest(requestTimeout) { // eslint-disable-line no-unused-vars
/******/ 		requestTimeout = requestTimeout || 10000;
/******/ 		return new Promise(function(resolve, reject) {
/******/ 			if(typeof XMLHttpRequest === "undefined")
/******/ 				return reject(new Error("No browser support"));
/******/ 			try {
/******/ 				var request = new XMLHttpRequest();
/******/ 				var requestPath = __webpack_require__.p + "" + hotCurrentHash + ".hot-update.json";
/******/ 				request.open("GET", requestPath, true);
/******/ 				request.timeout = requestTimeout;
/******/ 				request.send(null);
/******/ 			} catch(err) {
/******/ 				return reject(err);
/******/ 			}
/******/ 			request.onreadystatechange = function() {
/******/ 				if(request.readyState !== 4) return;
/******/ 				if(request.status === 0) {
/******/ 					// timeout
/******/ 					reject(new Error("Manifest request to " + requestPath + " timed out."));
/******/ 				} else if(request.status === 404) {
/******/ 					// no update available
/******/ 					resolve();
/******/ 				} else if(request.status !== 200 && request.status !== 304) {
/******/ 					// other failure
/******/ 					reject(new Error("Manifest request to " + requestPath + " failed."));
/******/ 				} else {
/******/ 					// success
/******/ 					try {
/******/ 						var update = JSON.parse(request.responseText);
/******/ 					} catch(e) {
/******/ 						reject(e);
/******/ 						return;
/******/ 					}
/******/ 					resolve(update);
/******/ 				}
/******/ 			};
/******/ 		});
/******/ 	}
/******/
/******/ 	
/******/ 	
/******/ 	var hotApplyOnUpdate = true;
/******/ 	var hotCurrentHash = "485a16559893bd55c244"; // eslint-disable-line no-unused-vars
/******/ 	var hotRequestTimeout = 10000;
/******/ 	var hotCurrentModuleData = {};
/******/ 	var hotCurrentChildModule; // eslint-disable-line no-unused-vars
/******/ 	var hotCurrentParents = []; // eslint-disable-line no-unused-vars
/******/ 	var hotCurrentParentsTemp = []; // eslint-disable-line no-unused-vars
/******/ 	
/******/ 	function hotCreateRequire(moduleId) { // eslint-disable-line no-unused-vars
/******/ 		var me = installedModules[moduleId];
/******/ 		if(!me) return __webpack_require__;
/******/ 		var fn = function(request) {
/******/ 			if(me.hot.active) {
/******/ 				if(installedModules[request]) {
/******/ 					if(installedModules[request].parents.indexOf(moduleId) < 0)
/******/ 						installedModules[request].parents.push(moduleId);
/******/ 				} else {
/******/ 					hotCurrentParents = [moduleId];
/******/ 					hotCurrentChildModule = request;
/******/ 				}
/******/ 				if(me.children.indexOf(request) < 0)
/******/ 					me.children.push(request);
/******/ 			} else {
/******/ 				console.warn("[HMR] unexpected require(" + request + ") from disposed module " + moduleId);
/******/ 				hotCurrentParents = [];
/******/ 			}
/******/ 			return __webpack_require__(request);
/******/ 		};
/******/ 		var ObjectFactory = function ObjectFactory(name) {
/******/ 			return {
/******/ 				configurable: true,
/******/ 				enumerable: true,
/******/ 				get: function() {
/******/ 					return __webpack_require__[name];
/******/ 				},
/******/ 				set: function(value) {
/******/ 					__webpack_require__[name] = value;
/******/ 				}
/******/ 			};
/******/ 		};
/******/ 		for(var name in __webpack_require__) {
/******/ 			if(Object.prototype.hasOwnProperty.call(__webpack_require__, name) && name !== "e") {
/******/ 				Object.defineProperty(fn, name, ObjectFactory(name));
/******/ 			}
/******/ 		}
/******/ 		fn.e = function(chunkId) {
/******/ 			if(hotStatus === "ready")
/******/ 				hotSetStatus("prepare");
/******/ 			hotChunksLoading++;
/******/ 			return __webpack_require__.e(chunkId).then(finishChunkLoading, function(err) {
/******/ 				finishChunkLoading();
/******/ 				throw err;
/******/ 			});
/******/ 	
/******/ 			function finishChunkLoading() {
/******/ 				hotChunksLoading--;
/******/ 				if(hotStatus === "prepare") {
/******/ 					if(!hotWaitingFilesMap[chunkId]) {
/******/ 						hotEnsureUpdateChunk(chunkId);
/******/ 					}
/******/ 					if(hotChunksLoading === 0 && hotWaitingFiles === 0) {
/******/ 						hotUpdateDownloaded();
/******/ 					}
/******/ 				}
/******/ 			}
/******/ 		};
/******/ 		return fn;
/******/ 	}
/******/ 	
/******/ 	function hotCreateModule(moduleId) { // eslint-disable-line no-unused-vars
/******/ 		var hot = {
/******/ 			// private stuff
/******/ 			_acceptedDependencies: {},
/******/ 			_declinedDependencies: {},
/******/ 			_selfAccepted: false,
/******/ 			_selfDeclined: false,
/******/ 			_disposeHandlers: [],
/******/ 			_main: hotCurrentChildModule !== moduleId,
/******/ 	
/******/ 			// Module API
/******/ 			active: true,
/******/ 			accept: function(dep, callback) {
/******/ 				if(typeof dep === "undefined")
/******/ 					hot._selfAccepted = true;
/******/ 				else if(typeof dep === "function")
/******/ 					hot._selfAccepted = dep;
/******/ 				else if(typeof dep === "object")
/******/ 					for(var i = 0; i < dep.length; i++)
/******/ 						hot._acceptedDependencies[dep[i]] = callback || function() {};
/******/ 				else
/******/ 					hot._acceptedDependencies[dep] = callback || function() {};
/******/ 			},
/******/ 			decline: function(dep) {
/******/ 				if(typeof dep === "undefined")
/******/ 					hot._selfDeclined = true;
/******/ 				else if(typeof dep === "object")
/******/ 					for(var i = 0; i < dep.length; i++)
/******/ 						hot._declinedDependencies[dep[i]] = true;
/******/ 				else
/******/ 					hot._declinedDependencies[dep] = true;
/******/ 			},
/******/ 			dispose: function(callback) {
/******/ 				hot._disposeHandlers.push(callback);
/******/ 			},
/******/ 			addDisposeHandler: function(callback) {
/******/ 				hot._disposeHandlers.push(callback);
/******/ 			},
/******/ 			removeDisposeHandler: function(callback) {
/******/ 				var idx = hot._disposeHandlers.indexOf(callback);
/******/ 				if(idx >= 0) hot._disposeHandlers.splice(idx, 1);
/******/ 			},
/******/ 	
/******/ 			// Management API
/******/ 			check: hotCheck,
/******/ 			apply: hotApply,
/******/ 			status: function(l) {
/******/ 				if(!l) return hotStatus;
/******/ 				hotStatusHandlers.push(l);
/******/ 			},
/******/ 			addStatusHandler: function(l) {
/******/ 				hotStatusHandlers.push(l);
/******/ 			},
/******/ 			removeStatusHandler: function(l) {
/******/ 				var idx = hotStatusHandlers.indexOf(l);
/******/ 				if(idx >= 0) hotStatusHandlers.splice(idx, 1);
/******/ 			},
/******/ 	
/******/ 			//inherit from previous dispose call
/******/ 			data: hotCurrentModuleData[moduleId]
/******/ 		};
/******/ 		hotCurrentChildModule = undefined;
/******/ 		return hot;
/******/ 	}
/******/ 	
/******/ 	var hotStatusHandlers = [];
/******/ 	var hotStatus = "idle";
/******/ 	
/******/ 	function hotSetStatus(newStatus) {
/******/ 		hotStatus = newStatus;
/******/ 		for(var i = 0; i < hotStatusHandlers.length; i++)
/******/ 			hotStatusHandlers[i].call(null, newStatus);
/******/ 	}
/******/ 	
/******/ 	// while downloading
/******/ 	var hotWaitingFiles = 0;
/******/ 	var hotChunksLoading = 0;
/******/ 	var hotWaitingFilesMap = {};
/******/ 	var hotRequestedFilesMap = {};
/******/ 	var hotAvailableFilesMap = {};
/******/ 	var hotDeferred;
/******/ 	
/******/ 	// The update info
/******/ 	var hotUpdate, hotUpdateNewHash;
/******/ 	
/******/ 	function toModuleId(id) {
/******/ 		var isNumber = (+id) + "" === id;
/******/ 		return isNumber ? +id : id;
/******/ 	}
/******/ 	
/******/ 	function hotCheck(apply) {
/******/ 		if(hotStatus !== "idle") throw new Error("check() is only allowed in idle status");
/******/ 		hotApplyOnUpdate = apply;
/******/ 		hotSetStatus("check");
/******/ 		return hotDownloadManifest(hotRequestTimeout).then(function(update) {
/******/ 			if(!update) {
/******/ 				hotSetStatus("idle");
/******/ 				return null;
/******/ 			}
/******/ 			hotRequestedFilesMap = {};
/******/ 			hotWaitingFilesMap = {};
/******/ 			hotAvailableFilesMap = update.c;
/******/ 			hotUpdateNewHash = update.h;
/******/ 	
/******/ 			hotSetStatus("prepare");
/******/ 			var promise = new Promise(function(resolve, reject) {
/******/ 				hotDeferred = {
/******/ 					resolve: resolve,
/******/ 					reject: reject
/******/ 				};
/******/ 			});
/******/ 			hotUpdate = {};
/******/ 			var chunkId = 0;
/******/ 			{ // eslint-disable-line no-lone-blocks
/******/ 				/*globals chunkId */
/******/ 				hotEnsureUpdateChunk(chunkId);
/******/ 			}
/******/ 			if(hotStatus === "prepare" && hotChunksLoading === 0 && hotWaitingFiles === 0) {
/******/ 				hotUpdateDownloaded();
/******/ 			}
/******/ 			return promise;
/******/ 		});
/******/ 	}
/******/ 	
/******/ 	function hotAddUpdateChunk(chunkId, moreModules) { // eslint-disable-line no-unused-vars
/******/ 		if(!hotAvailableFilesMap[chunkId] || !hotRequestedFilesMap[chunkId])
/******/ 			return;
/******/ 		hotRequestedFilesMap[chunkId] = false;
/******/ 		for(var moduleId in moreModules) {
/******/ 			if(Object.prototype.hasOwnProperty.call(moreModules, moduleId)) {
/******/ 				hotUpdate[moduleId] = moreModules[moduleId];
/******/ 			}
/******/ 		}
/******/ 		if(--hotWaitingFiles === 0 && hotChunksLoading === 0) {
/******/ 			hotUpdateDownloaded();
/******/ 		}
/******/ 	}
/******/ 	
/******/ 	function hotEnsureUpdateChunk(chunkId) {
/******/ 		if(!hotAvailableFilesMap[chunkId]) {
/******/ 			hotWaitingFilesMap[chunkId] = true;
/******/ 		} else {
/******/ 			hotRequestedFilesMap[chunkId] = true;
/******/ 			hotWaitingFiles++;
/******/ 			hotDownloadUpdateChunk(chunkId);
/******/ 		}
/******/ 	}
/******/ 	
/******/ 	function hotUpdateDownloaded() {
/******/ 		hotSetStatus("ready");
/******/ 		var deferred = hotDeferred;
/******/ 		hotDeferred = null;
/******/ 		if(!deferred) return;
/******/ 		if(hotApplyOnUpdate) {
/******/ 			// Wrap deferred object in Promise to mark it as a well-handled Promise to
/******/ 			// avoid triggering uncaught exception warning in Chrome.
/******/ 			// See https://bugs.chromium.org/p/chromium/issues/detail?id=465666
/******/ 			Promise.resolve().then(function() {
/******/ 				return hotApply(hotApplyOnUpdate);
/******/ 			}).then(
/******/ 				function(result) {
/******/ 					deferred.resolve(result);
/******/ 				},
/******/ 				function(err) {
/******/ 					deferred.reject(err);
/******/ 				}
/******/ 			);
/******/ 		} else {
/******/ 			var outdatedModules = [];
/******/ 			for(var id in hotUpdate) {
/******/ 				if(Object.prototype.hasOwnProperty.call(hotUpdate, id)) {
/******/ 					outdatedModules.push(toModuleId(id));
/******/ 				}
/******/ 			}
/******/ 			deferred.resolve(outdatedModules);
/******/ 		}
/******/ 	}
/******/ 	
/******/ 	function hotApply(options) {
/******/ 		if(hotStatus !== "ready") throw new Error("apply() is only allowed in ready status");
/******/ 		options = options || {};
/******/ 	
/******/ 		var cb;
/******/ 		var i;
/******/ 		var j;
/******/ 		var module;
/******/ 		var moduleId;
/******/ 	
/******/ 		function getAffectedStuff(updateModuleId) {
/******/ 			var outdatedModules = [updateModuleId];
/******/ 			var outdatedDependencies = {};
/******/ 	
/******/ 			var queue = outdatedModules.slice().map(function(id) {
/******/ 				return {
/******/ 					chain: [id],
/******/ 					id: id
/******/ 				};
/******/ 			});
/******/ 			while(queue.length > 0) {
/******/ 				var queueItem = queue.pop();
/******/ 				var moduleId = queueItem.id;
/******/ 				var chain = queueItem.chain;
/******/ 				module = installedModules[moduleId];
/******/ 				if(!module || module.hot._selfAccepted)
/******/ 					continue;
/******/ 				if(module.hot._selfDeclined) {
/******/ 					return {
/******/ 						type: "self-declined",
/******/ 						chain: chain,
/******/ 						moduleId: moduleId
/******/ 					};
/******/ 				}
/******/ 				if(module.hot._main) {
/******/ 					return {
/******/ 						type: "unaccepted",
/******/ 						chain: chain,
/******/ 						moduleId: moduleId
/******/ 					};
/******/ 				}
/******/ 				for(var i = 0; i < module.parents.length; i++) {
/******/ 					var parentId = module.parents[i];
/******/ 					var parent = installedModules[parentId];
/******/ 					if(!parent) continue;
/******/ 					if(parent.hot._declinedDependencies[moduleId]) {
/******/ 						return {
/******/ 							type: "declined",
/******/ 							chain: chain.concat([parentId]),
/******/ 							moduleId: moduleId,
/******/ 							parentId: parentId
/******/ 						};
/******/ 					}
/******/ 					if(outdatedModules.indexOf(parentId) >= 0) continue;
/******/ 					if(parent.hot._acceptedDependencies[moduleId]) {
/******/ 						if(!outdatedDependencies[parentId])
/******/ 							outdatedDependencies[parentId] = [];
/******/ 						addAllToSet(outdatedDependencies[parentId], [moduleId]);
/******/ 						continue;
/******/ 					}
/******/ 					delete outdatedDependencies[parentId];
/******/ 					outdatedModules.push(parentId);
/******/ 					queue.push({
/******/ 						chain: chain.concat([parentId]),
/******/ 						id: parentId
/******/ 					});
/******/ 				}
/******/ 			}
/******/ 	
/******/ 			return {
/******/ 				type: "accepted",
/******/ 				moduleId: updateModuleId,
/******/ 				outdatedModules: outdatedModules,
/******/ 				outdatedDependencies: outdatedDependencies
/******/ 			};
/******/ 		}
/******/ 	
/******/ 		function addAllToSet(a, b) {
/******/ 			for(var i = 0; i < b.length; i++) {
/******/ 				var item = b[i];
/******/ 				if(a.indexOf(item) < 0)
/******/ 					a.push(item);
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// at begin all updates modules are outdated
/******/ 		// the "outdated" status can propagate to parents if they don't accept the children
/******/ 		var outdatedDependencies = {};
/******/ 		var outdatedModules = [];
/******/ 		var appliedUpdate = {};
/******/ 	
/******/ 		var warnUnexpectedRequire = function warnUnexpectedRequire() {
/******/ 			console.warn("[HMR] unexpected require(" + result.moduleId + ") to disposed module");
/******/ 		};
/******/ 	
/******/ 		for(var id in hotUpdate) {
/******/ 			if(Object.prototype.hasOwnProperty.call(hotUpdate, id)) {
/******/ 				moduleId = toModuleId(id);
/******/ 				var result;
/******/ 				if(hotUpdate[id]) {
/******/ 					result = getAffectedStuff(moduleId);
/******/ 				} else {
/******/ 					result = {
/******/ 						type: "disposed",
/******/ 						moduleId: id
/******/ 					};
/******/ 				}
/******/ 				var abortError = false;
/******/ 				var doApply = false;
/******/ 				var doDispose = false;
/******/ 				var chainInfo = "";
/******/ 				if(result.chain) {
/******/ 					chainInfo = "\nUpdate propagation: " + result.chain.join(" -> ");
/******/ 				}
/******/ 				switch(result.type) {
/******/ 					case "self-declined":
/******/ 						if(options.onDeclined)
/******/ 							options.onDeclined(result);
/******/ 						if(!options.ignoreDeclined)
/******/ 							abortError = new Error("Aborted because of self decline: " + result.moduleId + chainInfo);
/******/ 						break;
/******/ 					case "declined":
/******/ 						if(options.onDeclined)
/******/ 							options.onDeclined(result);
/******/ 						if(!options.ignoreDeclined)
/******/ 							abortError = new Error("Aborted because of declined dependency: " + result.moduleId + " in " + result.parentId + chainInfo);
/******/ 						break;
/******/ 					case "unaccepted":
/******/ 						if(options.onUnaccepted)
/******/ 							options.onUnaccepted(result);
/******/ 						if(!options.ignoreUnaccepted)
/******/ 							abortError = new Error("Aborted because " + moduleId + " is not accepted" + chainInfo);
/******/ 						break;
/******/ 					case "accepted":
/******/ 						if(options.onAccepted)
/******/ 							options.onAccepted(result);
/******/ 						doApply = true;
/******/ 						break;
/******/ 					case "disposed":
/******/ 						if(options.onDisposed)
/******/ 							options.onDisposed(result);
/******/ 						doDispose = true;
/******/ 						break;
/******/ 					default:
/******/ 						throw new Error("Unexception type " + result.type);
/******/ 				}
/******/ 				if(abortError) {
/******/ 					hotSetStatus("abort");
/******/ 					return Promise.reject(abortError);
/******/ 				}
/******/ 				if(doApply) {
/******/ 					appliedUpdate[moduleId] = hotUpdate[moduleId];
/******/ 					addAllToSet(outdatedModules, result.outdatedModules);
/******/ 					for(moduleId in result.outdatedDependencies) {
/******/ 						if(Object.prototype.hasOwnProperty.call(result.outdatedDependencies, moduleId)) {
/******/ 							if(!outdatedDependencies[moduleId])
/******/ 								outdatedDependencies[moduleId] = [];
/******/ 							addAllToSet(outdatedDependencies[moduleId], result.outdatedDependencies[moduleId]);
/******/ 						}
/******/ 					}
/******/ 				}
/******/ 				if(doDispose) {
/******/ 					addAllToSet(outdatedModules, [result.moduleId]);
/******/ 					appliedUpdate[moduleId] = warnUnexpectedRequire;
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// Store self accepted outdated modules to require them later by the module system
/******/ 		var outdatedSelfAcceptedModules = [];
/******/ 		for(i = 0; i < outdatedModules.length; i++) {
/******/ 			moduleId = outdatedModules[i];
/******/ 			if(installedModules[moduleId] && installedModules[moduleId].hot._selfAccepted)
/******/ 				outdatedSelfAcceptedModules.push({
/******/ 					module: moduleId,
/******/ 					errorHandler: installedModules[moduleId].hot._selfAccepted
/******/ 				});
/******/ 		}
/******/ 	
/******/ 		// Now in "dispose" phase
/******/ 		hotSetStatus("dispose");
/******/ 		Object.keys(hotAvailableFilesMap).forEach(function(chunkId) {
/******/ 			if(hotAvailableFilesMap[chunkId] === false) {
/******/ 				hotDisposeChunk(chunkId);
/******/ 			}
/******/ 		});
/******/ 	
/******/ 		var idx;
/******/ 		var queue = outdatedModules.slice();
/******/ 		while(queue.length > 0) {
/******/ 			moduleId = queue.pop();
/******/ 			module = installedModules[moduleId];
/******/ 			if(!module) continue;
/******/ 	
/******/ 			var data = {};
/******/ 	
/******/ 			// Call dispose handlers
/******/ 			var disposeHandlers = module.hot._disposeHandlers;
/******/ 			for(j = 0; j < disposeHandlers.length; j++) {
/******/ 				cb = disposeHandlers[j];
/******/ 				cb(data);
/******/ 			}
/******/ 			hotCurrentModuleData[moduleId] = data;
/******/ 	
/******/ 			// disable module (this disables requires from this module)
/******/ 			module.hot.active = false;
/******/ 	
/******/ 			// remove module from cache
/******/ 			delete installedModules[moduleId];
/******/ 	
/******/ 			// when disposing there is no need to call dispose handler
/******/ 			delete outdatedDependencies[moduleId];
/******/ 	
/******/ 			// remove "parents" references from all children
/******/ 			for(j = 0; j < module.children.length; j++) {
/******/ 				var child = installedModules[module.children[j]];
/******/ 				if(!child) continue;
/******/ 				idx = child.parents.indexOf(moduleId);
/******/ 				if(idx >= 0) {
/******/ 					child.parents.splice(idx, 1);
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// remove outdated dependency from module children
/******/ 		var dependency;
/******/ 		var moduleOutdatedDependencies;
/******/ 		for(moduleId in outdatedDependencies) {
/******/ 			if(Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) {
/******/ 				module = installedModules[moduleId];
/******/ 				if(module) {
/******/ 					moduleOutdatedDependencies = outdatedDependencies[moduleId];
/******/ 					for(j = 0; j < moduleOutdatedDependencies.length; j++) {
/******/ 						dependency = moduleOutdatedDependencies[j];
/******/ 						idx = module.children.indexOf(dependency);
/******/ 						if(idx >= 0) module.children.splice(idx, 1);
/******/ 					}
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// Not in "apply" phase
/******/ 		hotSetStatus("apply");
/******/ 	
/******/ 		hotCurrentHash = hotUpdateNewHash;
/******/ 	
/******/ 		// insert new code
/******/ 		for(moduleId in appliedUpdate) {
/******/ 			if(Object.prototype.hasOwnProperty.call(appliedUpdate, moduleId)) {
/******/ 				modules[moduleId] = appliedUpdate[moduleId];
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// call accept handlers
/******/ 		var error = null;
/******/ 		for(moduleId in outdatedDependencies) {
/******/ 			if(Object.prototype.hasOwnProperty.call(outdatedDependencies, moduleId)) {
/******/ 				module = installedModules[moduleId];
/******/ 				if(module) {
/******/ 					moduleOutdatedDependencies = outdatedDependencies[moduleId];
/******/ 					var callbacks = [];
/******/ 					for(i = 0; i < moduleOutdatedDependencies.length; i++) {
/******/ 						dependency = moduleOutdatedDependencies[i];
/******/ 						cb = module.hot._acceptedDependencies[dependency];
/******/ 						if(cb) {
/******/ 							if(callbacks.indexOf(cb) >= 0) continue;
/******/ 							callbacks.push(cb);
/******/ 						}
/******/ 					}
/******/ 					for(i = 0; i < callbacks.length; i++) {
/******/ 						cb = callbacks[i];
/******/ 						try {
/******/ 							cb(moduleOutdatedDependencies);
/******/ 						} catch(err) {
/******/ 							if(options.onErrored) {
/******/ 								options.onErrored({
/******/ 									type: "accept-errored",
/******/ 									moduleId: moduleId,
/******/ 									dependencyId: moduleOutdatedDependencies[i],
/******/ 									error: err
/******/ 								});
/******/ 							}
/******/ 							if(!options.ignoreErrored) {
/******/ 								if(!error)
/******/ 									error = err;
/******/ 							}
/******/ 						}
/******/ 					}
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// Load self accepted modules
/******/ 		for(i = 0; i < outdatedSelfAcceptedModules.length; i++) {
/******/ 			var item = outdatedSelfAcceptedModules[i];
/******/ 			moduleId = item.module;
/******/ 			hotCurrentParents = [moduleId];
/******/ 			try {
/******/ 				__webpack_require__(moduleId);
/******/ 			} catch(err) {
/******/ 				if(typeof item.errorHandler === "function") {
/******/ 					try {
/******/ 						item.errorHandler(err);
/******/ 					} catch(err2) {
/******/ 						if(options.onErrored) {
/******/ 							options.onErrored({
/******/ 								type: "self-accept-error-handler-errored",
/******/ 								moduleId: moduleId,
/******/ 								error: err2,
/******/ 								orginalError: err, // TODO remove in webpack 4
/******/ 								originalError: err
/******/ 							});
/******/ 						}
/******/ 						if(!options.ignoreErrored) {
/******/ 							if(!error)
/******/ 								error = err2;
/******/ 						}
/******/ 						if(!error)
/******/ 							error = err;
/******/ 					}
/******/ 				} else {
/******/ 					if(options.onErrored) {
/******/ 						options.onErrored({
/******/ 							type: "self-accept-errored",
/******/ 							moduleId: moduleId,
/******/ 							error: err
/******/ 						});
/******/ 					}
/******/ 					if(!options.ignoreErrored) {
/******/ 						if(!error)
/******/ 							error = err;
/******/ 					}
/******/ 				}
/******/ 			}
/******/ 		}
/******/ 	
/******/ 		// handle errors in accept handlers and self accepted module load
/******/ 		if(error) {
/******/ 			hotSetStatus("fail");
/******/ 			return Promise.reject(error);
/******/ 		}
/******/ 	
/******/ 		hotSetStatus("idle");
/******/ 		return new Promise(function(resolve) {
/******/ 			resolve(outdatedModules);
/******/ 		});
/******/ 	}
/******/
/******/ 	// The module cache
/******/ 	var installedModules = {};
/******/
/******/ 	// The require function
/******/ 	function __webpack_require__(moduleId) {
/******/
/******/ 		// Check if module is in cache
/******/ 		if(installedModules[moduleId]) {
/******/ 			return installedModules[moduleId].exports;
/******/ 		}
/******/ 		// Create a new module (and put it into the cache)
/******/ 		var module = installedModules[moduleId] = {
/******/ 			i: moduleId,
/******/ 			l: false,
/******/ 			exports: {},
/******/ 			hot: hotCreateModule(moduleId),
/******/ 			parents: (hotCurrentParentsTemp = hotCurrentParents, hotCurrentParents = [], hotCurrentParentsTemp),
/******/ 			children: []
/******/ 		};
/******/
/******/ 		// Execute the module function
/******/ 		modules[moduleId].call(module.exports, module, module.exports, hotCreateRequire(moduleId));
/******/
/******/ 		// Flag the module as loaded
/******/ 		module.l = true;
/******/
/******/ 		// Return the exports of the module
/******/ 		return module.exports;
/******/ 	}
/******/
/******/
/******/ 	// expose the modules object (__webpack_modules__)
/******/ 	__webpack_require__.m = modules;
/******/
/******/ 	// expose the module cache
/******/ 	__webpack_require__.c = installedModules;
/******/
/******/ 	// define getter function for harmony exports
/******/ 	__webpack_require__.d = function(exports, name, getter) {
/******/ 		if(!__webpack_require__.o(exports, name)) {
/******/ 			Object.defineProperty(exports, name, {
/******/ 				configurable: false,
/******/ 				enumerable: true,
/******/ 				get: getter
/******/ 			});
/******/ 		}
/******/ 	};
/******/
/******/ 	// getDefaultExport function for compatibility with non-harmony modules
/******/ 	__webpack_require__.n = function(module) {
/******/ 		var getter = module && module.__esModule ?
/******/ 			function getDefault() { return module['default']; } :
/******/ 			function getModuleExports() { return module; };
/******/ 		__webpack_require__.d(getter, 'a', getter);
/******/ 		return getter;
/******/ 	};
/******/
/******/ 	// Object.prototype.hasOwnProperty.call
/******/ 	__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };
/******/
/******/ 	// __webpack_public_path__
/******/ 	__webpack_require__.p = "";
/******/
/******/ 	// __webpack_hash__
/******/ 	__webpack_require__.h = function() { return hotCurrentHash; };
/******/
/******/ 	// Load entry module and return exports
/******/ 	return hotCreateRequire(198)(__webpack_require__.s = 198);
/******/ })
/************************************************************************/
/******/ ([
/* 0 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

exports.default = function (instance, Constructor) {
  if (!(instance instanceof Constructor)) {
    throw new TypeError("Cannot call a class as a function");
  }
};

/***/ }),
/* 1 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  function defineProperties(target, props) {
    for (var i = 0; i < props.length; i++) {
      var descriptor = props[i];
      descriptor.enumerable = descriptor.enumerable || false;
      descriptor.configurable = true;
      if ("value" in descriptor) descriptor.writable = true;
      (0, _defineProperty2.default)(target, descriptor.key, descriptor);
    }
  }

  return function (Constructor, protoProps, staticProps) {
    if (protoProps) defineProperties(Constructor.prototype, protoProps);
    if (staticProps) defineProperties(Constructor, staticProps);
    return Constructor;
  };
}();

/***/ }),
/* 2 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* WEBPACK VAR INJECTION */(function(process, global) {/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "Reaction", function() { return Reaction$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "untracked", function() { return untracked$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "IDerivationState", function() { return IDerivationState; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "createAtom", function() { return createAtom$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "spy", function() { return spy$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "comparer", function() { return comparer$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservableObject", function() { return isObservableObject$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isBoxedObservable", function() { return isObservableValue$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservableArray", function() { return isObservableArray$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ObservableMap", function() { return ObservableMap$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservableMap", function() { return isObservableMap$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "ObservableSet", function() { return ObservableSet$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservableSet", function() { return isObservableSet$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "transaction", function() { return transaction$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "observable", function() { return observable$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "computed", function() { return computed$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservable", function() { return isObservable$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isObservableProp", function() { return isObservableProp$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isComputed", function() { return isComputed$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isComputedProp", function() { return isComputedProp$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "extendObservable", function() { return extendObservable$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "observe", function() { return observe$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "intercept", function() { return intercept$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "autorun", function() { return autorun$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "reaction", function() { return reaction$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "when", function() { return when$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "action", function() { return action$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isAction", function() { return isAction$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "runInAction", function() { return runInAction$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "keys", function() { return keys$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "values", function() { return values$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "entries", function() { return entries$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "set", function() { return set$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "remove", function() { return remove$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "has", function() { return has$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "get", function() { return get$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "decorate", function() { return decorate$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "configure", function() { return configure$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "onBecomeObserved", function() { return onBecomeObserved$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "onBecomeUnobserved", function() { return onBecomeUnobserved$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "flow", function() { return flow$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "toJS", function() { return toJS$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "trace", function() { return trace$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDependencyTree", function() { return getDependencyTree$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getObserverTree", function() { return getObserverTree$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_resetGlobalState", function() { return resetGlobalState$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_getGlobalState", function() { return getGlobalState$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getDebugName", function() { return getDebugName$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "getAtom", function() { return getAtom$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_getAdministration", function() { return getAdministration$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_allowStateChanges", function() { return allowStateChanges$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_allowStateChangesInsideComputed", function() { return allowStateChangesInsideComputed$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "isArrayLike", function() { return isArrayLike$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "$mobx", function() { return $mobx$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_isComputingDerivation", function() { return isComputingDerivation$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "onReactionError", function() { return onReactionError$$1; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "_interceptReads", function() { return interceptReads$$1; });
/** MobX - (c) Michel Weststrate 2015 - 2018 - MIT Licensed */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = Object.setPrototypeOf ||
    ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
    function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = Object.assign || function __assign(t) {
    for (var s, i = 1, n = arguments.length; i < n; i++) {
        s = arguments[i];
        for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
    }
    return t;
};















function __values(o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

var OBFUSCATED_ERROR$$1 = "An invariant failed, however the error is obfuscated because this is an production build.";
var EMPTY_ARRAY$$1 = [];
Object.freeze(EMPTY_ARRAY$$1);
var EMPTY_OBJECT$$1 = {};
Object.freeze(EMPTY_OBJECT$$1);
function getNextId$$1() {
    return ++globalState$$1.mobxGuid;
}
function fail$$1(message) {
    invariant$$1(false, message);
    throw "X"; // unreachable
}
function invariant$$1(check, message) {
    if (!check)
        throw new Error("[mobx] " + (message || OBFUSCATED_ERROR$$1));
}
/**
 * Prints a deprecation message, but only one time.
 * Returns false if the deprecated message was already printed before
 */
var deprecatedMessages = [];
function deprecated$$1(msg, thing) {
    if (true)
        return false;
    if (thing) {
        return deprecated$$1("'" + msg + "', use '" + thing + "' instead.");
    }
    if (deprecatedMessages.indexOf(msg) !== -1)
        return false;
    deprecatedMessages.push(msg);
    console.error("[mobx] Deprecated: " + msg);
    return true;
}
/**
 * Makes sure that the provided function is invoked at most once.
 */
function once$$1(func) {
    var invoked = false;
    return function () {
        if (invoked)
            return;
        invoked = true;
        return func.apply(this, arguments);
    };
}
var noop$$1 = function () { };
function unique$$1(list) {
    var res = [];
    list.forEach(function (item) {
        if (res.indexOf(item) === -1)
            res.push(item);
    });
    return res;
}
function isObject$$1(value) {
    return value !== null && typeof value === "object";
}
function isPlainObject$$1(value) {
    if (value === null || typeof value !== "object")
        return false;
    var proto = Object.getPrototypeOf(value);
    return proto === Object.prototype || proto === null;
}

function addHiddenProp$$1(object, propName, value) {
    Object.defineProperty(object, propName, {
        enumerable: false,
        writable: true,
        configurable: true,
        value: value
    });
}
function addHiddenFinalProp$$1(object, propName, value) {
    Object.defineProperty(object, propName, {
        enumerable: false,
        writable: false,
        configurable: true,
        value: value
    });
}
function isPropertyConfigurable$$1(object, prop) {
    var descriptor = Object.getOwnPropertyDescriptor(object, prop);
    return !descriptor || (descriptor.configurable !== false && descriptor.writable !== false);
}
function assertPropertyConfigurable$$1(object, prop) {
    if (false)
        fail$$1("Cannot make property '" + prop.toString() + "' observable, it is not configurable and writable in the target object");
}
function createInstanceofPredicate$$1(name, clazz) {
    var propName = "isMobX" + name;
    clazz.prototype[propName] = true;
    return function (x) {
        return isObject$$1(x) && x[propName] === true;
    };
}
/**
 * Returns whether the argument is an array, disregarding observability.
 */
function isArrayLike$$1(x) {
    return Array.isArray(x) || isObservableArray$$1(x);
}
function isES6Map$$1(thing) {
    return thing instanceof Map;
}
function isES6Set$$1(thing) {
    return thing instanceof Set;
}
function getMapLikeKeys$$1(map) {
    if (isPlainObject$$1(map))
        return Object.keys(map);
    if (Array.isArray(map))
        return map.map(function (_a) {
            var _b = __read(_a, 1), key = _b[0];
            return key;
        });
    if (isES6Map$$1(map) || isObservableMap$$1(map))
        return Array.from(map.keys());
    return fail$$1("Cannot get keys from '" + map + "'");
}
function toPrimitive$$1(value) {
    return value === null ? null : typeof value === "object" ? "" + value : value;
}

var $mobx$$1 = Symbol("mobx administration");
var Atom$$1 = /** @class */ (function () {
    /**
     * Create a new atom. For debugging purposes it is recommended to give it a name.
     * The onBecomeObserved and onBecomeUnobserved callbacks can be used for resource management.
     */
    function Atom$$1(name) {
        if (name === void 0) { name = "Atom@" + getNextId$$1(); }
        this.name = name;
        this.isPendingUnobservation = false; // for effective unobserving. BaseAtom has true, for extra optimization, so its onBecomeUnobserved never gets called, because it's not needed
        this.isBeingObserved = false;
        this.observers = new Set();
        this.diffValue = 0;
        this.lastAccessedBy = 0;
        this.lowestObserverState = IDerivationState.NOT_TRACKING;
    }
    Atom$$1.prototype.onBecomeObserved = function () {
        if (this.onBecomeObservedListeners) {
            this.onBecomeObservedListeners.forEach(function (listener) { return listener(); });
        }
    };
    Atom$$1.prototype.onBecomeUnobserved = function () {
        if (this.onBecomeUnobservedListeners) {
            this.onBecomeUnobservedListeners.forEach(function (listener) { return listener(); });
        }
    };
    /**
     * Invoke this method to notify mobx that your atom has been used somehow.
     * Returns true if there is currently a reactive context.
     */
    Atom$$1.prototype.reportObserved = function () {
        return reportObserved$$1(this);
    };
    /**
     * Invoke this method _after_ this method has changed to signal mobx that all its observers should invalidate.
     */
    Atom$$1.prototype.reportChanged = function () {
        startBatch$$1();
        propagateChanged$$1(this);
        endBatch$$1();
    };
    Atom$$1.prototype.toString = function () {
        return this.name;
    };
    return Atom$$1;
}());
var isAtom$$1 = createInstanceofPredicate$$1("Atom", Atom$$1);
function createAtom$$1(name, onBecomeObservedHandler, onBecomeUnobservedHandler) {
    if (onBecomeObservedHandler === void 0) { onBecomeObservedHandler = noop$$1; }
    if (onBecomeUnobservedHandler === void 0) { onBecomeUnobservedHandler = noop$$1; }
    var atom = new Atom$$1(name);
    // default `noop` listener will not initialize the hook Set
    if (onBecomeObservedHandler !== noop$$1) {
        onBecomeObserved$$1(atom, onBecomeObservedHandler);
    }
    if (onBecomeUnobservedHandler !== noop$$1) {
        onBecomeUnobserved$$1(atom, onBecomeUnobservedHandler);
    }
    return atom;
}

function identityComparer(a, b) {
    return a === b;
}
function structuralComparer(a, b) {
    return deepEqual$$1(a, b);
}
function defaultComparer(a, b) {
    return Object.is(a, b);
}
var comparer$$1 = {
    identity: identityComparer,
    structural: structuralComparer,
    default: defaultComparer
};

var mobxDidRunLazyInitializersSymbol$$1 = Symbol("mobx did run lazy initializers");
var mobxPendingDecorators$$1 = Symbol("mobx pending decorators");
var enumerableDescriptorCache = {};
var nonEnumerableDescriptorCache = {};
function createPropertyInitializerDescriptor(prop, enumerable) {
    var cache = enumerable ? enumerableDescriptorCache : nonEnumerableDescriptorCache;
    return (cache[prop] ||
        (cache[prop] = {
            configurable: true,
            enumerable: enumerable,
            get: function () {
                initializeInstance$$1(this);
                return this[prop];
            },
            set: function (value) {
                initializeInstance$$1(this);
                this[prop] = value;
            }
        }));
}
function initializeInstance$$1(target) {
    if (target[mobxDidRunLazyInitializersSymbol$$1] === true)
        return;
    var decorators = target[mobxPendingDecorators$$1];
    if (decorators) {
        addHiddenProp$$1(target, mobxDidRunLazyInitializersSymbol$$1, true);
        for (var key in decorators) {
            var d = decorators[key];
            d.propertyCreator(target, d.prop, d.descriptor, d.decoratorTarget, d.decoratorArguments);
        }
    }
}
function createPropDecorator$$1(propertyInitiallyEnumerable, propertyCreator) {
    return function decoratorFactory() {
        var decoratorArguments;
        var decorator = function decorate$$1(target, prop, descriptor, applyImmediately
        // This is a special parameter to signal the direct application of a decorator, allow extendObservable to skip the entire type decoration part,
        // as the instance to apply the decorator to equals the target
        ) {
            if (applyImmediately === true) {
                propertyCreator(target, prop, descriptor, target, decoratorArguments);
                return null;
            }
            if (false)
                fail$$1("This function is a decorator, but it wasn't invoked like a decorator");
            if (!Object.prototype.hasOwnProperty.call(target, mobxPendingDecorators$$1)) {
                var inheritedDecorators = target[mobxPendingDecorators$$1];
                addHiddenProp$$1(target, mobxPendingDecorators$$1, __assign({}, inheritedDecorators));
            }
            target[mobxPendingDecorators$$1][prop] = {
                prop: prop,
                propertyCreator: propertyCreator,
                descriptor: descriptor,
                decoratorTarget: target,
                decoratorArguments: decoratorArguments
            };
            return createPropertyInitializerDescriptor(prop, propertyInitiallyEnumerable);
        };
        if (quacksLikeADecorator$$1(arguments)) {
            // @decorator
            decoratorArguments = EMPTY_ARRAY$$1;
            return decorator.apply(null, arguments);
        }
        else {
            // @decorator(args)
            decoratorArguments = Array.prototype.slice.call(arguments);
            return decorator;
        }
    };
}
function quacksLikeADecorator$$1(args) {
    return (((args.length === 2 || args.length === 3) && typeof args[1] === "string") ||
        (args.length === 4 && args[3] === true));
}

function deepEnhancer$$1(v, _, name) {
    // it is an observable already, done
    if (isObservable$$1(v))
        return v;
    // something that can be converted and mutated?
    if (Array.isArray(v))
        return observable$$1.array(v, { name: name });
    if (isPlainObject$$1(v))
        return observable$$1.object(v, undefined, { name: name });
    if (isES6Map$$1(v))
        return observable$$1.map(v, { name: name });
    if (isES6Set$$1(v))
        return observable$$1.set(v, { name: name });
    return v;
}
function shallowEnhancer$$1(v, _, name) {
    if (v === undefined || v === null)
        return v;
    if (isObservableObject$$1(v) || isObservableArray$$1(v) || isObservableMap$$1(v) || isObservableSet$$1(v))
        return v;
    if (Array.isArray(v))
        return observable$$1.array(v, { name: name, deep: false });
    if (isPlainObject$$1(v))
        return observable$$1.object(v, undefined, { name: name, deep: false });
    if (isES6Map$$1(v))
        return observable$$1.map(v, { name: name, deep: false });
    if (isES6Set$$1(v))
        return observable$$1.set(v, { name: name, deep: false });
    return fail$$1("production" !== "production" &&
        "The shallow modifier / decorator can only used in combination with arrays, objects, maps and sets");
}
function referenceEnhancer$$1(newValue) {
    // never turn into an observable
    return newValue;
}
function refStructEnhancer$$1(v, oldValue, name) {
    if (false)
        throw "observable.struct should not be used with observable values";
    if (deepEqual$$1(v, oldValue))
        return oldValue;
    return v;
}

function createDecoratorForEnhancer$$1(enhancer) {
    invariant$$1(enhancer);
    var decorator = createPropDecorator$$1(true, function (target, propertyName, descriptor, _decoratorTarget, decoratorArgs) {
        if (false) {
            invariant$$1(!descriptor || !descriptor.get, "@observable cannot be used on getter (property \"" + propertyName + "\"), use @computed instead.");
        }
        var initialValue = descriptor
            ? descriptor.initializer
                ? descriptor.initializer.call(target)
                : descriptor.value
            : undefined;
        asObservableObject$$1(target).addObservableProp(propertyName, initialValue, enhancer);
    });
    var res = 
    // Extra process checks, as this happens during module initialization
    typeof process !== "undefined" && Object({"NODE_ENV":"production"}) && "production" !== "production"
        ? function observableDecorator() {
            // This wrapper function is just to detect illegal decorator invocations, deprecate in a next version
            // and simply return the created prop decorator
            if (arguments.length < 2)
                return fail$$1("Incorrect decorator invocation. @observable decorator doesn't expect any arguments");
            return decorator.apply(null, arguments);
        }
        : decorator;
    res.enhancer = enhancer;
    return res;
}

// Predefined bags of create observable options, to avoid allocating temporarily option objects
// in the majority of cases
var defaultCreateObservableOptions$$1 = {
    deep: true,
    name: undefined,
    defaultDecorator: undefined,
    proxy: true
};
Object.freeze(defaultCreateObservableOptions$$1);
function assertValidOption(key) {
    if (!/^(deep|name|equals|defaultDecorator|proxy)$/.test(key))
        fail$$1("invalid option for (extend)observable: " + key);
}
function asCreateObservableOptions$$1(thing) {
    if (thing === null || thing === undefined)
        return defaultCreateObservableOptions$$1;
    if (typeof thing === "string")
        return { name: thing, deep: true, proxy: true };
    if (false) {
        if (typeof thing !== "object")
            return fail$$1("expected options object");
        Object.keys(thing).forEach(assertValidOption);
    }
    return thing;
}
var deepDecorator$$1 = createDecoratorForEnhancer$$1(deepEnhancer$$1);
var shallowDecorator = createDecoratorForEnhancer$$1(shallowEnhancer$$1);
var refDecorator$$1 = createDecoratorForEnhancer$$1(referenceEnhancer$$1);
var refStructDecorator = createDecoratorForEnhancer$$1(refStructEnhancer$$1);
function getEnhancerFromOptions(options) {
    return options.defaultDecorator
        ? options.defaultDecorator.enhancer
        : options.deep === false
            ? referenceEnhancer$$1
            : deepEnhancer$$1;
}
/**
 * Turns an object, array or function into a reactive structure.
 * @param v the value which should become observable.
 */
function createObservable(v, arg2, arg3) {
    // @observable someProp;
    if (typeof arguments[1] === "string") {
        return deepDecorator$$1.apply(null, arguments);
    }
    // it is an observable already, done
    if (isObservable$$1(v))
        return v;
    // something that can be converted and mutated?
    var res = isPlainObject$$1(v)
        ? observable$$1.object(v, arg2, arg3)
        : Array.isArray(v)
            ? observable$$1.array(v, arg2)
            : isES6Map$$1(v)
                ? observable$$1.map(v, arg2)
                : isES6Set$$1(v)
                    ? observable$$1.set(v, arg2)
                    : v;
    // this value could be converted to a new observable data structure, return it
    if (res !== v)
        return res;
    // otherwise, just box it
    fail$$1("production" !== "production" &&
        "The provided value could not be converted into an observable. If you want just create an observable reference to the object use 'observable.box(value)'");
}
var observableFactories = {
    box: function (value, options) {
        if (arguments.length > 2)
            incorrectlyUsedAsDecorator("box");
        var o = asCreateObservableOptions$$1(options);
        return new ObservableValue$$1(value, getEnhancerFromOptions(o), o.name, true, o.equals);
    },
    array: function (initialValues, options) {
        if (arguments.length > 2)
            incorrectlyUsedAsDecorator("array");
        var o = asCreateObservableOptions$$1(options);
        return createObservableArray$$1(initialValues, getEnhancerFromOptions(o), o.name);
    },
    map: function (initialValues, options) {
        if (arguments.length > 2)
            incorrectlyUsedAsDecorator("map");
        var o = asCreateObservableOptions$$1(options);
        return new ObservableMap$$1(initialValues, getEnhancerFromOptions(o), o.name);
    },
    set: function (initialValues, options) {
        if (arguments.length > 2)
            incorrectlyUsedAsDecorator("set");
        var o = asCreateObservableOptions$$1(options);
        return new ObservableSet$$1(initialValues, getEnhancerFromOptions(o), o.name);
    },
    object: function (props, decorators, options) {
        if (typeof arguments[1] === "string")
            incorrectlyUsedAsDecorator("object");
        var o = asCreateObservableOptions$$1(options);
        if (o.proxy === false) {
            return extendObservable$$1({}, props, decorators, o);
        }
        else {
            var defaultDecorator = getDefaultDecoratorFromObjectOptions$$1(o);
            var base = extendObservable$$1({}, undefined, undefined, o);
            var proxy = createDynamicObservableObject$$1(base);
            extendObservableObjectWithProperties$$1(proxy, props, decorators, defaultDecorator);
            return proxy;
        }
    },
    ref: refDecorator$$1,
    shallow: shallowDecorator,
    deep: deepDecorator$$1,
    struct: refStructDecorator
};
var observable$$1 = createObservable;
// weird trick to keep our typings nicely with our funcs, and still extend the observable function
Object.keys(observableFactories).forEach(function (name) { return (observable$$1[name] = observableFactories[name]); });
function incorrectlyUsedAsDecorator(methodName) {
    fail$$1(
    // process.env.NODE_ENV !== "production" &&
    "Expected one or two arguments to observable." + methodName + ". Did you accidentally try to use observable." + methodName + " as decorator?");
}

var computedDecorator$$1 = createPropDecorator$$1(false, function (instance, propertyName, descriptor, decoratorTarget, decoratorArgs) {
    var get$$1 = descriptor.get, set$$1 = descriptor.set; // initialValue is the descriptor for get / set props
    // Optimization: faster on decorator target or instance? Assuming target
    // Optimization: find out if declaring on instance isn't just faster. (also makes the property descriptor simpler). But, more memory usage..
    // Forcing instance now, fixes hot reloadig issues on React Native:
    var options = decoratorArgs[0] || {};
    asObservableObject$$1(instance).addComputedProp(instance, propertyName, __assign({ get: get$$1,
        set: set$$1, context: instance }, options));
});
var computedStructDecorator = computedDecorator$$1({ equals: comparer$$1.structural });
/**
 * Decorator for class properties: @computed get value() { return expr; }.
 * For legacy purposes also invokable as ES5 observable created: `computed(() => expr)`;
 */
var computed$$1 = function computed$$1(arg1, arg2, arg3) {
    if (typeof arg2 === "string") {
        // @computed
        return computedDecorator$$1.apply(null, arguments);
    }
    if (arg1 !== null && typeof arg1 === "object" && arguments.length === 1) {
        // @computed({ options })
        return computedDecorator$$1.apply(null, arguments);
    }
    // computed(expr, options?)
    if (false) {
        invariant$$1(typeof arg1 === "function", "First argument to `computed` should be an expression.");
        invariant$$1(arguments.length < 3, "Computed takes one or two arguments if used as function");
    }
    var opts = typeof arg2 === "object" ? arg2 : {};
    opts.get = arg1;
    opts.set = typeof arg2 === "function" ? arg2 : opts.set;
    opts.name = opts.name || arg1.name || ""; /* for generated name */
    return new ComputedValue$$1(opts);
};
computed$$1.struct = computedStructDecorator;

function createAction$$1(actionName, fn, ref) {
    if (false) {
        invariant$$1(typeof fn === "function", "`action` can only be invoked on functions");
        if (typeof actionName !== "string" || !actionName)
            fail$$1("actions should have valid names, got: '" + actionName + "'");
    }
    var res = function () {
        return executeAction$$1(actionName, fn, ref || this, arguments);
    };
    res.isMobxAction = true;
    return res;
}
function executeAction$$1(actionName, fn, scope, args) {
    var runInfo = startAction(actionName, fn, scope, args);
    var shouldSupressReactionError = true;
    try {
        var res = fn.apply(scope, args);
        shouldSupressReactionError = false;
        return res;
    }
    finally {
        if (shouldSupressReactionError) {
            globalState$$1.suppressReactionErrors = shouldSupressReactionError;
            endAction(runInfo);
            globalState$$1.suppressReactionErrors = false;
        }
        else {
            endAction(runInfo);
        }
    }
}
function startAction(actionName, fn, scope, args) {
    var notifySpy = isSpyEnabled$$1() && !!actionName;
    var startTime = 0;
    if (notifySpy && "production" !== "production") {
        startTime = Date.now();
        var l = (args && args.length) || 0;
        var flattendArgs = new Array(l);
        if (l > 0)
            for (var i = 0; i < l; i++)
                flattendArgs[i] = args[i];
        spyReportStart$$1({
            type: "action",
            name: actionName,
            object: scope,
            arguments: flattendArgs
        });
    }
    var prevDerivation = untrackedStart$$1();
    startBatch$$1();
    var prevAllowStateChanges = allowStateChangesStart$$1(true);
    return {
        prevDerivation: prevDerivation,
        prevAllowStateChanges: prevAllowStateChanges,
        notifySpy: notifySpy,
        startTime: startTime
    };
}
function endAction(runInfo) {
    allowStateChangesEnd$$1(runInfo.prevAllowStateChanges);
    endBatch$$1();
    untrackedEnd$$1(runInfo.prevDerivation);
    if (runInfo.notifySpy && "production" !== "production")
        spyReportEnd$$1({ time: Date.now() - runInfo.startTime });
}
function allowStateChanges$$1(allowStateChanges$$1, func) {
    var prev = allowStateChangesStart$$1(allowStateChanges$$1);
    var res;
    try {
        res = func();
    }
    finally {
        allowStateChangesEnd$$1(prev);
    }
    return res;
}
function allowStateChangesStart$$1(allowStateChanges$$1) {
    var prev = globalState$$1.allowStateChanges;
    globalState$$1.allowStateChanges = allowStateChanges$$1;
    return prev;
}
function allowStateChangesEnd$$1(prev) {
    globalState$$1.allowStateChanges = prev;
}
function allowStateChangesInsideComputed$$1(func) {
    var prev = globalState$$1.computationDepth;
    globalState$$1.computationDepth = 0;
    var res;
    try {
        res = func();
    }
    finally {
        globalState$$1.computationDepth = prev;
    }
    return res;
}

var ObservableValue$$1 = /** @class */ (function (_super) {
    __extends(ObservableValue$$1, _super);
    function ObservableValue$$1(value, enhancer, name, notifySpy, equals) {
        if (name === void 0) { name = "ObservableValue@" + getNextId$$1(); }
        if (notifySpy === void 0) { notifySpy = true; }
        if (equals === void 0) { equals = comparer$$1.default; }
        var _this = _super.call(this, name) || this;
        _this.enhancer = enhancer;
        _this.name = name;
        _this.equals = equals;
        _this.hasUnreportedChange = false;
        _this.value = enhancer(value, undefined, name);
        if (notifySpy && isSpyEnabled$$1() && "production" !== "production") {
            // only notify spy if this is a stand-alone observable
            spyReport$$1({ type: "create", name: _this.name, newValue: "" + _this.value });
        }
        return _this;
    }
    ObservableValue$$1.prototype.dehanceValue = function (value) {
        if (this.dehancer !== undefined)
            return this.dehancer(value);
        return value;
    };
    ObservableValue$$1.prototype.set = function (newValue) {
        var oldValue = this.value;
        newValue = this.prepareNewValue(newValue);
        if (newValue !== globalState$$1.UNCHANGED) {
            var notifySpy = isSpyEnabled$$1();
            if (notifySpy && "production" !== "production") {
                spyReportStart$$1({
                    type: "update",
                    name: this.name,
                    newValue: newValue,
                    oldValue: oldValue
                });
            }
            this.setNewValue(newValue);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
        }
    };
    ObservableValue$$1.prototype.prepareNewValue = function (newValue) {
        checkIfStateModificationsAreAllowed$$1(this);
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                object: this,
                type: "update",
                newValue: newValue
            });
            if (!change)
                return globalState$$1.UNCHANGED;
            newValue = change.newValue;
        }
        // apply modifier
        newValue = this.enhancer(newValue, this.value, this.name);
        return this.equals(this.value, newValue) ? globalState$$1.UNCHANGED : newValue;
    };
    ObservableValue$$1.prototype.setNewValue = function (newValue) {
        var oldValue = this.value;
        this.value = newValue;
        this.reportChanged();
        if (hasListeners$$1(this)) {
            notifyListeners$$1(this, {
                type: "update",
                object: this,
                newValue: newValue,
                oldValue: oldValue
            });
        }
    };
    ObservableValue$$1.prototype.get = function () {
        this.reportObserved();
        return this.dehanceValue(this.value);
    };
    ObservableValue$$1.prototype.intercept = function (handler) {
        return registerInterceptor$$1(this, handler);
    };
    ObservableValue$$1.prototype.observe = function (listener, fireImmediately) {
        if (fireImmediately)
            listener({
                object: this,
                type: "update",
                newValue: this.value,
                oldValue: undefined
            });
        return registerListener$$1(this, listener);
    };
    ObservableValue$$1.prototype.toJSON = function () {
        return this.get();
    };
    ObservableValue$$1.prototype.toString = function () {
        return this.name + "[" + this.value + "]";
    };
    ObservableValue$$1.prototype.valueOf = function () {
        return toPrimitive$$1(this.get());
    };
    ObservableValue$$1.prototype[Symbol.toPrimitive] = function () {
        return this.valueOf();
    };
    return ObservableValue$$1;
}(Atom$$1));
var isObservableValue$$1 = createInstanceofPredicate$$1("ObservableValue", ObservableValue$$1);

/**
 * A node in the state dependency root that observes other nodes, and can be observed itself.
 *
 * ComputedValue will remember the result of the computation for the duration of the batch, or
 * while being observed.
 *
 * During this time it will recompute only when one of its direct dependencies changed,
 * but only when it is being accessed with `ComputedValue.get()`.
 *
 * Implementation description:
 * 1. First time it's being accessed it will compute and remember result
 *    give back remembered result until 2. happens
 * 2. First time any deep dependency change, propagate POSSIBLY_STALE to all observers, wait for 3.
 * 3. When it's being accessed, recompute if any shallow dependency changed.
 *    if result changed: propagate STALE to all observers, that were POSSIBLY_STALE from the last step.
 *    go to step 2. either way
 *
 * If at any point it's outside batch and it isn't observed: reset everything and go to 1.
 */
var ComputedValue$$1 = /** @class */ (function () {
    /**
     * Create a new computed value based on a function expression.
     *
     * The `name` property is for debug purposes only.
     *
     * The `equals` property specifies the comparer function to use to determine if a newly produced
     * value differs from the previous value. Two comparers are provided in the library; `defaultComparer`
     * compares based on identity comparison (===), and `structualComparer` deeply compares the structure.
     * Structural comparison can be convenient if you always produce a new aggregated object and
     * don't want to notify observers if it is structurally the same.
     * This is useful for working with vectors, mouse coordinates etc.
     */
    function ComputedValue$$1(options) {
        this.dependenciesState = IDerivationState.NOT_TRACKING;
        this.observing = []; // nodes we are looking at. Our value depends on these nodes
        this.newObserving = null; // during tracking it's an array with new observed observers
        this.isBeingObserved = false;
        this.isPendingUnobservation = false;
        this.observers = new Set();
        this.diffValue = 0;
        this.runId = 0;
        this.lastAccessedBy = 0;
        this.lowestObserverState = IDerivationState.UP_TO_DATE;
        this.unboundDepsCount = 0;
        this.__mapid = "#" + getNextId$$1();
        this.value = new CaughtException$$1(null);
        this.isComputing = false; // to check for cycles
        this.isRunningSetter = false;
        this.isTracing = TraceMode$$1.NONE;
        if (false)
            throw "[mobx] missing option for computed: get";
        this.derivation = options.get;
        this.name = options.name || "ComputedValue@" + getNextId$$1();
        if (options.set)
            this.setter = createAction$$1(this.name + "-setter", options.set);
        this.equals =
            options.equals ||
                (options.compareStructural || options.struct
                    ? comparer$$1.structural
                    : comparer$$1.default);
        this.scope = options.context;
        this.requiresReaction = !!options.requiresReaction;
        this.keepAlive = !!options.keepAlive;
    }
    ComputedValue$$1.prototype.onBecomeStale = function () {
        propagateMaybeChanged$$1(this);
    };
    ComputedValue$$1.prototype.onBecomeObserved = function () {
        if (this.onBecomeObservedListeners) {
            this.onBecomeObservedListeners.forEach(function (listener) { return listener(); });
        }
    };
    ComputedValue$$1.prototype.onBecomeUnobserved = function () {
        if (this.onBecomeUnobservedListeners) {
            this.onBecomeUnobservedListeners.forEach(function (listener) { return listener(); });
        }
    };
    /**
     * Returns the current value of this computed value.
     * Will evaluate its computation first if needed.
     */
    ComputedValue$$1.prototype.get = function () {
        if (this.isComputing)
            fail$$1("Cycle detected in computation " + this.name + ": " + this.derivation);
        if (globalState$$1.inBatch === 0 && this.observers.size === 0 && !this.keepAlive) {
            if (shouldCompute$$1(this)) {
                this.warnAboutUntrackedRead();
                startBatch$$1(); // See perf test 'computed memoization'
                this.value = this.computeValue(false);
                endBatch$$1();
            }
        }
        else {
            reportObserved$$1(this);
            if (shouldCompute$$1(this))
                if (this.trackAndCompute())
                    propagateChangeConfirmed$$1(this);
        }
        var result = this.value;
        if (isCaughtException$$1(result))
            throw result.cause;
        return result;
    };
    ComputedValue$$1.prototype.peek = function () {
        var res = this.computeValue(false);
        if (isCaughtException$$1(res))
            throw res.cause;
        return res;
    };
    ComputedValue$$1.prototype.set = function (value) {
        if (this.setter) {
            invariant$$1(!this.isRunningSetter, "The setter of computed value '" + this.name + "' is trying to update itself. Did you intend to update an _observable_ value, instead of the computed property?");
            this.isRunningSetter = true;
            try {
                this.setter.call(this.scope, value);
            }
            finally {
                this.isRunningSetter = false;
            }
        }
        else
            invariant$$1(false, "production" !== "production" &&
                "[ComputedValue '" + this.name + "'] It is not possible to assign a new value to a computed value.");
    };
    ComputedValue$$1.prototype.trackAndCompute = function () {
        if (isSpyEnabled$$1() && "production" !== "production") {
            spyReport$$1({
                object: this.scope,
                type: "compute",
                name: this.name
            });
        }
        var oldValue = this.value;
        var wasSuspended = 
        /* see #1208 */ this.dependenciesState === IDerivationState.NOT_TRACKING;
        var newValue = this.computeValue(true);
        var changed = wasSuspended ||
            isCaughtException$$1(oldValue) ||
            isCaughtException$$1(newValue) ||
            !this.equals(oldValue, newValue);
        if (changed) {
            this.value = newValue;
        }
        return changed;
    };
    ComputedValue$$1.prototype.computeValue = function (track) {
        this.isComputing = true;
        globalState$$1.computationDepth++;
        var res;
        if (track) {
            res = trackDerivedFunction$$1(this, this.derivation, this.scope);
        }
        else {
            if (globalState$$1.disableErrorBoundaries === true) {
                res = this.derivation.call(this.scope);
            }
            else {
                try {
                    res = this.derivation.call(this.scope);
                }
                catch (e) {
                    res = new CaughtException$$1(e);
                }
            }
        }
        globalState$$1.computationDepth--;
        this.isComputing = false;
        return res;
    };
    ComputedValue$$1.prototype.suspend = function () {
        if (!this.keepAlive) {
            clearObserving$$1(this);
            this.value = undefined; // don't hold on to computed value!
        }
    };
    ComputedValue$$1.prototype.observe = function (listener, fireImmediately) {
        var _this = this;
        var firstTime = true;
        var prevValue = undefined;
        return autorun$$1(function () {
            var newValue = _this.get();
            if (!firstTime || fireImmediately) {
                var prevU = untrackedStart$$1();
                listener({
                    type: "update",
                    object: _this,
                    newValue: newValue,
                    oldValue: prevValue
                });
                untrackedEnd$$1(prevU);
            }
            firstTime = false;
            prevValue = newValue;
        });
    };
    ComputedValue$$1.prototype.warnAboutUntrackedRead = function () {
        if (true)
            return;
        if (this.requiresReaction === true) {
            fail$$1("[mobx] Computed value " + this.name + " is read outside a reactive context");
        }
        if (this.isTracing !== TraceMode$$1.NONE) {
            console.log("[mobx.trace] '" + this.name + "' is being read outside a reactive context. Doing a full recompute");
        }
        if (globalState$$1.computedRequiresReaction) {
            console.warn("[mobx] Computed value " + this.name + " is being read outside a reactive context. Doing a full recompute");
        }
    };
    ComputedValue$$1.prototype.toJSON = function () {
        return this.get();
    };
    ComputedValue$$1.prototype.toString = function () {
        return this.name + "[" + this.derivation.toString() + "]";
    };
    ComputedValue$$1.prototype.valueOf = function () {
        return toPrimitive$$1(this.get());
    };
    ComputedValue$$1.prototype[Symbol.toPrimitive] = function () {
        return this.valueOf();
    };
    return ComputedValue$$1;
}());
var isComputedValue$$1 = createInstanceofPredicate$$1("ComputedValue", ComputedValue$$1);

var IDerivationState;
(function (IDerivationState$$1) {
    // before being run or (outside batch and not being observed)
    // at this point derivation is not holding any data about dependency tree
    IDerivationState$$1[IDerivationState$$1["NOT_TRACKING"] = -1] = "NOT_TRACKING";
    // no shallow dependency changed since last computation
    // won't recalculate derivation
    // this is what makes mobx fast
    IDerivationState$$1[IDerivationState$$1["UP_TO_DATE"] = 0] = "UP_TO_DATE";
    // some deep dependency changed, but don't know if shallow dependency changed
    // will require to check first if UP_TO_DATE or POSSIBLY_STALE
    // currently only ComputedValue will propagate POSSIBLY_STALE
    //
    // having this state is second big optimization:
    // don't have to recompute on every dependency change, but only when it's needed
    IDerivationState$$1[IDerivationState$$1["POSSIBLY_STALE"] = 1] = "POSSIBLY_STALE";
    // A shallow dependency has changed since last computation and the derivation
    // will need to recompute when it's needed next.
    IDerivationState$$1[IDerivationState$$1["STALE"] = 2] = "STALE";
})(IDerivationState || (IDerivationState = {}));
var TraceMode$$1;
(function (TraceMode$$1) {
    TraceMode$$1[TraceMode$$1["NONE"] = 0] = "NONE";
    TraceMode$$1[TraceMode$$1["LOG"] = 1] = "LOG";
    TraceMode$$1[TraceMode$$1["BREAK"] = 2] = "BREAK";
})(TraceMode$$1 || (TraceMode$$1 = {}));
var CaughtException$$1 = /** @class */ (function () {
    function CaughtException$$1(cause) {
        this.cause = cause;
        // Empty
    }
    return CaughtException$$1;
}());
function isCaughtException$$1(e) {
    return e instanceof CaughtException$$1;
}
/**
 * Finds out whether any dependency of the derivation has actually changed.
 * If dependenciesState is 1 then it will recalculate dependencies,
 * if any dependency changed it will propagate it by changing dependenciesState to 2.
 *
 * By iterating over the dependencies in the same order that they were reported and
 * stopping on the first change, all the recalculations are only called for ComputedValues
 * that will be tracked by derivation. That is because we assume that if the first x
 * dependencies of the derivation doesn't change then the derivation should run the same way
 * up until accessing x-th dependency.
 */
function shouldCompute$$1(derivation) {
    switch (derivation.dependenciesState) {
        case IDerivationState.UP_TO_DATE:
            return false;
        case IDerivationState.NOT_TRACKING:
        case IDerivationState.STALE:
            return true;
        case IDerivationState.POSSIBLY_STALE: {
            var prevUntracked = untrackedStart$$1(); // no need for those computeds to be reported, they will be picked up in trackDerivedFunction.
            var obs = derivation.observing, l = obs.length;
            for (var i = 0; i < l; i++) {
                var obj = obs[i];
                if (isComputedValue$$1(obj)) {
                    if (globalState$$1.disableErrorBoundaries) {
                        obj.get();
                    }
                    else {
                        try {
                            obj.get();
                        }
                        catch (e) {
                            // we are not interested in the value *or* exception at this moment, but if there is one, notify all
                            untrackedEnd$$1(prevUntracked);
                            return true;
                        }
                    }
                    // if ComputedValue `obj` actually changed it will be computed and propagated to its observers.
                    // and `derivation` is an observer of `obj`
                    // invariantShouldCompute(derivation)
                    if (derivation.dependenciesState === IDerivationState.STALE) {
                        untrackedEnd$$1(prevUntracked);
                        return true;
                    }
                }
            }
            changeDependenciesStateTo0$$1(derivation);
            untrackedEnd$$1(prevUntracked);
            return false;
        }
    }
}
// function invariantShouldCompute(derivation: IDerivation) {
//     const newDepState = (derivation as any).dependenciesState
//     if (
//         process.env.NODE_ENV === "production" &&
//         (newDepState === IDerivationState.POSSIBLY_STALE ||
//             newDepState === IDerivationState.NOT_TRACKING)
//     )
//         fail("Illegal dependency state")
// }
function isComputingDerivation$$1() {
    return globalState$$1.trackingDerivation !== null; // filter out actions inside computations
}
function checkIfStateModificationsAreAllowed$$1(atom) {
    var hasObservers$$1 = atom.observers.size > 0;
    // Should never be possible to change an observed observable from inside computed, see #798
    if (globalState$$1.computationDepth > 0 && hasObservers$$1)
        fail$$1("production" !== "production" &&
            "Computed values are not allowed to cause side effects by changing observables that are already being observed. Tried to modify: " + atom.name);
    // Should not be possible to change observed state outside strict mode, except during initialization, see #563
    if (!globalState$$1.allowStateChanges && (hasObservers$$1 || globalState$$1.enforceActions === "strict"))
        fail$$1("production" !== "production" &&
            (globalState$$1.enforceActions
                ? "Since strict-mode is enabled, changing observed observable values outside actions is not allowed. Please wrap the code in an `action` if this change is intended. Tried to modify: "
                : "Side effects like changing state are not allowed at this point. Are you trying to modify state from, for example, the render function of a React component? Tried to modify: ") +
                atom.name);
}
/**
 * Executes the provided function `f` and tracks which observables are being accessed.
 * The tracking information is stored on the `derivation` object and the derivation is registered
 * as observer of any of the accessed observables.
 */
function trackDerivedFunction$$1(derivation, f, context) {
    // pre allocate array allocation + room for variation in deps
    // array will be trimmed by bindDependencies
    changeDependenciesStateTo0$$1(derivation);
    derivation.newObserving = new Array(derivation.observing.length + 100);
    derivation.unboundDepsCount = 0;
    derivation.runId = ++globalState$$1.runId;
    var prevTracking = globalState$$1.trackingDerivation;
    globalState$$1.trackingDerivation = derivation;
    var result;
    if (globalState$$1.disableErrorBoundaries === true) {
        result = f.call(context);
    }
    else {
        try {
            result = f.call(context);
        }
        catch (e) {
            result = new CaughtException$$1(e);
        }
    }
    globalState$$1.trackingDerivation = prevTracking;
    bindDependencies(derivation);
    return result;
}
/**
 * diffs newObserving with observing.
 * update observing to be newObserving with unique observables
 * notify observers that become observed/unobserved
 */
function bindDependencies(derivation) {
    // invariant(derivation.dependenciesState !== IDerivationState.NOT_TRACKING, "INTERNAL ERROR bindDependencies expects derivation.dependenciesState !== -1");
    var prevObserving = derivation.observing;
    var observing = (derivation.observing = derivation.newObserving);
    var lowestNewObservingDerivationState = IDerivationState.UP_TO_DATE;
    // Go through all new observables and check diffValue: (this list can contain duplicates):
    //   0: first occurrence, change to 1 and keep it
    //   1: extra occurrence, drop it
    var i0 = 0, l = derivation.unboundDepsCount;
    for (var i = 0; i < l; i++) {
        var dep = observing[i];
        if (dep.diffValue === 0) {
            dep.diffValue = 1;
            if (i0 !== i)
                observing[i0] = dep;
            i0++;
        }
        // Upcast is 'safe' here, because if dep is IObservable, `dependenciesState` will be undefined,
        // not hitting the condition
        if (dep.dependenciesState > lowestNewObservingDerivationState) {
            lowestNewObservingDerivationState = dep.dependenciesState;
        }
    }
    observing.length = i0;
    derivation.newObserving = null; // newObserving shouldn't be needed outside tracking (statement moved down to work around FF bug, see #614)
    // Go through all old observables and check diffValue: (it is unique after last bindDependencies)
    //   0: it's not in new observables, unobserve it
    //   1: it keeps being observed, don't want to notify it. change to 0
    l = prevObserving.length;
    while (l--) {
        var dep = prevObserving[l];
        if (dep.diffValue === 0) {
            removeObserver$$1(dep, derivation);
        }
        dep.diffValue = 0;
    }
    // Go through all new observables and check diffValue: (now it should be unique)
    //   0: it was set to 0 in last loop. don't need to do anything.
    //   1: it wasn't observed, let's observe it. set back to 0
    while (i0--) {
        var dep = observing[i0];
        if (dep.diffValue === 1) {
            dep.diffValue = 0;
            addObserver$$1(dep, derivation);
        }
    }
    // Some new observed derivations may become stale during this derivation computation
    // so they have had no chance to propagate staleness (#916)
    if (lowestNewObservingDerivationState !== IDerivationState.UP_TO_DATE) {
        derivation.dependenciesState = lowestNewObservingDerivationState;
        derivation.onBecomeStale();
    }
}
function clearObserving$$1(derivation) {
    // invariant(globalState.inBatch > 0, "INTERNAL ERROR clearObserving should be called only inside batch");
    var obs = derivation.observing;
    derivation.observing = [];
    var i = obs.length;
    while (i--)
        removeObserver$$1(obs[i], derivation);
    derivation.dependenciesState = IDerivationState.NOT_TRACKING;
}
function untracked$$1(action$$1) {
    var prev = untrackedStart$$1();
    try {
        return action$$1();
    }
    finally {
        untrackedEnd$$1(prev);
    }
}
function untrackedStart$$1() {
    var prev = globalState$$1.trackingDerivation;
    globalState$$1.trackingDerivation = null;
    return prev;
}
function untrackedEnd$$1(prev) {
    globalState$$1.trackingDerivation = prev;
}
/**
 * needed to keep `lowestObserverState` correct. when changing from (2 or 1) to 0
 *
 */
function changeDependenciesStateTo0$$1(derivation) {
    if (derivation.dependenciesState === IDerivationState.UP_TO_DATE)
        return;
    derivation.dependenciesState = IDerivationState.UP_TO_DATE;
    var obs = derivation.observing;
    var i = obs.length;
    while (i--)
        obs[i].lowestObserverState = IDerivationState.UP_TO_DATE;
}

/**
 * These values will persist if global state is reset
 */
var persistentKeys = [
    "mobxGuid",
    "spyListeners",
    "enforceActions",
    "computedRequiresReaction",
    "disableErrorBoundaries",
    "runId",
    "UNCHANGED"
];
var MobXGlobals$$1 = /** @class */ (function () {
    function MobXGlobals$$1() {
        /**
         * MobXGlobals version.
         * MobX compatiblity with other versions loaded in memory as long as this version matches.
         * It indicates that the global state still stores similar information
         *
         * N.B: this version is unrelated to the package version of MobX, and is only the version of the
         * internal state storage of MobX, and can be the same across many different package versions
         */
        this.version = 5;
        /**
         * globally unique token to signal unchanged
         */
        this.UNCHANGED = {};
        /**
         * Currently running derivation
         */
        this.trackingDerivation = null;
        /**
         * Are we running a computation currently? (not a reaction)
         */
        this.computationDepth = 0;
        /**
         * Each time a derivation is tracked, it is assigned a unique run-id
         */
        this.runId = 0;
        /**
         * 'guid' for general purpose. Will be persisted amongst resets.
         */
        this.mobxGuid = 0;
        /**
         * Are we in a batch block? (and how many of them)
         */
        this.inBatch = 0;
        /**
         * Observables that don't have observers anymore, and are about to be
         * suspended, unless somebody else accesses it in the same batch
         *
         * @type {IObservable[]}
         */
        this.pendingUnobservations = [];
        /**
         * List of scheduled, not yet executed, reactions.
         */
        this.pendingReactions = [];
        /**
         * Are we currently processing reactions?
         */
        this.isRunningReactions = false;
        /**
         * Is it allowed to change observables at this point?
         * In general, MobX doesn't allow that when running computations and React.render.
         * To ensure that those functions stay pure.
         */
        this.allowStateChanges = true;
        /**
         * If strict mode is enabled, state changes are by default not allowed
         */
        this.enforceActions = false;
        /**
         * Spy callbacks
         */
        this.spyListeners = [];
        /**
         * Globally attached error handlers that react specifically to errors in reactions
         */
        this.globalReactionErrorHandlers = [];
        /**
         * Warn if computed values are accessed outside a reactive context
         */
        this.computedRequiresReaction = false;
        /*
         * Don't catch and rethrow exceptions. This is useful for inspecting the state of
         * the stack when an exception occurs while debugging.
         */
        this.disableErrorBoundaries = false;
        /*
         * If true, we are already handling an exception in an action. Any errors in reactions should be supressed, as
         * they are not the cause, see: https://github.com/mobxjs/mobx/issues/1836
         */
        this.suppressReactionErrors = false;
    }
    return MobXGlobals$$1;
}());
var canMergeGlobalState = true;
var isolateCalled = false;
var globalState$$1 = (function () {
    var global = getGlobal$$1();
    if (global.__mobxInstanceCount > 0 && !global.__mobxGlobals)
        canMergeGlobalState = false;
    if (global.__mobxGlobals && global.__mobxGlobals.version !== new MobXGlobals$$1().version)
        canMergeGlobalState = false;
    if (!canMergeGlobalState) {
        setTimeout(function () {
            if (!isolateCalled) {
                fail$$1("There are multiple, different versions of MobX active. Make sure MobX is loaded only once or use `configure({ isolateGlobalState: true })`");
            }
        }, 1);
        return new MobXGlobals$$1();
    }
    else if (global.__mobxGlobals) {
        global.__mobxInstanceCount += 1;
        if (!global.__mobxGlobals.UNCHANGED)
            global.__mobxGlobals.UNCHANGED = {}; // make merge backward compatible
        return global.__mobxGlobals;
    }
    else {
        global.__mobxInstanceCount = 1;
        return (global.__mobxGlobals = new MobXGlobals$$1());
    }
})();
function isolateGlobalState$$1() {
    if (globalState$$1.pendingReactions.length ||
        globalState$$1.inBatch ||
        globalState$$1.isRunningReactions)
        fail$$1("isolateGlobalState should be called before MobX is running any reactions");
    isolateCalled = true;
    if (canMergeGlobalState) {
        if (--getGlobal$$1().__mobxInstanceCount === 0)
            getGlobal$$1().__mobxGlobals = undefined;
        globalState$$1 = new MobXGlobals$$1();
    }
}
function getGlobalState$$1() {
    return globalState$$1;
}
/**
 * For testing purposes only; this will break the internal state of existing observables,
 * but can be used to get back at a stable state after throwing errors
 */
function resetGlobalState$$1() {
    var defaultGlobals = new MobXGlobals$$1();
    for (var key in defaultGlobals)
        if (persistentKeys.indexOf(key) === -1)
            globalState$$1[key] = defaultGlobals[key];
    globalState$$1.allowStateChanges = !globalState$$1.enforceActions;
}
function getGlobal$$1() {
    return typeof window !== "undefined" ? window : global;
}

function hasObservers$$1(observable$$1) {
    return observable$$1.observers && observable$$1.observers.size > 0;
}
function getObservers$$1(observable$$1) {
    return observable$$1.observers;
}
// function invariantObservers(observable: IObservable) {
//     const list = observable.observers
//     const map = observable.observersIndexes
//     const l = list.length
//     for (let i = 0; i < l; i++) {
//         const id = list[i].__mapid
//         if (i) {
//             invariant(map[id] === i, "INTERNAL ERROR maps derivation.__mapid to index in list") // for performance
//         } else {
//             invariant(!(id in map), "INTERNAL ERROR observer on index 0 shouldn't be held in map.") // for performance
//         }
//     }
//     invariant(
//         list.length === 0 || Object.keys(map).length === list.length - 1,
//         "INTERNAL ERROR there is no junk in map"
//     )
// }
function addObserver$$1(observable$$1, node) {
    // invariant(node.dependenciesState !== -1, "INTERNAL ERROR, can add only dependenciesState !== -1");
    // invariant(observable._observers.indexOf(node) === -1, "INTERNAL ERROR add already added node");
    // invariantObservers(observable);
    observable$$1.observers.add(node);
    if (observable$$1.lowestObserverState > node.dependenciesState)
        observable$$1.lowestObserverState = node.dependenciesState;
    // invariantObservers(observable);
    // invariant(observable._observers.indexOf(node) !== -1, "INTERNAL ERROR didn't add node");
}
function removeObserver$$1(observable$$1, node) {
    // invariant(globalState.inBatch > 0, "INTERNAL ERROR, remove should be called only inside batch");
    // invariant(observable._observers.indexOf(node) !== -1, "INTERNAL ERROR remove already removed node");
    // invariantObservers(observable);
    observable$$1.observers.delete(node);
    if (observable$$1.observers.size === 0) {
        // deleting last observer
        queueForUnobservation$$1(observable$$1);
    }
    // invariantObservers(observable);
    // invariant(observable._observers.indexOf(node) === -1, "INTERNAL ERROR remove already removed node2");
}
function queueForUnobservation$$1(observable$$1) {
    if (observable$$1.isPendingUnobservation === false) {
        // invariant(observable._observers.length === 0, "INTERNAL ERROR, should only queue for unobservation unobserved observables");
        observable$$1.isPendingUnobservation = true;
        globalState$$1.pendingUnobservations.push(observable$$1);
    }
}
/**
 * Batch starts a transaction, at least for purposes of memoizing ComputedValues when nothing else does.
 * During a batch `onBecomeUnobserved` will be called at most once per observable.
 * Avoids unnecessary recalculations.
 */
function startBatch$$1() {
    globalState$$1.inBatch++;
}
function endBatch$$1() {
    if (--globalState$$1.inBatch === 0) {
        runReactions$$1();
        // the batch is actually about to finish, all unobserving should happen here.
        var list = globalState$$1.pendingUnobservations;
        for (var i = 0; i < list.length; i++) {
            var observable$$1 = list[i];
            observable$$1.isPendingUnobservation = false;
            if (observable$$1.observers.size === 0) {
                if (observable$$1.isBeingObserved) {
                    // if this observable had reactive observers, trigger the hooks
                    observable$$1.isBeingObserved = false;
                    observable$$1.onBecomeUnobserved();
                }
                if (observable$$1 instanceof ComputedValue$$1) {
                    // computed values are automatically teared down when the last observer leaves
                    // this process happens recursively, this computed might be the last observabe of another, etc..
                    observable$$1.suspend();
                }
            }
        }
        globalState$$1.pendingUnobservations = [];
    }
}
function reportObserved$$1(observable$$1) {
    var derivation = globalState$$1.trackingDerivation;
    if (derivation !== null) {
        /**
         * Simple optimization, give each derivation run an unique id (runId)
         * Check if last time this observable was accessed the same runId is used
         * if this is the case, the relation is already known
         */
        if (derivation.runId !== observable$$1.lastAccessedBy) {
            observable$$1.lastAccessedBy = derivation.runId;
            // Tried storing newObserving, or observing, or both as Set, but performance didn't come close...
            derivation.newObserving[derivation.unboundDepsCount++] = observable$$1;
            if (!observable$$1.isBeingObserved) {
                observable$$1.isBeingObserved = true;
                observable$$1.onBecomeObserved();
            }
        }
        return true;
    }
    else if (observable$$1.observers.size === 0 && globalState$$1.inBatch > 0) {
        queueForUnobservation$$1(observable$$1);
    }
    return false;
}
// function invariantLOS(observable: IObservable, msg: string) {
//     // it's expensive so better not run it in produciton. but temporarily helpful for testing
//     const min = getObservers(observable).reduce((a, b) => Math.min(a, b.dependenciesState), 2)
//     if (min >= observable.lowestObserverState) return // <- the only assumption about `lowestObserverState`
//     throw new Error(
//         "lowestObserverState is wrong for " +
//             msg +
//             " because " +
//             min +
//             " < " +
//             observable.lowestObserverState
//     )
// }
/**
 * NOTE: current propagation mechanism will in case of self reruning autoruns behave unexpectedly
 * It will propagate changes to observers from previous run
 * It's hard or maybe impossible (with reasonable perf) to get it right with current approach
 * Hopefully self reruning autoruns aren't a feature people should depend on
 * Also most basic use cases should be ok
 */
// Called by Atom when its value changes
function propagateChanged$$1(observable$$1) {
    // invariantLOS(observable, "changed start");
    if (observable$$1.lowestObserverState === IDerivationState.STALE)
        return;
    observable$$1.lowestObserverState = IDerivationState.STALE;
    // Ideally we use for..of here, but the downcompiled version is really slow...
    observable$$1.observers.forEach(function (d) {
        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {
            if (d.isTracing !== TraceMode$$1.NONE) {
                logTraceInfo(d, observable$$1);
            }
            d.onBecomeStale();
        }
        d.dependenciesState = IDerivationState.STALE;
    });
    // invariantLOS(observable, "changed end");
}
// Called by ComputedValue when it recalculate and its value changed
function propagateChangeConfirmed$$1(observable$$1) {
    // invariantLOS(observable, "confirmed start");
    if (observable$$1.lowestObserverState === IDerivationState.STALE)
        return;
    observable$$1.lowestObserverState = IDerivationState.STALE;
    observable$$1.observers.forEach(function (d) {
        if (d.dependenciesState === IDerivationState.POSSIBLY_STALE)
            d.dependenciesState = IDerivationState.STALE;
        else if (d.dependenciesState === IDerivationState.UP_TO_DATE // this happens during computing of `d`, just keep lowestObserverState up to date.
        )
            observable$$1.lowestObserverState = IDerivationState.UP_TO_DATE;
    });
    // invariantLOS(observable, "confirmed end");
}
// Used by computed when its dependency changed, but we don't wan't to immediately recompute.
function propagateMaybeChanged$$1(observable$$1) {
    // invariantLOS(observable, "maybe start");
    if (observable$$1.lowestObserverState !== IDerivationState.UP_TO_DATE)
        return;
    observable$$1.lowestObserverState = IDerivationState.POSSIBLY_STALE;
    observable$$1.observers.forEach(function (d) {
        if (d.dependenciesState === IDerivationState.UP_TO_DATE) {
            d.dependenciesState = IDerivationState.POSSIBLY_STALE;
            if (d.isTracing !== TraceMode$$1.NONE) {
                logTraceInfo(d, observable$$1);
            }
            d.onBecomeStale();
        }
    });
    // invariantLOS(observable, "maybe end");
}
function logTraceInfo(derivation, observable$$1) {
    console.log("[mobx.trace] '" + derivation.name + "' is invalidated due to a change in: '" + observable$$1.name + "'");
    if (derivation.isTracing === TraceMode$$1.BREAK) {
        var lines = [];
        printDepTree(getDependencyTree$$1(derivation), lines, 1);
        // prettier-ignore
        new Function("debugger;\n/*\nTracing '" + derivation.name + "'\n\nYou are entering this break point because derivation '" + derivation.name + "' is being traced and '" + observable$$1.name + "' is now forcing it to update.\nJust follow the stacktrace you should now see in the devtools to see precisely what piece of your code is causing this update\nThe stackframe you are looking for is at least ~6-8 stack-frames up.\n\n" + (derivation instanceof ComputedValue$$1 ? derivation.derivation.toString().replace(/[*]\//g, "/") : "") + "\n\nThe dependencies for this derivation are:\n\n" + lines.join("\n") + "\n*/\n    ")();
    }
}
function printDepTree(tree, lines, depth) {
    if (lines.length >= 1000) {
        lines.push("(and many more)");
        return;
    }
    lines.push("" + new Array(depth).join("\t") + tree.name); // MWE: not the fastest, but the easiest way :)
    if (tree.dependencies)
        tree.dependencies.forEach(function (child) { return printDepTree(child, lines, depth + 1); });
}

var Reaction$$1 = /** @class */ (function () {
    function Reaction$$1(name, onInvalidate, errorHandler) {
        if (name === void 0) { name = "Reaction@" + getNextId$$1(); }
        this.name = name;
        this.onInvalidate = onInvalidate;
        this.errorHandler = errorHandler;
        this.observing = []; // nodes we are looking at. Our value depends on these nodes
        this.newObserving = [];
        this.dependenciesState = IDerivationState.NOT_TRACKING;
        this.diffValue = 0;
        this.runId = 0;
        this.unboundDepsCount = 0;
        this.__mapid = "#" + getNextId$$1();
        this.isDisposed = false;
        this._isScheduled = false;
        this._isTrackPending = false;
        this._isRunning = false;
        this.isTracing = TraceMode$$1.NONE;
    }
    Reaction$$1.prototype.onBecomeStale = function () {
        this.schedule();
    };
    Reaction$$1.prototype.schedule = function () {
        if (!this._isScheduled) {
            this._isScheduled = true;
            globalState$$1.pendingReactions.push(this);
            runReactions$$1();
        }
    };
    Reaction$$1.prototype.isScheduled = function () {
        return this._isScheduled;
    };
    /**
     * internal, use schedule() if you intend to kick off a reaction
     */
    Reaction$$1.prototype.runReaction = function () {
        if (!this.isDisposed) {
            startBatch$$1();
            this._isScheduled = false;
            if (shouldCompute$$1(this)) {
                this._isTrackPending = true;
                try {
                    this.onInvalidate();
                    if (this._isTrackPending &&
                        isSpyEnabled$$1() &&
                        "production" !== "production") {
                        // onInvalidate didn't trigger track right away..
                        spyReport$$1({
                            name: this.name,
                            type: "scheduled-reaction"
                        });
                    }
                }
                catch (e) {
                    this.reportExceptionInDerivation(e);
                }
            }
            endBatch$$1();
        }
    };
    Reaction$$1.prototype.track = function (fn) {
        if (this.isDisposed) {
            fail$$1("Reaction already disposed");
        }
        startBatch$$1();
        var notify = isSpyEnabled$$1();
        var startTime;
        if (notify && "production" !== "production") {
            startTime = Date.now();
            spyReportStart$$1({
                name: this.name,
                type: "reaction"
            });
        }
        this._isRunning = true;
        var result = trackDerivedFunction$$1(this, fn, undefined);
        this._isRunning = false;
        this._isTrackPending = false;
        if (this.isDisposed) {
            // disposed during last run. Clean up everything that was bound after the dispose call.
            clearObserving$$1(this);
        }
        if (isCaughtException$$1(result))
            this.reportExceptionInDerivation(result.cause);
        if (notify && "production" !== "production") {
            spyReportEnd$$1({
                time: Date.now() - startTime
            });
        }
        endBatch$$1();
    };
    Reaction$$1.prototype.reportExceptionInDerivation = function (error) {
        var _this = this;
        if (this.errorHandler) {
            this.errorHandler(error, this);
            return;
        }
        if (globalState$$1.disableErrorBoundaries)
            throw error;
        var message = "[mobx] Encountered an uncaught exception that was thrown by a reaction or observer component, in: '" + this + "'";
        if (globalState$$1.suppressReactionErrors) {
            console.warn("[mobx] (error in reaction '" + this.name + "' suppressed, fix error of causing action below)"); // prettier-ignore
        }
        else {
            console.error(message, error);
            /** If debugging brought you here, please, read the above message :-). Tnx! */
        }
        if (isSpyEnabled$$1()) {
            spyReport$$1({
                type: "error",
                name: this.name,
                message: message,
                error: "" + error
            });
        }
        globalState$$1.globalReactionErrorHandlers.forEach(function (f) { return f(error, _this); });
    };
    Reaction$$1.prototype.dispose = function () {
        if (!this.isDisposed) {
            this.isDisposed = true;
            if (!this._isRunning) {
                // if disposed while running, clean up later. Maybe not optimal, but rare case
                startBatch$$1();
                clearObserving$$1(this);
                endBatch$$1();
            }
        }
    };
    Reaction$$1.prototype.getDisposer = function () {
        var r = this.dispose.bind(this);
        r[$mobx$$1] = this;
        return r;
    };
    Reaction$$1.prototype.toString = function () {
        return "Reaction[" + this.name + "]";
    };
    Reaction$$1.prototype.trace = function (enterBreakPoint) {
        if (enterBreakPoint === void 0) { enterBreakPoint = false; }
        trace$$1(this, enterBreakPoint);
    };
    return Reaction$$1;
}());
function onReactionError$$1(handler) {
    globalState$$1.globalReactionErrorHandlers.push(handler);
    return function () {
        var idx = globalState$$1.globalReactionErrorHandlers.indexOf(handler);
        if (idx >= 0)
            globalState$$1.globalReactionErrorHandlers.splice(idx, 1);
    };
}
/**
 * Magic number alert!
 * Defines within how many times a reaction is allowed to re-trigger itself
 * until it is assumed that this is gonna be a never ending loop...
 */
var MAX_REACTION_ITERATIONS = 100;
var reactionScheduler = function (f) { return f(); };
function runReactions$$1() {
    // Trampolining, if runReactions are already running, new reactions will be picked up
    if (globalState$$1.inBatch > 0 || globalState$$1.isRunningReactions)
        return;
    reactionScheduler(runReactionsHelper);
}
function runReactionsHelper() {
    globalState$$1.isRunningReactions = true;
    var allReactions = globalState$$1.pendingReactions;
    var iterations = 0;
    // While running reactions, new reactions might be triggered.
    // Hence we work with two variables and check whether
    // we converge to no remaining reactions after a while.
    while (allReactions.length > 0) {
        if (++iterations === MAX_REACTION_ITERATIONS) {
            console.error("Reaction doesn't converge to a stable state after " + MAX_REACTION_ITERATIONS + " iterations." +
                (" Probably there is a cycle in the reactive function: " + allReactions[0]));
            allReactions.splice(0); // clear reactions
        }
        var remainingReactions = allReactions.splice(0);
        for (var i = 0, l = remainingReactions.length; i < l; i++)
            remainingReactions[i].runReaction();
    }
    globalState$$1.isRunningReactions = false;
}
var isReaction$$1 = createInstanceofPredicate$$1("Reaction", Reaction$$1);
function setReactionScheduler$$1(fn) {
    var baseScheduler = reactionScheduler;
    reactionScheduler = function (f) { return fn(function () { return baseScheduler(f); }); };
}

function isSpyEnabled$$1() {
    return "production" !== "production" && !!globalState$$1.spyListeners.length;
}
function spyReport$$1(event) {
    if (true)
        return; // dead code elimination can do the rest
    if (!globalState$$1.spyListeners.length)
        return;
    var listeners = globalState$$1.spyListeners;
    for (var i = 0, l = listeners.length; i < l; i++)
        listeners[i](event);
}
function spyReportStart$$1(event) {
    if (true)
        return;
    var change = __assign({}, event, { spyReportStart: true });
    spyReport$$1(change);
}
var END_EVENT = { spyReportEnd: true };
function spyReportEnd$$1(change) {
    if (true)
        return;
    if (change)
        spyReport$$1(__assign({}, change, { spyReportEnd: true }));
    else
        spyReport$$1(END_EVENT);
}
function spy$$1(listener) {
    if (true) {
        console.warn("[mobx.spy] Is a no-op in production builds");
        return function () { };
    }
    else {
        globalState$$1.spyListeners.push(listener);
        return once$$1(function () {
            globalState$$1.spyListeners = globalState$$1.spyListeners.filter(function (l) { return l !== listener; });
        });
    }
}

function dontReassignFields() {
    fail$$1("production" !== "production" && "@action fields are not reassignable");
}
function namedActionDecorator$$1(name) {
    return function (target, prop, descriptor) {
        if (descriptor) {
            if (false) {
                return fail$$1("@action cannot be used with getters");
            }
            // babel / typescript
            // @action method() { }
            if (descriptor.value) {
                // typescript
                return {
                    value: createAction$$1(name, descriptor.value),
                    enumerable: false,
                    configurable: true,
                    writable: true // for typescript, this must be writable, otherwise it cannot inherit :/ (see inheritable actions test)
                };
            }
            // babel only: @action method = () => {}
            var initializer_1 = descriptor.initializer;
            return {
                enumerable: false,
                configurable: true,
                writable: true,
                initializer: function () {
                    // N.B: we can't immediately invoke initializer; this would be wrong
                    return createAction$$1(name, initializer_1.call(this));
                }
            };
        }
        // bound instance methods
        return actionFieldDecorator$$1(name).apply(this, arguments);
    };
}
function actionFieldDecorator$$1(name) {
    // Simple property that writes on first invocation to the current instance
    return function (target, prop, descriptor) {
        Object.defineProperty(target, prop, {
            configurable: true,
            enumerable: false,
            get: function () {
                return undefined;
            },
            set: function (value) {
                addHiddenProp$$1(this, prop, action$$1(name, value));
            }
        });
    };
}
function boundActionDecorator$$1(target, propertyName, descriptor, applyToInstance) {
    if (applyToInstance === true) {
        defineBoundAction$$1(target, propertyName, descriptor.value);
        return null;
    }
    if (descriptor) {
        // if (descriptor.value)
        // Typescript / Babel: @action.bound method() { }
        // also: babel @action.bound method = () => {}
        return {
            configurable: true,
            enumerable: false,
            get: function () {
                defineBoundAction$$1(this, propertyName, descriptor.value || descriptor.initializer.call(this));
                return this[propertyName];
            },
            set: dontReassignFields
        };
    }
    // field decorator Typescript @action.bound method = () => {}
    return {
        enumerable: false,
        configurable: true,
        set: function (v) {
            defineBoundAction$$1(this, propertyName, v);
        },
        get: function () {
            return undefined;
        }
    };
}

var action$$1 = function action$$1(arg1, arg2, arg3, arg4) {
    // action(fn() {})
    if (arguments.length === 1 && typeof arg1 === "function")
        return createAction$$1(arg1.name || "<unnamed action>", arg1);
    // action("name", fn() {})
    if (arguments.length === 2 && typeof arg2 === "function")
        return createAction$$1(arg1, arg2);
    // @action("name") fn() {}
    if (arguments.length === 1 && typeof arg1 === "string")
        return namedActionDecorator$$1(arg1);
    // @action fn() {}
    if (arg4 === true) {
        // apply to instance immediately
        addHiddenProp$$1(arg1, arg2, createAction$$1(arg1.name || arg2, arg3.value, this));
    }
    else {
        return namedActionDecorator$$1(arg2).apply(null, arguments);
    }
};
action$$1.bound = boundActionDecorator$$1;
function runInAction$$1(arg1, arg2) {
    var actionName = typeof arg1 === "string" ? arg1 : arg1.name || "<unnamed action>";
    var fn = typeof arg1 === "function" ? arg1 : arg2;
    if (false) {
        invariant$$1(typeof fn === "function" && fn.length === 0, "`runInAction` expects a function without arguments");
        if (typeof actionName !== "string" || !actionName)
            fail$$1("actions should have valid names, got: '" + actionName + "'");
    }
    return executeAction$$1(actionName, fn, this, undefined);
}
function isAction$$1(thing) {
    return typeof thing === "function" && thing.isMobxAction === true;
}
function defineBoundAction$$1(target, propertyName, fn) {
    addHiddenProp$$1(target, propertyName, createAction$$1(propertyName, fn.bind(target)));
}

/**
 * Creates a named reactive view and keeps it alive, so that the view is always
 * updated if one of the dependencies changes, even when the view is not further used by something else.
 * @param view The reactive view
 * @returns disposer function, which can be used to stop the view from being updated in the future.
 */
function autorun$$1(view, opts) {
    if (opts === void 0) { opts = EMPTY_OBJECT$$1; }
    if (false) {
        invariant$$1(typeof view === "function", "Autorun expects a function as first argument");
        invariant$$1(isAction$$1(view) === false, "Autorun does not accept actions since actions are untrackable");
    }
    var name = (opts && opts.name) || view.name || "Autorun@" + getNextId$$1();
    var runSync = !opts.scheduler && !opts.delay;
    var reaction$$1;
    if (runSync) {
        // normal autorun
        reaction$$1 = new Reaction$$1(name, function () {
            this.track(reactionRunner);
        }, opts.onError);
    }
    else {
        var scheduler_1 = createSchedulerFromOptions(opts);
        // debounced autorun
        var isScheduled_1 = false;
        reaction$$1 = new Reaction$$1(name, function () {
            if (!isScheduled_1) {
                isScheduled_1 = true;
                scheduler_1(function () {
                    isScheduled_1 = false;
                    if (!reaction$$1.isDisposed)
                        reaction$$1.track(reactionRunner);
                });
            }
        }, opts.onError);
    }
    function reactionRunner() {
        view(reaction$$1);
    }
    reaction$$1.schedule();
    return reaction$$1.getDisposer();
}
var run = function (f) { return f(); };
function createSchedulerFromOptions(opts) {
    return opts.scheduler
        ? opts.scheduler
        : opts.delay
            ? function (f) { return setTimeout(f, opts.delay); }
            : run;
}
function reaction$$1(expression, effect, opts) {
    if (opts === void 0) { opts = EMPTY_OBJECT$$1; }
    if (false) {
        invariant$$1(typeof expression === "function", "First argument to reaction should be a function");
        invariant$$1(typeof opts === "object", "Third argument of reactions should be an object");
    }
    var name = opts.name || "Reaction@" + getNextId$$1();
    var effectAction = action$$1(name, opts.onError ? wrapErrorHandler(opts.onError, effect) : effect);
    var runSync = !opts.scheduler && !opts.delay;
    var scheduler = createSchedulerFromOptions(opts);
    var firstTime = true;
    var isScheduled = false;
    var value;
    var equals = opts.compareStructural
        ? comparer$$1.structural
        : opts.equals || comparer$$1.default;
    var r = new Reaction$$1(name, function () {
        if (firstTime || runSync) {
            reactionRunner();
        }
        else if (!isScheduled) {
            isScheduled = true;
            scheduler(reactionRunner);
        }
    }, opts.onError);
    function reactionRunner() {
        isScheduled = false; // Q: move into reaction runner?
        if (r.isDisposed)
            return;
        var changed = false;
        r.track(function () {
            var nextValue = expression(r);
            changed = firstTime || !equals(value, nextValue);
            value = nextValue;
        });
        if (firstTime && opts.fireImmediately)
            effectAction(value, r);
        if (!firstTime && changed === true)
            effectAction(value, r);
        if (firstTime)
            firstTime = false;
    }
    r.schedule();
    return r.getDisposer();
}
function wrapErrorHandler(errorHandler, baseFn) {
    return function () {
        try {
            return baseFn.apply(this, arguments);
        }
        catch (e) {
            errorHandler.call(this, e);
        }
    };
}

function onBecomeObserved$$1(thing, arg2, arg3) {
    return interceptHook("onBecomeObserved", thing, arg2, arg3);
}
function onBecomeUnobserved$$1(thing, arg2, arg3) {
    return interceptHook("onBecomeUnobserved", thing, arg2, arg3);
}
function interceptHook(hook, thing, arg2, arg3) {
    var atom = typeof arg2 === "string" ? getAtom$$1(thing, arg2) : getAtom$$1(thing);
    var cb = typeof arg2 === "string" ? arg3 : arg2;
    var listenersKey = hook + "Listeners";
    if (atom[listenersKey]) {
        atom[listenersKey].add(cb);
    }
    else {
        atom[listenersKey] = new Set([cb]);
    }
    var orig = atom[hook];
    if (typeof orig !== "function")
        return fail$$1("production" !== "production" && "Not an atom that can be (un)observed");
    return function () {
        var hookListeners = atom[listenersKey];
        if (hookListeners) {
            hookListeners.delete(cb);
            if (hookListeners.size === 0) {
                delete atom[listenersKey];
            }
        }
    };
}

function configure$$1(options) {
    var enforceActions = options.enforceActions, computedRequiresReaction = options.computedRequiresReaction, disableErrorBoundaries = options.disableErrorBoundaries, reactionScheduler = options.reactionScheduler;
    if (options.isolateGlobalState === true) {
        isolateGlobalState$$1();
    }
    if (enforceActions !== undefined) {
        if (typeof enforceActions === "boolean" || enforceActions === "strict")
            deprecated$$1("Deprecated value for 'enforceActions', use 'false' => '\"never\"', 'true' => '\"observed\"', '\"strict\"' => \"'always'\" instead");
        var ea = void 0;
        switch (enforceActions) {
            case true:
            case "observed":
                ea = true;
                break;
            case false:
            case "never":
                ea = false;
                break;
            case "strict":
            case "always":
                ea = "strict";
                break;
            default:
                fail$$1("Invalid value for 'enforceActions': '" + enforceActions + "', expected 'never', 'always' or 'observed'");
        }
        globalState$$1.enforceActions = ea;
        globalState$$1.allowStateChanges = ea === true || ea === "strict" ? false : true;
    }
    if (computedRequiresReaction !== undefined) {
        globalState$$1.computedRequiresReaction = !!computedRequiresReaction;
    }
    if (disableErrorBoundaries !== undefined) {
        if (disableErrorBoundaries === true)
            console.warn("WARNING: Debug feature only. MobX will NOT recover from errors when `disableErrorBoundaries` is enabled.");
        globalState$$1.disableErrorBoundaries = !!disableErrorBoundaries;
    }
    if (reactionScheduler) {
        setReactionScheduler$$1(reactionScheduler);
    }
}

function decorate$$1(thing, decorators) {
    "production" !== "production" &&
        invariant$$1(isPlainObject$$1(decorators), "Decorators should be a key value map");
    var target = typeof thing === "function" ? thing.prototype : thing;
    var _loop_1 = function (prop) {
        var propertyDecorators = decorators[prop];
        if (!Array.isArray(propertyDecorators)) {
            propertyDecorators = [propertyDecorators];
        }
        "production" !== "production" &&
            invariant$$1(propertyDecorators.every(function (decorator) { return typeof decorator === "function"; }), "Decorate: expected a decorator function or array of decorator functions for '" + prop + "'");
        var descriptor = Object.getOwnPropertyDescriptor(target, prop);
        var newDescriptor = propertyDecorators.reduce(function (accDescriptor, decorator) { return decorator(target, prop, accDescriptor); }, descriptor);
        if (newDescriptor)
            Object.defineProperty(target, prop, newDescriptor);
    };
    for (var prop in decorators) {
        _loop_1(prop);
    }
    return thing;
}

function extendObservable$$1(target, properties, decorators, options) {
    if (false) {
        invariant$$1(arguments.length >= 2 && arguments.length <= 4, "'extendObservable' expected 2-4 arguments");
        invariant$$1(typeof target === "object", "'extendObservable' expects an object as first argument");
        invariant$$1(!isObservableMap$$1(target), "'extendObservable' should not be used on maps, use map.merge instead");
    }
    options = asCreateObservableOptions$$1(options);
    var defaultDecorator = getDefaultDecoratorFromObjectOptions$$1(options);
    initializeInstance$$1(target); // Fixes #1740
    asObservableObject$$1(target, options.name, defaultDecorator.enhancer); // make sure object is observable, even without initial props
    if (properties)
        extendObservableObjectWithProperties$$1(target, properties, decorators, defaultDecorator);
    return target;
}
function getDefaultDecoratorFromObjectOptions$$1(options) {
    return options.defaultDecorator || (options.deep === false ? refDecorator$$1 : deepDecorator$$1);
}
function extendObservableObjectWithProperties$$1(target, properties, decorators, defaultDecorator) {
    if (false) {
        invariant$$1(!isObservable$$1(properties), "Extending an object with another observable (object) is not supported. Please construct an explicit propertymap, using `toJS` if need. See issue #540");
        if (decorators)
            for (var key in decorators)
                if (!(key in properties))
                    fail$$1("Trying to declare a decorator for unspecified property '" + key + "'");
    }
    startBatch$$1();
    try {
        for (var key in properties) {
            var descriptor = Object.getOwnPropertyDescriptor(properties, key);
            if (false) {
                if (Object.getOwnPropertyDescriptor(target, key))
                    fail$$1("'extendObservable' can only be used to introduce new properties. Use 'set' or 'decorate' instead. The property '" + key + "' already exists on '" + target + "'");
                if (isComputed$$1(descriptor.value))
                    fail$$1("Passing a 'computed' as initial property value is no longer supported by extendObservable. Use a getter or decorator instead");
            }
            var decorator = decorators && key in decorators
                ? decorators[key]
                : descriptor.get
                    ? computedDecorator$$1
                    : defaultDecorator;
            if (false)
                fail$$1("Not a valid decorator for '" + key + "', got: " + decorator);
            var resultDescriptor = decorator(target, key, descriptor, true);
            if (resultDescriptor // otherwise, assume already applied, due to `applyToInstance`
            )
                Object.defineProperty(target, key, resultDescriptor);
        }
    }
    finally {
        endBatch$$1();
    }
}

function getDependencyTree$$1(thing, property) {
    return nodeToDependencyTree(getAtom$$1(thing, property));
}
function nodeToDependencyTree(node) {
    var result = {
        name: node.name
    };
    if (node.observing && node.observing.length > 0)
        result.dependencies = unique$$1(node.observing).map(nodeToDependencyTree);
    return result;
}
function getObserverTree$$1(thing, property) {
    return nodeToObserverTree(getAtom$$1(thing, property));
}
function nodeToObserverTree(node) {
    var result = {
        name: node.name
    };
    if (hasObservers$$1(node))
        result.observers = Array.from(getObservers$$1(node)).map(nodeToObserverTree);
    return result;
}

var generatorId = 0;
function flow$$1(generator) {
    if (arguments.length !== 1)
        fail$$1("production" && "Flow expects one 1 argument and cannot be used as decorator");
    var name = generator.name || "<unnamed flow>";
    // Implementation based on https://github.com/tj/co/blob/master/index.js
    return function () {
        var ctx = this;
        var args = arguments;
        var runId = ++generatorId;
        var gen = action$$1(name + " - runid: " + runId + " - init", generator).apply(ctx, args);
        var rejector;
        var pendingPromise = undefined;
        var promise = new Promise(function (resolve, reject) {
            var stepId = 0;
            rejector = reject;
            function onFulfilled(res) {
                pendingPromise = undefined;
                var ret;
                try {
                    ret = action$$1(name + " - runid: " + runId + " - yield " + stepId++, gen.next).call(gen, res);
                }
                catch (e) {
                    return reject(e);
                }
                next(ret);
            }
            function onRejected(err) {
                pendingPromise = undefined;
                var ret;
                try {
                    ret = action$$1(name + " - runid: " + runId + " - yield " + stepId++, gen.throw).call(gen, err);
                }
                catch (e) {
                    return reject(e);
                }
                next(ret);
            }
            function next(ret) {
                if (ret && typeof ret.then === "function") {
                    // an async iterator
                    ret.then(next, reject);
                    return;
                }
                if (ret.done)
                    return resolve(ret.value);
                pendingPromise = Promise.resolve(ret.value);
                return pendingPromise.then(onFulfilled, onRejected);
            }
            onFulfilled(undefined); // kick off the process
        });
        promise.cancel = action$$1(name + " - runid: " + runId + " - cancel", function () {
            try {
                if (pendingPromise)
                    cancelPromise(pendingPromise);
                // Finally block can return (or yield) stuff..
                var res = gen.return();
                // eat anything that promise would do, it's cancelled!
                var yieldedPromise = Promise.resolve(res.value);
                yieldedPromise.then(noop$$1, noop$$1);
                cancelPromise(yieldedPromise); // maybe it can be cancelled :)
                // reject our original promise
                rejector(new Error("FLOW_CANCELLED"));
            }
            catch (e) {
                rejector(e); // there could be a throwing finally block
            }
        });
        return promise;
    };
}
function cancelPromise(promise) {
    if (typeof promise.cancel === "function")
        promise.cancel();
}

function interceptReads$$1(thing, propOrHandler, handler) {
    var target;
    if (isObservableMap$$1(thing) || isObservableArray$$1(thing) || isObservableValue$$1(thing)) {
        target = getAdministration$$1(thing);
    }
    else if (isObservableObject$$1(thing)) {
        if (typeof propOrHandler !== "string")
            return fail$$1("production" !== "production" &&
                "InterceptReads can only be used with a specific property, not with an object in general");
        target = getAdministration$$1(thing, propOrHandler);
    }
    else {
        return fail$$1("production" !== "production" &&
            "Expected observable map, object or array as first array");
    }
    if (target.dehancer !== undefined)
        return fail$$1("production" !== "production" && "An intercept reader was already established");
    target.dehancer = typeof propOrHandler === "function" ? propOrHandler : handler;
    return function () {
        target.dehancer = undefined;
    };
}

function intercept$$1(thing, propOrHandler, handler) {
    if (typeof handler === "function")
        return interceptProperty(thing, propOrHandler, handler);
    else
        return interceptInterceptable(thing, propOrHandler);
}
function interceptInterceptable(thing, handler) {
    return getAdministration$$1(thing).intercept(handler);
}
function interceptProperty(thing, property, handler) {
    return getAdministration$$1(thing, property).intercept(handler);
}

function _isComputed$$1(value, property) {
    if (value === null || value === undefined)
        return false;
    if (property !== undefined) {
        if (isObservableObject$$1(value) === false)
            return false;
        if (!value[$mobx$$1].values.has(property))
            return false;
        var atom = getAtom$$1(value, property);
        return isComputedValue$$1(atom);
    }
    return isComputedValue$$1(value);
}
function isComputed$$1(value) {
    if (arguments.length > 1)
        return fail$$1("production" !== "production" &&
            "isComputed expects only 1 argument. Use isObservableProp to inspect the observability of a property");
    return _isComputed$$1(value);
}
function isComputedProp$$1(value, propName) {
    if (typeof propName !== "string")
        return fail$$1("production" !== "production" &&
            "isComputed expected a property name as second argument");
    return _isComputed$$1(value, propName);
}

function _isObservable(value, property) {
    if (value === null || value === undefined)
        return false;
    if (property !== undefined) {
        if (false)
            return fail$$1("isObservable(object, propertyName) is not supported for arrays and maps. Use map.has or array.length instead.");
        if (isObservableObject$$1(value)) {
            return value[$mobx$$1].values.has(property);
        }
        return false;
    }
    // For first check, see #701
    return (isObservableObject$$1(value) ||
        !!value[$mobx$$1] ||
        isAtom$$1(value) ||
        isReaction$$1(value) ||
        isComputedValue$$1(value));
}
function isObservable$$1(value) {
    if (arguments.length !== 1)
        fail$$1("production" !== "production" &&
            "isObservable expects only 1 argument. Use isObservableProp to inspect the observability of a property");
    return _isObservable(value);
}
function isObservableProp$$1(value, propName) {
    if (typeof propName !== "string")
        return fail$$1("production" !== "production" && "expected a property name as second argument");
    return _isObservable(value, propName);
}

function keys$$1(obj) {
    if (isObservableObject$$1(obj)) {
        return obj[$mobx$$1].getKeys();
    }
    if (isObservableMap$$1(obj)) {
        return Array.from(obj.keys());
    }
    if (isObservableSet$$1(obj)) {
        return Array.from(obj.keys());
    }
    if (isObservableArray$$1(obj)) {
        return obj.map(function (_, index) { return index; });
    }
    return fail$$1("production" !== "production" &&
        "'keys()' can only be used on observable objects, arrays, sets and maps");
}
function values$$1(obj) {
    if (isObservableObject$$1(obj)) {
        return keys$$1(obj).map(function (key) { return obj[key]; });
    }
    if (isObservableMap$$1(obj)) {
        return keys$$1(obj).map(function (key) { return obj.get(key); });
    }
    if (isObservableSet$$1(obj)) {
        return Array.from(obj.values());
    }
    if (isObservableArray$$1(obj)) {
        return obj.slice();
    }
    return fail$$1("production" !== "production" &&
        "'values()' can only be used on observable objects, arrays, sets and maps");
}
function entries$$1(obj) {
    if (isObservableObject$$1(obj)) {
        return keys$$1(obj).map(function (key) { return [key, obj[key]]; });
    }
    if (isObservableMap$$1(obj)) {
        return keys$$1(obj).map(function (key) { return [key, obj.get(key)]; });
    }
    if (isObservableSet$$1(obj)) {
        return Array.from(obj.entries());
    }
    if (isObservableArray$$1(obj)) {
        return obj.map(function (key, index) { return [index, key]; });
    }
    return fail$$1("production" !== "production" &&
        "'entries()' can only be used on observable objects, arrays and maps");
}
function set$$1(obj, key, value) {
    if (arguments.length === 2) {
        startBatch$$1();
        var values_1 = key;
        try {
            for (var key_1 in values_1)
                set$$1(obj, key_1, values_1[key_1]);
        }
        finally {
            endBatch$$1();
        }
        return;
    }
    if (isObservableObject$$1(obj)) {
        var adm = obj[$mobx$$1];
        var existingObservable = adm.values.get(key);
        if (existingObservable) {
            adm.write(key, value);
        }
        else {
            adm.addObservableProp(key, value, adm.defaultEnhancer);
        }
    }
    else if (isObservableMap$$1(obj)) {
        obj.set(key, value);
    }
    else if (isObservableArray$$1(obj)) {
        if (typeof key !== "number")
            key = parseInt(key, 10);
        invariant$$1(key >= 0, "Not a valid index: '" + key + "'");
        startBatch$$1();
        if (key >= obj.length)
            obj.length = key + 1;
        obj[key] = value;
        endBatch$$1();
    }
    else {
        return fail$$1("production" !== "production" &&
            "'set()' can only be used on observable objects, arrays and maps");
    }
}
function remove$$1(obj, key) {
    if (isObservableObject$$1(obj)) {
        
        obj[$mobx$$1].remove(key);
    }
    else if (isObservableMap$$1(obj)) {
        obj.delete(key);
    }
    else if (isObservableSet$$1(obj)) {
        obj.delete(key);
    }
    else if (isObservableArray$$1(obj)) {
        if (typeof key !== "number")
            key = parseInt(key, 10);
        invariant$$1(key >= 0, "Not a valid index: '" + key + "'");
        obj.splice(key, 1);
    }
    else {
        return fail$$1("production" !== "production" &&
            "'remove()' can only be used on observable objects, arrays and maps");
    }
}
function has$$1(obj, key) {
    if (isObservableObject$$1(obj)) {
        // return keys(obj).indexOf(key) >= 0
        var adm = getAdministration$$1(obj);
        return adm.has(key);
    }
    else if (isObservableMap$$1(obj)) {
        return obj.has(key);
    }
    else if (isObservableSet$$1(obj)) {
        return obj.has(key);
    }
    else if (isObservableArray$$1(obj)) {
        return key >= 0 && key < obj.length;
    }
    else {
        return fail$$1("production" !== "production" &&
            "'has()' can only be used on observable objects, arrays and maps");
    }
}
function get$$1(obj, key) {
    if (!has$$1(obj, key))
        return undefined;
    if (isObservableObject$$1(obj)) {
        return obj[key];
    }
    else if (isObservableMap$$1(obj)) {
        return obj.get(key);
    }
    else if (isObservableArray$$1(obj)) {
        return obj[key];
    }
    else {
        return fail$$1("production" !== "production" &&
            "'get()' can only be used on observable objects, arrays and maps");
    }
}

function observe$$1(thing, propOrCb, cbOrFire, fireImmediately) {
    if (typeof cbOrFire === "function")
        return observeObservableProperty(thing, propOrCb, cbOrFire, fireImmediately);
    else
        return observeObservable(thing, propOrCb, cbOrFire);
}
function observeObservable(thing, listener, fireImmediately) {
    return getAdministration$$1(thing).observe(listener, fireImmediately);
}
function observeObservableProperty(thing, property, listener, fireImmediately) {
    return getAdministration$$1(thing, property).observe(listener, fireImmediately);
}

var defaultOptions = {
    detectCycles: true,
    exportMapsAsObjects: true,
    recurseEverything: false
};
function cache(map, key, value, options) {
    if (options.detectCycles)
        map.set(key, value);
    return value;
}
function toJSHelper(source, options, __alreadySeen) {
    if (!options.recurseEverything && !isObservable$$1(source))
        return source;
    if (typeof source !== "object")
        return source;
    // Directly return null if source is null
    if (source === null)
        return null;
    // Directly return the Date object itself if contained in the observable
    if (source instanceof Date)
        return source;
    if (isObservableValue$$1(source))
        return toJSHelper(source.get(), options, __alreadySeen);
    // make sure we track the keys of the object
    if (isObservable$$1(source))
        keys$$1(source);
    var detectCycles = options.detectCycles === true;
    if (detectCycles && source !== null && __alreadySeen.has(source)) {
        return __alreadySeen.get(source);
    }
    if (isObservableArray$$1(source) || Array.isArray(source)) {
        var res_1 = cache(__alreadySeen, source, [], options);
        var toAdd = source.map(function (value) { return toJSHelper(value, options, __alreadySeen); });
        res_1.length = toAdd.length;
        for (var i = 0, l = toAdd.length; i < l; i++)
            res_1[i] = toAdd[i];
        return res_1;
    }
    if (isObservableSet$$1(source) || Object.getPrototypeOf(source) === Set.prototype) {
        if (options.exportMapsAsObjects === false) {
            var res_2 = cache(__alreadySeen, source, new Set(), options);
            source.forEach(function (value) {
                res_2.add(toJSHelper(value, options, __alreadySeen));
            });
            return res_2;
        }
        else {
            var res_3 = cache(__alreadySeen, source, [], options);
            source.forEach(function (value) {
                res_3.push(toJSHelper(value, options, __alreadySeen));
            });
            return res_3;
        }
    }
    if (isObservableMap$$1(source) || Object.getPrototypeOf(source) === Map.prototype) {
        if (options.exportMapsAsObjects === false) {
            var res_4 = cache(__alreadySeen, source, new Map(), options);
            source.forEach(function (value, key) {
                res_4.set(key, toJSHelper(value, options, __alreadySeen));
            });
            return res_4;
        }
        else {
            var res_5 = cache(__alreadySeen, source, {}, options);
            source.forEach(function (value, key) {
                res_5[key] = toJSHelper(value, options, __alreadySeen);
            });
            return res_5;
        }
    }
    // Fallback to the situation that source is an ObservableObject or a plain object
    var res = cache(__alreadySeen, source, {}, options);
    for (var key in source) {
        res[key] = toJSHelper(source[key], options, __alreadySeen);
    }
    return res;
}
function toJS$$1(source, options) {
    // backward compatibility
    if (typeof options === "boolean")
        options = { detectCycles: options };
    if (!options)
        options = defaultOptions;
    options.detectCycles =
        options.detectCycles === undefined
            ? options.recurseEverything === true
            : options.detectCycles === true;
    var __alreadySeen;
    if (options.detectCycles)
        __alreadySeen = new Map();
    return toJSHelper(source, options, __alreadySeen);
}

function trace$$1() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    var enterBreakPoint = false;
    if (typeof args[args.length - 1] === "boolean")
        enterBreakPoint = args.pop();
    var derivation = getAtomFromArgs(args);
    if (!derivation) {
        return fail$$1("production" !== "production" &&
            "'trace(break?)' can only be used inside a tracked computed value or a Reaction. Consider passing in the computed value or reaction explicitly");
    }
    if (derivation.isTracing === TraceMode$$1.NONE) {
        console.log("[mobx.trace] '" + derivation.name + "' tracing enabled");
    }
    derivation.isTracing = enterBreakPoint ? TraceMode$$1.BREAK : TraceMode$$1.LOG;
}
function getAtomFromArgs(args) {
    switch (args.length) {
        case 0:
            return globalState$$1.trackingDerivation;
        case 1:
            return getAtom$$1(args[0]);
        case 2:
            return getAtom$$1(args[0], args[1]);
    }
}

/**
 * During a transaction no views are updated until the end of the transaction.
 * The transaction will be run synchronously nonetheless.
 *
 * @param action a function that updates some reactive state
 * @returns any value that was returned by the 'action' parameter.
 */
function transaction$$1(action$$1, thisArg) {
    if (thisArg === void 0) { thisArg = undefined; }
    startBatch$$1();
    try {
        return action$$1.apply(thisArg);
    }
    finally {
        endBatch$$1();
    }
}

function when$$1(predicate, arg1, arg2) {
    if (arguments.length === 1 || (arg1 && typeof arg1 === "object"))
        return whenPromise(predicate, arg1);
    return _when(predicate, arg1, arg2 || {});
}
function _when(predicate, effect, opts) {
    var timeoutHandle;
    if (typeof opts.timeout === "number") {
        timeoutHandle = setTimeout(function () {
            if (!disposer[$mobx$$1].isDisposed) {
                disposer();
                var error = new Error("WHEN_TIMEOUT");
                if (opts.onError)
                    opts.onError(error);
                else
                    throw error;
            }
        }, opts.timeout);
    }
    opts.name = opts.name || "When@" + getNextId$$1();
    var effectAction = createAction$$1(opts.name + "-effect", effect);
    var disposer = autorun$$1(function (r) {
        if (predicate()) {
            r.dispose();
            if (timeoutHandle)
                clearTimeout(timeoutHandle);
            effectAction();
        }
    }, opts);
    return disposer;
}
function whenPromise(predicate, opts) {
    if (false)
        return fail$$1("the options 'onError' and 'promise' cannot be combined");
    var cancel;
    var res = new Promise(function (resolve, reject) {
        var disposer = _when(predicate, resolve, __assign({}, opts, { onError: reject }));
        cancel = function () {
            disposer();
            reject("WHEN_CANCELLED");
        };
    });
    res.cancel = cancel;
    return res;
}

function getAdm(target) {
    return target[$mobx$$1];
}
// Optimization: we don't need the intermediate objects and could have a completely custom administration for DynamicObjects,
// and skip either the internal values map, or the base object with its property descriptors!
var objectProxyTraps = {
    has: function (target, name) {
        if (name === $mobx$$1 || name === "constructor" || name === mobxDidRunLazyInitializersSymbol$$1)
            return true;
        var adm = getAdm(target);
        // MWE: should `in` operator be reactive? If not, below code path will be faster / more memory efficient
        // TODO: check performance stats!
        // if (adm.values.get(name as string)) return true
        if (typeof name === "string")
            return adm.has(name);
        return name in target;
    },
    get: function (target, name) {
        if (name === $mobx$$1 || name === "constructor" || name === mobxDidRunLazyInitializersSymbol$$1)
            return target[name];
        var adm = getAdm(target);
        var observable$$1 = adm.values.get(name);
        if (observable$$1 instanceof Atom$$1) {
            var result = observable$$1.get();
            if (result === undefined) {
                // This fixes #1796, because deleting a prop that has an
                // undefined value won't retrigger a observer (no visible effect),
                // the autorun wouldn't subscribe to future key changes (see also next comment)
                adm.has(name);
            }
            return result;
        }
        // make sure we start listening to future keys
        // note that we only do this here for optimization
        if (typeof name === "string")
            adm.has(name);
        return target[name];
    },
    set: function (target, name, value) {
        if (typeof name !== "string")
            return false;
        set$$1(target, name, value);
        return true;
    },
    deleteProperty: function (target, name) {
        if (typeof name !== "string")
            return false;
        var adm = getAdm(target);
        adm.remove(name);
        return true;
    },
    ownKeys: function (target) {
        var adm = getAdm(target);
        adm.keysAtom.reportObserved();
        return Reflect.ownKeys(target);
    },
    preventExtensions: function (target) {
        fail$$1("Dynamic observable objects cannot be frozen");
        return false;
    }
};
function createDynamicObservableObject$$1(base) {
    var proxy = new Proxy(base, objectProxyTraps);
    base[$mobx$$1].proxy = proxy;
    return proxy;
}

function hasInterceptors$$1(interceptable) {
    return interceptable.interceptors !== undefined && interceptable.interceptors.length > 0;
}
function registerInterceptor$$1(interceptable, handler) {
    var interceptors = interceptable.interceptors || (interceptable.interceptors = []);
    interceptors.push(handler);
    return once$$1(function () {
        var idx = interceptors.indexOf(handler);
        if (idx !== -1)
            interceptors.splice(idx, 1);
    });
}
function interceptChange$$1(interceptable, change) {
    var prevU = untrackedStart$$1();
    try {
        var interceptors = interceptable.interceptors;
        if (interceptors)
            for (var i = 0, l = interceptors.length; i < l; i++) {
                change = interceptors[i](change);
                invariant$$1(!change || change.type, "Intercept handlers should return nothing or a change object");
                if (!change)
                    break;
            }
        return change;
    }
    finally {
        untrackedEnd$$1(prevU);
    }
}

function hasListeners$$1(listenable) {
    return listenable.changeListeners !== undefined && listenable.changeListeners.length > 0;
}
function registerListener$$1(listenable, handler) {
    var listeners = listenable.changeListeners || (listenable.changeListeners = []);
    listeners.push(handler);
    return once$$1(function () {
        var idx = listeners.indexOf(handler);
        if (idx !== -1)
            listeners.splice(idx, 1);
    });
}
function notifyListeners$$1(listenable, change) {
    var prevU = untrackedStart$$1();
    var listeners = listenable.changeListeners;
    if (!listeners)
        return;
    listeners = listeners.slice();
    for (var i = 0, l = listeners.length; i < l; i++) {
        listeners[i](change);
    }
    untrackedEnd$$1(prevU);
}

var MAX_SPLICE_SIZE = 10000; // See e.g. https://github.com/mobxjs/mobx/issues/859
var arrayTraps = {
    get: function (target, name) {
        if (name === $mobx$$1)
            return target[$mobx$$1];
        if (name === "length")
            return target[$mobx$$1].getArrayLength();
        if (typeof name === "number") {
            return arrayExtensions.get.call(target, name);
        }
        if (typeof name === "string" && !isNaN(name)) {
            return arrayExtensions.get.call(target, parseInt(name));
        }
        if (arrayExtensions.hasOwnProperty(name)) {
            return arrayExtensions[name];
        }
        return target[name];
    },
    set: function (target, name, value) {
        if (name === "length") {
            target[$mobx$$1].setArrayLength(value);
            return true;
        }
        if (typeof name === "number") {
            arrayExtensions.set.call(target, name, value);
            return true;
        }
        if (!isNaN(name)) {
            arrayExtensions.set.call(target, parseInt(name), value);
            return true;
        }
        return false;
    },
    preventExtensions: function (target) {
        fail$$1("Observable arrays cannot be frozen");
        return false;
    }
};
function createObservableArray$$1(initialValues, enhancer, name, owned) {
    if (name === void 0) { name = "ObservableArray@" + getNextId$$1(); }
    if (owned === void 0) { owned = false; }
    var adm = new ObservableArrayAdministration(name, enhancer, owned);
    addHiddenFinalProp$$1(adm.values, $mobx$$1, adm);
    var proxy = new Proxy(adm.values, arrayTraps);
    adm.proxy = proxy;
    if (initialValues && initialValues.length) {
        var prev = allowStateChangesStart$$1(true);
        adm.spliceWithArray(0, 0, initialValues);
        allowStateChangesEnd$$1(prev);
    }
    return proxy;
}
var ObservableArrayAdministration = /** @class */ (function () {
    function ObservableArrayAdministration(name, enhancer, owned) {
        this.owned = owned;
        this.values = [];
        this.proxy = undefined;
        this.lastKnownLength = 0;
        this.atom = new Atom$$1(name || "ObservableArray@" + getNextId$$1());
        this.enhancer = function (newV, oldV) { return enhancer(newV, oldV, name + "[..]"); };
    }
    ObservableArrayAdministration.prototype.dehanceValue = function (value) {
        if (this.dehancer !== undefined)
            return this.dehancer(value);
        return value;
    };
    ObservableArrayAdministration.prototype.dehanceValues = function (values$$1) {
        if (this.dehancer !== undefined && values$$1.length > 0)
            return values$$1.map(this.dehancer);
        return values$$1;
    };
    ObservableArrayAdministration.prototype.intercept = function (handler) {
        return registerInterceptor$$1(this, handler);
    };
    ObservableArrayAdministration.prototype.observe = function (listener, fireImmediately) {
        if (fireImmediately === void 0) { fireImmediately = false; }
        if (fireImmediately) {
            listener({
                object: this.proxy,
                type: "splice",
                index: 0,
                added: this.values.slice(),
                addedCount: this.values.length,
                removed: [],
                removedCount: 0
            });
        }
        return registerListener$$1(this, listener);
    };
    ObservableArrayAdministration.prototype.getArrayLength = function () {
        this.atom.reportObserved();
        return this.values.length;
    };
    ObservableArrayAdministration.prototype.setArrayLength = function (newLength) {
        if (typeof newLength !== "number" || newLength < 0)
            throw new Error("[mobx.array] Out of range: " + newLength);
        var currentLength = this.values.length;
        if (newLength === currentLength)
            return;
        else if (newLength > currentLength) {
            var newItems = new Array(newLength - currentLength);
            for (var i = 0; i < newLength - currentLength; i++)
                newItems[i] = undefined; // No Array.fill everywhere...
            this.spliceWithArray(currentLength, 0, newItems);
        }
        else
            this.spliceWithArray(newLength, currentLength - newLength);
    };
    ObservableArrayAdministration.prototype.updateArrayLength = function (oldLength, delta) {
        if (oldLength !== this.lastKnownLength)
            throw new Error("[mobx] Modification exception: the internal structure of an observable array was changed.");
        this.lastKnownLength += delta;
    };
    ObservableArrayAdministration.prototype.spliceWithArray = function (index, deleteCount, newItems) {
        var _this = this;
        checkIfStateModificationsAreAllowed$$1(this.atom);
        var length = this.values.length;
        if (index === undefined)
            index = 0;
        else if (index > length)
            index = length;
        else if (index < 0)
            index = Math.max(0, length + index);
        if (arguments.length === 1)
            deleteCount = length - index;
        else if (deleteCount === undefined || deleteCount === null)
            deleteCount = 0;
        else
            deleteCount = Math.max(0, Math.min(deleteCount, length - index));
        if (newItems === undefined)
            newItems = EMPTY_ARRAY$$1;
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                object: this.proxy,
                type: "splice",
                index: index,
                removedCount: deleteCount,
                added: newItems
            });
            if (!change)
                return EMPTY_ARRAY$$1;
            deleteCount = change.removedCount;
            newItems = change.added;
        }
        newItems = newItems.length === 0 ? newItems : newItems.map(function (v) { return _this.enhancer(v, undefined); });
        if (false) {
            var lengthDelta = newItems.length - deleteCount;
            this.updateArrayLength(length, lengthDelta); // checks if internal array wasn't modified
        }
        var res = this.spliceItemsIntoValues(index, deleteCount, newItems);
        if (deleteCount !== 0 || newItems.length !== 0)
            this.notifyArraySplice(index, newItems, res);
        return this.dehanceValues(res);
    };
    ObservableArrayAdministration.prototype.spliceItemsIntoValues = function (index, deleteCount, newItems) {
        var _a;
        if (newItems.length < MAX_SPLICE_SIZE) {
            return (_a = this.values).splice.apply(_a, __spread([index, deleteCount], newItems));
        }
        else {
            var res = this.values.slice(index, index + deleteCount);
            this.values = this.values
                .slice(0, index)
                .concat(newItems, this.values.slice(index + deleteCount));
            return res;
        }
    };
    ObservableArrayAdministration.prototype.notifyArrayChildUpdate = function (index, newValue, oldValue) {
        var notifySpy = !this.owned && isSpyEnabled$$1();
        var notify = hasListeners$$1(this);
        var change = notify || notifySpy
            ? {
                object: this.proxy,
                type: "update",
                index: index,
                newValue: newValue,
                oldValue: oldValue
            }
            : null;
        // The reason why this is on right hand side here (and not above), is this way the uglifier will drop it, but it won't
        // cause any runtime overhead in development mode without NODE_ENV set, unless spying is enabled
        if (notifySpy && "production" !== "production")
            spyReportStart$$1(__assign({}, change, { name: this.atom.name }));
        this.atom.reportChanged();
        if (notify)
            notifyListeners$$1(this, change);
        if (notifySpy && "production" !== "production")
            spyReportEnd$$1();
    };
    ObservableArrayAdministration.prototype.notifyArraySplice = function (index, added, removed) {
        var notifySpy = !this.owned && isSpyEnabled$$1();
        var notify = hasListeners$$1(this);
        var change = notify || notifySpy
            ? {
                object: this.proxy,
                type: "splice",
                index: index,
                removed: removed,
                added: added,
                removedCount: removed.length,
                addedCount: added.length
            }
            : null;
        if (notifySpy && "production" !== "production")
            spyReportStart$$1(__assign({}, change, { name: this.atom.name }));
        this.atom.reportChanged();
        // conform: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Array/observe
        if (notify)
            notifyListeners$$1(this, change);
        if (notifySpy && "production" !== "production")
            spyReportEnd$$1();
    };
    return ObservableArrayAdministration;
}());
var arrayExtensions = {
    intercept: function (handler) {
        return this[$mobx$$1].intercept(handler);
    },
    observe: function (listener, fireImmediately) {
        if (fireImmediately === void 0) { fireImmediately = false; }
        var adm = this[$mobx$$1];
        return adm.observe(listener, fireImmediately);
    },
    clear: function () {
        return this.splice(0);
    },
    replace: function (newItems) {
        var adm = this[$mobx$$1];
        return adm.spliceWithArray(0, adm.values.length, newItems);
    },
    /**
     * Converts this array back to a (shallow) javascript structure.
     * For a deep clone use mobx.toJS
     */
    toJS: function () {
        return this.slice();
    },
    toJSON: function () {
        // Used by JSON.stringify
        return this.toJS();
    },
    /*
     * functions that do alter the internal structure of the array, (based on lib.es6.d.ts)
     * since these functions alter the inner structure of the array, the have side effects.
     * Because the have side effects, they should not be used in computed function,
     * and for that reason the do not call dependencyState.notifyObserved
     */
    splice: function (index, deleteCount) {
        var newItems = [];
        for (var _i = 2; _i < arguments.length; _i++) {
            newItems[_i - 2] = arguments[_i];
        }
        var adm = this[$mobx$$1];
        switch (arguments.length) {
            case 0:
                return [];
            case 1:
                return adm.spliceWithArray(index);
            case 2:
                return adm.spliceWithArray(index, deleteCount);
        }
        return adm.spliceWithArray(index, deleteCount, newItems);
    },
    spliceWithArray: function (index, deleteCount, newItems) {
        var adm = this[$mobx$$1];
        return adm.spliceWithArray(index, deleteCount, newItems);
    },
    push: function () {
        var items = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            items[_i] = arguments[_i];
        }
        var adm = this[$mobx$$1];
        adm.spliceWithArray(adm.values.length, 0, items);
        return adm.values.length;
    },
    pop: function () {
        return this.splice(Math.max(this[$mobx$$1].values.length - 1, 0), 1)[0];
    },
    shift: function () {
        return this.splice(0, 1)[0];
    },
    unshift: function () {
        var items = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            items[_i] = arguments[_i];
        }
        var adm = this[$mobx$$1];
        adm.spliceWithArray(0, 0, items);
        return adm.values.length;
    },
    reverse: function () {
        // reverse by default mutates in place before returning the result
        // which makes it both a 'derivation' and a 'mutation'.
        // so we deviate from the default and just make it an dervitation
        if (false) {
            console.warn("[mobx] `observableArray.reverse()` will not update the array in place. Use `observableArray.slice().reverse()` to supress this warning and perform the operation on a copy, or `observableArray.replace(observableArray.slice().reverse())` to reverse & update in place");
        }
        var clone = this.slice();
        return clone.reverse.apply(clone, arguments);
    },
    sort: function (compareFn) {
        // sort by default mutates in place before returning the result
        // which goes against all good practices. Let's not change the array in place!
        if (false) {
            console.warn("[mobx] `observableArray.sort()` will not update the array in place. Use `observableArray.slice().sort()` to supress this warning and perform the operation on a copy, or `observableArray.replace(observableArray.slice().sort())` to sort & update in place");
        }
        var clone = this.slice();
        return clone.sort.apply(clone, arguments);
    },
    remove: function (value) {
        var adm = this[$mobx$$1];
        var idx = adm.dehanceValues(adm.values).indexOf(value);
        if (idx > -1) {
            this.splice(idx, 1);
            return true;
        }
        return false;
    },
    get: function (index) {
        var adm = this[$mobx$$1];
        if (adm) {
            if (index < adm.values.length) {
                adm.atom.reportObserved();
                return adm.dehanceValue(adm.values[index]);
            }
            console.warn("[mobx.array] Attempt to read an array index (" + index + ") that is out of bounds (" + adm.values.length + "). Please check length first. Out of bound indices will not be tracked by MobX");
        }
        return undefined;
    },
    set: function (index, newValue) {
        var adm = this[$mobx$$1];
        var values$$1 = adm.values;
        if (index < values$$1.length) {
            // update at index in range
            checkIfStateModificationsAreAllowed$$1(adm.atom);
            var oldValue = values$$1[index];
            if (hasInterceptors$$1(adm)) {
                var change = interceptChange$$1(adm, {
                    type: "update",
                    object: this,
                    index: index,
                    newValue: newValue
                });
                if (!change)
                    return;
                newValue = change.newValue;
            }
            newValue = adm.enhancer(newValue, oldValue);
            var changed = newValue !== oldValue;
            if (changed) {
                values$$1[index] = newValue;
                adm.notifyArrayChildUpdate(index, newValue, oldValue);
            }
        }
        else if (index === values$$1.length) {
            // add a new item
            adm.spliceWithArray(index, 0, [newValue]);
        }
        else {
            // out of bounds
            throw new Error("[mobx.array] Index out of bounds, " + index + " is larger than " + values$$1.length);
        }
    }
};
[
    "concat",
    "every",
    "filter",
    "forEach",
    "indexOf",
    "join",
    "lastIndexOf",
    "map",
    "reduce",
    "reduceRight",
    "slice",
    "some",
    "toString",
    "toLocaleString"
].forEach(function (funcName) {
    arrayExtensions[funcName] = function () {
        var adm = this[$mobx$$1];
        adm.atom.reportObserved();
        var res = adm.dehanceValues(adm.values);
        return res[funcName].apply(res, arguments);
    };
});
var isObservableArrayAdministration = createInstanceofPredicate$$1("ObservableArrayAdministration", ObservableArrayAdministration);
function isObservableArray$$1(thing) {
    return isObject$$1(thing) && isObservableArrayAdministration(thing[$mobx$$1]);
}

var _a;
var ObservableMapMarker = {};
// just extend Map? See also https://gist.github.com/nestharus/13b4d74f2ef4a2f4357dbd3fc23c1e54
// But: https://github.com/mobxjs/mobx/issues/1556
var ObservableMap$$1 = /** @class */ (function () {
    function ObservableMap$$1(initialData, enhancer, name) {
        if (enhancer === void 0) { enhancer = deepEnhancer$$1; }
        if (name === void 0) { name = "ObservableMap@" + getNextId$$1(); }
        this.enhancer = enhancer;
        this.name = name;
        this[_a] = ObservableMapMarker;
        this._keysAtom = createAtom$$1(this.name + ".keys()");
        this[Symbol.toStringTag] = "Map";
        if (typeof Map !== "function") {
            throw new Error("mobx.map requires Map polyfill for the current browser. Check babel-polyfill or core-js/es6/map.js");
        }
        this._data = new Map();
        this._hasMap = new Map();
        this.merge(initialData);
    }
    ObservableMap$$1.prototype._has = function (key) {
        return this._data.has(key);
    };
    ObservableMap$$1.prototype.has = function (key) {
        if (this._hasMap.has(key))
            return this._hasMap.get(key).get();
        return this._updateHasMapEntry(key, false).get();
    };
    ObservableMap$$1.prototype.set = function (key, value) {
        var hasKey = this._has(key);
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                type: hasKey ? "update" : "add",
                object: this,
                newValue: value,
                name: key
            });
            if (!change)
                return this;
            value = change.newValue;
        }
        if (hasKey) {
            this._updateValue(key, value);
        }
        else {
            this._addValue(key, value);
        }
        return this;
    };
    ObservableMap$$1.prototype.delete = function (key) {
        var _this = this;
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                type: "delete",
                object: this,
                name: key
            });
            if (!change)
                return false;
        }
        if (this._has(key)) {
            var notifySpy = isSpyEnabled$$1();
            var notify = hasListeners$$1(this);
            var change = notify || notifySpy
                ? {
                    type: "delete",
                    object: this,
                    oldValue: this._data.get(key).value,
                    name: key
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
            transaction$$1(function () {
                _this._keysAtom.reportChanged();
                _this._updateHasMapEntry(key, false);
                var observable$$1 = _this._data.get(key);
                observable$$1.setNewValue(undefined);
                _this._data.delete(key);
            });
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
            return true;
        }
        return false;
    };
    ObservableMap$$1.prototype._updateHasMapEntry = function (key, value) {
        // optimization; don't fill the hasMap if we are not observing, or remove entry if there are no observers anymore
        var entry = this._hasMap.get(key);
        if (entry) {
            entry.setNewValue(value);
        }
        else {
            entry = new ObservableValue$$1(value, referenceEnhancer$$1, this.name + "." + stringifyKey(key) + "?", false);
            this._hasMap.set(key, entry);
        }
        return entry;
    };
    ObservableMap$$1.prototype._updateValue = function (key, newValue) {
        var observable$$1 = this._data.get(key);
        newValue = observable$$1.prepareNewValue(newValue);
        if (newValue !== globalState$$1.UNCHANGED) {
            var notifySpy = isSpyEnabled$$1();
            var notify = hasListeners$$1(this);
            var change = notify || notifySpy
                ? {
                    type: "update",
                    object: this,
                    oldValue: observable$$1.value,
                    name: key,
                    newValue: newValue
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
            observable$$1.setNewValue(newValue);
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
        }
    };
    ObservableMap$$1.prototype._addValue = function (key, newValue) {
        var _this = this;
        checkIfStateModificationsAreAllowed$$1(this._keysAtom);
        transaction$$1(function () {
            var observable$$1 = new ObservableValue$$1(newValue, _this.enhancer, _this.name + "." + stringifyKey(key), false);
            _this._data.set(key, observable$$1);
            newValue = observable$$1.value; // value might have been changed
            _this._updateHasMapEntry(key, true);
            _this._keysAtom.reportChanged();
        });
        var notifySpy = isSpyEnabled$$1();
        var notify = hasListeners$$1(this);
        var change = notify || notifySpy
            ? {
                type: "add",
                object: this,
                name: key,
                newValue: newValue
            }
            : null;
        if (notifySpy && "production" !== "production")
            spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
        if (notify)
            notifyListeners$$1(this, change);
        if (notifySpy && "production" !== "production")
            spyReportEnd$$1();
    };
    ObservableMap$$1.prototype.get = function (key) {
        if (this.has(key))
            return this.dehanceValue(this._data.get(key).get());
        return this.dehanceValue(undefined);
    };
    ObservableMap$$1.prototype.dehanceValue = function (value) {
        if (this.dehancer !== undefined) {
            return this.dehancer(value);
        }
        return value;
    };
    ObservableMap$$1.prototype.keys = function () {
        this._keysAtom.reportObserved();
        return this._data.keys();
    };
    ObservableMap$$1.prototype.values = function () {
        var self = this;
        var nextIndex = 0;
        var keys$$1 = Array.from(this.keys());
        return makeIterable({
            next: function () {
                return nextIndex < keys$$1.length
                    ? { value: self.get(keys$$1[nextIndex++]), done: false }
                    : { done: true };
            }
        });
    };
    ObservableMap$$1.prototype.entries = function () {
        var self = this;
        var nextIndex = 0;
        var keys$$1 = Array.from(this.keys());
        return makeIterable({
            next: function () {
                if (nextIndex < keys$$1.length) {
                    var key = keys$$1[nextIndex++];
                    return {
                        value: [key, self.get(key)],
                        done: false
                    };
                }
                return { done: true };
            }
        });
    };
    ObservableMap$$1.prototype[(_a = $mobx$$1, Symbol.iterator)] = function () {
        return this.entries();
    };
    ObservableMap$$1.prototype.forEach = function (callback, thisArg) {
        var e_1, _a;
        try {
            for (var _b = __values(this), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = __read(_c.value, 2), key = _d[0], value = _d[1];
                callback.call(thisArg, value, key, this);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
    };
    /** Merge another object into this object, returns this. */
    ObservableMap$$1.prototype.merge = function (other) {
        var _this = this;
        if (isObservableMap$$1(other)) {
            other = other.toJS();
        }
        transaction$$1(function () {
            if (isPlainObject$$1(other))
                Object.keys(other).forEach(function (key) { return _this.set(key, other[key]); });
            else if (Array.isArray(other))
                other.forEach(function (_a) {
                    var _b = __read(_a, 2), key = _b[0], value = _b[1];
                    return _this.set(key, value);
                });
            else if (isES6Map$$1(other)) {
                if (other.constructor !== Map)
                    fail$$1("Cannot initialize from classes that inherit from Map: " + other.constructor.name); // prettier-ignore
                other.forEach(function (value, key) { return _this.set(key, value); });
            }
            else if (other !== null && other !== undefined)
                fail$$1("Cannot initialize map from " + other);
        });
        return this;
    };
    ObservableMap$$1.prototype.clear = function () {
        var _this = this;
        transaction$$1(function () {
            untracked$$1(function () {
                var e_2, _a;
                try {
                    for (var _b = __values(_this.keys()), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var key = _c.value;
                        _this.delete(key);
                    }
                }
                catch (e_2_1) { e_2 = { error: e_2_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_2) throw e_2.error; }
                }
            });
        });
    };
    ObservableMap$$1.prototype.replace = function (values$$1) {
        var _this = this;
        transaction$$1(function () {
            // grab all the keys that are present in the new map but not present in the current map
            // and delete them from the map, then merge the new map
            // this will cause reactions only on changed values
            var newKeys = getMapLikeKeys$$1(values$$1);
            var oldKeys = Array.from(_this.keys());
            var missingKeys = oldKeys.filter(function (k) { return newKeys.indexOf(k) === -1; });
            missingKeys.forEach(function (k) { return _this.delete(k); });
            _this.merge(values$$1);
        });
        return this;
    };
    Object.defineProperty(ObservableMap$$1.prototype, "size", {
        get: function () {
            this._keysAtom.reportObserved();
            return this._data.size;
        },
        enumerable: true,
        configurable: true
    });
    /**
     * Returns a plain object that represents this map.
     * Note that all the keys being stringified.
     * If there are duplicating keys after converting them to strings, behaviour is undetermined.
     */
    ObservableMap$$1.prototype.toPOJO = function () {
        var e_3, _a;
        var res = {};
        try {
            for (var _b = __values(this), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = __read(_c.value, 2), key = _d[0], value = _d[1];
                // We lie about symbol key types due to https://github.com/Microsoft/TypeScript/issues/1863
                res[typeof key === "symbol" ? key : stringifyKey(key)] = value;
            }
        }
        catch (e_3_1) { e_3 = { error: e_3_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_3) throw e_3.error; }
        }
        return res;
    };
    /**
     * Returns a shallow non observable object clone of this map.
     * Note that the values migth still be observable. For a deep clone use mobx.toJS.
     */
    ObservableMap$$1.prototype.toJS = function () {
        return new Map(this);
    };
    ObservableMap$$1.prototype.toJSON = function () {
        // Used by JSON.stringify
        return this.toPOJO();
    };
    ObservableMap$$1.prototype.toString = function () {
        var _this = this;
        return (this.name +
            "[{ " +
            Array.from(this.keys())
                .map(function (key) { return stringifyKey(key) + ": " + ("" + _this.get(key)); })
                .join(", ") +
            " }]");
    };
    /**
     * Observes this object. Triggers for the events 'add', 'update' and 'delete'.
     * See: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe
     * for callback details
     */
    ObservableMap$$1.prototype.observe = function (listener, fireImmediately) {
        "production" !== "production" &&
            invariant$$1(fireImmediately !== true, "`observe` doesn't support fireImmediately=true in combination with maps.");
        return registerListener$$1(this, listener);
    };
    ObservableMap$$1.prototype.intercept = function (handler) {
        return registerInterceptor$$1(this, handler);
    };
    return ObservableMap$$1;
}());
function stringifyKey(key) {
    if (key && key.toString)
        return key.toString();
    else
        return new String(key).toString();
}
/* 'var' fixes small-build issue */
var isObservableMap$$1 = createInstanceofPredicate$$1("ObservableMap", ObservableMap$$1);

var _a$1;
var ObservableSetMarker = {};
var ObservableSet$$1 = /** @class */ (function () {
    function ObservableSet$$1(initialData, enhancer, name) {
        if (enhancer === void 0) { enhancer = deepEnhancer$$1; }
        if (name === void 0) { name = "ObservableSet@" + getNextId$$1(); }
        this.name = name;
        this[_a$1] = ObservableSetMarker;
        this._data = new Set();
        this._atom = createAtom$$1(this.name);
        this[Symbol.toStringTag] = "Set";
        if (typeof Set !== "function") {
            throw new Error("mobx.set requires Set polyfill for the current browser. Check babel-polyfill or core-js/es6/set.js");
        }
        this.enhancer = function (newV, oldV) { return enhancer(newV, oldV, name); };
        if (initialData) {
            this.replace(initialData);
        }
    }
    ObservableSet$$1.prototype.dehanceValue = function (value) {
        if (this.dehancer !== undefined) {
            return this.dehancer(value);
        }
        return value;
    };
    ObservableSet$$1.prototype.clear = function () {
        var _this = this;
        transaction$$1(function () {
            untracked$$1(function () {
                var e_1, _a;
                try {
                    for (var _b = __values(_this._data.values()), _c = _b.next(); !_c.done; _c = _b.next()) {
                        var value = _c.value;
                        _this.delete(value);
                    }
                }
                catch (e_1_1) { e_1 = { error: e_1_1 }; }
                finally {
                    try {
                        if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
                    }
                    finally { if (e_1) throw e_1.error; }
                }
            });
        });
    };
    ObservableSet$$1.prototype.forEach = function (callbackFn, thisArg) {
        var e_2, _a;
        try {
            for (var _b = __values(this), _c = _b.next(); !_c.done; _c = _b.next()) {
                var value = _c.value;
                callbackFn.call(thisArg, value, value, this);
            }
        }
        catch (e_2_1) { e_2 = { error: e_2_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_2) throw e_2.error; }
        }
    };
    Object.defineProperty(ObservableSet$$1.prototype, "size", {
        get: function () {
            this._atom.reportObserved();
            return this._data.size;
        },
        enumerable: true,
        configurable: true
    });
    ObservableSet$$1.prototype.add = function (value) {
        var _this = this;
        checkIfStateModificationsAreAllowed$$1(this._atom);
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                type: "add",
                object: this,
                newValue: value
            });
            if (!change)
                return this;
            // TODO: ideally, value = change.value would be done here, so that values can be
            // changed by interceptor. Same applies for other Set and Map api's.
        }
        if (!this.has(value)) {
            transaction$$1(function () {
                _this._data.add(_this.enhancer(value, undefined));
                _this._atom.reportChanged();
            });
            var notifySpy = isSpyEnabled$$1();
            var notify = hasListeners$$1(this);
            var change = notify || notifySpy
                ? {
                    type: "add",
                    object: this,
                    newValue: value
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(change);
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
        }
        return this;
    };
    ObservableSet$$1.prototype.delete = function (value) {
        var _this = this;
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                type: "delete",
                object: this,
                oldValue: value
            });
            if (!change)
                return false;
        }
        if (this.has(value)) {
            var notifySpy = isSpyEnabled$$1();
            var notify = hasListeners$$1(this);
            var change = notify || notifySpy
                ? {
                    type: "delete",
                    object: this,
                    oldValue: value
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(__assign({}, change, { name: this.name }));
            transaction$$1(function () {
                _this._atom.reportChanged();
                _this._data.delete(value);
            });
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
            return true;
        }
        return false;
    };
    ObservableSet$$1.prototype.has = function (value) {
        this._atom.reportObserved();
        return this._data.has(this.dehanceValue(value));
    };
    ObservableSet$$1.prototype.entries = function () {
        var nextIndex = 0;
        var keys$$1 = Array.from(this.keys());
        var values$$1 = Array.from(this.values());
        return makeIterable({
            next: function () {
                var index = nextIndex;
                nextIndex += 1;
                return index < values$$1.length
                    ? { value: [keys$$1[index], values$$1[index]], done: false }
                    : { done: true };
            }
        });
    };
    ObservableSet$$1.prototype.keys = function () {
        return this.values();
    };
    ObservableSet$$1.prototype.values = function () {
        this._atom.reportObserved();
        var self = this;
        var nextIndex = 0;
        var observableValues = Array.from(this._data.values());
        return makeIterable({
            next: function () {
                return nextIndex < observableValues.length
                    ? { value: self.dehanceValue(observableValues[nextIndex++]), done: false }
                    : { done: true };
            }
        });
    };
    ObservableSet$$1.prototype.replace = function (other) {
        var _this = this;
        if (isObservableSet$$1(other)) {
            other = other.toJS();
        }
        transaction$$1(function () {
            if (Array.isArray(other)) {
                _this.clear();
                other.forEach(function (value) { return _this.add(value); });
            }
            else if (isES6Set$$1(other)) {
                _this.clear();
                other.forEach(function (value) { return _this.add(value); });
            }
            else if (other !== null && other !== undefined) {
                fail$$1("Cannot initialize set from " + other);
            }
        });
        return this;
    };
    ObservableSet$$1.prototype.observe = function (listener, fireImmediately) {
        // TODO 'fireImmediately' can be true?
        "production" !== "production" &&
            invariant$$1(fireImmediately !== true, "`observe` doesn't support fireImmediately=true in combination with sets.");
        return registerListener$$1(this, listener);
    };
    ObservableSet$$1.prototype.intercept = function (handler) {
        return registerInterceptor$$1(this, handler);
    };
    ObservableSet$$1.prototype.toJS = function () {
        return new Set(this);
    };
    ObservableSet$$1.prototype.toString = function () {
        return this.name + "[ " + Array.from(this).join(", ") + " ]";
    };
    ObservableSet$$1.prototype[(_a$1 = $mobx$$1, Symbol.iterator)] = function () {
        return this.values();
    };
    return ObservableSet$$1;
}());
var isObservableSet$$1 = createInstanceofPredicate$$1("ObservableSet", ObservableSet$$1);

var ObservableObjectAdministration$$1 = /** @class */ (function () {
    function ObservableObjectAdministration$$1(target, values$$1, name, defaultEnhancer) {
        if (values$$1 === void 0) { values$$1 = new Map(); }
        this.target = target;
        this.values = values$$1;
        this.name = name;
        this.defaultEnhancer = defaultEnhancer;
        this.keysAtom = new Atom$$1(name + ".keys");
    }
    ObservableObjectAdministration$$1.prototype.read = function (key) {
        return this.values.get(key).get();
    };
    ObservableObjectAdministration$$1.prototype.write = function (key, newValue) {
        var instance = this.target;
        var observable$$1 = this.values.get(key);
        if (observable$$1 instanceof ComputedValue$$1) {
            observable$$1.set(newValue);
            return;
        }
        // intercept
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                type: "update",
                object: this.proxy || instance,
                name: key,
                newValue: newValue
            });
            if (!change)
                return;
            newValue = change.newValue;
        }
        newValue = observable$$1.prepareNewValue(newValue);
        // notify spy & observers
        if (newValue !== globalState$$1.UNCHANGED) {
            var notify = hasListeners$$1(this);
            var notifySpy = isSpyEnabled$$1();
            var change = notify || notifySpy
                ? {
                    type: "update",
                    object: this.proxy || instance,
                    oldValue: observable$$1.value,
                    name: key,
                    newValue: newValue
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
            observable$$1.setNewValue(newValue);
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
        }
    };
    ObservableObjectAdministration$$1.prototype.has = function (key) {
        var map = this.pendingKeys || (this.pendingKeys = new Map());
        var entry = map.get(key);
        if (entry)
            return entry.get();
        else {
            var exists = !!this.values.get(key);
            // Possible optimization: Don't have a separate map for non existing keys,
            // but store them in the values map instead, using a special symbol to denote "not existing"
            entry = new ObservableValue$$1(exists, referenceEnhancer$$1, this.name + "." + key.toString() + "?", false);
            map.set(key, entry);
            return entry.get(); // read to subscribe
        }
    };
    ObservableObjectAdministration$$1.prototype.addObservableProp = function (propName, newValue, enhancer) {
        if (enhancer === void 0) { enhancer = this.defaultEnhancer; }
        var target = this.target;
        assertPropertyConfigurable$$1(target, propName);
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                object: this.proxy || target,
                name: propName,
                type: "add",
                newValue: newValue
            });
            if (!change)
                return;
            newValue = change.newValue;
        }
        var observable$$1 = new ObservableValue$$1(newValue, enhancer, this.name + "." + propName, false);
        this.values.set(propName, observable$$1);
        newValue = observable$$1.value; // observableValue might have changed it
        Object.defineProperty(target, propName, generateObservablePropConfig$$1(propName));
        this.notifyPropertyAddition(propName, newValue);
    };
    ObservableObjectAdministration$$1.prototype.addComputedProp = function (propertyOwner, // where is the property declared?
    propName, options) {
        var target = this.target;
        options.name = options.name || this.name + "." + propName;
        this.values.set(propName, new ComputedValue$$1(options));
        if (propertyOwner === target || isPropertyConfigurable$$1(propertyOwner, propName))
            Object.defineProperty(propertyOwner, propName, generateComputedPropConfig$$1(propName));
    };
    ObservableObjectAdministration$$1.prototype.remove = function (key) {
        if (!this.values.has(key))
            return;
        var target = this.target;
        if (hasInterceptors$$1(this)) {
            var change = interceptChange$$1(this, {
                object: this.proxy || target,
                name: key,
                type: "remove"
            });
            if (!change)
                return;
        }
        try {
            startBatch$$1();
            var notify = hasListeners$$1(this);
            var notifySpy = isSpyEnabled$$1();
            var oldObservable = this.values.get(key);
            var oldValue = oldObservable && oldObservable.get();
            oldObservable && oldObservable.set(undefined);
            // notify key and keyset listeners
            this.keysAtom.reportChanged();
            this.values.delete(key);
            if (this.pendingKeys) {
                var entry = this.pendingKeys.get(key);
                if (entry)
                    entry.set(false);
            }
            // delete the prop
            delete this.target[key];
            var change = notify || notifySpy
                ? {
                    type: "remove",
                    object: this.proxy || target,
                    oldValue: oldValue,
                    name: key
                }
                : null;
            if (notifySpy && "production" !== "production")
                spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
            if (notify)
                notifyListeners$$1(this, change);
            if (notifySpy && "production" !== "production")
                spyReportEnd$$1();
        }
        finally {
            endBatch$$1();
        }
    };
    ObservableObjectAdministration$$1.prototype.illegalAccess = function (owner, propName) {
        /**
         * This happens if a property is accessed through the prototype chain, but the property was
         * declared directly as own property on the prototype.
         *
         * E.g.:
         * class A {
         * }
         * extendObservable(A.prototype, { x: 1 })
         *
         * classB extens A {
         * }
         * console.log(new B().x)
         *
         * It is unclear whether the property should be considered 'static' or inherited.
         * Either use `console.log(A.x)`
         * or: decorate(A, { x: observable })
         *
         * When using decorate, the property will always be redeclared as own property on the actual instance
         */
        console.warn("Property '" + propName + "' of '" + owner + "' was accessed through the prototype chain. Use 'decorate' instead to declare the prop or access it statically through it's owner");
    };
    /**
     * Observes this object. Triggers for the events 'add', 'update' and 'delete'.
     * See: https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Object/observe
     * for callback details
     */
    ObservableObjectAdministration$$1.prototype.observe = function (callback, fireImmediately) {
        "production" !== "production" &&
            invariant$$1(fireImmediately !== true, "`observe` doesn't support the fire immediately property for observable objects.");
        return registerListener$$1(this, callback);
    };
    ObservableObjectAdministration$$1.prototype.intercept = function (handler) {
        return registerInterceptor$$1(this, handler);
    };
    ObservableObjectAdministration$$1.prototype.notifyPropertyAddition = function (key, newValue) {
        var notify = hasListeners$$1(this);
        var notifySpy = isSpyEnabled$$1();
        var change = notify || notifySpy
            ? {
                type: "add",
                object: this.proxy || this.target,
                name: key,
                newValue: newValue
            }
            : null;
        if (notifySpy && "production" !== "production")
            spyReportStart$$1(__assign({}, change, { name: this.name, key: key }));
        if (notify)
            notifyListeners$$1(this, change);
        if (notifySpy && "production" !== "production")
            spyReportEnd$$1();
        if (this.pendingKeys) {
            var entry = this.pendingKeys.get(key);
            if (entry)
                entry.set(true);
        }
        this.keysAtom.reportChanged();
    };
    ObservableObjectAdministration$$1.prototype.getKeys = function () {
        var e_1, _a;
        this.keysAtom.reportObserved();
        // return Reflect.ownKeys(this.values) as any
        var res = [];
        try {
            for (var _b = __values(this.values), _c = _b.next(); !_c.done; _c = _b.next()) {
                var _d = __read(_c.value, 2), key = _d[0], value = _d[1];
                if (value instanceof ObservableValue$$1)
                    res.push(key);
            }
        }
        catch (e_1_1) { e_1 = { error: e_1_1 }; }
        finally {
            try {
                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);
            }
            finally { if (e_1) throw e_1.error; }
        }
        return res;
    };
    return ObservableObjectAdministration$$1;
}());
function asObservableObject$$1(target, name, defaultEnhancer) {
    if (name === void 0) { name = ""; }
    if (defaultEnhancer === void 0) { defaultEnhancer = deepEnhancer$$1; }
    if (Object.prototype.hasOwnProperty.call(target, $mobx$$1))
        return target[$mobx$$1];
    "production" !== "production" &&
        invariant$$1(Object.isExtensible(target), "Cannot make the designated object observable; it is not extensible");
    if (!isPlainObject$$1(target))
        name = (target.constructor.name || "ObservableObject") + "@" + getNextId$$1();
    if (!name)
        name = "ObservableObject@" + getNextId$$1();
    var adm = new ObservableObjectAdministration$$1(target, new Map(), name, defaultEnhancer);
    addHiddenProp$$1(target, $mobx$$1, adm);
    return adm;
}
var observablePropertyConfigs = Object.create(null);
var computedPropertyConfigs = Object.create(null);
function generateObservablePropConfig$$1(propName) {
    return (observablePropertyConfigs[propName] ||
        (observablePropertyConfigs[propName] = {
            configurable: true,
            enumerable: true,
            get: function () {
                return this[$mobx$$1].read(propName);
            },
            set: function (v) {
                this[$mobx$$1].write(propName, v);
            }
        }));
}
function getAdministrationForComputedPropOwner(owner) {
    var adm = owner[$mobx$$1];
    if (!adm) {
        // because computed props are declared on proty,
        // the current instance might not have been initialized yet
        initializeInstance$$1(owner);
        return owner[$mobx$$1];
    }
    return adm;
}
function generateComputedPropConfig$$1(propName) {
    return (computedPropertyConfigs[propName] ||
        (computedPropertyConfigs[propName] = {
            configurable: false,
            enumerable: false,
            get: function () {
                return getAdministrationForComputedPropOwner(this).read(propName);
            },
            set: function (v) {
                getAdministrationForComputedPropOwner(this).write(propName, v);
            }
        }));
}
var isObservableObjectAdministration = createInstanceofPredicate$$1("ObservableObjectAdministration", ObservableObjectAdministration$$1);
function isObservableObject$$1(thing) {
    if (isObject$$1(thing)) {
        // Initializers run lazily when transpiling to babel, so make sure they are run...
        initializeInstance$$1(thing);
        return isObservableObjectAdministration(thing[$mobx$$1]);
    }
    return false;
}

function getAtom$$1(thing, property) {
    if (typeof thing === "object" && thing !== null) {
        if (isObservableArray$$1(thing)) {
            if (property !== undefined)
                fail$$1("production" !== "production" &&
                    "It is not possible to get index atoms from arrays");
            return thing[$mobx$$1].atom;
        }
        if (isObservableSet$$1(thing)) {
            return thing[$mobx$$1];
        }
        if (isObservableMap$$1(thing)) {
            var anyThing = thing;
            if (property === undefined)
                return anyThing._keysAtom;
            var observable$$1 = anyThing._data.get(property) || anyThing._hasMap.get(property);
            if (!observable$$1)
                fail$$1("production" !== "production" &&
                    "the entry '" + property + "' does not exist in the observable map '" + getDebugName$$1(thing) + "'");
            return observable$$1;
        }
        // Initializers run lazily when transpiling to babel, so make sure they are run...
        initializeInstance$$1(thing);
        if (property && !thing[$mobx$$1])
            thing[property]; // See #1072
        if (isObservableObject$$1(thing)) {
            if (!property)
                return fail$$1("production" !== "production" && "please specify a property");
            var observable$$1 = thing[$mobx$$1].values.get(property);
            if (!observable$$1)
                fail$$1("production" !== "production" &&
                    "no observable property '" + property + "' found on the observable object '" + getDebugName$$1(thing) + "'");
            return observable$$1;
        }
        if (isAtom$$1(thing) || isComputedValue$$1(thing) || isReaction$$1(thing)) {
            return thing;
        }
    }
    else if (typeof thing === "function") {
        if (isReaction$$1(thing[$mobx$$1])) {
            // disposer function
            return thing[$mobx$$1];
        }
    }
    return fail$$1("production" !== "production" && "Cannot obtain atom from " + thing);
}
function getAdministration$$1(thing, property) {
    if (!thing)
        fail$$1("Expecting some object");
    if (property !== undefined)
        return getAdministration$$1(getAtom$$1(thing, property));
    if (isAtom$$1(thing) || isComputedValue$$1(thing) || isReaction$$1(thing))
        return thing;
    if (isObservableMap$$1(thing) || isObservableSet$$1(thing))
        return thing;
    // Initializers run lazily when transpiling to babel, so make sure they are run...
    initializeInstance$$1(thing);
    if (thing[$mobx$$1])
        return thing[$mobx$$1];
    fail$$1("production" !== "production" && "Cannot obtain administration from " + thing);
}
function getDebugName$$1(thing, property) {
    var named;
    if (property !== undefined)
        named = getAtom$$1(thing, property);
    else if (isObservableObject$$1(thing) || isObservableMap$$1(thing) || isObservableSet$$1(thing))
        named = getAdministration$$1(thing);
    else
        named = getAtom$$1(thing); // valid for arrays as well
    return named.name;
}

var toString = Object.prototype.toString;
function deepEqual$$1(a, b) {
    return eq(a, b);
}
// Copied from https://github.com/jashkenas/underscore/blob/5c237a7c682fb68fd5378203f0bf22dce1624854/underscore.js#L1186-L1289
// Internal recursive comparison function for `isEqual`.
function eq(a, b, aStack, bStack) {
    // Identical objects are equal. `0 === -0`, but they aren't identical.
    // See the [Harmony `egal` proposal](http://wiki.ecmascript.org/doku.php?id=harmony:egal).
    if (a === b)
        return a !== 0 || 1 / a === 1 / b;
    // `null` or `undefined` only equal to itself (strict comparison).
    if (a == null || b == null)
        return false;
    // `NaN`s are equivalent, but non-reflexive.
    if (a !== a)
        return b !== b;
    // Exhaust primitive checks
    var type = typeof a;
    if (type !== "function" && type !== "object" && typeof b != "object")
        return false;
    return deepEq(a, b, aStack, bStack);
}
// Internal recursive comparison function for `isEqual`.
function deepEq(a, b, aStack, bStack) {
    // Unwrap any wrapped objects.
    a = unwrap(a);
    b = unwrap(b);
    // Compare `[[Class]]` names.
    var className = toString.call(a);
    if (className !== toString.call(b))
        return false;
    switch (className) {
        // Strings, numbers, regular expressions, dates, and booleans are compared by value.
        case "[object RegExp]":
        // RegExps are coerced to strings for comparison (Note: '' + /a/i === '/a/i')
        case "[object String]":
            // Primitives and their corresponding object wrappers are equivalent; thus, `"5"` is
            // equivalent to `new String("5")`.
            return "" + a === "" + b;
        case "[object Number]":
            // `NaN`s are equivalent, but non-reflexive.
            // Object(NaN) is equivalent to NaN.
            if (+a !== +a)
                return +b !== +b;
            // An `egal` comparison is performed for other numeric values.
            return +a === 0 ? 1 / +a === 1 / b : +a === +b;
        case "[object Date]":
        case "[object Boolean]":
            // Coerce dates and booleans to numeric primitive values. Dates are compared by their
            // millisecond representations. Note that invalid dates with millisecond representations
            // of `NaN` are not equivalent.
            return +a === +b;
        case "[object Symbol]":
            return (typeof Symbol !== "undefined" && Symbol.valueOf.call(a) === Symbol.valueOf.call(b));
    }
    var areArrays = className === "[object Array]";
    if (!areArrays) {
        if (typeof a != "object" || typeof b != "object")
            return false;
        // Objects with different constructors are not equivalent, but `Object`s or `Array`s
        // from different frames are.
        var aCtor = a.constructor, bCtor = b.constructor;
        if (aCtor !== bCtor &&
            !(typeof aCtor === "function" &&
                aCtor instanceof aCtor &&
                typeof bCtor === "function" &&
                bCtor instanceof bCtor) &&
            ("constructor" in a && "constructor" in b)) {
            return false;
        }
    }
    // Assume equality for cyclic structures. The algorithm for detecting cyclic
    // structures is adapted from ES 5.1 section 15.12.3, abstract operation `JO`.
    // Initializing stack of traversed objects.
    // It's done here since we only need them for objects and arrays comparison.
    aStack = aStack || [];
    bStack = bStack || [];
    var length = aStack.length;
    while (length--) {
        // Linear search. Performance is inversely proportional to the number of
        // unique nested structures.
        if (aStack[length] === a)
            return bStack[length] === b;
    }
    // Add the first object to the stack of traversed objects.
    aStack.push(a);
    bStack.push(b);
    // Recursively compare objects and arrays.
    if (areArrays) {
        // Compare array lengths to determine if a deep comparison is necessary.
        length = a.length;
        if (length !== b.length)
            return false;
        // Deep compare the contents, ignoring non-numeric properties.
        while (length--) {
            if (!eq(a[length], b[length], aStack, bStack))
                return false;
        }
    }
    else {
        // Deep compare objects.
        var keys$$1 = Object.keys(a);
        var key = void 0;
        length = keys$$1.length;
        // Ensure that both objects contain the same number of properties before comparing deep equality.
        if (Object.keys(b).length !== length)
            return false;
        while (length--) {
            // Deep compare each member
            key = keys$$1[length];
            if (!(has$1(b, key) && eq(a[key], b[key], aStack, bStack)))
                return false;
        }
    }
    // Remove the first object from the stack of traversed objects.
    aStack.pop();
    bStack.pop();
    return true;
}
function unwrap(a) {
    if (isObservableArray$$1(a))
        return a.slice();
    if (isES6Map$$1(a) || isObservableMap$$1(a))
        return Array.from(a.entries());
    if (isES6Set$$1(a) || isObservableSet$$1(a))
        return Array.from(a.entries());
    return a;
}
function has$1(a, key) {
    return Object.prototype.hasOwnProperty.call(a, key);
}

function makeIterable(iterator) {
    iterator[Symbol.iterator] = self;
    return iterator;
}
function self() {
    return this;
}

/*
The only reason for this file to exist is pure horror:
Without it rollup can make the bundling fail at any point in time; when it rolls up the files in the wrong order
it will cause undefined errors (for example because super classes or local variables not being hosted).
With this file that will still happen,
but at least in this file we can magically reorder the imports with trial and error until the build succeeds again.
*/

/**
 * (c) Michel Weststrate 2015 - 2018
 * MIT Licensed
 *
 * Welcome to the mobx sources! To get an global overview of how MobX internally works,
 * this is a good place to start:
 * https://medium.com/@mweststrate/becoming-fully-reactive-an-in-depth-explanation-of-mobservable-55995262a254#.xvbh6qd74
 *
 * Source folders:
 * ===============
 *
 * - api/     Most of the public static methods exposed by the module can be found here.
 * - core/    Implementation of the MobX algorithm; atoms, derivations, reactions, dependency trees, optimizations. Cool stuff can be found here.
 * - types/   All the magic that is need to have observable objects, arrays and values is in this folder. Including the modifiers like `asFlat`.
 * - utils/   Utility stuff.
 *
 */
if (typeof Proxy === "undefined" || typeof Symbol === "undefined") {
    throw new Error("[mobx] MobX 5+ requires Proxy and Symbol objects. If your environment doesn't support Symbol or Proxy objects, please downgrade to MobX 4. For React Native Android, consider upgrading JSCore.");
}
try {
    // define process.env if needed
    // if this is not a production build in the first place
    // (in which case the expression below would be substituted with 'production')
    "production";
}
catch (e) {
    var g = typeof window !== "undefined" ? window : global;
    if (typeof process === "undefined")
        g.process = {};
    g.process.env = {};
}

(function () {
    function testCodeMinification() { }
    if (testCodeMinification.name !== "testCodeMinification" &&
        "production" !== "production" &&
        Object({"NODE_ENV":"production"}).IGNORE_MOBX_MINIFY_WARNING !== "true") {
        console.warn(
        // Template literal(backtick) is used for fix issue with rollup-plugin-commonjs https://github.com/rollup/rollup-plugin-commonjs/issues/344
        "[mobx] you are running a minified build, but 'process.env.NODE_ENV' was not set to 'production' in your bundler. This results in an unnecessarily large and slow bundle");
    }
})();
// Devtools support
if (typeof __MOBX_DEVTOOLS_GLOBAL_HOOK__ === "object") {
    // See: https://github.com/andykog/mobx-devtools/
    __MOBX_DEVTOOLS_GLOBAL_HOOK__.injectMobx({
        spy: spy$$1,
        extras: {
            getDebugName: getDebugName$$1
        },
        $mobx: $mobx$$1
    });
}



/* WEBPACK VAR INJECTION */}.call(__webpack_exports__, __webpack_require__(234), __webpack_require__(235)))

/***/ }),
/* 3 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(210), __esModule: true };

/***/ }),
/* 4 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (self, call) {
  if (!self) {
    throw new ReferenceError("this hasn't been initialised - super() hasn't been called");
  }

  return call && ((typeof call === "undefined" ? "undefined" : (0, _typeof3.default)(call)) === "object" || typeof call === "function") ? call : self;
};

/***/ }),
/* 5 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _setPrototypeOf = __webpack_require__(227);

var _setPrototypeOf2 = _interopRequireDefault(_setPrototypeOf);

var _create = __webpack_require__(231);

var _create2 = _interopRequireDefault(_create);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (subClass, superClass) {
  if (typeof superClass !== "function" && superClass !== null) {
    throw new TypeError("Super expression must either be null or a function, not " + (typeof superClass === "undefined" ? "undefined" : (0, _typeof3.default)(superClass)));
  }

  subClass.prototype = (0, _create2.default)(superClass && superClass.prototype, {
    constructor: {
      value: subClass,
      enumerable: false,
      writable: true,
      configurable: true
    }
  });
  if (superClass) _setPrototypeOf2.default ? (0, _setPrototypeOf2.default)(subClass, superClass) : subClass.__proto__ = superClass;
};

/***/ }),
/* 6 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _getOwnPropertyDescriptor = __webpack_require__(224);

var _getOwnPropertyDescriptor2 = _interopRequireDefault(_getOwnPropertyDescriptor);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function get(object, property, receiver) {
  if (object === null) object = Function.prototype;
  var desc = (0, _getOwnPropertyDescriptor2.default)(object, property);

  if (desc === undefined) {
    var parent = (0, _getPrototypeOf2.default)(object);

    if (parent === null) {
      return undefined;
    } else {
      return get(parent, property, receiver);
    }
  } else if ("value" in desc) {
    return desc.value;
  } else {
    var getter = desc.get;

    if (getter === undefined) {
      return undefined;
    }

    return getter.call(receiver);
  }
};

/***/ }),
/* 7 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

var _plainObjectToJSON = __webpack_require__(243);

var _plainObjectToJSON2 = _interopRequireDefault(_plainObjectToJSON);

var _jsonToPlainObject = __webpack_require__(244);

var _jsonToPlainObject2 = _interopRequireDefault(_jsonToPlainObject);

var _registers = __webpack_require__(147);

var _registerPathAttachedGuid = __webpack_require__(246);

var _registerPathAttachedGuid2 = _interopRequireDefault(_registerPathAttachedGuid);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// XbsjBase可以用来转化成JSON格式

/*
XbsjBase转JSON的一些逻辑问题：
1 toJSON()/toJSONStr() 对于以XbsjBase作为基类的对象，只输出defaultOptions中有的属性，对于其他对象，输出所有属性，除非_toJsonFilterKeys中存在该属性。
2 toAllJSON()/toAllJSONStr()  只有_toJsonFilterKeys中的属性不输出，其他所有属性都输出
3 xbsjFromJSON() 只要是_fromJsonFilterKeys没有的属性，一律赋值
 */

/**
 * 所有需要读写的对象的基类
 * @description 从该基类派生的对象，具备读写能力。
 * @class
 */
var XbsjBase = function () {
    function XbsjBase() {
        var _this = this;

        (0, _classCallCheck3.default)(this, XbsjBase);

        (0, _mobx.extendObservable)(this, this._defaultOptions);
        // 让所有defaultOptions变量都不可删除！
        (0, _keys2.default)(this._defaultOptions).forEach(function (propertyName) {
            (0, _defineProperty2.default)(_this, propertyName, { configurable: false });
        });

        this.ignoreDefualt = true;
        this._fromJsonFilterKeys = ['ignoreDefualt'];
        this._toJsonFilterKeys = ['ignoreDefualt'];

        (0, _mobx.extendObservable)(this, {
            _isDestroying: false,
            get isDestroying() {
                return this._isDestroying;
            }
        }, {
            isDestroying: _mobx.computed
        });

        this._xbsjDisposers = [];
    }

    (0, _createClass3.default)(XbsjBase, [{
        key: 'xbsjFromJSON',

        /**
         * 通过JSON数据对象来设置属性
         * @param {*} jsonObject 
         * @example
         * // 创建一个pin对象
         * const objConfig = {
         *     "name": 'Pin1',
         *     "xbsjType": "Pin",
         *     "position": [1.9017005694855162, 0.5972477268978722, 488.7695178987821],
         *     "near": 300,
         *     "show": false,
         *     evalString,
         * };
         * const pin = new XE.Obj.Pin(earth);  
         * pin.xbsjFromJSON(objConfig);
         */
        value: function xbsjFromJSON(jsonObject) {
            // runInAction(() => {
            jsonObject = (0, _assign2.default)({}, this._defaultOptions, jsonObject);
            XbsjBase.jsonToPlainObject(jsonObject, this, this._fromJsonFilterKeys);
            // });
        }

        /**
         * 转化成一个JSON数据对象 <br/>
         * 注意：每次都会创建一个新对象！
         * @method
         * @returns {object} 创建的JSON数据对象
         */

    }, {
        key: 'toJSON',
        value: function toJSON(key) {
            var filterKeys = this._toJsonFilterKeys;
            var defaultOptions = this.ignoreDefualt ? this._defaultOptions : undefined;
            return XbsjBase.plainObjectToJSON(this, { defaultOptions: defaultOptions, filterKeys: filterKeys, ignoreDefualt: this.ignoreDefualt });
        }

        /**
         * 数据整个JSOn对象，包括默认值
         * @method
         * @returns {object} 创建的JSON数据对象
         */

    }, {
        key: 'toAllJSON',
        value: function toAllJSON(key) {
            var originIgnoreDefault = this.ignoreDefualt;
            this.ignoreDefualt = false;
            var result = this.toJSON(key);
            this.ignoreDefualt = originIgnoreDefault;
            return result;
        }

        /**
         * 转化成JSON字符串，默认元素不输出
         * @method
         * @returns {string} JSON格式化好的字符串
         */

    }, {
        key: 'toJSONStr',
        value: function toJSONStr() {
            return (0, _stringify2.default)(this, undefined, '    ');
        }

        /**
         * 转化成JSON字符串，输出全部元素
         * @method
         * @returns {string} JSON格式化好的字符串
         */

    }, {
        key: 'toAllJSONStr',
        value: function toAllJSONStr() {
            return (0, _stringify2.default)(this.toAllJSON(), undefined, '    ');
        }

        /**
         * 检查对象是否已被销毁<br/>
         * 警告：对象一旦销毁不可再次使用！仅此函数可以调用！<br/>
         * @instance
         * @returns {boolean} 对象是否已销毁
         */

    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }

        /**
         * 销毁对象<br/>
         * 警告：对象一旦销毁不可再次使用！<br/>
         * 警告：挂在场景树上的对象禁止调用destroy方法，只要通过数组函数将其从场景树中移除，就会自动销毁！<br/>
         * @instance
         * @returns {undefined} 返回undefined
         * @example
         * // 使用范例
         * // 这样写的好处是，一旦对象销毁，会同时将引用该对象的变量同时置为undefined，防止再次使用。
         * this._myObject = this._myObject && this._myObject.destroy();
         */

    }, {
        key: 'destroy',
        value: function destroy() {
            this._isDestroying = true;

            this._xbsjDisposers.reverse();
            this._xbsjDisposers.forEach(function (d) {
                return d();
            });
            this._xbsjDisposers.length = 0;

            return Cesium.destroyObject(this);
        }
    }, {
        key: 'fromJsonFilterKeys',
        get: function get() {
            return this._fromJsonFilterKeys;
        }
    }, {
        key: 'toJsonFilterKeys',
        get: function get() {
            return this._toJsonFilterKeys;
        }
    }, {
        key: '_jsonSchema',
        get: function get() {
            if (!this.constructor.xbsjSchema) {
                throw new Error('需要为类定义xbsjSchema属性！');
            }

            return this.constructor.xbsjSchema;
        }
    }, {
        key: '_classification',
        get: function get() {
            if (!this.constructor.xbsjClassification) {
                throw new Error('需要为类定义xbsjClassification属性！');
            }

            return this.constructor.xbsjClassification;
        }
    }, {
        key: '_defaultOptions',
        get: function get() {
            // defaultOptionsAccum相当于把所有基类的defaultOptions也合并进来了
            // 另外子类的同名属性的优先级更高。
            if (!this.constructor.defaultOptionsAccum || this.constructor.defaultOptionsAccum === this.constructor.__proto__.defaultOptionsAccum) {
                // 修复派生类不能定义defaultOptions的问题，defaultOptionsAccum会被自动集成。。。
                // 先获取所有基类
                var doOwners = [];
                var currentProto = this.__proto__;

                while (currentProto.constructor !== XbsjBase) {
                    doOwners.push(currentProto.constructor);
                    currentProto = currentProto['__proto__'];
                }

                if (currentProto.constructor !== XbsjBase) {
                    throw new Error('currentProto迭代后必须为XbsjBase！');
                }
                doOwners.push(currentProto.constructor);

                doOwners.reverse();

                var defaultOptions = {};
                doOwners.forEach(function (owner) {
                    owner.defaultOptions && (0, _assign2.default)(defaultOptions, owner.defaultOptions);
                });

                this.constructor.defaultOptionsAccum = defaultOptions;
            }

            return this.constructor.defaultOptionsAccum;
        }

        /**
         * 用来收集资源销毁函数，并在析构时自动调用！
         * @example
         * // 示例1：
         * myObject.disposers.push(() => {
         *     // 此处执行需要销毁的资源
         * });
         * 
         * // 示例2：
         * // XE.MVVM.bind的返回值是一个函数，作用是用来解除双向绑定，
         * // 把它的返回值放到disposer中，那么对象销毁时就会执行解绑操作。
         * myObject.disposers.push(XE.MVVM.bind(xxx));
         * 
         * // 示例3：
         * // XE.MVVM.watch的返回值是一个函数，作用是用来取消监视，
         * // 把它的返回值放到disposer中，那么对象销毁时就会执行取消监视的操作。
         * myObject.disposers.push(XE.MVVM.watch(xxx));
         */

    }, {
        key: 'disposers',
        get: function get() {
            return this._xbsjDisposers;
        }
    }]);
    return XbsjBase;
}();

XbsjBase.plainObjectToJSON = _plainObjectToJSON2.default;
XbsjBase.jsonToPlainObject = _jsonToPlainObject2.default;
XbsjBase.registerProperty = _registers.registerProperty;
XbsjBase.registerArrayProperty = _registers.registerArrayProperty;
XbsjBase.registerPosition = _registers.registerPosition;
XbsjBase.registerRotation = _registers.registerRotation;
XbsjBase.registerPathAttachedGuid = _registerPathAttachedGuid2.default;

exports.default = XbsjBase;

/***/ }),
/* 8 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _from = __webpack_require__(201);

var _from2 = _interopRequireDefault(_from);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (arr) {
  if (Array.isArray(arr)) {
    for (var i = 0, arr2 = Array(arr.length); i < arr.length; i++) {
      arr2[i] = arr[i];
    }

    return arr2;
  } else {
    return (0, _from2.default)(arr);
  }
};

/***/ }),
/* 9 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends2 = __webpack_require__(63);

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function createGuid() {
    // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
    return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0;
        var v = c === 'x' ? r : r & 0x3 | 0x8;
        return v.toString(16);
    });
}

var ci = 0; // 创建顺序，主要用于调试

/**
 * 具备guid的对象的基类
 * @description 具备guid，earth等属性，从该对象派生，可感知对象的创建销毁等操作。
 * @class
 * @extends XbsjBase
 */

var XbsjObject = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjObject, _XbsjBase);

    function XbsjObject(earth, guid) {
        (0, _classCallCheck3.default)(this, XbsjObject);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjObject.__proto__ || (0, _getPrototypeOf2.default)(XbsjObject)).call(this));

        _this._ci = ci++;
        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            isSelected: false
        });

        _this.xbsjGuid = guid || createGuid();
        if (_this._earth._xbsjObjectsMap.has(_this.xbsjGuid)) {
            // 存在相同guid，则重新创建一个guid
            console.warn('guid\u88AB\u4FEE\u6539\uFF0C\u56E0\u4E3A\u53D1\u73B0\u539Fguid\u5DF2\u7ECF\u5B58\u5728\uFF01guid: ' + _this.xbsjGuid);
            _this.xbsjGuid = createGuid();
        }

        // guid和type必须在构造时就确定下来，且不可变更！
        _this.fromJsonFilterKeys.push('xbsjType', 'xbsjGuid');

        if (_this._earth) {
            if (!_this._earth._xbsjObjectOpsEvent) {
                _this._earth._xbsjObjectOpsEvent = new Cesium.Event();
            }
            if (_this._earth._xbsjObjectsMap.has(_this.xbsjGuid)) {
                throw new Error('对象的guid不能重复！');
            }
            _this._earth._xbsjObjectsMap.set(_this.xbsjGuid, _this);
            _this._earth._xbsjObjectOpsEvent.raiseEvent({ type: 'create', xbsjObj: _this });
        } else {
            console.warn('警告：当前正在创建的XbsjObject对象，没有指定earth。');
        }
        return _this;
    }

    /**
     * 返回该对象的所属earth实例
     * @type {Earth}
     * @readonly
     */

    (0, _createClass3.default)(XbsjObject, [{
        key: 'toJSON',
        value: function toJSON(key) {
            var ignoreDefault = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

            return (0, _extends3.default)({
                xbsjType: this.xbsjType
            }, (0, _get3.default)(XbsjObject.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjObject.prototype), 'toJSON', this).call(this, key, ignoreDefault));
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (this._earth) {
                this._earth._xbsjObjectOpsEvent.raiseEvent({ type: 'destroy', xbsjObj: this });
                this._earth._xbsjObjectsMap.delete(this.guid);
            }
            return (0, _get3.default)(XbsjObject.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjObject.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'earth',
        get: function get() {
            return this._earth;
        }

        /**
         * 对象的唯一标识符<br/>
         * 注意，对象一旦创建，guid不可更改！
         * @type {string}
         * @readonly
         */

    }, {
        key: 'guid',
        get: function get() {
            return this.xbsjGuid;
        }

        /**
         * 获取对象的类型信息
         * @type {string}
         * @readonly
         */

    }, {
        key: 'xbsjType',
        get: function get() {
            if (!this.constructor.xbsjType) {
                throw new Error('需要为类定义xbsjType属性！');
            }

            return this.constructor.xbsjType;
            // return this.constructor.name;
        }
    }]);
    return XbsjObject;
}(_XbsjBase3.default);

XbsjObject.typesMap = {};
XbsjObject.registerType = function (DereviedType, typeName) {
    DereviedType.xbsjType = typeName;
    if (XbsjObject.typesMap[typeName]) {
        console.warn('类型已存在！原类型将被覆盖！');
    }
    XbsjObject.typesMap[typeName] = DereviedType;
};

XbsjObject.createObject = function (xbsjType, earth, xbsjGuid) {
    var xbsjConstructor = XbsjObject.typesMap[xbsjType];
    var xbsjInstance = new xbsjConstructor(earth, xbsjGuid);
    return xbsjInstance;
};

XbsjObject.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @instance
     * @memberof XbsjObject
     */
    enabled: true,
    /**
     * 对象的唯一标识符 <br/>
     * 警告：该属性已废弃，请不要使用属性，且禁止修改此属性。<br/>
     * 如果需要获取guid，请通过{@link XbsjObject#guid guid}属性来获取。<br/>
     * @deprecated
     * @type {string | undefined}
     * @instance
     * @memberof XbsjObject
     */
    xbsjGuid: undefined
};

exports.default = XbsjObject;

/***/ }),
/* 10 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.track = undefined;

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * MVVM双向绑定
 * @memberof MVVM
 * @description 双向绑定的属性，如果一方发生变化，另一方同样会跟随变化
 * @param {object} reactObject1 第一个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} reactProperty1 第一个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} reactObject2 第二个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} reactProperty2 第二个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} [params] 额外参数，暂时保留
 */
function bind(reactObject1, reactProperty1, reactObject2, reactProperty2) {
    var _ref = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {},
        _ref$r1Tor = _ref.r1Tor2,
        r1Tor2 = _ref$r1Tor === undefined ? undefined : _ref$r1Tor,
        _ref$r2Tor = _ref.r2Tor1,
        r2Tor1 = _ref$r2Tor === undefined ? undefined : _ref$r2Tor,
        _ref$equals = _ref.equals,
        equals = _ref$equals === undefined ? undefined : _ref$equals;

    var disposers = [];

    disposers.push((0, _track2.default)(reactObject1, reactProperty1, reactObject2, reactProperty2, {
        r2Tor1: r2Tor1,
        equals: equals
    }));

    disposers.push((0, _track2.default)(reactObject2, reactProperty2, reactObject1, reactProperty1, {
        r2Tor1: r1Tor2,
        // 修复视域分析旋转时卡死的问题，原因是度和弧度转换得不对
        // equals应该始终保持(r1, r2)的顺序正确，因为equals的两个参数的单位可能不同，一个是度，一个是弧度！
        // equals: equals, 
        equals: equals ? function (r1, r2) {
            return equals(r2, r1);
        } : undefined
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.track = _track2.default;
exports.default = bind;

/***/ }),
/* 11 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function hierachyExec(obj, funcName) {
    var currentObj = obj;
    // 不进行XbsjCzmObj类型的严格限定，让有onclick和onclickout函数的对象都可以操作
    // while (currentObj && currentObj instanceof XbsjCzmObj) {

    for (var _len = arguments.length, params = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {
        params[_key - 2] = arguments[_key];
    }

    while (currentObj) {
        if (typeof currentObj[funcName] === 'function') {
            var _currentObj$funcName;

            var result = (_currentObj$funcName = currentObj[funcName]).call.apply(_currentObj$funcName, [obj].concat(params));
            if (typeof result === 'boolean' && !result) {
                break;
            }
        }
        currentObj = currentObj.__proto__;
    }
}

/**
 * 三维场景对象的基类
 * @description 具备flyTo等场景定位功能
 * @class
 * @extends XbsjObject
 */

var XbsjCzmObj = function (_XbsjObject) {
    (0, _inherits3.default)(XbsjCzmObj, _XbsjObject);

    function XbsjCzmObj(earth, guid) {
        (0, _classCallCheck3.default)(this, XbsjCzmObj);

        // extendObservable(this, {
        //     _hoveredAttachedInfo: undefined,
        //     get hovered() {
        //         return !!this._hoveredAttachedInfo;
        //     },
        //     get hoveredAttachedInfo() {
        //         return this._hoveredAttachedInfo;
        //     },
        // }, {
        //     hovered: computed,
        //     _hoveredAttachedInfo: observable.ref,
        //     hoveredAttachedInfo: computed,
        // });

        // extendObservable(this, {
        //     _clickedAttachedInfo: undefined,
        //     get clicked() {
        //         return !!this._clickedAttachedInfo;
        //     },
        //     get clickedAttachedInfo() {
        //         return this._clickedAttachedInfo;
        //     }
        // }, {
        //     clicked: computed,
        //     _clickedAttachedInfo: observable.ref,
        //     clickedAttachedInfo: computed,
        // });

        // this._currentHoveredAttachedInfo = undefined;

        // this.disposers.push(reaction(() => this.hoveredAttachedInfo, hoveredAttachedInfo => {
        //     // hovered或者hoveredAttachedInfo显然与之前的状态不同
        //     // 如果之前hovered状态，this._over应该为true
        //     // 此时发生变化了，应该先执行onmouseout
        //     if (!!this._currentHoveredAttachedInfo) {
        //         hierachyExec(this, 'onmouseout', this._currentHoveredAttachedInfo);
        //         this._currentHoveredAttachedInfo = undefined;
        //     }

        //     // 检查一下当前状态是否需要更新_over
        //     // 如果_over为true，应该执行onmouseover
        //     if (!!hoveredAttachedInfo) {
        //         this._currentHoveredAttachedInfo = hoveredAttachedInfo;
        //         // this.onmouseover && this.onmouseover(hoveredAttachedInfo);
        //         hierachyExec(this, 'onmouseover', hoveredAttachedInfo);
        //     }
        // }));

        // 已废弃，不要使用
        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjCzmObj.__proto__ || (0, _getPrototypeOf2.default)(XbsjCzmObj)).call(this, earth, guid));

        _this._changedEvent = new Cesium.Event();

        // add evalString
        {
            // extendObservable(this, {
            //     evalString: '',
            // });

            var updateEvalString = function updateEvalString() {
                if (_this.evalString) {
                    var primitive = _this;
                    try {
                        Function('"use strict";return (function(p){' + _this.evalString + '})')()(primitive);
                    } catch (error) {
                        console.error('\u5BF9\u8C61-' + primitive.name + '(' + primitive.guid + ')\u5728\u6267\u884CevalString\u5C5E\u6027\u7684\u547D\u4EE4\u65F6\u62A5\u9519\uFF1A' + error);
                    }
                }
            };

            updateEvalString();
            _this.disposers.push((0, _mobx.reaction)(function () {
                return _this.evalString;
            }, updateEvalString));
        }

        // add preUpdateEvalString
        {
            // extendObservable(this, {
            //     preUpdateEvalString: '',
            // });

            _this._preUpdateEvent = undefined;
            _this.disposers.push(function () {
                _this._preUpdateEvent = _this._preUpdateEvent && _this._preUpdateEvent();
            });

            var _updateEvalString = function _updateEvalString() {
                _this._preUpdateEvent = _this._preUpdateEvent && _this._preUpdateEvent();

                if (_this.preUpdateEvalString) {
                    var primitive = _this;
                    var preUpdateFunction = Function('"use strict";return (function(p, scene, time){' + _this.preUpdateEvalString + '})')();
                    _this._preUpdateEvent = _this._earth.czm.scene.preUpdate.addEventListener(function (scene, time) {
                        try {
                            preUpdateFunction(primitive, scene, time);
                        } catch (error) {
                            console.error('\u5BF9\u8C61-' + primitive.name + '(' + primitive.guid + ')\u5728\u6267\u884CpreUpdateEvalString\u5C5E\u6027\u7684\u547D\u4EE4\u65F6\u62A5\u9519\uFF1A' + error);
                        }
                    });
                }
            };

            _updateEvalString();
            _this.disposers.push((0, _mobx.reaction)(function () {
                return _this.preUpdateEvalString;
            }, _updateEvalString));
        }
        return _this;
    }

    (0, _createClass3.default)(XbsjCzmObj, [{
        key: 'onclick',
        value: function onclick() {}
    }, {
        key: 'onclickout',
        value: function onclickout() {}
    }, {
        key: 'onmouseover',
        value: function onmouseover() {}
    }, {
        key: 'onmouseout',
        value: function onmouseout() {}

        /**
         * 飞入该对象
         * @method
         */

    }, {
        key: 'flyTo',
        value: function flyTo() {
            console.log('flyTo do nothing!');
        }

        // 没有特殊项需要处理
        // toJSON(key) {
        //     return {
        //         ...super.toJSON(key),
        //     };
        // }

    }, {
        key: 'destroy',
        value: function destroy() {
            if (this.destroyEvalString) {
                var primitive = this;
                try {
                    Function('"use strict";return (function(p){' + this.destroyEvalString + '})')()(primitive);
                } catch (error) {
                    console.error('\u5BF9\u8C61-' + primitive.name + '(' + primitive.guid + ')\u5728\u6267\u884CdestroyEvalString\u5C5E\u6027\u7684\u547D\u4EE4\u65F6\u62A5\u9519\uFF1A' + error);
                }
            }
            return (0, _get3.default)(XbsjCzmObj.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjCzmObj.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'changed',
        get: function get() {
            // 已废弃，不要使用
            console.error('changed已废弃，不要使用!');
            return this._changedEvent;
        }
    }]);
    return XbsjCzmObj;
}(_XbsjObject3.default);

XbsjCzmObj.defaultOptions = {
    name: '未命名场景对象',
    allowPicking: true,
    /**
     * 设置执行语句，<br/>
     * 内部有一个内置的变量p，用来指示当前对象。<br/>
     * 注意evalString每次进行属性设置都会执行一遍，如果evalString中有创建资源，资源需要记录，避免再次执行后销毁不了。<br/>
     * @type {string}
     * @instance
     * @default ''
     * @memberof XbsjCzmObj
     * @see XbsjCzmObj#preUpdateEvalString
     * @see XbsjCzmObj#destroyEvalString
     * @example
     *  myObject.evalString = `
     *   // 技巧1：p是一个内置变量，可以直接使用
     *   if (p._div) { // 技巧2：evalString有可能执行多次，这个地方的判断是避免div重复创建！
     *       return;
     *   }
     *   // 创建div
     *   const div = document.createElement('div');
     *   p._div = div;
     * 
     *   // 技巧3：可以通过p.earth来获取earth变量
     *   const earth = p.earth;
     *   `;
     */
    evalString: '',
    /**
     * 设置每帧执行语句，和evalString的作用类似 <br/>
     * 它有三个内置变量，分别是p, scene, time，分别表示当前对象，Cesium的场景对象scene，Cesium的当前帧的时间time
     * 需要注意的是它会每帧执行一次。
     * @type {string}
     * @instance
     * @default ‘’
     * @memberof XbsjCzmObj
     * @see XbsjCzmObj#preUpdateEvalString
     * @see XbsjCzmObj#destroyEvalString
     * @example
     *  myObject.preUpdateEvalString = `
     *   // 技巧1：p是一个内置变量，可以直接使用，还有scene，time都可以直接使用
     *      p._angle += 1;
     *      if (p._angle > 360.0) {
     *          p._angle = 0.0;
     *      }
     *      const angle = p._angle;
     *      // drawCanvas时使用angle来改变图像内容
     *      // ...
     *  `;
     */
    preUpdateEvalString: '',
    /**
     * 销毁时的执行语句，只有在对象销毁时才会执行，方便用来清理随该对象创建时附带创建的资源<br/>
     * 有一个内置变量p，表示当前对象。
     * 注意对象的销毁除了使用destroyEvalString，还可以使用 {@link XbsjBase#disposers disposers} 属性来销毁。
     * @type {string}
     * @instance
     * @default ''
     * @memberof XbsjCzmObj
     * @see XbsjCzmObj#evalString
     * @see XbsjCzmObj#preUpdateEvalString
     */
    destroyEvalString: ''
};

XbsjCzmObj.hierachyExec = hierachyExec;

exports.default = XbsjCzmObj;

/***/ }),
/* 12 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Observable; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__util_canReportError__ = __webpack_require__(118);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_toSubscriber__ = __webpack_require__(380);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__symbol_observable__ = __webpack_require__(51);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_pipe__ = __webpack_require__(176);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__config__ = __webpack_require__(87);
/** PURE_IMPORTS_START _util_canReportError,_util_toSubscriber,_symbol_observable,_util_pipe,_config PURE_IMPORTS_END */





var Observable = /*@__PURE__*/ (function () {
    function Observable(subscribe) {
        this._isScalar = false;
        if (subscribe) {
            this._subscribe = subscribe;
        }
    }
    Observable.prototype.lift = function (operator) {
        var observable = new Observable();
        observable.source = this;
        observable.operator = operator;
        return observable;
    };
    Observable.prototype.subscribe = function (observerOrNext, error, complete) {
        var operator = this.operator;
        var sink = Object(__WEBPACK_IMPORTED_MODULE_1__util_toSubscriber__["a" /* toSubscriber */])(observerOrNext, error, complete);
        if (operator) {
            sink.add(operator.call(sink, this.source));
        }
        else {
            sink.add(this.source || (__WEBPACK_IMPORTED_MODULE_4__config__["a" /* config */].useDeprecatedSynchronousErrorHandling && !sink.syncErrorThrowable) ?
                this._subscribe(sink) :
                this._trySubscribe(sink));
        }
        if (__WEBPACK_IMPORTED_MODULE_4__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
            if (sink.syncErrorThrowable) {
                sink.syncErrorThrowable = false;
                if (sink.syncErrorThrown) {
                    throw sink.syncErrorValue;
                }
            }
        }
        return sink;
    };
    Observable.prototype._trySubscribe = function (sink) {
        try {
            return this._subscribe(sink);
        }
        catch (err) {
            if (__WEBPACK_IMPORTED_MODULE_4__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
                sink.syncErrorThrown = true;
                sink.syncErrorValue = err;
            }
            if (Object(__WEBPACK_IMPORTED_MODULE_0__util_canReportError__["a" /* canReportError */])(sink)) {
                sink.error(err);
            }
            else {
                console.warn(err);
            }
        }
    };
    Observable.prototype.forEach = function (next, promiseCtor) {
        var _this = this;
        promiseCtor = getPromiseCtor(promiseCtor);
        return new promiseCtor(function (resolve, reject) {
            var subscription;
            subscription = _this.subscribe(function (value) {
                try {
                    next(value);
                }
                catch (err) {
                    reject(err);
                    if (subscription) {
                        subscription.unsubscribe();
                    }
                }
            }, reject, resolve);
        });
    };
    Observable.prototype._subscribe = function (subscriber) {
        var source = this.source;
        return source && source.subscribe(subscriber);
    };
    Observable.prototype[__WEBPACK_IMPORTED_MODULE_2__symbol_observable__["a" /* observable */]] = function () {
        return this;
    };
    Observable.prototype.pipe = function () {
        var operations = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            operations[_i] = arguments[_i];
        }
        if (operations.length === 0) {
            return this;
        }
        return Object(__WEBPACK_IMPORTED_MODULE_3__util_pipe__["b" /* pipeFromArray */])(operations)(this);
    };
    Observable.prototype.toPromise = function (promiseCtor) {
        var _this = this;
        promiseCtor = getPromiseCtor(promiseCtor);
        return new promiseCtor(function (resolve, reject) {
            var value;
            _this.subscribe(function (x) { return value = x; }, function (err) { return reject(err); }, function () { return resolve(value); });
        });
    };
    Observable.create = function (subscribe) {
        return new Observable(subscribe);
    };
    return Observable;
}());

function getPromiseCtor(promiseCtor) {
    if (!promiseCtor) {
        promiseCtor = __WEBPACK_IMPORTED_MODULE_4__config__["a" /* config */].Promise || Promise;
    }
    if (!promiseCtor) {
        throw new Error('no Promise impl found');
    }
    return promiseCtor;
}
//# sourceMappingURL=Observable.js.map


/***/ }),
/* 13 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = __extends;
/* unused harmony export __assign */
/* unused harmony export __rest */
/* unused harmony export __decorate */
/* unused harmony export __param */
/* unused harmony export __metadata */
/* unused harmony export __awaiter */
/* unused harmony export __generator */
/* unused harmony export __exportStar */
/* unused harmony export __values */
/* unused harmony export __read */
/* unused harmony export __spread */
/* unused harmony export __await */
/* unused harmony export __asyncGenerator */
/* unused harmony export __asyncDelegator */
/* unused harmony export __asyncValues */
/* unused harmony export __makeTemplateObject */
/* unused harmony export __importStar */
/* unused harmony export __importDefault */
/*! *****************************************************************************
Copyright (c) Microsoft Corporation. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */
/* global Reflect, Promise */

var extendStatics = function(d, b) {
    extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return extendStatics(d, b);
};

function __extends(d, b) {
    extendStatics(d, b);
    function __() { this.constructor = d; }
    d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
}

var __assign = function() {
    __assign = Object.assign || function __assign(t) {
        for (var s, i = 1, n = arguments.length; i < n; i++) {
            s = arguments[i];
            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];
        }
        return t;
    }
    return __assign.apply(this, arguments);
}

function __rest(s, e) {
    var t = {};
    for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p) && e.indexOf(p) < 0)
        t[p] = s[p];
    if (s != null && typeof Object.getOwnPropertySymbols === "function")
        for (var i = 0, p = Object.getOwnPropertySymbols(s); i < p.length; i++) if (e.indexOf(p[i]) < 0)
            t[p[i]] = s[p[i]];
    return t;
}

function __decorate(decorators, target, key, desc) {
    var c = arguments.length, r = c < 3 ? target : desc === null ? desc = Object.getOwnPropertyDescriptor(target, key) : desc, d;
    if (typeof Reflect === "object" && typeof Reflect.decorate === "function") r = Reflect.decorate(decorators, target, key, desc);
    else for (var i = decorators.length - 1; i >= 0; i--) if (d = decorators[i]) r = (c < 3 ? d(r) : c > 3 ? d(target, key, r) : d(target, key)) || r;
    return c > 3 && r && Object.defineProperty(target, key, r), r;
}

function __param(paramIndex, decorator) {
    return function (target, key) { decorator(target, key, paramIndex); }
}

function __metadata(metadataKey, metadataValue) {
    if (typeof Reflect === "object" && typeof Reflect.metadata === "function") return Reflect.metadata(metadataKey, metadataValue);
}

function __awaiter(thisArg, _arguments, P, generator) {
    return new (P || (P = Promise))(function (resolve, reject) {
        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }
        function rejected(value) { try { step(generator["throw"](value)); } catch (e) { reject(e); } }
        function step(result) { result.done ? resolve(result.value) : new P(function (resolve) { resolve(result.value); }).then(fulfilled, rejected); }
        step((generator = generator.apply(thisArg, _arguments || [])).next());
    });
}

function __generator(thisArg, body) {
    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;
    return g = { next: verb(0), "throw": verb(1), "return": verb(2) }, typeof Symbol === "function" && (g[Symbol.iterator] = function() { return this; }), g;
    function verb(n) { return function (v) { return step([n, v]); }; }
    function step(op) {
        if (f) throw new TypeError("Generator is already executing.");
        while (_) try {
            if (f = 1, y && (t = op[0] & 2 ? y["return"] : op[0] ? y["throw"] || ((t = y["return"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;
            if (y = 0, t) op = [op[0] & 2, t.value];
            switch (op[0]) {
                case 0: case 1: t = op; break;
                case 4: _.label++; return { value: op[1], done: false };
                case 5: _.label++; y = op[1]; op = [0]; continue;
                case 7: op = _.ops.pop(); _.trys.pop(); continue;
                default:
                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }
                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }
                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }
                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }
                    if (t[2]) _.ops.pop();
                    _.trys.pop(); continue;
            }
            op = body.call(thisArg, _);
        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }
        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };
    }
}

function __exportStar(m, exports) {
    for (var p in m) if (!exports.hasOwnProperty(p)) exports[p] = m[p];
}

function __values(o) {
    var m = typeof Symbol === "function" && o[Symbol.iterator], i = 0;
    if (m) return m.call(o);
    return {
        next: function () {
            if (o && i >= o.length) o = void 0;
            return { value: o && o[i++], done: !o };
        }
    };
}

function __read(o, n) {
    var m = typeof Symbol === "function" && o[Symbol.iterator];
    if (!m) return o;
    var i = m.call(o), r, ar = [], e;
    try {
        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);
    }
    catch (error) { e = { error: error }; }
    finally {
        try {
            if (r && !r.done && (m = i["return"])) m.call(i);
        }
        finally { if (e) throw e.error; }
    }
    return ar;
}

function __spread() {
    for (var ar = [], i = 0; i < arguments.length; i++)
        ar = ar.concat(__read(arguments[i]));
    return ar;
}

function __await(v) {
    return this instanceof __await ? (this.v = v, this) : new __await(v);
}

function __asyncGenerator(thisArg, _arguments, generator) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var g = generator.apply(thisArg, _arguments || []), i, q = [];
    return i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i;
    function verb(n) { if (g[n]) i[n] = function (v) { return new Promise(function (a, b) { q.push([n, v, a, b]) > 1 || resume(n, v); }); }; }
    function resume(n, v) { try { step(g[n](v)); } catch (e) { settle(q[0][3], e); } }
    function step(r) { r.value instanceof __await ? Promise.resolve(r.value.v).then(fulfill, reject) : settle(q[0][2], r); }
    function fulfill(value) { resume("next", value); }
    function reject(value) { resume("throw", value); }
    function settle(f, v) { if (f(v), q.shift(), q.length) resume(q[0][0], q[0][1]); }
}

function __asyncDelegator(o) {
    var i, p;
    return i = {}, verb("next"), verb("throw", function (e) { throw e; }), verb("return"), i[Symbol.iterator] = function () { return this; }, i;
    function verb(n, f) { i[n] = o[n] ? function (v) { return (p = !p) ? { value: __await(o[n](v)), done: n === "return" } : f ? f(v) : v; } : f; }
}

function __asyncValues(o) {
    if (!Symbol.asyncIterator) throw new TypeError("Symbol.asyncIterator is not defined.");
    var m = o[Symbol.asyncIterator], i;
    return m ? m.call(o) : (o = typeof __values === "function" ? __values(o) : o[Symbol.iterator](), i = {}, verb("next"), verb("throw"), verb("return"), i[Symbol.asyncIterator] = function () { return this; }, i);
    function verb(n) { i[n] = o[n] && function (v) { return new Promise(function (resolve, reject) { v = o[n](v), settle(resolve, reject, v.done, v.value); }); }; }
    function settle(resolve, reject, d, v) { Promise.resolve(v).then(function(v) { resolve({ value: v, done: d }); }, reject); }
}

function __makeTemplateObject(cooked, raw) {
    if (Object.defineProperty) { Object.defineProperty(cooked, "raw", { value: raw }); } else { cooked.raw = raw; }
    return cooked;
};

function __importStar(mod) {
    if (mod && mod.__esModule) return mod;
    var result = {};
    if (mod != null) for (var k in mod) if (Object.hasOwnProperty.call(mod, k)) result[k] = mod[k];
    result.default = mod;
    return result;
}

function __importDefault(mod) {
    return (mod && mod.__esModule) ? mod : { default: mod };
}


/***/ }),
/* 14 */
/***/ (function(module, exports) {

var core = module.exports = { version: '2.6.8' };
if (typeof __e == 'number') __e = core; // eslint-disable-line no-undef


/***/ }),
/* 15 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.registerHeightEditing = exports.registerCameraTracking = exports.registerPositionPicking = exports.registerPolylineEditing = exports.registerPolylineCreating = exports.registerPolygonEditing = exports.registerPolygonCreating = exports.registerPolygonCreatingWithHeight = exports.registerRotationEditing = exports.registerPositionEditing = undefined;

var _defineProperty2 = __webpack_require__(78);

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _mobx = __webpack_require__(2);

var _MovableObjectLike = __webpack_require__(247);

var _MovableObjectLike2 = _interopRequireDefault(_MovableObjectLike);

var _RotatableObjectLike = __webpack_require__(248);

var _RotatableObjectLike2 = _interopRequireDefault(_RotatableObjectLike);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function registerPositionEditing(earth, reactObject) {
    var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref$positionEditingP = _ref.positionEditingProperty,
        positionEditingProperty = _ref$positionEditingP === undefined ? 'positionEditing' : _ref$positionEditingP,
        _ref$positionProperty = _ref.positionProperty,
        positionProperty = _ref$positionProperty === undefined ? 'position' : _ref$positionProperty;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, positionEditingProperty, false));
    reactObject.fromJsonFilterKeys.push(positionEditingProperty);

    var disposers = [];
    var movableObjectLike = void 0;

    if (positionProperty !== 'position') {
        disposers.push(function () {
            movableObjectLike = new _MovableObjectLike2.default(reactObject, positionProperty);
            return function () {
                movableObjectLike && movableObjectLike.destroy();
                movableObjectLike = undefined;
            };
        }());
    } else {
        movableObjectLike = reactObject;
    }

    disposers.push((0, _mobx.autorun)(function () {
        reactObject[positionEditingProperty] = earth.interaction.movableObjectBinding.target === movableObjectLike;
    }));

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[positionEditingProperty];
    }, function () {
        if (!reactObject[positionEditingProperty] && earth.interaction.movableObjectBinding.target === movableObjectLike) {
            earth.interaction.movableObjectBinding.target = undefined;
        } else if (reactObject[positionEditingProperty]) {
            earth.interaction.movableObjectBinding.target = movableObjectLike;
        }
    }, {
        fireImmediately: true
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerRotationEditing(earth, reactObject) {
    var _ref2 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref2$rotationEditing = _ref2.rotationEditingProperty,
        rotationEditingProperty = _ref2$rotationEditing === undefined ? 'rotationEditing' : _ref2$rotationEditing,
        _ref2$positionPropert = _ref2.positionProperty,
        positionProperty = _ref2$positionPropert === undefined ? 'position' : _ref2$positionPropert,
        _ref2$rotationPropert = _ref2.rotationProperty,
        rotationProperty = _ref2$rotationPropert === undefined ? 'rotation' : _ref2$rotationPropert;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, rotationEditingProperty, false));
    reactObject.fromJsonFilterKeys.push(rotationEditingProperty);

    var disposers = [];
    var rotatableObjectLike = void 0;

    if (positionProperty !== 'position' || rotationProperty !== 'rotation') {
        disposers.push(function () {
            rotatableObjectLike = new _RotatableObjectLike2.default(reactObject, positionProperty, rotationProperty);
            return function () {
                rotatableObjectLike && rotatableObjectLike.destroy();
                rotatableObjectLike = undefined;
            };
        }());
    } else {
        rotatableObjectLike = reactObject;
    }

    disposers.push((0, _mobx.autorun)(function () {
        reactObject[rotationEditingProperty] = earth.interaction.rotatableObjectBinding.target === rotatableObjectLike;
    }));

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[rotationEditingProperty];
    }, function () {
        if (!reactObject[rotationEditingProperty] && earth.interaction.rotatableObjectBinding.target === rotatableObjectLike) {
            earth.interaction.rotatableObjectBinding.target = undefined;
        } else if (reactObject[rotationEditingProperty]) {
            earth.interaction.rotatableObjectBinding.target = rotatableObjectLike;
        }
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerHeightEditing(earth, reactObject, _ref3) {
    var _ref3$positionHeightE = _ref3.positionHeightEditing,
        positionHeightEditing = _ref3$positionHeightE === undefined ? 'heightEditing' : _ref3$positionHeightE,
        _ref3$positionPropert = _ref3.positionProperty,
        positionProperty = _ref3$positionPropert === undefined ? 'position' : _ref3$positionPropert;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, positionHeightEditing, false));
    reactObject.fromJsonFilterKeys.push(positionHeightEditing);

    var disposers = [];

    var movableObjectLike = void 0;

    if (positionProperty !== 'position') {
        disposers.push(function () {
            movableObjectLike = new _MovableObjectLike2.default(reactObject, positionProperty);
            return function () {
                movableObjectLike && movableObjectLike.destroy();
                movableObjectLike = undefined;
            };
        }());
    } else {
        movableObjectLike = reactObject;
    }

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.heightEditingBinding) {
            return;
        }

        reactObject[positionHeightEditing] = earth.interaction.heightEditingBinding.target === movableObjectLike;
    }));

    var assignTarget = function assignTarget(reactObject, positionHeightEditing) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.heightEditingBinding) {
            return;
        }

        if (!reactObject[positionHeightEditing] && earth.interaction.heightEditingBinding.target === movableObjectLike) {
            earth.interaction.heightEditingBinding.target = undefined;
        } else if (reactObject[positionHeightEditing]) {
            earth.interaction.heightEditingBinding.target = movableObjectLike;
        }
    };

    assignTarget(reactObject, positionHeightEditing);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[positionHeightEditing];
    }, function () {
        assignTarget(reactObject, positionHeightEditing);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPolygonCreatingWithHeight(earth, reactObject, _ref4) {
    var _ref4$polygonCreating = _ref4.polygonCreatingWithHeight,
        polygonCreatingWithHeight = _ref4$polygonCreating === undefined ? 'creatingWithHeight' : _ref4$polygonCreating;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, polygonCreatingWithHeight, false));
    reactObject.fromJsonFilterKeys.push(polygonCreatingWithHeight);

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.flattenedPolygonCreatingBinding) {
            return;
        }

        reactObject[polygonCreatingWithHeight] = earth.interaction.flattenedPolygonCreatingBinding.target === reactObject;
    }));

    var assignTarget = function assignTarget(reactObject, polygonCreatingWithHeight) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.flattenedPolygonCreatingBinding) {
            return;
        }

        if (!reactObject[polygonCreatingWithHeight] && earth.interaction.flattenedPolygonCreatingBinding.target === reactObject) {
            earth.interaction.flattenedPolygonCreatingBinding.target = undefined;
        } else if (reactObject[polygonCreatingWithHeight]) {
            earth.interaction.flattenedPolygonCreatingBinding.target = reactObject;
        }
    };

    assignTarget(reactObject, polygonCreatingWithHeight);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[polygonCreatingWithHeight];
    }, function () {
        assignTarget(reactObject, polygonCreatingWithHeight);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPolygonCreating(earth, reactObject, _ref5) {
    var _ref5$polygonCreating = _ref5.polygonCreating,
        polygonCreating = _ref5$polygonCreating === undefined ? 'creating' : _ref5$polygonCreating;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, polygonCreating, false));
    reactObject.fromJsonFilterKeys.push(polygonCreating);

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.creatingPolygonBinding) {
            return;
        }

        reactObject[polygonCreating] = earth.interaction.creatingPolygonBinding.target === reactObject;
    }));

    var assignTarget = function assignTarget(reactObject, polygonCreating) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.creatingPolygonBinding) {
            return;
        }

        if (!reactObject[polygonCreating] && earth.interaction.creatingPolygonBinding.target === reactObject) {
            earth.interaction.creatingPolygonBinding.target = undefined;
        } else if (reactObject[polygonCreating]) {
            earth.interaction.creatingPolygonBinding.target = reactObject;
        }
    };

    assignTarget(reactObject, polygonCreating);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[polygonCreating];
    }, function () {
        assignTarget(reactObject, polygonCreating);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPolygonEditing(earth, reactObject, _ref6) {
    var _ref6$polygonEditingP = _ref6.polygonEditingProperty,
        polygonEditingProperty = _ref6$polygonEditingP === undefined ? 'polygonEditing' : _ref6$polygonEditingP;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, polygonEditingProperty, false));
    reactObject.fromJsonFilterKeys.push(polygonEditingProperty);

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.editingPolygonBinding) {
            return;
        }

        reactObject[polygonEditingProperty] = earth.interaction.editingPolygonBinding.target === reactObject;
    }));

    var assignTarget = function assignTarget(reactObject, polygonEditingProperty) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.editingPolygonBinding) {
            return;
        }

        if (!reactObject[polygonEditingProperty] && earth.interaction.editingPolygonBinding.target === reactObject) {
            earth.interaction.editingPolygonBinding.target = undefined;
        } else if (reactObject[polygonEditingProperty]) {
            earth.interaction.editingPolygonBinding.target = reactObject;
        }
    };

    assignTarget(reactObject, polygonEditingProperty);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[polygonEditingProperty];
    }, function () {
        assignTarget(reactObject, polygonEditingProperty);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPolylineCreating(earth, reactObject, _ref7) {
    var _ref7$polylineCreatin = _ref7.polylineCreatingProperty,
        polylineCreatingProperty = _ref7$polylineCreatin === undefined ? 'creating' : _ref7$polylineCreatin;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, polylineCreatingProperty, false));
    reactObject.fromJsonFilterKeys.push(polylineCreatingProperty);

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction) {
            return;
        }

        reactObject[polylineCreatingProperty] = earth.interaction.creatingPolylineBinding.target === reactObject;
    }));

    var assignTarget = function assignTarget(reactObject, polylineCreatingProperty) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.creatingPolylineBinding) {
            return;
        }

        if (!reactObject[polylineCreatingProperty] && earth.interaction.creatingPolylineBinding.target === reactObject) {
            earth.interaction.creatingPolylineBinding.target = undefined;
        } else if (reactObject[polylineCreatingProperty]) {
            earth.interaction.creatingPolylineBinding.target = reactObject;
        }
    };

    assignTarget(reactObject, polylineCreatingProperty);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[polylineCreatingProperty];
    }, function () {
        assignTarget(reactObject, polylineCreatingProperty);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPolylineEditing(earth, reactObject, _ref8) {
    var _ref8$polylineEditing = _ref8.polylineEditingProperty,
        polylineEditingProperty = _ref8$polylineEditing === undefined ? 'polylineEditing' : _ref8$polylineEditing;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, polylineEditingProperty, false));
    reactObject.fromJsonFilterKeys.push(polylineEditingProperty);

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.editingPolylineBinding) {
            return;
        }

        reactObject[polylineEditingProperty] = earth.interaction.editingPolylineBinding.target === reactObject;
    }));

    var assignTarget = function assignTarget(reactObject, polylineEditingProperty) {
        // interaction有可能还不存在
        if (!earth.interaction || !earth.interaction.editingPolylineBinding) {
            return;
        }

        if (!reactObject[polylineEditingProperty] && earth.interaction.editingPolylineBinding.target === reactObject) {
            earth.interaction.editingPolylineBinding.target = undefined;
        } else if (reactObject[polylineEditingProperty]) {
            earth.interaction.editingPolylineBinding.target = reactObject;
        }
    };

    assignTarget(reactObject, polylineEditingProperty);

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[polylineEditingProperty];
    }, function () {
        assignTarget(reactObject, polylineEditingProperty);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPositionPicking(earth, reactObject) {
    var _ref9 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref9$positionPicking = _ref9.positionPickingProperty,
        positionPickingProperty = _ref9$positionPicking === undefined ? 'positionPicking' : _ref9$positionPicking,
        _ref9$positionPropert = _ref9.positionProperty,
        positionProperty = _ref9$positionPropert === undefined ? 'position' : _ref9$positionPropert;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, positionPickingProperty, false));
    reactObject.fromJsonFilterKeys.push(positionPickingProperty);

    var disposers = [];
    var movableObjectLike = void 0;

    if (positionProperty !== 'position') {
        disposers.push(function () {
            movableObjectLike = new _MovableObjectLike2.default(reactObject, positionProperty);
            return function () {
                movableObjectLike && movableObjectLike.destroy();
                movableObjectLike = undefined;
            };
        }());
    } else {
        movableObjectLike = reactObject;
    }

    disposers.push((0, _mobx.autorun)(function () {
        reactObject[positionPickingProperty] = earth.interaction.positionPickingBinding.target === movableObjectLike;
    }));

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[positionPickingProperty];
    }, function () {
        if (!reactObject[positionPickingProperty] && earth.interaction.positionPickingBinding.target === movableObjectLike) {
            earth.interaction.positionPickingBinding.target = undefined;
        } else if (reactObject[positionPickingProperty]) {
            earth.interaction.positionPickingBinding.target = movableObjectLike;
        }
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

// 和以往的方式不同，通过func来操作，而不是xxxobjectLike的方式，这样更灵活！
// TODO(vtxf): 以后可以根据此方式来改造之前的模式
var defaultCameraTrackingFunc = function defaultCameraTrackingFunc(tracking) {
    var disposers = [];
    disposers.push((0, _track2.default)(tracking, 'position', target, 'position'));
    disposers.push((0, _track2.default)(tracking, 'rotation', target, 'rotation'));
    disposers.push((0, _track2.default)(tracking, 'viewDistance', target, 'viewDistance'));
    earth.camera.tracking.isCameraLike = target.isCameraLike;

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
};

function registerCameraTracking(earth, reactObject) {
    var _ref10 = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref10$cameraAttached = _ref10.cameraAttachedProperty,
        cameraAttachedProperty = _ref10$cameraAttached === undefined ? 'cameraAttached' : _ref10$cameraAttached,
        _ref10$cameraAttached2 = _ref10.cameraAttachedFunc,
        cameraAttachedFunc = _ref10$cameraAttached2 === undefined ? defaultCameraTrackingFunc : _ref10$cameraAttached2;

    (0, _mobx.extendObservable)(reactObject, (0, _defineProperty3.default)({}, cameraAttachedProperty, false));
    reactObject.fromJsonFilterKeys.push(cameraAttachedProperty);

    reactObject.cameraTrackingFunc = cameraAttachedFunc;

    var disposers = [];

    disposers.push((0, _mobx.autorun)(function () {
        reactObject[cameraAttachedProperty] = earth.interaction.cameraTrackingBinding.target === reactObject;
    }));

    disposers.push((0, _mobx.reaction)(function () {
        return reactObject[cameraAttachedProperty];
    }, function () {
        if (!reactObject[cameraAttachedProperty] && earth.interaction.cameraTrackingBinding.target === reactObject) {
            earth.interaction.cameraTrackingBinding.target = undefined;
        } else if (reactObject[cameraAttachedProperty]) {
            earth.interaction.cameraTrackingBinding.target = reactObject;
        }
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.registerPositionEditing = registerPositionEditing;
exports.registerRotationEditing = registerRotationEditing;
exports.registerPolygonCreatingWithHeight = registerPolygonCreatingWithHeight;
exports.registerPolygonCreating = registerPolygonCreating;
exports.registerPolygonEditing = registerPolygonEditing;
exports.registerPolylineCreating = registerPolylineCreating;
exports.registerPolylineEditing = registerPolylineEditing;
exports.registerPositionPicking = registerPositionPicking;
exports.registerCameraTracking = registerCameraTracking;
exports.registerHeightEditing = registerHeightEditing;

var InteractionProperty = {
    registerPositionEditing: registerPositionEditing,
    registerRotationEditing: registerRotationEditing,
    registerPolygonCreatingWithHeight: registerPolygonCreatingWithHeight,
    registerPolygonCreating: registerPolygonCreating,
    registerPolygonEditing: registerPolygonEditing,
    registerPolylineCreating: registerPolylineCreating,
    registerPolylineEditing: registerPolylineEditing,
    registerPositionPicking: registerPositionPicking,
    registerCameraTracking: registerCameraTracking,
    registerHeightEditing: registerHeightEditing
};

exports.default = InteractionProperty;

/***/ }),
/* 16 */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(17);
var core = __webpack_require__(14);
var ctx = __webpack_require__(32);
var hide = __webpack_require__(34);
var has = __webpack_require__(40);
var PROTOTYPE = 'prototype';

var $export = function (type, name, source) {
  var IS_FORCED = type & $export.F;
  var IS_GLOBAL = type & $export.G;
  var IS_STATIC = type & $export.S;
  var IS_PROTO = type & $export.P;
  var IS_BIND = type & $export.B;
  var IS_WRAP = type & $export.W;
  var exports = IS_GLOBAL ? core : core[name] || (core[name] = {});
  var expProto = exports[PROTOTYPE];
  var target = IS_GLOBAL ? global : IS_STATIC ? global[name] : (global[name] || {})[PROTOTYPE];
  var key, own, out;
  if (IS_GLOBAL) source = name;
  for (key in source) {
    // contains in native
    own = !IS_FORCED && target && target[key] !== undefined;
    if (own && has(exports, key)) continue;
    // export native or passed
    out = own ? target[key] : source[key];
    // prevent global pollution for namespaces
    exports[key] = IS_GLOBAL && typeof target[key] != 'function' ? source[key]
    // bind timers to global for call from export context
    : IS_BIND && own ? ctx(out, global)
    // wrap global constructors for prevent change them in library
    : IS_WRAP && target[key] == out ? (function (C) {
      var F = function (a, b, c) {
        if (this instanceof C) {
          switch (arguments.length) {
            case 0: return new C();
            case 1: return new C(a);
            case 2: return new C(a, b);
          } return new C(a, b, c);
        } return C.apply(this, arguments);
      };
      F[PROTOTYPE] = C[PROTOTYPE];
      return F;
    // make static versions for prototype methods
    })(out) : IS_PROTO && typeof out == 'function' ? ctx(Function.call, out) : out;
    // export proto methods to core.%CONSTRUCTOR%.methods.%NAME%
    if (IS_PROTO) {
      (exports.virtual || (exports.virtual = {}))[key] = out;
      // export proto methods to core.%CONSTRUCTOR%.prototype.%NAME%
      if (type & $export.R && expProto && !expProto[key]) hide(expProto, key, out);
    }
  }
};
// type bitmap
$export.F = 1;   // forced
$export.G = 2;   // global
$export.S = 4;   // static
$export.P = 8;   // proto
$export.B = 16;  // bind
$export.W = 32;  // wrap
$export.U = 64;  // safe
$export.R = 128; // real proto method for `library`
module.exports = $export;


/***/ }),
/* 17 */
/***/ (function(module, exports) {

// https://github.com/zloirock/core-js/issues/86#issuecomment-115759028
var global = module.exports = typeof window != 'undefined' && window.Math == Math
  ? window : typeof self != 'undefined' && self.Math == Math ? self
  // eslint-disable-next-line no-new-func
  : Function('return this')();
if (typeof __g == 'number') __g = global; // eslint-disable-line no-undef


/***/ }),
/* 18 */
/***/ (function(module, exports, __webpack_require__) {

var store = __webpack_require__(99)('wks');
var uid = __webpack_require__(72);
var Symbol = __webpack_require__(17).Symbol;
var USE_SYMBOL = typeof Symbol == 'function';

var $exports = module.exports = function (name) {
  return store[name] || (store[name] =
    USE_SYMBOL && Symbol[name] || (USE_SYMBOL ? Symbol : uid)('Symbol.' + name));
};

$exports.store = store;


/***/ }),
/* 19 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjEditing = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjEditing, _XbsjBase);

    function XbsjEditing(earth) {
        (0, _classCallCheck3.default)(this, XbsjEditing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjEditing.__proto__ || (0, _getPrototypeOf2.default)(XbsjEditing)).call(this));

        _this._earth = earth;
        _this._steps = undefined;
        _this.disposers.push(function () {
            return _this._steps = _this._steps && _this._steps.destroy();
        });

        _this.disposers.push((0, _mobx.observe)(_this, 'enabled', function (changed) {
            if (changed.newValue) {
                _this._start();
            }
        }));

        _this.disposers.push((0, _mobx.intercept)(_this, 'enabled', function (changed) {
            // changed.object.value !== changed.newValue 需要加上这个判断，因为真有这种情况出现！
            if (changed.object.value !== changed.newValue && !changed.newValue) {
                _this._cancel();
            }
            return changed;
        }));
        return _this;
    }

    (0, _createClass3.default)(XbsjEditing, [{
        key: '_init',
        value: function _init() {
            throw new Error('需要具体实现');
        }
    }, {
        key: '_start',
        value: function _start() {
            throw new Error('需要具体实现');
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            throw new Error('需要具体实现');
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(XbsjEditing.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjEditing.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'steps',
        get: function get() {
            if (!this._steps) {
                this._init();
            }
            return this._steps;
        }
    }]);
    return XbsjEditing;
}(_XbsjBase3.default);

XbsjEditing.defaultOptions = {
    enabled: false
};

function enableProperty(reactObject, parentCancelFunc) {
    reactObject.enabled = true;

    // 可以拦截父对象的属性，来确保在editing内部的enabled之前运行。
    var beforeDisabledDisposer = (0, _mobx.intercept)(reactObject, function (changed) {
        if (changed.name === 'enabled' && changed.type === 'update') {
            if (changed.newValue) {
                throw new Error('changed.newValue should not be true or defined!');
            }
            // parentCancelFunc(reactObject.steps.lastStep);
            parentCancelFunc();
            return null;
        }
        return changed;
    });

    return function () {
        if (!beforeDisabledDisposer) {
            throw new Error('beforeDisabledDisposer should exits!');
        }

        beforeDisabledDisposer();
        reactObject.enabled = false;
    };
}

XbsjEditing.enableProperty = enableProperty;

exports.default = XbsjEditing;

/***/ }),
/* 20 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase7 = __webpack_require__(7);

var _XbsjBase8 = _interopRequireDefault(_XbsjBase7);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _uniquePositions = __webpack_require__(250);

var _uniquePositions2 = _interopRequireDefault(_uniquePositions);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 折线材质
 * @namespace
 * @name Material
 * @memberof Obj.Polyline
 */

/**
* 纯色材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

// TODO(vtxf): uniquePositions还要应用到polygon当中去，避免底层崩溃
var Color = function (_XbsjBase) {
    (0, _inherits3.default)(Color, _XbsjBase);

    function Color() {
        (0, _classCallCheck3.default)(this, Color);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Color.__proto__ || (0, _getPrototypeOf2.default)(Color)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _material: Cesium.Material.fromType('Color'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this._disposers = [];
        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._material.uniforms.color = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this.color))))();
        }));
        return _this;
    }

    (0, _createClass3.default)(Color, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            return (0, _get3.default)(Color.prototype.__proto__ || (0, _getPrototypeOf2.default)(Color.prototype), 'destroy', this).call(this);
        }
    }]);
    return Color;
}(_XbsjBase8.default);

Color.defaultOptions = {
    /**
     * 颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 1, 1]
     * @memberof Obj.Polyline.Material.Color
     */
    color: [1, 1, 1, 1]
    // color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加'},     
};

/**
* 点画线材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

var PolylineDash = function (_XbsjBase2) {
    (0, _inherits3.default)(PolylineDash, _XbsjBase2);

    function PolylineDash() {
        (0, _classCallCheck3.default)(this, PolylineDash);

        var _this2 = (0, _possibleConstructorReturn3.default)(this, (PolylineDash.__proto__ || (0, _getPrototypeOf2.default)(PolylineDash)).call(this));

        (0, _mobx.extendObservable)(_this2, {
            _material: Cesium.Material.fromType('PolylineDash'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this2.disposers.push((0, _mobx.autorun)(function () {
            (0, _keys2.default)(_this2._defaultOptions).forEach(function (key) {
                if (key === 'color' || key === 'gapColor') {
                    _this2._material.uniforms[key] = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this2[key]))))();
                } else {
                    _this2._material.uniforms[key] = _this2[key];
                }
            });
        }));
        return _this2;
    }

    return PolylineDash;
}(_XbsjBase8.default);

PolylineDash.defaultOptions = {
    /**
     * 颜色叠加 color for the line.
     * @type {array}
     * @instance
     * @default [1, 0, 1, 1]
     * @memberof Obj.Polyline.Material.PolylineDash
     */
    color: [1, 0, 1, 1], // color for the line.
    /**
     * 间隙颜色叠加 color for the gaps in the line.
     * @type {array}
     * @instance
     * @default [0, 0, 0, 0]]
     * @memberof Obj.Polyline.Material.PolylineDash
     */
    gapColor: [0, 0, 0, 0], // color for the gaps in the line.
    /**
     * Dash length in pixels.
     * @type {number}
     * @instance
     * @default 16
     * @memberof Obj.Polyline.Material.PolylineDash
     */
    dashLength: 16, // Dash length in pixels.
    /**
     * The 16 bit stipple pattern for the line..
     * @type {number}
     * @instance
     * @default 255
     * @memberof Obj.Polyline.Material.PolylineDash
     */
    dashPattern: 255 // The 16 bit stipple pattern for the line..
};

/**
* 箭头材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

var PolylineArrow = function (_XbsjBase3) {
    (0, _inherits3.default)(PolylineArrow, _XbsjBase3);

    function PolylineArrow() {
        (0, _classCallCheck3.default)(this, PolylineArrow);

        var _this3 = (0, _possibleConstructorReturn3.default)(this, (PolylineArrow.__proto__ || (0, _getPrototypeOf2.default)(PolylineArrow)).call(this));

        (0, _mobx.extendObservable)(_this3, {
            _material: Cesium.Material.fromType('PolylineArrow'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this3.disposers.push((0, _mobx.autorun)(function () {
            (0, _keys2.default)(_this3._defaultOptions).forEach(function (key) {
                if (key === 'color') {
                    _this3._material.uniforms[key] = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this3[key]))))();
                } else {
                    _this3._material.uniforms[key] = _this3[key];
                }
            });
        }));
        return _this3;
    }

    return PolylineArrow;
}(_XbsjBase8.default);

PolylineArrow.defaultOptions = {
    /**
     * 颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 1, 1]
     * @memberof Obj.Polyline.Material.PolylineArrow
     */
    color: [1, 1, 1, 1]
};

/**
* 发光材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

var PolylineGlow = function (_XbsjBase4) {
    (0, _inherits3.default)(PolylineGlow, _XbsjBase4);

    function PolylineGlow() {
        (0, _classCallCheck3.default)(this, PolylineGlow);

        var _this4 = (0, _possibleConstructorReturn3.default)(this, (PolylineGlow.__proto__ || (0, _getPrototypeOf2.default)(PolylineGlow)).call(this));

        (0, _mobx.extendObservable)(_this4, {
            _material: Cesium.Material.fromType('PolylineGlow'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this4.disposers.push((0, _mobx.autorun)(function () {
            (0, _keys2.default)(_this4._defaultOptions).forEach(function (key) {
                if (key === 'color') {
                    _this4._material.uniforms[key] = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this4[key]))))();
                } else {
                    _this4._material.uniforms[key] = _this4[key];
                }
            });
        }));
        return _this4;
    }

    return PolylineGlow;
}(_XbsjBase8.default);

PolylineGlow.defaultOptions = {
    /**
     * 颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 1, 1]
     * @memberof Obj.Polyline.Material.PolylineGlow
     */
    color: [1, 1, 1, 1], // color and maximum alpha for the glow on the line.
    /**
     * strength of the glow, as a percentage of the total line width (less than 1.0).
     * @type {number}
     * @instance
     * @default 0.25
     * @memberof Obj.Polyline.Material.PolylineGlow
     */
    glowPower: 0.25, // strength of the glow, as a percentage of the total line width (less than 1.0).
    /**
     * strength of the tapering effect, as a percentage of the total line length. If 1.0 or higher, no taper effect is used.    
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Polyline.Material.PolylineGlow
     */
    taperPower: 1.0 // strength of the tapering effect, as a percentage of the total line length. If 1.0 or higher, no taper effect is used.    
};

/**
* 外轮廓材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

var PolylineOutline = function (_XbsjBase5) {
    (0, _inherits3.default)(PolylineOutline, _XbsjBase5);

    function PolylineOutline() {
        (0, _classCallCheck3.default)(this, PolylineOutline);

        var _this5 = (0, _possibleConstructorReturn3.default)(this, (PolylineOutline.__proto__ || (0, _getPrototypeOf2.default)(PolylineOutline)).call(this));

        (0, _mobx.extendObservable)(_this5, {
            _material: Cesium.Material.fromType('PolylineOutline'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this5.disposers.push((0, _mobx.autorun)(function () {
            (0, _keys2.default)(_this5._defaultOptions).forEach(function (key) {
                if (key === 'color' || key === 'outlineColor') {
                    _this5._material.uniforms[key] = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this5[key]))))();
                } else {
                    _this5._material.uniforms[key] = _this5[key];
                }
            });
        }));
        return _this5;
    }

    return PolylineOutline;
}(_XbsjBase8.default);

PolylineOutline.defaultOptions = {
    /**
     * 颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 1, 1]
     * @memberof Obj.Polyline.Material.PolylineOutline
     */
    color: [1, 1, 1, 1],
    /**
     * 外轮廓颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 1, 1]
     * @memberof Obj.Polyline.Material.PolylineOutline
     */
    outlineColor: [1, 1, 1, 1],
    /**
     * 外轮廓宽度
     * @type {number}
     * @instance
     * @default 0.25
     * @memberof Obj.Polyline.Material.PolylineOutline
     */
    outlineWidth: 0.25
};

/**
* OD线材质
* @class
* @memberof Obj.Polyline.Material
* @extends XbsjBase
*/

var XbsjODLine = function (_XbsjBase6) {
    (0, _inherits3.default)(XbsjODLine, _XbsjBase6);

    function XbsjODLine() {
        (0, _classCallCheck3.default)(this, XbsjODLine);

        var _this6 = (0, _possibleConstructorReturn3.default)(this, (XbsjODLine.__proto__ || (0, _getPrototypeOf2.default)(XbsjODLine)).call(this));

        (0, _mobx.extendObservable)(_this6, {
            _material: Cesium.Material.fromType('XbsjODLine'),
            get material() {
                return this._material;
            }
        }, {
            material: _mobx.computed
        });

        _this6.disposers.push((0, _mobx.autorun)(function () {
            (0, _keys2.default)(_this6._defaultOptions).forEach(function (key) {
                if (key === 'color') {
                    _this6._material.uniforms[key] = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this6[key]))))();
                } else {
                    _this6._material.uniforms[key] = _this6[key];
                }
            });
        }));
        return _this6;
    }

    return XbsjODLine;
}(_XbsjBase8.default);

XbsjODLine.defaultOptions = {
    /**
     * 颜色叠加
     * @type {array}
     * @instance
     * @default [1, 1, 0, 1]
     * @memberof Obj.Polyline.Material.XbsjODLine
     */
    color: [1, 1, 0, 1],
    /**
     * 一次动画的循环帧数
     * @type {number}
     * @instance
     * @default 45
     * @memberof Obj.Polyline.Material.XbsjODLine
     */
    totoalFrameCount: 45
};

/**
 * 折线
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Polyline = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Polyline, _XbsjCzmObj);

    function Polyline(earth, guid) {
        (0, _classCallCheck3.default)(this, Polyline);

        var _this7 = (0, _possibleConstructorReturn3.default)(this, (Polyline.__proto__ || (0, _getPrototypeOf2.default)(Polyline)).call(this, earth, guid));

        _this7._pointsColor = [1, 1, 0, 0.95];

        _this7.material.XbsjColorMaterial = new Color();
        _this7.material.XbsjPolylineDashMaterial = new PolylineDash();
        _this7.material.XbsjPolylineArrowMaterial = new PolylineArrow();
        _this7.material.XbsjODLineMaterial = new XbsjODLine();
        _this7.material.XbsjPolylineGlowMaterial = new PolylineGlow();
        _this7.material.XbsjPolylineOutlineMaterial = new PolylineOutline();

        _XbsjBase8.default.registerProperty(_this7, 'material', Polyline.defaultOptions.material);
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjColorMaterial');
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjPolylineDashMaterial');
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjPolylineArrowMaterial');
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjODLineMaterial');
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjPolylineGlowMaterial');
        _XbsjBase8.default.registerProperty(_this7.material, 'XbsjPolylineOutlineMaterial');

        _this7._primitive = undefined;
        _this7.disposers.push(function () {
            return _this7._primitive && _this7._earth.czm.scene.primitives.remove(_this7._primitive);
        });

        _this7._groundPrimitive = undefined;
        _this7.disposers.push(function () {
            return _this7._groundPrimitive && _this7._earth.czm.scene.groundPrimitives.remove(_this7._groundPrimitive);
        });

        _this7._boundingSphere = undefined;

        _this7.disposers.push((0, _bind2.default)(_this7, 'enabled', _this7, 'show'));

        // // 材质单独处理，避免增上primitive
        // this._disposers.push(autorun(() => {
        //     const czmMaterial = this._materialMap[this.material.type];
        //     if (!this.material[this.material.type]) {
        //         const xbsjConstructor = XbsjObject.typesMap[this.material.type];
        //         this.material[this.material.type] = new xbsjConstructor();
        //     }
        //     const material = this.material[this.material.type];

        //     Object.keys(material._defaultOptions).forEach(key => {
        //         if (key === 'color' || key === 'gapColor') {
        //             czmMaterial.uniforms[key] = new Cesium.Color(...material[key]);
        //         } else {
        //             czmMaterial.uniforms[key] = material[key];
        //         }
        //     });        
        // }));

        var arcTypeMap = {
            GEODESIC: Cesium.ArcType.GEODESIC,
            NONE: Cesium.ArcType.NONE,
            RHUMB: Cesium.ArcType.RHUMB
        };

        {
            var createPrimitive = function createPrimitive() {
                var positions = (0, _uniquePositions2.default)(_this7.positions);
                if (positions.length <= 1) {
                    return undefined;
                }
                var cartesians = positions.map(function (p) {
                    var _Cesium$Cartesian;

                    return (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(p));
                });

                if (_this7.loop && positions.length >= 3) {
                    cartesians.push(cartesians[0]);
                    // 如果只首尾相连，导致的问题时width比较大时，首位相连的线段会有一个小缝
                    cartesians.push(cartesians[1]);
                }
                var czmMaterial = _this7.material[_this7.material.type].material;

                var appearance = new Cesium.PolylineMaterialAppearance({
                    material: czmMaterial,
                    renderState: {
                        depthTest: {
                            enabled: _this7.depthTest
                            // depthMask: this.depthMask, 设置无效，Appearance内部会强行设置
                        }
                        // translucent: this.forceTranslucent, // 这里的设置同样无效，因为material强制控制是否透明
                    } });
                appearance.renderState.depthMask = false;

                var primitive = new Cesium.Primitive({
                    geometryInstances: new Cesium.GeometryInstance({
                        geometry: new Cesium.PolylineGeometry({
                            positions: cartesians,
                            width: _this7.width,
                            vertexFormat: Cesium.PolylineMaterialAppearance.VERTEX_FORMAT,
                            // arcType: Cesium.ArcType.RHUMB, // 会导致z轴忽隐忽现
                            arcType: arcTypeMap[_this7.arcType]
                        }),
                        id: _this7
                    }),
                    appearance: appearance,
                    asynchronous: false, // 防止闪烁
                    allowPicking: _this7.allowPicking, // 不允许拾取
                    compressVertices: false // 提升效率
                });

                var ou = primitive.update;
                var that = _this7;
                primitive.update = function (frameState) {
                    ou.call(this, frameState);
                    this._colorCommands.forEach(function (e) {
                        // e.pass = Cesium.Pass.OVERLAY;
                        that.forcePass && (e.pass = that.forcePass);
                    });
                };

                return primitive;
            };

            var createGroundPrimitive = function createGroundPrimitive() {
                var positions = (0, _uniquePositions2.default)(_this7.positions);
                if (positions.length <= 1) {
                    return undefined;
                }
                var cartesians = positions.map(function (p) {
                    var _Cesium$Cartesian2;

                    return (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(p));
                });

                if (_this7.loop && positions.length >= 3) {
                    cartesians.push(cartesians[0]);
                    // 如果只首尾相连，导致的问题时width比较大时，首位相连的线段会有一个小缝
                    cartesians.push(cartesians[1]);
                }
                var czmMaterial = _this7.material[_this7.material.type].material;

                var groundPrimitive = new Cesium.GroundPolylinePrimitive({
                    geometryInstances: new Cesium.GeometryInstance({
                        geometry: new Cesium.GroundPolylineGeometry({
                            positions: cartesians,
                            width: _this7.width,
                            vertexFormat: Cesium.PolylineMaterialAppearance.VERTEX_FORMAT,
                            // arcType: Cesium.ArcType.RHUMB, // 会导致z轴忽隐忽现
                            arcType: arcTypeMap[_this7.arcType]
                        }),
                        id: _this7
                    }),
                    appearance: new Cesium.PolylineMaterialAppearance({
                        material: czmMaterial,
                        renderState: {
                            depthTest: {
                                enabled: _this7.depthTest
                                // depthMask: this.depthMask,
                            }
                            // translucent: this.forceTranslucent, // 这里的设置同样无效，因为material强制控制是否透明
                        } }),
                    asynchronous: false, // 防止闪烁
                    allowPicking: _this7.allowPicking, // 不允许拾取
                    compressVertices: false // 提升效率
                });

                return groundPrimitive;
            };

            var createPolyline = function createPolyline() {
                var positions = _this7.positions;
                _this7._primitive && _this7._earth.czm.scene.primitives.remove(_this7._primitive);
                _this7._primitive = undefined;
                _this7._groundPrimitive && _this7._earth.czm.scene.groundPrimitives.remove(_this7._groundPrimitive);
                _this7._groundPrimitive = undefined;

                if (positions.length >= 2) {
                    if (!_this7.ground) {
                        _this7._primitive = createPrimitive();
                        _this7._primitive && _this7._earth.czm.scene.primitives.add(_this7._primitive);
                    } else {
                        _this7._groundPrimitive = createGroundPrimitive();
                        _this7._groundPrimitive && _this7._earth.czm.scene.groundPrimitives.add(_this7._groundPrimitive);
                    }
                }
            };

            var updatePolyline = function updatePolyline() {
                var show = _this7.show;
                _this7._primitive && (_this7._primitive.show = show);
                _this7._groundPrimitive && (_this7._groundPrimitive.show = show);

                var czmMaterial = _this7.material[_this7.material.type].material;
                _this7._primitive && (_this7._primitive.appearance.material = czmMaterial);
                _this7._groundPrimitive && (_this7._groundPrimitive.appearance.material = czmMaterial);
            };

            var updateBoundingSphere = function updateBoundingSphere() {
                var positions = _this7.positions;
                var cartesians = positions.map(function (p) {
                    var _Cesium$Cartesian3;

                    return (_Cesium$Cartesian3 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian3, (0, _toConsumableArray3.default)(p));
                });
                _this7._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this7._boundingSphere);
            };

            _this7.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this7.positions.map(function (e) {
                        return [].concat((0, _toConsumableArray3.default)(e));
                    }))),
                    loop: _this7.loop,
                    ground: _this7.ground,
                    depthTest: _this7.depthTest,
                    // depthMask: this.depthMask,
                    // forceTranslucent: this.forceTranslucent,
                    arcType: _this7.arcType,
                    width: _this7.width,
                    allowPicking: _this7.allowPicking
                };
            }, function () {
                createPolyline();
                updateBoundingSphere();
                updatePolyline();
            }));

            _this7.disposers.push((0, _mobx.autorun)(updatePolyline));
        }

        _this7._points = new _Points2.default(earth);
        _this7.disposers.push(function () {
            return _this7._points = _this7._points && _this7._points.destroy();
        });

        _this7.disposers.push((0, _mobx.reaction)(function () {
            return _this7.positions.map(function (p) {
                return [].concat((0, _toConsumableArray3.default)(p));
            });
        }, function (positions) {
            var diffLen = positions.length - _this7._points.points.length;
            if (diffLen > 0) {
                for (var i = 0; i < diffLen; ++i) {
                    _this7._points.points.push({
                        color: [].concat((0, _toConsumableArray3.default)(_this7._pointsColor))
                    });
                }
            } else if (diffLen < 0) {
                for (var _i = 0; _i < -diffLen; ++_i) {
                    var _this7$_points$points;

                    _this7._points.points[positions.length + _i].show = false;
                    (_this7$_points$points = _this7._points.points[positions.length + _i].color).splice.apply(_this7$_points$points, [0, 4].concat((0, _toConsumableArray3.default)(_this7._pointsColor)));
                }
            }

            positions.forEach(function (value, index) {
                var _this7$_points$points2;

                _this7._points.points[index].show = _this7.enabled;
                (_this7$_points$points2 = _this7._points.points[index].position).splice.apply(_this7$_points$points2, [0, 3].concat((0, _toConsumableArray3.default)(value)));
            });
        }, {
            fireImmediately: true
        }));

        _this7.disposers.push((0, _mobx.reaction)(function () {
            return _this7.show && _this7.showHelper || _this7.isSelected;
        }, function (show) {
            _this7._points.show = show;
        }, {
            fireImmediately: true
        }));

        _this7.disposers.push((0, _registerInteractionProperty.registerPolylineCreating)(_this7._earth, _this7, {
            polylineCreatingProperty: 'creating'
        }));

        _this7.disposers.push((0, _registerInteractionProperty.registerPolylineEditing)(_this7._earth, _this7, {
            polylineEditingProperty: 'editing'
        }));
        return _this7;
    }

    (0, _createClass3.default)(Polyline, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }

        // 暂不增加isSelected的联动
        // onclick() {
        //     this.isSelected = true;
        // }

        // onclickout() {
        //     this.isSelected = false;
        // }

    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Polyline.prototype.__proto__ || (0, _getPrototypeOf2.default)(Polyline.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Polyline;
}(_XbsjCzmObj3.default);

Polyline.defaultOptions = {
    positions: [],
    show: true,
    showHelper: false,
    width: 2,
    depthTest: false,
    // depthMask: false, // Appearance.getRenderState()函数会根据translucent来强制修改depthMask属性，透明的就强制不写深度，所以不能直接设置renderState
    // forceTranslucent: false, // 强制设置是否透明，如果强制透明，则depthMask为false
    forcePass: undefined,
    arcType: 'GEODESIC', // GEODESIC 地表最近距离插值 NONE 直线，不插值 RHUMB 保持地理方向一致的插值
    loop: false,
    material: {
        type: 'XbsjColorMaterial',
        XbsjColorMaterial: {},
        XbsjPolylineDashMaterial: {},
        XbsjPolylineArrowMaterial: {},
        XbsjODLineMaterial: {},
        XbsjPolylineGlowMaterial: {},
        XbsjPolylineOutlineMaterial: {}
    },
    ground: false
};

var xbsjSchema = {
    title: "Polyline Property",
    type: "object",
    properties: {
        /**
         * 位置数组，形式如 [[2.012, 0.65, 10], [1.9, 0.7, 20], ...] 每一个元素分别表示 经度、纬度、高度，其中经度纬度以弧度为单位，高度以米为单位
         * @type {array}
         * @instance
         * @default true
         * @memberof Obj.Polyline
         */
        positions: { type: 'array', title: '位置数组', default: [], description: '位置数组' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Polyline
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polyline
         */
        showHelper: { type: 'boolean', title: '是否显示辅助线框', default: false, description: '是否显示辅助线框' },
        /**
         * 线宽，单位像素
         * @type {number}
         * @instance
         * @default 2.0
         * @memberof Obj.Polygon
         */
        width: { type: 'number', title: '线宽，单位像素', default: 2.0, description: '线宽，单位像素' },
        /**
         * 是否开启深度检测
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polyline
         */
        depthTest: { type: 'boolean', title: '是否开启深度检测', default: false, description: '是否开启深度检测' },
        /**
         * 强制修改渲染顺序
         * 目前Cesium的渲染顺序有： <br/>
         *  ENVIRONMENT : 0, <br/>
         *  COMPUTE : 1, <br/>
         *  GLOBE : 2, <br/>
         *  TERRAIN_CLASSIFICATION : 3, <br/>
         *  CESIUM_3D_TILE : 4, <br/>
         *  CESIUM_3D_TILE_CLASSIFICATION : 5, <br/>
         *  CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW : 6, <br/>
         *  OPAQUE : 7, <br/>
         *  TRANSLUCENT : 8, <br/>
         *  OVERLAY : 9, <br/>
         *  NUMBER_OF_PASSES : 10 <br/>
         * @type {number|undefined}
         * @instance
         * @default undefined
         * @memberof Obj.Polyline
         */
        forcePass: { type: ['number', 'undefined'], title: '是否开启深度检测', default: undefined, description: '是否开启深度检测' },
        /**
         * 弧线样式，因为地球是圆形的，两点之间不能走直线，需要确定这个弧线该如何走 <br/>
         * 弧线样式有3种： <br/>
         * GEODESIC 地表最近距离插值 <br/>
         * NONE 直线，不插值 <br/>
         * RHUMB 保持地理方向一致的插值 <br/>
         * @type {string}
         * @instance
         * @default 'GEODESIC'
         * @memberof Obj.Polyline
         */
        arcType: { type: 'string', title: '弧线样式', default: 'GEODESIC', description: '弧线样式' },
        /**
         * 折线材质设置
         * @type {object}
         * @property {string} - 类型，可以是Color/PolylineDash/PolylineArrow/PolylineGlow/PolylineOutline/XbsjODLine
         * @property {Obj.Polyline.Material.Color}  - 纯颜色材质
         * @property {Obj.Polyline.Material.PolylineDash} - 点画线材质
         * @property {Obj.Polyline.Material.PolylineArrow} - 箭头材质
         * @property {Obj.Polyline.Material.PolylineGlow} - 发光材质
         * @property {Obj.Polyline.Material.PolylineOutline} - 外轮廓线材质
         * @property {Obj.Polyline.Material.XbsjODLine} - OD线材质
         * @instance
         * @memberof Obj.Polyline
         */
        material: {},
        /**
         * 是否首尾相连
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polyline
         */
        loop: { type: 'boolean', title: '是否首尾相连', default: false, description: '是否首尾相连' },
        /**
         * 是否贴地
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Polyline
         */
        ground: { type: 'boolean', title: '是否贴地', default: true, description: '是否贴地' }
    }
};

Polyline.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['positions', 'show', 'showHelper', 'width', 'depthTest', 'forcePass', 'arcType', 'loop', 'material', 'ground']
}];

Polyline.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Polyline, 'Polyline');

exports.default = Polyline;

/***/ }),
/* 21 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function _loadJS(jsFilePath, loadCallback) {
    var _doc = document.getElementsByTagName('head')[0];
    var script = document.createElement('script');
    script.setAttribute('type', 'text/javascript');
    script.setAttribute('src', jsFilePath);
    script.onload = script.onreadystatechange = function () {
        if (!this.readyState || this.readyState == 'loaded' || this.readyState == 'complete') {
            // console.log('loadJS done: ' + jsFilePath);
        }
        loadCallback && loadCallback();
        script.onload = script.onreadystatechange = null;
    };
    _doc.appendChild(script);
}

/**
 * 动态加载js文件
 * @param {string} jsFilePath JS文件路径
 * @returns {Promise}
 * @memberof HTML
 */
function loadJS(jsFilePath) {
    var notRequireJS = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : true;

    if (notRequireJS) {
        var originL = window.L;
        if (window.L) {
            window.L = undefined;
        }

        var originWinDefine = window.define;
        if (window.define) {
            window.define = undefined;
        }

        return new _promise2.default(function (resolve, reject) {
            _loadJS(jsFilePath, resolve);
        }).then(function () {
            window.define = originWinDefine;
            window.L = originL;
            return _promise2.default.resolve();
        });
    } else {
        return new _promise2.default(function (resolve, reject) {
            _loadJS(jsFilePath, resolve);
        });
    }
}

/**
 * 动态创建css
 * @param {string} newStyle css样式字符串
 * @memberof HTML
 */
function addCSS(newStyle) {
    var styleElement = document.getElementById('styles_js');

    if (!styleElement) {
        styleElement = document.createElement('style');
        styleElement.type = 'text/css';
        styleElement.id = 'styles_js';
        document.getElementsByTagName('head')[0].appendChild(styleElement);
    }

    styleElement.appendChild(document.createTextNode(newStyle));
}

// element.style.cssText = 'xxxx';
// addNewStyle('.box {height: 100px !important;}');

// 动态加载css文件
/*
* @function 动态加载css文件
* @param {string} options.url -- css资源路径
* @param {function} options.callback -- 加载后回调函数
* @param {string} options.id -- link标签id
*/
function _loadCSS(options) {
    var url = options.url,
        callback = typeof options.callback == "function" ? options.callback : function () {},
        id = options.id,
        node = document.createElement("link"),
        supportOnload = "onload" in node,
        isOldWebKit = +navigator.userAgent.replace(/.*(?:AppleWebKit|AndroidWebKit)\/?(\d+).*/i, "$1") < 536,

    // webkit旧内核做特殊处理
    protectNum = 300000; // 阈值10分钟，一秒钟执行pollCss 500次

    node.rel = "stylesheet";
    node.type = "text/css";
    node.href = url;
    if (typeof id !== "undefined") {
        node.id = id;
    }
    document.getElementsByTagName("head")[0].appendChild(node);

    // for Old WebKit and Old Firefox
    if (isOldWebKit || !supportOnload) {
        // Begin after node insertion
        setTimeout(function () {
            pollCss(node, callback, 0);
        }, 1);
        return;
    }

    if (supportOnload) {
        node.onload = onload;
        node.onerror = function () {
            // 加载失败(404)
            onload();
        };
    } else {
        node.onreadystatechange = function () {
            if (/loaded|complete/.test(node.readyState)) {
                onload();
            }
        };
    }

    function onload() {
        // 确保只跑一次下载操作
        node.onload = node.onerror = node.onreadystatechange = null;

        // 清空node引用，在低版本IE，不清除会造成内存泄露
        node = null;

        callback();
    }

    // 循环判断css是否已加载成功
    /*
    * @param node -- link节点
    * @param callback -- 回调函数
    * @param step -- 计步器，避免无限循环
    */
    function pollCss(node, callback, step) {
        var sheet = node.sheet,
            isLoaded;

        step += 1;

        // 保护，大于10分钟，则不再轮询
        if (step > protectNum) {
            isLoaded = true;

            // 清空node引用
            node = null;

            callback();
            return;
        }

        if (isOldWebKit) {
            // for WebKit < 536
            if (sheet) {
                isLoaded = true;
            }
        } else if (sheet) {
            // for Firefox < 9.0
            try {
                if (sheet.cssRules) {
                    isLoaded = true;
                }
            } catch (ex) {
                // 火狐特殊版本，通过特定值获知是否下载成功
                // The value of `ex.name` is changed from "NS_ERROR_DOM_SECURITY_ERR"
                // to "SecurityError" since Firefox 13.0. But Firefox is less than 9.0
                // in here, So it is ok to just rely on "NS_ERROR_DOM_SECURITY_ERR"
                if (ex.name === "NS_ERROR_DOM_SECURITY_ERR") {
                    isLoaded = true;
                }
            }
        }

        setTimeout(function () {
            if (isLoaded) {
                // 延迟20ms是为了给下载的样式留够渲染的时间
                callback();
            } else {
                pollCss(node, callback, step);
            }
        }, 20);
    }
}

/**
 * 动态加载css文件
 * @param {string} filePath CSS文件路径
 * @returns {Promise}
 * @memberof HTML
 */
function loadCSS(filePath) {
    return new _promise2.default(function (resolve, reject) {
        _loadCSS({ url: filePath, callback: resolve });
    });
}

/**
 * 自动判断并加载js和css文件
 * @memberof HTML
 * @param {string} filePath CSS或者JS文件路径
 * @returns {Promise}
 */
function autoLoad(filePath) {
    if (filePath.endsWith('.js')) {
        return loadJS(filePath);
    } else if (filePath.endsWith('.css')) {
        return loadCSS(filePath);
    }
}

/**
 * 获取js文件的路径
 * @ignore
 * @memberof HTML
 * @returns {Promise}
 */
function getScriptBaseUrl(scriptName) {
    // var scriptRegex = /((?:.*\/)|^)scriptName[\w-]*\.js(?:\W|$)/i;
    var scriptRegex = new RegExp('((?:.*/)|^)' + scriptName + '.js(?:W|$)', 'i');

    var scripts = document.getElementsByTagName('script');
    for (var i = 0, len = scripts.length; i < len; ++i) {
        var src = scripts[i].getAttribute('src');
        var result = scriptRegex.exec(src);
        if (result !== null) {
            return result[1];
        }
    }
    return undefined;
}

function createElement(html) {
    var template = document.createElement('template');
    template.innerHTML = html.trim();
    var e = template.content.firstChild;
    return e;
}

function loadCesium(xbsjCesiumDir) {
    // const xbsjToolsDir = getBaseUrlFromXbsjToolsScript();
    // const xbsjToolsDir = getScriptBaseUrl('XbsjTools');

    // console.log('XBSJENV: ' + XBSJENV);

    // 方便加载其他Cesium库，如果加载了，就不用加载默认的了！
    if (typeof Cesium !== 'undefined') {
        return _promise2.default.resolve(Cesium);
    }

    var p1 = loadCSS(xbsjCesiumDir + 'Widgets/widgets.css');

    var p2 = void 0;
    if (true) {
        p2 = loadJS(xbsjCesiumDir + 'Cesium.js');
    } else {

        // 没办法直接使用import，可能被webpack给禁用了吧，这里用Function套一下！
        var importCesium = function importCesium() {
            return Function('return import(\'' + xbsjCesiumDir + 'Cesium.js\')')();
        };

        // p2 = import(xbsjCesiumDir + 'Cesium.js').then(CesiumM => {


        // 使用import加载以后，CESIUM_BASE_URL无法通过header字段获取到，所以这里得指定一下！
        window.CESIUM_BASE_URL = xbsjCesiumDir;p2 = importCesium().then(function (CesiumM) {
            if (!window.Cesium && CesiumM) {
                window.Cesium = {};
                (0, _keys2.default)(CesiumM).forEach(function (e) {
                    window.Cesium[e] = CesiumM[e];
                });
            } else {
                console.error('load cesium error!');
            }
        });

        // p2 = loadJS(xbsjCesiumDir + 'XbsjTools/requirejs-2.1.20/require.js', false).then(() => {

        //     const rq = 'window.xbsjRequire=require';
        //     eval(rq);

        //     window.xbsjRequire.config({
        //         baseUrl: xbsjCesiumDir,
        //         waitSeconds: 120,
        //     });

        //     return new Promise(resolve => {
        //         window.xbsjRequire(['Cesium'], Cesium => {
        //             // Cesium和XbsjCesium分拆之后会出现window.Cesium已赋值的情况
        //             // window.Cesium = Cesium;
        //             window.Cesium = window.Cesium || Cesium;
        //             resolve(Cesium);
        //         });
        //     });
        // });
    }

    return _promise2.default.all([p1, p2]);
}

function loadMapV() {
    return loadJS(HTML.xbsjEarthDir + 'thirdParty/mapv/mapv.min.js');
}

var xbsjEarthDir = void 0;

/**
 * 网页加载相关工具集合
 * @namespace
 */
var HTML = {
    loadJS: loadJS,
    loadCSS: loadCSS,
    addCSS: addCSS,
    autoLoad: autoLoad,
    loadCesium: loadCesium,
    loadMapV: loadMapV,
    getScriptBaseUrl: getScriptBaseUrl,
    createElement: createElement,
    /**
     * Cesium的加载路径
     * @type {string}
     * @readonly
     * @instance
     */
    get nativeCesiumDir() {
        window.xbsjNativeCesiumDir = window.xbsjNativeCesiumDir || window.xbsjCesiumDir || HTML.getScriptBaseUrl('XbsjEarth') + '../XbsjCesium/';
        return xbsjNativeCesiumDir;
    },
    /**
     * Cesium的加载路径
     * @type {string}
     * @readonly
     * @instance
     */
    get cesiumDir() {
        window.xbsjCesiumDir = window.xbsjCesiumDir || HTML.getScriptBaseUrl('XbsjEarth') + '../XbsjCesium/';
        return xbsjCesiumDir;
    },
    /**
     * XbsjEarth的加载路径
     * @type {string}
     * @readonly
     * @instance
     */
    get xbsjEarthDir() {
        window.xbsjEarthDir = window.xbsjEarthDir || HTML.getScriptBaseUrl('XbsjEarth');
        return window.xbsjEarthDir;
    }
};

exports.default = HTML;

/***/ }),
/* 22 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Subscription; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isObject__ = __webpack_require__(120);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isFunction__ = __webpack_require__(86);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_UnsubscriptionError__ = __webpack_require__(175);
/** PURE_IMPORTS_START _util_isArray,_util_isObject,_util_isFunction,_util_UnsubscriptionError PURE_IMPORTS_END */




var Subscription = /*@__PURE__*/ (function () {
    function Subscription(unsubscribe) {
        this.closed = false;
        this._parentOrParents = null;
        this._subscriptions = null;
        if (unsubscribe) {
            this._unsubscribe = unsubscribe;
        }
    }
    Subscription.prototype.unsubscribe = function () {
        var errors;
        if (this.closed) {
            return;
        }
        var _a = this, _parentOrParents = _a._parentOrParents, _unsubscribe = _a._unsubscribe, _subscriptions = _a._subscriptions;
        this.closed = true;
        this._parentOrParents = null;
        this._subscriptions = null;
        if (_parentOrParents instanceof Subscription) {
            _parentOrParents.remove(this);
        }
        else if (_parentOrParents !== null) {
            for (var index = 0; index < _parentOrParents.length; ++index) {
                var parent_1 = _parentOrParents[index];
                parent_1.remove(this);
            }
        }
        if (Object(__WEBPACK_IMPORTED_MODULE_2__util_isFunction__["a" /* isFunction */])(_unsubscribe)) {
            try {
                _unsubscribe.call(this);
            }
            catch (e) {
                errors = e instanceof __WEBPACK_IMPORTED_MODULE_3__util_UnsubscriptionError__["a" /* UnsubscriptionError */] ? flattenUnsubscriptionErrors(e.errors) : [e];
            }
        }
        if (Object(__WEBPACK_IMPORTED_MODULE_0__util_isArray__["a" /* isArray */])(_subscriptions)) {
            var index = -1;
            var len = _subscriptions.length;
            while (++index < len) {
                var sub = _subscriptions[index];
                if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isObject__["a" /* isObject */])(sub)) {
                    try {
                        sub.unsubscribe();
                    }
                    catch (e) {
                        errors = errors || [];
                        if (e instanceof __WEBPACK_IMPORTED_MODULE_3__util_UnsubscriptionError__["a" /* UnsubscriptionError */]) {
                            errors = errors.concat(flattenUnsubscriptionErrors(e.errors));
                        }
                        else {
                            errors.push(e);
                        }
                    }
                }
            }
        }
        if (errors) {
            throw new __WEBPACK_IMPORTED_MODULE_3__util_UnsubscriptionError__["a" /* UnsubscriptionError */](errors);
        }
    };
    Subscription.prototype.add = function (teardown) {
        var subscription = teardown;
        if (!teardown) {
            return Subscription.EMPTY;
        }
        switch (typeof teardown) {
            case 'function':
                subscription = new Subscription(teardown);
            case 'object':
                if (subscription === this || subscription.closed || typeof subscription.unsubscribe !== 'function') {
                    return subscription;
                }
                else if (this.closed) {
                    subscription.unsubscribe();
                    return subscription;
                }
                else if (!(subscription instanceof Subscription)) {
                    var tmp = subscription;
                    subscription = new Subscription();
                    subscription._subscriptions = [tmp];
                }
                break;
            default: {
                throw new Error('unrecognized teardown ' + teardown + ' added to Subscription.');
            }
        }
        var _parentOrParents = subscription._parentOrParents;
        if (_parentOrParents === null) {
            subscription._parentOrParents = this;
        }
        else if (_parentOrParents instanceof Subscription) {
            if (_parentOrParents === this) {
                return subscription;
            }
            subscription._parentOrParents = [_parentOrParents, this];
        }
        else if (_parentOrParents.indexOf(this) === -1) {
            _parentOrParents.push(this);
        }
        else {
            return subscription;
        }
        var subscriptions = this._subscriptions;
        if (subscriptions === null) {
            this._subscriptions = [subscription];
        }
        else {
            subscriptions.push(subscription);
        }
        return subscription;
    };
    Subscription.prototype.remove = function (subscription) {
        var subscriptions = this._subscriptions;
        if (subscriptions) {
            var subscriptionIndex = subscriptions.indexOf(subscription);
            if (subscriptionIndex !== -1) {
                subscriptions.splice(subscriptionIndex, 1);
            }
        }
    };
    Subscription.EMPTY = (function (empty) {
        empty.closed = true;
        return empty;
    }(new Subscription()));
    return Subscription;
}());

function flattenUnsubscriptionErrors(errors) {
    return errors.reduce(function (errs, err) { return errs.concat((err instanceof __WEBPACK_IMPORTED_MODULE_3__util_UnsubscriptionError__["a" /* UnsubscriptionError */]) ? err.errors : err); }, []);
}
//# sourceMappingURL=Subscription.js.map


/***/ }),
/* 23 */
/***/ (function(module, exports, __webpack_require__) {

// Thank's IE8 for his funny defineProperty
module.exports = !__webpack_require__(39)(function () {
  return Object.defineProperty({}, 'a', { get: function () { return 7; } }).a != 7;
});


/***/ }),
/* 24 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Subscriber; });
/* unused harmony export SafeSubscriber */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isFunction__ = __webpack_require__(86);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Observer__ = __webpack_require__(174);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__internal_symbol_rxSubscriber__ = __webpack_require__(121);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__config__ = __webpack_require__(87);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__util_hostReportError__ = __webpack_require__(119);
/** PURE_IMPORTS_START tslib,_util_isFunction,_Observer,_Subscription,_internal_symbol_rxSubscriber,_config,_util_hostReportError PURE_IMPORTS_END */







var Subscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](Subscriber, _super);
    function Subscriber(destinationOrNext, error, complete) {
        var _this = _super.call(this) || this;
        _this.syncErrorValue = null;
        _this.syncErrorThrown = false;
        _this.syncErrorThrowable = false;
        _this.isStopped = false;
        switch (arguments.length) {
            case 0:
                _this.destination = __WEBPACK_IMPORTED_MODULE_2__Observer__["a" /* empty */];
                break;
            case 1:
                if (!destinationOrNext) {
                    _this.destination = __WEBPACK_IMPORTED_MODULE_2__Observer__["a" /* empty */];
                    break;
                }
                if (typeof destinationOrNext === 'object') {
                    if (destinationOrNext instanceof Subscriber) {
                        _this.syncErrorThrowable = destinationOrNext.syncErrorThrowable;
                        _this.destination = destinationOrNext;
                        destinationOrNext.add(_this);
                    }
                    else {
                        _this.syncErrorThrowable = true;
                        _this.destination = new SafeSubscriber(_this, destinationOrNext);
                    }
                    break;
                }
            default:
                _this.syncErrorThrowable = true;
                _this.destination = new SafeSubscriber(_this, destinationOrNext, error, complete);
                break;
        }
        return _this;
    }
    Subscriber.prototype[__WEBPACK_IMPORTED_MODULE_4__internal_symbol_rxSubscriber__["a" /* rxSubscriber */]] = function () { return this; };
    Subscriber.create = function (next, error, complete) {
        var subscriber = new Subscriber(next, error, complete);
        subscriber.syncErrorThrowable = false;
        return subscriber;
    };
    Subscriber.prototype.next = function (value) {
        if (!this.isStopped) {
            this._next(value);
        }
    };
    Subscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            this.isStopped = true;
            this._error(err);
        }
    };
    Subscriber.prototype.complete = function () {
        if (!this.isStopped) {
            this.isStopped = true;
            this._complete();
        }
    };
    Subscriber.prototype.unsubscribe = function () {
        if (this.closed) {
            return;
        }
        this.isStopped = true;
        _super.prototype.unsubscribe.call(this);
    };
    Subscriber.prototype._next = function (value) {
        this.destination.next(value);
    };
    Subscriber.prototype._error = function (err) {
        this.destination.error(err);
        this.unsubscribe();
    };
    Subscriber.prototype._complete = function () {
        this.destination.complete();
        this.unsubscribe();
    };
    Subscriber.prototype._unsubscribeAndRecycle = function () {
        var _parentOrParents = this._parentOrParents;
        this._parentOrParents = null;
        this.unsubscribe();
        this.closed = false;
        this.isStopped = false;
        this._parentOrParents = _parentOrParents;
        return this;
    };
    return Subscriber;
}(__WEBPACK_IMPORTED_MODULE_3__Subscription__["a" /* Subscription */]));

var SafeSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SafeSubscriber, _super);
    function SafeSubscriber(_parentSubscriber, observerOrNext, error, complete) {
        var _this = _super.call(this) || this;
        _this._parentSubscriber = _parentSubscriber;
        var next;
        var context = _this;
        if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isFunction__["a" /* isFunction */])(observerOrNext)) {
            next = observerOrNext;
        }
        else if (observerOrNext) {
            next = observerOrNext.next;
            error = observerOrNext.error;
            complete = observerOrNext.complete;
            if (observerOrNext !== __WEBPACK_IMPORTED_MODULE_2__Observer__["a" /* empty */]) {
                context = Object.create(observerOrNext);
                if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isFunction__["a" /* isFunction */])(context.unsubscribe)) {
                    _this.add(context.unsubscribe.bind(context));
                }
                context.unsubscribe = _this.unsubscribe.bind(_this);
            }
        }
        _this._context = context;
        _this._next = next;
        _this._error = error;
        _this._complete = complete;
        return _this;
    }
    SafeSubscriber.prototype.next = function (value) {
        if (!this.isStopped && this._next) {
            var _parentSubscriber = this._parentSubscriber;
            if (!__WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                this.__tryOrUnsub(this._next, value);
            }
            else if (this.__tryOrSetError(_parentSubscriber, this._next, value)) {
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.error = function (err) {
        if (!this.isStopped) {
            var _parentSubscriber = this._parentSubscriber;
            var useDeprecatedSynchronousErrorHandling = __WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling;
            if (this._error) {
                if (!useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                    this.__tryOrUnsub(this._error, err);
                    this.unsubscribe();
                }
                else {
                    this.__tryOrSetError(_parentSubscriber, this._error, err);
                    this.unsubscribe();
                }
            }
            else if (!_parentSubscriber.syncErrorThrowable) {
                this.unsubscribe();
                if (useDeprecatedSynchronousErrorHandling) {
                    throw err;
                }
                Object(__WEBPACK_IMPORTED_MODULE_6__util_hostReportError__["a" /* hostReportError */])(err);
            }
            else {
                if (useDeprecatedSynchronousErrorHandling) {
                    _parentSubscriber.syncErrorValue = err;
                    _parentSubscriber.syncErrorThrown = true;
                }
                else {
                    Object(__WEBPACK_IMPORTED_MODULE_6__util_hostReportError__["a" /* hostReportError */])(err);
                }
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.complete = function () {
        var _this = this;
        if (!this.isStopped) {
            var _parentSubscriber = this._parentSubscriber;
            if (this._complete) {
                var wrappedComplete = function () { return _this._complete.call(_this._context); };
                if (!__WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling || !_parentSubscriber.syncErrorThrowable) {
                    this.__tryOrUnsub(wrappedComplete);
                    this.unsubscribe();
                }
                else {
                    this.__tryOrSetError(_parentSubscriber, wrappedComplete);
                    this.unsubscribe();
                }
            }
            else {
                this.unsubscribe();
            }
        }
    };
    SafeSubscriber.prototype.__tryOrUnsub = function (fn, value) {
        try {
            fn.call(this._context, value);
        }
        catch (err) {
            this.unsubscribe();
            if (__WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
                throw err;
            }
            else {
                Object(__WEBPACK_IMPORTED_MODULE_6__util_hostReportError__["a" /* hostReportError */])(err);
            }
        }
    };
    SafeSubscriber.prototype.__tryOrSetError = function (parent, fn, value) {
        if (!__WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
            throw new Error('bad call');
        }
        try {
            fn.call(this._context, value);
        }
        catch (err) {
            if (__WEBPACK_IMPORTED_MODULE_5__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
                parent.syncErrorValue = err;
                parent.syncErrorThrown = true;
                return true;
            }
            else {
                Object(__WEBPACK_IMPORTED_MODULE_6__util_hostReportError__["a" /* hostReportError */])(err);
                return true;
            }
        }
        return false;
    };
    SafeSubscriber.prototype._unsubscribe = function () {
        var _parentSubscriber = this._parentSubscriber;
        this._context = null;
        this._parentSubscriber = null;
        _parentSubscriber.unsubscribe();
    };
    return SafeSubscriber;
}(Subscriber));

//# sourceMappingURL=Subscriber.js.map


/***/ }),
/* 25 */
/***/ (function(module, exports) {

module.exports = function (it) {
  return typeof it === 'object' ? it !== null : typeof it === 'function';
};


/***/ }),
/* 26 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(209), __esModule: true };

/***/ }),
/* 27 */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(30);
var IE8_DOM_DEFINE = __webpack_require__(134);
var toPrimitive = __webpack_require__(96);
var dP = Object.defineProperty;

exports.f = __webpack_require__(23) ? Object.defineProperty : function defineProperty(O, P, Attributes) {
  anObject(O);
  P = toPrimitive(P, true);
  anObject(Attributes);
  if (IE8_DOM_DEFINE) try {
    return dP(O, P, Attributes);
  } catch (e) { /* empty */ }
  if ('get' in Attributes || 'set' in Attributes) throw TypeError('Accessors not supported!');
  if ('value' in Attributes) O[P] = Attributes.value;
  return O;
};


/***/ }),
/* 28 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return isArray; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var isArray = Array.isArray || (function (x) { return x && typeof x.length === 'number'; });
//# sourceMappingURL=isArray.js.map


/***/ }),
/* 29 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjInteractionBinding = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjInteractionBinding, _XbsjBase);

    function XbsjInteractionBinding(earth) {
        (0, _classCallCheck3.default)(this, XbsjInteractionBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjInteractionBinding.__proto__ || (0, _getPrototypeOf2.default)(XbsjInteractionBinding)).call(this));

        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            target: undefined
        }, {
            target: _mobx.observable.ref
        });

        _this._untargetWhenDestroying = undefined;

        // target赋值之后start
        _this.disposers.push((0, _mobx.observe)(_this, 'target', function (changed) {
            // changed.oldValue有可能有值，因为target可能从某个对象直接转到另外一个对象。
            // if (changed.newValue && changed.oldValue) {
            //     throw new Error('error!');
            // }

            if (changed.newValue) {
                var newTarget = changed.newValue;

                if (_this._untargetWhenDestroying) {
                    throw new Error('_untargetWhenDestroying should not be defined!');
                }

                _this._untargetWhenDestroying = (0, _mobx.reaction)(function () {
                    return newTarget.isDestroying;
                }, function (isDestroying) {
                    if (isDestroying) {
                        _this.target = undefined;
                    }
                });

                _this._start(newTarget);
            }
        }));

        // target赋值之前cancel
        _this.disposers.push((0, _mobx.intercept)(_this, 'target', function (changed) {
            // changed.newValue是有可能有值的
            // if (changed.object.value !== changed.newValue && !changed.newValue) {
            //     this._cancel();
            // }
            if (changed.object.value !== changed.newValue) {
                _this._untargetWhenDestroying = _this._untargetWhenDestroying && _this._untargetWhenDestroying();
                _this._cancel();
            }
            return changed;
        }));
        return _this;
    }

    (0, _createClass3.default)(XbsjInteractionBinding, [{
        key: '_init',
        value: function _init() {
            throw new Error('需要具体实现');
        }
    }, {
        key: '_start',
        value: function _start() {
            throw new Error('需要具体实现');
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            throw new Error('需要具体实现');
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(XbsjInteractionBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjInteractionBinding.prototype), 'destroy', this).call(this);
        }
    }]);
    return XbsjInteractionBinding;
}(_XbsjBase3.default);

function targetProperty(reactObject, target, parentCancelFunc) {
    reactObject.target = target;

    // 可以拦截父对象的属性，来确保在editing内部的enabled之前运行。
    var beforeTargetUndefinedDisposer = (0, _mobx.intercept)(reactObject, function (changed) {
        if (changed.name === 'target' && changed.type === 'update') {
            if (changed.newValue) {
                // 如果target是position，这里会监控到
                if (!Array.isArray(changed.newValue)) {
                    throw new Error('changed.newValue should not be true or defined!');
                }
                return changed;
            } else {
                parentCancelFunc();
                return null;
            }
        }
        return changed;
    });

    return function () {
        if (!beforeTargetUndefinedDisposer) {
            throw new Error('beforeTargetUndefinedDisposer should exits!');
        }

        beforeTargetUndefinedDisposer();
        reactObject.target = undefined;
    };
}

XbsjInteractionBinding.targetProperty = targetProperty;

exports.default = XbsjInteractionBinding;

/***/ }),
/* 30 */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(25);
module.exports = function (it) {
  if (!isObject(it)) throw TypeError(it + ' is not an object!');
  return it;
};


/***/ }),
/* 31 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _isIterable2 = __webpack_require__(264);

var _isIterable3 = _interopRequireDefault(_isIterable2);

var _getIterator2 = __webpack_require__(77);

var _getIterator3 = _interopRequireDefault(_getIterator2);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function () {
  function sliceIterator(arr, i) {
    var _arr = [];
    var _n = true;
    var _d = false;
    var _e = undefined;

    try {
      for (var _i = (0, _getIterator3.default)(arr), _s; !(_n = (_s = _i.next()).done); _n = true) {
        _arr.push(_s.value);

        if (i && _arr.length === i) break;
      }
    } catch (err) {
      _d = true;
      _e = err;
    } finally {
      try {
        if (!_n && _i["return"]) _i["return"]();
      } finally {
        if (_d) throw _e;
      }
    }

    return _arr;
  }

  return function (arr, i) {
    if (Array.isArray(arr)) {
      return arr;
    } else if ((0, _isIterable3.default)(Object(arr))) {
      return sliceIterator(arr, i);
    } else {
      throw new TypeError("Invalid attempt to destructure non-iterable instance");
    }
  };
}();

/***/ }),
/* 32 */
/***/ (function(module, exports, __webpack_require__) {

// optional / simple context binding
var aFunction = __webpack_require__(57);
module.exports = function (fn, that, length) {
  aFunction(fn);
  if (that === undefined) return fn;
  switch (length) {
    case 1: return function (a) {
      return fn.call(that, a);
    };
    case 2: return function (a, b) {
      return fn.call(that, a, b);
    };
    case 3: return function (a, b, c) {
      return fn.call(that, a, b, c);
    };
  }
  return function (/* ...args */) {
    return fn.apply(that, arguments);
  };
};


/***/ }),
/* 33 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(241), __esModule: true };

/***/ }),
/* 34 */
/***/ (function(module, exports, __webpack_require__) {

var dP = __webpack_require__(27);
var createDesc = __webpack_require__(58);
module.exports = __webpack_require__(23) ? function (object, key, value) {
  return dP.f(object, key, createDesc(1, value));
} : function (object, key, value) {
  object[key] = value;
  return object;
};


/***/ }),
/* 35 */
/***/ (function(module, exports, __webpack_require__) {

// to indexed object, toObject with fallback for non-array-like ES3 strings
var IObject = __webpack_require__(97);
var defined = __webpack_require__(93);
module.exports = function (it) {
  return IObject(defined(it));
};


/***/ }),
/* 36 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _iterator = __webpack_require__(143);

var _iterator2 = _interopRequireDefault(_iterator);

var _symbol = __webpack_require__(217);

var _symbol2 = _interopRequireDefault(_symbol);

var _typeof = typeof _symbol2.default === "function" && typeof _iterator2.default === "symbol" ? function (obj) { return typeof obj; } : function (obj) { return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj; };

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = typeof _symbol2.default === "function" && _typeof(_iterator2.default) === "symbol" ? function (obj) {
  return typeof obj === "undefined" ? "undefined" : _typeof(obj);
} : function (obj) {
  return obj && typeof _symbol2.default === "function" && obj.constructor === _symbol2.default && obj !== _symbol2.default.prototype ? "symbol" : typeof obj === "undefined" ? "undefined" : _typeof(obj);
};

/***/ }),
/* 37 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(238), __esModule: true };

/***/ }),
/* 38 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(251), __esModule: true };

/***/ }),
/* 39 */
/***/ (function(module, exports) {

module.exports = function (exec) {
  try {
    return !!exec();
  } catch (e) {
    return true;
  }
};


/***/ }),
/* 40 */
/***/ (function(module, exports) {

var hasOwnProperty = {}.hasOwnProperty;
module.exports = function (it, key) {
  return hasOwnProperty.call(it, key);
};


/***/ }),
/* 41 */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.13 ToObject(argument)
var defined = __webpack_require__(93);
module.exports = function (it) {
  return Object(defined(it));
};


/***/ }),
/* 42 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _mobx = __webpack_require__(2);

var _LocalObject = __webpack_require__(107);

var _LocalObject2 = _interopRequireDefault(_LocalObject);

var _types = __webpack_require__(76);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchArrayForArrayAssign = [];
function arrayAssign(l1, l2, r2Tor1, equals) {
    if (!Array.isArray(l1.d)) {
        l1.d = [];
    }
    var r1 = l1.d;
    var r2 = l2.d;

    scratchArrayForArrayAssign.length = r2.length;
    var r2_ = r2Tor1 ? r2Tor1(r2, scratchArrayForArrayAssign) : r2;
    var isEqual = equals ? equals(r1, r2) : r2_.length === r1.length && r2_.every(function (e, index) {
        return e === r1[index];
    });
    if (!isEqual) {
        // r1.splice(0, r1.length, ...r2_);
        // r1.length = r2_.length; // 去掉多余元素
        if (l1.type === 'vue') {
            if (r2_.some(function (e, i) {
                return l1.d[i] !== e;
            })) {
                var _l1$d;

                (_l1$d = l1.d).splice.apply(_l1$d, [0, l1.d.length].concat((0, _toConsumableArray3.default)(r2_)));
            }
        } else {
            // 这个操作会导致部分binPosition出现问题，纬度突然由弧度变成了角度，引起一些列错误变化
            // 它的每一次element赋值操作都会引起一次l1.d的observe，之后就出问题了
            // 致于为什么observe之后会导致弧度变角度，还不清楚，只是发现改成splice的方式以后就好了
            // splice会引起一次observe，但是observe中如果发现增删的数值相同，即不发生任何变化时，会直接return。
            // r2_.forEach((e, i) => (l1.d[i] !== e) && (l1.d[i] = e));    
            if (r2_.some(function (e, i) {
                return l1.d[i] !== e;
            })) {
                var _l1$d2;

                (_l1$d2 = l1.d).splice.apply(_l1$d2, [0, l1.d.length].concat((0, _toConsumableArray3.default)(r2_)));
            }
        }
    }
}

function assign(l1, l2, r2Tor1, equals) {
    var l1d = l1.d;
    var l2d = l2.d;
    var newValue = r2Tor1 ? r2Tor1(l2d) : l2d;
    var equal = equals ? equals(l1d, l2d) : l1d === newValue;
    if (!equal) {
        l1.d = newValue;
    }
}

var scratchEqualArray = [];

/**
 * MVVM单向绑定
 * @memberof MVVM
 * @description 单向绑定的属性，reactObject1[reactProperty1]将跟踪reactObject2[reactProperty2]，但reactObject1发生变化reactObject2并不会跟踪！
 * @param {object} reactObject1 第一个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} reactProperty1 第一个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} reactObject2 第二个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} reactProperty2 第二个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} [params] 额外参数，暂时保留
 */
function track(reactObject1, reactProperty1, reactObject2, reactProperty2) {
    var _ref = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {},
        _ref$r2Tor = _ref.r2Tor1,
        r2Tor1 = _ref$r2Tor === undefined ? undefined : _ref$r2Tor,
        _ref$equals = _ref.equals,
        equals = _ref$equals === undefined ? undefined : _ref$equals;

    var l1 = new _LocalObject2.default(reactObject1, reactProperty1);
    var l2 = new _LocalObject2.default(reactObject2, reactProperty2);

    var disposers = [];

    if (l2.type === 'xbsjReact') {
        var reactFunc = function reactFunc() {
            if (typeof l2.d === 'undefined') {
                l1.d = undefined;
            } else if ((0, _types.isNativeArray)(l2.d)) {
                // observe取代
                // arrayAssign(l1, l2, r2Tor1, equals);
                if (l2.d.length === l1.d.length) {
                    arrayAssign(l1, l2, r2Tor1, equals);
                    // if (l1.d.length >= 2 && l1.d[1] > 180.0) {
                    //     debugger;
                    // }
                }
            } else if ((0, _types.isNative)(l2.d)) {
                assign(l1, l2, r2Tor1, equals);
            } else {
                if (!Array.isArray(l2.d)) {
                    l1.d = JSON.parse((0, _stringify2.default)(l2.d));
                } else {
                    // observe取代
                    if (l2.d.length === l1.d.length) {
                        // vue不能直接赋值，否则vue不响应！
                        if (l1.type === 'vue') {
                            l1.d = JSON.parse((0, _stringify2.default)(l2.d));
                        } else {
                            l2.d.forEach(function (e, i) {
                                return l1.d[i] = JSON.parse((0, _stringify2.default)(e));
                            });
                        }
                    }
                }
            }
        };

        // 检测l2.d有没发生变化，如果发生变化，就要更改intercep
        var oldL2d = undefined;
        var arrayDisposer = undefined;
        disposers.push(function () {
            return arrayDisposer = arrayDisposer && arrayDisposer();
        });

        var arrayReactFunc = function arrayReactFunc() {
            // 如果l2.d没有发生变化，则直接return
            if (oldL2d && l2.d === oldL2d) {
                return;
            }

            // 如果发生变化了l2.d不是原来的对象了，则取消监听！
            if (oldL2d) {
                arrayDisposer = arrayDisposer && arrayDisposer();
                oldL2d = undefined;
            }

            if (!Array.isArray(l2.d)) {
                return;
            }

            // 重新监听新的对象！通过observe对象修改数组，不需要reactFunc了！
            if (!Array.isArray(l1.d)) {
                l1.d = [];
            }

            oldL2d = l2.d;

            if (Array.isArray(l1.d) && l1.d.length !== l2.d.length) {
                var _l1$d3;

                scratchArrayForArrayAssign.length = oldL2d.length;
                var r2_ = r2Tor1 ? r2Tor1(oldL2d, scratchArrayForArrayAssign) : oldL2d;
                // 如果r2_中的元素是对象，则需要json方式克隆一下！
                r2_.forEach(function (e, i) {
                    !(0, _types.isNative)(e) && (r2_[i] = JSON.parse((0, _stringify2.default)(e)));
                });
                (_l1$d3 = l1.d).splice.apply(_l1$d3, [0, l1.d.length].concat((0, _toConsumableArray3.default)(r2_)));
            }

            arrayDisposer = (0, _mobx.observe)(oldL2d, function (changed) {
                if (changed.type === 'splice') {
                    var _l1$d4;

                    // 没有考虑added和removed都是NaN的情况，此种情况会导致死循环！// vtxf 20200330
                    // if (changed.added && changed.removed && changed.added.length === changed.removed.length &&
                    //     changed.added.every((e, i) => changed.removed[i] === e)) {
                    //         return;
                    // }
                    if (changed.added && changed.removed && changed.added.length === changed.removed.length && changed.added.every(function (e, i) {
                        return changed.removed[i] === e || isNaN(changed.removed[i]) && isNaN(e);
                    })) {
                        return;
                    }

                    // 避免bind，即相互track的元素形成互相add的死循环！！
                    // 这里判断如果数组相同，说明不需要继续splice了！！因为changed.object本身就是变化后的。
                    // const r2_ = r2Tor1 ? r2Tor1(changed.object, scratchArrayForArrayAssign) : changed.object;

                    scratchArrayForArrayAssign.length = oldL2d.length;
                    var _r2_ = r2Tor1 ? r2Tor1(oldL2d, scratchArrayForArrayAssign) : (scratchArrayForArrayAssign.splice.apply(scratchArrayForArrayAssign, [0, oldL2d.length].concat((0, _toConsumableArray3.default)(oldL2d))), scratchArrayForArrayAssign);

                    var equal = false;
                    if (equals) {
                        equal = equals(l1.d, _r2_);
                    } else {
                        equal = _r2_.length === l1.d.length && _r2_.every(function (e, i) {
                            if ((0, _types.isNative)(l1.d[i])) {
                                return l1.d[i] === e;
                            } else {
                                return (0, _stringify2.default)(l1.d[i]) === (0, _stringify2.default)(e);
                            }
                        });
                    }

                    if (equal) {
                        return;
                    }

                    _r2_.length = changed.index + changed.added.length; // 删除尾部元素
                    _r2_.splice(0, changed.index); // 删除首部元素，剩下的就是修改了的元素
                    // 如果r2_中的元素是对象，则需要json方式克隆一下！
                    _r2_.forEach(function (e, i) {
                        !(0, _types.isNative)(e) && (_r2_[i] = JSON.parse((0, _stringify2.default)(e)));
                    });
                    var index = changed.index;
                    var removedCount = changed.removedCount;
                    (_l1$d4 = l1.d).splice.apply(_l1$d4, [index, removedCount].concat((0, _toConsumableArray3.default)(_r2_)));
                    // console.log('---');
                }
            });
        };

        arrayReactFunc();
        reactFunc();

        disposers.push((0, _mobx.reaction)(function () {
            return l2.d;
        }, arrayReactFunc));
        disposers.push((0, _mobx.reaction)(function () {
            if (typeof l2.d === 'undefined') {
                return undefined;
            } else if ((0, _types.isNativeArray)(l2.d)) {
                return [].concat((0, _toConsumableArray3.default)(l2.d));
                // return [...l2.d]; // 不创建新数组，但是不执行是否会有别的问题 vtxf
                // 有问题，会导致不更新！
                // const na = scratchEqualArray;
                // na.splice(0, na.length, ...l2.d);
                // return na;
            } else if ((0, _types.isNative)(l2.d)) {
                return l2.d;
            } else {
                // return JSON.parse(JSON.stringify(l2.d)); // 这样返回会导致死循环，因为用不相等
                return (0, _stringify2.default)(l2.d); // 直接返回字符串！
            }
        }, reactFunc));
    } else if (l2.type === 'vue') {
        var _reactFunc = function _reactFunc() {
            if (typeof l2.d === 'undefined') {
                l1.d = undefined;
            } else if ((0, _types.isNativeArray)(l2.d)) {
                arrayAssign(l1, l2, r2Tor1, equals);
                // if (l1.d.length >= 2 && l1.d[1] > 1.0) {
                //     debugger;
                // }
            } else if ((0, _types.isNative)(l2.d)) {
                assign(l1, l2, r2Tor1, equals);
            } else {
                l1.d = JSON.parse((0, _stringify2.default)(l2.d));
            }
        };

        // 强制执行一次！
        _reactFunc();
        disposers.push(reactObject2.$watch(reactProperty2, _reactFunc, { deep: true }));
    }

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.default = track;

/***/ }),
/* 43 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var pointDefaultOptions = {
    color: [1, 1, 0, 0.95],
    // disableDepthTestDistance,
    // distanceDisplayCondition,
    // id,
    // outlineColor,
    // outlineWidth,
    pixelSize: 6,
    position: [0, 0, 0],
    // scaleByDistance,
    show: true,
    // translucencyByDistance,    
    disableDepthTestDistance: Number.POSITIVE_INFINITY
};

var Points = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Points, _XbsjCzmObj);

    function Points(earth, guid) {
        (0, _classCallCheck3.default)(this, Points);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Points.__proto__ || (0, _getPrototypeOf2.default)(Points)).call(this, earth, guid));

        _this._primitive = new Cesium.PointPrimitiveCollection();
        var ou = _this._primitive.update;
        var that = _this;
        _this._primitive.update = function (frameState) {

            // PointPrimitiveCollection绘制的深度有问题，会导致拾取位置时出错！此处通过不写depthMask来达成。
            if (!this._rsOpaque || this._rsOpaque.depthMask) {
                this._rsOpaque = Cesium.RenderState.fromCache({
                    depthTest: {
                        enabled: true,
                        func: Cesium.WebGLConstants.LESS
                    },
                    depthMask: false
                });
            }

            ou.call(this, frameState);
            this._colorCommands.forEach(function (e) {
                if (that.forcePass) {
                    e.originPass = e.originPass || e.pass;
                    e.pass = that.forcePass;
                } else if (e.originPass && e.originPass !== e.pass) {
                    e.pass = e.originPass;
                    e.originPass = undefined;
                }
            });
        };

        _this._primitiveWrapper = new Cesium.PrimitiveCollection(); // 因为PointPrimitiveCollection没有show属性，所以多包装一层
        _this._primitiveWrapper.add(_this._primitive);
        _this._earth.czm.scene.primitives.add(_this._primitiveWrapper);

        _this.disposers.push(function () {
            _this._primitive && _this._primitiveWrapper.remove(_this._primitive);
            _this._primitiveWrapper && _this._earth.czm.scene.primitives.remove(_this._primitiveWrapper);
        });

        _this._boundingSphere = undefined;

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this.disposers.push((0, _mobx.autorun)(function () {
            var show = _this.show;
            if (_this._primitiveWrapper) {
                _this._primitiveWrapper.show = show;
            }
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return (0, _stringify2.default)(_this.points);
        }, function () {
            _this._primitive.removeAll();
            var cartesians = [];
            var points = _this.points;
            points.forEach(function (point) {
                var _Cesium$Cartesian;

                var cp = {};
                (0, _keys2.default)(pointDefaultOptions).forEach(function (key) {
                    cp[key] = point[key];
                });
                cp.color = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(point.color))))();
                cp.position = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(point.position));
                cartesians.push(cp.position);
                _this._primitive.add(cp);
            });

            _this._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this._boundingSphere);
        }));

        // 还有删除属性等操作需要验证
        _this.disposers.push((0, _mobx.intercept)(_this, 'points', function (changed) {
            if (changed.type === 'update') {
                if (Array.isArray(changed.newValue)) {
                    var _this$points;

                    (_this$points = _this.points).splice.apply(_this$points, [0, _this.points.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
                }
            }

            return undefined;
        }));

        // 数组元素改变时需要考虑
        _this.disposers.push((0, _mobx.intercept)(_this.points, function (changed) {
            if (changed.type === 'splice') {
                changed.added.forEach(function (p) {
                    var np = (0, _assign2.default)({}, pointDefaultOptions, p);
                    (0, _assign2.default)(p, np);
                });
            } else if (changed.type === 'update') {
                var p = changed.newValue;
                var np = (0, _assign2.default)({}, pointDefaultOptions, p);
                (0, _assign2.default)(p, np);
            }

            return changed;
        }));
        return _this;
    }

    (0, _createClass3.default)(Points, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Points.prototype.__proto__ || (0, _getPrototypeOf2.default)(Points.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Points;
}(_XbsjCzmObj3.default);

Points.defaultOptions = {
    points: [],
    forcePass: undefined,
    show: true
};

_XbsjObject2.default.registerType(Points, 'Points');

exports.default = Points;

/***/ }),
/* 44 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return EMPTY; });
/* harmony export (immutable) */ __webpack_exports__["b"] = empty;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

var EMPTY = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) { return subscriber.complete(); });
function empty(scheduler) {
    return scheduler ? emptyScheduled(scheduler) : EMPTY;
}
function emptyScheduled(scheduler) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) { return scheduler.schedule(function () { return subscriber.complete(); }); });
}
//# sourceMappingURL=empty.js.map


/***/ }),
/* 45 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isScheduler;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isScheduler(value) {
    return value && typeof value.schedule === 'function';
}
//# sourceMappingURL=isScheduler.js.map


/***/ }),
/* 46 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var $at = __webpack_require__(203)(true);

// 21.1.3.27 String.prototype[@@iterator]()
__webpack_require__(94)(String, 'String', function (iterated) {
  this._t = String(iterated); // target
  this._i = 0;                // next index
// 21.1.5.2.1 %StringIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var index = this._i;
  var point;
  if (index >= O.length) return { value: undefined, done: true };
  point = $at(O, index);
  this._i += point.length;
  return { value: point, done: false };
});


/***/ }),
/* 47 */
/***/ (function(module, exports) {

module.exports = {};


/***/ }),
/* 48 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.14 / 15.2.3.14 Object.keys(O)
var $keys = __webpack_require__(137);
var enumBugKeys = __webpack_require__(100);

module.exports = Object.keys || function keys(O) {
  return $keys(O, enumBugKeys);
};


/***/ }),
/* 49 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(212), __esModule: true };

/***/ }),
/* 50 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _uniquePolygonPositions = __webpack_require__(150);

var _uniquePolygonPositions2 = _interopRequireDefault(_uniquePolygonPositions);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _registerPickingParent = __webpack_require__(108);

var _registerPickingParent2 = _interopRequireDefault(_registerPickingParent);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    positions: [],
    height: 0.0,
    extrudedHeight: null,
    show: true,
    color: [1, 1, 0, 0.5],
    showHelper: false,
    outline: {
        show: true,
        color: [0, 1, 0, 1],
        width: 2.0
    },
    depthTest: false,
    ground: false
};

/**
 * 多边形
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Polygon = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Polygon, _XbsjCzmObj);

    function Polygon(earth, guid) {
        (0, _classCallCheck3.default)(this, Polygon);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Polygon.__proto__ || (0, _getPrototypeOf2.default)(Polygon)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._primitive = undefined;
        _this.disposers.push(function () {
            return _this._primitive && _this._earth.czm.scene.primitives.remove(_this._primitive);
        });
        _this._groundPrimitive = undefined;
        _this.disposers.push(function () {
            return _this._groundPrimitive && _this._earth.czm.scene.groundPrimitives.remove(_this._groundPrimitive);
        });

        _this._boundingSphere = new Cesium.BoundingSphere();

        {
            var czmPolygonColor = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this.color))))();
            var updatePolygonPrimitive = function updatePolygonPrimitive() {
                czmPolygonColor.xbsjFromArray.apply(czmPolygonColor, (0, _toConsumableArray3.default)(_this.color));
                if (_this._primitive) {
                    _this._primitive.show = _this.show;
                }

                if (_this._groundPrimitive) {
                    _this._groundPrimitive.show = _this.show;
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    color: [].concat((0, _toConsumableArray3.default)(_this.color)),
                    show: _this.show
                };
            }, updatePolygonPrimitive));

            var createPolygonPrimitive = function createPolygonPrimitive() {
                _this._primitive && _this._earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;

                _this._groundPrimitive && _this._earth.czm.scene.groundPrimitives.remove(_this._groundPrimitive);
                _this._groundPrimitive = undefined;

                if (!_this.ground) {
                    var positions = (0, _uniquePolygonPositions2.default)(_this.positions);

                    if (positions.length >= 3) {
                        var polygonGeometry = new Cesium.PolygonGeometry({
                            polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromRadiansArray(positions)),
                            height: _this.height,
                            extrudedHeight: _this.extrudedHeight
                        });

                        var polygonInstance = new Cesium.GeometryInstance({
                            geometry: polygonGeometry,
                            id: _this
                        });

                        var primitive = new Cesium.Primitive({
                            geometryInstances: [polygonInstance],
                            appearance: new Cesium.MaterialAppearance({
                                material: Cesium.Material.fromType('Color'),
                                faceForward: true,
                                renderState: {
                                    depthTest: {
                                        enabled: _this.depthTest
                                        // depthMask: this.depthMask, 设置无效，Appearance内部会强行设置
                                    } }
                            }),
                            asynchronous: false, // 防止闪烁
                            allowPicking: _this.allowPicking, // 不允许拾取
                            compressVertices: false // 提升效率
                        });
                        primitive.appearance.material.uniforms.color = czmPolygonColor;

                        _this._primitive = _this._earth.czm.scene.primitives.add(primitive);
                    }
                } else {
                    var _positions = (0, _uniquePolygonPositions2.default)(_this.positions);

                    if (_positions.length >= 3) {
                        var polygonGeometry = new Cesium.PolygonGeometry({
                            polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromRadiansArray(_positions)),
                            height: _this.height
                        });

                        var polygonInstance = new Cesium.GeometryInstance({
                            geometry: polygonGeometry,
                            id: _this
                        });

                        var groundPrimitive = new Cesium.GroundPrimitive({
                            geometryInstances: [polygonInstance],
                            appearance: new Cesium.MaterialAppearance({
                                material: Cesium.Material.fromType('Color'),
                                faceForward: true
                            }),
                            asynchronous: false, // 防止闪烁
                            allowPicking: _this.allowPicking, // 不允许拾取
                            compressVertices: false // 提升效率                            
                        });
                        groundPrimitive.appearance.material.uniforms.color = czmPolygonColor;

                        _this._groundPrimitive = _this._earth.czm.scene.groundPrimitives.add(groundPrimitive);
                    }
                }
            };

            var updateBoundingSphere = function updateBoundingSphere() {
                var l = _this.positions.length / 2;
                if (l >= 3) {
                    var positionsWithHeight = [];
                    for (var i = 0; i < l; ++i) {
                        positionsWithHeight.push(_this.positions[i * 2], _this.positions[i * 2 + 1], _this.height);
                    }
                    var cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);
                    _this._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this._boundingSphere);
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                    height: _this.height,
                    extrudedHeight: _this.extrudedHeight,
                    ground: _this.ground,
                    depthTest: _this.depthTest
                };
            }, function () {
                createPolygonPrimitive();
                updatePolygonPrimitive();
                updateBoundingSphere();
            }));
        }

        _this._polyline = new _Polyline2.default(earth);
        _this.disposers.push(function () {
            return _this._polyline = _this._polyline && _this._polyline.destroy();
        });

        {

            _this._polyline.material.type = 'XbsjColorMaterial';
            _this._polyline.depthTest = _this.depthTest;
            _this._polyline.loop = true;

            // this._polyline.onclick = (...params) => {
            //     return this.onclick && this.onclick(...params);
            // };
            // this._polyline.onclickout = (...params) => {
            //     return this.onclickout && this.onclickout(...params);
            // };
            // this._polyline.onmouseover = (...params) => {
            //     return this.onmouseover && this.onmouseover(...params);
            // };
            // this._polyline.onmouseout = (...params) => {
            //     return this.onmouseout && this.onmouseout(...params);
            // };
            (0, _registerPickingParent2.default)(_this._polyline, _this);

            _this.disposers.push((0, _mobx.autorun)(function () {
                _this._polyline.material['XbsjColorMaterial'].color = _this.outline.color;
                _this._polyline.width = _this.outline.width;
                _this._polyline.show = _this.show && _this.outline.show;
                _this._polyline.ground = _this.ground;
                _this._polyline.depthTest = _this.depthTest;
            }));

            {
                var getPolylinePositions = function getPolylinePositions() {
                    var l = _this.positions.length / 2;
                    var positions = [];
                    for (var i = 0; i < l; ++i) {
                        positions.push([_this.positions[i * 2], _this.positions[i * 2 + 1], _this.height]);
                    }
                    return positions;
                };

                var setPolylinePositions = function setPolylinePositions(positions) {
                    return _this._polyline && (_this._polyline.positions = positions);
                };
                setPolylinePositions(getPolylinePositions());
                _this.disposers.push((0, _mobx.reaction)(getPolylinePositions, setPolylinePositions));
            }
        }

        /**
         * 是否在三维窗口中编辑
         * @name editing
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polygon
         */

        /**
         * 是否在三维窗口中进行点增加的编辑
         * @name creating
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polygon
         */

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreatingWithHeight)(_this._earth, _this, {
            polygonCreatingWithHeight: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));
        return _this;
    }

    (0, _createClass3.default)(Polygon, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Polygon.prototype.__proto__ || (0, _getPrototypeOf2.default)(Polygon.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Polygon;
}(_XbsjCzmObj3.default);

// positions: [],
// height: 0.0,
// show: true,
// color: [1, 1, 0, 0.5],
// showHelper: false,
// outline: {
//     show: true,
//     color: [0, 1, 0, 1],
//     width: 2.0,
// },
// depthTest: false,
// ground: false,

/**
 * 外轮廓属性
 * @class 
 * @name Outline
 * @memberof Obj.Polygon
 */

var outlineSchema = {
    title: "Polygon outline Property",
    type: "object",
    properties: {
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Polygon.Outline
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 颜色叠加
         * @type {array}
         * @instance
         * @default [0, 1, 0, 1]
         * @memberof Obj.Polygon.Outline
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [0, 1, 0, 1], description: '颜色叠加' },
        /**
         * 线框的宽度
         * @type {number}
         * @instance
         * @default 2.0
         * @memberof Obj.Polygon.Outline
         */
        width: { type: 'number', title: '线框的宽度', default: 2.0, description: '线框的宽度' }
    }
};

var xbsjSchema = {
    title: "Polygon Property",
    type: "object",
    properties: {
        /**
         * 位置数组，形式如 [2.012, 0.65, 1.9, 0.7, ...] 分别表示 [经度, 纬度, 经度, 纬度, ...]，注意经度纬度以弧度为单位。
         * @type {array}
         * @instance
         * @default true
         * @memberof Obj.Polygon
         */
        positions: { type: 'array', title: '位置数组', default: [], description: '位置数组' },
        /**
         * 多边形的高度
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.Polygon
         */
        height: { type: 'number', title: '多边形的高度', default: 0.0, description: '多边形的高度' },
        /**
         * 多边形的拉伸高度
         * @type {number}
         * @instance
         * @default null
         * @memberof Obj.Polygon
         */
        extrudedHeight: { type: 'number', title: '多边形的拉伸高度', default: null, description: '多边形的拉伸高度' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Polygon
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 颜色叠加
         * @type {array}
         * @instance
         * @default [1, 1, 1, 1]
         * @memberof Obj.Polygon
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polygon
         */
        showHelper: { type: 'boolean', title: '是否显示辅助线框', default: false, description: '是否显示辅助线框' },
        /**
         * 外轮廓属性
         * @type {Obj.Polygon.Outline}
         * @instance
         * @memberof Obj.Polygon
         */
        outline: outlineSchema,
        /**
         * 是否开启深度检测
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Polygon
         */
        depthTest: { type: 'boolean', title: '是否开启深度检测', default: false, description: '是否开启深度检测' },
        /**
         * 是否贴地
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Polygon
         */
        ground: { type: 'boolean', title: '是否贴地', default: true, description: '是否贴地' }
    }
};

Polygon.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['positions', 'height', 'show', 'color', 'showHelper', 'outline', 'depthTest', 'ground']
}];

Polygon.xbsjClassification = xbsjClassification;

Polygon.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(Polygon, 'Polygon');

exports.default = Polygon;

/***/ }),
/* 51 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return observable; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var observable = typeof Symbol === 'function' && Symbol.observable || '@@observable';
//# sourceMappingURL=observable.js.map


/***/ }),
/* 52 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return SubjectSubscriber; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Subject; });
/* unused harmony export AnonymousSubject */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__ = __webpack_require__(88);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__SubjectSubscription__ = __webpack_require__(177);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__internal_symbol_rxSubscriber__ = __webpack_require__(121);
/** PURE_IMPORTS_START tslib,_Observable,_Subscriber,_Subscription,_util_ObjectUnsubscribedError,_SubjectSubscription,_internal_symbol_rxSubscriber PURE_IMPORTS_END */







var SubjectSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SubjectSubscriber, _super);
    function SubjectSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.destination = destination;
        return _this;
    }
    return SubjectSubscriber;
}(__WEBPACK_IMPORTED_MODULE_2__Subscriber__["a" /* Subscriber */]));

var Subject = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](Subject, _super);
    function Subject() {
        var _this = _super.call(this) || this;
        _this.observers = [];
        _this.closed = false;
        _this.isStopped = false;
        _this.hasError = false;
        _this.thrownError = null;
        return _this;
    }
    Subject.prototype[__WEBPACK_IMPORTED_MODULE_6__internal_symbol_rxSubscriber__["a" /* rxSubscriber */]] = function () {
        return new SubjectSubscriber(this);
    };
    Subject.prototype.lift = function (operator) {
        var subject = new AnonymousSubject(this, this);
        subject.operator = operator;
        return subject;
    };
    Subject.prototype.next = function (value) {
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        if (!this.isStopped) {
            var observers = this.observers;
            var len = observers.length;
            var copy = observers.slice();
            for (var i = 0; i < len; i++) {
                copy[i].next(value);
            }
        }
    };
    Subject.prototype.error = function (err) {
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        this.hasError = true;
        this.thrownError = err;
        this.isStopped = true;
        var observers = this.observers;
        var len = observers.length;
        var copy = observers.slice();
        for (var i = 0; i < len; i++) {
            copy[i].error(err);
        }
        this.observers.length = 0;
    };
    Subject.prototype.complete = function () {
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        this.isStopped = true;
        var observers = this.observers;
        var len = observers.length;
        var copy = observers.slice();
        for (var i = 0; i < len; i++) {
            copy[i].complete();
        }
        this.observers.length = 0;
    };
    Subject.prototype.unsubscribe = function () {
        this.isStopped = true;
        this.closed = true;
        this.observers = null;
    };
    Subject.prototype._trySubscribe = function (subscriber) {
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        else {
            return _super.prototype._trySubscribe.call(this, subscriber);
        }
    };
    Subject.prototype._subscribe = function (subscriber) {
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_4__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        else if (this.hasError) {
            subscriber.error(this.thrownError);
            return __WEBPACK_IMPORTED_MODULE_3__Subscription__["a" /* Subscription */].EMPTY;
        }
        else if (this.isStopped) {
            subscriber.complete();
            return __WEBPACK_IMPORTED_MODULE_3__Subscription__["a" /* Subscription */].EMPTY;
        }
        else {
            this.observers.push(subscriber);
            return new __WEBPACK_IMPORTED_MODULE_5__SubjectSubscription__["a" /* SubjectSubscription */](this, subscriber);
        }
    };
    Subject.prototype.asObservable = function () {
        var observable = new __WEBPACK_IMPORTED_MODULE_1__Observable__["a" /* Observable */]();
        observable.source = this;
        return observable;
    };
    Subject.create = function (destination, source) {
        return new AnonymousSubject(destination, source);
    };
    return Subject;
}(__WEBPACK_IMPORTED_MODULE_1__Observable__["a" /* Observable */]));

var AnonymousSubject = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AnonymousSubject, _super);
    function AnonymousSubject(destination, source) {
        var _this = _super.call(this) || this;
        _this.destination = destination;
        _this.source = source;
        return _this;
    }
    AnonymousSubject.prototype.next = function (value) {
        var destination = this.destination;
        if (destination && destination.next) {
            destination.next(value);
        }
    };
    AnonymousSubject.prototype.error = function (err) {
        var destination = this.destination;
        if (destination && destination.error) {
            this.destination.error(err);
        }
    };
    AnonymousSubject.prototype.complete = function () {
        var destination = this.destination;
        if (destination && destination.complete) {
            this.destination.complete();
        }
    };
    AnonymousSubject.prototype._subscribe = function (subscriber) {
        var source = this.source;
        if (source) {
            return this.source.subscribe(subscriber);
        }
        else {
            return __WEBPACK_IMPORTED_MODULE_3__Subscription__["a" /* Subscription */].EMPTY;
        }
    };
    return AnonymousSubject;
}(Subject));

//# sourceMappingURL=Subject.js.map


/***/ }),
/* 53 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = map;
/* unused harmony export MapOperator */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function map(project, thisArg) {
    return function mapOperation(source) {
        if (typeof project !== 'function') {
            throw new TypeError('argument is not a function. Are you looking for `mapTo()`?');
        }
        return source.lift(new MapOperator(project, thisArg));
    };
}
var MapOperator = /*@__PURE__*/ (function () {
    function MapOperator(project, thisArg) {
        this.project = project;
        this.thisArg = thisArg;
    }
    MapOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new MapSubscriber(subscriber, this.project, this.thisArg));
    };
    return MapOperator;
}());

var MapSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](MapSubscriber, _super);
    function MapSubscriber(destination, project, thisArg) {
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.count = 0;
        _this.thisArg = thisArg || _this;
        return _this;
    }
    MapSubscriber.prototype._next = function (value) {
        var result;
        try {
            result = this.project.call(this.thisArg, value, this.count++);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return MapSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));
//# sourceMappingURL=map.js.map


/***/ }),
/* 54 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = from;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_subscribeTo__ = __webpack_require__(128);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__scheduled_scheduled__ = __webpack_require__(187);
/** PURE_IMPORTS_START _Observable,_util_subscribeTo,_scheduled_scheduled PURE_IMPORTS_END */



function from(input, scheduler) {
    if (!scheduler) {
        if (input instanceof __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */]) {
            return input;
        }
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](Object(__WEBPACK_IMPORTED_MODULE_1__util_subscribeTo__["a" /* subscribeTo */])(input));
    }
    else {
        return Object(__WEBPACK_IMPORTED_MODULE_2__scheduled_scheduled__["a" /* scheduled */])(input, scheduler);
    }
}
//# sourceMappingURL=from.js.map


/***/ }),
/* 55 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjSteps = function () {
    function XbsjSteps(earth, steps) {
        var _this = this;

        (0, _classCallCheck3.default)(this, XbsjSteps);

        this._earth = earth;

        (0, _mobx.extendObservable)(this, {
            enabled: false,
            _currentStep: -1, // -1 initial 0-maxStep-1 cancelled maxStep completed
            get currentStep() {
                return this._currentStep;
            },
            get lastStep() {
                return this._currentStep === this._stepObservables.length;
            },
            get status() {
                if (this.enabled) {
                    return 'running';
                } else if (this._currentStep === -1) {
                    return 'inital';
                } else if (this._currentStep === this._stepObservables.length) {
                    return 'completed';
                } else {
                    return 'cancelled';
                }
            }
        }, {
            currentStep: _mobx.computed,
            lastStep: _mobx.computed,
            status: _mobx.computed
        });

        this._stepSwitchObserver = undefined;
        var stepSwitch = new rxjs.Observable(function (obs) {
            _this._stepSwitchObserver = obs;
        }).pipe(rxjs.operators.map(function (stepNo) {
            return _this._currentStep = stepNo, stepNo;
        }), rxjs.operators.share());

        this._stepObservables = steps.map(function (step) {
            var _rxjs;

            var n = step.length / 2;
            var pipes = [];
            for (var i = 0; i < n; ++i) {
                pipes.push(step[i * 2 + 0].pipe(rxjs.operators.map(step[i * 2 + 1])));
            }
            return (_rxjs = rxjs).merge.apply(_rxjs, pipes);
        });

        this._steps$ = stepSwitch.pipe(rxjs.operators.switchMap(function (stepNo) {
            return _this._stepObservables[stepNo];
        }));

        this._disposers = this._disposers || [];
        this._disposers.push((0, _mobx.observe)(this, 'enabled', function (changed) {
            if (changed.newValue) {
                _this._start();
            }
        }));

        this._disposers.push((0, _mobx.intercept)(this, 'enabled', function (changed) {
            if (!changed.newValue) {
                _this._cancel();
            }
            return changed;
        }));
    }

    (0, _createClass3.default)(XbsjSteps, [{
        key: 'goto',
        value: function goto(stepNo) {
            if (stepNo >= 0 && stepNo < this._stepObservables.length) {
                this._stepSwitchObserver.next(stepNo);
            }
        }
    }, {
        key: 'next',
        value: function next() {
            if (this._currentStep + 1 < this._stepObservables.length) {
                this._stepSwitchObserver.next(this._currentStep + 1);
            } else {
                this._currentStep = this._stepObservables.length;
                this.enabled = false;
            }
        }
    }, {
        key: 'prev',
        value: function prev() {
            if (this._currentStep > 0) {
                this._stepSwitchObserver.next(this._currentStep - 1);
            } else {
                throw new Error('steps wrong!');
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            if (!this._subscription) {
                this._subscription = this._steps$.subscribe();
                this._stepSwitchObserver.next(0);
            }
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            if (this._subscription) {
                this._subscription.unsubscribe();
                this._subscription = undefined;
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }]);
    return XbsjSteps;
}();

exports.default = XbsjSteps;

/***/ }),
/* 56 */
/***/ (function(module, exports) {

module.exports = true;


/***/ }),
/* 57 */
/***/ (function(module, exports) {

module.exports = function (it) {
  if (typeof it != 'function') throw TypeError(it + ' is not a function!');
  return it;
};


/***/ }),
/* 58 */
/***/ (function(module, exports) {

module.exports = function (bitmap, value) {
  return {
    enumerable: !(bitmap & 1),
    configurable: !(bitmap & 2),
    writable: !(bitmap & 4),
    value: value
  };
};


/***/ }),
/* 59 */
/***/ (function(module, exports) {

var toString = {}.toString;

module.exports = function (it) {
  return toString.call(it).slice(8, -1);
};


/***/ }),
/* 60 */
/***/ (function(module, exports, __webpack_require__) {

var def = __webpack_require__(27).f;
var has = __webpack_require__(40);
var TAG = __webpack_require__(18)('toStringTag');

module.exports = function (it, tag, stat) {
  if (it && !has(it = stat ? it : it.prototype, TAG)) def(it, TAG, { configurable: true, value: tag });
};


/***/ }),
/* 61 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(215);
var global = __webpack_require__(17);
var hide = __webpack_require__(34);
var Iterators = __webpack_require__(47);
var TO_STRING_TAG = __webpack_require__(18)('toStringTag');

var DOMIterables = ('CSSRuleList,CSSStyleDeclaration,CSSValueList,ClientRectList,DOMRectList,DOMStringList,' +
  'DOMTokenList,DataTransferItemList,FileList,HTMLAllCollection,HTMLCollection,HTMLFormElement,HTMLSelectElement,' +
  'MediaList,MimeTypeArray,NamedNodeMap,NodeList,PaintRequestList,Plugin,PluginArray,SVGLengthList,SVGNumberList,' +
  'SVGPathSegList,SVGPointList,SVGStringList,SVGTransformList,SourceBufferList,StyleSheetList,TextTrackCueList,' +
  'TextTrackList,TouchList').split(',');

for (var i = 0; i < DOMIterables.length; i++) {
  var NAME = DOMIterables[i];
  var Collection = global[NAME];
  var proto = Collection && Collection.prototype;
  if (proto && !proto[TO_STRING_TAG]) hide(proto, TO_STRING_TAG, NAME);
  Iterators[NAME] = Iterators.Array;
}


/***/ }),
/* 62 */
/***/ (function(module, exports) {

exports.f = {}.propertyIsEnumerable;


/***/ }),
/* 63 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = _assign2.default || function (target) {
  for (var i = 1; i < arguments.length; i++) {
    var source = arguments[i];

    for (var key in source) {
      if (Object.prototype.hasOwnProperty.call(source, key)) {
        target[key] = source[key];
      }
    }
  }

  return target;
};

/***/ }),
/* 64 */
/***/ (function(module, exports, __webpack_require__) {

var ctx = __webpack_require__(32);
var call = __webpack_require__(140);
var isArrayIter = __webpack_require__(141);
var anObject = __webpack_require__(30);
var toLength = __webpack_require__(71);
var getIterFn = __webpack_require__(101);
var BREAK = {};
var RETURN = {};
var exports = module.exports = function (iterable, entries, fn, that, ITERATOR) {
  var iterFn = ITERATOR ? function () { return iterable; } : getIterFn(iterable);
  var f = ctx(fn, that, entries ? 2 : 1);
  var index = 0;
  var length, step, iterator, result;
  if (typeof iterFn != 'function') throw TypeError(iterable + ' is not iterable!');
  // fast case for arrays with default iterator
  if (isArrayIter(iterFn)) for (length = toLength(iterable.length); length > index; index++) {
    result = entries ? f(anObject(step = iterable[index])[0], step[1]) : f(iterable[index]);
    if (result === BREAK || result === RETURN) return result;
  } else for (iterator = iterFn.call(iterable); !(step = iterator.next()).done;) {
    result = call(iterator, f, step.value, entries);
    if (result === BREAK || result === RETURN) return result;
  }
};
exports.BREAK = BREAK;
exports.RETURN = RETURN;


/***/ }),
/* 65 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var geodesic = void 0;
function geoDistance(left, right) {
    geodesic = geodesic || new Cesium.EllipsoidGeodesic();

    geodesic.start.longitude = left[0];
    geodesic.start.latitude = left[1];
    geodesic.start.height = 0;
    geodesic.end.longitude = right[0];
    geodesic.end.latitude = right[1];
    geodesic.end.height = 0;

    geodesic.setEndPoints(geodesic.start, geodesic.end);

    return geodesic.surfaceDistance;
}

exports.default = geoDistance;

/***/ }),
/* 66 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AsyncAction; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Action__ = __webpack_require__(387);
/** PURE_IMPORTS_START tslib,_Action PURE_IMPORTS_END */


var AsyncAction = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AsyncAction, _super);
    function AsyncAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        _this.pending = false;
        return _this;
    }
    AsyncAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (this.closed) {
            return this;
        }
        this.state = state;
        var id = this.id;
        var scheduler = this.scheduler;
        if (id != null) {
            this.id = this.recycleAsyncId(scheduler, id, delay);
        }
        this.pending = true;
        this.delay = delay;
        this.id = this.id || this.requestAsyncId(scheduler, this.id, delay);
        return this;
    };
    AsyncAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return setInterval(scheduler.flush.bind(scheduler, this), delay);
    };
    AsyncAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && this.delay === delay && this.pending === false) {
            return id;
        }
        clearInterval(id);
        return undefined;
    };
    AsyncAction.prototype.execute = function (state, delay) {
        if (this.closed) {
            return new Error('executing a cancelled action');
        }
        this.pending = false;
        var error = this._execute(state, delay);
        if (error) {
            return error;
        }
        else if (this.pending === false && this.id != null) {
            this.id = this.recycleAsyncId(this.scheduler, this.id, null);
        }
    };
    AsyncAction.prototype._execute = function (state, delay) {
        var errored = false;
        var errorValue = undefined;
        try {
            this.work(state);
        }
        catch (e) {
            errored = true;
            errorValue = !!e && e || new Error(e);
        }
        if (errored) {
            this.unsubscribe();
            return errorValue;
        }
    };
    AsyncAction.prototype._unsubscribe = function () {
        var id = this.id;
        var scheduler = this.scheduler;
        var actions = scheduler.actions;
        var index = actions.indexOf(this);
        this.work = null;
        this.state = null;
        this.pending = false;
        this.scheduler = null;
        if (index !== -1) {
            actions.splice(index, 1);
        }
        if (id != null) {
            this.id = this.recycleAsyncId(scheduler, id, null);
        }
        this.delay = null;
    };
    return AsyncAction;
}(__WEBPACK_IMPORTED_MODULE_1__Action__["a" /* Action */]));

//# sourceMappingURL=AsyncAction.js.map


/***/ }),
/* 67 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AsyncScheduler; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Scheduler__ = __webpack_require__(179);
/** PURE_IMPORTS_START tslib,_Scheduler PURE_IMPORTS_END */


var AsyncScheduler = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AsyncScheduler, _super);
    function AsyncScheduler(SchedulerAction, now) {
        if (now === void 0) {
            now = __WEBPACK_IMPORTED_MODULE_1__Scheduler__["a" /* Scheduler */].now;
        }
        var _this = _super.call(this, SchedulerAction, function () {
            if (AsyncScheduler.delegate && AsyncScheduler.delegate !== _this) {
                return AsyncScheduler.delegate.now();
            }
            else {
                return now();
            }
        }) || this;
        _this.actions = [];
        _this.active = false;
        _this.scheduled = undefined;
        return _this;
    }
    AsyncScheduler.prototype.schedule = function (work, delay, state) {
        if (delay === void 0) {
            delay = 0;
        }
        if (AsyncScheduler.delegate && AsyncScheduler.delegate !== this) {
            return AsyncScheduler.delegate.schedule(work, delay, state);
        }
        else {
            return _super.prototype.schedule.call(this, work, delay, state);
        }
    };
    AsyncScheduler.prototype.flush = function (action) {
        var actions = this.actions;
        if (this.active) {
            actions.push(action);
            return;
        }
        var error;
        this.active = true;
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (action = actions.shift());
        this.active = false;
        if (error) {
            while (action = actions.shift()) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AsyncScheduler;
}(__WEBPACK_IMPORTED_MODULE_1__Scheduler__["a" /* Scheduler */]));

//# sourceMappingURL=AsyncScheduler.js.map


/***/ }),
/* 68 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = fromArray;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_subscribeToArray__ = __webpack_require__(181);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__scheduled_scheduleArray__ = __webpack_require__(124);
/** PURE_IMPORTS_START _Observable,_util_subscribeToArray,_scheduled_scheduleArray PURE_IMPORTS_END */



function fromArray(input, scheduler) {
    if (!scheduler) {
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](Object(__WEBPACK_IMPORTED_MODULE_1__util_subscribeToArray__["a" /* subscribeToArray */])(input));
    }
    else {
        return Object(__WEBPACK_IMPORTED_MODULE_2__scheduled_scheduleArray__["a" /* scheduleArray */])(input, scheduler);
    }
}
//# sourceMappingURL=fromArray.js.map


/***/ }),
/* 69 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export getSymbolIterator */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return iterator; });
/* unused harmony export $$iterator */
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function getSymbolIterator() {
    if (typeof Symbol !== 'function' || !Symbol.iterator) {
        return '@@iterator';
    }
    return Symbol.iterator;
}
var iterator = /*@__PURE__*/ getSymbolIterator();
var $$iterator = iterator;
//# sourceMappingURL=iterator.js.map


/***/ }),
/* 70 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
var anObject = __webpack_require__(30);
var dPs = __webpack_require__(136);
var enumBugKeys = __webpack_require__(100);
var IE_PROTO = __webpack_require__(98)('IE_PROTO');
var Empty = function () { /* empty */ };
var PROTOTYPE = 'prototype';

// Create object with fake `null` prototype: use iframe Object with cleared prototype
var createDict = function () {
  // Thrash, waste and sodomy: IE GC bug
  var iframe = __webpack_require__(95)('iframe');
  var i = enumBugKeys.length;
  var lt = '<';
  var gt = '>';
  var iframeDocument;
  iframe.style.display = 'none';
  __webpack_require__(138).appendChild(iframe);
  iframe.src = 'javascript:'; // eslint-disable-line no-script-url
  // createDict = iframe.contentWindow.Object;
  // html.removeChild(iframe);
  iframeDocument = iframe.contentWindow.document;
  iframeDocument.open();
  iframeDocument.write(lt + 'script' + gt + 'document.F=Object' + lt + '/script' + gt);
  iframeDocument.close();
  createDict = iframeDocument.F;
  while (i--) delete createDict[PROTOTYPE][enumBugKeys[i]];
  return createDict();
};

module.exports = Object.create || function create(O, Properties) {
  var result;
  if (O !== null) {
    Empty[PROTOTYPE] = anObject(O);
    result = new Empty();
    Empty[PROTOTYPE] = null;
    // add "__proto__" for Object.getPrototypeOf polyfill
    result[IE_PROTO] = O;
  } else result = createDict();
  return Properties === undefined ? result : dPs(result, Properties);
};


/***/ }),
/* 71 */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.15 ToLength
var toInteger = __webpack_require__(92);
var min = Math.min;
module.exports = function (it) {
  return it > 0 ? min(toInteger(it), 0x1fffffffffffff) : 0; // pow(2, 53) - 1 == 9007199254740991
};


/***/ }),
/* 72 */
/***/ (function(module, exports) {

var id = 0;
var px = Math.random();
module.exports = function (key) {
  return 'Symbol('.concat(key === undefined ? '' : key, ')_', (++id + px).toString(36));
};


/***/ }),
/* 73 */
/***/ (function(module, exports, __webpack_require__) {

// getting tag from 19.1.3.6 Object.prototype.toString()
var cof = __webpack_require__(59);
var TAG = __webpack_require__(18)('toStringTag');
// ES3 wrong here
var ARG = cof(function () { return arguments; }()) == 'Arguments';

// fallback for IE11 Script Access Denied error
var tryGet = function (it, key) {
  try {
    return it[key];
  } catch (e) { /* empty */ }
};

module.exports = function (it) {
  var O, T, B;
  return it === undefined ? 'Undefined' : it === null ? 'Null'
    // @@toStringTag case
    : typeof (T = tryGet(O = Object(it), TAG)) == 'string' ? T
    // builtinTag case
    : ARG ? cof(O)
    // ES3 arguments fallback
    : (B = cof(O)) == 'Object' && typeof O.callee == 'function' ? 'Arguments' : B;
};


/***/ }),
/* 74 */
/***/ (function(module, exports, __webpack_require__) {

// most Object methods by ES6 should accept primitives
var $export = __webpack_require__(16);
var core = __webpack_require__(14);
var fails = __webpack_require__(39);
module.exports = function (KEY, exec) {
  var fn = (core.Object || {})[KEY] || Object[KEY];
  var exp = {};
  exp[KEY] = exec(fn);
  $export($export.S + $export.F * fails(function () { fn(1); }), 'Object', exp);
};


/***/ }),
/* 75 */
/***/ (function(module, exports, __webpack_require__) {

var META = __webpack_require__(72)('meta');
var isObject = __webpack_require__(25);
var has = __webpack_require__(40);
var setDesc = __webpack_require__(27).f;
var id = 0;
var isExtensible = Object.isExtensible || function () {
  return true;
};
var FREEZE = !__webpack_require__(39)(function () {
  return isExtensible(Object.preventExtensions({}));
});
var setMeta = function (it) {
  setDesc(it, META, { value: {
    i: 'O' + ++id, // object ID
    w: {}          // weak collections IDs
  } });
};
var fastKey = function (it, create) {
  // return primitive with prefix
  if (!isObject(it)) return typeof it == 'symbol' ? it : (typeof it == 'string' ? 'S' : 'P') + it;
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return 'F';
    // not necessary to add metadata
    if (!create) return 'E';
    // add missing metadata
    setMeta(it);
  // return object ID
  } return it[META].i;
};
var getWeak = function (it, create) {
  if (!has(it, META)) {
    // can't set metadata to uncaught frozen object
    if (!isExtensible(it)) return true;
    // not necessary to add metadata
    if (!create) return false;
    // add missing metadata
    setMeta(it);
  // return hash weak collections IDs
  } return it[META].w;
};
// add metadata on freeze-family methods calling
var onFreeze = function (it) {
  if (FREEZE && meta.NEED && isExtensible(it) && !has(it, META)) setMeta(it);
  return it;
};
var meta = module.exports = {
  KEY: META,
  NEED: false,
  fastKey: fastKey,
  getWeak: getWeak,
  onFreeze: onFreeze
};


/***/ }),
/* 76 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.isArrayWithNativeArray = exports.isNativeArray = exports.isObject = exports.isArray = exports.isBoolean = exports.isString = exports.isNumber = exports.isNative = undefined;

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getIterator2 = __webpack_require__(77);

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function isNative(value, fixedType) {
    if (typeof fixedType !== 'undefined') {
        if ((typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) === fixedType) {
            return true;
        } else {
            return false;
        }
    } else {
        return (typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) !== 'object' && typeof value !== 'function';
    }
}

function isNumber(value) {
    return typeof value === 'number';
}

function isString(value) {
    return typeof value === 'string';
}

function isBoolean(value) {
    return typeof value === 'boolean';
}

function isArray(value) {
    return Array.isArray(value);
}

function isObject(value) {
    return !Array.isArray && (typeof value === 'undefined' ? 'undefined' : (0, _typeof3.default)(value)) === 'object';
}

function isNativeArray(value, fixedLength, fixedType) {
    return Array.isArray(value) && value.every(function (e) {
        return isNative(e, fixedType);
    }) && (typeof fixedLength === 'undefined' || value.length === fixedLength);
}

function isArrayWithNativeArray(value, fixedLength, fixedInnerArrayLength, fixedInnerArrayType) {
    return Array.isArray(value) && value.every(function (e) {
        return isNativeArray(e, fixedInnerArrayLength, fixedInnerArrayType);
    }) && (typeof fixedLength === 'undefined' || value.length === fixedLength);
}

// electron没有flat这个函数，所以这里加一下！
if (!Array.prototype.flat) {
    var flat = function flat(arr) {
        if (arr.length < 1 || !arr instanceof Array) return arr;
        var newArray = [];
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
            for (var _iterator = (0, _getIterator3.default)(arr.values()), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var i = _step.value;

                if (i instanceof Array) {
                    newArray = [].concat((0, _toConsumableArray3.default)(newArray), (0, _toConsumableArray3.default)(flat(i)));
                } else {
                    newArray.push(i);
                }
            }
        } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
        } finally {
            try {
                if (!_iteratorNormalCompletion && _iterator.return) {
                    _iterator.return();
                }
            } finally {
                if (_didIteratorError) {
                    throw _iteratorError;
                }
            }
        }

        return newArray;
    };

    Array.prototype.flat = flat;
}

exports.isNative = isNative;
exports.isNumber = isNumber;
exports.isString = isString;
exports.isBoolean = isBoolean;
exports.isArray = isArray;
exports.isObject = isObject;
exports.isNativeArray = isNativeArray;
exports.isArrayWithNativeArray = isArrayWithNativeArray;

/***/ }),
/* 77 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(236), __esModule: true };

/***/ }),
/* 78 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


exports.__esModule = true;

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

exports.default = function (obj, key, value) {
  if (key in obj) {
    (0, _defineProperty2.default)(obj, key, {
      value: value,
      enumerable: true,
      configurable: true,
      writable: true
    });
  } else {
    obj[key] = value;
  }

  return obj;
};

/***/ }),
/* 79 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(267), __esModule: true };

/***/ }),
/* 80 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _XbsjWMTSParser = __webpack_require__(299);

var _XbsjWMTSParser2 = _interopRequireDefault(_XbsjWMTSParser);

var _Math = __webpack_require__(159);

var _Math2 = _interopRequireDefault(_Math);

var _interpolate = __webpack_require__(161);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

_Math2.default.interpolatePositions = _interpolate.interpolatePositions;

var Tool = {
    WMTSParser: _XbsjWMTSParser2.default,
    distance: _Math2.default.distance,
    hpr: _Math2.default.hpr,
    // modelMatrix: Math.modelMatrix,
    Math: _Math2.default
};

exports.default = Tool;

/***/ }),
/* 81 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var getRectangleWorldPositions = function () {
    var scratchEnuMatrix;
    var scratchRotationQuat;
    var scratchSrtMatrix;
    var ccfe;

    function getRectangleWorldPositions(center, width, height, originX, originY, rotation, result) {

        scratchEnuMatrix = scratchEnuMatrix || new Cesium.Matrix4();
        scratchRotationQuat = scratchRotationQuat || new Cesium.Quaternion();
        scratchSrtMatrix = scratchSrtMatrix || new Cesium.Matrix4();
        ccfe = ccfe || Cesium.Cartesian3.fromElements;
        var ox = originX;
        var oy = originY;
        var localPositions = [ccfe(-ox, -oy, 0.0), ccfe(1.0 - ox, -oy, 0.0), ccfe(1.0 - ox, 1.0 - oy, 0.0), ccfe(-ox, 1.0 - oy, 0.0)];

        var enuMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(center, Cesium.Ellipsoid.WGS84, scratchEnuMatrix);

        var rotationQuat = Cesium.Quaternion.fromAxisAngle(Cesium.Cartesian3.UNIT_Z, rotation, scratchRotationQuat);
        var cmftqrs = Cesium.Matrix4.fromTranslationQuaternionRotationScale;
        var srtMatrix = cmftqrs(Cesium.Cartesian3.ZERO, rotationQuat, ccfe(width, height), scratchSrtMatrix);

        var modelMatrix = Cesium.Matrix4.multiply(enuMatrix, srtMatrix, srtMatrix);

        if (typeof result === 'undefined') {
            result = [];
        }

        localPositions.forEach(function (lp, index) {
            if (typeof result[index] === 'undefined') {
                result[index] = new Cesium.Cartesian3();
            }

            Cesium.Matrix4.multiplyByPoint(modelMatrix, lp, result[index]);
        });

        return result;
    }

    return getRectangleWorldPositions;
}();

var scratchCartesian = void 0;
function createGroundRectangle(center, width) {
    var height = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : width;
    var originX = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.5;
    var originY = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 0.5;
    var rotation = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 0.0;
    var image = arguments.length > 6 && arguments[6] !== undefined ? arguments[6] : '';

    var _material$uniforms$co;

    var color = arguments[7];
    var classificationType = arguments[8];

    if (typeof center === 'undefined' || typeof width === 'undefined') {
        console.error('必须设置center和width！');
        return undefined;
    }

    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    var cartesian = Cesium.Cartesian3.fromRadians(center[0], center[1], center[2], undefined, scratchCartesian);

    height = height || width;
    rotation = rotation || 0.0;
    // color = color || Cesium.Color.WHITE;
    color = color || new Cesium.Color(1, 1, 1, 1);
    image = image || '';
    var worldPositions = getRectangleWorldPositions(cartesian, width, height, originX, originY, rotation);
    var material = new Cesium.Material({
        fabric: {
            type: 'Image',
            uniforms: {
                image: image
                // color: color
            }
        }
    });

    (_material$uniforms$co = material.uniforms.color).xbsjFromArray.apply(_material$uniforms$co, (0, _toConsumableArray3.default)(color));

    return new Cesium.GroundPrimitive({
        geometryInstances: new Cesium.GeometryInstance({
            geometry: new Cesium.PolygonGeometry({
                polygonHierarchy: new Cesium.PolygonHierarchy(worldPositions),
                stRotation: -rotation
            })
        }),
        appearance: new Cesium.MaterialAppearance({
            material: material
        }),
        classificationType: classificationType,
        asynchronous: false
    });
}

exports.default = createGroundRectangle;

/***/ }),
/* 82 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function updateRealSceneScale(earth, screenScaleObject) {
    var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
        _ref$positionProperty = _ref.positionProperty,
        positionProperty = _ref$positionProperty === undefined ? 'position' : _ref$positionProperty,
        _ref$screenScalePrope = _ref.screenScalePropery,
        screenScalePropery = _ref$screenScalePrope === undefined ? '_realSceneScale' : _ref$screenScalePrope,
        _ref$fixScreenSizePro = _ref.fixScreenSizeProperty,
        fixScreenSizeProperty = _ref$fixScreenSizePro === undefined ? 'fixScreenSize' : _ref$fixScreenSizePro,
        _ref$scaleProperty = _ref.scaleProperty,
        scaleProperty = _ref$scaleProperty === undefined ? 'scale' : _ref$scaleProperty;

    var scene = earth.czm.scene;
    var scratchCartesian = new Cesium.Cartesian3();
    var sceneScaleUpdate = function sceneScaleUpdate() {
        var scale = screenScaleObject[scaleProperty]; // scale需要提前声明，避免autorun不起作用！
        var fixScreenSize = screenScaleObject[fixScreenSizeProperty];
        var position = screenScaleObject[positionProperty];
        if (screenScaleObject.enabled) {
            var _Cesium$Cartesian;

            var centerCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, scratchCartesian]));
            screenScaleObject[screenScalePropery] = fixScreenSize > 0 ? Cesium.xbsjGetScreenScale(scene, centerCartesian, fixScreenSize) : scale;
        }
    };

    var disposers = [];

    disposers.push(function () {
        var mergeSource = rxjs.race(earth.eventSource.contextSizeChanged, earth.eventSource.cameraChanged);
        var subscription = mergeSource.subscribe(sceneScaleUpdate);
        return function () {
            subscription.unsubscribe();
        };
    }());

    disposers.push((0, _mobx.autorun)(sceneScaleUpdate));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.default = updateRealSceneScale;

/***/ }),
/* 83 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _defineProperty2 = __webpack_require__(78);

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _getModelMatrix = __webpack_require__(160);

var _getModelMatrix2 = _interopRequireDefault(_getModelMatrix);

var _defaultRenderState = __webpack_require__(321);

var _defaultRenderState2 = _interopRequireDefault(_defaultRenderState);

var _Geometry = __webpack_require__(114);

var _Geometry2 = _interopRequireDefault(_Geometry);

var _XbsjCustomPrimitive = __webpack_require__(322);

var _XbsjCustomPrimitive2 = _interopRequireDefault(_XbsjCustomPrimitive);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    position: [0, 0, 0],
    rotation: [0, 0, 0],
    scale: [1, 1, 1],
    show: true,
    modelMatrix: undefined, // 如果modelMatrix有值的话，将忽略position和rotation的设置
    positions: [0, 0, 0, 1, 0, 0, 0, 0.5, 0],
    normals: undefined,
    sts: undefined,
    colors: undefined,
    indices: [0, 1, 2],
    vertexShaderSource: _XbsjCustomPrimitive2.default.defaultVertexShader,
    fragmentShaderSource: _XbsjCustomPrimitive2.default.defaultFragmentShader,
    pass: 7, // Cesium.Pass.OPAQUE,
    primitiveType: WebGLRenderingContext.TRIANGLES, // Cesium.PrimitiveType.TRIANGLES,
    // modelMatrix: Cesium.Matrix4.IDENTITY,
    renderState: _defaultRenderState2.default,
    // texture: undefined,
    color: [1, 1, 1, 1],
    customParams: [0, 0, 0, 0],
    canvasWidth: 0,
    canvasHeight: 0,
    autoRegisterEditing: false, // 是否自动注册编辑
    imageUrl: ''
};

// TODO(vtxf): 大场景支持，双精度浮点数的位置坐标支持上
// TODO(vtxf): 怎样提供方便使用的Canvas来进行任意绘图？
// TODO(vtxf): 提供一些简易常用的几何体坐标信息？

/**
 * 自定义图元
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var CustomPrimitive = function (_XbsjCzmObj) {
    (0, _inherits3.default)(CustomPrimitive, _XbsjCzmObj);

    function CustomPrimitive(earth, guid) {
        (0, _classCallCheck3.default)(this, CustomPrimitive);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CustomPrimitive.__proto__ || (0, _getPrototypeOf2.default)(CustomPrimitive)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));
        // this.disposers.push(registerPositionEditing(this._earth, this));                
        // this.disposers.push(registerRotationEditing(this._earth, this));      

        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'renderState', _defaultRenderState2.default));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'cull', _defaultRenderState2.default.cull));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'polygonOffset', _defaultRenderState2.default.polygonOffset));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'scissorTest', _defaultRenderState2.default.scissorTest));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState.scissorTest, 'rectangle', _defaultRenderState2.default.scissorTest.rectangle));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'depthRange', _defaultRenderState2.default.depthRange));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'depthTest', _defaultRenderState2.default.depthTest));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'colorMask', _defaultRenderState2.default.colorMask));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'blending', _defaultRenderState2.default.blending));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState.blending, 'color', _defaultRenderState2.default.blending.color));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'stencilTest', _defaultRenderState2.default.stencilTest));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState.stencilTest, 'frontOperation', _defaultRenderState2.default.stencilTest.frontOperation));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState.stencilTest, 'backOperation', _defaultRenderState2.default.stencilTest.backOperation));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.renderState, 'sampleCoverage', _defaultRenderState2.default.sampleCoverage));

        (0, _mobx.extendObservable)(_this, {
            _texture: undefined
        }, {
            _texture: _mobx.observable.ref
        });

        _this._scratchMatrix4 = _this._scratchMatrix4 || new Cesium.Matrix4();

        _this._primitive = undefined;
        _this.disposers.push(function () {
            if (_this._primitive) {
                earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });

        _this._modelMatrix = new Cesium.Matrix4();

        var updateModelMatrix = function updateModelMatrix() {
            if (!_this.modelMatrix) {
                (0, _getModelMatrix2.default)(_this.position, _this.rotation, _this.scale, _this._modelMatrix);
            } else {
                Cesium.Matrix4.fromColumnMajorArray(_this.modelMatrix, _this._modelMatrix);
            }
            _this._primitive && (_this._primitive.modelMatrix = _this._modelMatrix);
        };

        updateModelMatrix();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                rotation: [].concat((0, _toConsumableArray3.default)(_this.rotation)),
                scale: [].concat((0, _toConsumableArray3.default)(_this.scale)),
                modelMatrix: _this.modelMatrix ? [].concat((0, _toConsumableArray3.default)(_this.modelMatrix)) : undefined
            };
        }, updateModelMatrix));

        (0, _mobx.extendObservable)(_this, {
            drawCallback: undefined
        }, {
            drawCallback: _mobx.observable.ref
        });

        // updatePrimitive2提到updatePrimitive之前，修复属性持续变化时，show设置之后不起作用的问题。
        var updatePrimitive2 = function updatePrimitive2() {
            if (_this._primitive) {
                _this._primitive.show = _this.show;
                _this._primitive.color = _this.color;
                _this._primitive.setDrawCallback(_this.drawCallback);
            }
        };

        updatePrimitive2();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                show: _this.show,
                color: [].concat((0, _toConsumableArray3.default)(_this.color)),
                drawCallback: _this.drawCallback
            };
        }, updatePrimitive2));

        var updatePrimitive = function updatePrimitive() {
            var _ref;

            var l = _this.positions.length / 3;
            if (l === 0 || _this.normals && l !== _this.normals.length / 3 || _this.sts && l !== _this.sts.length / 2 || _this.colors && l !== _this.colors.length / 4) {
                console.warn('必须保证位置、法向、纹理坐标数量相等！');
                return;
            }

            var indices = _this.indices;
            // console.log('indices: ' + indices.toString());
            if (~indices.findIndex(function (value) {
                return value >= l;
            })) {
                console.warn('有索引超出范围！');
                return;
            }

            if (_this._primitive) {
                earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }

            // let modelMatrix;
            // if (!this.modelMatrix) {
            //     modelMatrix = getModelMatrix(this.position, this.rotation, this.scale, this._scratchMatrix4);
            // } else {
            //     // modelMatrix = Cesium.Matrix4.clone(this.modelMatrix, this._scratchMatrix4);
            //     modelMatrix = Cesium.Matrix4.fromColumnMajorArray(this.modelMatrix, this._scratchMatrix4);
            // }

            _this._primitive = earth.czm.scene.primitives.add(new _XbsjCustomPrimitive2.default((_ref = {
                positions: _this.positions,
                normals: _this.normals,
                sts: _this.sts,
                colors: _this.colors,
                indices: _this.indices,
                modelMatrix: _this._modelMatrix,
                renderState: _this.renderState,
                vertexShaderSource: _this.vertexShaderSource,
                fragmentShaderSource: _this.fragmentShaderSource,
                pass: _this.pass,
                primitiveType: _this.primitiveType
            }, (0, _defineProperty3.default)(_ref, 'renderState', _this.renderState), (0, _defineProperty3.default)(_ref, 'texture', undefined), (0, _defineProperty3.default)(_ref, 'owner', _this), _ref)));

            _this._primitive.customParams = _this.customParams;
            _this._primitive.texture = _this._texture;

            _this._primitive.modelMatrix = _this._modelMatrix;

            // 创建完了以后还得更新一下属性
            updatePrimitive2();
        };

        updatePrimitive();

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                // position: [...this.position],
                // rotation: this.rotation ? [...this.rotation] : undefined,
                // scale: this.scale ? [...this.scale] : undefined,
                // modelMatrix: this.modelMatrix ? [...this.modelMatrix] : undefined,
                positions: _this.positions ? [].concat((0, _toConsumableArray3.default)(_this.positions)) : undefined,
                normals: _this.normals ? [].concat((0, _toConsumableArray3.default)(_this.normals)) : undefined,
                sts: _this.sts ? [].concat((0, _toConsumableArray3.default)(_this.sts)) : undefined,
                colors: _this.colors ? [].concat((0, _toConsumableArray3.default)(_this.colors)) : undefined,
                indices: _this.indices ? [].concat((0, _toConsumableArray3.default)(_this.indices)) : undefined,
                customParams: [].concat((0, _toConsumableArray3.default)(_this.customParams)),
                vertexShaderSource: [].concat((0, _toConsumableArray3.default)(_this.vertexShaderSource)),
                fragmentShaderSource: [].concat((0, _toConsumableArray3.default)(_this.fragmentShaderSource)),
                pass: _this.pass,
                primitiveType: _this.primitiveType,
                renderState: (0, _stringify2.default)(_this.renderState),
                texture: _this._texture
            };
        }, updatePrimitive));

        // extendObservable(this, {
        //     canvasWidth: 0,
        //     canvasHeight: 0,
        // });

        var updateCanvas = function updateCanvas() {
            var textureDirty = !(_this._texture && _this.canvasWidth === _this._texture.width && _this.canvasHeight === _this._texture.height);

            if (textureDirty) {
                _this._texture = _this._texture && _this._texture.destroy();

                if (_this.canvasWidth > 0 && _this.canvasHeight > 0) {
                    _this._texture = new Cesium.Texture({
                        context: earth.czm.scene.context,
                        width: _this.canvasWidth,
                        height: _this.canvasHeight,
                        source: undefined,
                        flipY: true
                        // 一设置就变成了黑色，很无语！！
                        // sampler: new Cesium.Sampler({
                        //     wrapS: Cesium.TextureWrap.REPEAT, 
                        //     wrapT: Cesium.TextureWrap.REPEAT, 
                        //     minificationFilter: Cesium.TextureMinificationFilter.NEAREST, 
                        //     magnificationFilter: Cesium.TextureMagnificationFilter.NEAREST
                        // })
                    });
                }
            }

            if (!_this._canvas) {
                var canvas = document.createElement('canvas');
                _this._canvas = canvas;
                _this._ctx = canvas.getContext('2d');
            }

            if (_this._canvas.width !== _this.canvasWidth || _this._canvas.height !== _this.canvasWidth) {
                _this._canvas.width = _this.canvasWidth;
                _this._canvas.height = _this.canvasHeight;
            }
        };
        _this._updateCanvas = updateCanvas;

        updateCanvas();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                canvasWidth: _this.canvasWidth,
                canvasHeight: _this.canvasHeight
            };
        }, updateCanvas));

        var updateAutoRegisterEditing = function updateAutoRegisterEditing() {
            if (_this.autoRegisterEditing && !_this.creating) {
                _this.registerEditing();
            }
        };
        updateAutoRegisterEditing();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.autoRegisterEditing;
        }, updateAutoRegisterEditing));

        // 这种方式没法处理crossOrigin的情况，换成Cesium的加载方式，Cesium内部会处理好Image图像的加载
        // const updateImage = () => {
        //     if (this.imageUrl) {
        //         this._myImage = this._myImage || new Image();
        //         this._myImage.src = this.imageUrl;
        //         this._myImage.onload = () => {
        //             this.canvasWidth = this._myImage.naturalWidth;
        //             this.canvasHeight = this._myImage.naturalHeight;
        //             this.drawCanvas(ctx => {
        //                 ctx.clearRect(0, 0, this._myImage.naturalWidth, this._myImage.naturalHeight);
        //                 ctx.drawImage(this._myImage, 0, 0);
        //             });
        //         }
        //     }
        // };
        var updateImage = function updateImage() {
            if (_this._imageSubscription) {
                _this._imageSubscription.unsubscribe();
                _this._imageSubscription = undefined;
            }

            if (_this.imageUrl) {
                var _observable = new rxjs.Observable(function (observer) {
                    Cesium.Resource.createIfNeeded(_this.imageUrl).fetchImage().then(function (image) {
                        observer.next(image);
                    });
                });

                _this._imageSubscription = _observable.subscribe(function (image) {
                    _this.canvasWidth = image.naturalWidth;
                    _this.canvasHeight = image.naturalHeight;
                    _this.drawCanvas(function (ctx) {
                        ctx.clearRect(0, 0, image.naturalWidth, image.naturalHeight);
                        ctx.drawImage(image, 0, 0);
                    });
                    _this._innerImage = image;
                });
            } else {
                _this.canvasWidth = 1;
                _this.canvasHeight = 1;
                _this.drawCanvas(function (ctx) {
                    ctx.clearRect(0, 0, 1, 1);
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, 1, 1);
                });
                _this._innerImage = undefined;
            }
        };

        updateImage();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.imageUrl;
        }, updateImage));
        return _this;
    }

    /**
     * 自定义图元会自带一张画布(Canvas)，如果需要使用纹理，则可以在这张画布上进行绘制 <br/>
     * 画布的绘制方法参见：https://developer.mozilla.org/zh-CN/docs/Web/API/Canvas_API/Tutorial/Drawing_shapes
     * @param {function} drawFun 这是一个回调函数，只有一个参数ctx，指示画布的2DContext
     * @example
     * 
     * // 示例1：在画布上绘制几何图形
     * p.canvasWidth = 512;
     * p.canvasHeight = 512;
     * p.drawCanvas(ctx => {
     *     var gradient = ctx.createRadialGradient(256, 256, 0, 256, 256, 256);
     *     gradient.addColorStop(0.1, "rgba(255, 255, 255, 1.0)");
     *     gradient.addColorStop(0.2, "rgba(255, 255, 255, 0.0)");
     *     gradient.addColorStop(0.3, "rgba(255, 255, 255, 0.9)");
     *     gradient.addColorStop(0.5, "rgba(255, 255, 255, 0.0)");
     *     gradient.addColorStop(0.9, "rgba(255, 255, 255, 0.2)");
     *     gradient.addColorStop(1.0, "rgba(255, 255, 255, 1.0)");
       *     ctx.clearRect(0, 0, 512, 512);
     *     ctx.beginPath();
     *     ctx.arc(256, 256, 256, 0, Math.PI * 2, true);
     *     // ctx.fillStyle = "rgb(0, 155, 255)";
     *     ctx.fillStyle = gradient;
     *     ctx.fill();
     *     ctx.restore();
     * });
     * 
     * // 示例2：加载图像，并绘制到Canvas上
     * Cesium.Resource.createIfNeeded('./images/city/billboard.png').fetchImage().then(function(image) {
     *     console.log('image loaded!');
     *     p.canvasWidth = image.naturalWidth;
     *     p.canvasHeight = image.naturalHeight;
     *     p.drawCanvas(ctx => {
     *         ctx.clearRect(0, 0, 512, 256);
     *         ctx.drawImage(image, 0, 0);
     *     });
     * });
     */

    (0, _createClass3.default)(CustomPrimitive, [{
        key: 'drawCanvas',
        value: function drawCanvas(drawFun) {
            if (this.canvasWidth > 0 && this.canvasHeight > 0) {
                // if (!this._texture) {
                //     this._updateCanvas();
                // }
                this._updateCanvas();
                drawFun(this._ctx);
                this._texture.copyFrom(this._canvas);
            } else {
                console.warn('canvas尺寸未设置，无法绘制！');
            }
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            // this._earth.camera.flyTo(this._bsCenter, this._bsRadius);
            if (this._primitive) {
                var bs = this._primitive.boundingSphere;
                var carto = Cesium.Cartographic.fromCartesian(bs.center);
                var radius = bs.radius;
                this._earth.camera.flyTo([carto.longitude, carto.latitude, carto.height], radius * 3.0);
            }
        }

        /**
         * 注册编辑状态，自定义图元初始创建时，不具有creating/positionEditing/rotationEditing属性，不能进行交互操作。如果需要此功能，则需要在创建之后调用此方法。
         * 注意：registerEditing调用之前，对象本身不能有creating/positionEditing/rotationEditing属性，如果之前进行了 xxx.positionEditing = true 等操作，需要先删掉！
         */

    }, {
        key: 'registerEditing',
        value: function registerEditing() {
            this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(this._earth, this, {
                // positionEditingProperty: 'positionEditing',
            }));
            this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(this._earth, this, {
                positionPickingProperty: 'creating'
            }));
            this.disposers.push((0, _registerInteractionProperty.registerRotationEditing)(this._earth, this, {
                // rotationEditingProperty: 'rotationEditing',
            }));
        }
    }, {
        key: 'texture',
        get: function get() {
            return this._texture;
        },
        set: function set(val) {
            this._texture = val;
        }
    }]);
    return CustomPrimitive;
}(_XbsjCzmObj3.default);

var xbsjSchema = {
    title: "CustomPrimitive Property",
    type: "object",
    properties: {
        /**
         * 位置数组 [经度、纬度、高度] <br/>
         * @type {array}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.CustomPrimitive
         */
        position: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '位置 [经度, 纬度, 高度]' },
        /**
         * 姿态数组 [偏航角、俯仰角、翻转角]
         * @type {array}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.CustomPrimitive
         */
        rotation: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '姿态数组 [偏航角、俯仰角、翻转角]' },
        /**
         * 缩放数组 [x向缩放、y向缩放、z向缩放]
         * @type {array}
         * @instance
         * @default [1, 1, 1]
         * @memberof Obj.CustomPrimitive
         */
        scale: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [1, 1, 1], description: '姿态数组 [偏航角、俯仰角、翻转角]' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.CustomPrimitive
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 姿态矩阵，可选，如果modelMatrix有值的话，将忽略position和rotation的设置
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.CustomPrimitive
         */
        modelMatrix: { type: ['array', 'undefined'], items: { type: 'number' }, minItems: 16, maxItems: 16, default: undefined, description: '姿态矩阵' },
        /**
         * 位置数组，必选
         * @type {array}
         * @instance
         * @default [0, 0, 0, 1, 0, 0, 0, 0.5, 0]
         * @memberof Obj.CustomPrimitive
         */
        positions: { type: 'array', items: { type: 'number' }, minItems: 0, default: [0, 0, 0, 1, 0, 0, 0, 0.5, 0], description: '位置数组' },
        /**
         * 法向数组，可选
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.CustomPrimitive
         */
        normals: { type: ['array', 'undefined'], items: { type: 'number' }, minItems: 0, default: undefined, description: '法向数组' },
        /**
         * 纹理坐标数组，可选
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.CustomPrimitive
         */
        sts: { type: ['array', 'undefined'], items: { type: 'number' }, minItems: 0, default: undefined, description: '纹理坐标数组' },
        /**
         * 颜色数组，可选
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.CustomPrimitive
         */
        colors: { type: ['array', 'undefined'], items: { type: 'number' }, minItems: 0, default: undefined, description: '颜色数组' },
        /**
         * 索引数组，必选
         * @type {array}
         * @instance
         * @default [0, 1, 2]
         * @memberof Obj.CustomPrimitive
         */
        indices: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0, 1, 2], description: '索引数组' },
        /**
         * 顶点shader
         * @type {array}
         * @instance
         * @memberof Obj.CustomPrimitive
         */
        vertexShaderSource: { type: 'string', default: _XbsjCustomPrimitive2.default.defaultVertexShader, description: '顶点shader' },
        /**
         * 片元shader
         * @type {array}
         * @instance
         * @memberof Obj.CustomPrimitive
         */
        fragmentShaderSource: { type: 'string', default: _XbsjCustomPrimitive2.default.defaultFragmentShader, description: '片元shader' },
        /**
         * 渲染顺次(Cesium.Pass.OPAQUE(7)) <br/>
         * 目前Cesium的渲染顺序有： <br/>
         *  ENVIRONMENT : 0, <br/>
         *  COMPUTE : 1, <br/>
         *  GLOBE : 2, <br/>
         *  TERRAIN_CLASSIFICATION : 3, <br/>
         *  CESIUM_3D_TILE : 4, <br/>
         *  CESIUM_3D_TILE_CLASSIFICATION : 5, <br/>
         *  CESIUM_3D_TILE_CLASSIFICATION_IGNORE_SHOW : 6, <br/>
         *  OPAQUE : 7, <br/>
         *  TRANSLUCENT : 8, <br/>
         *  OVERLAY : 9, <br/>
         *  NUMBER_OF_PASSES : 10 <br/>
         * @type {number}
         * @default 7
         * @instance
         * @memberof Obj.CustomPrimitive
         */
        pass: { type: 'number', title: '渲染顺次', default: 7, description: '渲染顺次' },
        /**
         * 绘制图元类型 <br/>
         * WebGLRenderingContext.POINTS 0 <br/>
         * WebGLRenderingContext.LINES 1 <br/>
         * WebGLRenderingContext.LINE_LOOP 2 <br/>
         * WebGLRenderingContext.LINE_STRIP 3 <br/>
         * WebGLRenderingContext.TRIANGLES 4 <br/>
         * WebGLRenderingContext.TRIANGLE_STRIP 5 <br/>
         * WebGLRenderingContext.TRIANGLE_FAN 6 <br/>
         * @type {number}
         * @default 4
         * @instance
         * @memberof Obj.CustomPrimitive
         */
        primitiveType: { type: 'number', title: '绘制图元类型', default: 4, description: '绘制图元类型' },
        // modelMatrix: Cesium.Matrix4.IDENTITY,
        /**
         * WebGL渲染状态 <br />
         * @example
         *  // 默认的WebGL渲染状态如下：
         *  var defaults = {
         *      frontFace : WebGL2RenderingContext.CCW, // WindingOrder.COUNTER_CLOCKWISE,
         *      cull : {
         *          enabled : false,
         *          face : WebGL2RenderingContext.BACK, // CullFace.BACK
         *      },
         *      lineWidth : 1,
         *      polygonOffset : {
         *          enabled : false,
         *          factor : 0,
         *          units : 0
         *      },
         *      scissorTest : {
         *          enabled : false,
         *          rectangle : {
         *              x : 0,
         *              y : 0,
         *              width : 0,
         *              height : 0
         *          }
         *      },
         *      depthRange : {
         *          near : 0,
         *          far : 1
         *      },
         *      depthTest : {
         *          enabled : false,
         *          func : WebGL2RenderingContext.LESS, // DepthFunction.LESS
         *      },
         *      colorMask : {
         *          red : true,
         *          green : true,
         *          blue : true,
         *          alpha : true
         *      },
         *      depthMask : true,
         *      stencilMask : ~0,
         *      blending : {
         *          enabled : false,
         *          color : {
         *              red : 0.0,
         *              green : 0.0,
         *              blue : 0.0,
         *              alpha : 0.0
         *          },
         *          equationRgb : WebGL2RenderingContext.ADD, // BlendEquation.ADD,
         *          equationAlpha : WebGL2RenderingContext.ADD, // BlendEquation.ADD,
         *          functionSourceRgb : WebGL2RenderingContext.ONE, // BlendFunction.ONE,
         *          functionSourceAlpha : WebGL2RenderingContext.ONE, // BlendFunction.ONE,
         *          functionDestinationRgb : WebGL2RenderingContext.ZERO, // BlendFunction.ZERO,
         *          functionDestinationAlpha : WebGL2RenderingContext.ZERO, // BlendFunction.ZERO,
         *      },
         *      stencilTest : {
         *          enabled : false,
         *          frontFunction : WebGL2RenderingContext.ALWAYS, // StencilFunction.ALWAYS,
         *          backFunction : WebGL2RenderingContext.ALWAYS, // StencilFunction.ALWAYS,
         *          reference : 0,
         *          mask : ~0,
         *          frontOperation : {
         *              fail : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
         *              zFail : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
         *              zPass : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP
         *          },
         *          backOperation : {
         *              fail : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
         *              zFail : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
         *              zPass : WebGL2RenderingContext.KEEP, // StencilOperation.KEEP
         *          }
         *      },
         *      sampleCoverage : {
         *          enabled : false,
         *          value : 1.0,
         *          invert : false
         *      }
         *  };
         * 
         * @type {object}
         * @default defaultRenderState
         * @instance
         * @memberof Obj.CustomPrimitive
         */
        renderState: { type: 'object', title: 'WebGL渲染状态', default: {}, description: 'WebGL渲染状态' },
        // texture: undefined,
        /**
         * 颜色叠加
         * @type {number[]}
         * @instance
         * @default [1, 1, 1, 1]
         * @memberof Obj.CustomPrimitive
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加' },
        /**
         * 自定义参数
         * @type {array}
         * @instance
         * @default [0, 0, 0, 0]
         * @memberof Obj.CustomPrimitive
         */
        customParams: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [0, 0, 0, 0], description: '自定义参数' },
        /**
         * 画布宽度，单位像素，为0时表示没有画布
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.CustomPrimitive
         */
        canvasWidth: { type: 'number', title: '画布宽度，单位像素', default: 0, description: '画布宽度，单位像素' },
        /**
         * 画布高度，单位像素，为0时表示没有画布
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.CustomPrimitive
         */
        canvasHeight: { type: 'number', title: '画布高度，单位像素', default: 0, description: '画布高度，单位像素' },
        /**
         * 纹理对应的图像url <br/>
         * 警告：一旦imageUrl有值，会导致drawCanvas调用失效！因此使用imageUrl之后，就不要再调用drawCanvas了！<br/>
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.CustomPrimitive
         */
        imageUrl: { type: 'string', title: '纹理对应的图像url', default: 0, description: '纹理对应的图像url' }
    }
};

CustomPrimitive.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['position', 'rotation', 'scale', 'show', 'modelMatrix', 'positions', 'normals', 'sts', 'colors', 'indices', 'vertexShaderSource', 'fragmentShaderSource', 'pass', 'primitiveType', 'renderState', 'color', 'customParams', 'canvasWidth', 'canvasHeight', 'imageUrl']
}];

CustomPrimitive.xbsjClassification = xbsjClassification;
CustomPrimitive.createTextureFromImage = _XbsjCustomPrimitive2.default.createTextureFromImage;

/**
 * 用来获得一个renderState
 * @param {boolean} translucent 是否透明(是否开启融合)
 * @param {boolean} closed 是否封闭(是否不绘制背面)
 * @name getRenderState
 * @function
 * @memberof Obj.CustomPrimitive
 * @static
 */

CustomPrimitive.getRenderState = _XbsjCustomPrimitive2.default.getRenderState;

CustomPrimitive.Geometry = _Geometry2.default;
CustomPrimitive.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(CustomPrimitive, 'CustomPrimitive');

exports.default = CustomPrimitive;

/***/ }),
/* 84 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(165);

var _regenerator2 = _interopRequireDefault(_regenerator);

var _getIterator2 = __webpack_require__(77);

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _iterator2 = __webpack_require__(143);

var _iterator3 = _interopRequireDefault(_iterator2);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

exports.getMinMaxPosition = getMinMaxPosition;
exports.getMinMaxCartesian = getMinMaxCartesian;
exports.max = max;
exports.min = min;
exports.objArrayIterator = objArrayIterator;

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var _marked = /*#__PURE__*/_regenerator2.default.mark(objArrayIterator);

// import * as Cesium from 'cesium';

// data 是一个数组
// index 表示从positions选取一部分出来
function getMinMaxPosition(positions, index) {
    var min = [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY];
    var max = [Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];

    if (!index) {
        var pl = positions.length / 3 | 0;
        for (var i = 0; i < pl; ++i) {
            for (var j = 0; j < 3; ++j) {
                min[j] = min[j] > positions[i * 3 + j] ? positions[i * 3 + j] : min[j];
                max[j] = max[j] < positions[i * 3 + j] ? positions[i * 3 + j] : max[j];
            }
        }
    } else {
        index.forEach(function (i) {
            for (var _j = 0; _j < 3; ++_j) {
                min[_j] = min[_j] > positions[i * 3 + _j] ? positions[i * 3 + _j] : min[_j];
                max[_j] = max[_j] < positions[i * 3 + _j] ? positions[i * 3 + _j] : max[_j];
            }
        });
    }

    return [min, max];
}

function getMinMaxCartesian(cartesians, index) {
    var min = new Cesium.Cartesian3(Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY);
    var max = new Cesium.Cartesian3(Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY);

    if (!index) {
        var pl = cartesians.length;

        var _loop = function _loop(i) {
            ['x', 'y', 'z'].forEach(function (prop) {
                min[prop] = min[prop] > cartesians[i][prop] ? cartesians[i][prop] : min[prop];
                max[prop] = max[prop] < cartesians[i][prop] ? cartesians[i][prop] : max[prop];
            });
        };

        for (var i = 0; i < pl; ++i) {
            _loop(i);
        }
    } else {
        index.forEach(function (i) {
            ['x', 'y', 'z'].forEach(function (prop) {
                min[prop] = min[prop] > cartesians[i][prop] ? cartesians[i][prop] : min[prop];
                max[prop] = max[prop] < cartesians[i][prop] ? cartesians[i][prop] : max[prop];
            });
        });
    }

    return [min, max];
}

// callbackfn: (previousValue: number, currentValue: number, currentIndex: number, array: number[]) => number
// initialValue 

/**
 * 遍历器的reduce，JS没有提供，这里写一下
 * @param {*} iteratorOrIterable 遍历器对象
 * @param {*} callbackfn (previousValue: number, currentValue: number, currentIndex: number, array: number[]) => number
 * @param {number} initialValue 作为第一次调用 callback函数时的第一个参数的值。 如果没有提供初始值，则将使用数组中的第一个元素。 在没有初始值的空数组上调用 reduce 将报错。
 */
function reduce(iteratorOrIterable, callbackfn, initialValue) {
    var iterator = void 0;
    if (typeof iteratorOrIterable.next === 'function') {
        // because it has a next method, so it's an iterator
        iterator = iteratorOrIterable;
    } else if ((0, _typeof3.default)(iteratorOrIterable[_iterator3.default])) {
        // because it has an @@iterator method, so it's an iterable
        iterator = (0, _getIterator3.default)(iteratorOrIterable);
    } else {
        throw new Error('iteratorOrIterable error!');
    }

    var previousValue = initialValue || iterator.next().value;
    var _iteratorNormalCompletion = true;
    var _didIteratorError = false;
    var _iteratorError = undefined;

    try {
        for (var _iterator = (0, _getIterator3.default)(iterator), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
            var v = _step.value;

            previousValue = callbackfn(previousValue, v);
        }
    } catch (err) {
        _didIteratorError = true;
        _iteratorError = err;
    } finally {
        try {
            if (!_iteratorNormalCompletion && _iterator.return) {
                _iterator.return();
            }
        } finally {
            if (_didIteratorError) {
                throw _iteratorError;
            }
        }
    }

    return previousValue;
}

function max(iteratorOrIterable) {
    return reduce(iteratorOrIterable, function (a, c) {
        return a > c ? a : c;
    }, Number.NEGATIVE_INFINITY);
}

function min(iteratorOrIterable) {
    return reduce(iteratorOrIterable, function (a, c) {
        return a < c ? a : c;
    }, Number.POSITIVE_INFINITY);
}

function objArrayIterator(objArray) {
    var _this = this;

    for (var _len = arguments.length, props = Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {
        props[_key - 1] = arguments[_key];
    }

    var cl, _loop2, i;

    return _regenerator2.default.wrap(function objArrayIterator$(_context2) {
        while (1) {
            switch (_context2.prev = _context2.next) {
                case 0:
                    cl = objArray.length;
                    _loop2 = /*#__PURE__*/_regenerator2.default.mark(function _loop2(i) {
                        var v;
                        return _regenerator2.default.wrap(function _loop2$(_context) {
                            while (1) {
                                switch (_context.prev = _context.next) {
                                    case 0:
                                        v = objArray[i];

                                        props.forEach(function (p) {
                                            return v = v[p];
                                        });
                                        // console.log('v: ' + v); 仅调试用
                                        _context.next = 4;
                                        return v;

                                    case 4:
                                    case 'end':
                                        return _context.stop();
                                }
                            }
                        }, _loop2, _this);
                    });
                    i = 0;

                case 3:
                    if (!(i < cl)) {
                        _context2.next = 8;
                        break;
                    }

                    return _context2.delegateYield(_loop2(i), 't0', 5);

                case 5:
                    ++i;
                    _context2.next = 3;
                    break;

                case 8:
                case 'end':
                    return _context2.stop();
            }
        }
    }, _marked, this);
}

/***/ }),
/* 85 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = getCoord;
/* unused harmony export getCoords */
/* unused harmony export containsNumber */
/* unused harmony export geojsonType */
/* unused harmony export featureOf */
/* unused harmony export collectionOf */
/* harmony export (immutable) */ __webpack_exports__["b"] = getGeom;
/* unused harmony export getType */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_helpers__ = __webpack_require__(367);

/**
 * Unwrap a coordinate from a Point Feature, Geometry or a single coordinate.
 *
 * @name getCoord
 * @param {Array<number>|Geometry<Point>|Feature<Point>} coord GeoJSON Point or an Array of numbers
 * @returns {Array<number>} coordinates
 * @example
 * var pt = turf.point([10, 10]);
 *
 * var coord = turf.getCoord(pt);
 * //= [10, 10]
 */
function getCoord(coord) {
    if (!coord) {
        throw new Error("coord is required");
    }
    if (!Array.isArray(coord)) {
        if (coord.type === "Feature" && coord.geometry !== null && coord.geometry.type === "Point") {
            return coord.geometry.coordinates;
        }
        if (coord.type === "Point") {
            return coord.coordinates;
        }
    }
    if (Array.isArray(coord) && coord.length >= 2 && !Array.isArray(coord[0]) && !Array.isArray(coord[1])) {
        return coord;
    }
    throw new Error("coord must be GeoJSON Point or an Array of numbers");
}
/**
 * Unwrap coordinates from a Feature, Geometry Object or an Array
 *
 * @name getCoords
 * @param {Array<any>|Geometry|Feature} coords Feature, Geometry Object or an Array
 * @returns {Array<any>} coordinates
 * @example
 * var poly = turf.polygon([[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]);
 *
 * var coords = turf.getCoords(poly);
 * //= [[[119.32, -8.7], [119.55, -8.69], [119.51, -8.54], [119.32, -8.7]]]
 */
function getCoords(coords) {
    if (Array.isArray(coords)) {
        return coords;
    }
    // Feature
    if (coords.type === "Feature") {
        if (coords.geometry !== null) {
            return coords.geometry.coordinates;
        }
    }
    else {
        // Geometry
        if (coords.coordinates) {
            return coords.coordinates;
        }
    }
    throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array");
}
/**
 * Checks if coordinates contains a number
 *
 * @name containsNumber
 * @param {Array<any>} coordinates GeoJSON Coordinates
 * @returns {boolean} true if Array contains a number
 */
function containsNumber(coordinates) {
    if (coordinates.length > 1 && Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* isNumber */])(coordinates[0]) && Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* isNumber */])(coordinates[1])) {
        return true;
    }
    if (Array.isArray(coordinates[0]) && coordinates[0].length) {
        return containsNumber(coordinates[0]);
    }
    throw new Error("coordinates must only contain numbers");
}
/**
 * Enforce expectations about types of GeoJSON objects for Turf.
 *
 * @name geojsonType
 * @param {GeoJSON} value any GeoJSON object
 * @param {string} type expected GeoJSON type
 * @param {string} name name of calling function
 * @throws {Error} if value is not the expected type.
 */
function geojsonType(value, type, name) {
    if (!type || !name) {
        throw new Error("type and name required");
    }
    if (!value || value.type !== type) {
        throw new Error("Invalid input to " + name + ": must be a " + type + ", given " + value.type);
    }
}
/**
 * Enforce expectations about types of {@link Feature} inputs for Turf.
 * Internally this uses {@link geojsonType} to judge geometry types.
 *
 * @name featureOf
 * @param {Feature} feature a feature with an expected geometry type
 * @param {string} type expected GeoJSON type
 * @param {string} name name of calling function
 * @throws {Error} error if value is not the expected type.
 */
function featureOf(feature, type, name) {
    if (!feature) {
        throw new Error("No feature passed");
    }
    if (!name) {
        throw new Error(".featureOf() requires a name");
    }
    if (!feature || feature.type !== "Feature" || !feature.geometry) {
        throw new Error("Invalid input to " + name + ", Feature with geometry required");
    }
    if (!feature.geometry || feature.geometry.type !== type) {
        throw new Error("Invalid input to " + name + ": must be a " + type + ", given " + feature.geometry.type);
    }
}
/**
 * Enforce expectations about types of {@link FeatureCollection} inputs for Turf.
 * Internally this uses {@link geojsonType} to judge geometry types.
 *
 * @name collectionOf
 * @param {FeatureCollection} featureCollection a FeatureCollection for which features will be judged
 * @param {string} type expected GeoJSON type
 * @param {string} name name of calling function
 * @throws {Error} if value is not the expected type.
 */
function collectionOf(featureCollection, type, name) {
    if (!featureCollection) {
        throw new Error("No featureCollection passed");
    }
    if (!name) {
        throw new Error(".collectionOf() requires a name");
    }
    if (!featureCollection || featureCollection.type !== "FeatureCollection") {
        throw new Error("Invalid input to " + name + ", FeatureCollection required");
    }
    for (var _i = 0, _a = featureCollection.features; _i < _a.length; _i++) {
        var feature = _a[_i];
        if (!feature || feature.type !== "Feature" || !feature.geometry) {
            throw new Error("Invalid input to " + name + ", Feature with geometry required");
        }
        if (!feature.geometry || feature.geometry.type !== type) {
            throw new Error("Invalid input to " + name + ": must be a " + type + ", given " + feature.geometry.type);
        }
    }
}
/**
 * Get Geometry from Feature or Geometry Object
 *
 * @param {Feature|Geometry} geojson GeoJSON Feature or Geometry Object
 * @returns {Geometry|null} GeoJSON Geometry Object
 * @throws {Error} if geojson is not a Feature or Geometry Object
 * @example
 * var point = {
 *   "type": "Feature",
 *   "properties": {},
 *   "geometry": {
 *     "type": "Point",
 *     "coordinates": [110, 40]
 *   }
 * }
 * var geom = turf.getGeom(point)
 * //={"type": "Point", "coordinates": [110, 40]}
 */
function getGeom(geojson) {
    if (geojson.type === "Feature") {
        return geojson.geometry;
    }
    return geojson;
}
/**
 * Get GeoJSON object's type, Geometry type is prioritize.
 *
 * @param {GeoJSON} geojson GeoJSON object
 * @param {string} [name="geojson"] name of the variable to display in error message
 * @returns {string} GeoJSON type
 * @example
 * var point = {
 *   "type": "Feature",
 *   "properties": {},
 *   "geometry": {
 *     "type": "Point",
 *     "coordinates": [110, 40]
 *   }
 * }
 * var geom = turf.getType(point)
 * //="Point"
 */
function getType(geojson, name) {
    if (geojson.type === "FeatureCollection") {
        return "FeatureCollection";
    }
    if (geojson.type === "GeometryCollection") {
        return "GeometryCollection";
    }
    if (geojson.type === "Feature" && geojson.geometry !== null) {
        return geojson.geometry.type;
    }
    return geojson.type;
}


/***/ }),
/* 86 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isFunction;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isFunction(x) {
    return typeof x === 'function';
}
//# sourceMappingURL=isFunction.js.map


/***/ }),
/* 87 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return config; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var _enable_super_gross_mode_that_will_cause_bad_things = false;
var config = {
    Promise: undefined,
    set useDeprecatedSynchronousErrorHandling(value) {
        if (value) {
            var error = /*@__PURE__*/ new Error();
            /*@__PURE__*/ console.warn('DEPRECATED! RxJS was set to use deprecated synchronous error handling behavior by code at: \n' + error.stack);
        }
        else if (_enable_super_gross_mode_that_will_cause_bad_things) {
            /*@__PURE__*/ console.log('RxJS: Back to a better error behavior. Thank you. <3');
        }
        _enable_super_gross_mode_that_will_cause_bad_things = value;
    },
    get useDeprecatedSynchronousErrorHandling() {
        return _enable_super_gross_mode_that_will_cause_bad_things;
    },
};
//# sourceMappingURL=config.js.map


/***/ }),
/* 88 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ObjectUnsubscribedError; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function ObjectUnsubscribedErrorImpl() {
    Error.call(this);
    this.message = 'object unsubscribed';
    this.name = 'ObjectUnsubscribedError';
    return this;
}
ObjectUnsubscribedErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
var ObjectUnsubscribedError = ObjectUnsubscribedErrorImpl;
//# sourceMappingURL=ObjectUnsubscribedError.js.map


/***/ }),
/* 89 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return OuterSubscriber; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


var OuterSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](OuterSubscriber, _super);
    function OuterSubscriber() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    OuterSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.destination.next(innerValue);
    };
    OuterSubscriber.prototype.notifyError = function (error, innerSub) {
        this.destination.error(error);
    };
    OuterSubscriber.prototype.notifyComplete = function (innerSub) {
        this.destination.complete();
    };
    return OuterSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));

//# sourceMappingURL=OuterSubscriber.js.map


/***/ }),
/* 90 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = subscribeToResult;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__InnerSubscriber__ = __webpack_require__(183);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__subscribeTo__ = __webpack_require__(128);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _InnerSubscriber,_subscribeTo,_Observable PURE_IMPORTS_END */



function subscribeToResult(outerSubscriber, result, outerValue, outerIndex, destination) {
    if (destination === void 0) {
        destination = new __WEBPACK_IMPORTED_MODULE_0__InnerSubscriber__["a" /* InnerSubscriber */](outerSubscriber, outerValue, outerIndex);
    }
    if (destination.closed) {
        return undefined;
    }
    if (result instanceof __WEBPACK_IMPORTED_MODULE_2__Observable__["a" /* Observable */]) {
        return result.subscribe(destination);
    }
    return Object(__WEBPACK_IMPORTED_MODULE_1__subscribeTo__["a" /* subscribeTo */])(result)(destination);
}
//# sourceMappingURL=subscribeToResult.js.map


/***/ }),
/* 91 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _ClippingPlane = __webpack_require__(148);

var _ClippingPlane2 = _interopRequireDefault(_ClippingPlane);

var _FlattenedPolygonCollection = __webpack_require__(149);

var _FlattenedPolygonCollection2 = _interopRequireDefault(_FlattenedPolygonCollection);

var _ClippingPlanes = __webpack_require__(151);

var _ClippingPlanes2 = _interopRequireDefault(_ClippingPlanes);

var _defaultOptions = __webpack_require__(258);

var _defaultOptions2 = _interopRequireDefault(_defaultOptions);

var _initTileset = __webpack_require__(259);

var _initTileset2 = _interopRequireDefault(_initTileset);

var _utils = __webpack_require__(262);

var _valueTransforms = __webpack_require__(263);

var _valueTransforms2 = _interopRequireDefault(_valueTransforms);

var _xbsjClassification = __webpack_require__(281);

var _xbsjClassification2 = _interopRequireDefault(_xbsjClassification);

var _xbsjSchema = __webpack_require__(282);

var _xbsjSchema2 = _interopRequireDefault(_xbsjSchema);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// TODO(vtxf): 可以和model的合并，以减少代码量
var sphericalHarmonicCoefficients = undefined;
function updateCoefficients(modelOrTileset) {
    var L00 = new Cesium.Cartesian3(0.170455150831422, 0.163151083190219, 0.196966760289763);
    var L1_1 = new Cesium.Cartesian3(-0.066550267689383, -0.022088055746048, 0.078835009246127);
    var L10 = new Cesium.Cartesian3(0.038364097478591, 0.045714300098753, 0.063498904606215);
    var L11 = new Cesium.Cartesian3(-0.014365363312810, -0.026490613715151, -0.050189404066020);
    var L2_2 = new Cesium.Cartesian3(-0.051532786917890, -0.050777795729986, -0.056449044453032);
    var L2_1 = new Cesium.Cartesian3(0.043454596136534, 0.046672590104157, 0.057530107646610);
    var L20 = new Cesium.Cartesian3(-0.001640466274110, 0.001286638231156, 0.007228908989616);
    var L21 = new Cesium.Cartesian3(-0.042260855700641, -0.046394335094707, -0.057562936365585);
    var L22 = new Cesium.Cartesian3(-0.004953478914091, -0.000479681664876, 0.008508150106928);
    sphericalHarmonicCoefficients = sphericalHarmonicCoefficients || [L00, L1_1, L10, L11, L2_2, L2_1, L20, L21, L22];

    // 环境贴图需要coefficients属性！没有的话会出问题 vtxf 20191105
    if (modelOrTileset.specularEnvironmentMaps) {
        modelOrTileset.sphericalHarmonicCoefficients = sphericalHarmonicCoefficients;
    } else {
        modelOrTileset.sphericalHarmonicCoefficients = undefined;
    }
}

/**
 * 三维瓦片类，对应Cesium的Cesium3DTileset
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Tileset = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Tileset, _XbsjCzmObj);

    function Tileset(earth, guid) {
        (0, _classCallCheck3.default)(this, Tileset);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Tileset.__proto__ || (0, _getPrototypeOf2.default)(Tileset)).call(this, earth, guid));

        _this.xbsjClippingPlanes = new _ClippingPlanes2.default();

        _this._collection = earth.czm.scene.primitives;
        _this._scene = earth.czm.scene;

        // this._tileset = undefined;

        (0, _mobx.extendObservable)(_this, {
            _tileset: undefined,
            _globalClippingPlanes: []
        }, {
            _tileset: _mobx.observable.ref,
            _globalClippingPlanes: _mobx.observable.shallow
        });

        _this._disposers = [];

        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        // 自定义shader
        _this._disposers.push(_XbsjBase2.default.registerProperty(_this, 'xbsjCustomShader', {
            vsHeader: '',
            vsBody: '',
            fsHeader: '',
            fsBody: ''
        }));

        (0, _mobx.extendObservable)(_this, {
            // xbsjCustomShader: {
            //     vsHeader: '',
            //     vsBody: '',
            //     fsHeader: '',
            //     fsBody: '',
            // },
            // xbsjCustomParams: [0, 0, 0, 0],
            xbsjCustomTexture: undefined
        }, {
            xbsjCustomTexture: _mobx.observable.ref
        });

        // 需要重新创建
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                url: _this.url,
                classificationType: _this.classificationType,
                xbsjCustomShader: (0, _stringify2.default)(_this.xbsjCustomShader),
                xbsjCustomParams: [].concat((0, _toConsumableArray3.default)(_this.xbsjCustomParams)),
                xbsnCustomTexture: _this.xbsjCustomTexture
            };
        }, function () {
            _this._tileset && _this._collection.remove(_this._tileset);
            _this._tileset = undefined;

            if (!_this.url) {
                return;
            }

            var url = _this.url;
            if (_this.url.startsWith('Ion(')) {
                var rr = /Ion\((\d+)/.exec(_this.url);
                var assetId = rr[1] && +rr[1];
                assetId && (url = Cesium.IonResource.fromAssetId(assetId));
            }

            _this._tileset = new Cesium.Cesium3DTileset({
                url: url,
                classificationType: _valueTransforms2.default.classificationType.jsonToCzm(_this.classificationType)
            });
            _this._tileset.xbsjTileset = _this;
            _this._collection.add(_this._tileset);

            (0, _initTileset2.default)(_this._tileset, _this._earth);

            if (_this._originPositionSetTimeoutID) {
                clearTimeout(_this._originPositionSetTimeoutID);
                _this._originPositionSetTimeoutID = undefined;
            }
            _this._originPositionSetTimeoutID = setTimeout(function () {
                if (_this.xbsjPosition.every(function (e) {
                    return e === 0;
                })) {
                    _this._tileset && _this._tileset.readyPromise.then(function () {
                        _this.xbsjPosition = _this.getOriginPosition();
                    });
                }
            }, 0);

            // 自定义shader
            var tileset = _this._tileset;
            tileset.xbsjCustomShader = _this.xbsjCustomShader;
            if (!tileset._xbsjCustomParams) {
                tileset._xbsjCustomParams = new Cesium.Cartesian4();
            }
            tileset._xbsjCustomParams.x = _this.xbsjCustomParams[0];
            tileset._xbsjCustomParams.y = _this.xbsjCustomParams[1];
            tileset._xbsjCustomParams.z = _this.xbsjCustomParams[2];
            tileset._xbsjCustomParams.w = _this.xbsjCustomParams[3];
            tileset._xbsjCustomTexture = _this.xbsjCustomTexture;
        }, {
            fireImmediately: true
        }));

        // this._disposers.push(autorun(() => {
        //     console.log('show: ' + this.show);
        //     if (this._tileset) {
        //         this._tileset.show = this.show;            
        //     }
        // }));

        // 监测普通属性变化
        var updatePropertes = ['show', 'maximumScreenSpaceError', 'maximumMemoryUsage', 'cullWithChildrenBounds', 'dynamicScreenSpaceError', 'dynamicScreenSpaceErrorDensity', 'dynamicScreenSpaceErrorFactor', 'dynamicScreenSpaceErrorHeightFalloff', 'skipLevelOfDetail', 'baseScreenSpaceError', 'skipScreenSpaceErrorFactor', 'skipLevels', 'immediatelyLoadDesiredLevelOfDetail', 'loadSiblings', 'luminanceAtZenith', 'preferLeaves', 'debugFreezeFrame', 'debugColorizeTiles', 'debugWireframe', 'debugShowBoundingVolume', 'debugShowContentBoundingVolume', 'debugShowViewerRequestVolume', 'debugShowGeometricError', 'debugShowRenderingStatistics', 'debugShowMemoryUsage', 'debugShowUrl'];

        var updatePropertes2 = ['shadows', 'imageBasedLightingFactor', 'lightColor', 'specularEnvironmentMaps'];

        _this._disposers.push((0, _mobx.autorun)(function () {
            var tileset = _this._tileset; // 希望能响应_tileset的变化！
            updatePropertes.forEach(function (prop) {
                // this.tileset && (this.tileset[p] = this[p]); 这样直接操作autorun不认！！！
                var v = _this[prop];
                tileset && (tileset[prop] = v);
            });

            updatePropertes2.forEach(function (prop) {
                var v = _valueTransforms2.default[prop].jsonToCzm(_this[prop]);
                tileset && (tileset[prop] = v);
            });

            tileset && updateCoefficients(tileset);
        }));

        // 监测压平纹理变化
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                guid: _this.xbsjFlattenGuid,
                tileset: _this._tileset
            };
        }, function () {
            _this._unregisterFlattened = _this._unregisterFlattened && _this._unregisterFlattened();
            if (!_this._tileset || !_this.xbsjFlattenGuid) {
                return;
            }

            _this._unregisterFlattened = _this._earth.registerObject(_this.xbsjFlattenGuid, function (xbsjObj) {
                if (xbsjObj instanceof _FlattenedPolygonCollection2.default) {
                    setTimeout(function () {
                        _this._tileset._flattenedPolygonTexture = xbsjObj.flattenedPolygonTexture;
                        _this._flattenDiscardDisposer = (0, _mobx.autorun)(function () {
                            _this._tileset.flattenDiscard = xbsjObj.flattenDiscard;
                        });
                    }, 0);
                }
            }, function () {
                _this._tileset._flattenedPolygonTexture = undefined;
                _this._tileset.flattenDiscard = false;
                _this._flattenDiscardDisposer = _this._flattenDiscardDisposer && _this._flattenDiscardDisposer();
            });
        }, {
            fireImmediately: true
        }));

        // 监测样式变化
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                style: _this.xbsjStyle,
                tileset: _this._tileset
            };
        }, function () {
            if (!_this._tileset) {
                return;
            }

            if (_this.xbsjStyle) {
                try {
                    var _style = JSON.parse(_this.xbsjStyle);
                    _this._tileset.customStyle = new Cesium.Cesium3DTileStyle(_style);
                } catch (error) {
                    try {
                        var style = eval(_this.xbsjStyle + ";style");
                        _this._tileset.customStyle = new Cesium.Cesium3DTileStyle(style);
                    } catch (error) {
                        console.warn('3dtiles的style设置不合法！');
                    }
                }
            } else {
                _this._tileset.customStyle = undefined;
            }
            _this._tileset.makeStyleDirty();
            _this._tileset.style._colorShaderFunctionReady = false;
            _this._tileset.style._showShaderFunctionReady = false;
            _this._tileset.style._pointSizeShaderFunctionReady = false;
        }, {
            fireImmediately: true
        }));

        // 监测矩阵变化
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                xbsjUseOriginTransform: _this.xbsjUseOriginTransform,
                xbsjPosition: _this.xbsjPosition.map(function (v) {
                    return v;
                }),
                xbsjRotation: _this.xbsjRotation.map(function (v) {
                    return v;
                }),
                xbsjScale: _this.xbsjScale.map(function (v) {
                    return v;
                }),
                tileset: _this._tileset,
                globalClippingPlanes: _this._globalClippingPlanes.filter(function (cp) {
                    return cp.enabled;
                }).map(function (cp) {
                    return { position: [].concat((0, _toConsumableArray3.default)(cp.position)), rotation: [].concat((0, _toConsumableArray3.default)(cp.rotation)) };
                })
            };
        }, function (_ref) {
            var globalClippingPlanes = _ref.globalClippingPlanes;

            if (!_this._tileset) {
                return;
            }

            var tileset = _this._tileset;
            tileset.xbsjUseOriginTransform = _this.xbsjUseOriginTransform;
            tileset.xbsjPosition = _this.xbsjPosition;
            tileset.xbsjRotation = _this.xbsjRotation;
            tileset.xbsjScale = _this.xbsjScale;

            if (_this._modelMatrixUpdaterDisposer) {
                _this._modelMatrixUpdaterDisposer();
                _this._modelMatrixUpdaterDisposer = undefined;
            }

            // TODO(vtxf): preUpdate的这种用法如何改进，如果更新clippingPlane？
            _this._modelMatrixUpdaterDisposer = _this._scene.preUpdate.addEventListener(function () {
                if (tileset.ready) {
                    if (tileset.xbsjUseOriginTransform) {
                        Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY, tileset.modelMatrix);
                    } else {
                        (0, _utils.computeNewTransform)(tileset._root.transform, {
                            xbsjPosition: tileset.xbsjPosition,
                            xbsjRotation: tileset.xbsjRotation,
                            xbsjScale: tileset.xbsjScale
                        }, tileset.modelMatrix);
                    }

                    // modelMatrix发生变化后，修改clippingPlanes
                    _this._scratchPlane = _this._scratchPlane || new Cesium.Plane(Cesium.Cartesian3.UNIT_X, 0.0);
                    _this._scratchMatrix = _this._scratchMatrix || new Cesium.Matrix4();

                    // 为了保证clippingPlanesOriginMatrix更新及时，需要以下两句
                    tileset._root.updateTransform(tileset._modelMatrix);
                    tileset._clippingPlanesOriginMatrixDirty = true;
                    var inverseClippingPlanesOriginMatrix = Cesium.Matrix4.inverse(tileset.clippingPlanesOriginMatrix, _this._scratchMatrix);
                    tileset.clippingPlanes.removeAll();
                    // this._globalClippingPlanes.forEach(gcp => {
                    globalClippingPlanes.forEach(function (gcp) {
                        var modelMatrix = _utils.getModelMatrix.apply(undefined, (0, _toConsumableArray3.default)(gcp.position).concat((0, _toConsumableArray3.default)(gcp.rotation)));
                        var plane = Cesium.Plane.transform(Cesium.Plane.ORIGIN_XY_PLANE, modelMatrix, _this._scratchPlane);
                        var localPlane = Cesium.Plane.transform(plane, inverseClippingPlanesOriginMatrix, _this._scratchPlane);
                        tileset.clippingPlanes.add(Cesium.ClippingPlane.fromPlane(localPlane));
                    });

                    if (_this._modelMatrixUpdaterDisposer) {
                        _this._modelMatrixUpdaterDisposer();
                        _this._modelMatrixUpdaterDisposer = undefined;
                    }
                }
            });
        }, {
            fireImmediately: true
        }));

        // 监测视口变化
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                xbsjLeftTopView: _this.xbsjLeftTopView,
                xbsjRightTopView: _this.xbsjRightTopView,
                xbsjLeftBottomView: _this.xbsjLeftBottomView,
                xbsjRightBottomView: _this.xbsjRightBottomView,
                tileset: _this._tileset
            };
        }, function () {
            if (!_this._tileset) {
                return;
            }

            var viewportIndex = 0;
            if (_this.xbsjLeftTopView) {
                viewportIndex += 1;
            }
            if (_this.xbsjRightTopView) {
                viewportIndex += 2;
            }
            if (_this.xbsjLeftBottomView) {
                viewportIndex += 4;
            }
            if (_this.xbsjRightBottomView) {
                viewportIndex += 8;
            }

            _this._tileset.xbsjViewportIndex = viewportIndex;
        }, {
            fireImmediately: true
        }));

        // // 监测裁剪面的变化
        // this._disposers.push(intercept(this, 'xbsjClippingPlanes', changed => {
        //     if (changed.type === 'update') {
        //         if (changed.newValue && changed.object.value !== changed.newValue) {
        //             const jsonObject = changed.newValue && changed.newValue.toJSON && changed.newValue.toJSON() || changed.newValue;
        //             this.xbsjClippingPlanes.xbsjFromJSON(jsonObject);
        //         }
        //     }

        //     return null;
        // }));
        _this._disposers.push(_XbsjBase2.default.registerProperty(_this, 'xbsjClippingPlanes'));

        _this._disposers.push((0, _mobx.autorun)(function () {
            var edgeWidth = _this.xbsjClippingPlanes.edgeWidth;
            var edgeColor = _this.xbsjClippingPlanes.edgeColor;
            var unionClippingRegions = _this.xbsjClippingPlanes.unionClippingRegions;

            var tileset = _this._tileset;
            if (tileset) {
                tileset.clippingPlanes.edgeWidth = edgeWidth;
                tileset.clippingPlanes.edgeColor = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(edgeColor))))();
                tileset.clippingPlanes.unionClippingRegions = unionClippingRegions;
            }
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                xbsjClippingPlanes: _this.xbsjClippingPlanes,
                xbsjClippingPlanesPlanes: _this.xbsjClippingPlanes.planes.map(function (p) {
                    return p;
                }),
                edgeWidth: _this.xbsjClippingPlanes.edgeWidth,
                tileset: _this._tileset
            };
        }, function () {
            _this._unregisterClippingPlanesCollection = _this._unregisterClippingPlanesCollection || [];
            _this._unregisterClippingPlanesCollection.forEach(function (u) {
                return u();
            });
            _this._unregisterClippingPlanesCollection.length = 0;

            if (!_this._tileset) {
                return;
            }

            var tileset = _this._tileset;
            tileset.clippingPlanes.edgeWidth = _this.xbsjClippingPlanes.edgeWidth;
            tileset.clippingPlanes.unionClippingRegions = _this.xbsjClippingPlanes.unionClippingRegions;

            _this._globalClippingPlanes = _this._globalClippingPlanes || [];
            var attach = function attach(xbsjObj) {
                if (!xbsjObj instanceof _ClippingPlane2.default) {
                    throw new Error('裁剪面类型出错！');
                }
                _this._globalClippingPlanes.push(xbsjObj);
            };

            var detach = function detach(xbsjObj) {
                var index = _this._globalClippingPlanes.indexOf(xbsjObj);
                _this._globalClippingPlanes.splice(index, 1);
            };

            _this.xbsjClippingPlanes.planes.forEach(function (planeGuid) {
                _this._unregisterClippingPlanesCollection.push(_this._earth.registerObject(planeGuid, attach, detach));
            });
        }, {
            fireImmediately: true
        }));

        // 监测水淹分析
        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                xbsjCriticalElevation: _this.xbsjCriticalElevation,
                xbsjCriticalElevationColor: [].concat((0, _toConsumableArray3.default)(_this.xbsjCriticalElevationColor)),
                tileset: _this._tileset
            };
        }, function () {
            if (!_this._tileset) {
                return;
            }

            _this._tileset.criticalElevation = _this.xbsjCriticalElevation;
            var color = _this._tileset.criticalElevationColor;
            color.red = _this.xbsjCriticalElevationColor[0];
            color.green = _this.xbsjCriticalElevationColor[1];
            color.blue = _this.xbsjCriticalElevationColor[2];
            color.alpha = _this.xbsjCriticalElevationColor[3];
        }, {
            fireImmediately: true
        }));

        // // 地形挖坑
        // this._disposers.push(reaction(() => {
        //     return {
        //         xbsjFlattenDiscard: this.xbsjFlattenDiscard,
        //         tileset: this._tileset,
        //     }
        // }, () => {
        //     if (!this._tileset) {
        //         return;
        //     }

        //     this._tileset.flattenDiscard = this.xbsjFlattenDiscard;
        // }));

        // 检测位置编辑状态 // positionEditing
        _this._disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionProperty: 'xbsjPosition'
        }));

        // 旋转状态
        _this._disposers.push((0, _registerInteractionProperty.registerRotationEditing)(_this._earth, _this, {
            positionProperty: 'xbsjPosition',
            rotationProperty: 'xbsjRotation'
        }));

        // 添加ready响应式属性
        (0, _mobx.extendObservable)(_this, {
            _ready: false,
            get ready() {
                return this._ready;
            },
            set ready(newVal) {
                if (this._ready !== newVal) {
                    this._ready = newVal;
                }
            }
        }, {
            ready: _mobx.computed
        });

        _this._readyDisposer = undefined;
        _this._disposers.push(function () {
            return _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
        });

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this._tileset;
        }, function (tileset) {
            _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
            _this.ready = false;

            if (tileset) {
                _this._readyDisposer = function () {
                    var valid = true;
                    tileset.readyPromise.then(function () {
                        if (valid) {
                            _this.ready = true;
                        }
                        _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
                    });

                    return function () {
                        return valid = false;
                    };
                }();
            } else {
                _this.ready = false;
            }
        }));

        _this._clickedAttachedInfo = undefined;
        _this._hoveredAttachedInfo = undefined;

        _this.disposers.push(_XbsjBase2.default.registerPathAttachedGuid(_this, {
            positionProperty: 'xbsjPosition',
            rotationProperty: 'xbsjRotation'
        }));

        return _this;
    }

    (0, _createClass3.default)(Tileset, [{
        key: 'onclick',
        value: function onclick(pickedObject) {
            this._clickedAttachedInfo = pickedObject;
            this._tileset && this._tileset.makeStyleDirty();
        }
    }, {
        key: 'onclickout',
        value: function onclickout(pickedObject) {
            this._clickedAttachedInfo = undefined;
            this._tileset && this._tileset.makeStyleDirty();
        }
    }, {
        key: 'onmouseover',
        value: function onmouseover(pickedObject) {
            this._hoveredAttachedInfo = pickedObject;
            this._tileset && this._tileset.makeStyleDirty();
        }
    }, {
        key: 'onmouseout',
        value: function onmouseout(pickedObject) {
            this._hoveredAttachedInfo = undefined;
            this._tileset && this._tileset.makeStyleDirty();
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            var _this2 = this;

            var camera = this._earth.czm.scene.camera;
            camera.cancelFlight();

            if (this._flyToDisposer) {
                throw new Error('_flyToDisposer should be undefined!');
            }

            camera._currentFlight = {
                cancelTween: function cancelTween() {
                    _this2._flyToDisposer = _this2._flyToDisposer && _this2._flyToDisposer();
                }
            };

            if (this.ready) {
                this._scene.camera.flyToBoundingSphere(this._tileset.boundingSphere);
            } else {
                this._flyToDisposer = (0, _mobx.reaction)(function () {
                    return _this2.ready;
                }, function (ready) {
                    if (ready) {
                        if (!_this2._tileset || !_this2._tileset.ready) {
                            throw new Error('this._tileset.ready should be true!');
                        }
                        _this2._scene.camera.flyToBoundingSphere(_this2._tileset.boundingSphere);
                        _this2._flyToDisposer = _this2._flyToDisposer && _this2._flyToDisposer();
                    }
                });
            }

            // 主要是用来清理！
            if (!this._flyToOnlyOnce) {
                this._flyToOnlyOnce = true;
                this.disposers.push(function () {
                    _this2._flyToDisposer = _this2._flyToDisposer && _this2._flyToDisposer();
                });
            }
        }

        /**
         * 获取三维瓦片数据的原始位置
         * @returns {Array} 一个长度为3的数组，元素分别表示 经度、纬度、高度，注意其中的经度和纬度的单位是弧度、高度的单位是米。 
         */

    }, {
        key: 'getOriginPosition',
        value: function getOriginPosition() {
            if (this._tileset && this._tileset.ready) {
                var position = Cesium.Matrix4.getTranslation(this._tileset._root.transform, new Cesium.Cartesian3());
                var carto = Cesium.Cartographic.fromCartesian(position);
                return [carto.longitude, carto.latitude, carto.height];
            } else {
                return undefined;
            }
        }

        // xbsjFromJSON(jsonObject) {
        //     XbsjBase.jsonToPlainObject(jsonObject, this);
        // }

        // 没有特殊项需要处理
        // toJSON(key) {
        //     return {
        //         ...super.toJSON(key),
        //         // 增加特殊项处理
        //     };
        // }

    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (this._originPositionSetTimeoutID) {
                clearTimeout(this._originPositionSetTimeoutID);
                this._originPositionSetTimeoutID = undefined;
            }

            // 解绑压平纹理
            this._unregisterFlattened = this._unregisterFlattened && this._unregisterFlattened();

            this._modelMatrixUpdaterDisposer = this._modelMatrixUpdaterDisposer && this._modelMatrixUpdaterDisposer();

            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            this._tileset && this._collection.remove(this._tileset);
            this._tileset = undefined;
            return (0, _get3.default)(Tileset.prototype.__proto__ || (0, _getPrototypeOf2.default)(Tileset.prototype), 'destroy', this).call(this);
        }
    }]);
    return Tileset;
}(_XbsjCzmObj3.default);

Tileset.defaultOptions = _defaultOptions2.default;
_XbsjObject2.default.registerType(Tileset, 'Tileset');
Tileset.xbsjSchema = _xbsjSchema2.default;
Tileset.xbsjClassification = _xbsjClassification2.default;

Tileset.xbsjCustomShader = {};
// Tileset.xbsjCustomShader.builtinFsBody1 = `
//     vec3 positionToEyeEC = -v_positionEC;
//     vec3 normalEC = normalize(v_normal);

//     czm_materialInput materialInput;
//     materialInput.normalEC = normalEC;
//     materialInput.positionToEyeEC = positionToEyeEC;
//     materialInput.st = vec2(0, 0);
//     czm_material material = czm_getDefaultMaterial(materialInput);
//     material.diffuse = vec3(0.0, 0.5, 1.0);
//     material.specular = 0.0;
//     gl_FragColor = czm_phong(normalize(positionToEyeEC), material);

//     float vtxf_a11 = fract(czm_frameNumber / 120.0) * 3.14159265 * 2.0;
//     float vtxf_a12 = v_elevationPos.z / 60.0 + sin(vtxf_a11) * 0.1;
//     gl_FragColor *= vec4(vtxf_a12, vtxf_a12, vtxf_a12, 1.0);

//     float vtxf_a13 = fract(czm_frameNumber / 360.0);
//     float vtxf_h = clamp(v_elevationPos.z / 300.0, 0.0, 1.0);
//     vtxf_a13 = abs(vtxf_a13 - 0.5) * 2.0;
//     float vtxf_diff = step(0.005, abs(vtxf_h - vtxf_a13));
//     gl_FragColor.rgb += gl_FragColor.rgb * (1.0 - vtxf_diff);
// `;

Tileset.xbsjCustomShader.builtinFsBody1 = '\n    float vtxf_a11 = fract(czm_frameNumber / 120.0) * 3.14159265 * 2.0;\n    float vtxf_a12 = v_elevationPos.z / 60.0 + sin(vtxf_a11) * 0.1;\n    gl_FragColor *= vec4(vtxf_a12, vtxf_a12, vtxf_a12, 1.0);\n\n    float vtxf_a13 = fract(czm_frameNumber / 360.0);\n    float vtxf_h = clamp(v_elevationPos.z / 300.0, 0.0, 1.0);\n    vtxf_a13 = abs(vtxf_a13 - 0.5) * 2.0;\n    float vtxf_diff = step(0.005, abs(vtxf_h - vtxf_a13));\n    gl_FragColor.rgb += gl_FragColor.rgb * (1.0 - vtxf_diff);\n';

exports.default = Tileset;

/***/ }),
/* 92 */
/***/ (function(module, exports) {

// 7.1.4 ToInteger
var ceil = Math.ceil;
var floor = Math.floor;
module.exports = function (it) {
  return isNaN(it = +it) ? 0 : (it > 0 ? floor : ceil)(it);
};


/***/ }),
/* 93 */
/***/ (function(module, exports) {

// 7.2.1 RequireObjectCoercible(argument)
module.exports = function (it) {
  if (it == undefined) throw TypeError("Can't call method on  " + it);
  return it;
};


/***/ }),
/* 94 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var LIBRARY = __webpack_require__(56);
var $export = __webpack_require__(16);
var redefine = __webpack_require__(135);
var hide = __webpack_require__(34);
var Iterators = __webpack_require__(47);
var $iterCreate = __webpack_require__(204);
var setToStringTag = __webpack_require__(60);
var getPrototypeOf = __webpack_require__(139);
var ITERATOR = __webpack_require__(18)('iterator');
var BUGGY = !([].keys && 'next' in [].keys()); // Safari has buggy iterators w/o `next`
var FF_ITERATOR = '@@iterator';
var KEYS = 'keys';
var VALUES = 'values';

var returnThis = function () { return this; };

module.exports = function (Base, NAME, Constructor, next, DEFAULT, IS_SET, FORCED) {
  $iterCreate(Constructor, NAME, next);
  var getMethod = function (kind) {
    if (!BUGGY && kind in proto) return proto[kind];
    switch (kind) {
      case KEYS: return function keys() { return new Constructor(this, kind); };
      case VALUES: return function values() { return new Constructor(this, kind); };
    } return function entries() { return new Constructor(this, kind); };
  };
  var TAG = NAME + ' Iterator';
  var DEF_VALUES = DEFAULT == VALUES;
  var VALUES_BUG = false;
  var proto = Base.prototype;
  var $native = proto[ITERATOR] || proto[FF_ITERATOR] || DEFAULT && proto[DEFAULT];
  var $default = $native || getMethod(DEFAULT);
  var $entries = DEFAULT ? !DEF_VALUES ? $default : getMethod('entries') : undefined;
  var $anyNative = NAME == 'Array' ? proto.entries || $native : $native;
  var methods, key, IteratorPrototype;
  // Fix native
  if ($anyNative) {
    IteratorPrototype = getPrototypeOf($anyNative.call(new Base()));
    if (IteratorPrototype !== Object.prototype && IteratorPrototype.next) {
      // Set @@toStringTag to native iterators
      setToStringTag(IteratorPrototype, TAG, true);
      // fix for some old engines
      if (!LIBRARY && typeof IteratorPrototype[ITERATOR] != 'function') hide(IteratorPrototype, ITERATOR, returnThis);
    }
  }
  // fix Array#{values, @@iterator}.name in V8 / FF
  if (DEF_VALUES && $native && $native.name !== VALUES) {
    VALUES_BUG = true;
    $default = function values() { return $native.call(this); };
  }
  // Define iterator
  if ((!LIBRARY || FORCED) && (BUGGY || VALUES_BUG || !proto[ITERATOR])) {
    hide(proto, ITERATOR, $default);
  }
  // Plug for library
  Iterators[NAME] = $default;
  Iterators[TAG] = returnThis;
  if (DEFAULT) {
    methods = {
      values: DEF_VALUES ? $default : getMethod(VALUES),
      keys: IS_SET ? $default : getMethod(KEYS),
      entries: $entries
    };
    if (FORCED) for (key in methods) {
      if (!(key in proto)) redefine(proto, key, methods[key]);
    } else $export($export.P + $export.F * (BUGGY || VALUES_BUG), NAME, methods);
  }
  return methods;
};


/***/ }),
/* 95 */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(25);
var document = __webpack_require__(17).document;
// typeof document.createElement is 'object' in old IE
var is = isObject(document) && isObject(document.createElement);
module.exports = function (it) {
  return is ? document.createElement(it) : {};
};


/***/ }),
/* 96 */
/***/ (function(module, exports, __webpack_require__) {

// 7.1.1 ToPrimitive(input [, PreferredType])
var isObject = __webpack_require__(25);
// instead of the ES6 spec version, we didn't implement @@toPrimitive case
// and the second argument - flag - preferred type is a string
module.exports = function (it, S) {
  if (!isObject(it)) return it;
  var fn, val;
  if (S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  if (typeof (fn = it.valueOf) == 'function' && !isObject(val = fn.call(it))) return val;
  if (!S && typeof (fn = it.toString) == 'function' && !isObject(val = fn.call(it))) return val;
  throw TypeError("Can't convert object to primitive value");
};


/***/ }),
/* 97 */
/***/ (function(module, exports, __webpack_require__) {

// fallback for non-array-like ES3 and non-enumerable old V8 strings
var cof = __webpack_require__(59);
// eslint-disable-next-line no-prototype-builtins
module.exports = Object('z').propertyIsEnumerable(0) ? Object : function (it) {
  return cof(it) == 'String' ? it.split('') : Object(it);
};


/***/ }),
/* 98 */
/***/ (function(module, exports, __webpack_require__) {

var shared = __webpack_require__(99)('keys');
var uid = __webpack_require__(72);
module.exports = function (key) {
  return shared[key] || (shared[key] = uid(key));
};


/***/ }),
/* 99 */
/***/ (function(module, exports, __webpack_require__) {

var core = __webpack_require__(14);
var global = __webpack_require__(17);
var SHARED = '__core-js_shared__';
var store = global[SHARED] || (global[SHARED] = {});

(module.exports = function (key, value) {
  return store[key] || (store[key] = value !== undefined ? value : {});
})('versions', []).push({
  version: core.version,
  mode: __webpack_require__(56) ? 'pure' : 'global',
  copyright: '© 2019 Denis Pushkarev (zloirock.ru)'
});


/***/ }),
/* 100 */
/***/ (function(module, exports) {

// IE 8- don't enum bug keys
module.exports = (
  'constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf'
).split(',');


/***/ }),
/* 101 */
/***/ (function(module, exports, __webpack_require__) {

var classof = __webpack_require__(73);
var ITERATOR = __webpack_require__(18)('iterator');
var Iterators = __webpack_require__(47);
module.exports = __webpack_require__(14).getIteratorMethod = function (it) {
  if (it != undefined) return it[ITERATOR]
    || it['@@iterator']
    || Iterators[classof(it)];
};


/***/ }),
/* 102 */
/***/ (function(module, exports, __webpack_require__) {

exports.f = __webpack_require__(18);


/***/ }),
/* 103 */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(17);
var core = __webpack_require__(14);
var LIBRARY = __webpack_require__(56);
var wksExt = __webpack_require__(102);
var defineProperty = __webpack_require__(27).f;
module.exports = function (name) {
  var $Symbol = core.Symbol || (core.Symbol = LIBRARY ? {} : global.Symbol || {});
  if (name.charAt(0) != '_' && !(name in $Symbol)) defineProperty($Symbol, name, { value: wksExt.f(name) });
};


/***/ }),
/* 104 */
/***/ (function(module, exports) {

exports.f = Object.getOwnPropertySymbols;


/***/ }),
/* 105 */
/***/ (function(module, exports, __webpack_require__) {

var pIE = __webpack_require__(62);
var createDesc = __webpack_require__(58);
var toIObject = __webpack_require__(35);
var toPrimitive = __webpack_require__(96);
var has = __webpack_require__(40);
var IE8_DOM_DEFINE = __webpack_require__(134);
var gOPD = Object.getOwnPropertyDescriptor;

exports.f = __webpack_require__(23) ? gOPD : function getOwnPropertyDescriptor(O, P) {
  O = toIObject(O);
  P = toPrimitive(P, true);
  if (IE8_DOM_DEFINE) try {
    return gOPD(O, P);
  } catch (e) { /* empty */ }
  if (has(O, P)) return createDesc(!pIE.f.call(O, P), O[P]);
};


/***/ }),
/* 106 */
/***/ (function(module, exports) {



/***/ }),
/* 107 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

var _types = __webpack_require__(76);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var LocalObject = function () {
    // root是一个对象，propertyName类似 'aaa.bbb.ccc'
    function LocalObject(root, propertyName) {
        (0, _classCallCheck3.default)(this, LocalObject);

        this._root = root;
        this._propertyName = propertyName;
        this._props = propertyName.split('.');

        if (this._root._isVue) {
            this._type = 'vue';
        } else if (Array.isArray(this.lastReactObject) && (0, _mobx.isObservable)(this.lastReactObject) && (0, _mobx.isObservable)(this.lastReactObject[this.lastPropertyName])) {
            this._type = 'xbsjReact';
        } else if (!Array.isArray(this.lastReactObject) && (0, _mobx.isObservableProp)(this.lastReactObject, this.lastPropertyName)) {
            // 无法判断数组索引，会报错
            this._type = 'xbsjReact';
        } else {
            throw new Error('类型错误！');
        }
    }

    (0, _createClass3.default)(LocalObject, [{
        key: 'type',
        get: function get() {
            return this._type;
        }

        // 最终节点

    }, {
        key: 'd',
        get: function get() {
            var l = this._props.length;
            var localObject = this._root;
            for (var i = 0; i < l; ++i) {
                localObject = localObject[this._props[i]];
            }
            return localObject;
        }

        // // 最后一节节点转成索引（假定认为上一级节点是数组，此处则是为了获取其索引，返回值是数字
        // get di() {
        //     return +(this._props[this._props.length - 1]);
        // }


        , set: function set(value) {
            var l = this._props.length - 1;
            var localObject = this._root;
            for (var i = 0; i < l; ++i) {
                localObject = localObject[this._props[i]];
            }
            // 如果不是因为vue，这样写就可以了，但是对于vue来说，要做到让其响应，需要针对数组进行改造
            // localObject[this._props[l]] = value;
            if (Array.isArray(localObject)) {
                localObject.splice(+this._props[l], 1, value); // 为了vue
            } else {
                localObject[this._props[l]] = value;
            }
        }

        // 最终节点的上一级节点（解决vue数组不响应问题时需要）

    }, {
        key: 'lastReactObject',
        get: function get() {
            var l = this._props.length - 1;
            var localObject = this._root;
            for (var i = 0; i < l; ++i) {
                localObject = localObject[this._props[i]];
            }
            return localObject;
        }
    }, {
        key: 'lastPropertyName',
        get: function get() {
            return this._props[this._props.length - 1];
        }
    }]);
    return LocalObject;
}();

exports.default = LocalObject;

/***/ }),
/* 108 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
/**
 * 注册父节点响应子节点的拾取操作
 * @param {Obj.CzmObject} currentObj 叶子节点
 * @param {Obj.CzmObject} parent 父节点
 * @static
 * @memberof Picking
 */
function registerPickingParent(currentObj, parent) {
    currentObj.onclick = function () {
        return parent.onclick && parent.onclick.apply(parent, arguments);
    };
    currentObj.onclickout = function () {
        return parent.onclickout && parent.onclickout.apply(parent, arguments);
    };
    currentObj.onmouseover = function () {
        return parent.onmouseover && parent.onmouseover.apply(parent, arguments);
    };
    currentObj.onmouseout = function () {
        return parent.onmouseout && parent.onmouseout.apply(parent, arguments);
    };
}

exports.default = registerPickingParent;

/***/ }),
/* 109 */
/***/ (function(module, exports) {

module.exports = function (it, Constructor, name, forbiddenField) {
  if (!(it instanceof Constructor) || (forbiddenField !== undefined && forbiddenField in it)) {
    throw TypeError(name + ': incorrect invocation!');
  } return it;
};


/***/ }),
/* 110 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// 25.4.1.5 NewPromiseCapability(C)
var aFunction = __webpack_require__(57);

function PromiseCapability(C) {
  var resolve, reject;
  this.promise = new C(function ($$resolve, $$reject) {
    if (resolve !== undefined || reject !== undefined) throw TypeError('Bad Promise constructor');
    resolve = $$resolve;
    reject = $$reject;
  });
  this.resolve = aFunction(resolve);
  this.reject = aFunction(reject);
}

module.exports.f = function (C) {
  return new PromiseCapability(C);
};


/***/ }),
/* 111 */
/***/ (function(module, exports, __webpack_require__) {

var hide = __webpack_require__(34);
module.exports = function (target, src, safe) {
  for (var key in src) {
    if (safe && target[key]) target[key] = src[key];
    else hide(target, key, src[key]);
  } return target;
};


/***/ }),
/* 112 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(260), __esModule: true };

/***/ }),
/* 113 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _registerInteractionProperty = __webpack_require__(15);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
* 仅仅是一个基类，用来标绘插件的扩展
* @memberof Obj
* @class
* @extends XbsjCzmObj
*/
var PlotBase = function (_XbsjCzmObj) {
    (0, _inherits3.default)(PlotBase, _XbsjCzmObj);

    function PlotBase(earth, guid) {
        (0, _classCallCheck3.default)(this, PlotBase);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PlotBase.__proto__ || (0, _getPrototypeOf2.default)(PlotBase)).call(this, earth, guid));

        (0, _mobx.extendObservable)(_this, {
            editingPolylineShow: false
        });

        _this.disposers.push((0, _registerInteractionProperty.registerPolylineCreating)(_this._earth, _this, {
            polylineCreatingProperty: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolylineEditing)(_this._earth, _this, {
            polylineEditingProperty: 'editing'
        }));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));
        return _this;
    }

    (0, _createClass3.default)(PlotBase, [{
        key: 'onlyMove',
        get: function get() {
            return true;
        }
    }, {
        key: 'fixedPositionsNum',
        get: function get() {
            return undefined;
        }
    }]);
    return PlotBase;
}(_XbsjCzmObj3.default);

PlotBase.defaultOptions = {
    positions: [],
    show: true,
    ground: true
};

var xbsjSchema = {
    title: "PlotBase Property",
    type: "object",
    properties: {
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.PlotBase
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 是否贴地
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.PlotBase
         */
        ground: { type: 'boolean', title: '是否贴地', default: true, description: '是否贴地' },
        /**
         * 位置数组，形式如 [[2.012, 0.65, 10], [1.9, 0.7, 20], ...] 每一个元素分别表示 经度、纬度、高度，其中经度纬度以弧度为单位，高度以米为单位
         * @type {array}
         * @instance
         * @default []
         * @memberof Obj.PlotBase
         */
        positions: { type: 'array', title: '位置数组', default: [], description: '位置数组' }
    }
};

PlotBase.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'ground', 'positions']
}];

PlotBase.xbsjClassification = xbsjClassification;

// PlotBase.registerType(PlotBase, 'PlotBase');

exports.default = PlotBase;

/***/ }),
/* 114 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 单位面片（平铺电子标牌）
 * @instance
 * @type {object}
 * @property {number[]} positions      - 位置数组 [-1,-1,0,1,-1,0,1,1,0,-1,1,0,]
 * @property {number[]} sts      - 纹理坐标数组 [0,0, 1,0, 1,1, 0,1, ]
 * @property {number[]} indices      - 索引数组 [0, 1, 2, 0, 2, 3]
 * @memberof Obj.CustomPrimitive.Geometry
 * @readonly
 */
var unitSquare = {
    positions: [-1, -1, 0, 1, -1, 0, 1, 1, 0, -1, 1, 0],
    sts: [0, 0, 1, 0, 1, 1, 0, 1],
    indices: [0, 1, 2, 0, 2, 3]
};

/**
 * 单位面片（竖立电子标牌）
 * @instance
 * @type {object}
 * @property {number[]} positions      - 位置数组 [0,-1,0, 0,1,0, 0,1,2, 0,-1,2,]
 * @property {number[]} sts      - 纹理坐标数组 [0,0, 1,0, 1,1, 0,1, ]
 * @property {number[]} indices      - 索引数组 [0, 1, 2, 0, 2, 3,]
 * @memberof Obj.CustomPrimitive.Geometry
 * @readonly
 */
var unitBillboard = {
    positions: [0, -1, 0, 0, 1, 0, 0, 1, 2, 0, -1, 2],
    sts: [0, 0, 1, 0, 1, 1, 0, 1],
    indices: [0, 1, 2, 0, 2, 3]

    /**
     * 创建圆柱体
     * @memberof Obj.CustomPrimitive.Geometry
     * @param {number} topRadius 顶部半径
     * @param {number} bottomRadius 底部半径
     * @param {number} height 圆柱高度
     * @param {number} slices 圆柱分段数
     */
};function createCylinder(topRadius, bottomRadius, height, slices) {
    slices = slices | 0;
    var r = Math.PI * 2.0 / slices;

    var x = [].concat((0, _toConsumableArray3.default)(new Array(slices).keys()));
    // 避免某些2018年6月份的chrome打不开
    // const indices = x.flatMap(e => [e, (e+1)%(slices+1), e+slices+1, (e+1)%(slices+1), ((e+1)%(slices+1))+slices+1, e+slices+1]);
    var indices = [];
    x.forEach(function (e) {
        indices.push(e, (e + 1) % (slices + 1), e + slices + 1, (e + 1) % (slices + 1), (e + 1) % (slices + 1) + slices + 1, e + slices + 1);
    });

    x.push(slices); // 第一点得重复，否则，纹理坐标不能统一

    // const bottomPositions = x.flatMap(e => [bottomRadius * Math.cos(e*r), bottomRadius * Math.sin(e*r), 0.0]);
    // const topPositions = x.flatMap(e => [topRadius * Math.cos(e*r), topRadius * Math.sin(e*r), height]);
    var bottomPositions = [];
    var topPositions = [];
    x.forEach(function (e) {
        bottomPositions.push(bottomRadius * Math.cos(e * r), bottomRadius * Math.sin(e * r), 0.0);
        topPositions.push(topRadius * Math.cos(e * r), topRadius * Math.sin(e * r), height);
    });

    var positions = [].concat(bottomPositions, topPositions);
    // const sts = [...x.flatMap(e => [e/slices, 0.0]), ...x.flatMap(e => [e/slices, 1.0])];
    var sts = [];
    x.forEach(function (e) {
        sts.push(e / slices, 0.0);
    });
    x.forEach(function (e) {
        sts.push(e / slices, 1.0);
    });

    return {
        positions: positions,
        indices: indices,
        sts: sts
    };
}

function arrayMinMax(array) {
    var start = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var end = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : array.length;
    var stride = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    var eleFun = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : undefined;

    var min = Number.POSITIVE_INFINITY;
    var max = Number.NEGATIVE_INFINITY;
    var accum = 0.0;

    stride = stride <= 0 ? 1 : stride;
    var l = (end - start) / stride | 0;
    for (var i = start; i < end; i += stride) {
        var val = eleFun ? eleFun(array[i]) : array[i];
        min = min > val ? val : min;
        max = max < val ? val : max;
        accum += val;
    }

    return [min, max, accum, accum / l];
}

var centerScratch = void 0;
var posScratch = void 0;
var enuScrtach = void 0;

/**
 * 根据经纬度点来获取本地坐标点，用来方便给CustomPrimitive的positions属性赋值
 * @param {array<number[]>} positions 所有的位置点坐标，形如[[1.0, 0.5, 0.0], [1.0, 0.53, 0.0], ...]
 * @param {number[]} [origin] 原点，可以为undefined，此时需要自动计算中心点来作为原点
 * @memberof Obj.CustomPrimitive.Geometry
 */
function getLocalPositions(positions, origin) {
    var result = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : [];

    centerScratch = centerScratch || new Cesium.Cartesian3();
    posScratch = posScratch || new Cesium.Cartesian3();
    enuScrtach = enuScrtach || new Cesium.Matrix4();

    if (!origin) {
        var _arrayMinMax = arrayMinMax(positions, undefined, undefined, undefined, function (e) {
            return e[0];
        }),
            _arrayMinMax2 = (0, _slicedToArray3.default)(_arrayMinMax, 4),
            xmin = _arrayMinMax2[0],
            xmax = _arrayMinMax2[1],
            xaccum = _arrayMinMax2[2],
            xavg = _arrayMinMax2[3];

        var _arrayMinMax3 = arrayMinMax(positions, undefined, undefined, undefined, function (e) {
            return e[1];
        }),
            _arrayMinMax4 = (0, _slicedToArray3.default)(_arrayMinMax3, 4),
            ymin = _arrayMinMax4[0],
            ymax = _arrayMinMax4[1],
            yaccum = _arrayMinMax4[2],
            yavg = _arrayMinMax4[3];

        var _arrayMinMax5 = arrayMinMax(positions, undefined, undefined, undefined, function (e) {
            return e[2];
        }),
            _arrayMinMax6 = (0, _slicedToArray3.default)(_arrayMinMax5, 4),
            zmin = _arrayMinMax6[0],
            zmax = _arrayMinMax6[1],
            zaccum = _arrayMinMax6[2],
            zavg = _arrayMinMax6[3];

        origin = [xavg, yavg, zavg];
    }

    var center = Cesium.Cartesian3.fromRadians(origin[0], origin[1], origin[2], undefined, centerScratch);
    var enu = Cesium.Transforms.eastNorthUpToFixedFrame(center, undefined, enuScrtach);
    var enuInv = Cesium.Matrix4.inverse(enu, enu);

    var localPositions = result;
    positions.forEach(function (e) {
        var pos = Cesium.Cartesian3.fromRadians(e[0], e[1], e[2], undefined, posScratch);
        Cesium.Matrix4.multiplyByPoint(enuInv, pos, pos);

        localPositions.push(pos.x, pos.y, pos.z);
    });

    return [localPositions, origin];
}

/**
 * Geometry
 * @name Geometry
 * @namespace
 * @memberof Obj.CustomPrimitive
 * @static
 */

var Geometry = {
    unitSquare: unitSquare,
    unitBillboard: unitBillboard,
    createCylinder: createCylinder,
    getLocalPositions: getLocalPositions
};

exports.default = Geometry;

/***/ }),
/* 115 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getPropsSpec = exports.getVertexShaderStringAndAttributeLayoutSpec = exports.createOrSetBuffers = exports.AttributeType = undefined;

var _values = __webpack_require__(351);

var _values2 = _interopRequireDefault(_values);

var _getIterator2 = __webpack_require__(77);

var _getIterator3 = _interopRequireDefault(_getIterator2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _webglConsts = __webpack_require__(169);

var _webglConsts2 = _interopRequireDefault(_webglConsts);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/***
 * @type { import(.).AttributeType }
 */
var AttributeType = exports.AttributeType = _webglConsts2.default;

/***
 * 根据属性的配置信息，来计算它的内存布局
 * @param {import('.').PropLayoutSpec} propLayoutSpec 属性布局规格
 * @returns {import('.').PropsSpec} 返回PropSpec类型
 *
 * @example
 *  // bufferAttribSpec的定义
 *  const propLayoutSpec = {
 *      bufferName: 'xxx',
 *      accessors: [
 *          {
 *              type: WebGLRenderingContext.FLOAT,
 *              size: 4,
 *              composite: [
 *                  [2, 'size'],
 *                  [2, 'origin'],
 *              ]
 *          },
 *          {
 *              type: WebGLRenderingContext.FLOAT,
 *              size: 4,
 *              composite: [
 *                  [1, 'subImageYOffset'],
 *                  [1, 'subImageWidth'],
 *                  [1, 'subImageHeight'],
 *                  [1, 'animateImageNum'],
 *              ],
 *          },
 *          {
 *              type: WebGLRenderingContext.FLOAT,
 *              size: 2,
 *              composite: [
 *                  [1, 'startTime'],
 *                  [1, 'duration'],
 *              ],
 *          },
 *          {
 *              type: WebGLRenderingContext.FLOAT,
 *              size: 2,
 *              propName: 'instancePosition',
 *          },
 *      ]
 *  };
 */
function getPropsSpec(propLayoutSpec) {
    var vertexByteLength = 0;
    /***
     *  @type {{
     *     [x: string]: {
     *         offset: number,
     *         size: number,
     *         type: number,
     *         composite?: number[],
     *         byteLength: number,
     *     }
     *  }}
     */
    var props = {};
    /*** @type number */
    var offset = 0;

    propLayoutSpec.accessors.forEach(function (a) {
        var as = void 0;
        switch (a.type) {
            case WebGL2RenderingContext.BYTE:
                as = 1;
                break;
            case WebGL2RenderingContext.SHORT:
                as = 2;
                break;
            case WebGL2RenderingContext.UNSIGNED_BYTE:
                as = 1;
                break;
            case WebGL2RenderingContext.UNSIGNED_SHORT:
                as = 2;
                break;
            case WebGL2RenderingContext.FLOAT:
                as = 4;
                break;
            // TODO(vtxf):
            case WebGL2RenderingContext.HALF_FLOAT:
            default:
                throw new Error('attributeType类型有误！');
        }
        as *= a.size;

        vertexByteLength += as;

        if (a.propName && !a.composite) {
            props[a.propName] = {
                offset: offset,
                size: a.size,
                type: a.type,
                byteLength: as
            };
            offset += as;
        } else if (a.type === WebGLRenderingContext.FLOAT && a.composite) {
            a.composite.forEach(function (c, i) {
                if (typeof c[1] === 'string') {
                    props[c[1]] = {
                        offset: offset,
                        size: c[0],
                        type: a.type,
                        byteLength: c[0] * 4
                    };
                } else if (Array.isArray(c[1])) {
                    var composite = [].concat((0, _toConsumableArray3.default)(c[1]));
                    c[1].forEach(function (s, j) {
                        props[s[1]] = {
                            offset: offset,
                            size: c[0],
                            type: a.type,
                            composite: composite,
                            byteLength: c[0] * 4
                        };
                    });
                }
                offset += c[0] * 4;
            });
        } else if (!a.propName && !a.composite) {
            // 相当于需要忽略！
            offset += as;
            console.log('有属性被忽略！');
        } else {
            // console.warn('cannot get prop!');
            throw new Error('Spec不合法，不能处理！');
        }
    });

    return {
        props: props,
        vertexByteLength: vertexByteLength
    };
}

/***
 * 创建WebGLBuffer
 * @param { import('.').PropLayoutSpec } propLayoutSpec
 * @param { {
 *     userObjectIteratorOrIterable: Iterator | Iterable<any>,
 *     userObjectLength: number,
 *     arrayBufferResult?: ArrayBuffer,
 *     propsSpec?: PropsSpec,
 *     arrayBufferResultOffset?: number,
 * } } options 额外参数
 * @param { Iterator | Iterable<any> } options.userObjectIteratorOrIterable 包含所有属性的对象的数组或者迭代器形式
 * @param { number } options.userObjectLength 数组的长度，显示指定，因为如果是迭代器形式的userObjectIteratorOrIterable，无法找到长度
 * @param { import(.).PropsSpec } [options.propsSpec] 参数可选，若没有，内部会调用getPropSpec自动计算一下，最好带上，以减少计算
 * @param { ArrayBuffer } [options.arrayBufferResult] 结果存储的地方，若不指定会自动构造
 * @param { number } [options.arrayBufferResultOffset] 参数可选，arrayBufferResult的偏移量
 */
function createOrSetBuffers(propLayoutSpec) {
    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        userObjectIteratorOrIterable = _ref.userObjectIteratorOrIterable,
        _ref$userObjectLength = _ref.userObjectLength,
        userObjectLength = _ref$userObjectLength === undefined ? 0 : _ref$userObjectLength,
        propsSpec = _ref.propsSpec,
        arrayBufferResult = _ref.arrayBufferResult,
        _ref$arrayBufferResul = _ref.arrayBufferResultOffset,
        arrayBufferResultOffset = _ref$arrayBufferResul === undefined ? 0 : _ref$arrayBufferResul;

    propsSpec = propsSpec || getPropsSpec(propLayoutSpec);

    if (!arrayBufferResult) {
        arrayBufferResult = new ArrayBuffer(propsSpec.vertexByteLength * userObjectLength);
        arrayBufferResultOffset = 0;
    } else {
        var realSize = arrayBufferResult.byteLength - arrayBufferResultOffset;
        if (realSize < propsSpec.vertexByteLength * userObjectLength) {
            throw new Error('空间不足！');
        }
    }

    var bufferChangedOffset = undefined;
    var bufferChangedLength = 0;

    if (userObjectIteratorOrIterable) {
        var currentUserObjectLength = 0;
        var vei = 0;
        var _iteratorNormalCompletion = true;
        var _didIteratorError = false;
        var _iteratorError = undefined;

        try {
            var _loop = function _loop() {
                var e = _step.value;

                /***
                 * 如果有index的话，会用上，也就是说，可以是稀疏数组
                 */
                var index = e.index || vei;
                vei++;

                {
                    // 计算bufferChangedOffset，bufferChangedLength
                    if (typeof bufferChangedOffset === 'undefined') {
                        bufferChangedOffset = index * propsSpec.vertexByteLength;
                    }
                    bufferChangedLength = (index + 1) * propsSpec.vertexByteLength - bufferChangedOffset;
                }

                var assignAttrib = function assignAttrib(propName, attributeType, asize) {
                    var offset = propsSpec.props[propName].offset + propsSpec.vertexByteLength * index;

                    var size = asize;

                    var ArrayType = void 0;
                    switch (attributeType) {
                        case WebGL2RenderingContext.BYTE:
                            ArrayType = Int8Array;
                            break;
                        case WebGL2RenderingContext.SHORT:
                            ArrayType = Int16Array;
                            break;
                        case WebGL2RenderingContext.UNSIGNED_BYTE:
                            ArrayType = Uint8Array;
                            break;
                        case WebGL2RenderingContext.UNSIGNED_SHORT:
                            ArrayType = Uint16Array;
                            break;
                        case WebGL2RenderingContext.FLOAT:
                            ArrayType = Float32Array;
                            break;
                        // TODO(vtxf):
                        case WebGL2RenderingContext.HALF_FLOAT:
                        default:
                            throw new Error('attributeType类型有误！');
                    }

                    var typedArray = new ArrayType(arrayBufferResult, offset + arrayBufferResultOffset, size);
                    if (size === 1) {
                        typedArray[0] = e[propName];
                    } else {
                        for (var i = 0; i < size; ++i) {
                            typedArray[i] = e[propName][i];
                        }
                    }
                };

                var assignCompsitAttrib = function assignCompsitAttrib(composite) {
                    var firstAttributeName = composite[0][1];
                    var offset = propsSpec.props[firstAttributeName].offset + propsSpec.vertexByteLength * index;
                    var bytesOffset = 0;
                    var accum = 0;
                    composite.forEach(function (ce) {
                        var propName = ce[1];
                        accum += e[propName] << bytesOffset;
                        bytesOffset += ce[0];
                    });
                    var fd = new DataView(arrayBufferResult, offset + arrayBufferResultOffset, 4);
                    fd.setFloat32(0, accum, true);
                };

                propLayoutSpec.accessors.forEach(function (a) {
                    if (a.propName) {
                        assignAttrib(a.propName, a.type, a.size);
                    } else if (a.composite) {
                        a.composite.forEach(function (ac) {
                            if (typeof ac[1] === 'string') {
                                assignAttrib(ac[1], a.type, ac[0]);
                            } else if (Array.isArray(ac[1])) {
                                assignCompsitAttrib(ac[1]);
                            }
                        });
                    }
                });

                currentUserObjectLength++;
                if (currentUserObjectLength >= userObjectLength) {
                    return 'break';
                }
            };

            for (var _iterator = (0, _getIterator3.default)(userObjectIteratorOrIterable), _step; !(_iteratorNormalCompletion = (_step = _iterator.next()).done); _iteratorNormalCompletion = true) {
                var _ret = _loop();

                if (_ret === 'break') break;
            }
        } catch (err) {
            _didIteratorError = true;
            _iteratorError = err;
        } finally {
            try {
                if (!_iteratorNormalCompletion && _iterator.return) {
                    _iterator.return();
                }
            } finally {
                if (_didIteratorError) {
                    throw _iteratorError;
                }
            }
        }
    }

    bufferChangedOffset += arrayBufferResultOffset;

    return {
        bufferChangedOffset: bufferChangedOffset,
        bufferChangedLength: bufferChangedLength,
        arrayBufferResult: arrayBufferResult
    };
}

/***
 * 根据属性描述信息来创建shader需要的attribute，以及属性的布局情况
 * @param { import('.').PropLayoutSpec } propLayoutSpec
 */
function getVertexShaderStringAndAttributeLayoutSpec(propLayoutSpec) {
    var vsDecl = '';
    var vsMainStart = '';

    /***
     * @type { import('.').attributeLayoutSpec }
     */
    var attributeLayoutSpec = {};

    var attribOffset = 0;
    var vertexByteLength = 0;
    propLayoutSpec.accessors.forEach(function (a) {
        if (a.propName) {
            var type = a.size === 1 ? 'float' : 'vec' + a.size;
            vsDecl += 'attribute ' + type + ' ' + a.propName + '; \n';
            attributeLayoutSpec[a.propName] = {
                size: a.size,
                offset: attribOffset,
                type: a.type
            };
        } else if (Array.isArray(a.composite)) {
            var compName = 'cmpt';
            var size = 0;
            a.composite.forEach(function (ac) {
                size += ac[0];
                if (typeof ac[1] === 'string') {
                    compName += '_' + ac[1];
                } else if (Array.isArray(ac[1])) {
                    ac[1].forEach(function (acc) {
                        compName += '_' + acc[1];
                    });
                }
            });

            var _type = size === 1 ? 'float' : 'vec' + size;
            vsDecl += 'attribute ' + _type + ' ' + compName + '; \n';
            attributeLayoutSpec[compName] = {
                size: a.size,
                offset: attribOffset,
                type: a.type
            };

            var typeOffset = 0;
            a.composite.forEach(function (ac) {
                var typeSize = ac[0];

                if (typeof ac[1] === 'string') {
                    var typeName = 'xyzw'.substring(typeOffset, typeOffset + typeSize);
                    var _type2 = typeSize === 1 ? 'float' : 'vec' + typeSize;
                    vsMainStart += _type2 + ' ' + ac[1] + ' = ' + compName + '.' + typeName + '; \n';
                } else if (Array.isArray(ac[1]) && ac[0] === 1) {
                    var _typeName = 'xyzw'[typeOffset];
                    var attribName = 'cmptf_' + ac[1].map(function (e) {
                        return e[1];
                    }).join('_');
                    vsMainStart += 'float ' + attribName + ' = ' + compName + '.' + _typeName + '; \n';

                    var varOffset = 0;
                    var vars = ac[1].map(function (acc) {
                        var accvar = 'float ' + acc[1] + ' = floor(' + attribName + ' * ' + (1 / (1 << varOffset)).toExponential() + '); ' + attribName + ' -= ' + acc[1] + ' * ' + (1 << varOffset).toExponential() + '; \n';
                        varOffset += acc[0];
                        return accvar;
                    });
                    vars = vars.reverse();

                    vsMainStart += vars.join('');
                }

                typeOffset += typeSize;
            });
        }

        var attributeSize = void 0;
        if (a.type === WebGLRenderingContext.FLOAT) {
            attributeSize = 4 * a.size;
        } else if (a.type === WebGLRenderingContext.UNSIGNED_BYTE) {
            attributeSize = 1 * a.size;
        } else {
            throw new Error('a.type is not float or unsigned byte.');
        }

        vertexByteLength += attributeSize;

        attribOffset += attributeSize;
    });

    (0, _values2.default)(attributeLayoutSpec).forEach(function (e) {
        e.stride = vertexByteLength;
    });

    return {
        vsDecl: vsDecl,
        vsMainStart: vsMainStart,
        attributeLayoutSpec: attributeLayoutSpec
    };
}

exports.createOrSetBuffers = createOrSetBuffers;
exports.getVertexShaderStringAndAttributeLayoutSpec = getVertexShaderStringAndAttributeLayoutSpec;
exports.getPropsSpec = getPropsSpec;

// test

// const WebGLRenderingContext = {};
// WebGLRenderingContext.FLOAT = 5126;
// WebGLRenderingContext.UNSIGNED_BYTE = 5121;

// const testData = [
//     {
//         position: [1, 2, 3],
//         positionXY: [4, 5],
//         positionZ: 1,
//         pixelOffsetX: 1,
//         pixelOffsetY: 1,
//         originX: 1,
//         originY: 1,
//         show: 1,
//         hh: 2,
//         index: 0,
//     },
//     {
//         position: [1, 2, 3],
//         positionXY: [4, 5],
//         positionZ: 1,
//         pixelOffsetX: 1,
//         pixelOffsetY: 1,
//         originX: 1,
//         originY: 1,
//         show: 1,
//         hh: 2,
//         index: 0,
//     },
// ]

// const propLayoutSpec =
// {
//     bufferName: 'xxx',
//     accessors: [
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 3,
//             propName: 'position',
//         },
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 4,
//             composite: [
//                 [2, 'positionXY'],
//                 [1, 'positionZ'],
//                 [1, [ // 有compsite，这里只能是1
//                     [8, 'pixelOffsetX'], // 从低位到高位
//                     [8, 'pixelOffsetY'],
//                     [2, 'originX'],
//                     [2, 'originY'],
//                     [1, 'show'],
//                 ]],
//             ],
//         },
//         {
//             type: WebGLRenderingContext.UNSIGNED_BYTE,
//             size: 1,
//             propName: 'hh',
//         },
//         { // 仅仅是为了补空位
//             type: WebGLRenderingContext.UNSIGNED_BYTE,
//             size: 3,
//             propName: '', // 控制不产生attributeName
//         }
//     ]
// };

// const result = createOrSetBuffers(propLayoutSpec, {
//     userObjectIteratorOrIterable: testData,
//     userObjectLength: 2,
// });
// console.log(result);

// const vss = getVertexShaderStringAndAttributeLayoutSpec(propLayoutSpec);
// console.log(vss);

// test2

// var propLayoutSpec = {
//     bufferName: 'xxx',
//     accessors: [
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 4,
//             composite: [
//                 [2, 'size'],
//                 [2, 'origin'],
//             ]
//         },
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 4,
//             composite: [
//                 [1, 'subImageYOffset'],
//                 [1, 'subImageWidth'],
//                 [1, 'subImageHeight'],
//                 [1, 'animateImageNum'],
//             ],
//         },
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 2,
//             composite: [
//                 [1, 'startTime'],
//                 [1, 'duration'],
//             ],
//         },
//         {
//             type: WebGLRenderingContext.FLOAT,
//             size: 2,
//             propName: 'instancePosition',
//         },
//     ]
// };

// var testData = [
//     {
//         size: [800.0, 50.0],
//         origin: [0.0, 0.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 0,
//         duration: 4000,
//         instancePosition: [-1.0, -1.0],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [1.0, 0.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 5000,
//         duration: 20000,
//         instancePosition: [1.0, -1.0],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [1.0, 1.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 10000,
//         duration: 20000,
//         instancePosition: [1.0, 1.0],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [0.0, 1.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 15000,
//         duration: 20000,
//         instancePosition: [-1.0, 1.0],
//     },
// ];

// var result = createOrSetBuffers(propLayoutSpec, {
//     userObjectIteratorOrIterable: testData,
//     userObjectLength: 2,
// });
// console.log(result);

// var vss = getVertexShaderStringAndAttributeLayoutSpec(propLayoutSpec);
// console.log(vss);

// const assembledShaders = assembleShaders(gl, {
//   vs: vertexShaderSourceString,
//   fs: fragmentShaderSourceString,
//   inject: {
//       'vs:#decl': vss.vsDecl,
//       'vs:#main-start': vss.vsMainStart,
//   },
// });

// const program = new Program(gl, {
//   id: 'my-program',
//   vs: assembledShaders.vs,
//   fs: assembledShaders.fs,
// });

/***/ }),
/* 116 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function _canMoveTo(sceneNode, destinatonGroup) {
    var currentNode = destinatonGroup;
    while (currentNode) {
        if (sceneNode === currentNode) {
            return false;
        }
        currentNode = currentNode.parent;
    }

    return true;
}

function moveSceneNode(sceneNode, destinatonGroup, destinationIndex) {
    if (!_canMoveTo(sceneNode, destinatonGroup)) {
        return false;
    }

    sceneNode._autoDestroy = false;

    var originGroup = sceneNode.parent;
    var index = originGroup.children.indexOf(sceneNode);
    originGroup.children.splice(index, 1);

    sceneNode._autoDestroy = true;

    destinatonGroup.children.splice(destinationIndex, 0, sceneNode);

    return true;
}

/**
 * 场景结构树节点基类
 * @class
 * @memberof SceneTree
 * @param {object} czmObject earth实例
 * @extends XbsjBase
 */

var Node = function (_XbsjBase) {
    (0, _inherits3.default)(Node, _XbsjBase);

    function Node(earth) {
        (0, _classCallCheck3.default)(this, Node);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Node.__proto__ || (0, _getPrototypeOf2.default)(Node)).call(this));

        _this.fromJsonFilterKeys.push('isSelected');
        _this.toJsonFilterKeys.push('isSelected');

        if (typeof earth === 'undefined') {
            console.warn('Group的参数earth最好写上，避免以后不兼容！');
        }

        _this._earth = earth;
        _this._parent = undefined;
        _this._autoDestroy = true;
        _this._xbsjID = Cesium.createGuid(); // 不可修改
        _this._event = new Cesium.Event();

        _this._isSelectedIntercept = (0, _mobx.intercept)(_this, 'isSelected', function (changed) {
            // this.event.raiseEvent({type: 'changed', node: this, property: 'isSelected', changed: changed });
            if (typeof changed.newValue !== 'boolean') {
                return;
            }

            if (changed.newValue) {
                if (_this._earth.sceneTree._currentSelectedNode) {
                    _this._earth.sceneTree._currentSelectedNode.isSelected = false;
                }
                _this._earth.sceneTree._currentSelectedNode = _this;
            } else {
                if (_this._earth.sceneTree._currentSelectedNode && _this._earth.sceneTree._currentSelectedNode === _this) {
                    _this._earth.sceneTree._currentSelectedNode = undefined;
                }
            }

            return changed;
        });

        (0, _mobx.intercept)(_this, 'ref', function (changed) {
            if (changed.type === 'update') {
                if (changed.object.value) {
                    delete _this._earth.sceneTree.$refs[changed.object.value];
                }

                if (changed.newValue) {
                    if (_this._earth.sceneTree.$refs[changed.newValue]) {
                        console.warn('同一个ref被使用了多次！');
                    }
                    _this._earth.sceneTree.$refs[changed.newValue] = _this;
                }

                return changed;
            }

            return null;
        });

        _this.currentSelectedNode;
        return _this;
    }

    (0, _createClass3.default)(Node, [{
        key: 'canMoveTo',

        /**
         * 当前节点是否可以移动到某个组节点下
         * @param {*} destinatonGroup 目标组节点
         * @returns {boolean}
         */
        value: function canMoveTo(destinatonGroup) {
            return _canMoveTo(this, destinatonGroup);
        }

        /**
         * 将当前节点移动到某个组节点下的某个位置之前
         * @param {*} destinatonGroup 目标组节点
         * @param {*} destinationIndex 目标组节点中某个索引位置
         */

    }, {
        key: 'moveTo',
        value: function moveTo(destinatonGroup, destinationIndex) {
            destinationIndex = typeof destinationIndex !== 'undefined' ? destinationIndex : destinatonGroup.children.length;
            return moveSceneNode(this, destinatonGroup, destinationIndex);
        }

        /**
         * 将当前节点克隆到某个组节点下的某个位置之前
         * @param {*} destinatonGroup 目标组节点
         * @param {*} destinationIndex 目标组节点中某个索引位置
         */

    }, {
        key: 'cloneTo',
        value: function cloneTo(destinatonGroup, destinationIndex) {
            destinationIndex = typeof destinationIndex !== 'undefined' ? destinationIndex : destinatonGroup.children.length;
            destinatonGroup.children.splice(destinationIndex, 0, this.toJSON());
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.ref = ''; // 强制去掉引用！
            this.isSelected = false;
            this._isSelectedIntercept = this._isSelectedIntercept && this._isSelectedIntercept();
            return (0, _get3.default)(Node.prototype.__proto__ || (0, _getPrototypeOf2.default)(Node.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'event',
        get: function get() {
            return this._event;
        }

        /**
         * 返回组节点的id
         */

    }, {
        key: 'xbsjID',
        get: function get() {
            return this._xbsjID;
        }

        /**
         * 获取父节点
         */

    }, {
        key: 'parent',
        get: function get() {
            return this._parent;
        }
    }]);
    return Node;
}(_XbsjBase3.default);

Node.defaultOptions = {
    /**
     * 名称
     * @type {string}
     * @default '未命名'
     * @instance
     * @memberof Node
     */
    title: '未命名',
    /**
     * 是否选中
     * @type {boolean}
     * @default false
     * @instance
     * @memberof Node
     */
    isSelected: false,
    /**
     * 类似Vue中的ref属性，方便以后快速寻找到这个属性
     * @type {string}
     * @default '''
     * @instance
     * @memberof Node
     */
    ref: ''
};

exports.default = Node;

/***/ }),
/* 117 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _Node2 = __webpack_require__(116);

var _Node3 = _interopRequireDefault(_Node2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _mobx = __webpack_require__(2);

var _XbsjCzmObj = __webpack_require__(11);

var _XbsjCzmObj2 = _interopRequireDefault(_XbsjCzmObj);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 场景结构树叶子节点
 * @class
 * @memberof SceneTree
 * @param {object} czmObject earth实例
 * @extends SceneTree.Node
 */
var Leaf = function (_Node) {
    (0, _inherits3.default)(Leaf, _Node);

    function Leaf(czmObject) {
        var _this$fromJsonFilterK, _this$toJsonFilterKey;

        (0, _classCallCheck3.default)(this, Leaf);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Leaf.__proto__ || (0, _getPrototypeOf2.default)(Leaf)).call(this, czmObject.earth));

        var filters = ['enabled', 'title'];
        (_this$fromJsonFilterK = _this.fromJsonFilterKeys).push.apply(_this$fromJsonFilterK, filters);
        (_this$toJsonFilterKey = _this.toJsonFilterKeys).push.apply(_this$toJsonFilterKey, filters);

        /**
         * 当前叶子节点是否被选中的状态，注意此属性只读，属性值只有两个：'checked' / 'unchecked' <br/>
         * 'checked'表示当前节点都可用，'unchecked'表示当前节点不可用
         * @name checkStatus
         * @type {string}
         * @instance
         * @memberof SceneTree.Leaf
         * @readonly
         */

        (0, _mobx.extendObservable)(_this, {
            // enabled: true,
            get checkStatus() {
                return this.enabled ? 'checked' : 'unchecked';
            }
        }, {
            checkStatus: _mobx.computed
        });

        _this.czmObject = czmObject;

        _this._disposers = [];

        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this.czmObject, 'enabled'));
        _this._disposers.push((0, _bind2.default)(_this, 'isSelected', _this.czmObject, 'isSelected'));
        _this._disposers.push((0, _bind2.default)(_this, 'title', _this.czmObject, 'name'));

        _this._disposers.push(_XbsjBase2.default.registerProperty(_this, 'czmObject'));
        return _this;
    }

    // xbsjFromJSON(jsonObject) {
    //     super.xbsjFromJSON(jsonObject);
    //     this.czmObject.xbsjFromJSON(jsonObject.czmObject);
    // }

    /**
     * 创建一个json对象
     * @method
     * @returns {object} 一个json对象
     */
    // toJSON() {
    //     return {
    //         ...super.toJSON(),
    //         czmObject: this.czmObject.toJSON(),
    //     };
    // }

    /**
     * 销毁自身
     * @instance
     * @returns {undefined} 返回undefined
     */

    (0, _createClass3.default)(Leaf, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            this.czmObject = this.czmObject && this.czmObject.destroy();
            return (0, _get3.default)(Leaf.prototype.__proto__ || (0, _getPrototypeOf2.default)(Leaf.prototype), 'destroy', this).call(this);
        }
    }]);
    return Leaf;
}(_Node3.default);

Leaf.xbsjFromJSON = function (jsonObject, earth) {
    var xbsjType = jsonObject.czmObject.xbsjType;
    var xbsjGuid = jsonObject.czmObject.xbsjGuid;
    var czmObject = _XbsjObject2.default.createObject(xbsjType, earth, xbsjGuid);
    czmObject.xbsjFromJSON(jsonObject.czmObject);

    var sceneObject = new Leaf(czmObject);
    sceneObject.xbsjFromJSON(jsonObject);

    return sceneObject;
};

Leaf.defaultOptions = {
    /**
     * 当前节点是否可用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof SceneTree.Leaf
     */
    enabled: true,
    /**
     * 当前节点挂接的对象
     * @type {XbsjCzmObj | null}
     * @default null
     * @instance
     * @memberof SceneTree.Leaf
     */
    czmObject: null
};

exports.default = Leaf;

/***/ }),
/* 118 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = canReportError;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START _Subscriber PURE_IMPORTS_END */

function canReportError(observer) {
    while (observer) {
        var _a = observer, closed_1 = _a.closed, destination = _a.destination, isStopped = _a.isStopped;
        if (closed_1 || isStopped) {
            return false;
        }
        else if (destination && destination instanceof __WEBPACK_IMPORTED_MODULE_0__Subscriber__["a" /* Subscriber */]) {
            observer = destination;
        }
        else {
            observer = null;
        }
    }
    return true;
}
//# sourceMappingURL=canReportError.js.map


/***/ }),
/* 119 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = hostReportError;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function hostReportError(err) {
    setTimeout(function () { throw err; }, 0);
}
//# sourceMappingURL=hostReportError.js.map


/***/ }),
/* 120 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isObject;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isObject(x) {
    return x !== null && typeof x === 'object';
}
//# sourceMappingURL=isObject.js.map


/***/ }),
/* 121 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return rxSubscriber; });
/* unused harmony export $$rxSubscriber */
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var rxSubscriber = typeof Symbol === 'function'
    ? /*@__PURE__*/ Symbol('rxSubscriber')
    : '@@rxSubscriber_' + /*@__PURE__*/ Math.random();
var $$rxSubscriber = rxSubscriber;
//# sourceMappingURL=rxSubscriber.js.map


/***/ }),
/* 122 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = noop;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function noop() { }
//# sourceMappingURL=noop.js.map


/***/ }),
/* 123 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = of;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__util_isScheduler__ = __webpack_require__(45);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__fromArray__ = __webpack_require__(68);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__scheduled_scheduleArray__ = __webpack_require__(124);
/** PURE_IMPORTS_START _util_isScheduler,_fromArray,_scheduled_scheduleArray PURE_IMPORTS_END */



function of() {
    var args = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        args[_i] = arguments[_i];
    }
    var scheduler = args[args.length - 1];
    if (Object(__WEBPACK_IMPORTED_MODULE_0__util_isScheduler__["a" /* isScheduler */])(scheduler)) {
        args.pop();
        return Object(__WEBPACK_IMPORTED_MODULE_2__scheduled_scheduleArray__["a" /* scheduleArray */])(args, scheduler);
    }
    else {
        return Object(__WEBPACK_IMPORTED_MODULE_1__fromArray__["a" /* fromArray */])(args);
    }
}
//# sourceMappingURL=of.js.map


/***/ }),
/* 124 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = scheduleArray;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function scheduleArray(input, scheduler) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var sub = new __WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]();
        var i = 0;
        sub.add(scheduler.schedule(function () {
            if (i === input.length) {
                subscriber.complete();
                return;
            }
            subscriber.next(input[i++]);
            if (!subscriber.closed) {
                sub.add(this.schedule());
            }
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleArray.js.map


/***/ }),
/* 125 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AsyncSubject; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subject__ = __webpack_require__(52);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START tslib,_Subject,_Subscription PURE_IMPORTS_END */



var AsyncSubject = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AsyncSubject, _super);
    function AsyncSubject() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this.value = null;
        _this.hasNext = false;
        _this.hasCompleted = false;
        return _this;
    }
    AsyncSubject.prototype._subscribe = function (subscriber) {
        if (this.hasError) {
            subscriber.error(this.thrownError);
            return __WEBPACK_IMPORTED_MODULE_2__Subscription__["a" /* Subscription */].EMPTY;
        }
        else if (this.hasCompleted && this.hasNext) {
            subscriber.next(this.value);
            subscriber.complete();
            return __WEBPACK_IMPORTED_MODULE_2__Subscription__["a" /* Subscription */].EMPTY;
        }
        return _super.prototype._subscribe.call(this, subscriber);
    };
    AsyncSubject.prototype.next = function (value) {
        if (!this.hasCompleted) {
            this.value = value;
            this.hasNext = true;
        }
    };
    AsyncSubject.prototype.error = function (error) {
        if (!this.hasCompleted) {
            _super.prototype.error.call(this, error);
        }
    };
    AsyncSubject.prototype.complete = function () {
        this.hasCompleted = true;
        if (this.hasNext) {
            _super.prototype.next.call(this, this.value);
        }
        _super.prototype.complete.call(this);
    };
    return AsyncSubject;
}(__WEBPACK_IMPORTED_MODULE_1__Subject__["a" /* Subject */]));

//# sourceMappingURL=AsyncSubject.js.map


/***/ }),
/* 126 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return async; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__AsyncAction__ = __webpack_require__(66);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__ = __webpack_require__(67);
/** PURE_IMPORTS_START _AsyncAction,_AsyncScheduler PURE_IMPORTS_END */


var async = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__["a" /* AsyncScheduler */](__WEBPACK_IMPORTED_MODULE_0__AsyncAction__["a" /* AsyncAction */]);
//# sourceMappingURL=async.js.map


/***/ }),
/* 127 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = identity;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function identity(x) {
    return x;
}
//# sourceMappingURL=identity.js.map


/***/ }),
/* 128 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return subscribeTo; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__subscribeToArray__ = __webpack_require__(181);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__subscribeToPromise__ = __webpack_require__(405);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__subscribeToIterable__ = __webpack_require__(406);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__subscribeToObservable__ = __webpack_require__(407);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__isArrayLike__ = __webpack_require__(184);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__isPromise__ = __webpack_require__(185);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__isObject__ = __webpack_require__(120);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__symbol_iterator__ = __webpack_require__(69);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__symbol_observable__ = __webpack_require__(51);
/** PURE_IMPORTS_START _subscribeToArray,_subscribeToPromise,_subscribeToIterable,_subscribeToObservable,_isArrayLike,_isPromise,_isObject,_symbol_iterator,_symbol_observable PURE_IMPORTS_END */









var subscribeTo = function (result) {
    if (!!result && typeof result[__WEBPACK_IMPORTED_MODULE_8__symbol_observable__["a" /* observable */]] === 'function') {
        return Object(__WEBPACK_IMPORTED_MODULE_3__subscribeToObservable__["a" /* subscribeToObservable */])(result);
    }
    else if (Object(__WEBPACK_IMPORTED_MODULE_4__isArrayLike__["a" /* isArrayLike */])(result)) {
        return Object(__WEBPACK_IMPORTED_MODULE_0__subscribeToArray__["a" /* subscribeToArray */])(result);
    }
    else if (Object(__WEBPACK_IMPORTED_MODULE_5__isPromise__["a" /* isPromise */])(result)) {
        return Object(__WEBPACK_IMPORTED_MODULE_1__subscribeToPromise__["a" /* subscribeToPromise */])(result);
    }
    else if (!!result && typeof result[__WEBPACK_IMPORTED_MODULE_7__symbol_iterator__["a" /* iterator */]] === 'function') {
        return Object(__WEBPACK_IMPORTED_MODULE_2__subscribeToIterable__["a" /* subscribeToIterable */])(result);
    }
    else {
        var value = Object(__WEBPACK_IMPORTED_MODULE_6__isObject__["a" /* isObject */])(result) ? 'an invalid object' : "'" + result + "'";
        var msg = "You provided " + value + " where a stream was expected."
            + ' You can provide an Observable, Promise, Array, or Iterable.';
        throw new TypeError(msg);
    }
};
//# sourceMappingURL=subscribeTo.js.map


/***/ }),
/* 129 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机位置状态
 * @class
 * @memberof CameraView
 * @extends XbsjObject
 */
var Status = function (_XbsjBase) {
    (0, _inherits3.default)(Status, _XbsjBase);

    function Status(earth) {
        (0, _classCallCheck3.default)(this, Status);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Status.__proto__ || (0, _getPrototypeOf2.default)(Status)).call(this));

        _this._earth = earth;
        _this._scene = earth.czm.scene;
        return _this;
    }

    /**
     * 获取当前相机位置姿态
     */

    (0, _createClass3.default)(Status, [{
        key: "initWithCurrent",
        value: function initWithCurrent() {
            //获得相机的状态
            var cam = this._scene.camera;
            this.position = [cam.positionCartographic.longitude, cam.positionCartographic.latitude, cam.positionCartographic.height];

            this.rotation = [cam.heading, cam.pitch, cam.roll];

            this.fov = cam.frustum.fov;
            this.near = cam.frustum.near;
            this.far = cam.frustum.far;
        }

        /**
         * 飞行定位
         * @param {number} duration 飞行时间
         */

    }, {
        key: "flyTo",
        value: function flyTo(duration) {
            var _this2 = this;

            return new _promise2.default(function (resolve, reject) {
                var _Cesium$Cartesian;

                // debugger;
                var scene = _this2._scene;
                var position = _this2.position;
                scene.camera.flyTo({
                    destination: (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position)),
                    orientation: {
                        heading: _this2.rotation[0],
                        pitch: _this2.rotation[1],
                        roll: _this2.rotation[2]
                    },
                    duration: duration,
                    complete: function complete() {
                        resolve(true);
                    },
                    cancel: function cancel() {
                        resolve(false);
                    }
                });
            });
        }
    }, {
        key: "toReadable",
        value: function toReadable() {
            var text = "";
            //位置转经纬度 

            text = Cesium.Math.toDegrees(this.position[0]).toFixed(5) + "°," + Cesium.Math.toDegrees(this.position[1]).toFixed(5) + "°," + Cesium.Math.toDegrees(this.position[2]).toFixed(2);
            //朝向转弧度
            text += "\r\n";
            text += Cesium.Math.toDegrees(this.rotation[0]).toFixed(1) + "°," + Cesium.Math.toDegrees(this.rotation[1]).toFixed(1) + "°," + Cesium.Math.toDegrees(this.rotation[2]).toFixed(1) + "°";

            //输出fov
            text += "\r\n";
            text += Cesium.Math.toDegrees(this.fov).toFixed(1) + "°," + this.near.toFixed(1) + "," + this.far.toFixed(1);

            return text;
        }
    }]);
    return Status;
}(_XbsjBase3.default);

Status.defaultOptions = {
    /**
     * 位置数组 [经度、纬度、高度]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof CameraView.Status
     */
    position: [0, 0, 0],
    /**
     * 姿态数组 [偏航角、俯仰角、翻转角]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof CameraView.Status
     */
    rotation: [0, 0, 0],
    /**
     * Cesium模式下的fov角度
     * @type {number}
     * @instance
     * @default 0.0
     * @memberof CameraView.Status
     */
    fov: 0,
    /**
     * 近裁
     * @type {number}
     * @instance
     * @default 0.0
     * @memberof CameraView.Status
     */
    near: 0.0,
    /**
     * 远裁
     * @type {number}
     * @instance
     * @default 0.0
     * @memberof CameraView.Status
     */
    far: 0.0
};

exports.default = Status;

/***/ }),
/* 130 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _Coordinates = __webpack_require__(164);

var _Coordinates2 = _interopRequireDefault(_Coordinates);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _pickVirtualSphere = __webpack_require__(455);

var _pickVirtualSphere2 = _interopRequireDefault(_pickVirtualSphere);

var _pickHeightPosition = __webpack_require__(456);

var _pickHeightPosition2 = _interopRequireDefault(_pickHeightPosition);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _updateRealSceneScale = __webpack_require__(82);

var _updateRealSceneScale2 = _interopRequireDefault(_updateRealSceneScale);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var CoordinatesMoving = function (_XbsjEditing) {
    (0, _inherits3.default)(CoordinatesMoving, _XbsjEditing);

    function CoordinatesMoving(earth) {
        (0, _classCallCheck3.default)(this, CoordinatesMoving);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CoordinatesMoving.__proto__ || (0, _getPrototypeOf2.default)(CoordinatesMoving)).call(this));

        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            position: [0, 0, 0],
            scale: 1.0,
            fixScreenSize: 100,
            toleranceSize: 6,
            xAxisActive: false,
            yAxisActive: false,
            zAxisActive: false,
            xEnabled: true,
            yEnabled: true,
            zEnabled: true,
            skipFirstStepForZ: false
        });

        _this.onlyOnce = false;

        _this._centerCartesian = new Cesium.Cartesian3();
        _this._radius = 6378137;

        _this.disposers.push((0, _mobx.autorun)(function () {
            var _Cesium$Cartesian;

            _this._centerCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this.position).concat([undefined, _this._centerCartesian]));
            _this._radius = Cesium.Cartesian3.magnitude(_this._centerCartesian);
        }));

        (0, _mobx.extendObservable)(_this, {
            _realSceneScale: 1.0,
            _oldPosition: [0, 0, 0],
            _originPosition: [0, 0, 0],
            _originPosition2: [0, 0, 0]
        });

        _this.disposers.push((0, _updateRealSceneScale2.default)(_this._earth, _this));

        // 几何绘制
        _this._createCoordinates();
        _this._createHelperPolyline();
        _this._createXYPlane();
        return _this;
    }

    (0, _createClass3.default)(CoordinatesMoving, [{
        key: '_createXYPlane',
        value: function _createXYPlane() {
            var _this2 = this;

            this._xyPlane = new _Polyline2.default(this._earth);
            this._xyPlane.arcType = 'RHUMB';
            this._xyPlane.material = {
                type: 'XbsjPolylineDashMaterial',
                XbsjPolylineDashMaterial: {
                    color: [1, 1, 0, 1]
                }
            };
            this._xyPlane.positions = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];

            this.disposers.push(function () {
                _this2._xyPlane = _this2._xyPlane && _this2._xyPlane.destroy();
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                var currentStep = _this2.steps.currentStep;
                var d = _this2.position;
                var op = _this2._originPosition;
                var op2 = _this2._originPosition2;
                var p = currentStep > 0 ? op2 : op;
                _this2._xyPlane.show = _this2.steps.enabled && _this2.position && _this2.xAxisActive && _this2.yAxisActive;
                _this2._xyPlane.positions[0].splice(0, 3, p[0], d[1], d[2]);
                _this2._xyPlane.positions[1].splice(0, 3, p[0], p[1], d[2]);
                _this2._xyPlane.positions[2].splice(0, 3, d[0], p[1], d[2]);
            }));
        }
    }, {
        key: '_createCoordinates',
        value: function _createCoordinates() {
            var _this3 = this;

            this._coordinates = new _Coordinates2.default(this._earth);
            this.disposers.push(function () {
                _this3._coordinates = _this3._coordinates && _this3._coordinates.destroy();
            });
            this.disposers.push((0, _bind2.default)(this._coordinates, 'show', this, 'enabled'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'xShow', this, 'xEnabled'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'yShow', this, 'yEnabled'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'zShow', this, 'zEnabled'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'position', this, 'position'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'scale', this, '_realSceneScale'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'xAxisActive', this, 'xAxisActive'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'yAxisActive', this, 'yAxisActive'));
            this.disposers.push((0, _bind2.default)(this._coordinates, 'zAxisActive', this, 'zAxisActive'));
        }
    }, {
        key: '_createHelperPolyline',
        value: function _createHelperPolyline() {
            var _this4 = this;

            this._helperPolyline = new _Polyline2.default(this._earth);
            this._helperPolyline.arcType = 'RHUMB';
            this._helperPolyline.material = {
                type: 'XbsjPolylineDashMaterial',
                XbsjPolylineDashMaterial: {
                    color: [1, 1, 0, 1]
                }
            };

            this._helperPolyline.positions = [[0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0], [0, 0, 0]];

            this.disposers.push(function () {
                _this4._helperPolyline = _this4._helperPolyline && _this4._helperPolyline.destroy();
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                var currentStep = _this4.steps.currentStep;
                var o = [].concat((0, _toConsumableArray3.default)(_this4._oldPosition));
                var d = [].concat((0, _toConsumableArray3.default)(_this4.position));
                _this4._helperPolyline.show = _this4.steps.enabled && currentStep > 0 && _this4._oldPosition && (_this4.xAxisActive || _this4.yAxisActive || _this4.zAxisActive);
                _this4._helperPolyline.positions[0].splice(0, 3, o[0], o[1], d[2]);
                _this4._helperPolyline.positions[1].splice(0, 3, d[0], o[1], d[2]);
                _this4._helperPolyline.positions[2].splice(0, 3, d[0], d[1], d[2]);
                _this4._helperPolyline.positions[3].splice(0, 3, o[0], d[1], d[2]);
                _this4._helperPolyline.positions[4].splice(0, 3, o[0], o[1], d[2]);
                _this4._helperPolyline.positions[5].splice(0, 3, o[0], o[1], o[2]);
            }));
        }
    }, {
        key: '_createMouseMove$',
        value: function _createMouseMove$() {
            var eventSource = this._earth.eventSource;
            var lastMmPositon = { x: 0, y: 0 };
            var mouseMove$ = rxjs.merge(eventSource.mouse.mouseMove, eventSource.cameraChanged.pipe(rxjs.operators.throttleTime(100))).pipe(rxjs.operators.map(function (movement) {
                if (movement && movement.endPosition) {
                    lastMmPositon.x = movement.endPosition.x;
                    lastMmPositon.y = movement.endPosition.y;
                    return movement.endPosition;
                } else {
                    return lastMmPositon;
                }
            }));
            return mouseMove$;
        }
    }, {
        key: '_init',
        value: function _init() {
            var _this5 = this;

            this.mouseMove$ = this.mouseMove$ || this._createMouseMove$();
            this.leftClick$ = this.leftClick$ || this._earth.eventSource.mouse.leftClick;
            this.rightClick$ = this.rightClick$ || this._earth.eventSource.mouse.rightClick;

            this._oldPosition = this._oldPosition || [0, 0, 0];
            this._oldScale = 1.0;
            this._originHeightPosition = this._originHeightPosition || [0, 0, 0];
            this._originHeightPosition2 = this._originHeightPosition2 || [0, 0, 0];

            var scene = this._earth.czm.scene;
            this._stepsOp = this._stepsOp || [[this.mouseMove$, function (windowCoordinates) {
                _this5._step1(scene, windowCoordinates);
            }, this.leftClick$, function (_ref) {
                var position = _ref.position;

                _this5._step1(scene, position);

                if (_this5.xAxisActive || _this5.yAxisActive || _this5.zAxisActive) {
                    var _oldPosition;

                    (_oldPosition = _this5._oldPosition).splice.apply(_oldPosition, [0, 3].concat((0, _toConsumableArray3.default)(_this5.position)));
                    _this5._oldScale = _this5._realSceneScale;

                    _this5._step2(scene, position); // 执行以下，更新下_originPosition2，否则虚线位置不对
                    _this5._steps.next();
                }
            }, this.rightClick$, function () {
                _this5._steps.enabled = false;
            }], [this.mouseMove$, function (windowCoordinates) {
                _this5._step2(scene, windowCoordinates);
            }, this.leftClick$, function (_ref2) {
                var position = _ref2.position;

                _this5._step2(scene, position);

                _this5.xAxisActive = false;
                _this5.yAxisActive = false;
                _this5.zAxisActive = false;
                _this5.onlyOnce ? _this5._steps.next() : _this5._steps.goto(0);
            }, this.rightClick$, function () {
                var _position;

                (_position = _this5.position).splice.apply(_position, [0, 3].concat((0, _toConsumableArray3.default)(_this5._oldPosition)));
                _this5._steps.enabled = false;
            }]];

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_step2',
        value: function _step2(scene, windowCoordinates) {
            var scaleRatio = this._realSceneScale / this._oldScale;
            if (this.xAxisActive || this.yAxisActive) {
                if ((0, _pickVirtualSphere2.default)(scene, windowCoordinates, this._radius, this._originPosition2)) {
                    if (this.xAxisActive) {
                        this.position[0] = this._oldPosition[0] + (this._originPosition2[0] - this._originPosition[0]) + (this._originPosition[0] - this._oldPosition[0]) * (1.0 - scaleRatio);
                    }
                    if (this.yAxisActive) {
                        this.position[1] = this._oldPosition[1] + (this._originPosition2[1] - this._originPosition[1]) + (this._originPosition[1] - this._oldPosition[1]) * (1.0 - scaleRatio);
                    }
                }
            }
            if (this.zAxisActive && (0, _pickHeightPosition2.default)(scene, this._oldPosition, windowCoordinates, this._originHeightPosition2)) {
                this.position[2] = this._oldPosition[2] + (this._originHeightPosition2[2] - this._originHeightPosition[2]) + (this._originHeightPosition[2] - this._oldPosition[2]) * (1.0 - scaleRatio);
            }
        }
    }, {
        key: 'skipFirstStep',
        value: function skipFirstStep() {
            var _oldPosition2, _originHeightPosition, _originPosition;

            var _ref3 = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {},
                _ref3$xAxisActive = _ref3.xAxisActive,
                xAxisActive = _ref3$xAxisActive === undefined ? false : _ref3$xAxisActive,
                _ref3$yAxisActive = _ref3.yAxisActive,
                yAxisActive = _ref3$yAxisActive === undefined ? false : _ref3$yAxisActive,
                _ref3$zAxisActive = _ref3.zAxisActive,
                zAxisActive = _ref3$zAxisActive === undefined ? false : _ref3$zAxisActive;

            (_oldPosition2 = this._oldPosition).splice.apply(_oldPosition2, [0, 3].concat((0, _toConsumableArray3.default)(this.position)));
            (_originHeightPosition = this._originHeightPosition).splice.apply(_originHeightPosition, [0, 3].concat((0, _toConsumableArray3.default)(this.position)));
            (_originPosition = this._originPosition).splice.apply(_originPosition, [0, 3].concat((0, _toConsumableArray3.default)(this.position)));
            this.xAxisActive = xAxisActive;
            this.yAxisActive = yAxisActive;
            this.zAxisActive = zAxisActive;

            this._steps.goto(1);
        }
    }, {
        key: '_step1',
        value: function _step1(scene, windowCoordinates) {
            if ((0, _pickHeightPosition2.default)(scene, this.position, windowCoordinates, this._originHeightPosition)) {
                var diffLongitude = Math.abs(this._originHeightPosition[0] - this.position[0]);
                var diffLatitude = Math.abs(this._originHeightPosition[1] - this.position[1]);
                var diffHeight = this._originHeightPosition[2] - this.position[2];
                var tolerance = this._realSceneScale / this.fixScreenSize * 10.0 / this._radius; // TODO(vtxf): 10得是一个属性！
                if (diffLongitude < tolerance / Math.cos(this.position[1]) && diffLatitude < tolerance && diffHeight > 0 && diffHeight < this._realSceneScale) {
                    this.zAxisActive = this.zEnabled;
                } else {
                    this.zAxisActive = false;
                }
            }

            if (this.zAxisActive) {
                this.xAxisActive = false;
                this.yAxisActive = false;
                return;
            }

            var virtualCarto = (0, _pickVirtualSphere2.default)(scene, windowCoordinates, this._radius, this._originPosition);
            if (typeof virtualCarto !== 'undefined') {
                var _diffLongitude = this._originPosition[0] - this.position[0];
                var _diffLatitude = this._originPosition[1] - this.position[1];
                var _tolerance = this._realSceneScale / this.fixScreenSize * 10.0 / this._radius; // TODO(vtxf): 10得是一个属性！

                var inLongitudeBelt = _diffLongitude > _tolerance && _diffLongitude < this._realSceneScale / (this._radius * Math.cos(this.position[1]));
                var inLatitudeBelt = _diffLatitude > _tolerance / Math.cos(this.position[1]) && _diffLatitude < this._realSceneScale / this._radius;

                if (inLongitudeBelt && inLatitudeBelt) {
                    this.xAxisActive = this.xEnabled;
                    this.yAxisActive = this.yEnabled;
                } else {
                    this.xAxisActive = this.xEnabled && Math.abs(_diffLatitude) < _tolerance && inLongitudeBelt;
                    this.yAxisActive = this.yEnabled && Math.abs(_diffLongitude) < _tolerance / Math.cos(this.position[1]) && inLatitudeBelt;
                }
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this6 = this;

            this._init();

            if (this._stepsDisable) {
                throw new Error('_stepsDisable should not exists!');
            }
            this._stepsDisable = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this6.enabled = false;
            });

            this.skipFirstStepForZ && this.skipFirstStep({ zAxisActive: true });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._stepsDisable = this._stepsDisable && this._stepsDisable();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(CoordinatesMoving.prototype.__proto__ || (0, _getPrototypeOf2.default)(CoordinatesMoving.prototype), 'destroy', this).call(this);
        }
    }]);
    return CoordinatesMoving;
}(_XbsjEditing3.default);

exports.default = CoordinatesMoving;

/***/ }),
/* 131 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

var _PolylinePointAdding = __webpack_require__(460);

var _PolylinePointAdding2 = _interopRequireDefault(_PolylinePointAdding);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var CreatingPolylineBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(CreatingPolylineBinding, _XbsjInteractionBindi);

    function CreatingPolylineBinding(earth) {
        (0, _classCallCheck3.default)(this, CreatingPolylineBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CreatingPolylineBinding.__proto__ || (0, _getPrototypeOf2.default)(CreatingPolylineBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        });

        _this._editing = new _PolylinePointAdding2.default(earth);
        _this.disposers.push(function () {
            return _this._editing = _this._editing && _this._editing.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(CreatingPolylineBinding, [{
        key: '_start',
        value: function _start() {
            var _this2 = this;

            if (this._disableProperty) {
                throw new Error('_disableProperty should be undefined!');
            }

            var localDisposers = [];

            (0, _mobx.runInAction)(function () {
                _this2.target.positions.length = 0;
                _this2.target.rotations && (_this2.target.rotations.length = 0);
            });

            localDisposers.push((0, _bind2.default)(this._editing, 'positions', this.target, 'positions'));
            this.target.rotations && localDisposers.push((0, _bind2.default)(this._editing, 'rotations', this.target, 'rotations'));
            typeof this.target.loop !== 'undefined' && localDisposers.push((0, _bind2.default)(this._editing, 'loop', this.target, 'loop')) || (this._editing.loop = false);
            typeof this.target.editingPolylineShow !== 'undefined' && localDisposers.push((0, _bind2.default)(this._editing, 'polylineShow', this.target, 'editingPolylineShow')) || (this._editing.polylineShow = true);
            this._editing.fixedPositionsNum = this.target.fixedPositionsNum;

            localDisposers.push(_XbsjEditing2.default.enableProperty(this._editing, function () {
                return _this2.target = undefined;
            }));
            localDisposers.reverse();

            this._disableProperty = function () {
                localDisposers.forEach(function (d) {
                    return d();
                });
                localDisposers.length = 0;
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableProperty = this._disableProperty && this._disableProperty();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(CreatingPolylineBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(CreatingPolylineBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._editing;
        }
    }]);
    return CreatingPolylineBinding;
}(_XbsjInteractionBinding2.default);

exports.default = CreatingPolylineBinding;

/***/ }),
/* 132 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 把polygon转变成polyline的形式，以方便进行编辑！
var EditingPolylineLike = function (_XbsjBase) {
    (0, _inherits3.default)(EditingPolylineLike, _XbsjBase);

    function EditingPolylineLike(realObject, positionArray, heightProperty) {
        var sameHeight = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : false;
        (0, _classCallCheck3.default)(this, EditingPolylineLike);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EditingPolylineLike.__proto__ || (0, _getPrototypeOf2.default)(EditingPolylineLike)).call(this));

        (0, _mobx.extendObservable)(_this, {
            positions: [],
            rotations: undefined,
            loop: true // 并不需要做别的，主要是供polylineEditing绑定用！
        });

        _this._realObject = realObject;
        _this._heightProperty = heightProperty;
        _this._positionArray = positionArray;

        _this._disposers = _this._disposers || [];

        // 必须放在_positionArray update之前，这样如果positionArray和positions的数据不一致，就改positions，以保持一致！

        var arrayToPositions = function arrayToPositions(_ref) {
            var positionArray = _ref.positionArray;

            var height = _this._realObject[_this._heightProperty];
            var positions = _this.positions;

            var diffLen = positionArray.length / 2 - positions.length;
            var equals = diffLen === 0 && positions.every(function (p, index) {
                return positionArray[index * 2] === p[0] && positionArray[index * 2 + 1] === p[1];
            });

            if (!equals) {
                if (diffLen > 0) {
                    positions.forEach(function (_, index) {
                        positions[index].splice(0, 2, positionArray[index * 2], positionArray[index * 2 + 1]);
                    });

                    var start = positions.length;
                    for (var i = 0; i < diffLen; ++i) {
                        positions.push([positionArray[(start + i) * 2], positionArray[(start + i) * 2 + 1], height]);
                    }
                } else {
                    for (var _i = 0; _i < positionArray.length; _i += 2) {
                        positions[_i / 2].splice(0, 2, positionArray[_i], positionArray[_i + 1]);
                    }

                    if (diffLen < 0) {
                        var _start = positionArray.length / 2;
                        positions.splice(_start, -diffLen);
                    }
                }
            }
        };

        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                positionArray: [].concat((0, _toConsumableArray3.default)(_this._positionArray))
            };
        }, arrayToPositions, {
            fireImmediately: false // 设为true反而不能及时更新
        }));
        arrayToPositions({ positionArray: [].concat((0, _toConsumableArray3.default)(_this._positionArray)) }); // 手动更新，不用fireImmediately

        var updateHeights = function updateHeights(height) {
            _this.positions.forEach(function (pos) {
                pos[2] = height;
            });
        };
        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this._realObject[_this._heightProperty];
        }, updateHeights, {
            fireImmediately: false // 设为true反而不能及时更新
        }));
        updateHeights(_this._realObject[_this._heightProperty]); // 手动更新，不用fireImmediately

        // // 高度调整以增加的第一个控制点为准
        // this._disposers.push(intercept(this.positions, changed => {
        //     if (changed.type === 'splice') {
        //         // 因为只有一个点时，相当于是给MouseMove的，此时多边形尚未确定，此时暂不进行高度确认；
        //         // 只有增加第二个点时，才说明第一个点已确认，这是才以他的高度作为多边形的高度。
        //         const initialCount = this.positions.length - changed.removedCount;
        //         const finishCount = initialCount + changed.added.length;
        //         if (initialCount <= 1 && finishCount >= 2) {
        //             const finalHeight = changed.index >= 1 ? this.positions[0][2] : changed.added[0][2];
        //             this._realObject[this._heightProperty] = finalHeight;
        //         }
        //     }

        //     return changed;
        // }));

        if (!sameHeight) {
            _this._disposers.push((0, _mobx.reaction)(function () {
                return _this.positions.length > 0 ? _this.positions[0][2] : undefined;
            }, function (height) {
                if (typeof height !== 'undefined') {
                    _this._realObject[_this._heightProperty] = height;
                }
            }));
        } else {
            _this._originHeights = _this.positions.map(function (e) {
                return e[2];
            });
            _this._disposers.push((0, _mobx.reaction)(function () {
                return _this.positions.map(function (e) {
                    return e[2];
                });
            }, function (heights) {
                for (var i = 0; i < heights.length; ++i) {
                    var h = heights[i];

                    if (i >= _this._originHeights.length) {
                        _this._realObject[_this._heightProperty] = h;
                        break;
                    } else if (i < _this._originHeights.length && _this._originHeights[i] !== h) {
                        _this._realObject[_this._heightProperty] = h;
                        break;
                    }
                }

                _this._originHeights = heights;
            }, {
                fireImmediately: true
            }));
        }

        // _positionArray update
        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this.positions.map(function (v) {
                return [v[0], v[1]];
            });
        }, function (positions) {
            var positionArray = _this._positionArray;
            var diffLen = positionArray.length / 2 - positions.length;
            var equals = diffLen === 0 && positions.every(function (p, index) {
                return positionArray[index * 2] === p[0] && positionArray[index * 2 + 1] === p[1];
            });
            if (!equals) {
                // electron不支持flat，很扯
                // positionArray.splice(0, positionArray.length * 2, ...(positions.flat()));
                var positions2 = [];
                positions.forEach(function (p) {
                    return positions2.push(p[0], p[1]);
                });
                positionArray.splice.apply(positionArray, [0, positionArray.length * 2].concat(positions2));
            }
        }, {
            fireImmediately: true
        }));
        return _this;
    }

    (0, _createClass3.default)(EditingPolylineLike, [{
        key: 'resetHeight',
        value: function resetHeight() {
            var accumHeight = this.positions.reduce(function (a, b) {
                return a[2] + b[2];
            }, 0);
            var avHeight = this.positions.length > 0 ? accumHeight / this.positions.length : 0;
            this._realObject[this._heightProperty] = avHeight;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            return (0, _get3.default)(EditingPolylineLike.prototype.__proto__ || (0, _getPrototypeOf2.default)(EditingPolylineLike.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'realObject',
        get: function get() {
            return this._realObject;
        }
    }, {
        key: 'heightProperty',
        get: function get() {
            return this._heightProperty;
        }
    }, {
        key: 'positionsArray',
        get: function get() {
            return this._positionArray;
        }
    }, {
        key: 'onlyMove',
        get: function get() {
            return this._realObject.onlyMove;
        }
    }, {
        key: 'fixedPositionsNum',
        get: function get() {
            return this._realObject.fixedPositionsNum;
        }
    }]);
    return EditingPolylineLike;
}(_XbsjBase3.default);

exports.default = EditingPolylineLike;

/***/ }),
/* 133 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _AmbientOcclusionStage = __webpack_require__(496);

var _AmbientOcclusionStage2 = _interopRequireDefault(_AmbientOcclusionStage);

var _BloomStage = __webpack_require__(497);

var _BloomStage2 = _interopRequireDefault(_BloomStage);

var _BlackAndWhiteStage = __webpack_require__(498);

var _BlackAndWhiteStage2 = _interopRequireDefault(_BlackAndWhiteStage);

var _BrightnessStage = __webpack_require__(499);

var _BrightnessStage2 = _interopRequireDefault(_BrightnessStage);

var _DepthOfFieldStage = __webpack_require__(500);

var _DepthOfFieldStage2 = _interopRequireDefault(_DepthOfFieldStage);

var _MosaicStage = __webpack_require__(501);

var _MosaicStage2 = _interopRequireDefault(_MosaicStage);

var _NightVisionStage = __webpack_require__(502);

var _NightVisionStage2 = _interopRequireDefault(_NightVisionStage);

var _SilhouetteStage = __webpack_require__(503);

var _SilhouetteStage2 = _interopRequireDefault(_SilhouetteStage);

var _LensFlareStage = __webpack_require__(504);

var _LensFlareStage2 = _interopRequireDefault(_LensFlareStage);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 后处理
 * @class
 * @extends XbsjObject
 */
var PostProcess = function (_XbsjObject) {
    (0, _inherits3.default)(PostProcess, _XbsjObject);

    function PostProcess(earth) {
        (0, _classCallCheck3.default)(this, PostProcess);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PostProcess.__proto__ || (0, _getPrototypeOf2.default)(PostProcess)).call(this, earth));

        _this._earth = earth;
        _this._scene = earth.czm.scene;
        _this._globe = _this._scene.globe;

        _this.ambientOcclusion = new _AmbientOcclusionStage2.default(earth);
        _this.bloom = new _BloomStage2.default(earth);
        _this.blackAndWhite = new _BlackAndWhiteStage2.default(earth);

        _this.brightness = new _BrightnessStage2.default(earth);
        _this.depthOfField = new _DepthOfFieldStage2.default(earth);
        _this.lensFlare = new _LensFlareStage2.default(earth);

        _this.nightVision = new _NightVisionStage2.default(earth);
        _this.silhouette = new _SilhouetteStage2.default(earth);
        _this.mosaic = new _MosaicStage2.default(earth);

        _this.disposers.push(function () {
            _this.ambientOcclusion = _this.ambientOcclusion && _this.ambientOcclusion.destroy();
            _this.bloom = _this.bloom && _this.bloom.destroy();
            _this.blackAndWhite = _this.blackAndWhite && _this.blackAndWhite.destroy();
            _this.brightness = _this.brightness && _this.brightness.destroy();
            _this.depthOfField = _this.depthOfField && _this.depthOfField.destroy();
            _this.lensFlare = _this.lensFlare && _this.lensFlare.destroy();
            _this.nightVision = _this.nightVision && _this.nightVision.destroy();
            _this.silhouette = _this.silhouette && _this.silhouette.destroy();
            _this.mosaic = _this.mosaic && _this.mosaic.destroy();
        });

        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'ambientOcclusion'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'bloom'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'blackAndWhite'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'brightness'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'depthOfField'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'lensFlare'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'nightVision'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'silhouette'));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'mosaic'));
        return _this;
    }

    (0, _createClass3.default)(PostProcess, [{
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(PostProcess.prototype.__proto__ || (0, _getPrototypeOf2.default)(PostProcess.prototype), 'destroy', this).call(this);
        }
    }]);
    return PostProcess;
}(_XbsjObject3.default);

PostProcess.defaultOptions = {
    /**
    * 环境光遮蔽
    * @type {AmbientOcclusionStage} 
    * @instance
    * @memberof PostProcess
    */
    ambientOcclusion: null,
    /**
    * 泛光
    * @type {BloomStage} 
    * @instance
    * @memberof PostProcess
    */
    bloom: null,
    /**
    * 黑白
    * @type {BlackAndWhiteStage} 
    * @instance
    * @memberof PostProcess
    */
    blackAndWhite: null,
    /**
    * 亮度
    * @type {BrightnessStage} 
    * @instance
    * @memberof PostProcess
    */
    brightness: null,
    /**
    * 景深
    * @type {DepthOfFieldStage} 
    * @instance
    * @memberof PostProcess
    */
    depthOfField: null,
    /**
    * 镜头耀斑
    * @type {LensFlareStage} 
    * @instance
    * @memberof PostProcess
    */
    lensFlare: null,
    /**
    * 马赛克
    * @type {MosaicStage} 
    * @instance
    * @memberof PostProcess
    */
    mosaic: null,
    /**
    * 夜视
    * @type {NightVisionStage} 
    * @instance
    * @memberof PostProcess
    */
    nightVision: null,
    /**
    * 外轮廓
    * @type {SilhouetteStage} 
    * @instance
    * @memberof PostProcess
    */
    silhouette: null
};

_XbsjObject3.default.registerType(PostProcess, 'PostProcess');

exports.default = PostProcess;

/***/ }),
/* 134 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = !__webpack_require__(23) && !__webpack_require__(39)(function () {
  return Object.defineProperty(__webpack_require__(95)('div'), 'a', { get: function () { return 7; } }).a != 7;
});


/***/ }),
/* 135 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(34);


/***/ }),
/* 136 */
/***/ (function(module, exports, __webpack_require__) {

var dP = __webpack_require__(27);
var anObject = __webpack_require__(30);
var getKeys = __webpack_require__(48);

module.exports = __webpack_require__(23) ? Object.defineProperties : function defineProperties(O, Properties) {
  anObject(O);
  var keys = getKeys(Properties);
  var length = keys.length;
  var i = 0;
  var P;
  while (length > i) dP.f(O, P = keys[i++], Properties[P]);
  return O;
};


/***/ }),
/* 137 */
/***/ (function(module, exports, __webpack_require__) {

var has = __webpack_require__(40);
var toIObject = __webpack_require__(35);
var arrayIndexOf = __webpack_require__(205)(false);
var IE_PROTO = __webpack_require__(98)('IE_PROTO');

module.exports = function (object, names) {
  var O = toIObject(object);
  var i = 0;
  var result = [];
  var key;
  for (key in O) if (key != IE_PROTO) has(O, key) && result.push(key);
  // Don't enum bug & hidden keys
  while (names.length > i) if (has(O, key = names[i++])) {
    ~arrayIndexOf(result, key) || result.push(key);
  }
  return result;
};


/***/ }),
/* 138 */
/***/ (function(module, exports, __webpack_require__) {

var document = __webpack_require__(17).document;
module.exports = document && document.documentElement;


/***/ }),
/* 139 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.9 / 15.2.3.2 Object.getPrototypeOf(O)
var has = __webpack_require__(40);
var toObject = __webpack_require__(41);
var IE_PROTO = __webpack_require__(98)('IE_PROTO');
var ObjectProto = Object.prototype;

module.exports = Object.getPrototypeOf || function (O) {
  O = toObject(O);
  if (has(O, IE_PROTO)) return O[IE_PROTO];
  if (typeof O.constructor == 'function' && O instanceof O.constructor) {
    return O.constructor.prototype;
  } return O instanceof Object ? ObjectProto : null;
};


/***/ }),
/* 140 */
/***/ (function(module, exports, __webpack_require__) {

// call something on iterator step with safe closing on error
var anObject = __webpack_require__(30);
module.exports = function (iterator, fn, value, entries) {
  try {
    return entries ? fn(anObject(value)[0], value[1]) : fn(value);
  // 7.4.6 IteratorClose(iterator, completion)
  } catch (e) {
    var ret = iterator['return'];
    if (ret !== undefined) anObject(ret.call(iterator));
    throw e;
  }
};


/***/ }),
/* 141 */
/***/ (function(module, exports, __webpack_require__) {

// check on default Array iterator
var Iterators = __webpack_require__(47);
var ITERATOR = __webpack_require__(18)('iterator');
var ArrayProto = Array.prototype;

module.exports = function (it) {
  return it !== undefined && (Iterators.Array === it || ArrayProto[ITERATOR] === it);
};


/***/ }),
/* 142 */
/***/ (function(module, exports, __webpack_require__) {

var ITERATOR = __webpack_require__(18)('iterator');
var SAFE_CLOSING = false;

try {
  var riter = [7][ITERATOR]();
  riter['return'] = function () { SAFE_CLOSING = true; };
  // eslint-disable-next-line no-throw-literal
  Array.from(riter, function () { throw 2; });
} catch (e) { /* empty */ }

module.exports = function (exec, skipClosing) {
  if (!skipClosing && !SAFE_CLOSING) return false;
  var safe = false;
  try {
    var arr = [7];
    var iter = arr[ITERATOR]();
    iter.next = function () { return { done: safe = true }; };
    arr[ITERATOR] = function () { return iter; };
    exec(arr);
  } catch (e) { /* empty */ }
  return safe;
};


/***/ }),
/* 143 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(214), __esModule: true };

/***/ }),
/* 144 */
/***/ (function(module, exports) {

module.exports = function (done, value) {
  return { value: value, done: !!done };
};


/***/ }),
/* 145 */
/***/ (function(module, exports, __webpack_require__) {

// 7.2.2 IsArray(argument)
var cof = __webpack_require__(59);
module.exports = Array.isArray || function isArray(arg) {
  return cof(arg) == 'Array';
};


/***/ }),
/* 146 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.7 / 15.2.3.4 Object.getOwnPropertyNames(O)
var $keys = __webpack_require__(137);
var hiddenKeys = __webpack_require__(100).concat('length', 'prototype');

exports.f = Object.getOwnPropertyNames || function getOwnPropertyNames(O) {
  return $keys(O, hiddenKeys);
};


/***/ }),
/* 147 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.registerRotation = exports.registerPosition = exports.registerArrayProperty = exports.registerProperty = undefined;

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _mobx = __webpack_require__(2);

var _interceptArray = __webpack_require__(245);

var _interceptArray2 = _interopRequireDefault(_interceptArray);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 子对象都需要用registerProperty种族测，同时如果是原生对象，需要传递第三个参数，即默认值。
function registerProperty(sobject, propertyName, defaultOptions) {
    return (0, _mobx.intercept)(sobject, propertyName, function (changed) {
        if (changed.type === 'update') {
            // if (changed.newValue && changed.object.value !== changed.newValue) {
            if (typeof changed.newValue !== 'undefined' && changed.object.value !== changed.newValue) {
                var jsonObject = changed.newValue && changed.newValue.toJSON && changed.newValue.toJSON() || changed.newValue;
                if (sobject[propertyName].xbsjFromJSON) {
                    sobject[propertyName].xbsjFromJSON(jsonObject);
                } else {
                    var newJsonObject = (0, _assign2.default)({}, defaultOptions, jsonObject);
                    var sop = sobject[propertyName];
                    (0, _keys2.default)(newJsonObject).forEach(function (key) {
                        // sop[key]会导致值为undefined的属性无法赋值！
                        // sop[key] && (sop[key] = newJsonObject[key]);
                        key in sop && (sop[key] = newJsonObject[key]);
                    });
                }
            }
        }

        return null;
    });
}

function _registerArrayProperty(sobject, propertyName) {
    var disposers = [];
    disposers.push((0, _mobx.intercept)(sobject, propertyName, function (changed) {
        if (changed.type === 'update') {
            if (changed.newValue && Array.isArray(changed.newValue)) {
                if (changed.object.value !== changed.newValue) {
                    var _sobject$propertyName;

                    (_sobject$propertyName = sobject[propertyName]).splice.apply(_sobject$propertyName, [0, sobject[propertyName].length].concat((0, _toConsumableArray3.default)(changed.newValue)));
                }
            }
        }
        return null;
    }));

    disposers.push((0, _mobx.intercept)(sobject[propertyName], function (changed) {
        if (changed.type === 'splice') {
            // 元素个数必须始终为3！
            if (changed.removedCount !== changed.added.length) {
                console.warn('❌ 数组赋值有误！');
                return null;
            }
        }

        return changed;
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

function registerPosition(sobject) {
    var propertyName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'position';

    return _registerArrayProperty(sobject, propertyName);
}

function registerRotation(sobject) {
    var propertyName = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'rotation';

    return _registerArrayProperty(sobject, propertyName);
}

function registerArrayProperty(sobject, propertyName, createFunc, destoryFunc) {
    var disposers = [];
    disposers.push((0, _mobx.intercept)(sobject, propertyName, function (changed) {
        if (changed.type === 'update') {
            if (changed.newValue && Array.isArray(changed.newValue)) {
                if (changed.object.value !== changed.newValue) {
                    var _sobject$propertyName2;

                    (_sobject$propertyName2 = sobject[propertyName]).splice.apply(_sobject$propertyName2, [0, sobject[propertyName].length].concat((0, _toConsumableArray3.default)(changed.newValue)));
                }
            }
        }
        return null;
    }));

    disposers.push((0, _interceptArray2.default)(sobject[propertyName], function (elementJson) {
        // elementJson = elementJson && elementJson.toJSON && elementJson.toJSON() || elementJson;
        var element = createFunc(elementJson);
        // xbsjFromJSON赋值position会一个一个赋值，导致fromPosition时有数值为undefined。所以加一个runInAction避免频繁响应。
        // element.xbsjFromJSON(elementJson);
        return element;
    }, function (element) {
        destoryFunc(element);
    }));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.registerProperty = registerProperty;
exports.registerArrayProperty = registerArrayProperty;
exports.registerPosition = registerPosition;
exports.registerRotation = registerRotation;

/***/ }),
/* 148 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _registerInteractionProperty = __webpack_require__(15);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    /**
     * 位置数组 [经度、纬度、高度]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.ClippingPlane
     */
    position: [0, 0, 0],
    /**
     * 姿态数组 [偏航角、俯仰角、翻转角]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.ClippingPlane
     */
    rotation: [0, 0, 0],
    /**
     * 是否显示辅助线框
     * @type {boolean}
     * @instance
     * @default false
     * @memberof Obj.ClippingPlane
     */
    showHelper: false,
    /**
     * 是否在三维窗口中显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.ClippingPlane
     */
    show: true
};

/**
 * 剖切面类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var ClippingPlane = function (_XbsjCzmObj) {
    (0, _inherits3.default)(ClippingPlane, _XbsjCzmObj);

    function ClippingPlane(earth, guid) {
        (0, _classCallCheck3.default)(this, ClippingPlane);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ClippingPlane.__proto__ || (0, _getPrototypeOf2.default)(ClippingPlane)).call(this, earth, guid));

        _this._primitive = _this._earth.czm.scene.primitives.add(new Cesium.XbsjClippingPlane());
        _this.disposers.push(function () {
            _this._primitive && _this._earth.czm.scene.primitives.remove(_this._primitive);
            _this._primitive = undefined;
        });

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._primitive.show = _this.enabled && _this.show;
            _this._primitive.longitude = _this.position[0];
            _this._primitive.latitude = _this.position[1];
            _this._primitive.height = _this.position[2];
            _this._primitive.heading = _this.rotation[0];
            _this._primitive.pitch = _this.rotation[1];
            _this._primitive.roll = _this.rotation[2];
        }));

        // 检测位置编辑状态 // positionEditing
        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this));
        _this.disposers.push((0, _registerInteractionProperty.registerRotationEditing)(_this._earth, _this));
        // this.disposers.push(registerPositionPicking(this._earth, this));
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating'
        }));
        return _this;
    }

    (0, _createClass3.default)(ClippingPlane, [{
        key: 'flyTo',
        value: function flyTo() {
            var _Cesium$Cartesian;

            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(new Cesium.BoundingSphere((_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(this.position)), 100.0));
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return ClippingPlane;
}(_XbsjCzmObj3.default);

ClippingPlane.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(ClippingPlane, 'ClippingPlane');

exports.default = ClippingPlane;

/***/ }),
/* 149 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _FlattenedPolygon = __webpack_require__(249);

var _FlattenedPolygon2 = _interopRequireDefault(_FlattenedPolygon);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 压平多边形集合类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var FlattenedPolygonCollection = function (_XbsjCzmObj) {
    (0, _inherits3.default)(FlattenedPolygonCollection, _XbsjCzmObj);

    function FlattenedPolygonCollection(earth, guid) {
        (0, _classCallCheck3.default)(this, FlattenedPolygonCollection);

        var _this = (0, _possibleConstructorReturn3.default)(this, (FlattenedPolygonCollection.__proto__ || (0, _getPrototypeOf2.default)(FlattenedPolygonCollection)).call(this, earth, guid));

        _this._boundingSphere = undefined;

        (0, _mobx.extendObservable)(_this, {
            _flattenedPolygonTexture: undefined, // TODO(vtxf): 貌似不需要监测
            get boundingSphere() {
                var boundingSpheres = this.polygons.map(function (p) {
                    return p.boundingSphere;
                }).filter(function (b) {
                    return typeof b !== 'undefined';
                });
                this._boundingSphere = Cesium.BoundingSphere.fromBoundingSpheres(boundingSpheres, this._boundingSphere);
                return this._boundingSphere;
            }
        }, {
            _flattenedPolygonTexture: _mobx.observable.ref,
            boundingSphere: _mobx.computed
        });

        _this._flattenedPolygonTexture = _this._earth.czm.viewer.xbsjFlattenning.createFlattenedPolygonTexture();
        var fps = _this._flattenedPolygonTexture.getFlattenedPolygons();

        _this._disposers = _this._disposers || [];

        // 防止polygons被整体替换！！
        _this._disposers.push((0, _mobx.intercept)(_this, 'polygons', function (changed) {
            if (changed.type === 'update') {
                if (changed.newValue && Array.isArray(changed.newValue)) {
                    if (changed.object.value !== changed.newValue) {
                        var _this$polygons;

                        (_this$polygons = _this.polygons).splice.apply(_this$polygons, [0, _this.polygons.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
                    }
                }
            }
            return null;
        }));

        // this._disposers.push(interceptArray(this.polygons,
        //     polygonJson => {
        //         // xbsjFromJSON赋值position会一个一个赋值，导致fromPosition时有数值为undefined。所以加一个runInAction避免频繁响应。
        //         const polygon = new FlattenedPolygon(this._earth);
        //         runInAction(() => { 
        //             polygon.xbsjFromJSON(polygonJson);
        //         });

        //         if (polygon._autorunDisposer) {
        //             throw new Error('polygon._autorunDisposer should not exists!');
        //         }
        //         polygon._autorunDisposer = reaction(() => {
        //             return {
        //                 polygonPositions: [...polygon.positions],
        //                 polygonHeight: polygon.height,
        //             };
        //         }, ({
        //             polygonPositions,
        //             polygonHeight,
        //         }) => {
        //                 if (typeof polygon._flattenedPolygon !== 'undefined') {
        //                     let i = fps.indexOf(polygon._flattenedPolygon);
        //                     fps.splice(i, 1);
        //                     polygon._flattenedPolygon = undefined;
        //                 }

        //                 if (polygonPositions.length >= 3 * 2) {
        //                     const positions = Cesium.Cartesian3.fromRadiansArray(polygonPositions);
        //                     polygon._flattenedPolygon = Cesium.xbsjCreateFlattenedPolygon(positions, polygonHeight);
        //                     fps.push(polygon._flattenedPolygon);
        //                 }

        //                 this._flattenedPolygonTexture.refreshFlattenedPolygons();
        //             }, {
        //                 fireImmediately: true,
        //             });

        //         return polygon;
        //     }, polygon => {
        //         if (typeof polygon._flattenedPolygon !== 'undefined') {
        //             let i = fps.indexOf(polygon._flattenedPolygon);
        //             if (i === -1) {
        //                 console.error('压平多边形出错！');
        //             }
        //             fps.splice(i, 1);
        //             polygon._flattenedPolygon = undefined;
        //         }
        //         polygon._autorunDisposer = polygon._autorunDisposer && polygon._autorunDisposer();
        //         polygon.destroy();
        //     }));

        var createPolygon = function createPolygon(elementJson) {
            // xbsjFromJSON赋值position会一个一个赋值，导致fromPosition时有数值为undefined。所以加一个runInAction避免频繁响应。
            var polygon = new _FlattenedPolygon2.default(_this._earth);

            // elementJson不是json对象，则需要先转成json对象。也就是说对象只会复制一份出来，不会直接使用原对象
            elementJson = elementJson && elementJson.toJSON && elementJson.toJSON() || elementJson;
            polygon.xbsjFromJSON(elementJson);

            if (polygon._autorunDisposer) {
                throw new Error('polygon._autorunDisposer should not exists!');
            }
            polygon._autorunDisposer = (0, _mobx.reaction)(function () {
                return {
                    polygonPositions: [].concat((0, _toConsumableArray3.default)(polygon.positions)),
                    polygonHeight: polygon.height
                };
            }, function (_ref) {
                var polygonPositions = _ref.polygonPositions,
                    polygonHeight = _ref.polygonHeight;

                if (typeof polygon._flattenedPolygon !== 'undefined') {
                    var i = fps.indexOf(polygon._flattenedPolygon);
                    fps.splice(i, 1);
                    polygon._flattenedPolygon = undefined;
                }

                if (polygonPositions.length >= 3 * 2) {
                    var positions = Cesium.Cartesian3.fromRadiansArray(polygonPositions);
                    polygon._flattenedPolygon = Cesium.xbsjCreateFlattenedPolygon(positions, polygonHeight);
                    fps.push(polygon._flattenedPolygon);
                }

                _this._flattenedPolygonTexture.refreshFlattenedPolygons();
            }, {
                fireImmediately: true
            });

            return polygon;
        };

        var destoryPolygon = function destoryPolygon(polygon) {
            if (typeof polygon._flattenedPolygon !== 'undefined') {
                var i = fps.indexOf(polygon._flattenedPolygon);
                if (i === -1) {
                    console.error('压平多边形出错！');
                }
                fps.splice(i, 1);
                polygon._flattenedPolygon = undefined;
            }
            polygon._autorunDisposer = polygon._autorunDisposer && polygon._autorunDisposer();
            polygon.destroy();
        };

        _this._disposers.push(_XbsjBase2.default.registerArrayProperty(_this, 'polygons', createPolygon, destoryPolygon));

        _this._disposers.push((0, _mobx.observe)(_this.polygons, function () {
            _this._flattenedPolygonTexture.refreshFlattenedPolygons();
        }));

        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._flattenedPolygonTexture.enabled = _this.enabled;
        }));
        return _this;
    }

    /**
     * 获取压平多边形纹理
     * @type {object}
     * @ignore
     */

    (0, _createClass3.default)(FlattenedPolygonCollection, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            if (this.boundingSphere.radius === 0 || Cesium.Cartesian3.magnitudeSquared(this.boundingSphere.center) < 0.0001) {
                // do nothing!
            } else {
                camera.flyToBoundingSphere(this.boundingSphere);
            }
        }
    }, {
        key: 'xbsjFromJSON',
        value: function xbsjFromJSON(jsonObject) {
            this.polygons.length = 0;
            (0, _get3.default)(FlattenedPolygonCollection.prototype.__proto__ || (0, _getPrototypeOf2.default)(FlattenedPolygonCollection.prototype), 'xbsjFromJSON', this).call(this, jsonObject);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers && this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            this._earth.czm.viewer.xbsjFlattenning.destroyFlattenedPolygonTexture(this._flattenedPolygonTexture);
            this._flattenedPolygonTexture = undefined;

            return (0, _get3.default)(FlattenedPolygonCollection.prototype.__proto__ || (0, _getPrototypeOf2.default)(FlattenedPolygonCollection.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'flattenedPolygonTexture',
        get: function get() {
            return this._flattenedPolygonTexture;
        }
    }]);
    return FlattenedPolygonCollection;
}(_XbsjCzmObj3.default);

FlattenedPolygonCollection.FlattenedPolygon = _FlattenedPolygon2.default;

FlattenedPolygonCollection.defaultOptions = {
    polygons: [],
    show: true,
    flattenDiscard: false
};

var xbsjSchema = {
    title: "FlattenedPolygonCollection Property",
    type: "object",
    properties: {
        /**
         * 多边形集合
         * @type {Obj.FlattenedPolygonCollection.FlattenedPolygon[]}
         * @instance
         * @default []
         * @memberof Obj.FlattenedPolygonCollection
         */
        polygons: { type: 'array', items: { type: 'Obj.FlattenedPolygonCollection.FlattenedPolygon' }, default: [], description: '多边形集合' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.FlattenedPolygonCollection
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 是否挖坑
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.FlattenedPolygonCollection
         */
        flattenDiscard: { type: 'boolean', title: '是否挖坑', default: false, description: '是否挖坑' }
    }
};

FlattenedPolygonCollection.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['polygons', 'show', 'flattenDiscard']
}];

FlattenedPolygonCollection.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(FlattenedPolygonCollection, 'FlattenedPolygonCollection');

exports.default = FlattenedPolygonCollection;

/***/ }),
/* 150 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// polygonPositions的特点是数组中每两个元素分别代表经度和纬度 [经度, 纬度, 经度, 纬度, 经度, 纬度, 经度, 纬度, ...]
function uniquePolygonPositions(positions) {
    if (positions.length == 0) {
        return [];
    }

    var newPositions = [positions[0], positions[1]];
    var l = positions.length / 2 | 0;
    for (var i = 1; i < l; ++i) {
        var nl = newPositions.length;
        if (newPositions[nl - 2] !== positions[i * 2 + 0] || newPositions[nl - 1] !== positions[i * 2 + 1]) {
            newPositions.push(positions[i * 2 + 0], positions[i * 2 + 1]);
        }
    }

    return newPositions;
}

exports.default = uniquePolygonPositions;

/***/ }),
/* 151 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 额外代码


// http://lab2.cesiumlab.com/api/earthsdk/record?auth=1&v1=2&d1=2019-7-31+09%3A45%3A15&v2=3&d2=2019-7-31+09%3A45%3A15
// http://lab2.cesiumlab.com/api/earthsdk/record?auth=1&v1=2&d1=2019-7-31%2009%3A45%3A15&v2=3&d2=2019-7-31%2009%3A45%3A15

setTimeout(function () {
    var cc = typeof Cesium !== 'undefined' && Cesium.xbsj && Cesium.xbsj.copyright && Cesium.xbsj.copyright;

    var u = 'http://lab2.cesiumlab.com/api/earthsdk/record?';
    var d = {
        v: '190731', // 版本号，第一个版本
        v1: "1.3.3", // XbsjEarth版本号
        d1: "2020-3-31 16:39:53", // XbsjEarth编译日期
        v2: cc && cc.VERSION || '', // XbsjCesium版本号
        d2: cc && cc.date || '', // XbsjCesium编译日期
        auth: "-", // 授权用户名称
        page: window.location.href, // 用户访问网址
        RESTRICT: "-", // 限制网址，可能是多个，用/隔开，比如 www.xxx.com/www.yyy.com
        CZMVERSION: typeof Cesium !== 'undefined' ? Cesium.VERSION : '', // Cesium版本号
        earthDir: _HTML2.default.xbsjEarthDir, // XbsjEarth.js服务路径
        czmDir: _HTML2.default.cesiumDir // Cesium.js服务路径
    };

    var dd = encodeURIComponent((0, _stringify2.default)(d));
    var r = u + 'd=' + dd;
    // console.log(r);
    fetch(r).then(function () {}).catch(function () {});
    // }, 20000);
}, (Math.random() * 10 + 5) * 60 * 1000);

var ClippingPlanes = function (_XbsjBase) {
    (0, _inherits3.default)(ClippingPlanes, _XbsjBase);

    function ClippingPlanes() {
        (0, _classCallCheck3.default)(this, ClippingPlanes);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ClippingPlanes.__proto__ || (0, _getPrototypeOf2.default)(ClippingPlanes)).call(this));

        _this._disposers = [];

        _this._disposers.push((0, _mobx.intercept)(_this, function (changed) {
            // 不允许增加任何属性
            if (changed.type === 'add') {
                if (!changed.name.startsWith('_')) {
                    return undefined;
                }
            }

            return changed;
        }));
        return _this;
    }

    (0, _createClass3.default)(ClippingPlanes, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            return (0, _get3.default)(ClippingPlanes.prototype.__proto__ || (0, _getPrototypeOf2.default)(ClippingPlanes.prototype), 'destroy', this).call(this);
        }
    }]);
    return ClippingPlanes;
}(_XbsjBase3.default);

ClippingPlanes.defaultOptions = {
    planes: [],
    edgeWidth: 1.0,
    edgeColor: [1, 1, 1, 1],
    // unionClippingRegions: false,
    unionClippingRegions: true // Cesium的默认值是false
};

var xbsjSchema = {
    title: "Tileset ClippingPlanes Property",
    type: "object",
    properties: {
        planes: { type: 'array', items: { type: 'string' }, minItems: 0, default: [], description: "裁剪面的guid集合" },
        edgeColor: { type: 'array', items: { type: 'number', minimum: 0, maximum: 1 }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: "The color applied to highlight the edge along which an object is clipped." },
        edgeWidth: { type: 'number', title: "edgeWidth", default: 1.0, description: "The width, in pixels, of the highlight applied to the edge along which an object is clipped." },
        unionClippingRegions: { type: 'boolean', title: "unionClippingRegions", default: false, description: "If true, a region will be clipped if it is on the outside of any plane in the collection. Otherwise, a region will only be clipped if it is on the outside of every plane." }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['planes', 'edgeWidth', 'edgeColor', 'unionClippingRegions']
}];

ClippingPlanes.xbsjSchema = xbsjSchema;
ClippingPlanes.xbsjClassification = xbsjClassification;

exports.default = ClippingPlanes;

/***/ }),
/* 152 */
/***/ (function(module, exports, __webpack_require__) {

// 7.3.20 SpeciesConstructor(O, defaultConstructor)
var anObject = __webpack_require__(30);
var aFunction = __webpack_require__(57);
var SPECIES = __webpack_require__(18)('species');
module.exports = function (O, D) {
  var C = anObject(O).constructor;
  var S;
  return C === undefined || (S = anObject(C)[SPECIES]) == undefined ? D : aFunction(S);
};


/***/ }),
/* 153 */
/***/ (function(module, exports, __webpack_require__) {

var ctx = __webpack_require__(32);
var invoke = __webpack_require__(253);
var html = __webpack_require__(138);
var cel = __webpack_require__(95);
var global = __webpack_require__(17);
var process = global.process;
var setTask = global.setImmediate;
var clearTask = global.clearImmediate;
var MessageChannel = global.MessageChannel;
var Dispatch = global.Dispatch;
var counter = 0;
var queue = {};
var ONREADYSTATECHANGE = 'onreadystatechange';
var defer, channel, port;
var run = function () {
  var id = +this;
  // eslint-disable-next-line no-prototype-builtins
  if (queue.hasOwnProperty(id)) {
    var fn = queue[id];
    delete queue[id];
    fn();
  }
};
var listener = function (event) {
  run.call(event.data);
};
// Node.js 0.9+ & IE10+ has setImmediate, otherwise:
if (!setTask || !clearTask) {
  setTask = function setImmediate(fn) {
    var args = [];
    var i = 1;
    while (arguments.length > i) args.push(arguments[i++]);
    queue[++counter] = function () {
      // eslint-disable-next-line no-new-func
      invoke(typeof fn == 'function' ? fn : Function(fn), args);
    };
    defer(counter);
    return counter;
  };
  clearTask = function clearImmediate(id) {
    delete queue[id];
  };
  // Node.js 0.8-
  if (__webpack_require__(59)(process) == 'process') {
    defer = function (id) {
      process.nextTick(ctx(run, id, 1));
    };
  // Sphere (JS game engine) Dispatch API
  } else if (Dispatch && Dispatch.now) {
    defer = function (id) {
      Dispatch.now(ctx(run, id, 1));
    };
  // Browsers with MessageChannel, includes WebWorkers
  } else if (MessageChannel) {
    channel = new MessageChannel();
    port = channel.port2;
    channel.port1.onmessage = listener;
    defer = ctx(port.postMessage, port, 1);
  // Browsers with postMessage, skip WebWorkers
  // IE8 has postMessage, but it's sync & typeof its postMessage is 'object'
  } else if (global.addEventListener && typeof postMessage == 'function' && !global.importScripts) {
    defer = function (id) {
      global.postMessage(id + '', '*');
    };
    global.addEventListener('message', listener, false);
  // IE8-
  } else if (ONREADYSTATECHANGE in cel('script')) {
    defer = function (id) {
      html.appendChild(cel('script'))[ONREADYSTATECHANGE] = function () {
        html.removeChild(this);
        run.call(id);
      };
    };
  // Rest old browsers
  } else {
    defer = function (id) {
      setTimeout(ctx(run, id, 1), 0);
    };
  }
}
module.exports = {
  set: setTask,
  clear: clearTask
};


/***/ }),
/* 154 */
/***/ (function(module, exports) {

module.exports = function (exec) {
  try {
    return { e: false, v: exec() };
  } catch (e) {
    return { e: true, v: e };
  }
};


/***/ }),
/* 155 */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(30);
var isObject = __webpack_require__(25);
var newPromiseCapability = __webpack_require__(110);

module.exports = function (C, x) {
  anObject(C);
  if (isObject(x) && x.constructor === C) return x;
  var promiseCapability = newPromiseCapability.f(C);
  var resolve = promiseCapability.resolve;
  resolve(x);
  return promiseCapability.promise;
};


/***/ }),
/* 156 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var global = __webpack_require__(17);
var core = __webpack_require__(14);
var dP = __webpack_require__(27);
var DESCRIPTORS = __webpack_require__(23);
var SPECIES = __webpack_require__(18)('species');

module.exports = function (KEY) {
  var C = typeof core[KEY] == 'function' ? core[KEY] : global[KEY];
  if (DESCRIPTORS && C && !C[SPECIES]) dP.f(C, SPECIES, {
    configurable: true,
    get: function () { return this; }
  });
};


/***/ }),
/* 157 */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(25);
module.exports = function (it, TYPE) {
  if (!isObject(it) || it._t !== TYPE) throw TypeError('Incompatible receiver, ' + TYPE + ' required!');
  return it;
};


/***/ }),
/* 158 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _ArcGisMapServerImageryProvider = __webpack_require__(292);

var _ArcGisMapServerImageryProvider2 = _interopRequireDefault(_ArcGisMapServerImageryProvider);

var _UrlTemplateImageryProvider = __webpack_require__(293);

var _UrlTemplateImageryProvider2 = _interopRequireDefault(_UrlTemplateImageryProvider);

var _WebMapTileServiceImageryProvider = __webpack_require__(294);

var _WebMapTileServiceImageryProvider2 = _interopRequireDefault(_WebMapTileServiceImageryProvider);

var _XbsjImageryProvider = __webpack_require__(295);

var _XbsjImageryProvider2 = _interopRequireDefault(_XbsjImageryProvider);

var _createTileMapServiceImageryProvider = __webpack_require__(296);

var _createTileMapServiceImageryProvider2 = _interopRequireDefault(_createTileMapServiceImageryProvider);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// TODO(vtxf): 有待补充其他影像类型
/**
 * @namespace
 * @memberof Obj.Imagery
 */
var ImageryProvider = {
    // ArcGisMapServerImageryProvider,
    UrlTemplateImageryProvider: _UrlTemplateImageryProvider2.default,
    XbsjImageryProvider: _XbsjImageryProvider2.default,
    WebMapTileServiceImageryProvider: _WebMapTileServiceImageryProvider2.default,
    createTileMapServiceImageryProvider: _createTileMapServiceImageryProvider2.default
};

exports.default = ImageryProvider;

/***/ }),
/* 159 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _geoMove = __webpack_require__(301);

var _geoMove2 = _interopRequireDefault(_geoMove);

var _geoDistance = __webpack_require__(65);

var _geoDistance2 = _interopRequireDefault(_geoDistance);

var _geoLerp = __webpack_require__(302);

var _geoLerp2 = _interopRequireDefault(_geoLerp);

var _hpr = __webpack_require__(303);

var _hpr2 = _interopRequireDefault(_hpr);

var _distance = __webpack_require__(304);

var _distance2 = _interopRequireDefault(_distance);

__webpack_require__(305);

__webpack_require__(306);

var _Bezier = __webpack_require__(307);

var _Bezier2 = _interopRequireDefault(_Bezier);

var _getModelMatrix = __webpack_require__(160);

var _getModelMatrix2 = _interopRequireDefault(_getModelMatrix);

var _hasSamePosition = __webpack_require__(308);

var _hasSamePosition2 = _interopRequireDefault(_hasSamePosition);

var _ab2Ab = __webpack_require__(309);

var _ab2Ab2 = _interopRequireDefault(_ab2Ab);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Math = {
    geoMove: _geoMove2.default,
    geoDistance: _geoDistance2.default,
    geoLerp: _geoLerp2.default,
    hpr: _hpr2.default,
    distance: _distance2.default,
    Bezier: _Bezier2.default,
    getModelMatrix: _getModelMatrix2.default,
    hasSamePosition: _hasSamePosition2.default,
    ab2Ab: _ab2Ab2.default
};

exports.default = Math;

/***/ }),
/* 160 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchMatrix = void 0;
var scratchMatrix2 = void 0;
var scratchCartesian = void 0;
var scratchHpr = void 0;

function getModelMatrix(xbsjPosition, xbsjRotation, xbsjScale, result) {
    scratchMatrix = scratchMatrix || new Cesium.Matrix4();
    scratchMatrix2 = scratchMatrix2 || new Cesium.Matrix4();
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchHpr = scratchHpr || new Cesium.HeadingPitchRoll();

    if (!result) {
        result = new Cesium.Matrix4();
    }

    // Get the transform from local heading-pitch-roll at cartographic (0.0, 0.0) to Earth's fixed frame.
    var center = Cesium.Cartesian3.fromRadians(xbsjPosition[0], xbsjPosition[1], xbsjPosition[2], undefined, scratchCartesian);
    var hpr = scratchHpr;hpr.xbsjFromArray.apply(hpr, (0, _toConsumableArray3.default)(xbsjRotation));
    var rtm = Cesium.Transforms.headingPitchRollToFixedFrame(center, hpr, undefined, undefined, result);
    var scaleM = Cesium.Matrix4.fromScale(new (Function.prototype.bind.apply(Cesium.Cartesian3, [null].concat((0, _toConsumableArray3.default)(xbsjScale))))(), scratchMatrix2);
    result = Cesium.Matrix4.multiply(rtm, scaleM, result);

    return result;
}

exports.default = getModelMatrix;

/***/ }),
/* 161 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.interpolatePositions = exports.computDs = exports.interpolateRotation = exports.interpolatePosition = undefined;

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchCartesian = void 0;
var scratchCartesian2 = void 0;
var scratchCarto = void 0;

var xTable2 = [];
var yTable2 = [];

// 增加自动过滤的功能，避免xTable中有相同元素
function cesiumInterpolate(d, xTable2, yTable2, yStride, result) {
    if (xTable2.length > 2) {
        for (var start = xTable2.length - 1; start > 1; start--) {
            if (xTable2[start] <= xTable2[start - 1]) {
                xTable2.splice(start, 1);
                yTable2.splice(start * 3, yStride);
            }
        }
    }

    return Cesium.HermitePolynomialApproximation.interpolateOrderZero(d, xTable2, yTable2, yStride, result);
}

function interpolate(d, xTable, yTable, yStride, result) {
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchCarto = scratchCarto || new Cesium.Cartographic();

    d > xTable[xTable.length - 1] && (d = xTable[xTable.length - 1]);

    var n = xTable.findIndex(function (e) {
        return e >= d;
    });

    var lastIndex = n + 1 > xTable.length - 1 ? xTable.length - 1 : n + 1;
    var firstIndex = n - 2 < 0 ? 0 : n - 2;

    xTable2.length = 0;
    yTable2.length = 0;

    for (var ii = firstIndex; ii <= lastIndex; ++ii) {
        xTable2.push(xTable[ii]);
        yTable2.push(yTable[ii * 3], yTable[ii * 3 + 1], yTable[ii * 3 + 2]);
    }

    // result = Cesium.HermitePolynomialApproximation.interpolateOrderZero(d, xTable2, yTable2, yStride, result);
    result = cesiumInterpolate(d, xTable2, yTable2, yStride, result);
    return result;
}

var scratchResult = [];
var scratchXTable = [];
var scratchYTable = [];
function interpolatePositions(positions, splitNum) {
    var _Cesium$Cartesian, _result;

    var loop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var result = arguments[3];

    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchCartesian2 = scratchCartesian2 || new Cesium.Cartesian3();
    scratchCarto = scratchCarto || new Cesium.Cartographic();

    var l = positions.length;
    var tl = 0;
    var xTable = scratchXTable;
    var yTable = scratchYTable;
    xTable.length = 0;
    yTable.length = 0;
    var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(positions[0]).concat([undefined, scratchCartesian]));
    xTable.push(0);
    yTable.push(cartesian.x, cartesian.y, cartesian.z);
    for (var i = 0; i < l - 1; ++i) {
        var _Cesium$Cartesian2, _Cesium$Cartesian3;

        var _cartesian = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(positions[i]).concat([undefined, scratchCartesian]));
        var cartesian2 = (_Cesium$Cartesian3 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian3, (0, _toConsumableArray3.default)(positions[i + 1]).concat([undefined, scratchCartesian2]));
        var d = Cesium.Cartesian3.distance(_cartesian, cartesian2);
        if (d > 0.000001) {
            tl += d;
            xTable.push(tl);
            yTable.push(cartesian2.x, cartesian2.y, cartesian2.z);
        }
    }

    if (loop) {
        var _Cesium$Cartesian4, _Cesium$Cartesian5;

        var first = (_Cesium$Cartesian4 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian4, (0, _toConsumableArray3.default)(positions[0]).concat([undefined, scratchCartesian]));
        var last = (_Cesium$Cartesian5 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian5, (0, _toConsumableArray3.default)(positions[positions.length - 1]).concat([undefined, scratchCartesian2]));
        var _d = Cesium.Cartesian3.distance(last, first);

        if (_d > 0.000001) {
            // 首尾位置相同，就不当作是loop了。理论上将此时应该去除一个点，然后在做下面的事情，此处直接不做了。
            tl += _d;

            xTable.unshift(-_d);
            yTable.unshift(last.x, last.y, last.z);

            xTable.push(tl);
            yTable.push(first.x, first.y, first.z);

            xTable.push(tl + xTable[2]);
            yTable.push(yTable[2 * 3 + 0], yTable[2 * 3 + 1], yTable[2 * 3 + 2]);
        }
    }

    var avl = tl / splitNum;
    var newPositions = scratchResult;
    result = result || [];
    newPositions.length = 0;
    for (var _i = 0; _i <= splitNum; ++_i) {
        var _Cesium$Cartesian6;

        var _d2 = _i * avl;
        var position = interpolate(_d2, xTable, yTable, 3); // new []
        var _cartesian2 = (_Cesium$Cartesian6 = Cesium.Cartesian3).fromElements.apply(_Cesium$Cartesian6, (0, _toConsumableArray3.default)(position).concat([scratchCartesian]));
        var carto = Cesium.Cartographic.fromCartesian(_cartesian2, undefined, scratchCarto);
        position.splice(0, 3, carto.longitude, carto.latitude, carto.height);
        newPositions.push(position);
    }

    (_result = result).splice.apply(_result, [0, result.length].concat(newPositions));

    return result;
}

// ds表示每一段的累计步长
function interpolatePosition(d, ds, positions, result) {
    var _Cesium$Cartesian8;

    if (positions.length < 1) {
        return undefined;
    }

    if (ds.length !== positions.length) {
        return;
        // throw new Error('length必须一致！');
    }

    var n = ds.findIndex(function (e) {
        return e >= d;
    });
    n < 0 && (n = ds.length - 1);

    var lastIndex = n + 1 > positions.length - 1 ? positions.length - 1 : n + 1;
    var firstIndex = n - 2 < 0 ? 0 : n - 2;

    xTable2.length = 0;
    yTable2.length = 0;

    for (var ii = firstIndex; ii <= lastIndex; ++ii) {
        var _Cesium$Cartesian7;

        xTable2.push(ds[ii]);

        var _cartesian3 = (_Cesium$Cartesian7 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian7, (0, _toConsumableArray3.default)(positions[ii]).concat([undefined, scratchCartesian]));
        yTable2.push(_cartesian3.x, _cartesian3.y, _cartesian3.z);
    }

    var interpolateCartesian = Cesium.HermitePolynomialApproximation.interpolateOrderZero(d, xTable2, yTable2, 3);
    var cartesian = (_Cesium$Cartesian8 = Cesium.Cartesian3).fromElements.apply(_Cesium$Cartesian8, (0, _toConsumableArray3.default)(interpolateCartesian).concat([scratchCartesian]));
    var carto = Cesium.Cartographic.fromCartesian(cartesian, undefined, scratchCarto);

    result = result || [0, 0, 0];
    result.splice(0, 3, carto.longitude, carto.latitude, carto.height);

    return result;
}

var scratchHPR = void 0;
var scrathQ1 = void 0;
var scrathQ2 = void 0;
var scrathQ3 = void 0;
function interpolateRotation(d, ds, rotations, result) {
    var _scratchHPR, _scratchHPR2;

    if (rotations.length < 1) {
        return undefined;
    }

    result = result || [0, 0, 0];

    if (ds.length !== rotations.length) {
        return;
        // throw new Error('length必须一致！');
    }

    scratchHPR = scratchHPR || new Cesium.HeadingPitchRoll();
    scrathQ1 = scrathQ1 || new Cesium.Quaternion();
    scrathQ2 = scrathQ2 || new Cesium.Quaternion();
    scrathQ3 = scrathQ3 || new Cesium.Quaternion();

    var n = ds.findIndex(function (e) {
        return e >= d;
    });
    n < 0 && (n = ds.length - 1);

    if (n === 0) {
        var _result2;

        (_result2 = result).splice.apply(_result2, [0, 3].concat((0, _toConsumableArray3.default)(rotations[0])));
        return result;
    }

    var ratio = n === 0 ? 0 : (d - ds[n - 1]) / (ds[n] - ds[n - 1]);
    ratio > 1.0 && (ratio = 1.0);

    var q1 = Cesium.Quaternion.fromHeadingPitchRoll((_scratchHPR = scratchHPR).xbsjFromArray.apply(_scratchHPR, (0, _toConsumableArray3.default)(rotations[n - 1])), scrathQ1);
    var q2 = Cesium.Quaternion.fromHeadingPitchRoll((_scratchHPR2 = scratchHPR).xbsjFromArray.apply(_scratchHPR2, (0, _toConsumableArray3.default)(rotations[n])), scrathQ2);
    var q3 = Cesium.Quaternion.fastSlerp(q1, q2, ratio, scrathQ3);

    var hpr = Cesium.HeadingPitchRoll.fromQuaternion(q3, scratchHPR);
    if (hpr) {
        result.splice(0, 3, hpr.heading, hpr.pitch, hpr.roll);
        return result;
    }

    return undefined;
}

function computDs(positions, rotations) {
    var loop = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : false;
    var resultDs = arguments[3];
    var resultPositions = arguments[4];
    var resultRotations = arguments[5];

    var l = positions.length;

    var tl = 0;
    var ds = resultDs || [];
    ds.length = 0;

    if (l <= 0) {
        return ds;
    }

    ds.push(0);
    for (var i = 0; i < l - 1; ++i) {
        var _Cesium$Cartesian9, _Cesium$Cartesian10;

        var cartesian = (_Cesium$Cartesian9 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian9, (0, _toConsumableArray3.default)(positions[i]).concat([undefined, scratchCartesian]));
        var cartesian2 = (_Cesium$Cartesian10 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian10, (0, _toConsumableArray3.default)(positions[i + 1]).concat([undefined, scratchCartesian2]));
        var d = Cesium.Cartesian3.distance(cartesian, cartesian2);
        tl += d;
        ds.push(tl);
    }

    if (loop && l > 2) {
        var _Cesium$Cartesian11, _Cesium$Cartesian12;

        resultPositions.length = 0;

        resultPositions.push.apply(resultPositions, (0, _toConsumableArray3.default)(positions));

        resultRotations.length = 0;
        resultRotations.push([0, 0, 0]);
        resultRotations.push.apply(resultRotations, (0, _toConsumableArray3.default)(rotations));
        resultRotations.push([].concat((0, _toConsumableArray3.default)(rotations[0])));
        resultRotations.push([0, 0, 0]);

        var first = (_Cesium$Cartesian11 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian11, (0, _toConsumableArray3.default)(positions[0]).concat([undefined, scratchCartesian]));
        var last = (_Cesium$Cartesian12 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian12, (0, _toConsumableArray3.default)(positions[positions.length - 1]).concat([undefined, scratchCartesian2]));
        var _d3 = Cesium.Cartesian3.distance(last, first);
        tl += _d3;

        ds.unshift(-_d3);
        resultPositions.unshift([].concat((0, _toConsumableArray3.default)(positions[positions.length - 1])));

        ds.push(tl);
        resultPositions.push([].concat((0, _toConsumableArray3.default)(positions[0])));

        ds.push(tl + ds[2]);
        resultPositions.push([].concat((0, _toConsumableArray3.default)(resultPositions[2])));
    }

    return ds;
}

exports.interpolatePosition = interpolatePosition;
exports.interpolateRotation = interpolateRotation;
exports.computDs = computDs;
exports.interpolatePositions = interpolatePositions;
exports.default = interpolate;

/***/ }),
/* 162 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var xbsjEarthScriptUrl = void 0;
function createCameraModel(earth) {
    xbsjEarthScriptUrl = xbsjEarthScriptUrl || _HTML2.default.getScriptBaseUrl('XbsjEarth');
    var model = earth.czm.scene.primitives.add(Cesium.Model.fromGltf({
        url: xbsjEarthScriptUrl + 'models/camera1/camera1.gltf?k=path',
        allowPicking: false,
        // cacheKey: Cesium.createGuid(),
        forwardAxis: Cesium.Axis.X
    }));

    // model.opaquePass = Cesium.Pass.TRANSLUCENT;
    model.opaquePass = Cesium.Pass.OVERLAY;
    model.cull = false;
    model.shadows = Cesium.ShadowMode.DISABLED;
    model.luminanceAtZenith = 1.2;
    // model.xbsjForceDepthTestDisabled = true;
    // model.colorBlendMode = Cesium.ColorBlendMode.MIX;
    // model.xbsjForceDepthTestDisabled = true;
    // model.opaquePass = Cesium.Pass.OVERLAY;
    // model.modelMatrix = this._lastMat4;

    model.minimumPixelSize = 50;

    return model;
}

function initCameraHelpers(earth) {
    if (!earth._cameraModelsPool) {
        earth._cameraModelsPool = [];

        earth._createCameraModel = function () {
            if (earth._cameraModelsPool.length > 0) {
                return earth._cameraModelsPool.pop();
            } else {
                return createCameraModel(earth);
            }
        };

        earth._destroyCameraModel = function (cameraHelper) {
            earth._cameraModelsPool.push(cameraHelper);
        };

        earth.disposers.push(function () {
            earth._cameraModelsPool.forEach(function (e) {
                earth.czm.scene.primitives.remove(e);
            });
            earth._cameraModelsPool.length = 0;
        });
    }
}

/**
 * 内部使用，不对外
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 * @ignore
 */

var CameraHelper = function (_XbsjCzmObj) {
    (0, _inherits3.default)(CameraHelper, _XbsjCzmObj);

    function CameraHelper(earth, guid) {
        (0, _classCallCheck3.default)(this, CameraHelper);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraHelper.__proto__ || (0, _getPrototypeOf2.default)(CameraHelper)).call(this, earth, guid));

        initCameraHelpers(earth);

        _this.disposers.push(_XbsjBase2.default.registerPosition(_this));
        _this.disposers.push(_XbsjBase2.default.registerRotation(_this));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                rotation: [].concat((0, _toConsumableArray3.default)(_this.rotation))
            };
        }, function () {
            _this._updateCameraPostionAndRotation();
        }));

        _this._cameraModel = undefined;

        var updateShow = function updateShow() {
            var show = _this.show;
            if (show && !_this._cameraModel) {
                _this._cameraModel = earth._createCameraModel();
                _this._updateCameraPostionAndRotation();
                _this._cameraModel.show = true;
            } else if (!show && _this._cameraModel) {
                _this._cameraModel.show = false;
                earth._destroyCameraModel(_this._cameraModel);
                _this._cameraModel = undefined;
            }
        };

        _this.disposers.push((0, _mobx.autorun)(updateShow));

        _this.disposers.push(function () {
            _this.show = false;
            updateShow();
        });
        return _this;
    }

    (0, _createClass3.default)(CameraHelper, [{
        key: '_updateCameraPostionAndRotation',
        value: function _updateCameraPostionAndRotation() {
            if (this._cameraModel) {
                var _Cesium$Cartesian;

                var hpr = new (Function.prototype.bind.apply(Cesium.HeadingPitchRoll, [null].concat((0, _toConsumableArray3.default)(this.rotation))))();
                hpr.heading -= Cesium.Math.PI_OVER_TWO;
                var center = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(this.position).concat([undefined, new Cesium.Cartesian3()]));
                var hprToFF = Cesium.Transforms.headingPitchRollToFixedFrame;
                hprToFF(center, hpr, undefined, undefined, this._cameraModel.modelMatrix);
            }
        }
    }, {
        key: 'isCameraLike',
        get: function get() {
            return true;
        }
    }]);
    return CameraHelper;
}(_XbsjCzmObj3.default);

CameraHelper.defaultOptions = {
    position: [0, 0, 0],
    rotation: [0, 0, 0],
    show: false
};

_XbsjObject2.default.registerType(CameraHelper, 'CameraHelper');

exports.default = CameraHelper;

/***/ }),
/* 163 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _registers = __webpack_require__(147);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjMutex = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjMutex, _XbsjBase);

    function XbsjMutex() {
        (0, _classCallCheck3.default)(this, XbsjMutex);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjMutex.__proto__ || (0, _getPrototypeOf2.default)(XbsjMutex)).call(this));

        (0, _mobx.extendObservable)(_this, {
            mutexCollection: []
        });

        var currentBinding = undefined;
        var currentBindingProp = undefined;

        _this.disposers.push((0, _registers.registerArrayProperty)(_this, 'mutexCollection', function (mutexConfig) {
            // binding
            // property
            // isValidFunc
            // validFunc
            var e = mutexConfig;
            // const bind = observe(e.binding, e.property, changed => {
            var bind = (0, _mobx.intercept)(e.binding, e.property, function (changed) {
                if (e.isValidFunc(changed.newValue) && (!currentBinding || currentBinding !== e.binding || currentBinding[currentBindingProp] !== e.binding[e.property])) {
                    currentBinding = e.binding;
                    currentBindingProp = e.property;

                    _this.mutexCollection.forEach(function (e2) {
                        if (e2.binding !== currentBinding || e2.property !== currentBindingProp) {
                            e2.validFunc(e2.binding, e2.property);
                        }
                    });
                }

                return changed;
            });

            mutexConfig._binding = bind;

            return mutexConfig;
        }, function (mutexConfig) {
            mutexConfig._binding = mutexConfig._binding && mutexConfig._binding();
        }));
        return _this;
    }

    (0, _createClass3.default)(XbsjMutex, [{
        key: 'destroy',
        value: function destroy() {
            this.mutexCollection = [];
            return (0, _get3.default)(XbsjMutex.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjMutex.prototype), 'destroy', this).call(this);
        }
    }]);
    return XbsjMutex;
}(_XbsjBase3.default);

function setUndefined(o, p) {
    typeof o[p] !== 'undefined' && (o[p] = undefined);
}

function setFalse(o, p) {
    o[p] && (o[p] = false);
}

function isTrue(p) {
    return !!p;
}

function isDefined(p) {
    return typeof p !== 'undefined';
}

function isStringValid(p) {
    return !!p;
}

function setStringEmpty(o, p) {
    o[p] && (o[p] = '');
}

XbsjMutex.isDefined = isDefined;
XbsjMutex.setUndefined = setUndefined;

XbsjMutex.isTrue = isTrue;
XbsjMutex.setFalse = setFalse;

XbsjMutex.isStringValid = isStringValid;
XbsjMutex.setStringEmpty = setStringEmpty;

var createObj = function createObj(ma) {
    return {
        binding: ma[0],
        property: ma[1],
        isValidFunc: ma[2],
        validFunc: ma[3]
    };
};

XbsjMutex.createObj = createObj;

exports.default = XbsjMutex;

/***/ }),
/* 164 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _updateRealSceneScale = __webpack_require__(82);

var _updateRealSceneScale2 = _interopRequireDefault(_updateRealSceneScale);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function copyPosition(dest, src) {
    dest[0] = src[0];
    dest[1] = src[1];
    dest[2] = src[2];
}

var ER = 6378137.0;

function yellow(color) {
    color[0] = 1, color[1] = 1, color[2] = 0, color[3] = 1;
}

function red(color) {
    color[0] = 1, color[1] = 0, color[2] = 0, color[3] = 1;
}

function green(color) {
    color[0] = 0, color[1] = 1, color[2] = 0, color[3] = 1;
}

function blue(color) {
    color[0] = 0, color[1] = 0, color[2] = 1, color[3] = 1;
}

var Coordinates = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Coordinates, _XbsjCzmObj);

    function Coordinates(earth, guid) {
        (0, _classCallCheck3.default)(this, Coordinates);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Coordinates.__proto__ || (0, _getPrototypeOf2.default)(Coordinates)).call(this, earth, guid));

        (0, _mobx.extendObservable)(_this, {
            _realSceneScale: 1.0
        });

        _this._disposers = [];

        _this._disposers.push((0, _updateRealSceneScale2.default)(_this._earth, _this));

        // 属性修改
        // this._xAxis = new XbsjPolylineArrow(earth);
        // this._yAxis = new XbsjPolylineArrow(earth);
        // this._zAxis = new XbsjPolylineArrow(earth);
        _this._xAxis = new _Polyline2.default(earth);
        _this._yAxis = new _Polyline2.default(earth);
        _this._zAxis = new _Polyline2.default(earth);

        _this._xAxis.arcType = 'RHUMB';
        _this._yAxis.arcType = 'RHUMB';
        _this._zAxis.arcType = 'NONE';

        [_this._xAxis, _this._yAxis, _this._zAxis].forEach(function (axis) {
            axis.material = {
                type: 'XbsjPolylineArrowMaterial'
            };
            axis.width = 20;
        });

        _this._xAxis.show = false;
        _this._yAxis.show = false;
        _this._zAxis.show = false;
        _this._xAxis.material['XbsjPolylineArrowMaterial'].color = [1, 0, 0, 1.0];
        _this._yAxis.material['XbsjPolylineArrowMaterial'].color = [0, 1, 0, 1.0];
        _this._zAxis.material['XbsjPolylineArrowMaterial'].color = [0, 0, 1, 1.0];
        _this._xAxis.depthTest = false;
        _this._yAxis.depthTest = false;
        _this._zAxis.depthTest = false;
        _this._xAxis.forcePass = Cesium.Pass.OVERLAY;
        _this._yAxis.forcePass = Cesium.Pass.OVERLAY;
        _this._zAxis.forcePass = Cesium.Pass.OVERLAY;
        _this._xAxis.positions = [[0, 0, 0], [0, 0, 0]];
        _this._yAxis.positions = [[0, 0, 0], [0, 0, 0]];
        _this._zAxis.positions = [[0, 0, 0], [0, 0, 0]];

        _this._disposers.push((0, _mobx.autorun)(function () {
            var scale = _this.fixScreenSize > 0 ? _this._realSceneScale : _this.scale;
            var show = _this.show && typeof scale !== 'undefined' && scale > 0;
            _this._xAxis.show = show && _this.xShow;
            _this._yAxis.show = show && _this.yShow;
            _this._zAxis.show = show && _this.zShow;
            if (show) {
                copyPosition(_this._xAxis.positions[0], _this.position);
                copyPosition(_this._yAxis.positions[0], _this.position);
                copyPosition(_this._zAxis.positions[0], _this.position);
                copyPosition(_this._xAxis.positions[1], _this.position);
                copyPosition(_this._yAxis.positions[1], _this.position);
                copyPosition(_this._zAxis.positions[1], _this.position);
                _this._xAxis.positions[1][0] = _this.position[0] + scale / (ER * Math.cos(_this.position[1]));
                _this._yAxis.positions[1][1] = _this.position[1] + scale / ER;
                _this._zAxis.positions[1][2] = _this.position[2] + scale;

                _this.xAxisActive ? yellow(_this._xAxis.material['XbsjPolylineArrowMaterial'].color) : red(_this._xAxis.material['XbsjPolylineArrowMaterial'].color);
                _this.yAxisActive ? yellow(_this._yAxis.material['XbsjPolylineArrowMaterial'].color) : green(_this._yAxis.material['XbsjPolylineArrowMaterial'].color);
                _this.zAxisActive ? yellow(_this._zAxis.material['XbsjPolylineArrowMaterial'].color) : blue(_this._zAxis.material['XbsjPolylineArrowMaterial'].color);
            }
        }));
        return _this;
    }

    (0, _createClass3.default)(Coordinates, [{
        key: 'flyTo',
        value: function flyTo() {
            // do nothing
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this._primitive && this._earth.czm.scene.primitives.remove(this._primitive);
            this._xAxis = this._xAxis && this._xAxis.destroy();
            this._yAxis = this._yAxis && this._yAxis.destroy();
            this._zAxis = this._zAxis && this._zAxis.destroy();

            return (0, _get3.default)(Coordinates.prototype.__proto__ || (0, _getPrototypeOf2.default)(Coordinates.prototype), 'destroy', this).call(this);
        }
    }]);
    return Coordinates;
}(_XbsjCzmObj3.default);

Coordinates.defaultOptions = {
    position: [0, 0, 0],
    show: false,
    xShow: true,
    yShow: true,
    zShow: true,
    scale: 1.0,
    fixScreenSize: 0, // fixScreenSize如果大于0，则scale失效，会自动计算缩放以保证屏幕像素一致。单位像素
    xAxisActive: false,
    yAxisActive: false,
    zAxisActive: false
};

_XbsjObject2.default.registerType(Coordinates, 'Coordinates');

exports.default = Coordinates;

/***/ }),
/* 165 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = __webpack_require__(335);


/***/ }),
/* 166 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.standardBlocks = exports.standardBlockGeometricErrors = exports.defaultBlockSizePerGeometricError = exports.defaultBlockBestGeometricErrorConst = undefined;

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// function blockBestGeometricError(radius, cameraDistanceRatio = 6.0, fovy = Math.PI/4.0, screenHeightInPixels=1080) {
//     // 推导过程
//     // const cameraDistanceInMeters = cameraDistanceRatio * radius;
//     // const screenHeightInMeters = 2.0 * cameraDistanceInMeters * Math.tan(fovy*0.5);
//     // const targetSizeInMeters = 2.0 * radius;
//     // const targetSizeInPixels = screenHeightInPixels * targetSizeInMeters / screenHeightInMeters;
//     // const geometricError = targetSizeInMeters / targetSizeInPixels;
//     // return geometricError;

//     // const geometricError = (2.0 * radius) / (screenHeightInPixels * (2.0 * radius) / (2.0 * cameraDistanceInMeters * Math.tan(fovy*0.5)));
//     // const geometricError = 1.0 / (screenHeightInPixels / (2.0 * cameraDistanceInMeters * Math.tan(fovy*0.5)));
//     // const geometricError = (2.0 * cameraDistanceRatio * radius * Math.tan(fovy*0.5)) / screenHeightInPixels;
//     const geometricError = ((2.0 * cameraDistanceRatio * Math.tan(fovy*0.5)) / screenHeightInPixels) * radius;

//     return geometricError;
// }

// 获取GE常量，以后乘上半径，就是真正的GE了
function blockBestGeometricErrorConst() {
    var cameraDistanceRatio = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 6.0;
    var fovy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : Math.PI / 4.0;
    var screenHeightInPixels = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 1080;

    return 2.0 * cameraDistanceRatio * Math.tan(fovy * 0.5) / screenHeightInPixels;
}

// 无法根据ge去反推block，因为树有很多种，每种数的ge可能会有差别，没有办法把不同的树放到同样的block
var defaultBlockBestGeometricErrorConst = exports.defaultBlockBestGeometricErrorConst = blockBestGeometricErrorConst();
var defaultBlockSizePerGeometricError = exports.defaultBlockSizePerGeometricError = 1.0 / defaultBlockBestGeometricErrorConst;

// const minBlockSize = 1.0; // 相当于0级block大小，为1米
// const maxBlockLevel = 24; // 最大级别的block大小为2^24米，约等于16*1024*1024米，大约是地球半径的十倍

// 6378137 地球半径
// export const standardBlocks = [...new Array(maxBlockLevel).keys()].map(x => 1 << x);

// export const standardBlockGeometricErrors = standardBlocks.map(x => defaultBlockBestGeometricErrorConst * x);

// 0级的精度 地球周长/256
var circumference0 = 2 * Math.PI * 6378137;
var g0 = 0.1 * circumference0 / 256; // 0.1是后来乘的，让每个块可以有更多的精模。这样渲染时的块就会少很多。
// const g0 = (1.0 * circumference0) / 256;

var standardBlockGeometricErrors = exports.standardBlockGeometricErrors = [].concat((0, _toConsumableArray3.default)(new Array(31).keys())).map(function (x) {
    return g0 / (1 << x);
});
var standardBlocks = exports.standardBlocks = [].concat((0, _toConsumableArray3.default)(new Array(31).keys())).map(function (x) {
    return circumference0 / (1 << x);
});

// standardBlockGeometricErrors
// [156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564, 1222.99245256282, 611.49622628141, 305.748113140705, 152.8740565703525, 76.43702828517625, 38.21851414258813, 19.109257071294063, 9.554628535647032, 4.777314267823516, 2.388657133911758, 1.194328566955879, 0.5971642834779395, 0.29858214173896974, 0.14929107086948487, 0.07464553543474244, 0.03732276771737122, 0.01866138385868561, 0.009330691929342804, 0.004665345964671402, 0.002332672982335701, 0.0011663364911678506, 0.0005831682455839253, 0.00029158412279196264, 0.00014579206139598132]

// standardBlocks
// [40075016.68557849, 20037508.342789244, 10018754.171394622, 5009377.085697311, 2504688.5428486555, 1252344.2714243277, 626172.1357121639, 313086.06785608194, 156543.03392804097, 78271.51696402048, 39135.75848201024, 19567.87924100512, 9783.93962050256, 4891.96981025128, 2445.98490512564, 1222.99245256282, 611.49622628141, 305.748113140705, 152.8740565703525, 76.43702828517625, 38.21851414258813, 19.109257071294063, 9.554628535647032, 4.777314267823516, 2.388657133911758, 1.194328566955879, 0.5971642834779395, 0.29858214173896974, 0.14929107086948487, 0.07464553543474244, 0.03732276771737122]

/***/ }),
/* 167 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
function memcpy(target, source) {
    var targeOffset = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;
    var sourceOffset = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;
    var sourceByteLength = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : source.byteLength;

    var src = new Uint8Array(source.buffer || source, sourceOffset, sourceByteLength);
    var dest = new Uint8Array(target, targeOffset, sourceByteLength);
    for (var i = 0; i < sourceByteLength; ++i) {
        dest[i] = src[i];
    }
}

exports.default = memcpy;

/***/ }),
/* 168 */
/***/ (function(module, exports, __webpack_require__) {

var DESCRIPTORS = __webpack_require__(23);
var getKeys = __webpack_require__(48);
var toIObject = __webpack_require__(35);
var isEnum = __webpack_require__(62).f;
module.exports = function (isEntries) {
  return function (it) {
    var O = toIObject(it);
    var keys = getKeys(O);
    var length = keys.length;
    var i = 0;
    var result = [];
    var key;
    while (length > i) {
      key = keys[i++];
      if (!DESCRIPTORS || isEnum.call(O, key)) {
        result.push(isEntries ? [key, O[key]] : O[key]);
      }
    }
    return result;
  };
};


/***/ }),
/* 169 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
// @ts-ignore
const WebGLConsts = WebGLRenderingContext;
/* harmony export (immutable) */ __webpack_exports__["WebGLConsts"] = WebGLConsts;


/* harmony default export */ __webpack_exports__["default"] = (WebGLConsts);


/***/ }),
/* 170 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

var _geoDistance = __webpack_require__(65);

var _geoDistance2 = _interopRequireDefault(_geoDistance);

var _registerInteractionProperty = __webpack_require__(15);

var _tin = __webpack_require__(363);

var _tin2 = _interopRequireDefault(_tin);

var _helpers = __webpack_require__(171);

var _midpoint = __webpack_require__(364);

var _midpoint2 = _interopRequireDefault(_midpoint);

var _booleanPointInPolygon = __webpack_require__(372);

var _booleanPointInPolygon2 = _interopRequireDefault(_booleanPointInPolygon);

var _Geometry = __webpack_require__(114);

var _Geometry2 = _interopRequireDefault(_Geometry);

var _CustomPrimitive = __webpack_require__(83);

var _CustomPrimitive2 = _interopRequireDefault(_CustomPrimitive);

var _shader = __webpack_require__(373);

var _totalArea = __webpack_require__(374);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 填充面
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var Surface = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Surface, _XbsjCzmObj);

    function Surface(earth, guid) {
        (0, _classCallCheck3.default)(this, Surface);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Surface.__proto__ || (0, _getPrototypeOf2.default)(Surface)).call(this, earth, guid));

        _this.disposers.push((0, _registerInteractionProperty.registerPolylineCreating)(_this._earth, _this, {
            polylineCreatingProperty: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolylineEditing)(_this._earth, _this, {
            polylineEditingProperty: 'editing'
        }));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._createOutline();
        _this._createInnerPoints();
        _this._createTin();
        _this._createTexturePosRot();

        _this._totalArea = 0;
        return _this;
    }

    (0, _createClass3.default)(Surface, [{
        key: '_createOutline',
        value: function _createOutline() {
            var _this2 = this;

            this._polyline = new XE.Obj.Polyline(this._earth);
            this._polyline.loop = true;
            this._polyline.ground = false;
            this._polyline.material.XbsjColorMaterial.color = [0, 1, 0, 1];
            this._polyline.width = 3;
            this.disposers.push(function () {
                _this2._polyline = _this2._polyline && _this2._polyline.destroy();
            });
            this._polyline.show = this.showHelper && this.show;

            XE.Earth.Interaction.Picking.registerPickingParent(this._polyline, this);

            var updatePolyline = function updatePolyline() {
                _this2._polyline.show = _this2.showHelper && _this2.show;
            };

            updatePolyline();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    show: _this2.show,
                    showHelper: _this2.showHelper
                };
            }, updatePolyline));

            var recreatePolyline = function recreatePolyline() {
                _this2._polyline.positions = _this2.positions;
                updatePolyline();
            };

            recreatePolyline();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this2.positions))
                };
            }, recreatePolyline));
        }
    }, {
        key: '_createTexturePosRot',
        value: function _createTexturePosRot() {
            // // 检测位置编辑状态 // positionEditing
            // this.disposers.push(registerPositionEditing(this._earth, this, {
            //     positionEditingProperty: 'texturePositionEditing',
            //     positionProperty: 'texturePosition',
            // }));

            (0, _mobx.extendObservable)(this, {
                _texturePosition: [0, 0, 0]
            });

            this.disposers.push((0, _bind2.default)(this, '_texturePosition', this._cp, 'position'));

            // 旋转状态
            this.disposers.push((0, _registerInteractionProperty.registerRotationEditing)(this._earth, this, {
                rotationEditingProperty: 'textureRotationEditing',
                positionProperty: '_texturePosition',
                rotationProperty: 'textureRotation'
            }));
        }
    }, {
        key: '_createInnerPoints',
        value: function _createInnerPoints() {
            var _this3 = this;

            var earth = this.earth;
            XE.MVVM.extend(this, {
                _innerPolylineShow: true
            });

            this._innerPolyline = new XE.Obj.Polyline(earth);
            this._innerPolyline._pointsColor = [0, 1, 0, 0.95];
            this._innerPolyline.loop = true;
            this._innerPolyline.ground = false;
            this._innerPolyline.material.XbsjColorMaterial.color = [0, 1, 0, 1];
            this._innerPolyline.depthTest = false;
            this._innerPolyline.width = 0; // 隐藏线条
            this._innerPolyline.showHelper = true;

            // 隐藏编辑时的线条！
            (0, _mobx.extendObservable)(this._innerPolyline, {
                editingPolylineShow: false
            });

            this.disposers.push(function () {
                _this3._innerPolyline = _this3._innerPolyline && _this3._innerPolyline.destroy();
            });

            XE.Earth.Interaction.Picking.registerPickingParent(this._innerPolyline, this);

            var updatePolyline = function updatePolyline() {
                _this3._innerPolyline.show = _this3.showHelper && _this3.show;
            };

            updatePolyline();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    show: _this3.show,
                    showHelper: _this3.showHelper
                };
            }, updatePolyline));
        }
    }, {
        key: '_createTin',
        value: function _createTin() {
            var _this4 = this;

            this._cp = new _CustomPrimitive2.default(this._earth);
            this._cp.renderState.depthTest.enabled = true;
            this._cp.vertexShaderSource = _shader.vertexShader;
            this._cp.fragmentShaderSource = _shader.fragmentShader;
            this.disposers.push(function () {
                _this4._cp = _this4._cp && _this4._cp.destroy();
            });

            var updateTin = function updateTin() {
                _this4._cp.show = _this4.show;
            };

            updateTin();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    show: _this4.show
                };
            }, updateTin));

            var recreateTin = function recreateTin() {
                if (_this4.positions.length > 3) {
                    // const p = this.positions.map(e => [e[0]*180.0/Math.PI, e[1]*180.0/Math.PI]);
                    var p = _this4.positions.map(function (e) {
                        return [e[0], e[1]];
                    });
                    // const p2 = this.innerPositions.map(e => [e[0], e[1]]);
                    var p2 = _this4._innerPolyline.positions.map(function (e) {
                        return [e[0], e[1]];
                    });
                    var points = (0, _helpers.points)([].concat((0, _toConsumableArray3.default)(p), (0, _toConsumableArray3.default)(p2)));
                    for (var i = 0; i < _this4.positions.length; i++) {
                        points.features[i].properties.z = _this4.positions[i][2];
                    }
                    for (var _i = 0; _i < _this4._innerPolyline.positions.length; ++_i) {
                        points.features[_i + _this4.positions.length].properties.z = _this4._innerPolyline.positions[_i][2];
                    }

                    p.push(p[0]); // 首末端点必须相同，否则turfPolygon会报错！
                    var polygon = (0, _helpers.polygon)([p]);

                    var tin = (0, _tin2.default)(points, 'z');

                    var gps = tin.features.flatMap(function (e) {
                        var lb = e.geometry.coordinates[0];

                        {
                            var midPoint = (0, _midpoint2.default)((0, _helpers.point)(lb[0]), (0, _helpers.point)(lb[1]));
                            midPoint = (0, _midpoint2.default)(midPoint, (0, _helpers.point)(lb[2]));
                            var inPolygon = (0, _booleanPointInPolygon2.default)(midPoint, polygon);

                            if (!inPolygon) {
                                return [];
                            }
                        }

                        var h = [e.properties.a, e.properties.b, e.properties.c];
                        // const lbh = lb.map((e, i) => [e[0]*Math.PI/180.0, e[1]*Math.PI/180.0, h[i]]);
                        var lbh = lb.map(function (e, i) {
                            return [e[0], e[1], h[i]];
                        });
                        lbh.length = 3;
                        return lbh;
                    });

                    if (gps.length === 0) {
                        return;
                    }

                    var _Geometry$getLocalPos = _Geometry2.default.getLocalPositions(gps),
                        _Geometry$getLocalPos2 = (0, _slicedToArray3.default)(_Geometry$getLocalPos, 2),
                        localPositions = _Geometry$getLocalPos2[0],
                        origin = _Geometry$getLocalPos2[1];

                    _this4._totalArea = (0, _totalArea.totalArea)(localPositions);

                    var rotateM = new Cesium.Matrix4();
                    {
                        _this4._scratchM3 = _this4._scratchM3 || new Cesium.Matrix3();
                        _this4._scratchHPR = _this4._scratchHPR || new Cesium.HeadingPitchRoll();
                        var hpr = _this4._scratchHPR;
                        hpr.heading = _this4.textureRotation[0];
                        hpr.pitch = _this4.textureRotation[1];
                        hpr.roll = _this4.textureRotation[2];

                        var m3 = Cesium.Matrix3.fromHeadingPitchRoll(_this4._scratchHPR, _this4._scratchM3);
                        Cesium.Matrix3.inverse(m3, m3);
                        Cesium.Matrix4.fromRotationTranslation(m3, undefined, rotateM);
                    }

                    var sts = undefined;
                    {
                        _this4._scratchCartesian3 = _this4._scratchCartesian3 || new Cesium.Cartesian3();
                        if (_this4._cp.canvasWidth > 0 && _this4._cp.canvasHeight > 0) {
                            sts = new Array(localPositions.length / 3 * 2);
                            for (var _i2 = 0; _i2 < localPositions.length / 3; _i2++) {
                                // sts[i*2+0] = localPositions[i*3+0] / this._cp.canvasWidth;
                                // sts[i*2+1] = localPositions[i*3+1] / this._cp.canvasHeight;
                                var l0 = localPositions[_i2 * 3 + 0];
                                var l1 = localPositions[_i2 * 3 + 1];
                                var l2 = localPositions[_i2 * 3 + 2];

                                var c3 = Cesium.Cartesian3.fromElements(l0, l1, l2, _this4._scratchCartesian3);
                                c3 = Cesium.Matrix4.multiplyByPoint(rotateM, c3, c3);

                                // sts[i*2+0] = c3.x / this._cp.canvasWidth / (this.imageHeight * this._cp.canvasWidth / this._cp.canvasHeight);
                                // sts[i*2+1] = c3.y / this._cp.canvasHeight / this.imageHeight;
                                sts[_i2 * 2 + 0] = c3.x / _this4._cp.canvasWidth * _this4._cp.canvasHeight / _this4.imageHeight / _this4.imageWidthScale;
                                sts[_i2 * 2 + 1] = c3.y / _this4._cp.canvasHeight * _this4._cp.canvasHeight / _this4.imageHeight;
                            }
                        }
                    }

                    var normals = undefined;
                    {
                        if (!_this4._normalCs) {
                            _this4._normalCs = [new Cesium.Cartesian3(), new Cesium.Cartesian3(), new Cesium.Cartesian3()];
                        }

                        normals = new Array(localPositions.length);

                        if (localPositions.length % 9 !== 0) {
                            throw new Error('localPositions.length % 9 !== 0');
                        }

                        for (var _i3 = 0; _i3 < localPositions.length / 9; _i3++) {
                            for (var j = 0; j < 3; ++j) {
                                Cesium.Cartesian3.fromArray(localPositions, _i3 * 9 + j * 3, _this4._normalCs[j]);
                            }

                            Cesium.Cartesian3.subtract(_this4._normalCs[1], _this4._normalCs[0], _this4._normalCs[1]);
                            Cesium.Cartesian3.normalize(_this4._normalCs[1], _this4._normalCs[1]);
                            Cesium.Cartesian3.subtract(_this4._normalCs[2], _this4._normalCs[0], _this4._normalCs[2]);
                            Cesium.Cartesian3.normalize(_this4._normalCs[2], _this4._normalCs[2]);

                            var n = Cesium.Cartesian3.cross(_this4._normalCs[1], _this4._normalCs[2], _this4._normalCs[0]);

                            for (var _j = 0; _j < 3; ++_j) {
                                Cesium.Cartesian3.pack(n, normals, _i3 * 9 + _j * 3);
                            }
                        }
                    }

                    _this4._cp.positions = localPositions;
                    _this4._cp.position = origin;
                    _this4._cp.sts = sts;
                    _this4._cp.normals = normals;
                    _this4._cp.indices = [].concat((0, _toConsumableArray3.default)(new Array(localPositions.length / 3).keys()));
                }

                updateTin();
            };

            recreateTin();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this4.positions)),
                    // innerPositions: [...this.innerPositions],
                    innerPositions: [].concat((0, _toConsumableArray3.default)(_this4._innerPolyline.positions)),
                    canvasWidth: _this4._cp.canvasWidth,
                    canvasHeight: _this4._cp.canvasHeight,
                    imageUrl: _this4._cp.imageUrl,
                    textureRotation: [].concat((0, _toConsumableArray3.default)(_this4.textureRotation)),
                    imageHeight: _this4.imageHeight,
                    imageWidthScale: _this4.imageWidthScale
                };
            }, recreateTin));

            this.disposers.push((0, _bind2.default)(this, 'imageUrl', this._cp, 'imageUrl'));

            (0, _mobx.extendObservable)(this, {
                /**
                 * 内部控制点创建
                 * @type {boolean}
                 * @instance
                 * @default false
                 * @memberof Obj.Surface
                 */
                innerCreating: false,
                /**
                 * 内部控制点编辑
                 * @type {boolean}
                 * @instance
                 * @default false
                 * @memberof Obj.Surface
                 */
                innerEditing: false
            });

            this.disposers.push((0, _bind2.default)(this, 'innerCreating', this._innerPolyline, 'creating'));
            this.disposers.push((0, _bind2.default)(this, 'innerEditing', this._innerPolyline, 'editing'));

            this.disposers.push((0, _bind2.default)(this, 'innerPositions', this._innerPolyline, 'positions'));
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._polyline.flyTo();
        }

        /**
         * 获取总面积，单位平方米
         */

    }, {
        key: 'getTotalArea',
        value: function getTotalArea() {
            return this._totalArea;
        }
    }]);
    return Surface;
}(_XbsjCzmObj3.default);

Surface.defaultOptions = {
    /**
     * 位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default []
     * @memberof Obj.Surface
     */
    positions: [],
    /**
     * 内部位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Surface
     */
    innerPositions: [],
    /**
     * 显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Surface
     */
    show: true,
    /**
     * 显示辅助信息
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Surface
     */
    showHelper: true,
    /**
     * 图像路径
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.Surface
     */
    imageUrl: '',
    // texturePosition: [0, 0, 0],
    /**
     * 纹理旋转角度(欧拉角，[偏航角, 俯仰角, 翻滚角])
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Surface
     */
    textureRotation: [0, 0, 0],
    /**
     * 图像高度，单位米
     * @type {number}
     * @instance
     * @default 3.0
     * @memberof Obj.Surface
     */
    imageHeight: 3.0,
    /**
     * 图像宽度拉伸比例
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Surface
     */
    imageWidthScale: 1.0
};

_XbsjObject2.default.registerType(Surface, 'Surface');

exports.default = Surface;

// function createTexture(image, scene) {
//     const width = image.naturalWidth;
//     const height = image.naturalHeight;
//     const texture = new Cesium.Texture({
//         context: scene.context,
//         source: image,
//         width: width,
//         height: height,
//     });
//     if (Cesium.Math.isPowerOfTwo(width) && Cesium.Math.isPowerOfTwo(height)) {
//         const sampler = new Cesium.Sampler({
//             wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
//             wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
//             minificationFilter: Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,
//             magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
//         });
//         texture.sampler = sampler;
//         texture.generateMipmap(Cesium.MipmapHint.NICEST);
//     }
//     return texture;
// }

/***/ }),
/* 171 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
/**
 * @module helpers
 */
/**
 * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.
 *
 * @memberof helpers
 * @type {number}
 */
exports.earthRadius = 6371008.8;
/**
 * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.
 *
 * @memberof helpers
 * @type {Object}
 */
exports.factors = {
    centimeters: exports.earthRadius * 100,
    centimetres: exports.earthRadius * 100,
    degrees: exports.earthRadius / 111325,
    feet: exports.earthRadius * 3.28084,
    inches: exports.earthRadius * 39.370,
    kilometers: exports.earthRadius / 1000,
    kilometres: exports.earthRadius / 1000,
    meters: exports.earthRadius,
    metres: exports.earthRadius,
    miles: exports.earthRadius / 1609.344,
    millimeters: exports.earthRadius * 1000,
    millimetres: exports.earthRadius * 1000,
    nauticalmiles: exports.earthRadius / 1852,
    radians: 1,
    yards: exports.earthRadius / 1.0936,
};
/**
 * Units of measurement factors based on 1 meter.
 *
 * @memberof helpers
 * @type {Object}
 */
exports.unitsFactors = {
    centimeters: 100,
    centimetres: 100,
    degrees: 1 / 111325,
    feet: 3.28084,
    inches: 39.370,
    kilometers: 1 / 1000,
    kilometres: 1 / 1000,
    meters: 1,
    metres: 1,
    miles: 1 / 1609.344,
    millimeters: 1000,
    millimetres: 1000,
    nauticalmiles: 1 / 1852,
    radians: 1 / exports.earthRadius,
    yards: 1 / 1.0936,
};
/**
 * Area of measurement factors based on 1 square meter.
 *
 * @memberof helpers
 * @type {Object}
 */
exports.areaFactors = {
    acres: 0.000247105,
    centimeters: 10000,
    centimetres: 10000,
    feet: 10.763910417,
    inches: 1550.003100006,
    kilometers: 0.000001,
    kilometres: 0.000001,
    meters: 1,
    metres: 1,
    miles: 3.86e-7,
    millimeters: 1000000,
    millimetres: 1000000,
    yards: 1.195990046,
};
/**
 * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.
 *
 * @name feature
 * @param {Geometry} geometry input geometry
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature} a GeoJSON Feature
 * @example
 * var geometry = {
 *   "type": "Point",
 *   "coordinates": [110, 50]
 * };
 *
 * var feature = turf.feature(geometry);
 *
 * //=feature
 */
function feature(geom, properties, options) {
    if (options === void 0) { options = {}; }
    var feat = { type: "Feature" };
    if (options.id === 0 || options.id) {
        feat.id = options.id;
    }
    if (options.bbox) {
        feat.bbox = options.bbox;
    }
    feat.properties = properties || {};
    feat.geometry = geom;
    return feat;
}
exports.feature = feature;
/**
 * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.
 * For GeometryCollection type use `helpers.geometryCollection`
 *
 * @name geometry
 * @param {string} type Geometry Type
 * @param {Array<any>} coordinates Coordinates
 * @param {Object} [options={}] Optional Parameters
 * @returns {Geometry} a GeoJSON Geometry
 * @example
 * var type = "Point";
 * var coordinates = [110, 50];
 * var geometry = turf.geometry(type, coordinates);
 * // => geometry
 */
function geometry(type, coordinates, options) {
    if (options === void 0) { options = {}; }
    switch (type) {
        case "Point": return point(coordinates).geometry;
        case "LineString": return lineString(coordinates).geometry;
        case "Polygon": return polygon(coordinates).geometry;
        case "MultiPoint": return multiPoint(coordinates).geometry;
        case "MultiLineString": return multiLineString(coordinates).geometry;
        case "MultiPolygon": return multiPolygon(coordinates).geometry;
        default: throw new Error(type + " is invalid");
    }
}
exports.geometry = geometry;
/**
 * Creates a {@link Point} {@link Feature} from a Position.
 *
 * @name point
 * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Point>} a Point feature
 * @example
 * var point = turf.point([-75.343, 39.984]);
 *
 * //=point
 */
function point(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "Point",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.point = point;
/**
 * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.
 *
 * @name points
 * @param {Array<Array<number>>} coordinates an array of Points
 * @param {Object} [properties={}] Translate these properties to each Feature
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Point>} Point Feature
 * @example
 * var points = turf.points([
 *   [-75, 39],
 *   [-80, 45],
 *   [-78, 50]
 * ]);
 *
 * //=points
 */
function points(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return point(coords, properties);
    }), options);
}
exports.points = points;
/**
 * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.
 *
 * @name polygon
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Polygon>} Polygon Feature
 * @example
 * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });
 *
 * //=polygon
 */
function polygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {
        var ring = coordinates_1[_i];
        if (ring.length < 4) {
            throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
        }
        for (var j = 0; j < ring[ring.length - 1].length; j++) {
            // Check if first point of Polygon contains two numbers
            if (ring[ring.length - 1][j] !== ring[0][j]) {
                throw new Error("First and last Position are not equivalent.");
            }
        }
    }
    var geom = {
        type: "Polygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.polygon = polygon;
/**
 * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.
 *
 * @name polygons
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection
 * @example
 * var polygons = turf.polygons([
 *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],
 *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],
 * ]);
 *
 * //=polygons
 */
function polygons(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return polygon(coords, properties);
    }), options);
}
exports.polygons = polygons;
/**
 * Creates a {@link LineString} {@link Feature} from an Array of Positions.
 *
 * @name lineString
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<LineString>} LineString Feature
 * @example
 * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});
 * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});
 *
 * //=linestring1
 * //=linestring2
 */
function lineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    if (coordinates.length < 2) {
        throw new Error("coordinates must be an array of two or more positions");
    }
    var geom = {
        type: "LineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.lineString = lineString;
/**
 * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.
 *
 * @name lineStrings
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<LineString>} LineString FeatureCollection
 * @example
 * var linestrings = turf.lineStrings([
 *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],
 *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]
 * ]);
 *
 * //=linestrings
 */
function lineStrings(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return lineString(coords, properties);
    }), options);
}
exports.lineStrings = lineStrings;
/**
 * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.
 *
 * @name featureCollection
 * @param {Feature[]} features input features
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {FeatureCollection} FeatureCollection of Features
 * @example
 * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});
 * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});
 * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});
 *
 * var collection = turf.featureCollection([
 *   locationA,
 *   locationB,
 *   locationC
 * ]);
 *
 * //=collection
 */
function featureCollection(features, options) {
    if (options === void 0) { options = {}; }
    var fc = { type: "FeatureCollection" };
    if (options.id) {
        fc.id = options.id;
    }
    if (options.bbox) {
        fc.bbox = options.bbox;
    }
    fc.features = features;
    return fc;
}
exports.featureCollection = featureCollection;
/**
 * Creates a {@link Feature<MultiLineString>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiLineString
 * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiLineString>} a MultiLineString feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);
 *
 * //=multiLine
 */
function multiLineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiLineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.multiLineString = multiLineString;
/**
 * Creates a {@link Feature<MultiPoint>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPoint
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPoint>} a MultiPoint feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPt = turf.multiPoint([[0,0],[10,10]]);
 *
 * //=multiPt
 */
function multiPoint(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPoint",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.multiPoint = multiPoint;
/**
 * Creates a {@link Feature<MultiPolygon>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPolygon
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPolygon>} a multipolygon feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);
 *
 * //=multiPoly
 *
 */
function multiPolygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPolygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
exports.multiPolygon = multiPolygon;
/**
 * Creates a {@link Feature<GeometryCollection>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name geometryCollection
 * @param {Array<Geometry>} geometries an array of GeoJSON Geometries
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature
 * @example
 * var pt = turf.geometry("Point", [100, 0]);
 * var line = turf.geometry("LineString", [[101, 0], [102, 1]]);
 * var collection = turf.geometryCollection([pt, line]);
 *
 * // => collection
 */
function geometryCollection(geometries, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "GeometryCollection",
        geometries: geometries,
    };
    return feature(geom, properties, options);
}
exports.geometryCollection = geometryCollection;
/**
 * Round number to precision
 *
 * @param {number} num Number
 * @param {number} [precision=0] Precision
 * @returns {number} rounded number
 * @example
 * turf.round(120.4321)
 * //=120
 *
 * turf.round(120.4321, 2)
 * //=120.43
 */
function round(num, precision) {
    if (precision === void 0) { precision = 0; }
    if (precision && !(precision >= 0)) {
        throw new Error("precision must be a positive number");
    }
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(num * multiplier) / multiplier;
}
exports.round = round;
/**
 * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name radiansToLength
 * @param {number} radians in radians across the sphere
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} distance
 */
function radiansToLength(radians, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = exports.factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return radians * factor;
}
exports.radiansToLength = radiansToLength;
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name lengthToRadians
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} radians
 */
function lengthToRadians(distance, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = exports.factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return distance / factor;
}
exports.lengthToRadians = lengthToRadians;
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet
 *
 * @name lengthToDegrees
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} degrees
 */
function lengthToDegrees(distance, units) {
    return radiansToDegrees(lengthToRadians(distance, units));
}
exports.lengthToDegrees = lengthToDegrees;
/**
 * Converts any bearing angle from the north line direction (positive clockwise)
 * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line
 *
 * @name bearingToAzimuth
 * @param {number} bearing angle, between -180 and +180 degrees
 * @returns {number} angle between 0 and 360 degrees
 */
function bearingToAzimuth(bearing) {
    var angle = bearing % 360;
    if (angle < 0) {
        angle += 360;
    }
    return angle;
}
exports.bearingToAzimuth = bearingToAzimuth;
/**
 * Converts an angle in radians to degrees
 *
 * @name radiansToDegrees
 * @param {number} radians angle in radians
 * @returns {number} degrees between 0 and 360 degrees
 */
function radiansToDegrees(radians) {
    var degrees = radians % (2 * Math.PI);
    return degrees * 180 / Math.PI;
}
exports.radiansToDegrees = radiansToDegrees;
/**
 * Converts an angle in degrees to radians
 *
 * @name degreesToRadians
 * @param {number} degrees angle between 0 and 360 degrees
 * @returns {number} angle in radians
 */
function degreesToRadians(degrees) {
    var radians = degrees % 360;
    return radians * Math.PI / 180;
}
exports.degreesToRadians = degreesToRadians;
/**
 * Converts a length to the requested unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @param {number} length to be converted
 * @param {Units} [originalUnit="kilometers"] of the length
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted length
 */
function convertLength(length, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "kilometers"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(length >= 0)) {
        throw new Error("length must be a positive number");
    }
    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);
}
exports.convertLength = convertLength;
/**
 * Converts a area to the requested unit.
 * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches
 * @param {number} area to be converted
 * @param {Units} [originalUnit="meters"] of the distance
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted distance
 */
function convertArea(area, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "meters"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(area >= 0)) {
        throw new Error("area must be a positive number");
    }
    var startFactor = exports.areaFactors[originalUnit];
    if (!startFactor) {
        throw new Error("invalid original units");
    }
    var finalFactor = exports.areaFactors[finalUnit];
    if (!finalFactor) {
        throw new Error("invalid final units");
    }
    return (area / startFactor) * finalFactor;
}
exports.convertArea = convertArea;
/**
 * isNumber
 *
 * @param {*} num Number to validate
 * @returns {boolean} true/false
 * @example
 * turf.isNumber(123)
 * //=true
 * turf.isNumber('foo')
 * //=false
 */
function isNumber(num) {
    return !isNaN(num) && num !== null && !Array.isArray(num) && !/^\s*$/.test(num);
}
exports.isNumber = isNumber;
/**
 * isObject
 *
 * @param {*} input variable to validate
 * @returns {boolean} true/false
 * @example
 * turf.isObject({elevation: 10})
 * //=true
 * turf.isObject('foo')
 * //=false
 */
function isObject(input) {
    return (!!input) && (input.constructor === Object);
}
exports.isObject = isObject;
/**
 * Validate BBox
 *
 * @private
 * @param {Array<number>} bbox BBox to validate
 * @returns {void}
 * @throws Error if BBox is not valid
 * @example
 * validateBBox([-180, -40, 110, 50])
 * //=OK
 * validateBBox([-180, -40])
 * //=Error
 * validateBBox('Foo')
 * //=Error
 * validateBBox(5)
 * //=Error
 * validateBBox(null)
 * //=Error
 * validateBBox(undefined)
 * //=Error
 */
function validateBBox(bbox) {
    if (!bbox) {
        throw new Error("bbox is required");
    }
    if (!Array.isArray(bbox)) {
        throw new Error("bbox must be an Array");
    }
    if (bbox.length !== 4 && bbox.length !== 6) {
        throw new Error("bbox must be an Array of 4 or 6 numbers");
    }
    bbox.forEach(function (num) {
        if (!isNumber(num)) {
            throw new Error("bbox must only contain numbers");
        }
    });
}
exports.validateBBox = validateBBox;
/**
 * Validate Id
 *
 * @private
 * @param {string|number} id Id to validate
 * @returns {void}
 * @throws Error if Id is not valid
 * @example
 * validateId([-180, -40, 110, 50])
 * //=Error
 * validateId([-180, -40])
 * //=Error
 * validateId('Foo')
 * //=OK
 * validateId(5)
 * //=OK
 * validateId(null)
 * //=Error
 * validateId(undefined)
 * //=Error
 */
function validateId(id) {
    if (!id) {
        throw new Error("id is required");
    }
    if (["string", "number"].indexOf(typeof id) === -1) {
        throw new Error("id must be a number or a string");
    }
}
exports.validateId = validateId;
// Deprecated methods
function radians2degrees() {
    throw new Error("method has been renamed to `radiansToDegrees`");
}
exports.radians2degrees = radians2degrees;
function degrees2radians() {
    throw new Error("method has been renamed to `degreesToRadians`");
}
exports.degrees2radians = degrees2radians;
function distanceToDegrees() {
    throw new Error("method has been renamed to `lengthToDegrees`");
}
exports.distanceToDegrees = distanceToDegrees;
function distanceToRadians() {
    throw new Error("method has been renamed to `lengthToRadians`");
}
exports.distanceToRadians = distanceToRadians;
function radiansToDistance() {
    throw new Error("method has been renamed to `radiansToLength`");
}
exports.radiansToDistance = radiansToDistance;
function bearingToAngle() {
    throw new Error("method has been renamed to `bearingToAzimuth`");
}
exports.bearingToAngle = bearingToAngle;
function convertDistance() {
    throw new Error("method has been renamed to `convertLength`");
}
exports.convertDistance = convertDistance;


/***/ }),
/* 172 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _Node = __webpack_require__(116);

var _Node2 = _interopRequireDefault(_Node);

var _Leaf = __webpack_require__(117);

var _Leaf2 = _interopRequireDefault(_Leaf);

var _Group = __webpack_require__(173);

var _Group2 = _interopRequireDefault(_Group);

var _Tree = __webpack_require__(378);

var _Tree2 = _interopRequireDefault(_Tree);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * SceneTree 命名空间<br/>
 * 场景树用来存储场景中的元素，可以以树状形式管理所有数据。<br/>
 * 数据一旦存储到场景树中以后，可以将整个场景树输出成一个配置文件方便使用<br/>
 * @namespace 
 */
var SceneTree = {
  Node: _Node2.default,
  Leaf: _Leaf2.default,
  Group: _Group2.default,
  Tree: _Tree2.default
};

exports.default = SceneTree;

/***/ }),
/* 173 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends2 = __webpack_require__(63);

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _Node2 = __webpack_require__(116);

var _Node3 = _interopRequireDefault(_Node2);

var _Leaf = __webpack_require__(117);

var _Leaf2 = _interopRequireDefault(_Leaf);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var mobx = {
    intercept: _mobx.intercept,
    extendObservable: _mobx.extendObservable,
    observable: _mobx.observable
};

/**
 * 场景结构树组节点
 * @class
 * @memberof SceneTree
 * @param {Earth} earth earth实例
 * @extends SceneTree.Node
 */

var Group = function (_Node) {
    (0, _inherits3.default)(Group, _Node);

    function Group(earth) {
        (0, _classCallCheck3.default)(this, Group);

        // this._fromJsonFilterKeys.push('children');
        // this._toJsonFilterKeys.push('children');

        /**
         * 当前叶子节点是否被选中的状态，注意此属性只读，属性值只有两个：'checked' / 'unchecked' / ‘indeterminate’ / ‘ignored’ <br/>
         * 'checked'表示所有子节点都可用，'unchecked'表示所有子节点都不可用，<br/>
         * ‘indeterminate’表示部分节点可用，‘ignored’表示没有子节点，状态忽略
         * @name checkStatus
         * @type {string}
         * @instance
         * @memberof SceneTree.Group
         * @readonly
         */

        var _this = (0, _possibleConstructorReturn3.default)(this, (Group.__proto__ || (0, _getPrototypeOf2.default)(Group)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            // expand: true,
            // children: [],
            get checkStatus() {
                var validChildren = this.children.filter(function (child) {
                    return child.checkStatus !== 'ignored';
                });

                if (validChildren.length === 0) {
                    return 'ignored'; // children数量为0时忽略
                }

                if (validChildren.every(function (child) {
                    return child.checkStatus === 'checked';
                })) {
                    return 'checked';
                } else if (validChildren.every(function (child) {
                    return child.checkStatus === 'unchecked';
                })) {
                    return 'unchecked';
                } else {
                    return 'indeterminate';
                }
            }
        }, {
            checkStatus: _mobx.computed
        });

        _this._disposers = [];

        _this._disposers.push(_XbsjBase2.default.registerArrayProperty(_this, 'children', function (childJSON) {
            if (childJSON instanceof _Node3.default) {
                if (typeof childJSON._parent === 'undefined') {
                    childJSON._parent = _this;
                    return childJSON;
                } else {
                    return undefined; // 返回undefined则不做修改了！
                }
            } else {
                childJSON = childJSON && childJSON.toJSON && childJSON.toJSON() || childJSON;
                var child = void 0;
                if (childJSON.children) {
                    child = new Group(earth);
                    child.xbsjFromJSON(childJSON);
                } else {
                    child = _Leaf2.default.xbsjFromJSON(childJSON, earth);
                }

                child._parent = _this;
                return child;
            }
        }, function (child) {
            child._parent = undefined;

            if (child._autoDestroy) {
                child.destroy();
            }
        }));
        return _this;
    }

    /**
     * 是否启用(是否勾选)
     * @type {boolean}
     */

    (0, _createClass3.default)(Group, [{
        key: 'setAllChildrenEnabled',

        // group的enabled属性是一个只写属性，很容易让别人来当成响应式属性使用，产生一些概念混淆
        // 所以此函数的目的是为了替换enabled属性
        /**
         * 设置所有子节点启用或者关闭
         * @param {boolean} enabled true表示全部启用，false表示全部关闭
         */
        value: function setAllChildrenEnabled(enabled) {
            this.children.forEach(function (child) {
                if (child instanceof Group) {
                    child.setAllChildrenEnabled(!!enabled);
                } else if (child instanceof _Leaf2.default) {
                    child.enabled = !!enabled;
                }
            });
        }

        // toJson() {
        //     const jsonObject = {
        //         expand: this.expand,
        //         title: this.title,
        //         children: this.children.map(child => child.toJson()),
        //     };

        //     return jsonObject;
        // }

    }, {
        key: 'toJSON',
        value: function toJSON() {
            return (0, _extends3.default)({}, (0, _get3.default)(Group.prototype.__proto__ || (0, _getPrototypeOf2.default)(Group.prototype), 'toJSON', this).call(this), {
                children: this.children.map(function (child) {
                    return child.toJSON();
                })
            });
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this.children.forEach(function (child) {
                return child.destroy();
            });
            this.children.length = 0;

            return (0, _get3.default)(Group.prototype.__proto__ || (0, _getPrototypeOf2.default)(Group.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'enabled',
        set: function set(value) {
            console.warn('此只写属性将被废弃，请使用setAllChildrenEnabled函数!');
            this.children.forEach(function (child) {
                return child.enabled = !!value;
            });
        }
    }]);
    return Group;
}(_Node3.default);

// /**
//  * 根据指定的json配置来创建Group
//  * @function    
//  * @returns {SceneTree.Group} 返回创建的SceneTree.Group对象
//  */
// Group.xbsjFromJSON = function (jsonObject, earth, group) {
//     group = group || new Group(earth);
//     group.xbsjFromJSON(jsonObject);
//     group.children.length = 0;
//     jsonObject.children.forEach(child => {
//         if (child.children) {
//             const childGP = Group.xbsjFromJSON(child, earth);
//             group.children.push(childGP);
//         } else {
//             const childSO = Leaf.xbsjFromJSON(child, earth);
//             group.children.push(childSO);
//         }
//     });

//     return group;
// }

Group.defaultOptions = {
    /**
     * 是否展开节点
     * @type {boolean}
     * @default true
     * @instance
     * @memberof SceneTree.Group
     */
    expand: true,
    /**
     * 子节点数组
     * @type {array}
     * @default []
     * @instance
     * @memberof SceneTree.Group
     */
    children: []
};

exports.default = Group;

/***/ }),
/* 174 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return empty; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__config__ = __webpack_require__(87);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_hostReportError__ = __webpack_require__(119);
/** PURE_IMPORTS_START _config,_util_hostReportError PURE_IMPORTS_END */


var empty = {
    closed: true,
    next: function (value) { },
    error: function (err) {
        if (__WEBPACK_IMPORTED_MODULE_0__config__["a" /* config */].useDeprecatedSynchronousErrorHandling) {
            throw err;
        }
        else {
            Object(__WEBPACK_IMPORTED_MODULE_1__util_hostReportError__["a" /* hostReportError */])(err);
        }
    },
    complete: function () { }
};
//# sourceMappingURL=Observer.js.map


/***/ }),
/* 175 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return UnsubscriptionError; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function UnsubscriptionErrorImpl(errors) {
    Error.call(this);
    this.message = errors ?
        errors.length + " errors occurred during unsubscription:\n" + errors.map(function (err, i) { return i + 1 + ") " + err.toString(); }).join('\n  ') : '';
    this.name = 'UnsubscriptionError';
    this.errors = errors;
    return this;
}
UnsubscriptionErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
var UnsubscriptionError = UnsubscriptionErrorImpl;
//# sourceMappingURL=UnsubscriptionError.js.map


/***/ }),
/* 176 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = pipe;
/* harmony export (immutable) */ __webpack_exports__["b"] = pipeFromArray;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__noop__ = __webpack_require__(122);
/** PURE_IMPORTS_START _noop PURE_IMPORTS_END */

function pipe() {
    var fns = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        fns[_i] = arguments[_i];
    }
    return pipeFromArray(fns);
}
function pipeFromArray(fns) {
    if (!fns) {
        return __WEBPACK_IMPORTED_MODULE_0__noop__["a" /* noop */];
    }
    if (fns.length === 1) {
        return fns[0];
    }
    return function piped(input) {
        return fns.reduce(function (prev, fn) { return fn(prev); }, input);
    };
}
//# sourceMappingURL=pipe.js.map


/***/ }),
/* 177 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return SubjectSubscription; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */


var SubjectSubscription = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](SubjectSubscription, _super);
    function SubjectSubscription(subject, subscriber) {
        var _this = _super.call(this) || this;
        _this.subject = subject;
        _this.subscriber = subscriber;
        _this.closed = false;
        return _this;
    }
    SubjectSubscription.prototype.unsubscribe = function () {
        if (this.closed) {
            return;
        }
        this.closed = true;
        var subject = this.subject;
        var observers = subject.observers;
        this.subject = null;
        if (!observers || observers.length === 0 || subject.isStopped || subject.closed) {
            return;
        }
        var subscriberIndex = observers.indexOf(this.subscriber);
        if (subscriberIndex !== -1) {
            observers.splice(subscriberIndex, 1);
        }
    };
    return SubjectSubscription;
}(__WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]));

//# sourceMappingURL=SubjectSubscription.js.map


/***/ }),
/* 178 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return queue; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__QueueAction__ = __webpack_require__(386);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__QueueScheduler__ = __webpack_require__(388);
/** PURE_IMPORTS_START _QueueAction,_QueueScheduler PURE_IMPORTS_END */


var queue = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_1__QueueScheduler__["a" /* QueueScheduler */](__WEBPACK_IMPORTED_MODULE_0__QueueAction__["a" /* QueueAction */]);
//# sourceMappingURL=queue.js.map


/***/ }),
/* 179 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Scheduler; });
var Scheduler = /*@__PURE__*/ (function () {
    function Scheduler(SchedulerAction, now) {
        if (now === void 0) {
            now = Scheduler.now;
        }
        this.SchedulerAction = SchedulerAction;
        this.now = now;
    }
    Scheduler.prototype.schedule = function (work, delay, state) {
        if (delay === void 0) {
            delay = 0;
        }
        return new this.SchedulerAction(this, work).schedule(state, delay);
    };
    Scheduler.now = function () { return Date.now(); };
    return Scheduler;
}());

//# sourceMappingURL=Scheduler.js.map


/***/ }),
/* 180 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return NotificationKind; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Notification; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__observable_empty__ = __webpack_require__(44);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__observable_of__ = __webpack_require__(123);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__observable_throwError__ = __webpack_require__(182);
/** PURE_IMPORTS_START _observable_empty,_observable_of,_observable_throwError PURE_IMPORTS_END */



var NotificationKind;
/*@__PURE__*/ (function (NotificationKind) {
    NotificationKind["NEXT"] = "N";
    NotificationKind["ERROR"] = "E";
    NotificationKind["COMPLETE"] = "C";
})(NotificationKind || (NotificationKind = {}));
var Notification = /*@__PURE__*/ (function () {
    function Notification(kind, value, error) {
        this.kind = kind;
        this.value = value;
        this.error = error;
        this.hasValue = kind === 'N';
    }
    Notification.prototype.observe = function (observer) {
        switch (this.kind) {
            case 'N':
                return observer.next && observer.next(this.value);
            case 'E':
                return observer.error && observer.error(this.error);
            case 'C':
                return observer.complete && observer.complete();
        }
    };
    Notification.prototype.do = function (next, error, complete) {
        var kind = this.kind;
        switch (kind) {
            case 'N':
                return next && next(this.value);
            case 'E':
                return error && error(this.error);
            case 'C':
                return complete && complete();
        }
    };
    Notification.prototype.accept = function (nextOrObserver, error, complete) {
        if (nextOrObserver && typeof nextOrObserver.next === 'function') {
            return this.observe(nextOrObserver);
        }
        else {
            return this.do(nextOrObserver, error, complete);
        }
    };
    Notification.prototype.toObservable = function () {
        var kind = this.kind;
        switch (kind) {
            case 'N':
                return Object(__WEBPACK_IMPORTED_MODULE_1__observable_of__["a" /* of */])(this.value);
            case 'E':
                return Object(__WEBPACK_IMPORTED_MODULE_2__observable_throwError__["a" /* throwError */])(this.error);
            case 'C':
                return Object(__WEBPACK_IMPORTED_MODULE_0__observable_empty__["b" /* empty */])();
        }
        throw new Error('unexpected notification kind value');
    };
    Notification.createNext = function (value) {
        if (typeof value !== 'undefined') {
            return new Notification('N', value);
        }
        return Notification.undefinedValueNotification;
    };
    Notification.createError = function (err) {
        return new Notification('E', undefined, err);
    };
    Notification.createComplete = function () {
        return Notification.completeNotification;
    };
    Notification.completeNotification = new Notification('C');
    Notification.undefinedValueNotification = new Notification('N', undefined);
    return Notification;
}());

//# sourceMappingURL=Notification.js.map


/***/ }),
/* 181 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return subscribeToArray; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var subscribeToArray = function (array) {
    return function (subscriber) {
        for (var i = 0, len = array.length; i < len && !subscriber.closed; i++) {
            subscriber.next(array[i]);
        }
        subscriber.complete();
    };
};
//# sourceMappingURL=subscribeToArray.js.map


/***/ }),
/* 182 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = throwError;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function throwError(error, scheduler) {
    if (!scheduler) {
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) { return subscriber.error(error); });
    }
    else {
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) { return scheduler.schedule(dispatch, 0, { error: error, subscriber: subscriber }); });
    }
}
function dispatch(_a) {
    var error = _a.error, subscriber = _a.subscriber;
    subscriber.error(error);
}
//# sourceMappingURL=throwError.js.map


/***/ }),
/* 183 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return InnerSubscriber; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


var InnerSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](InnerSubscriber, _super);
    function InnerSubscriber(parent, outerValue, outerIndex) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        _this.outerValue = outerValue;
        _this.outerIndex = outerIndex;
        _this.index = 0;
        return _this;
    }
    InnerSubscriber.prototype._next = function (value) {
        this.parent.notifyNext(this.outerValue, value, this.outerIndex, this.index++, this);
    };
    InnerSubscriber.prototype._error = function (error) {
        this.parent.notifyError(error, this);
        this.unsubscribe();
    };
    InnerSubscriber.prototype._complete = function () {
        this.parent.notifyComplete(this);
        this.unsubscribe();
    };
    return InnerSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));

//# sourceMappingURL=InnerSubscriber.js.map


/***/ }),
/* 184 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return isArrayLike; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var isArrayLike = (function (x) { return x && typeof x.length === 'number' && typeof x !== 'function'; });
//# sourceMappingURL=isArrayLike.js.map


/***/ }),
/* 185 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isPromise;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function isPromise(value) {
    return !!value && typeof value.subscribe !== 'function' && typeof value.then === 'function';
}
//# sourceMappingURL=isPromise.js.map


/***/ }),
/* 186 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = mergeAll;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__mergeMap__ = __webpack_require__(410);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_identity__ = __webpack_require__(127);
/** PURE_IMPORTS_START _mergeMap,_util_identity PURE_IMPORTS_END */


function mergeAll(concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    return Object(__WEBPACK_IMPORTED_MODULE_0__mergeMap__["a" /* mergeMap */])(__WEBPACK_IMPORTED_MODULE_1__util_identity__["a" /* identity */], concurrent);
}
//# sourceMappingURL=mergeAll.js.map


/***/ }),
/* 187 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = scheduled;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__scheduleObservable__ = __webpack_require__(411);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__schedulePromise__ = __webpack_require__(412);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__scheduleArray__ = __webpack_require__(124);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__scheduleIterable__ = __webpack_require__(413);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_isInteropObservable__ = __webpack_require__(414);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__util_isPromise__ = __webpack_require__(185);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__util_isArrayLike__ = __webpack_require__(184);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__util_isIterable__ = __webpack_require__(415);
/** PURE_IMPORTS_START _scheduleObservable,_schedulePromise,_scheduleArray,_scheduleIterable,_util_isInteropObservable,_util_isPromise,_util_isArrayLike,_util_isIterable PURE_IMPORTS_END */








function scheduled(input, scheduler) {
    if (input != null) {
        if (Object(__WEBPACK_IMPORTED_MODULE_4__util_isInteropObservable__["a" /* isInteropObservable */])(input)) {
            return Object(__WEBPACK_IMPORTED_MODULE_0__scheduleObservable__["a" /* scheduleObservable */])(input, scheduler);
        }
        else if (Object(__WEBPACK_IMPORTED_MODULE_5__util_isPromise__["a" /* isPromise */])(input)) {
            return Object(__WEBPACK_IMPORTED_MODULE_1__schedulePromise__["a" /* schedulePromise */])(input, scheduler);
        }
        else if (Object(__WEBPACK_IMPORTED_MODULE_6__util_isArrayLike__["a" /* isArrayLike */])(input)) {
            return Object(__WEBPACK_IMPORTED_MODULE_2__scheduleArray__["a" /* scheduleArray */])(input, scheduler);
        }
        else if (Object(__WEBPACK_IMPORTED_MODULE_7__util_isIterable__["a" /* isIterable */])(input) || typeof input === 'string') {
            return Object(__WEBPACK_IMPORTED_MODULE_3__scheduleIterable__["a" /* scheduleIterable */])(input, scheduler);
        }
    }
    throw new TypeError((input !== null && typeof input || input) + ' is not observable');
}
//# sourceMappingURL=scheduled.js.map


/***/ }),
/* 188 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = defer;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__from__ = __webpack_require__(54);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__empty__ = __webpack_require__(44);
/** PURE_IMPORTS_START _Observable,_from,_empty PURE_IMPORTS_END */



function defer(observableFactory) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var input;
        try {
            input = observableFactory();
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var source = input ? Object(__WEBPACK_IMPORTED_MODULE_1__from__["a" /* from */])(input) : Object(__WEBPACK_IMPORTED_MODULE_2__empty__["b" /* empty */])();
        return source.subscribe(subscriber);
    });
}
//# sourceMappingURL=defer.js.map


/***/ }),
/* 189 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isNumeric;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__isArray__ = __webpack_require__(28);
/** PURE_IMPORTS_START _isArray PURE_IMPORTS_END */

function isNumeric(val) {
    return !Object(__WEBPACK_IMPORTED_MODULE_0__isArray__["a" /* isArray */])(val) && (val - parseFloat(val) + 1) >= 0;
}
//# sourceMappingURL=isNumeric.js.map


/***/ }),
/* 190 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return NEVER; });
/* harmony export (immutable) */ __webpack_exports__["b"] = never;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_noop__ = __webpack_require__(122);
/** PURE_IMPORTS_START _Observable,_util_noop PURE_IMPORTS_END */


var NEVER = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](__WEBPACK_IMPORTED_MODULE_1__util_noop__["a" /* noop */]);
function never() {
    return NEVER;
}
//# sourceMappingURL=never.js.map


/***/ }),
/* 191 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _Status = __webpack_require__(129);

var _Status2 = _interopRequireDefault(_Status);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 视角
 * @class
 * @memberof CameraView
 * @extends XbsjObject
 */
var View = function (_XbsjCameraStatus) {
    (0, _inherits3.default)(View, _XbsjCameraStatus);

    function View(earth) {
        (0, _classCallCheck3.default)(this, View);
        return (0, _possibleConstructorReturn3.default)(this, (View.__proto__ || (0, _getPrototypeOf2.default)(View)).call(this, earth));
    }
    /**
     * 使用当前场景的相机状态来初始化
     * @returns {Promise}
     */

    (0, _createClass3.default)(View, [{
        key: 'initWithCurrent',
        value: function initWithCurrent() {
            var _this2 = this;

            return new _promise2.default(function (resolve, reject) {
                //屏幕截图 64 * 64
                _this2._earth.capture(64, 64).then(function (img) {
                    _this2.thumbnail = img;
                    (0, _get3.default)(View.prototype.__proto__ || (0, _getPrototypeOf2.default)(View.prototype), 'initWithCurrent', _this2).call(_this2);
                    resolve(true);
                }).catch(function (err) {
                    reject(err);
                });
            });
        }

        /**
         * 飞入
         */

    }, {
        key: 'flyTo',
        value: function flyTo() {
            return (0, _get3.default)(View.prototype.__proto__ || (0, _getPrototypeOf2.default)(View.prototype), 'flyTo', this).call(this, this.duration);
        }
    }]);
    return View;
}(_Status2.default);

View.defaultOptions = {
    /**
     * 名称
     * @type {string}
     * @instance
     * @default 'new camera view'
     * @memberof CameraView.View
     */
    name: 'new camera view',
    /**
     * 名称
     * @type {number}
     * @instance
     * @default 0.5
     * @memberof CameraView.View
     */
    duration: 0.5,
    /**
     * 缩略图
     * @type {string}
     * @instance
     * @default ''
     * @memberof CameraView.View
     */
    thumbnail: ''
};

_XbsjObject2.default.registerType(View, 'CameraView.View');

exports.default = View;

/***/ }),
/* 192 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var flyToScratchCartesian = void 0;
var flyToHPR = void 0;
var flyToMatrix4 = void 0;
var flyTocartesian3 = void 0;

function flyTo(czmCamera, // 必须有
position, // 必须有
viewDistance, // 可选项
rotation, // 可选项
duration, // 可选项
options) // 可选项
{
    var _Cesium$Cartesian;

    flyToScratchCartesian = flyToScratchCartesian || new Cesium.Cartesian3();
    var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, flyToScratchCartesian]));

    var cameraObserver = undefined;

    rotation = rotation || [czmCamera.heading, czmCamera.pitch, czmCamera.roll];
    if (viewDistance) {
        var _flyToHPR;

        flyToHPR = flyToHPR || new Cesium.HeadingPitchRoll();
        (_flyToHPR = flyToHPR).xbsjFromArray.apply(_flyToHPR, (0, _toConsumableArray3.default)(rotation));
        flyToHPR.heading -= Cesium.Math.PI_OVER_TWO;

        flyToMatrix4 = flyToMatrix4 || new Cesium.Matrix4();
        var mat4 = Cesium.Transforms.headingPitchRollToFixedFrame(cartesian, flyToHPR, undefined, undefined, flyToMatrix4);

        flyTocartesian3 = flyTocartesian3 || new Cesium.Cartesian3();
        var dir = Cesium.Matrix4.multiplyByPointAsVector(mat4, Cesium.Cartesian3.UNIT_X, flyTocartesian3);

        Cesium.Cartesian3.multiplyByScalar(dir, viewDistance, dir);
        Cesium.Cartesian3.subtract(cartesian, dir, cartesian);
    }

    if (duration === 0) {
        // duration为0则立即执行
        czmCamera.setView({
            destination: cartesian,
            orientation: {
                heading: rotation[0],
                pitch: rotation[1],
                roll: rotation[2]
            }
        });
        options && options.complete && options.complete();
    } else {
        czmCamera.flyTo({
            destination: cartesian,
            orientation: {
                heading: rotation[0],
                pitch: rotation[1],
                roll: rotation[2]
            },
            complete: function complete() {
                options && options.complete && setTimeout(function () {
                    return options.complete();
                }, 0);
                cameraObserver && cameraObserver.next('completed');
            },
            cancel: function cancel() {
                options && options.cancel && setTimeout(function () {
                    return options.cancel();
                }, 0);
                cameraObserver && cameraObserver.next('cancelled');
            },
            duration: duration
        });
    }

    // 这个写法是否有必要？？
    // // 必须放在flyTo之后
    // const currentFlight = czmCamera._currentFlight;

    // // 这个new出来的对象，是否会一直存在？？
    // return new rxjs.Observable(observer => {
    //     cameraObserver = observer;

    //     return () => {
    //         if (currentFlight === czmCamera._currentFlight) {
    //             czmCamera.cancelFlight();
    //             czmCamera = undefined;
    //         }
    //     }
    // });
}

exports.default = flyTo;

/***/ }),
/* 193 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function extendGetter(self, property) {
    var privateProperty = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : '_' + property;

    (0, _defineProperty2.default)(self, property, {
        get: function get() {
            return self[privateProperty];
        }
    });
}

exports.default = extendGetter;

/***/ }),
/* 194 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _pickVirtualPlane = __webpack_require__(458);

var _pickVirtualPlane2 = _interopRequireDefault(_pickVirtualPlane);

var _Circle = __webpack_require__(459);

var _Circle2 = _interopRequireDefault(_Circle);

var _updateRealSceneScale = __webpack_require__(82);

var _updateRealSceneScale2 = _interopRequireDefault(_updateRealSceneScale);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

var _CameraHelper = __webpack_require__(162);

var _CameraHelper2 = _interopRequireDefault(_CameraHelper);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var CirclesRotating = function (_XbsjEditing) {
    (0, _inherits3.default)(CirclesRotating, _XbsjEditing);

    function CirclesRotating(earth) {
        (0, _classCallCheck3.default)(this, CirclesRotating);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CirclesRotating.__proto__ || (0, _getPrototypeOf2.default)(CirclesRotating)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            position: [0, 0, 0],
            rotation: [0, 0, 0],
            scale: 1.0,
            fixScreenSize: 100,
            toleranceSize: 6,
            headingCircleActive: false,
            pitchCircleActive: false,
            rollCircleActive: false,
            headingEnabled: true,
            pitchEnabled: true,
            rollEnabled: true
        });

        (0, _mobx.extendObservable)(_this, {
            _oldRotation: [0, 0, 0],
            _startRotation: [0, 0, 0],
            _endRotation: [0, 0, 0]
        });

        (0, _mobx.extendObservable)(_this, {
            isCameraLike: false
        });

        _this._centerCartesian = new Cesium.Cartesian3();
        _this._enu = new Cesium.Matrix4();
        _this._enuChangedEvent = new Cesium.Event();

        var updateEnu = function updateEnu(position) {
            var _Cesium$Cartesian;

            _this._centerCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, _this._centerCartesian]));
            _this._enu = Cesium.Transforms.eastNorthUpToFixedFrame(_this._centerCartesian, undefined, _this._enu);
            _this._enuChangedEvent.raiseEvent();
        };

        updateEnu(_this.position);
        _this.disposers.push((0, _mobx.reaction)(function () {
            return { enabled: _this.enabled, position: [].concat((0, _toConsumableArray3.default)(_this.position)) };
        }, function (_ref) {
            var enabled = _ref.enabled,
                position = _ref.position;

            enabled && updateEnu(position);
        }));

        (0, _mobx.extendObservable)(_this, {
            _realSceneScale: 1.0
        });

        _this.disposers.push((0, _updateRealSceneScale2.default)(_this._earth, _this));

        _this._createDirections();
        _this._createBaseCircles();

        _this._createCenterModel();
        return _this;
    }

    (0, _createClass3.default)(CirclesRotating, [{
        key: '_createDirections',
        value: function _createDirections() {
            var _this2 = this;

            // 几何绘制
            this._originHeadingDirection = new Cesium.Cartesian3(1, 0, 0);
            this._originHeadingUp = new Cesium.Cartesian3(0, 0, -1);
            this._originPitchDirection = new Cesium.Cartesian3(1, 0, 0);
            this._originPitchUp = new Cesium.Cartesian3(0, -1, 0);
            this._originRollDirection = new Cesium.Cartesian3(0, 1, 0);
            this._originRollUp = new Cesium.Cartesian3(1, 0, 0);

            this._headingDirection = new Cesium.Cartesian3(1, 0, 0);
            this._headingUp = new Cesium.Cartesian3(0, 0, -1);
            this._pitchDirection = new Cesium.Cartesian3(1, 0, 0);
            this._pitchUp = new Cesium.Cartesian3(0, -1, 0);
            this._rollDirection = new Cesium.Cartesian3(0, 1, 0);
            this._rollUp = new Cesium.Cartesian3(1, 0, 0);

            this._headingHpr = new Cesium.HeadingPitchRoll();
            this._pitchHpr = new Cesium.HeadingPitchRoll();
            this._rollHpr = new Cesium.HeadingPitchRoll();
            this._lastHpr = new Cesium.HeadingPitchRoll();

            this._headingQuat = new Cesium.Quaternion();
            this._pitchQuat = new Cesium.Quaternion();
            this._rollQuat = new Cesium.Quaternion();
            this._lastQuat = new Cesium.Quaternion();

            this._headingMat = new Cesium.Matrix3();
            this._pitchMat = new Cesium.Matrix3();
            this._rollMat = new Cesium.Matrix3();
            this._lastMat = new Cesium.Matrix3();

            this._headingMat4 = new Cesium.Matrix4();
            this._pitchMat4 = new Cesium.Matrix4();
            this._rollMat4 = new Cesium.Matrix4();
            this._lastMat4 = new Cesium.Matrix4();

            var updateDirections = function updateDirections() {
                // this._headingHpr.heading = this.rotation[0];

                _this2._pitchHpr.heading = _this2.rotation[0];

                _this2._rollHpr.heading = _this2.rotation[0];
                _this2._rollHpr.pitch = _this2.rotation[1];

                _this2._lastHpr.heading = _this2.rotation[0];
                _this2._lastHpr.pitch = _this2.rotation[1];
                _this2._lastHpr.roll = _this2.rotation[2];

                _this2._headingQuat = Cesium.Quaternion.fromHeadingPitchRoll(_this2._headingHpr, _this2._headingQuat);
                _this2._pitchQuat = Cesium.Quaternion.fromHeadingPitchRoll(_this2._pitchHpr, _this2._pitchQuat);
                _this2._rollQuat = Cesium.Quaternion.fromHeadingPitchRoll(_this2._rollHpr, _this2._rollQuat);
                _this2._lastQuat = Cesium.Quaternion.fromHeadingPitchRoll(_this2._lastHpr, _this2._lastQuat);

                _this2._headingMat = Cesium.Matrix3.fromQuaternion(_this2._headingQuat, _this2._headingMat);
                _this2._pitchMat = Cesium.Matrix3.fromQuaternion(_this2._pitchQuat, _this2._pitchMat);
                _this2._rollMat = Cesium.Matrix3.fromQuaternion(_this2._rollQuat, _this2._rollMat);
                _this2._lastMat = Cesium.Matrix3.fromQuaternion(_this2._lastQuat, _this2._lastMat);

                _this2._headingMat4 = Cesium.Matrix4.multiplyByMatrix3(_this2._enu, _this2._headingMat, _this2._headingMat4);
                _this2._pitchMat4 = Cesium.Matrix4.multiplyByMatrix3(_this2._enu, _this2._pitchMat, _this2._pitchMat4);
                _this2._rollMat4 = Cesium.Matrix4.multiplyByMatrix3(_this2._enu, _this2._rollMat, _this2._rollMat4);
                _this2._lastMat4 = Cesium.Matrix4.multiplyByMatrix3(_this2._enu, _this2._lastMat, _this2._lastMat4);

                Cesium.Matrix3.multiplyByVector(_this2._headingMat, _this2._originHeadingDirection, _this2._headingDirection);
                Cesium.Matrix3.multiplyByVector(_this2._headingMat, _this2._originHeadingUp, _this2._headingUp);
                Cesium.Matrix3.multiplyByVector(_this2._pitchMat, _this2._originPitchDirection, _this2._pitchDirection);
                Cesium.Matrix3.multiplyByVector(_this2._pitchMat, _this2._originPitchUp, _this2._pitchUp);
                Cesium.Matrix3.multiplyByVector(_this2._rollMat, _this2._originRollDirection, _this2._rollDirection);
                Cesium.Matrix3.multiplyByVector(_this2._rollMat, _this2._originRollUp, _this2._rollUp);

                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._headingDirection, _this2._headingDirection);
                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._headingUp, _this2._headingUp);
                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._pitchDirection, _this2._pitchDirection);
                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._pitchUp, _this2._pitchUp);
                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._rollDirection, _this2._rollDirection);
                Cesium.Matrix4.multiplyByPointAsVector(_this2._enu, _this2._rollUp, _this2._rollUp);
            };

            this.disposers.push((0, _mobx.reaction)(function () {
                return [].concat((0, _toConsumableArray3.default)(_this2.rotation));
            }, function () {
                updateDirections();
            }));

            this.disposers.push(this._enuChangedEvent.addEventListener(function () {
                updateDirections();
            }));
        }
    }, {
        key: '_createCenterModel',
        value: function _createCenterModel() {
            var _this3 = this;

            this._cameraHelper = new _CameraHelper2.default(this._earth);

            this.disposers.push(function () {
                _this3._cameraHelper = _this3._cameraHelper && _this3._cameraHelper.destroy();
            });

            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    position: [].concat((0, _toConsumableArray3.default)(_this3.position)),
                    rotation: [].concat((0, _toConsumableArray3.default)(_this3.rotation))
                };
            }, function () {
                _this3._cameraHelper.position = _this3.position;
                _this3._cameraHelper.rotation = [_this3.rotation[0] + Cesium.Math.PI_OVER_TWO, _this3.rotation[1], _this3.rotation[2]];
            }));

            this.disposers.push((0, _mobx.autorun)(function () {
                _this3._cameraHelper.show = _this3.enabled;
            }));
        }
    }, {
        key: '_createBaseCircles',
        value: function _createBaseCircles() {
            var _this4 = this;

            this._baseCircles = [].concat((0, _toConsumableArray3.default)(Array(3).keys())).map(function (i) {
                return new _Circle2.default(_this4._earth);
            });
            this.disposers.push(function () {
                _this4._baseCircles.forEach(function (c) {
                    c.destroy();
                });
                _this4._baseCircles.length = 0;
            });

            var baseCircleMatrix = [].concat((0, _toConsumableArray3.default)(Array(3).keys())).map(function () {
                return new Cesium.Matrix4();
            });
            var updateCircles = function updateCircles() {
                Cesium.Matrix4.clone(_this4._headingMat4, baseCircleMatrix[0]);
                Cesium.Matrix4.multiply(_this4._pitchMat4, Cesium.Axis.Y_UP_TO_Z_UP, baseCircleMatrix[1]);
                Cesium.Matrix4.multiply(_this4._rollMat4, Cesium.Axis.X_UP_TO_Z_UP, baseCircleMatrix[2]);

                Cesium.Matrix4.toArray(baseCircleMatrix[0], _this4._baseCircles[0].modelMatrix);
                Cesium.Matrix4.toArray(baseCircleMatrix[1], _this4._baseCircles[1].modelMatrix);
                Cesium.Matrix4.toArray(baseCircleMatrix[2], _this4._baseCircles[2].modelMatrix);
            };
            updateCircles();
            this.disposers.push((0, _mobx.reaction)(function () {
                return [].concat((0, _toConsumableArray3.default)(_this4.rotation));
            }, updateCircles));
            this.disposers.push(this._enuChangedEvent.addEventListener(updateCircles));

            this.disposers.push((0, _mobx.autorun)(function () {
                _this4._realSceneScale && _this4._baseCircles.forEach(function (c) {
                    return c.scale = _this4._realSceneScale * 2.0;
                });
            }));

            var colors = [[1, 0, 0, 1], [0, 1, 0, 1], [0, 0, 1, 1]];
            var updateColors = function updateColors(_ref2) {
                var actives = _ref2.actives;

                _this4._baseCircles[0].baseRotation = _this4.isCameraLike ? Math.PI * 0.5 : 0.0;

                _this4._baseCircles.forEach(function (c, i) {
                    // heading 和 roll 需要去负值，通过magic来处理
                    var magic = i % 2 === 0 ? -1 : 1;
                    if (actives[i]) {
                        // console.log('yellow');
                        c.color.splice(0, 4, 1, 1, 0, 1);
                        // c.startRotation = magic * this._startRotation[i];
                        // c.endRotation = magic * this._endRotation[i];

                        var startRotation = magic * _this4._startRotation[i];
                        var endRotation = magic * _this4._endRotation[i];

                        // roll需要特殊处理以下，因为获得的数据差90度
                        if (i === 2) {
                            startRotation += Math.PI * 0.5;
                            endRotation += Math.PI * 0.5;
                        }

                        c.startRotation = startRotation;
                        c.endRotation = endRotation;
                    } else {
                        // console.log(`red ${colors[i].toString()}`);
                        // c.color.splice(0, 4, ...colors[i]);
                        c.color = [].concat((0, _toConsumableArray3.default)(colors[i]));
                        c.startRotation = 0.0;
                        c.endRotation = 0.0;
                    }
                    c.rotation = magic * _this4.rotation[i];
                });
            };

            updateColors({ actives: [this.headingCircleActive, this.pitchCircleActive, this.rollCircleActive] });
            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    actives: [_this4.headingCircleActive, _this4.pitchCircleActive, _this4.rollCircleActive],
                    rotation: [].concat((0, _toConsumableArray3.default)(_this4.rotation)),
                    startRotation: [].concat((0, _toConsumableArray3.default)(_this4._startRotation)),
                    endRotation: [].concat((0, _toConsumableArray3.default)(_this4._endRotation))
                };
            }, updateColors));

            var updateBaseCircles3 = function updateBaseCircles3() {
                if (_this4._baseCircles) {
                    _this4._baseCircles.forEach(function (c) {
                        return c.show = _this4.enabled;
                    });
                }
            };

            updateBaseCircles3();
            this.disposers.push((0, _mobx.reaction)(function () {
                return _this4.enabled;
            }, updateBaseCircles3));
        }
    }, {
        key: '_init',
        value: function _init() {
            var _this5 = this;

            // 放在此处会有问题，_init实在mobx.observe的回调中执行的，会导致_createBaseCircles函数中的reaction调用异常！
            // // 如果放在构造函数中，会导致circle构造出现问题
            // if (!this._baseCircles) {
            //     this._createBaseCircles();
            // }

            var lastMmPositon = { x: 0, y: 0 };
            var eventSource = this._earth.eventSource;
            this.mouseMove$ = this.mouseMove$ || rxjs.merge(eventSource.mouse.mouseMove, eventSource.cameraChanged.pipe(rxjs.operators.throttleTime(100))).pipe(rxjs.operators.map(function (movement) {
                if (movement && movement.endPosition) {
                    lastMmPositon.x = movement.endPosition.x;
                    lastMmPositon.y = movement.endPosition.y;
                    return movement.endPosition;
                } else {
                    return lastMmPositon;
                }
            }));
            this.leftClick$ = this.leftClick$ || eventSource.mouse.leftClick.pipe(rxjs.operators.map(function (movement) {
                return movement.position;
            }));
            this.rightClick$ = this.rightClick$ || eventSource.mouse.rightClick;

            var scene = this._earth.czm.scene;
            this._stepsOp = this._stepsOp || [[this.mouseMove$, function (windowCoordinates) {
                _this5._step1(scene, windowCoordinates);
            }, this.leftClick$, function (windowCoordinates) {
                _this5._step1(scene, windowCoordinates);

                if (_this5.headingCircleActive || _this5.pitchCircleActive || _this5.rollCircleActive) {
                    var _oldRotation;

                    // this.position.forEach((value, index) => this._oldPosition[index] = value);
                    // this._oldScale = this._realSceneScale;

                    (_oldRotation = _this5._oldRotation).splice.apply(_oldRotation, [0, 3].concat((0, _toConsumableArray3.default)(_this5.rotation)));

                    _this5._step2(scene, windowCoordinates); // 执行下，更新下_originPosition2，否则虚线位置不对
                    _this5._steps.next();
                }
            }, this.rightClick$, function () {
                _this5._steps.enabled = false;
            }], [this.mouseMove$, function (windowCoordinates) {
                _this5._step2(scene, windowCoordinates);
            }, this.leftClick$, function (windowCoordinates) {
                _this5._step2(scene, windowCoordinates);

                _this5.headingCircleActive = false;
                _this5.pitchCircleActive = false;
                _this5.rollCircleActive = false;
                _this5._steps.goto(0);
            }, this.rightClick$, function () {
                _this5._steps.enabled = false;
            }]];

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_step2',
        value: function _step2(scene, windowCoordinates) {
            var tolerance = this._realSceneScale / this.fixScreenSize * this.toleranceSize;

            if (this.headingCircleActive) {
                var heading = this._getActiveAngle(scene, windowCoordinates, tolerance, this._headingUp, this._headingDirection, true);

                if (typeof heading !== 'undefined') {
                    this._endRotation[0] = heading;
                    this.rotation[0] = Cesium.Math.negativePiToPi(this._endRotation[0] - this._startRotation[0] + this._oldRotation[0]);
                }
                return;
            }

            if (this.pitchCircleActive) {
                var pitch = this._getActiveAngle(scene, windowCoordinates, tolerance, this._pitchUp, this._pitchDirection, true);

                if (typeof pitch !== 'undefined') {
                    this._endRotation[1] = pitch;
                    this.rotation[1] = Cesium.Math.negativePiToPi(this._endRotation[1] - this._startRotation[1] + this._oldRotation[1]);
                }
                return;
            }

            if (this.rollCircleActive) {
                var roll = this._getActiveAngle(scene, windowCoordinates, tolerance, this._rollUp, this._rollDirection, true);

                if (typeof roll !== 'undefined') {
                    this._endRotation[2] = roll;
                    this.rotation[2] = Cesium.Math.negativePiToPi(this._endRotation[2] - this._startRotation[2] + this._oldRotation[2]);
                }
                return;
            }
        }
    }, {
        key: '_computeAngle',
        value: function _computeAngle(dir1, dir2, up) {
            this._scratchComputeAngleDir1 = this._scratchComputeAngleDir1 || new Cesium.Cartesian3();
            this._scratchComputeAngleDir2 = this._scratchComputeAngleDir2 || new Cesium.Cartesian3();
            this._scrtachComputeAngleUp = this._scrtachComputeAngleUp || new Cesium.Cartesian3();

            dir1 = Cesium.Cartesian3.normalize(dir1, this._scratchComputeAngleDir1);
            dir2 = Cesium.Cartesian3.normalize(dir2, this._scratchComputeAngleDir2);

            var angle = Math.acos(Cesium.Cartesian3.dot(dir1, dir2));
            var up2 = Cesium.Cartesian3.cross(dir1, dir2, this._scrtachComputeAngleUp);
            if (Cesium.Cartesian3.dot(up2, up) < 0) {
                angle = -angle;
            }

            return angle;
        }
    }, {
        key: '_getActiveAngle',
        value: function _getActiveAngle(scene, windowCoordinates, tolerance, up, direction) {
            var ignoreDistance = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;

            this._scratchUpdateActivesCartesian = this._scratchUpdateActivesCartesian || new Cesium.Cartesian3();
            var cartesian = (0, _pickVirtualPlane2.default)(scene, this._centerCartesian, up, windowCoordinates, this._scratchUpdateActivesCartesian);
            if (cartesian) {
                var dir = Cesium.Cartesian3.subtract(cartesian, this._centerCartesian, cartesian);
                if (!ignoreDistance) {
                    var d = Cesium.Cartesian3.magnitude(dir);
                    if (Math.abs(d - this._realSceneScale) < tolerance) {
                        return this._computeAngle(direction, dir, up);
                    }
                } else {
                    return this._computeAngle(direction, dir, up);
                }
            }

            return undefined;
        }
    }, {
        key: '_step1',
        value: function _step1(scene, windowCoordinates) {
            var tolerance = this._realSceneScale / this.fixScreenSize * this.toleranceSize;

            this.headingCircleActive = false;
            this.pitchCircleActive = false;
            this.rollCircleActive = false;

            var heading = this._getActiveAngle(scene, windowCoordinates, tolerance, this._headingUp, this._headingDirection, false);

            if (typeof heading !== 'undefined') {
                this._startRotation[0] = heading;
                this._endRotation[0] = heading;
                this.headingCircleActive = true;

                return;
            }

            var pitch = this._getActiveAngle(scene, windowCoordinates, tolerance, this._pitchUp, this._pitchDirection, false);

            if (typeof pitch !== 'undefined') {
                this._startRotation[1] = pitch;
                this._endRotation[1] = pitch;
                this.pitchCircleActive = true;

                return;
            }

            var roll = this._getActiveAngle(scene, windowCoordinates, tolerance, this._rollUp, this._rollDirection, false);

            if (typeof roll !== 'undefined') {
                this._startRotation[2] = roll;
                this._endRotation[2] = roll;
                this.rollCircleActive = true;

                return;
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this6 = this;

            this._init();
            if (this._stepsDisable) {
                throw new Error('_stepsDisable should not exists!');
            }
            this._stepsDisable = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this6.enabled = false;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._stepsDisable = this._stepsDisable && this._stepsDisable();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(CirclesRotating.prototype.__proto__ || (0, _getPrototypeOf2.default)(CirclesRotating.prototype), 'destroy', this).call(this);
        }
    }]);
    return CirclesRotating;
}(_XbsjEditing3.default);
// import Circle from "../../../../sceneObjects/Circle";


exports.default = CirclesRotating;

/***/ }),
/* 195 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _CoordinatesMoving = __webpack_require__(130);

var _CoordinatesMoving2 = _interopRequireDefault(_CoordinatesMoving);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var HeightEditingBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(HeightEditingBinding, _XbsjInteractionBindi);

    function HeightEditingBinding(earth) {
        (0, _classCallCheck3.default)(this, HeightEditingBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (HeightEditingBinding.__proto__ || (0, _getPrototypeOf2.default)(HeightEditingBinding)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            onlyOnce: true
        });

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._editing = new _CoordinatesMoving2.default(earth);
        _this._editing.xEnabled = false;
        _this._editing.yEnabled = false;
        _this._editing.skipFirstStepForZ = true;
        _this.disposers.push(function () {
            _this._editing = _this._editing && _this._editing.destroy();
        });
        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._editing.onlyOnce = _this.onlyOnce;
        }));
        return _this;
    }

    (0, _createClass3.default)(HeightEditingBinding, [{
        key: '_start',
        value: function _start() {
            var _editing$position,
                _this2 = this;

            var originPosition = [].concat((0, _toConsumableArray3.default)(this.target.position));
            (_editing$position = this._editing.position).splice.apply(_editing$position, [0, 3].concat((0, _toConsumableArray3.default)(this.target.position)));
            var unbind = (0, _bind2.default)(this._editing, 'position', this.target, 'position');
            var diableProperty = _XbsjEditing2.default.enableProperty(this._editing, function () {
                if (!_this2._editing.steps.lastStep) {
                    _this2.onlyOnce && _this2.target.position.splice(0, 3, originPosition);
                }
                _this2.target = undefined;
            });

            this._disableEditing = function () {
                unbind && unbind();
                diableProperty && diableProperty();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableEditing = this._disableEditing && this._disableEditing();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(HeightEditingBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(HeightEditingBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._editing;
        }
    }]);
    return HeightEditingBinding;
}(_XbsjInteractionBinding2.default);

exports.default = HeightEditingBinding;

/***/ }),
/* 196 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _PolylineEditing = __webpack_require__(464);

var _PolylineEditing2 = _interopRequireDefault(_PolylineEditing);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var EditingPolylineBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(EditingPolylineBinding, _XbsjInteractionBindi);

    function EditingPolylineBinding(earth) {
        (0, _classCallCheck3.default)(this, EditingPolylineBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EditingPolylineBinding.__proto__ || (0, _getPrototypeOf2.default)(EditingPolylineBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._editing = new _PolylineEditing2.default(earth);
        _this.disposers.push(function () {
            return _this._editing = _this._editing && _this._editing.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(EditingPolylineBinding, [{
        key: '_start',
        value: function _start() {
            var _this2 = this;

            if (this._disableProperty) {
                throw new Error('_disableProperty should not be defined!');
            }

            var localDisposers = [];

            localDisposers.push((0, _bind2.default)(this._editing, 'positions', this.target, 'positions'));
            this.target.rotations && localDisposers.push((0, _bind2.default)(this._editing, 'rotations', this.target, 'rotations'));
            typeof this.target.isCameraLike !== 'undefined' && (this._editing.isCameraLike = this.target.isCameraLike);
            typeof this.target.onlyMove !== 'undefined' && (this._editing.onlyMove = this.target.onlyMove);
            typeof this.target.loop !== 'undefined' && localDisposers.push((0, _bind2.default)(this._editing, 'loop', this.target, 'loop')) || (this._editing.loop = false);
            typeof this.target.editingPolylineShow !== 'undefined' && localDisposers.push((0, _bind2.default)(this._editing, 'polylineShow', this.target, 'editingPolylineShow')) || (this._editing.polylineShow = true);
            localDisposers.push(_XbsjEditing2.default.enableProperty(this._editing, function () {
                return _this2.target = undefined;
            }));
            localDisposers.reverse();

            this._disableProperty = function () {
                localDisposers.forEach(function (d) {
                    return d();
                });
                localDisposers.length = 0;
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableProperty = this._disableProperty && this._disableProperty();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(EditingPolylineBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(EditingPolylineBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._editing;
        }
    }]);
    return EditingPolylineBinding;
}(_XbsjInteractionBinding2.default);

exports.default = EditingPolylineBinding;

/***/ }),
/* 197 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
function registerObject(earth, guid, attachFunc, detachFunc) {
    var attachedObj = undefined;
    var delayAttach = undefined;
    if (earth._xbsjObjectsMap.has(guid)) {
        attachedObj = earth._xbsjObjectsMap.get(guid);
        attachFunc(attachedObj);
    }

    var disposer = earth.czmObjectOpsEvent.addEventListener(function (_ref) {
        var type = _ref.type,
            xbsjObj = _ref.xbsjObj;

        if (xbsjObj.guid === guid) {
            if (type === 'create') {
                if (attachedObj) {
                    throw new Error('已经绑定过了！');
                }
                // 这里如果直接attachFunc的话，这个对象还没有完全创建完成。
                // 通过setTimeout的目的是让当前对象创建完成之后再做attachFunc操作
                // 否则会导致对于该对象的属性获取等失效
                delayAttach = setTimeout(function () {
                    attachedObj = xbsjObj;
                    attachedObj && attachFunc(attachedObj);
                    delayAttach = undefined;
                }, 0);
            } else if (type === 'destroy') {
                // 保持attachFunc以后才可以调用detachFunc，避免调用了detachFunc，反而attachFunc没有调用的情况
                attachedObj && detachFunc(attachedObj);
                if (delayAttach) {
                    clearTimeout(delayAttach);
                    delayAttach = undefined;
                }
                attachedObj = undefined;
            }
        }
    });

    return function unregister() {
        attachedObj && detachFunc(attachedObj);
        disposer();
    };
}

exports.default = registerObject;

/***/ }),
/* 198 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.VERSION = exports.copyright = undefined;

var _copyright = __webpack_require__(199);

var _copyright2 = _interopRequireDefault(_copyright);

var _sceneObjects = __webpack_require__(200);

var _sceneObjects2 = _interopRequireDefault(_sceneObjects);

var _Earth = __webpack_require__(377);

var _Earth2 = _interopRequireDefault(_Earth);

var _SceneTree = __webpack_require__(172);

var _SceneTree2 = _interopRequireDefault(_SceneTree);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _ready = __webpack_require__(518);

var _ready2 = _interopRequireDefault(_ready);

var _MVVM = __webpack_require__(519);

var _MVVM2 = _interopRequireDefault(_MVVM);

var _utils = __webpack_require__(80);

var _utils2 = _interopRequireDefault(_utils);

var _XbsjPool = __webpack_require__(523);

var _XbsjPool2 = _interopRequireDefault(_XbsjPool);

var _core = __webpack_require__(524);

var _core2 = _interopRequireDefault(_core);

var _mixins = __webpack_require__(525);

var _mixins2 = _interopRequireDefault(_mixins);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

function isReady() {
  return !!_ready2.default.isReady;
}

var VERSION = "1.3.3";

var pool = new _XbsjPool2.default(); // pool是全局的！

/**
 * @namespace
 */
var XE = {
  copyright: _copyright2.default,
  /**
   * 版本信息
   */
  get VERSION() {
    _copyright2.default._printVersion();
    return VERSION;
  },
  /**
   * Earth地球类，通过此类来创建场景
   * @type {Earth}
   */
  Earth: _Earth2.default,
  /**
   * CzmObject对象
   * @type {Obj}
   */
  Obj: _sceneObjects2.default,
  /**
   * 核心类
   * @ignore
   */
  Core: _core2.default,
  /**
   * 场景树
   * @type {SceneTree}
   */
  SceneTree: _SceneTree2.default,
  /**
   * 工具类
   * @ignore
   */
  Tool: _utils2.default,
  /**
   * 和HTML操作有关的工具集合
   * @type {HTML}
   */
  HTML: _HTML2.default,
  /**
   * 和响应式属性相关的工具集合
   * @type {MVVM}
   */
  MVVM: _MVVM2.default,
  ready: _ready2.default,
  isReady: isReady,
  pool: pool,
  /**
   * 只是当前选中的场景树节点上的对象，仅用于调试，仅限视景器中使用！ XE.cso === XE.csn.czmObject
   */
  cso: undefined, // 当前选中的对象，用于调试
  /**
   * 只是当前选中的场景树节点，仅用于调试，仅限视景器中使用！
   */
  csn: undefined, // 当前选中的对象，用于调试
  mixins: _mixins2.default
};

window.XE = window.XE || XE;

exports.copyright = _copyright2.default;
exports.VERSION = VERSION;

/***/ }),
/* 199 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
	value: true
});
var xbsjDebug = ~window.location.search.substring(1).indexOf('xbsjDebug');

if (!xbsjDebug) {
	console.clear();
}

var xbsjA = '\u7248\u6743\u58F0\u660E\uFF1A\n1. EarthSDK\u7248\u6743\u5B8C\u5168\u5C5E\u4E8E\u5317\u4EAC\u897F\u90E8\u4E16\u754C\u79D1\u6280\u6709\u9650\u516C\u53F8\u3002\n2. EarthSDK\u4E2DXbsjEarthUI.js\u4E3AMIT\u514D\u8D39\u5F00\u6E90\u9879\u76EE\uFF08github,gitee\u4E0A\u641C\uFF09\uFF0C\u4EFB\u4F55\u4E2A\u4EBA\u548C\u673A\u6784\u53EF\u4EE5\u4FEE\u6539\uFF0C\u91CD\u6784\uFF0C\u65E0\u9700\u7ECF\u8FC7\u6211\u65B9\u6388\u6743\u3002\n3. EarthSDK\u4E2DXbsjCesium.js,XbsjEarth.js\u7A0B\u5E8F\u5305\uFF0C\u4EFB\u4F55\u4E2A\u4EBA\u548C\u673A\u6784\u5728\u9075\u5B88\u4E0B\u5217\u6761\u4EF6\u7684\u524D\u63D0\u4E0B\u53EF\u4EE5\u6C38\u4E45\u514D\u8D39\u4F7F\u7528\uFF1A\n1\uFF09\u4E0D\u8FDB\u884C\u4EFB\u4F55\u5F62\u5F0F\u7684\u7834\u89E3\u548C\u88C1\u526A\uFF0C\u7A0B\u5E8F\u5305\u5B8C\u6574\u5F15\u7528\n2\uFF09\u4FDD\u7559\u6B64\u7248\u6743\u4FE1\u606F\u5728\u63A7\u5236\u53F0\u8F93\u51FA\n\u6211\u4EEC\u4FDD\u7559\u5BF9\u6B64\u7248\u6743\u4FE1\u606F\u7684\u6700\u7EC8\u89E3\u91CA\u6743\n';

function printVersion() {
	console.log('%c\uD83C\uDF0F%c\n    EarthSDK %c\n\u6211\u613F\u4E0E\u4F60\u540C\u884C\uFF0C\u56E0\u4F60\u52BF\u4E0D\u53EF\u6321\uFF01%c\n\n\u7248\u672C\u53F7\uFF1A' + "1.3.3" + '\n\u7F16\u8BD1\u65E5\u671F\uFF1A' + "2020-3-31 16:39:53" + '\n\u6388\u6743\u4FE1\u606F\uFF1A\u6388\u6743' + "-" + '\u6C38\u4E45\u4F7F\u7528\u6B64\u8F6F\u4EF6\u5F53\u524D\u7248\u672C\u3002\n\u9650\u5236\u7F51\u5740\uFF1A' + "-".split('/').join(' ') + '\n\nCesium\u5B9E\u9A8C\u5BA4-\u7FA4\uFF1A595512567(\u5DF2\u6EE1)\nCesium\u5B9E\u9A8C\u5BA4-2\u7FA4\uFF1A830157717 \uD83D\uDE0A\n\u624B\u673A\u53F7: 18910418067 \n\u5FAE\u4FE1: cloudmap \nEarthSDK\u7F51\u5740: www.earthsdk.com \uD83C\uDFC4\u200D\nCesiumLab\u7F51\u5740: www.cesiumlab.com \uD83C\uDFC4\u200D\n\u7248\u6743\u6240\u6709 @2019 \u5317\u4EAC\u897F\u90E8\u4E16\u754C\u79D1\u6280\u6709\u9650\u516C\u53F8\nCopyright @2019 Beijing Xibushijie Co.,Ltd.\n\n' + xbsjA + '\n', '\n\tfont-size: 100px;\n\tpadding-left: 20px;\n', '\n\tfont-size: 25px;\n\tline-height: 1.5;\n\tfont-weight: 1000;\n\tfont-family: "\u5FAE\u8F6F\u96C5\u9ED1";\n\tcolor: rgb(0, 120, 215);\n', '\n\tfont-size: 14px;\n\tline-height: 1.5;\n\tfont-family: "\u5FAE\u8F6F\u96C5\u9ED1";\n\tfont-style: italic;\n\tcolor: rgb(0, 120, 215);\n\tpadding-bottom: 20px;\n', '\n\tfont-size: 12px;\n\tline-height: 1.5;\n\tfont-family: "\u5FAE\u8F6F\u96C5\u9ED1";\n\tcolor: rgb(0, 120, 215);\n\t');
}

printVersion();

var copyright = {
	source: '北京数字冰雹信息技术有限公司',
	dest: "-",
	restrict: "-".split('/').join(' '),
	info: "\n------------------------------------------\n\nhttps://www.digihail.com/\n\n版本日期：2020-3-31 16:39:53\n授权使用：-\n网址限制：-\n\nCopyright @2019 Beijing Digihail Co.,Ltd.\n版权所有 @2019 北京数字冰雹信息技术有限公司\n\n-------------------------------------------\n",
	date: "2020-3-31 16:39:53",
	_printVersion: printVersion
};

exports.default = copyright;

/***/ }),
/* 200 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _Tileset = __webpack_require__(91);

var _Tileset2 = _interopRequireDefault(_Tileset);

var _Terrain = __webpack_require__(283);

var _Terrain2 = _interopRequireDefault(_Terrain);

var _Imagery = __webpack_require__(287);

var _Imagery2 = _interopRequireDefault(_Imagery);

var _Model = __webpack_require__(298);

var _Model2 = _interopRequireDefault(_Model);

var _CameraVideo = __webpack_require__(310);

var _CameraVideo2 = _interopRequireDefault(_CameraVideo);

var _Viewshed = __webpack_require__(311);

var _Viewshed2 = _interopRequireDefault(_Viewshed);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _Path = __webpack_require__(312);

var _Path2 = _interopRequireDefault(_Path);

var _Pin = __webpack_require__(313);

var _Pin2 = _interopRequireDefault(_Pin);

var _ODLines = __webpack_require__(315);

var _ODLines2 = _interopRequireDefault(_ODLines);

var _Scanline = __webpack_require__(316);

var _Scanline2 = _interopRequireDefault(_Scanline);

var _FlattenedPolygonCollection = __webpack_require__(149);

var _FlattenedPolygonCollection2 = _interopRequireDefault(_FlattenedPolygonCollection);

var _ClippingPlane = __webpack_require__(148);

var _ClippingPlane2 = _interopRequireDefault(_ClippingPlane);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _PlotBase = __webpack_require__(113);

var _PlotBase2 = _interopRequireDefault(_PlotBase);

var _Coordinates = __webpack_require__(164);

var _Coordinates2 = _interopRequireDefault(_Coordinates);

var _Circle = __webpack_require__(317);

var _Circle2 = _interopRequireDefault(_Circle);

var _Cylinder = __webpack_require__(318);

var _Cylinder2 = _interopRequireDefault(_Cylinder);

var _GroundImage = __webpack_require__(319);

var _GroundImage2 = _interopRequireDefault(_GroundImage);

var _Water = __webpack_require__(320);

var _Water2 = _interopRequireDefault(_Water);

var _CustomPrimitive = __webpack_require__(83);

var _CustomPrimitive2 = _interopRequireDefault(_CustomPrimitive);

var _CustomGroundRectangle = __webpack_require__(326);

var _CustomGroundRectangle2 = _interopRequireDefault(_CustomGroundRectangle);

var _HeatMap = __webpack_require__(327);

var _HeatMap2 = _interopRequireDefault(_HeatMap);

var _Forest = __webpack_require__(329);

var _Forest2 = _interopRequireDefault(_Forest);

var _DynamicPois = __webpack_require__(343);

var _DynamicPois2 = _interopRequireDefault(_DynamicPois);

var _Road = __webpack_require__(358);

var _Road2 = _interopRequireDefault(_Road);

var _Wall = __webpack_require__(359);

var _Wall2 = _interopRequireDefault(_Wall);

var _ClassificationPolygon = __webpack_require__(362);

var _ClassificationPolygon2 = _interopRequireDefault(_ClassificationPolygon);

var _Surface = __webpack_require__(170);

var _Surface2 = _interopRequireDefault(_Surface);

var _CutSurface = __webpack_require__(375);

var _CutSurface2 = _interopRequireDefault(_CutSurface);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * @description Obj命名空间 场景对象集合
 * @namespace
 */
var Obj = {
    Tileset: _Tileset2.default,
    Terrain: _Terrain2.default,
    Imagery: _Imagery2.default,
    Model: _Model2.default,
    CameraVideo: _CameraVideo2.default,
    Viewshed: _Viewshed2.default,
    Polygon: _Polygon2.default,
    Polyline: _Polyline2.default,
    Path: _Path2.default,
    Pin: _Pin2.default,
    ODLines: _ODLines2.default,
    Scanline: _Scanline2.default,
    FlattenedPolygonCollection: _FlattenedPolygonCollection2.default,
    ClippingPlane: _ClippingPlane2.default,
    Points: _Points2.default,
    Coordinates: _Coordinates2.default,
    Circle: _Circle2.default,
    Cylinder: _Cylinder2.default,
    PlotBase: _PlotBase2.default,
    GroundImage: _GroundImage2.default,
    Water: _Water2.default,
    CustomPrimitive: _CustomPrimitive2.default,
    CustomGroundRectangle: _CustomGroundRectangle2.default,
    HeatMap: _HeatMap2.default,
    Forest: _Forest2.default,
    DynamicPois: _DynamicPois2.default,
    Road: _Road2.default,
    Wall: _Wall2.default,
    ClassificationPolygon: _ClassificationPolygon2.default,
    Surface: _Surface2.default,
    CutSurface: _CutSurface2.default
};

exports.default = Obj;

/***/ }),
/* 201 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(202), __esModule: true };

/***/ }),
/* 202 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(46);
__webpack_require__(207);
module.exports = __webpack_require__(14).Array.from;


/***/ }),
/* 203 */
/***/ (function(module, exports, __webpack_require__) {

var toInteger = __webpack_require__(92);
var defined = __webpack_require__(93);
// true  -> String#at
// false -> String#codePointAt
module.exports = function (TO_STRING) {
  return function (that, pos) {
    var s = String(defined(that));
    var i = toInteger(pos);
    var l = s.length;
    var a, b;
    if (i < 0 || i >= l) return TO_STRING ? '' : undefined;
    a = s.charCodeAt(i);
    return a < 0xd800 || a > 0xdbff || i + 1 === l || (b = s.charCodeAt(i + 1)) < 0xdc00 || b > 0xdfff
      ? TO_STRING ? s.charAt(i) : a
      : TO_STRING ? s.slice(i, i + 2) : (a - 0xd800 << 10) + (b - 0xdc00) + 0x10000;
  };
};


/***/ }),
/* 204 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var create = __webpack_require__(70);
var descriptor = __webpack_require__(58);
var setToStringTag = __webpack_require__(60);
var IteratorPrototype = {};

// 25.1.2.1.1 %IteratorPrototype%[@@iterator]()
__webpack_require__(34)(IteratorPrototype, __webpack_require__(18)('iterator'), function () { return this; });

module.exports = function (Constructor, NAME, next) {
  Constructor.prototype = create(IteratorPrototype, { next: descriptor(1, next) });
  setToStringTag(Constructor, NAME + ' Iterator');
};


/***/ }),
/* 205 */
/***/ (function(module, exports, __webpack_require__) {

// false -> Array#indexOf
// true  -> Array#includes
var toIObject = __webpack_require__(35);
var toLength = __webpack_require__(71);
var toAbsoluteIndex = __webpack_require__(206);
module.exports = function (IS_INCLUDES) {
  return function ($this, el, fromIndex) {
    var O = toIObject($this);
    var length = toLength(O.length);
    var index = toAbsoluteIndex(fromIndex, length);
    var value;
    // Array#includes uses SameValueZero equality algorithm
    // eslint-disable-next-line no-self-compare
    if (IS_INCLUDES && el != el) while (length > index) {
      value = O[index++];
      // eslint-disable-next-line no-self-compare
      if (value != value) return true;
    // Array#indexOf ignores holes, Array#includes - not
    } else for (;length > index; index++) if (IS_INCLUDES || index in O) {
      if (O[index] === el) return IS_INCLUDES || index || 0;
    } return !IS_INCLUDES && -1;
  };
};


/***/ }),
/* 206 */
/***/ (function(module, exports, __webpack_require__) {

var toInteger = __webpack_require__(92);
var max = Math.max;
var min = Math.min;
module.exports = function (index, length) {
  index = toInteger(index);
  return index < 0 ? max(index + length, 0) : min(index, length);
};


/***/ }),
/* 207 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var ctx = __webpack_require__(32);
var $export = __webpack_require__(16);
var toObject = __webpack_require__(41);
var call = __webpack_require__(140);
var isArrayIter = __webpack_require__(141);
var toLength = __webpack_require__(71);
var createProperty = __webpack_require__(208);
var getIterFn = __webpack_require__(101);

$export($export.S + $export.F * !__webpack_require__(142)(function (iter) { Array.from(iter); }), 'Array', {
  // 22.1.2.1 Array.from(arrayLike, mapfn = undefined, thisArg = undefined)
  from: function from(arrayLike /* , mapfn = undefined, thisArg = undefined */) {
    var O = toObject(arrayLike);
    var C = typeof this == 'function' ? this : Array;
    var aLen = arguments.length;
    var mapfn = aLen > 1 ? arguments[1] : undefined;
    var mapping = mapfn !== undefined;
    var index = 0;
    var iterFn = getIterFn(O);
    var length, result, step, iterator;
    if (mapping) mapfn = ctx(mapfn, aLen > 2 ? arguments[2] : undefined, 2);
    // if object isn't iterable or it's array with default iterator - use simple case
    if (iterFn != undefined && !(C == Array && isArrayIter(iterFn))) {
      for (iterator = iterFn.call(O), result = new C(); !(step = iterator.next()).done; index++) {
        createProperty(result, index, mapping ? call(iterator, mapfn, [step.value, index], true) : step.value);
      }
    } else {
      length = toLength(O.length);
      for (result = new C(length); length > index; index++) {
        createProperty(result, index, mapping ? mapfn(O[index], index) : O[index]);
      }
    }
    result.length = index;
    return result;
  }
});


/***/ }),
/* 208 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var $defineProperty = __webpack_require__(27);
var createDesc = __webpack_require__(58);

module.exports = function (object, index, value) {
  if (index in object) $defineProperty.f(object, index, createDesc(0, value));
  else object[index] = value;
};


/***/ }),
/* 209 */
/***/ (function(module, exports, __webpack_require__) {

var core = __webpack_require__(14);
var $JSON = core.JSON || (core.JSON = { stringify: JSON.stringify });
module.exports = function stringify(it) { // eslint-disable-line no-unused-vars
  return $JSON.stringify.apply($JSON, arguments);
};


/***/ }),
/* 210 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(211);
module.exports = __webpack_require__(14).Object.getPrototypeOf;


/***/ }),
/* 211 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.9 Object.getPrototypeOf(O)
var toObject = __webpack_require__(41);
var $getPrototypeOf = __webpack_require__(139);

__webpack_require__(74)('getPrototypeOf', function () {
  return function getPrototypeOf(it) {
    return $getPrototypeOf(toObject(it));
  };
});


/***/ }),
/* 212 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(213);
var $Object = __webpack_require__(14).Object;
module.exports = function defineProperty(it, key, desc) {
  return $Object.defineProperty(it, key, desc);
};


/***/ }),
/* 213 */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(16);
// 19.1.2.4 / 15.2.3.6 Object.defineProperty(O, P, Attributes)
$export($export.S + $export.F * !__webpack_require__(23), 'Object', { defineProperty: __webpack_require__(27).f });


/***/ }),
/* 214 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(46);
__webpack_require__(61);
module.exports = __webpack_require__(102).f('iterator');


/***/ }),
/* 215 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var addToUnscopables = __webpack_require__(216);
var step = __webpack_require__(144);
var Iterators = __webpack_require__(47);
var toIObject = __webpack_require__(35);

// 22.1.3.4 Array.prototype.entries()
// 22.1.3.13 Array.prototype.keys()
// 22.1.3.29 Array.prototype.values()
// 22.1.3.30 Array.prototype[@@iterator]()
module.exports = __webpack_require__(94)(Array, 'Array', function (iterated, kind) {
  this._t = toIObject(iterated); // target
  this._i = 0;                   // next index
  this._k = kind;                // kind
// 22.1.5.2.1 %ArrayIteratorPrototype%.next()
}, function () {
  var O = this._t;
  var kind = this._k;
  var index = this._i++;
  if (!O || index >= O.length) {
    this._t = undefined;
    return step(1);
  }
  if (kind == 'keys') return step(0, index);
  if (kind == 'values') return step(0, O[index]);
  return step(0, [index, O[index]]);
}, 'values');

// argumentsList[@@iterator] is %ArrayProto_values% (9.4.4.6, 9.4.4.7)
Iterators.Arguments = Iterators.Array;

addToUnscopables('keys');
addToUnscopables('values');
addToUnscopables('entries');


/***/ }),
/* 216 */
/***/ (function(module, exports) {

module.exports = function () { /* empty */ };


/***/ }),
/* 217 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(218), __esModule: true };

/***/ }),
/* 218 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(219);
__webpack_require__(106);
__webpack_require__(222);
__webpack_require__(223);
module.exports = __webpack_require__(14).Symbol;


/***/ }),
/* 219 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// ECMAScript 6 symbols shim
var global = __webpack_require__(17);
var has = __webpack_require__(40);
var DESCRIPTORS = __webpack_require__(23);
var $export = __webpack_require__(16);
var redefine = __webpack_require__(135);
var META = __webpack_require__(75).KEY;
var $fails = __webpack_require__(39);
var shared = __webpack_require__(99);
var setToStringTag = __webpack_require__(60);
var uid = __webpack_require__(72);
var wks = __webpack_require__(18);
var wksExt = __webpack_require__(102);
var wksDefine = __webpack_require__(103);
var enumKeys = __webpack_require__(220);
var isArray = __webpack_require__(145);
var anObject = __webpack_require__(30);
var isObject = __webpack_require__(25);
var toObject = __webpack_require__(41);
var toIObject = __webpack_require__(35);
var toPrimitive = __webpack_require__(96);
var createDesc = __webpack_require__(58);
var _create = __webpack_require__(70);
var gOPNExt = __webpack_require__(221);
var $GOPD = __webpack_require__(105);
var $GOPS = __webpack_require__(104);
var $DP = __webpack_require__(27);
var $keys = __webpack_require__(48);
var gOPD = $GOPD.f;
var dP = $DP.f;
var gOPN = gOPNExt.f;
var $Symbol = global.Symbol;
var $JSON = global.JSON;
var _stringify = $JSON && $JSON.stringify;
var PROTOTYPE = 'prototype';
var HIDDEN = wks('_hidden');
var TO_PRIMITIVE = wks('toPrimitive');
var isEnum = {}.propertyIsEnumerable;
var SymbolRegistry = shared('symbol-registry');
var AllSymbols = shared('symbols');
var OPSymbols = shared('op-symbols');
var ObjectProto = Object[PROTOTYPE];
var USE_NATIVE = typeof $Symbol == 'function' && !!$GOPS.f;
var QObject = global.QObject;
// Don't use setters in Qt Script, https://github.com/zloirock/core-js/issues/173
var setter = !QObject || !QObject[PROTOTYPE] || !QObject[PROTOTYPE].findChild;

// fallback for old Android, https://code.google.com/p/v8/issues/detail?id=687
var setSymbolDesc = DESCRIPTORS && $fails(function () {
  return _create(dP({}, 'a', {
    get: function () { return dP(this, 'a', { value: 7 }).a; }
  })).a != 7;
}) ? function (it, key, D) {
  var protoDesc = gOPD(ObjectProto, key);
  if (protoDesc) delete ObjectProto[key];
  dP(it, key, D);
  if (protoDesc && it !== ObjectProto) dP(ObjectProto, key, protoDesc);
} : dP;

var wrap = function (tag) {
  var sym = AllSymbols[tag] = _create($Symbol[PROTOTYPE]);
  sym._k = tag;
  return sym;
};

var isSymbol = USE_NATIVE && typeof $Symbol.iterator == 'symbol' ? function (it) {
  return typeof it == 'symbol';
} : function (it) {
  return it instanceof $Symbol;
};

var $defineProperty = function defineProperty(it, key, D) {
  if (it === ObjectProto) $defineProperty(OPSymbols, key, D);
  anObject(it);
  key = toPrimitive(key, true);
  anObject(D);
  if (has(AllSymbols, key)) {
    if (!D.enumerable) {
      if (!has(it, HIDDEN)) dP(it, HIDDEN, createDesc(1, {}));
      it[HIDDEN][key] = true;
    } else {
      if (has(it, HIDDEN) && it[HIDDEN][key]) it[HIDDEN][key] = false;
      D = _create(D, { enumerable: createDesc(0, false) });
    } return setSymbolDesc(it, key, D);
  } return dP(it, key, D);
};
var $defineProperties = function defineProperties(it, P) {
  anObject(it);
  var keys = enumKeys(P = toIObject(P));
  var i = 0;
  var l = keys.length;
  var key;
  while (l > i) $defineProperty(it, key = keys[i++], P[key]);
  return it;
};
var $create = function create(it, P) {
  return P === undefined ? _create(it) : $defineProperties(_create(it), P);
};
var $propertyIsEnumerable = function propertyIsEnumerable(key) {
  var E = isEnum.call(this, key = toPrimitive(key, true));
  if (this === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return false;
  return E || !has(this, key) || !has(AllSymbols, key) || has(this, HIDDEN) && this[HIDDEN][key] ? E : true;
};
var $getOwnPropertyDescriptor = function getOwnPropertyDescriptor(it, key) {
  it = toIObject(it);
  key = toPrimitive(key, true);
  if (it === ObjectProto && has(AllSymbols, key) && !has(OPSymbols, key)) return;
  var D = gOPD(it, key);
  if (D && has(AllSymbols, key) && !(has(it, HIDDEN) && it[HIDDEN][key])) D.enumerable = true;
  return D;
};
var $getOwnPropertyNames = function getOwnPropertyNames(it) {
  var names = gOPN(toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (!has(AllSymbols, key = names[i++]) && key != HIDDEN && key != META) result.push(key);
  } return result;
};
var $getOwnPropertySymbols = function getOwnPropertySymbols(it) {
  var IS_OP = it === ObjectProto;
  var names = gOPN(IS_OP ? OPSymbols : toIObject(it));
  var result = [];
  var i = 0;
  var key;
  while (names.length > i) {
    if (has(AllSymbols, key = names[i++]) && (IS_OP ? has(ObjectProto, key) : true)) result.push(AllSymbols[key]);
  } return result;
};

// 19.4.1.1 Symbol([description])
if (!USE_NATIVE) {
  $Symbol = function Symbol() {
    if (this instanceof $Symbol) throw TypeError('Symbol is not a constructor!');
    var tag = uid(arguments.length > 0 ? arguments[0] : undefined);
    var $set = function (value) {
      if (this === ObjectProto) $set.call(OPSymbols, value);
      if (has(this, HIDDEN) && has(this[HIDDEN], tag)) this[HIDDEN][tag] = false;
      setSymbolDesc(this, tag, createDesc(1, value));
    };
    if (DESCRIPTORS && setter) setSymbolDesc(ObjectProto, tag, { configurable: true, set: $set });
    return wrap(tag);
  };
  redefine($Symbol[PROTOTYPE], 'toString', function toString() {
    return this._k;
  });

  $GOPD.f = $getOwnPropertyDescriptor;
  $DP.f = $defineProperty;
  __webpack_require__(146).f = gOPNExt.f = $getOwnPropertyNames;
  __webpack_require__(62).f = $propertyIsEnumerable;
  $GOPS.f = $getOwnPropertySymbols;

  if (DESCRIPTORS && !__webpack_require__(56)) {
    redefine(ObjectProto, 'propertyIsEnumerable', $propertyIsEnumerable, true);
  }

  wksExt.f = function (name) {
    return wrap(wks(name));
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Symbol: $Symbol });

for (var es6Symbols = (
  // 19.4.2.2, 19.4.2.3, 19.4.2.4, 19.4.2.6, 19.4.2.8, 19.4.2.9, 19.4.2.10, 19.4.2.11, 19.4.2.12, 19.4.2.13, 19.4.2.14
  'hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables'
).split(','), j = 0; es6Symbols.length > j;)wks(es6Symbols[j++]);

for (var wellKnownSymbols = $keys(wks.store), k = 0; wellKnownSymbols.length > k;) wksDefine(wellKnownSymbols[k++]);

$export($export.S + $export.F * !USE_NATIVE, 'Symbol', {
  // 19.4.2.1 Symbol.for(key)
  'for': function (key) {
    return has(SymbolRegistry, key += '')
      ? SymbolRegistry[key]
      : SymbolRegistry[key] = $Symbol(key);
  },
  // 19.4.2.5 Symbol.keyFor(sym)
  keyFor: function keyFor(sym) {
    if (!isSymbol(sym)) throw TypeError(sym + ' is not a symbol!');
    for (var key in SymbolRegistry) if (SymbolRegistry[key] === sym) return key;
  },
  useSetter: function () { setter = true; },
  useSimple: function () { setter = false; }
});

$export($export.S + $export.F * !USE_NATIVE, 'Object', {
  // 19.1.2.2 Object.create(O [, Properties])
  create: $create,
  // 19.1.2.4 Object.defineProperty(O, P, Attributes)
  defineProperty: $defineProperty,
  // 19.1.2.3 Object.defineProperties(O, Properties)
  defineProperties: $defineProperties,
  // 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
  getOwnPropertyDescriptor: $getOwnPropertyDescriptor,
  // 19.1.2.7 Object.getOwnPropertyNames(O)
  getOwnPropertyNames: $getOwnPropertyNames,
  // 19.1.2.8 Object.getOwnPropertySymbols(O)
  getOwnPropertySymbols: $getOwnPropertySymbols
});

// Chrome 38 and 39 `Object.getOwnPropertySymbols` fails on primitives
// https://bugs.chromium.org/p/v8/issues/detail?id=3443
var FAILS_ON_PRIMITIVES = $fails(function () { $GOPS.f(1); });

$export($export.S + $export.F * FAILS_ON_PRIMITIVES, 'Object', {
  getOwnPropertySymbols: function getOwnPropertySymbols(it) {
    return $GOPS.f(toObject(it));
  }
});

// 24.3.2 JSON.stringify(value [, replacer [, space]])
$JSON && $export($export.S + $export.F * (!USE_NATIVE || $fails(function () {
  var S = $Symbol();
  // MS Edge converts symbol values to JSON as {}
  // WebKit converts symbol values to JSON as null
  // V8 throws on boxed symbols
  return _stringify([S]) != '[null]' || _stringify({ a: S }) != '{}' || _stringify(Object(S)) != '{}';
})), 'JSON', {
  stringify: function stringify(it) {
    var args = [it];
    var i = 1;
    var replacer, $replacer;
    while (arguments.length > i) args.push(arguments[i++]);
    $replacer = replacer = args[1];
    if (!isObject(replacer) && it === undefined || isSymbol(it)) return; // IE8 returns string on undefined
    if (!isArray(replacer)) replacer = function (key, value) {
      if (typeof $replacer == 'function') value = $replacer.call(this, key, value);
      if (!isSymbol(value)) return value;
    };
    args[1] = replacer;
    return _stringify.apply($JSON, args);
  }
});

// 19.4.3.4 Symbol.prototype[@@toPrimitive](hint)
$Symbol[PROTOTYPE][TO_PRIMITIVE] || __webpack_require__(34)($Symbol[PROTOTYPE], TO_PRIMITIVE, $Symbol[PROTOTYPE].valueOf);
// 19.4.3.5 Symbol.prototype[@@toStringTag]
setToStringTag($Symbol, 'Symbol');
// 20.2.1.9 Math[@@toStringTag]
setToStringTag(Math, 'Math', true);
// 24.3.3 JSON[@@toStringTag]
setToStringTag(global.JSON, 'JSON', true);


/***/ }),
/* 220 */
/***/ (function(module, exports, __webpack_require__) {

// all enumerable object keys, includes symbols
var getKeys = __webpack_require__(48);
var gOPS = __webpack_require__(104);
var pIE = __webpack_require__(62);
module.exports = function (it) {
  var result = getKeys(it);
  var getSymbols = gOPS.f;
  if (getSymbols) {
    var symbols = getSymbols(it);
    var isEnum = pIE.f;
    var i = 0;
    var key;
    while (symbols.length > i) if (isEnum.call(it, key = symbols[i++])) result.push(key);
  } return result;
};


/***/ }),
/* 221 */
/***/ (function(module, exports, __webpack_require__) {

// fallback for IE11 buggy Object.getOwnPropertyNames with iframe and window
var toIObject = __webpack_require__(35);
var gOPN = __webpack_require__(146).f;
var toString = {}.toString;

var windowNames = typeof window == 'object' && window && Object.getOwnPropertyNames
  ? Object.getOwnPropertyNames(window) : [];

var getWindowNames = function (it) {
  try {
    return gOPN(it);
  } catch (e) {
    return windowNames.slice();
  }
};

module.exports.f = function getOwnPropertyNames(it) {
  return windowNames && toString.call(it) == '[object Window]' ? getWindowNames(it) : gOPN(toIObject(it));
};


/***/ }),
/* 222 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(103)('asyncIterator');


/***/ }),
/* 223 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(103)('observable');


/***/ }),
/* 224 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(225), __esModule: true };

/***/ }),
/* 225 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(226);
var $Object = __webpack_require__(14).Object;
module.exports = function getOwnPropertyDescriptor(it, key) {
  return $Object.getOwnPropertyDescriptor(it, key);
};


/***/ }),
/* 226 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.6 Object.getOwnPropertyDescriptor(O, P)
var toIObject = __webpack_require__(35);
var $getOwnPropertyDescriptor = __webpack_require__(105).f;

__webpack_require__(74)('getOwnPropertyDescriptor', function () {
  return function getOwnPropertyDescriptor(it, key) {
    return $getOwnPropertyDescriptor(toIObject(it), key);
  };
});


/***/ }),
/* 227 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(228), __esModule: true };

/***/ }),
/* 228 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(229);
module.exports = __webpack_require__(14).Object.setPrototypeOf;


/***/ }),
/* 229 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.3.19 Object.setPrototypeOf(O, proto)
var $export = __webpack_require__(16);
$export($export.S, 'Object', { setPrototypeOf: __webpack_require__(230).set });


/***/ }),
/* 230 */
/***/ (function(module, exports, __webpack_require__) {

// Works with __proto__ only. Old v8 can't work with null proto objects.
/* eslint-disable no-proto */
var isObject = __webpack_require__(25);
var anObject = __webpack_require__(30);
var check = function (O, proto) {
  anObject(O);
  if (!isObject(proto) && proto !== null) throw TypeError(proto + ": can't set as prototype!");
};
module.exports = {
  set: Object.setPrototypeOf || ('__proto__' in {} ? // eslint-disable-line
    function (test, buggy, set) {
      try {
        set = __webpack_require__(32)(Function.call, __webpack_require__(105).f(Object.prototype, '__proto__').set, 2);
        set(test, []);
        buggy = !(test instanceof Array);
      } catch (e) { buggy = true; }
      return function setPrototypeOf(O, proto) {
        check(O, proto);
        if (buggy) O.__proto__ = proto;
        else set(O, proto);
        return O;
      };
    }({}, false) : undefined),
  check: check
};


/***/ }),
/* 231 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(232), __esModule: true };

/***/ }),
/* 232 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(233);
var $Object = __webpack_require__(14).Object;
module.exports = function create(P, D) {
  return $Object.create(P, D);
};


/***/ }),
/* 233 */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(16);
// 19.1.2.2 / 15.2.3.5 Object.create(O [, Properties])
$export($export.S, 'Object', { create: __webpack_require__(70) });


/***/ }),
/* 234 */
/***/ (function(module, exports) {

// shim for using process in browser
var process = module.exports = {};

// cached from whatever global is present so that test runners that stub it
// don't break things.  But we need to wrap it in a try catch in case it is
// wrapped in strict mode code which doesn't define any globals.  It's inside a
// function because try/catches deoptimize in certain engines.

var cachedSetTimeout;
var cachedClearTimeout;

function defaultSetTimout() {
    throw new Error('setTimeout has not been defined');
}
function defaultClearTimeout () {
    throw new Error('clearTimeout has not been defined');
}
(function () {
    try {
        if (typeof setTimeout === 'function') {
            cachedSetTimeout = setTimeout;
        } else {
            cachedSetTimeout = defaultSetTimout;
        }
    } catch (e) {
        cachedSetTimeout = defaultSetTimout;
    }
    try {
        if (typeof clearTimeout === 'function') {
            cachedClearTimeout = clearTimeout;
        } else {
            cachedClearTimeout = defaultClearTimeout;
        }
    } catch (e) {
        cachedClearTimeout = defaultClearTimeout;
    }
} ())
function runTimeout(fun) {
    if (cachedSetTimeout === setTimeout) {
        //normal enviroments in sane situations
        return setTimeout(fun, 0);
    }
    // if setTimeout wasn't available but was latter defined
    if ((cachedSetTimeout === defaultSetTimout || !cachedSetTimeout) && setTimeout) {
        cachedSetTimeout = setTimeout;
        return setTimeout(fun, 0);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedSetTimeout(fun, 0);
    } catch(e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't trust the global object when called normally
            return cachedSetTimeout.call(null, fun, 0);
        } catch(e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error
            return cachedSetTimeout.call(this, fun, 0);
        }
    }


}
function runClearTimeout(marker) {
    if (cachedClearTimeout === clearTimeout) {
        //normal enviroments in sane situations
        return clearTimeout(marker);
    }
    // if clearTimeout wasn't available but was latter defined
    if ((cachedClearTimeout === defaultClearTimeout || !cachedClearTimeout) && clearTimeout) {
        cachedClearTimeout = clearTimeout;
        return clearTimeout(marker);
    }
    try {
        // when when somebody has screwed with setTimeout but no I.E. maddness
        return cachedClearTimeout(marker);
    } catch (e){
        try {
            // When we are in I.E. but the script has been evaled so I.E. doesn't  trust the global object when called normally
            return cachedClearTimeout.call(null, marker);
        } catch (e){
            // same as above but when it's a version of I.E. that must have the global object for 'this', hopfully our context correct otherwise it will throw a global error.
            // Some versions of I.E. have different rules for clearTimeout vs setTimeout
            return cachedClearTimeout.call(this, marker);
        }
    }



}
var queue = [];
var draining = false;
var currentQueue;
var queueIndex = -1;

function cleanUpNextTick() {
    if (!draining || !currentQueue) {
        return;
    }
    draining = false;
    if (currentQueue.length) {
        queue = currentQueue.concat(queue);
    } else {
        queueIndex = -1;
    }
    if (queue.length) {
        drainQueue();
    }
}

function drainQueue() {
    if (draining) {
        return;
    }
    var timeout = runTimeout(cleanUpNextTick);
    draining = true;

    var len = queue.length;
    while(len) {
        currentQueue = queue;
        queue = [];
        while (++queueIndex < len) {
            if (currentQueue) {
                currentQueue[queueIndex].run();
            }
        }
        queueIndex = -1;
        len = queue.length;
    }
    currentQueue = null;
    draining = false;
    runClearTimeout(timeout);
}

process.nextTick = function (fun) {
    var args = new Array(arguments.length - 1);
    if (arguments.length > 1) {
        for (var i = 1; i < arguments.length; i++) {
            args[i - 1] = arguments[i];
        }
    }
    queue.push(new Item(fun, args));
    if (queue.length === 1 && !draining) {
        runTimeout(drainQueue);
    }
};

// v8 likes predictible objects
function Item(fun, array) {
    this.fun = fun;
    this.array = array;
}
Item.prototype.run = function () {
    this.fun.apply(null, this.array);
};
process.title = 'browser';
process.browser = true;
process.env = {};
process.argv = [];
process.version = ''; // empty string to avoid regexp issues
process.versions = {};

function noop() {}

process.on = noop;
process.addListener = noop;
process.once = noop;
process.off = noop;
process.removeListener = noop;
process.removeAllListeners = noop;
process.emit = noop;
process.prependListener = noop;
process.prependOnceListener = noop;

process.listeners = function (name) { return [] }

process.binding = function (name) {
    throw new Error('process.binding is not supported');
};

process.cwd = function () { return '/' };
process.chdir = function (dir) {
    throw new Error('process.chdir is not supported');
};
process.umask = function() { return 0; };


/***/ }),
/* 235 */
/***/ (function(module, exports) {

var g;

// This works in non-strict mode
g = (function() {
	return this;
})();

try {
	// This works if eval is allowed (see CSP)
	g = g || Function("return this")() || (1,eval)("this");
} catch(e) {
	// This works if the window reference is available
	if(typeof window === "object")
		g = window;
}

// g can still be undefined, but nothing to do about it...
// We return undefined, instead of nothing here, so it's
// easier to handle this case. if(!global) { ...}

module.exports = g;


/***/ }),
/* 236 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(61);
__webpack_require__(46);
module.exports = __webpack_require__(237);


/***/ }),
/* 237 */
/***/ (function(module, exports, __webpack_require__) {

var anObject = __webpack_require__(30);
var get = __webpack_require__(101);
module.exports = __webpack_require__(14).getIterator = function (it) {
  var iterFn = get(it);
  if (typeof iterFn != 'function') throw TypeError(it + ' is not iterable!');
  return anObject(iterFn.call(it));
};


/***/ }),
/* 238 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(239);
module.exports = __webpack_require__(14).Object.assign;


/***/ }),
/* 239 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.3.1 Object.assign(target, source)
var $export = __webpack_require__(16);

$export($export.S + $export.F, 'Object', { assign: __webpack_require__(240) });


/***/ }),
/* 240 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// 19.1.2.1 Object.assign(target, source, ...)
var DESCRIPTORS = __webpack_require__(23);
var getKeys = __webpack_require__(48);
var gOPS = __webpack_require__(104);
var pIE = __webpack_require__(62);
var toObject = __webpack_require__(41);
var IObject = __webpack_require__(97);
var $assign = Object.assign;

// should work with symbols and should have deterministic property order (V8 bug)
module.exports = !$assign || __webpack_require__(39)(function () {
  var A = {};
  var B = {};
  // eslint-disable-next-line no-undef
  var S = Symbol();
  var K = 'abcdefghijklmnopqrst';
  A[S] = 7;
  K.split('').forEach(function (k) { B[k] = k; });
  return $assign({}, A)[S] != 7 || Object.keys($assign({}, B)).join('') != K;
}) ? function assign(target, source) { // eslint-disable-line no-unused-vars
  var T = toObject(target);
  var aLen = arguments.length;
  var index = 1;
  var getSymbols = gOPS.f;
  var isEnum = pIE.f;
  while (aLen > index) {
    var S = IObject(arguments[index++]);
    var keys = getSymbols ? getKeys(S).concat(getSymbols(S)) : getKeys(S);
    var length = keys.length;
    var j = 0;
    var key;
    while (length > j) {
      key = keys[j++];
      if (!DESCRIPTORS || isEnum.call(S, key)) T[key] = S[key];
    }
  } return T;
} : $assign;


/***/ }),
/* 241 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(242);
module.exports = __webpack_require__(14).Object.keys;


/***/ }),
/* 242 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.14 Object.keys(O)
var toObject = __webpack_require__(41);
var $keys = __webpack_require__(48);

__webpack_require__(74)('keys', function () {
  return function keys(it) {
    return $keys(toObject(it));
  };
});


/***/ }),
/* 243 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function arrayToJSON(plainArray, ignoreDefualt) {
    return plainArray.map(function (e, index) {
        if (typeof e === 'undefined' || e === null) {
            return null; // 用null来存储，JSON格式不认undefined
        } else if (Array.isArray(e)) {
            return arrayToJSON(e, ignoreDefualt);
        } else if (e.toJSON) {
            if (typeof e.ignoreDefualt === 'undefined') {
                return e.toJSON(index.toString());
            } else {
                var originIgnoreDefault = e.ignoreDefualt;
                e.ignoreDefualt = ignoreDefualt;
                var result = e.toJSON(index.toString());
                e.ignoreDefualt = originIgnoreDefault;
                return result;
            }
        } else if ((typeof e === 'undefined' ? 'undefined' : (0, _typeof3.default)(e)) === 'object') {
            return plainObjectToJSON(e);
        } else {
            return e;
        }
    });
}

// 因为JSON格式不能存储undefined，
// 所以对于默认值是undefined的熟悉，一律存储为null！
// 反过来，需要把json中的null一律解析成undefined!
// 对于对象来说，可以用{}来表示使用默认值！

function defaultOptionsFilters(key, defaultOptions, plainObject) {
    // if (!defaultOptions[key]) { // 这样判断会导致值为undefined，但是有key的被过滤掉，实际不应过滤
    if (!(key in defaultOptions)) {
        // 换成这种形式！
        return false; // 没有默认属性的，不会打印！defaultOptions是一个限制项
        // 'undefined'可以是默认值，如果当前值也是undefined，则需要过滤掉！
        // } else if (typeof defaultOptions[key] === 'undefined') { // 有key但无定义，需要保留
        //     return true;
    } else if (defaultOptions[key] === null) {
        return true;
    } else if (Array.isArray(defaultOptions[key])) {
        // 经过测试 Array.prototype.every是可以遍历undefined元素的！
        if (defaultOptions[key].length === plainObject[key].length && defaultOptions[key].every(function (d, index) {
            return d === plainObject[key][index];
        })) {
            return false;
        } else {
            return true;
        }
    } else if ((0, _typeof3.default)(defaultOptions[key]) === 'object') {
        return true;
    } else {
        return plainObject[key] !== defaultOptions[key];
    }
}

// ignoreDefualt用来确定子元素是否需要忽略默认值，需要一级一级传递下去
function plainObjectToJSON(plainObject) {
    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        defaultOptions = _ref.defaultOptions,
        filterKeys = _ref.filterKeys,
        ignoreDefualt = _ref.ignoreDefualt;

    var jsonObject = {};
    (0, _keys2.default)(plainObject).filter(function (key) {
        var f1 = key.startsWith('_') || key.startsWith('$');
        var f2 = !!filterKeys ? filterKeys.includes(key) : false;
        var f3 = !!defaultOptions ? !defaultOptionsFilters(key, defaultOptions, plainObject) : false;

        var filter = !(f1 || f2 || f3);
        return filter;
    }).forEach(function (key) {
        var subDO = defaultOptions && defaultOptions[key];
        // 考虑值为undefined时候的存储
        // if (Array.isArray(plainObject[key])) {
        //     jsonObject[key] = arrayToJSON(plainObject[key]);
        if (typeof plainObject[key] === 'undefined' || plainObject[key] === null) {
            jsonObject[key] = null; // 用null来存储，JSON格式不认undefined
        } else if (Array.isArray(plainObject[key])) {
            jsonObject[key] = arrayToJSON(plainObject[key], ignoreDefualt);
        } else if (plainObject[key].toJSON) {
            if (typeof plainObject[key].ignoreDefualt === 'undefined') {
                jsonObject[key] = plainObject[key].toJSON(key);
            } else {
                var originIgnoreDefault = plainObject[key].ignoreDefualt;
                plainObject[key].ignoreDefualt = ignoreDefualt;
                jsonObject[key] = plainObject[key].toJSON(key);
                plainObject[key].ignoreDefualt = originIgnoreDefault;
            }
        } else if ((0, _typeof3.default)(plainObject[key]) === 'object') {
            jsonObject[key] = plainObjectToJSON(plainObject[key], { defaultOptions: subDO, ignoreDefualt: ignoreDefualt });
        } else {
            jsonObject[key] = plainObject[key];
        }
    });

    return jsonObject;
}

exports.default = plainObjectToJSON;

/***/ }),
/* 244 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function jsonToArray(jsonObj, plainArray) {
    var _plainArray;

    plainArray = plainArray || [];
    if (!Array.isArray(plainArray)) {
        throw new Error('from json发生意外！');
    }

    // plainArray.length = 0;
    var tempPA = new Array(jsonObj.length);
    jsonObj.forEach(function (e, index) {
        // 避免mobx警告plainArray没有index这一项！
        // const result = (index >= 0 && index < plainArray.length) ? plainArray[index] : undefined;

        if (Array.isArray(e)) {
            tempPA[index] = jsonToArray(e, tempPA[index]);
        } else if ((typeof e === 'undefined' ? 'undefined' : (0, _typeof3.default)(e)) === 'object') {
            tempPA[index] = jsonToPlainObject(e, tempPA[index]);
        } else {
            tempPA[index] = e;
        }
    });
    (_plainArray = plainArray).splice.apply(_plainArray, [0, plainArray.length].concat(tempPA));

    return plainArray;
}

function jsonToPlainObject(jsonObject, plainObject, filterKeys) {
    plainObject = plainObject || {};
    (0, _keys2.default)(jsonObject).filter(function (key) {
        return !(filterKeys && filterKeys.includes(key));
    }).forEach(function (key) {
        if (typeof jsonObject[key] === 'undefined' || jsonObject[key] === null) {
            plainObject[key] = undefined;
        } else if (Array.isArray(jsonObject[key])) {
            plainObject[key] = jsonToArray(jsonObject[key], plainObject[key]);
        } else if ((0, _typeof3.default)(jsonObject[key]) === 'object') {
            plainObject[key] = plainObject[key] || {};
            if (!plainObject[key].xbsjFromJSON) {
                jsonToPlainObject(jsonObject[key], plainObject[key], filterKeys);
            } else {
                plainObject[key].xbsjFromJSON(jsonObject[key]);
            }
        } else {
            plainObject[key] = jsonObject[key];
        }
    });

    return plainObject;
}

exports.default = jsonToPlainObject;

/***/ }),
/* 245 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _mobx = __webpack_require__(2);

var mobx = {
  intercept: _mobx.intercept,
  extendObservable: _mobx.extendObservable,
  observable: _mobx.observable
};

function interceptArray(newArray, createElement, destroyElement) {
  var arrayInterceptDisposer = mobx.intercept(newArray, function (changed) {
    if (changed.type === 'splice') {
      // changed.index;
      // changed.removedCount;
      // changed.added;
      var oldArray = changed.object;
      for (var i = 0; i < changed.removedCount; ++i) {
        destroyElement(oldArray[i + changed.index]);
      }
      changed.added = changed.added.map(function (e) {
        return createElement(e);
      });

      // 如果有一个值是undefined，就不做修改了！
      if (changed.added.some(function (e) {
        return typeof e === 'undefined';
      })) {
        return undefined;
      }
    } else if (changed.type === 'update') {
      // changed.index;
      // changed.newValue;
      var _oldArray = changed.object;
      var oldE = _oldArray[changed.index];
      destroyElement(oldE);
      changed.newValue = createElement(changed.newValue);
    }
    return changed;
  });

  return arrayInterceptDisposer;
}

exports.default = interceptArray;

/***/ }),
/* 246 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

var _defineProperty2 = __webpack_require__(78);

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function registerPathAttachedGuid(selfObject) {
    var _ref = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {},
        _ref$positionProperty = _ref.positionProperty,
        positionProperty = _ref$positionProperty === undefined ? 'position' : _ref$positionProperty,
        _ref$rotationProperty = _ref.rotationProperty,
        rotationProperty = _ref$rotationProperty === undefined ? 'rotation' : _ref$rotationProperty,
        _ref$attachedPathGuid = _ref.attachedPathGuidProperty,
        attachedPathGuidProperty = _ref$attachedPathGuid === undefined ? 'attachedPathGuid' : _ref$attachedPathGuid;

    if (typeof selfObject[attachedPathGuidProperty] === 'undefined') {
        (0, _mobx.extendObservable)(selfObject, (0, _defineProperty3.default)({}, attachedPathGuidProperty, ''));
    }

    var _attachedPathProperty = '_' + attachedPathGuidProperty + '_obj';

    (0, _mobx.extendObservable)(selfObject, (0, _defineProperty3.default)({}, _attachedPathProperty, undefined), (0, _defineProperty3.default)({}, _attachedPathProperty, _mobx.observable.ref));

    var disposers = [];

    disposers.push((0, _mobx.reaction)(function () {
        var attachedPath = selfObject[_attachedPathProperty];
        return {
            position: attachedPath && (0, _typeof3.default)(attachedPath.currentPosition) ? [].concat((0, _toConsumableArray3.default)(attachedPath.currentPosition)) : undefined,
            rotation: attachedPath && (0, _typeof3.default)(attachedPath.currentRotation) ? [].concat((0, _toConsumableArray3.default)(attachedPath.currentRotation)) : undefined
        };
    }, function (par) {
        if (par.position && selfObject[positionProperty]) {
            selfObject[positionProperty] = par.position;
        }

        if (par.rotation && selfObject[rotationProperty]) {
            if (!selfObject.isCameraLike) {
                selfObject[rotationProperty] = [par.rotation[0] - Cesium.Math.PI_OVER_TWO, par.rotation[1], par.rotation[2]];
            } else {
                selfObject[rotationProperty] = par.rotation;
            }
        }
    }));

    disposers.push(selfObject._earth.registerObjectFromGuid(selfObject, attachedPathGuidProperty, _attachedPathProperty));

    return function () {
        disposers.forEach(function (d) {
            return d();
        });
        disposers.length = 0;
    };
}

exports.default = registerPathAttachedGuid;

/***/ }),
/* 247 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var MovableObjectLike = function (_XbsjBase) {
    (0, _inherits3.default)(MovableObjectLike, _XbsjBase);

    function MovableObjectLike(realObject, realProperty) {
        (0, _classCallCheck3.default)(this, MovableObjectLike);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MovableObjectLike.__proto__ || (0, _getPrototypeOf2.default)(MovableObjectLike)).call(this));

        (0, _mobx.extendObservable)(_this, {
            position: [0, 0, 0]
        });

        _this._realObject = realObject;
        _this._realProperty = realProperty;
        _this._unbind = (0, _bind2.default)(_this, 'position', realObject, realProperty);
        return _this;
    }

    (0, _createClass3.default)(MovableObjectLike, [{
        key: 'destroy',
        value: function destroy() {
            this._unbind = this._unbind && this._unbind();
            return (0, _get3.default)(MovableObjectLike.prototype.__proto__ || (0, _getPrototypeOf2.default)(MovableObjectLike.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'realObject',
        get: function get() {
            return this._realObject;
        }
    }, {
        key: 'realProperty',
        get: function get() {
            return this._realProperty;
        }
    }]);
    return MovableObjectLike;
}(_XbsjBase3.default);

exports.default = MovableObjectLike;

/***/ }),
/* 248 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var RotatableObjectLike = function (_XbsjBase) {
    (0, _inherits3.default)(RotatableObjectLike, _XbsjBase);

    function RotatableObjectLike(realObject, positionProperty, rotationProperty) {
        (0, _classCallCheck3.default)(this, RotatableObjectLike);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RotatableObjectLike.__proto__ || (0, _getPrototypeOf2.default)(RotatableObjectLike)).call(this));

        (0, _mobx.extendObservable)(_this, {
            position: [0, 0, 0],
            rotation: [0, 0, 0]
        });

        _this._realObject = realObject;
        _this._positionProperty = positionProperty;
        _this._rotationProperty = rotationProperty;

        _this._disposers = [];
        _this._disposers.push((0, _bind2.default)(_this, 'position', realObject, positionProperty));
        _this._disposers.push((0, _bind2.default)(_this, 'rotation', realObject, rotationProperty));
        return _this;
    }

    (0, _createClass3.default)(RotatableObjectLike, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.lenght = 0;

            return (0, _get3.default)(RotatableObjectLike.prototype.__proto__ || (0, _getPrototypeOf2.default)(RotatableObjectLike.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'realObject',
        get: function get() {
            return this._realObject;
        }
    }, {
        key: 'positionProperty',
        get: function get() {
            return this._realProperty;
        }
    }, {
        key: 'rotationProperty',
        get: function get() {
            return this._rotationProperty;
        }
    }]);
    return RotatableObjectLike;
}(_XbsjBase3.default);

exports.default = RotatableObjectLike;

/***/ }),
/* 249 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _registerInteractionProperty = __webpack_require__(15);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 压平多边形
 * @memberof Obj.FlattenedPolygonCollection
 * @class
 * @extends XbsjBase
 */
var FlattenedPolygon = function (_XbsjBase) {
    (0, _inherits3.default)(FlattenedPolygon, _XbsjBase);

    function FlattenedPolygon(earth) {
        (0, _classCallCheck3.default)(this, FlattenedPolygon);

        var _this = (0, _possibleConstructorReturn3.default)(this, (FlattenedPolygon.__proto__ || (0, _getPrototypeOf2.default)(FlattenedPolygon)).call(this));

        _this._earth = earth;

        _this._polygon = new _Polygon2.default(earth);
        _this.disposers.push(function () {
            _this._polygon = _this._polygon && _this._polygon.destroy();
        });

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._polygon.height = _this.height;
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.show && _this.showHelper;
        }, function (show) {
            _this._polygon.show = show;
            _this._polygon.showHelper = show;
        }, {
            fireImmediately: true
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this.positions));
        }, function (positions) {
            _this._polygon.positions = positions;
        }, {
            fireImmediately: true
        }));

        _this.disposers.push((0, _mobx.intercept)(_this, 'positions', function (changed) {
            if (changed.type === 'update') {
                if (changed.newValue && Array.isArray(changed.newValue)) {
                    var _this$positions;

                    (_this$positions = _this.positions).splice.apply(_this$positions, [0, _this.positions.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
                }
            }

            return undefined;
        }));

        // this._disposers.push(intercept(this.positions, changed => {
        //     if (changed.type === 'update') {
        //         //console.log('update');
        //     } else if (changed.type === 'splice') {
        //         //console.log('splice');
        //     }

        //     return changed;
        // }));

        // extendObservable(this, {
        //     polygonEditing: false,
        // });

        // this._disposers.push(autorun(() => {
        //     this.polygonEditing = (this._earth.interaction.editingPolygonBinding.target === this.EditingPolylineLike.positions);
        // }));

        // this._disposers.push(reaction(() => this.polygonEditing, () => {
        //     if (!this.polygonEditing && this._earth.interaction.editingPolygonBinding.target === this.EditingPolylineLike.positions) {
        //         this._earth.interaction.editingPolygonBinding.target = undefined;
        //     } else if (this.polygonEditing) {
        //         this._earth.interaction.editingPolygonBinding.target = this.EditingPolylineLike.positions;
        //     }
        // }, {
        //     fireImmediately: true,
        // }));

        // extendObservable(this, {
        //     heightEditing: false,
        // });

        // this._disposers.push(autorun(() => {
        //     this.heightEditing = this.EditingPolylineLike.positions.length > 0 && (this._earth.interaction.editingPolygonBinding.target === this.EditingPolylineLike.positions[0]);
        // }));

        // this._disposers.push(reaction(() => this.heightEditing, () => {
        //     const inter = this._earth.interaction;
        //     const heb = inter.heightEditingBinding;
        //     const eps = this.EditingPolylineLike.positions;
        //     if (!this.heightEditing && eps.length > 0 && heb.target === eps[0]) {
        //         inter.heightEditingBinding.target = undefined;
        //     } else if (this.heightEditing && eps.length > 0) {
        //         inter.heightEditingBinding.target = eps[0];
        //     }
        // }, {
        //     fireImmediately: true,
        // }));

        /**
         * 是否在三维窗口中编辑
         * @name editing
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */

        /**
         * 是否在三维窗口中进行点增加的编辑
         * @name creating
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreatingWithHeight)(_this._earth, _this, {
            polygonCreatingWithHeight: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));
        return _this;
    }

    /**
     * 获取包围球
     * @ignore
     */

    (0, _createClass3.default)(FlattenedPolygon, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            if (this.boundingSphere.radius === 0 || Cesium.Cartesian3.magnitudeSquared(this.boundingSphere.center) < 0.0001) {
                // do nothing!
            } else {
                camera.flyToBoundingSphere(this.boundingSphere);
            }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(FlattenedPolygon.prototype.__proto__ || (0, _getPrototypeOf2.default)(FlattenedPolygon.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._polygon && this._polygon.boundingSphere;
        }
    }]);
    return FlattenedPolygon;
}(_XbsjBase3.default);

FlattenedPolygon.defaultOptions = {
    positions: [],
    height: 0.0,
    show: true,
    showHelper: false
};

var xbsjSchema = {
    title: "FlattenedPolygon Property",
    type: "object",
    properties: {
        /**
         * 位置数组，[经度, 纬度, 经度, 纬度, 经度, 纬度, ...]
         * @type {number[]}
         * @instance
         * @default []
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */
        positions: { type: 'array', items: { type: 'number' }, default: [], description: '位置数组' },
        /**
         * 多边形高度
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */
        height: { type: 'number', title: '多边形高度', default: 0.0, description: '多边形高度' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.FlattenedPolygonCollection.FlattenedPolygon
         */
        showHelper: { type: 'boolean', title: '是否显示辅助线框', default: true, description: '是否显示辅助线框' }
    }
};

FlattenedPolygon.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['positions', 'height', 'show', 'showHelper']
}];

FlattenedPolygon.xbsjClassification = xbsjClassification;

exports.default = FlattenedPolygon;

/***/ }),
/* 250 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function uniquePositions(positions) {
    if (positions.length == 0) {
        return [];
    }

    var newPositions = [positions[0]];
    for (var i = 1; i < positions.length; ++i) {
        var np = newPositions[newPositions.length - 1];
        if (np[0] !== positions[i][0] || np[1] !== positions[i][1] || np[2] !== positions[i][2]) {
            newPositions.push([].concat((0, _toConsumableArray3.default)(positions[i])));
        }
    }

    return newPositions;
}

exports.default = uniquePositions;

/***/ }),
/* 251 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(106);
__webpack_require__(46);
__webpack_require__(61);
__webpack_require__(252);
__webpack_require__(256);
__webpack_require__(257);
module.exports = __webpack_require__(14).Promise;


/***/ }),
/* 252 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var LIBRARY = __webpack_require__(56);
var global = __webpack_require__(17);
var ctx = __webpack_require__(32);
var classof = __webpack_require__(73);
var $export = __webpack_require__(16);
var isObject = __webpack_require__(25);
var aFunction = __webpack_require__(57);
var anInstance = __webpack_require__(109);
var forOf = __webpack_require__(64);
var speciesConstructor = __webpack_require__(152);
var task = __webpack_require__(153).set;
var microtask = __webpack_require__(254)();
var newPromiseCapabilityModule = __webpack_require__(110);
var perform = __webpack_require__(154);
var userAgent = __webpack_require__(255);
var promiseResolve = __webpack_require__(155);
var PROMISE = 'Promise';
var TypeError = global.TypeError;
var process = global.process;
var versions = process && process.versions;
var v8 = versions && versions.v8 || '';
var $Promise = global[PROMISE];
var isNode = classof(process) == 'process';
var empty = function () { /* empty */ };
var Internal, newGenericPromiseCapability, OwnPromiseCapability, Wrapper;
var newPromiseCapability = newGenericPromiseCapability = newPromiseCapabilityModule.f;

var USE_NATIVE = !!function () {
  try {
    // correct subclassing with @@species support
    var promise = $Promise.resolve(1);
    var FakePromise = (promise.constructor = {})[__webpack_require__(18)('species')] = function (exec) {
      exec(empty, empty);
    };
    // unhandled rejections tracking support, NodeJS Promise without it fails @@species test
    return (isNode || typeof PromiseRejectionEvent == 'function')
      && promise.then(empty) instanceof FakePromise
      // v8 6.6 (Node 10 and Chrome 66) have a bug with resolving custom thenables
      // https://bugs.chromium.org/p/chromium/issues/detail?id=830565
      // we can't detect it synchronously, so just check versions
      && v8.indexOf('6.6') !== 0
      && userAgent.indexOf('Chrome/66') === -1;
  } catch (e) { /* empty */ }
}();

// helpers
var isThenable = function (it) {
  var then;
  return isObject(it) && typeof (then = it.then) == 'function' ? then : false;
};
var notify = function (promise, isReject) {
  if (promise._n) return;
  promise._n = true;
  var chain = promise._c;
  microtask(function () {
    var value = promise._v;
    var ok = promise._s == 1;
    var i = 0;
    var run = function (reaction) {
      var handler = ok ? reaction.ok : reaction.fail;
      var resolve = reaction.resolve;
      var reject = reaction.reject;
      var domain = reaction.domain;
      var result, then, exited;
      try {
        if (handler) {
          if (!ok) {
            if (promise._h == 2) onHandleUnhandled(promise);
            promise._h = 1;
          }
          if (handler === true) result = value;
          else {
            if (domain) domain.enter();
            result = handler(value); // may throw
            if (domain) {
              domain.exit();
              exited = true;
            }
          }
          if (result === reaction.promise) {
            reject(TypeError('Promise-chain cycle'));
          } else if (then = isThenable(result)) {
            then.call(result, resolve, reject);
          } else resolve(result);
        } else reject(value);
      } catch (e) {
        if (domain && !exited) domain.exit();
        reject(e);
      }
    };
    while (chain.length > i) run(chain[i++]); // variable length - can't use forEach
    promise._c = [];
    promise._n = false;
    if (isReject && !promise._h) onUnhandled(promise);
  });
};
var onUnhandled = function (promise) {
  task.call(global, function () {
    var value = promise._v;
    var unhandled = isUnhandled(promise);
    var result, handler, console;
    if (unhandled) {
      result = perform(function () {
        if (isNode) {
          process.emit('unhandledRejection', value, promise);
        } else if (handler = global.onunhandledrejection) {
          handler({ promise: promise, reason: value });
        } else if ((console = global.console) && console.error) {
          console.error('Unhandled promise rejection', value);
        }
      });
      // Browsers should not trigger `rejectionHandled` event if it was handled here, NodeJS - should
      promise._h = isNode || isUnhandled(promise) ? 2 : 1;
    } promise._a = undefined;
    if (unhandled && result.e) throw result.v;
  });
};
var isUnhandled = function (promise) {
  return promise._h !== 1 && (promise._a || promise._c).length === 0;
};
var onHandleUnhandled = function (promise) {
  task.call(global, function () {
    var handler;
    if (isNode) {
      process.emit('rejectionHandled', promise);
    } else if (handler = global.onrejectionhandled) {
      handler({ promise: promise, reason: promise._v });
    }
  });
};
var $reject = function (value) {
  var promise = this;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  promise._v = value;
  promise._s = 2;
  if (!promise._a) promise._a = promise._c.slice();
  notify(promise, true);
};
var $resolve = function (value) {
  var promise = this;
  var then;
  if (promise._d) return;
  promise._d = true;
  promise = promise._w || promise; // unwrap
  try {
    if (promise === value) throw TypeError("Promise can't be resolved itself");
    if (then = isThenable(value)) {
      microtask(function () {
        var wrapper = { _w: promise, _d: false }; // wrap
        try {
          then.call(value, ctx($resolve, wrapper, 1), ctx($reject, wrapper, 1));
        } catch (e) {
          $reject.call(wrapper, e);
        }
      });
    } else {
      promise._v = value;
      promise._s = 1;
      notify(promise, false);
    }
  } catch (e) {
    $reject.call({ _w: promise, _d: false }, e); // wrap
  }
};

// constructor polyfill
if (!USE_NATIVE) {
  // 25.4.3.1 Promise(executor)
  $Promise = function Promise(executor) {
    anInstance(this, $Promise, PROMISE, '_h');
    aFunction(executor);
    Internal.call(this);
    try {
      executor(ctx($resolve, this, 1), ctx($reject, this, 1));
    } catch (err) {
      $reject.call(this, err);
    }
  };
  // eslint-disable-next-line no-unused-vars
  Internal = function Promise(executor) {
    this._c = [];             // <- awaiting reactions
    this._a = undefined;      // <- checked in isUnhandled reactions
    this._s = 0;              // <- state
    this._d = false;          // <- done
    this._v = undefined;      // <- value
    this._h = 0;              // <- rejection state, 0 - default, 1 - handled, 2 - unhandled
    this._n = false;          // <- notify
  };
  Internal.prototype = __webpack_require__(111)($Promise.prototype, {
    // 25.4.5.3 Promise.prototype.then(onFulfilled, onRejected)
    then: function then(onFulfilled, onRejected) {
      var reaction = newPromiseCapability(speciesConstructor(this, $Promise));
      reaction.ok = typeof onFulfilled == 'function' ? onFulfilled : true;
      reaction.fail = typeof onRejected == 'function' && onRejected;
      reaction.domain = isNode ? process.domain : undefined;
      this._c.push(reaction);
      if (this._a) this._a.push(reaction);
      if (this._s) notify(this, false);
      return reaction.promise;
    },
    // 25.4.5.1 Promise.prototype.catch(onRejected)
    'catch': function (onRejected) {
      return this.then(undefined, onRejected);
    }
  });
  OwnPromiseCapability = function () {
    var promise = new Internal();
    this.promise = promise;
    this.resolve = ctx($resolve, promise, 1);
    this.reject = ctx($reject, promise, 1);
  };
  newPromiseCapabilityModule.f = newPromiseCapability = function (C) {
    return C === $Promise || C === Wrapper
      ? new OwnPromiseCapability(C)
      : newGenericPromiseCapability(C);
  };
}

$export($export.G + $export.W + $export.F * !USE_NATIVE, { Promise: $Promise });
__webpack_require__(60)($Promise, PROMISE);
__webpack_require__(156)(PROMISE);
Wrapper = __webpack_require__(14)[PROMISE];

// statics
$export($export.S + $export.F * !USE_NATIVE, PROMISE, {
  // 25.4.4.5 Promise.reject(r)
  reject: function reject(r) {
    var capability = newPromiseCapability(this);
    var $$reject = capability.reject;
    $$reject(r);
    return capability.promise;
  }
});
$export($export.S + $export.F * (LIBRARY || !USE_NATIVE), PROMISE, {
  // 25.4.4.6 Promise.resolve(x)
  resolve: function resolve(x) {
    return promiseResolve(LIBRARY && this === Wrapper ? $Promise : this, x);
  }
});
$export($export.S + $export.F * !(USE_NATIVE && __webpack_require__(142)(function (iter) {
  $Promise.all(iter)['catch'](empty);
})), PROMISE, {
  // 25.4.4.1 Promise.all(iterable)
  all: function all(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var resolve = capability.resolve;
    var reject = capability.reject;
    var result = perform(function () {
      var values = [];
      var index = 0;
      var remaining = 1;
      forOf(iterable, false, function (promise) {
        var $index = index++;
        var alreadyCalled = false;
        values.push(undefined);
        remaining++;
        C.resolve(promise).then(function (value) {
          if (alreadyCalled) return;
          alreadyCalled = true;
          values[$index] = value;
          --remaining || resolve(values);
        }, reject);
      });
      --remaining || resolve(values);
    });
    if (result.e) reject(result.v);
    return capability.promise;
  },
  // 25.4.4.4 Promise.race(iterable)
  race: function race(iterable) {
    var C = this;
    var capability = newPromiseCapability(C);
    var reject = capability.reject;
    var result = perform(function () {
      forOf(iterable, false, function (promise) {
        C.resolve(promise).then(capability.resolve, reject);
      });
    });
    if (result.e) reject(result.v);
    return capability.promise;
  }
});


/***/ }),
/* 253 */
/***/ (function(module, exports) {

// fast apply, http://jsperf.lnkit.com/fast-apply/5
module.exports = function (fn, args, that) {
  var un = that === undefined;
  switch (args.length) {
    case 0: return un ? fn()
                      : fn.call(that);
    case 1: return un ? fn(args[0])
                      : fn.call(that, args[0]);
    case 2: return un ? fn(args[0], args[1])
                      : fn.call(that, args[0], args[1]);
    case 3: return un ? fn(args[0], args[1], args[2])
                      : fn.call(that, args[0], args[1], args[2]);
    case 4: return un ? fn(args[0], args[1], args[2], args[3])
                      : fn.call(that, args[0], args[1], args[2], args[3]);
  } return fn.apply(that, args);
};


/***/ }),
/* 254 */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(17);
var macrotask = __webpack_require__(153).set;
var Observer = global.MutationObserver || global.WebKitMutationObserver;
var process = global.process;
var Promise = global.Promise;
var isNode = __webpack_require__(59)(process) == 'process';

module.exports = function () {
  var head, last, notify;

  var flush = function () {
    var parent, fn;
    if (isNode && (parent = process.domain)) parent.exit();
    while (head) {
      fn = head.fn;
      head = head.next;
      try {
        fn();
      } catch (e) {
        if (head) notify();
        else last = undefined;
        throw e;
      }
    } last = undefined;
    if (parent) parent.enter();
  };

  // Node.js
  if (isNode) {
    notify = function () {
      process.nextTick(flush);
    };
  // browsers with MutationObserver, except iOS Safari - https://github.com/zloirock/core-js/issues/339
  } else if (Observer && !(global.navigator && global.navigator.standalone)) {
    var toggle = true;
    var node = document.createTextNode('');
    new Observer(flush).observe(node, { characterData: true }); // eslint-disable-line no-new
    notify = function () {
      node.data = toggle = !toggle;
    };
  // environments with maybe non-completely correct, but existent Promise
  } else if (Promise && Promise.resolve) {
    // Promise.resolve without an argument throws an error in LG WebOS 2
    var promise = Promise.resolve(undefined);
    notify = function () {
      promise.then(flush);
    };
  // for other environments - macrotask based on:
  // - setImmediate
  // - MessageChannel
  // - window.postMessag
  // - onreadystatechange
  // - setTimeout
  } else {
    notify = function () {
      // strange IE + webpack dev server bug - use .call(global)
      macrotask.call(global, flush);
    };
  }

  return function (fn) {
    var task = { fn: fn, next: undefined };
    if (last) last.next = task;
    if (!head) {
      head = task;
      notify();
    } last = task;
  };
};


/***/ }),
/* 255 */
/***/ (function(module, exports, __webpack_require__) {

var global = __webpack_require__(17);
var navigator = global.navigator;

module.exports = navigator && navigator.userAgent || '';


/***/ }),
/* 256 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";
// https://github.com/tc39/proposal-promise-finally

var $export = __webpack_require__(16);
var core = __webpack_require__(14);
var global = __webpack_require__(17);
var speciesConstructor = __webpack_require__(152);
var promiseResolve = __webpack_require__(155);

$export($export.P + $export.R, 'Promise', { 'finally': function (onFinally) {
  var C = speciesConstructor(this, core.Promise || global.Promise);
  var isFunction = typeof onFinally == 'function';
  return this.then(
    isFunction ? function (x) {
      return promiseResolve(C, onFinally()).then(function () { return x; });
    } : onFinally,
    isFunction ? function (e) {
      return promiseResolve(C, onFinally()).then(function () { throw e; });
    } : onFinally
  );
} });


/***/ }),
/* 257 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://github.com/tc39/proposal-promise-try
var $export = __webpack_require__(16);
var newPromiseCapability = __webpack_require__(110);
var perform = __webpack_require__(154);

$export($export.S, 'Promise', { 'try': function (callbackfn) {
  var promiseCapability = newPromiseCapability.f(this);
  var result = perform(callbackfn);
  (result.e ? promiseCapability.reject : promiseCapability.resolve)(result.v);
  return promiseCapability.promise;
} });


/***/ }),
/* 258 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    url: '', //	Resource | String | Promise.<Resource> | Promise.<String>		The url to a tileset JSON file.
    show: true, //	Boolean	true	optional Determines if the tileset will be shown.
    // modelMatrix: undefined, //	Matrix4	Matrix4.IDENTITY	optional A 4x4 transformation matrix that transforms the tileset's root tile.
    // shadows: undefined, //	ShadowMode	ShadowMode.ENABLED	optional Determines whether the tileset casts or receives shadows from each light source.
    maximumScreenSpaceError: 16, //	Number	16	optional The maximum screen space error used to drive level of detail refinement.
    maximumMemoryUsage: 512, //	Number	512	optional The maximum amount of memory in MB that can be used by the tileset.
    cullWithChildrenBounds: true, //	Boolean	true	optional Optimization option. Whether to cull tiles using the union of their children bounding volumes.
    dynamicScreenSpaceError: false, //	Boolean	false	optional Optimization option. Reduce the screen space error for tiles that are further away from the camera.
    dynamicScreenSpaceErrorDensity: 0.00278, //	Number	0.00278	optional Density used to adjust the dynamic screen space error, similar to fog density.
    dynamicScreenSpaceErrorFactor: 4.0, //	Number	4.0	optional A factor used to increase the computed dynamic screen space error.
    dynamicScreenSpaceErrorHeightFalloff: 0.25, //	Number	0.25	optional A ratio of the tileset's height at which the density starts to falloff.
    skipLevelOfDetail: true, //	Boolean	true	optional Optimization option. Determines if level of detail skipping should be applied during the traversal.
    baseScreenSpaceError: 1024, //	Number	1024	optional When skipLevelOfDetail is true, the screen space error that must be reached before skipping levels of detail.
    skipScreenSpaceErrorFactor: 16, //	Number	16	optional When skipLevelOfDetail is true, a multiplier defining the minimum screen space error to skip. Used in conjunction with skipLevels to determine which tiles to load.
    skipLevels: 1, //	Number	1	optional When skipLevelOfDetail is true, a constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped. Used in conjunction with skipScreenSpaceErrorFactor to determine which tiles to load.
    immediatelyLoadDesiredLevelOfDetail: false, //	Boolean	false	optional When skipLevelOfDetail is true, only tiles that meet the maximum screen space error will ever be downloaded. Skipping factors are ignored and just the desired tiles are loaded.
    loadSiblings: false, //	Boolean	false	optional When skipLevelOfDetail is true, determines whether siblings of visible tiles are always downloaded during traversal.
    // clippingPlanes: undefined, //	ClippingPlaneCollection		optional The ClippingPlaneCollection used to selectively disable rendering the tileset.
    // classificationType: undefined, //	ClassificationType		optional Determines whether terrain, 3D Tiles or both will be classified by this tileset. See Cesium3DTileset#classificationType for details about restrictions and limitations.
    // ellipsoid: undefined, //	Ellipsoid	Ellipsoid.WGS84	optional The ellipsoid determining the size and shape of the globe.
    // pointCloudShading: undefined, //	Object		optional Options for constructing a PointCloudShading object to control point attenuation based on geometric error and lighting.
    // imageBasedLightingFactor: undefined, //	Cartesian2	new Cartesian2(1.0, 1.0)	optional Scales the diffuse and specular image-based lighting from the earth, sky, atmosphere and star skybox.
    // lightColor: undefined, //	Cartesian3		optional The color and intensity of the sunlight used to shade models.
    luminanceAtZenith: 0.2, //	Number	0.5	optional The sun's luminance at the zenith in kilo candela per meter squared to use for this model's procedural environment map.
    // sphericalHarmonicCoefficients: undefined, //	Array.<Cartesian3>		optional The third order spherical harmonic coefficients used for the diffuse color of image-based lighting.
    // specularEnvironmentMaps: undefined, //	String		optional A URL to a KTX file that contains a cube map of the specular lighting and the convoluted specular mipmaps.
    preferLeaves: false,
    debugFreezeFrame: false, //	Boolean	false	optional For debugging only. Determines if only the tiles from last frame should be used for rendering.
    debugColorizeTiles: false, //	Boolean	false	optional For debugging only. When true, assigns a random color to each tile.
    debugWireframe: false, //	Boolean	false	optional For debugging only. When true, render's each tile's content as a wireframe.
    debugShowBoundingVolume: false, //	Boolean	false	optional For debugging only. When true, renders the bounding volume for each tile.
    debugShowContentBoundingVolume: false, //	Boolean	false	optional For debugging only. When true, renders the bounding volume for each tile's content.
    debugShowViewerRequestVolume: false, //	Boolean	false	optional For debugging only. When true, renders the viewer request volume for each tile.
    debugShowGeometricError: false, //	Boolean	false	optional For debugging only. When true, draws labels to indicate the geometric error of each tile.
    debugShowRenderingStatistics: false, //	Boolean	false	optional For debugging only. When true, draws labels to indicate the number of commands, points, triangles and features for each tile.
    debugShowMemoryUsage: false, //	Boolean	false	optional For debugging only. When true, draws labels to indicate the texture and geometry memory in megabytes used by each tile.
    debugShowUrl: false //	Boolean	false	optional For debugging only. When true, draws labels to indicate the url of each tile.
};

// 需要改造的属性值默认值
(0, _assign2.default)(defaultOptions, {
    classificationType: 'ClassificationType.NONE',
    shadows: 'ShadowMode.ENABLED',
    imageBasedLightingFactor: [1.0, 1.0],
    lightColor: undefined,
    specularEnvironmentMaps: undefined
});

// 扩展的属性值默认值
(0, _assign2.default)(defaultOptions, {
    // xbsjDiffHeight: 0.0, // 高度偏移，单位米
    // xbsjDiffX: 0.0, // 东西向偏移，单位米
    // xbsjDiffY: 0.0, // 南北向偏移，单位米
    // xbsjRotateZ: 0.0, // 绕z轴旋转
    // xbsjLongitude: 0.0,
    // xbsjLatitude: 0.0,
    // xbsjHeight: 0.0,
    // xbsjHeading: 0.0,
    // xbsjPitch: 0.0,
    // xbsjRoll: 0.0,
    xbsjPosition: [0.0, 0.0, 0.0],
    xbsjRotation: [0.0, 0.0, 0.0],
    xbsjScale: [1.0, 1.0, 1.0],
    xbsjUseOriginTransform: true,
    xbsjLeftTopView: true,
    xbsjRightTopView: true,
    xbsjLeftBottomView: true,
    xbsjRightBottomView: true,
    xbsjStyle: '',
    xbsjFlattenGuid: '', // 绑定压平纹理
    xbsjClippingPlanes: null,
    xbsjCriticalElevation: -Infinity,
    xbsjCriticalElevationColor: [0, 1, 0, 0.5],
    // xbsjFlattenDiscard: false, // 压平处挖坑
    // allowPicking: false,
    attachedPathGuid: '',
    xbsjCustomShader: {
        vsHeader: '',
        vsBody: '',
        fsHeader: '',
        fsBody: ''
    },
    xbsjCustomParams: [0, 0, 0, 0]
});

exports.default = defaultOptions;

/***/ }),
/* 259 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _defineProperties = __webpack_require__(112);

var _defineProperties2 = _interopRequireDefault(_defineProperties);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function _evaluateColor(style, feature, scratchCustomColor) {
    if (style && style.ready && style.color) {
        return style.color.evaluateColor(feature, scratchCustomColor);
    } else {
        return Cesium.Color.WHITE;
    }
}

function evaluateShow(style, feature) {
    if (style && style.ready && style.show) {
        return style && style.show && style.show.evaluate(feature);
    } else {
        return true;
    }
}

function initTileset(tileset, earth) {
    tileset.style = new Cesium.Cesium3DTileStyle({});
    tileset.style.show = {
        evaluate: function evaluate(feature) {
            var customShow = evaluateShow(tileset.customStyle, feature);
            if (feature && feature.content && feature.content._pointCloud) {
                return customShow;
            }

            var propertyShow = evaluateShow(earth.propertyStyle, feature);
            return customShow && propertyShow;
        }
    };

    var xbsjTileset = tileset.xbsjTileset;
    xbsjTileset.propertyStyle = earth.propertyStyle;
    xbsjTileset.pickingStyle = earth.interaction && earth.interaction.picking._defaultTilesetPickingStyle;

    var scratchCustomColor = new Cesium.Color();
    var scratchPropertyColor = new Cesium.Color();
    var scratchPickingColor = new Cesium.Color();
    tileset.style.color = {
        evaluateColor: function evaluateColor(feature, result) {
            var customColor = _evaluateColor(tileset.customStyle, feature, scratchCustomColor) || Cesium.Color.WHITE;

            if (feature && feature.content && feature.content._pointCloud) {
                return Cesium.Color.clone(customColor, result);
            }

            // propertyColor
            var propertyStyle = xbsjTileset.propertyStyle;
            var propertyColor = propertyStyle && _evaluateColor(propertyStyle, feature, scratchPropertyColor) || Cesium.Color.WHITE;

            // pickingColor
            var pickingStyle = xbsjTileset.pickingStyle;
            var pickingColor = pickingStyle && _evaluateColor(pickingStyle, feature, scratchPickingColor) || Cesium.Color.WHITE;

            // 这里把pickingColor独立出来，如果不是白色，就只用pickingColor的颜色。
            if (!Cesium.Color.equals(pickingColor, Cesium.Color.WHITE)) {
                return Cesium.Color.clone(pickingColor, result);
            } else {
                result = result || scratchCustomColor;
                return Cesium.Color.multiply(customColor, propertyColor, result);
            }
        },
        getShaderFunction: function getShaderFunction() {
            var _tileset$customStyle$;

            return tileset.customStyle && tileset.customStyle.color && (_tileset$customStyle$ = tileset.customStyle.color).getShaderFunction.apply(_tileset$customStyle$, arguments);
        },
        getShaderExpression: function getShaderExpression() {
            var _tileset$customStyle$2;

            return tileset.customStyle && tileset.customStyle.color && (_tileset$customStyle$2 = tileset.customStyle.color).getShaderExpression.apply(_tileset$customStyle$2, arguments);
        }
    };

    tileset.style.pointSize = {
        evaluate: function evaluate(feature, result) {
            var style = tileset.customStyle;
            if (style && style.ready && style.pointSize) {
                return style && style.pointSize && style.pointSize.evaluate(feature);
            } else {
                return 1.0;
            }
        },
        getShaderFunction: function getShaderFunction() {
            var _tileset$customStyle$3;

            return tileset.customStyle && tileset.customStyle.pointSize && (_tileset$customStyle$3 = tileset.customStyle.pointSize).getShaderFunction.apply(_tileset$customStyle$3, arguments);
        },
        getShaderExpression: function getShaderExpression() {
            var _tileset$customStyle$4;

            return tileset.customStyle && tileset.customStyle.pointSize && (_tileset$customStyle$4 = tileset.customStyle.pointSize).getShaderExpression.apply(_tileset$customStyle$4, arguments);
        }
    };

    // 修复其他属性不能响应的问题
    (0, _defineProperties2.default)(tileset.style, {
        // pointSize: {
        //     get() {
        //         return tileset.customStyle && tileset.customStyle.pointSize;
        //     }
        // },
        pointOutlineColor: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.pointOutlineColor;
            }
        },
        pointOutlineWidth: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.pointOutlineWidth;
            }
        },
        labelColor: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelColor;
            }
        },
        labelOutlineColor: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelOutlineColor;
            }
        },
        labelOutlineWidth: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelOutlineWidth;
            }
        },
        labelStyle: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelStyle;
            }
        },
        font: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.font;
            }
        },
        labelText: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelText;
            }
        },
        backgroundColor: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.backgroundColor;
            }
        },
        backgroundPadding: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.backgroundPadding;
            }
        },
        backgroundEnabled: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.backgroundEnabled;
            }
        },
        scaleByDistance: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.scaleByDistance;
            }
        },
        translucencyByDistance: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.translucencyByDistance;
            }
        },
        distanceDisplayCondition: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.distanceDisplayCondition;
            }
        },
        heightOffset: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.heightOffset;
            }
        },
        anchorLineEnabled: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.anchorLineEnabled;
            }
        },
        anchorLineColor: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.anchorLineColor;
            }
        },
        image: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.image;
            }
        },
        disableDepthTestDistance: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.disableDepthTestDistance;
            }
        },
        horizontalOrigin: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.horizontalOrigin;
            }
        },
        verticalOrigin: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.verticalOrigin;
            }
        },
        labelHorizontalOrigin: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelHorizontalOrigin;
            }
        },
        labelVerticalOrigin: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.labelVerticalOrigin;
            }
        },
        xbsjPositionOffset: {
            get: function get() {
                return tileset.customStyle && tileset.customStyle.xbsjPositionOffset;
            }
        }
    });

    tileset.clippingPlanes = new Cesium.ClippingPlaneCollection({
        planes: [],
        edgeWidth: 1.0,
        unionClippingRegions: false
    });
}

exports.default = initTileset;

/***/ }),
/* 260 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(261);
var $Object = __webpack_require__(14).Object;
module.exports = function defineProperties(T, D) {
  return $Object.defineProperties(T, D);
};


/***/ }),
/* 261 */
/***/ (function(module, exports, __webpack_require__) {

var $export = __webpack_require__(16);
// 19.1.2.3 / 15.2.3.7 Object.defineProperties(O, Properties)
$export($export.S + $export.F * !__webpack_require__(23), 'Object', { defineProperties: __webpack_require__(136) });


/***/ }),
/* 262 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.getModelMatrix = exports.computeNewTransform = undefined;

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// const scratchMatrix = new Cesium.Matrix4();
// const scratchMatrix2 = new Cesium.Matrix4();
// const scratchMatrix3 = new Cesium.Matrix4();
// const scratchRM = new Cesium.Matrix3();
// const scratchCartesian = new Cesium.Cartesian3();
// function computeModelMatrix(tilesetCenter, {
//     diffX, diffY, diffHeight, rotateZ,
// }, result) {
//     const enuMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(tilesetCenter, undefined, scratchMatrix);
//     const enuInvMatrix = Cesium.Matrix4.inverseTransformation(enuMatrix, scratchMatrix2);
//     const rotation = Cesium.Matrix3.fromRotationZ(rotateZ, scratchRM);
//     const translation = Cesium.Cartesian3.fromElements(diffX, diffY, diffHeight, scratchCartesian);
//     const rt = Cesium.Matrix4.fromRotationTranslation(rotation, translation, scratchMatrix3);

//     Cesium.Matrix4.multiply(enuMatrix, rt, result);
//     Cesium.Matrix4.multiply(result, enuInvMatrix, result);
//     return result;
// }

var scratchMatrix = void 0;
var scratchMatrix2 = void 0;
var scratchCartesian = void 0;

function computeNewTransform(originTransform, _ref, result) {
    var xbsjPosition = _ref.xbsjPosition,
        xbsjRotation = _ref.xbsjRotation,
        xbsjScale = _ref.xbsjScale;

    scratchMatrix = scratchMatrix || new Cesium.Matrix4();
    scratchMatrix2 = scratchMatrix2 || new Cesium.Matrix4();
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();

    var originTransformInv = Cesium.Matrix4.inverseTransformation(originTransform, scratchMatrix);

    // Get the transform from local heading-pitch-roll at cartographic (0.0, 0.0) to Earth's fixed frame.
    var center = Cesium.Cartesian3.fromRadians(xbsjPosition[0], xbsjPosition[1], xbsjPosition[2], undefined, scratchCartesian);
    var hpr = new Cesium.HeadingPitchRoll(xbsjRotation[0], xbsjRotation[1], xbsjRotation[2]);
    var newTransfrom = Cesium.Transforms.headingPitchRollToFixedFrame(center, hpr);
    var scaleM = Cesium.Matrix4.fromScale(new (Function.prototype.bind.apply(Cesium.Cartesian3, [null].concat((0, _toConsumableArray3.default)(xbsjScale))))(), scratchMatrix2);
    newTransfrom = Cesium.Matrix4.multiply(newTransfrom, scaleM, newTransfrom);

    Cesium.Matrix4.multiply(newTransfrom, originTransformInv, result);

    return result;
}

var scratchPos = void 0;
var scratchHPR = void 0;
var scratchMatrix4 = void 0;
function getModelMatrix(longitude, latitude, height, heading, pitch, roll, result) {
    if (!result) {
        result = new Cesium.Matrix4();
    }

    scratchPos = scratchPos || new Cesium.Cartesian3();
    scratchHPR = scratchHPR || new Cesium.HeadingPitchRoll();
    scratchMatrix4 = scratchMatrix4 || new Cesium.Matrix4();

    var pos = Cesium.Cartesian3.fromRadians(longitude, latitude, height, undefined, scratchPos);

    scratchHPR.heading = heading;
    scratchHPR.pitch = pitch;
    scratchHPR.roll = roll;
    var modelMatrix = Cesium.Transforms.headingPitchRollToFixedFrame(pos, scratchHPR, undefined, undefined, result);
    Cesium.Matrix4.multiply(modelMatrix, Cesium.Axis.Z_UP_TO_X_UP, modelMatrix);

    return result;
}

exports.computeNewTransform = computeNewTransform;
exports.getModelMatrix = getModelMatrix;

/***/ }),
/* 263 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _map = __webpack_require__(79);

var _map2 = _interopRequireDefault(_map);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// classificationType
var classificationTypeArrays = [['ClassificationType.NONE', undefined], ['ClassificationType.BOTH', 2], // Cesium.ClassificationType.BOTH
['ClassificationType.CESIUM_3D_TILE', 1], // Cesium.ClassificationType.CESIUM_3D_TILE
['ClassificationType.TERRAIN', 0]];
var classificationTypeMaps = new _map2.default(classificationTypeArrays, classificationTypeArrays.map(function (_ref) {
    var _ref2 = (0, _slicedToArray3.default)(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];

    return [v, k];
}));

// shadowsType
var shadowsArrays = [['ShadowMode.DISABLED', 0], // Cesium.ShadowMode.DISABLED
['ShadowMode.ENABLED', 1], // Cesium.ShadowMode.ENABLED 
['ShadowMode.CAST_ONLY', 2], // Cesium.ShadowMode.CAST_ONLY
['ShadowMode.RECEIVE_ONLY', 3]];
var shadowsMaps = new _map2.default(shadowsArrays, shadowsArrays.map(function (_ref3) {
    var _ref4 = (0, _slicedToArray3.default)(_ref3, 2),
        k = _ref4[0],
        v = _ref4[1];

    return [v, k];
}));

var getProp = function getProp(maps, prop) {
    if (!maps.has(prop)) {
        throw new Error('prop ' + prop + ' is not right value!!!');
    }
    return maps.get(prop);
};

var valueTransforms = {
    classificationType: {
        jsonToCzm: function jsonToCzm(jsonProp) {
            return getProp(classificationTypeMaps, jsonProp);
        },
        czmToJson: function czmToJson(czmProp) {
            return getProp(classificationTypeMaps, czmProp);
        }
    },
    shadows: {
        jsonToCzm: function jsonToCzm(jsonProp) {
            return getProp(shadowsMaps, jsonProp);
        },
        czmToJson: function czmToJson(czmProp) {
            return getProp(shadowsMaps, czmProp);
        }
    },
    imageBasedLightingFactor: {
        jsonToCzm: function jsonToCzm(jsonProp, result) {
            return Cesium.Cartesian2.fromArray(jsonProp, 0, result);
        },
        czmToJson: function czmToJson(czmProp, result) {
            return result = result || new Array(2), result[0] = czmProp.x, result[1] = czmProp.y, result;
        }
    },
    lightColor: {
        jsonToCzm: function jsonToCzm(jsonProp, result) {
            if (jsonProp && jsonProp.length === 3) {
                if (!Array.isArray(jsonProp) || jsonProp.length !== 3 || jsonProp.some(function (e) {
                    return typeof e !== 'number';
                })) {
                    console.error('lightColor value type error!');
                }
                return Cesium.Cartesian3.fromArray(jsonProp, 0, result);
            } else {
                return undefined;
            }
        },
        czmToJson: function czmToJson(czmProp, result) {
            result = result || new Array(3);
            if (typeof czmProp === 'undefined') {
                result = undefined;
            } else {
                result[0] = czmProp.x;
                result[1] = czmProp.y;
                result[2] = czmProp.z;
            }
            return result;
        }
    },
    specularEnvironmentMaps: {
        jsonToCzm: function jsonToCzm(jsonProp) {
            if (typeof jsonProp === 'undefined') {
                return undefined;
            } else {
                return jsonProp;
            }
        },
        czmToJson: function czmToJson(czmProp) {
            if (typeof czmProp === 'undefined') {
                return undefined;
            } else {
                return czmProp;
            }
        }
    }
};

exports.default = valueTransforms;

/***/ }),
/* 264 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(265), __esModule: true };

/***/ }),
/* 265 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(61);
__webpack_require__(46);
module.exports = __webpack_require__(266);


/***/ }),
/* 266 */
/***/ (function(module, exports, __webpack_require__) {

var classof = __webpack_require__(73);
var ITERATOR = __webpack_require__(18)('iterator');
var Iterators = __webpack_require__(47);
module.exports = __webpack_require__(14).isIterable = function (it) {
  var O = Object(it);
  return O[ITERATOR] !== undefined
    || '@@iterator' in O
    // eslint-disable-next-line no-prototype-builtins
    || Iterators.hasOwnProperty(classof(O));
};


/***/ }),
/* 267 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(106);
__webpack_require__(46);
__webpack_require__(61);
__webpack_require__(268);
__webpack_require__(274);
__webpack_require__(277);
__webpack_require__(279);
module.exports = __webpack_require__(14).Map;


/***/ }),
/* 268 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var strong = __webpack_require__(269);
var validate = __webpack_require__(157);
var MAP = 'Map';

// 23.1 Map Objects
module.exports = __webpack_require__(270)(MAP, function (get) {
  return function Map() { return get(this, arguments.length > 0 ? arguments[0] : undefined); };
}, {
  // 23.1.3.6 Map.prototype.get(key)
  get: function get(key) {
    var entry = strong.getEntry(validate(this, MAP), key);
    return entry && entry.v;
  },
  // 23.1.3.9 Map.prototype.set(key, value)
  set: function set(key, value) {
    return strong.def(validate(this, MAP), key === 0 ? 0 : key, value);
  }
}, strong, true);


/***/ }),
/* 269 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var dP = __webpack_require__(27).f;
var create = __webpack_require__(70);
var redefineAll = __webpack_require__(111);
var ctx = __webpack_require__(32);
var anInstance = __webpack_require__(109);
var forOf = __webpack_require__(64);
var $iterDefine = __webpack_require__(94);
var step = __webpack_require__(144);
var setSpecies = __webpack_require__(156);
var DESCRIPTORS = __webpack_require__(23);
var fastKey = __webpack_require__(75).fastKey;
var validate = __webpack_require__(157);
var SIZE = DESCRIPTORS ? '_s' : 'size';

var getEntry = function (that, key) {
  // fast case
  var index = fastKey(key);
  var entry;
  if (index !== 'F') return that._i[index];
  // frozen object case
  for (entry = that._f; entry; entry = entry.n) {
    if (entry.k == key) return entry;
  }
};

module.exports = {
  getConstructor: function (wrapper, NAME, IS_MAP, ADDER) {
    var C = wrapper(function (that, iterable) {
      anInstance(that, C, NAME, '_i');
      that._t = NAME;         // collection type
      that._i = create(null); // index
      that._f = undefined;    // first entry
      that._l = undefined;    // last entry
      that[SIZE] = 0;         // size
      if (iterable != undefined) forOf(iterable, IS_MAP, that[ADDER], that);
    });
    redefineAll(C.prototype, {
      // 23.1.3.1 Map.prototype.clear()
      // 23.2.3.2 Set.prototype.clear()
      clear: function clear() {
        for (var that = validate(this, NAME), data = that._i, entry = that._f; entry; entry = entry.n) {
          entry.r = true;
          if (entry.p) entry.p = entry.p.n = undefined;
          delete data[entry.i];
        }
        that._f = that._l = undefined;
        that[SIZE] = 0;
      },
      // 23.1.3.3 Map.prototype.delete(key)
      // 23.2.3.4 Set.prototype.delete(value)
      'delete': function (key) {
        var that = validate(this, NAME);
        var entry = getEntry(that, key);
        if (entry) {
          var next = entry.n;
          var prev = entry.p;
          delete that._i[entry.i];
          entry.r = true;
          if (prev) prev.n = next;
          if (next) next.p = prev;
          if (that._f == entry) that._f = next;
          if (that._l == entry) that._l = prev;
          that[SIZE]--;
        } return !!entry;
      },
      // 23.2.3.6 Set.prototype.forEach(callbackfn, thisArg = undefined)
      // 23.1.3.5 Map.prototype.forEach(callbackfn, thisArg = undefined)
      forEach: function forEach(callbackfn /* , that = undefined */) {
        validate(this, NAME);
        var f = ctx(callbackfn, arguments.length > 1 ? arguments[1] : undefined, 3);
        var entry;
        while (entry = entry ? entry.n : this._f) {
          f(entry.v, entry.k, this);
          // revert to the last existing entry
          while (entry && entry.r) entry = entry.p;
        }
      },
      // 23.1.3.7 Map.prototype.has(key)
      // 23.2.3.7 Set.prototype.has(value)
      has: function has(key) {
        return !!getEntry(validate(this, NAME), key);
      }
    });
    if (DESCRIPTORS) dP(C.prototype, 'size', {
      get: function () {
        return validate(this, NAME)[SIZE];
      }
    });
    return C;
  },
  def: function (that, key, value) {
    var entry = getEntry(that, key);
    var prev, index;
    // change existing entry
    if (entry) {
      entry.v = value;
    // create new entry
    } else {
      that._l = entry = {
        i: index = fastKey(key, true), // <- index
        k: key,                        // <- key
        v: value,                      // <- value
        p: prev = that._l,             // <- previous entry
        n: undefined,                  // <- next entry
        r: false                       // <- removed
      };
      if (!that._f) that._f = entry;
      if (prev) prev.n = entry;
      that[SIZE]++;
      // add to index
      if (index !== 'F') that._i[index] = entry;
    } return that;
  },
  getEntry: getEntry,
  setStrong: function (C, NAME, IS_MAP) {
    // add .keys, .values, .entries, [@@iterator]
    // 23.1.3.4, 23.1.3.8, 23.1.3.11, 23.1.3.12, 23.2.3.5, 23.2.3.8, 23.2.3.10, 23.2.3.11
    $iterDefine(C, NAME, function (iterated, kind) {
      this._t = validate(iterated, NAME); // target
      this._k = kind;                     // kind
      this._l = undefined;                // previous
    }, function () {
      var that = this;
      var kind = that._k;
      var entry = that._l;
      // revert to the last existing entry
      while (entry && entry.r) entry = entry.p;
      // get next entry
      if (!that._t || !(that._l = entry = entry ? entry.n : that._t._f)) {
        // or finish the iteration
        that._t = undefined;
        return step(1);
      }
      // return step by kind
      if (kind == 'keys') return step(0, entry.k);
      if (kind == 'values') return step(0, entry.v);
      return step(0, [entry.k, entry.v]);
    }, IS_MAP ? 'entries' : 'values', !IS_MAP, true);

    // add [@@species], 23.1.2.2, 23.2.2.2
    setSpecies(NAME);
  }
};


/***/ }),
/* 270 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

var global = __webpack_require__(17);
var $export = __webpack_require__(16);
var meta = __webpack_require__(75);
var fails = __webpack_require__(39);
var hide = __webpack_require__(34);
var redefineAll = __webpack_require__(111);
var forOf = __webpack_require__(64);
var anInstance = __webpack_require__(109);
var isObject = __webpack_require__(25);
var setToStringTag = __webpack_require__(60);
var dP = __webpack_require__(27).f;
var each = __webpack_require__(271)(0);
var DESCRIPTORS = __webpack_require__(23);

module.exports = function (NAME, wrapper, methods, common, IS_MAP, IS_WEAK) {
  var Base = global[NAME];
  var C = Base;
  var ADDER = IS_MAP ? 'set' : 'add';
  var proto = C && C.prototype;
  var O = {};
  if (!DESCRIPTORS || typeof C != 'function' || !(IS_WEAK || proto.forEach && !fails(function () {
    new C().entries().next();
  }))) {
    // create collection constructor
    C = common.getConstructor(wrapper, NAME, IS_MAP, ADDER);
    redefineAll(C.prototype, methods);
    meta.NEED = true;
  } else {
    C = wrapper(function (target, iterable) {
      anInstance(target, C, NAME, '_c');
      target._c = new Base();
      if (iterable != undefined) forOf(iterable, IS_MAP, target[ADDER], target);
    });
    each('add,clear,delete,forEach,get,has,set,keys,values,entries,toJSON'.split(','), function (KEY) {
      var IS_ADDER = KEY == 'add' || KEY == 'set';
      if (KEY in proto && !(IS_WEAK && KEY == 'clear')) hide(C.prototype, KEY, function (a, b) {
        anInstance(this, C, KEY);
        if (!IS_ADDER && IS_WEAK && !isObject(a)) return KEY == 'get' ? undefined : false;
        var result = this._c[KEY](a === 0 ? 0 : a, b);
        return IS_ADDER ? this : result;
      });
    });
    IS_WEAK || dP(C.prototype, 'size', {
      get: function () {
        return this._c.size;
      }
    });
  }

  setToStringTag(C, NAME);

  O[NAME] = C;
  $export($export.G + $export.W + $export.F, O);

  if (!IS_WEAK) common.setStrong(C, NAME, IS_MAP);

  return C;
};


/***/ }),
/* 271 */
/***/ (function(module, exports, __webpack_require__) {

// 0 -> Array#forEach
// 1 -> Array#map
// 2 -> Array#filter
// 3 -> Array#some
// 4 -> Array#every
// 5 -> Array#find
// 6 -> Array#findIndex
var ctx = __webpack_require__(32);
var IObject = __webpack_require__(97);
var toObject = __webpack_require__(41);
var toLength = __webpack_require__(71);
var asc = __webpack_require__(272);
module.exports = function (TYPE, $create) {
  var IS_MAP = TYPE == 1;
  var IS_FILTER = TYPE == 2;
  var IS_SOME = TYPE == 3;
  var IS_EVERY = TYPE == 4;
  var IS_FIND_INDEX = TYPE == 6;
  var NO_HOLES = TYPE == 5 || IS_FIND_INDEX;
  var create = $create || asc;
  return function ($this, callbackfn, that) {
    var O = toObject($this);
    var self = IObject(O);
    var f = ctx(callbackfn, that, 3);
    var length = toLength(self.length);
    var index = 0;
    var result = IS_MAP ? create($this, length) : IS_FILTER ? create($this, 0) : undefined;
    var val, res;
    for (;length > index; index++) if (NO_HOLES || index in self) {
      val = self[index];
      res = f(val, index, O);
      if (TYPE) {
        if (IS_MAP) result[index] = res;   // map
        else if (res) switch (TYPE) {
          case 3: return true;             // some
          case 5: return val;              // find
          case 6: return index;            // findIndex
          case 2: result.push(val);        // filter
        } else if (IS_EVERY) return false; // every
      }
    }
    return IS_FIND_INDEX ? -1 : IS_SOME || IS_EVERY ? IS_EVERY : result;
  };
};


/***/ }),
/* 272 */
/***/ (function(module, exports, __webpack_require__) {

// 9.4.2.3 ArraySpeciesCreate(originalArray, length)
var speciesConstructor = __webpack_require__(273);

module.exports = function (original, length) {
  return new (speciesConstructor(original))(length);
};


/***/ }),
/* 273 */
/***/ (function(module, exports, __webpack_require__) {

var isObject = __webpack_require__(25);
var isArray = __webpack_require__(145);
var SPECIES = __webpack_require__(18)('species');

module.exports = function (original) {
  var C;
  if (isArray(original)) {
    C = original.constructor;
    // cross-realm fallback
    if (typeof C == 'function' && (C === Array || isArray(C.prototype))) C = undefined;
    if (isObject(C)) {
      C = C[SPECIES];
      if (C === null) C = undefined;
    }
  } return C === undefined ? Array : C;
};


/***/ }),
/* 274 */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var $export = __webpack_require__(16);

$export($export.P + $export.R, 'Map', { toJSON: __webpack_require__(275)('Map') });


/***/ }),
/* 275 */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/DavidBruant/Map-Set.prototype.toJSON
var classof = __webpack_require__(73);
var from = __webpack_require__(276);
module.exports = function (NAME) {
  return function toJSON() {
    if (classof(this) != NAME) throw TypeError(NAME + "#toJSON isn't generic");
    return from(this);
  };
};


/***/ }),
/* 276 */
/***/ (function(module, exports, __webpack_require__) {

var forOf = __webpack_require__(64);

module.exports = function (iter, ITERATOR) {
  var result = [];
  forOf(iter, false, result.push, result, ITERATOR);
  return result;
};


/***/ }),
/* 277 */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-map.of
__webpack_require__(278)('Map');


/***/ }),
/* 278 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://tc39.github.io/proposal-setmap-offrom/
var $export = __webpack_require__(16);

module.exports = function (COLLECTION) {
  $export($export.S, COLLECTION, { of: function of() {
    var length = arguments.length;
    var A = new Array(length);
    while (length--) A[length] = arguments[length];
    return new this(A);
  } });
};


/***/ }),
/* 279 */
/***/ (function(module, exports, __webpack_require__) {

// https://tc39.github.io/proposal-setmap-offrom/#sec-map.from
__webpack_require__(280)('Map');


/***/ }),
/* 280 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

// https://tc39.github.io/proposal-setmap-offrom/
var $export = __webpack_require__(16);
var aFunction = __webpack_require__(57);
var ctx = __webpack_require__(32);
var forOf = __webpack_require__(64);

module.exports = function (COLLECTION) {
  $export($export.S, COLLECTION, { from: function from(source /* , mapFn, thisArg */) {
    var mapFn = arguments[1];
    var mapping, A, n, cb;
    aFunction(this);
    mapping = mapFn !== undefined;
    if (mapping) aFunction(mapFn);
    if (source == undefined) return new this();
    A = [];
    if (mapping) {
      n = 0;
      cb = ctx(mapFn, arguments[2], 2);
      forOf(source, false, function (nextItem) {
        A.push(cb(nextItem, n++));
      });
    } else {
      forOf(source, false, A.push, A);
    }
    return new this(A);
  } });
};


/***/ }),
/* 281 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'show', 'maximumScreenSpaceError', 'maximumMemoryUsage', 'cullWithChildrenBounds', 'dynamicScreenSpaceError', 'dynamicScreenSpaceErrorDensity', 'dynamicScreenSpaceErrorFactor', 'dynamicScreenSpaceErrorHeightFalloff', 'skipLevelOfDetail', 'baseScreenSpaceError', 'skipScreenSpaceErrorFactor', 'skipLevels', 'immediatelyLoadDesiredLevelOfDetail', 'loadSiblings', 'luminanceAtZenith', 'classificationType', 'shadows', 'imageBasedLightingFactor', 'lightColor', 'specularEnvironmentMaps', 'preferLeaves']
}, {
    name: {
        chinese: '扩展',
        english: 'Extension'
    },
    properties: ['xbsjPosition', 'xbsjRotation', 'xbsjScale', 'xbsjUseOriginTransform', 'xbsjLeftTopView', 'xbsjRightTopView', 'xbsjLeftBottomView', 'xbsjRightBottomView', 'xbsjStyle', 'xbsjFlattenGuid', 'xbsjClippingPlanes', 'xbsjCriticalElevation', 'xbsjCriticalElevationColor']
}, {
    name: {
        chinese: '调试',
        english: 'Debug'
    },
    properties: ['debugFreezeFrame', 'debugColorizeTiles', 'debugWireframe', 'debugShowBoundingVolume', 'debugShowContentBoundingVolume', 'debugShowViewerRequestVolume', 'debugShowGeometricError', 'debugShowRenderingStatistics', 'debugShowMemoryUsage', 'debugShowUrl']
}];

exports.default = xbsjClassification;

/***/ }),
/* 282 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _ClippingPlanes = __webpack_require__(151);

var _ClippingPlanes2 = _interopRequireDefault(_ClippingPlanes);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var xbsjSchema = {
  title: "Tileset Property",
  type: "object",
  properties: {
    /**
     * 三维瓦片数据服务路径
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.Tileset
     */
    url: { type: "string", title: "url", default: "", description: 'url' },
    /**
     * 是否可见
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    show: { type: "boolean", title: "show", default: true, description: "Determines if the tileset will be shown" },
    /**
     * The maximum screen space error used to drive level of detail refinement.
     * @description 值越小越精细、值越大越粗糙。取值范围(0, +∞)
     * @type {number}
     * @instance
     * @default 16
     * @memberof Obj.Tileset
     */
    maximumScreenSpaceError: { type: 'number', default: 16, description: "The maximum screen space error used to drive level of detail refinement." },
    /**
     * The maximum amount of memory in MB that can be used by the tileset.
     * @description 默认值512M
     * @type {number}
     * @instance
     * @default 512
     * @memberof Obj.Tileset
     */
    maximumMemoryUsage: { type: 'number', default: 512, description: "The maximum amount of memory in MB that can be used by the tileset." },
    /**
     * Optimization option. Whether to cull tiles using the union of their children bounding volumes.
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    cullWithChildrenBounds: { type: 'boolean', default: true, description: "Optimization option. Whether to cull tiles using the union of their children bounding volumes." },
    dynamicScreenSpaceError: { type: 'boolean', default: false, description: "Optimization option. Reduce the screen space error for tiles that are further away from the camera." },
    dynamicScreenSpaceErrorDensity: { type: 'number', default: 0.00278, description: "Density used to adjust the dynamic screen space error, similar to fog density." },
    dynamicScreenSpaceErrorFactor: { type: 'number', default: 4.0, description: "A factor used to increase the computed dynamic screen space error." },
    dynamicScreenSpaceErrorHeightFalloff: { type: 'number', default: 0.25, description: "A ratio of the tileset's height at which the density starts to falloff." },
    skipLevelOfDetail: { type: 'boolean', default: true, description: "Optimization option. Determines if level of detail skipping should be applied during the traversal." },
    baseScreenSpaceError: { type: 'number', default: 1024, description: "When skipLevelOfDetail is true, the screen space error that must be reached before skipping levels of detail." },
    skipScreenSpaceErrorFactor: { type: 'number', default: 16, description: "When skipLevelOfDetail is true, a multiplier defining the minimum screen space error to skip. Used in conjunction with skipLevels to determine which tiles to load." },
    skipLevels: { type: 'number', default: 1, description: "When skipLevelOfDetail is true, a constant defining the minimum number of levels to skip when loading tiles. When it is 0, no levels are skipped. Used in conjunction with skipScreenSpaceErrorFactor to determine which tiles to load." },
    immediatelyLoadDesiredLevelOfDetail: { type: 'boolean', default: false, description: "When skipLevelOfDetail is true, only tiles that meet the maximum screen space error will ever be downloaded. Skipping factors are ignored and just the desired tiles are loaded." },
    loadSiblings: { type: 'boolean', default: false, description: "When skipLevelOfDetail is true, determines whether siblings of visible tiles are always downloaded during traversal." },
    /**
     * optional The sun's luminance at the zenith in kilo candela per meter squared to use for this model's procedural environment map.
     * @type {number}
     * @instance
     * @default 0.5
     * @memberof Obj.Tileset
     */
    luminanceAtZenith: { type: 'number', default: 0.5, description: "optional The sun's luminance at the zenith in kilo candela per meter squared to use for this model's procedural environment map." },
    preferLeaves: { type: 'boolean', default: false, description: "preferLeaves" },
    debugFreezeFrame: { type: 'boolean', default: false, description: "For debugging only. Determines if only the tiles from last frame should be used for rendering." },
    debugColorizeTiles: { type: 'boolean', default: false, description: "For debugging only. When true, assigns a random color to each tile." },
    debugWireframe: { type: 'boolean', default: false, description: "For debugging only. When true, render's each tile's content as a wireframe." },
    debugShowBoundingVolume: { type: 'boolean', default: false, description: "For debugging only. When true, renders the bounding volume for each tile." },
    debugShowContentBoundingVolume: { type: 'boolean', default: false, description: "For debugging only. When true, renders the bounding volume for each tile's content." },
    debugShowViewerRequestVolume: { type: 'boolean', default: false, description: "For debugging only. When true, renders the viewer request volume for each tile." },
    debugShowGeometricError: { type: 'boolean', default: false, description: "For debugging only. When true, draws labels to indicate the geometric error of each tile." },
    debugShowRenderingStatistics: { type: 'boolean', default: false, description: "For debugging only. When true, draws labels to indicate the number of commands, points, triangles and features for each tile." },
    debugShowMemoryUsage: { type: 'boolean', default: false, description: "For debugging only. When true, draws labels to indicate the texture and geometry memory in megabytes used by each tile." },
    debugShowUrl: { type: 'boolean', default: false, description: "For debugging only. When true, draws labels to indicate the url of each tile." },
    classificationType: { type: 'string', default: 'ClassificationType.NONE', enum: ['ClassificationType.NONE', 'ClassificationType.BOTH', 'ClassificationType.CESIUM_3D_TILE', 'ClassificationType.TERRAIN'], description: "分类样式" },
    shadows: { type: 'string', default: 'ShadowMode.ENABLED', enum: ['ShadowMode.DISABLED', 'ShadowMode.ENABLED', 'ShadowMode.CAST_ONLY', 'ShadowMode.RECEIVE_ONLY'], description: "Determines whether the tileset casts or receives shadows from each light source." },
    /**
     * optional Scales the diffuse and specular image-based lighting from the earth, sky, atmosphere and star skybox. 分别对应散射光强和镜面光强
     * @type {array}
     * @default [1, 1]
     * @instance
     * @memberof Obj.Tileset
     */
    imageBasedLightingFactor: { type: 'array', items: { type: 'number', minimum: 0, maximum: 1 }, minItems: 2, maxItems: 2, default: [1, 1], description: "Scales the diffuse and specular image-based lighting from the earth, sky, atmosphere and star skybox." },
    /**
     * The color and intensity of the sunlight used to shade models. <br/>
     * 默认值为undefined
     * @type {array}
     * @instance
     * @memberof Obj.Tileset
     */
    lightColor: { type: 'array', items: { type: 'number', minimum: 0, maximum: 1 }, minItems: 3, maxItems: 3, default: [1, 1, 1], description: "The color and intensity of the sunlight used to shade models." },
    specularEnvironmentMaps: { type: 'string', default: '', description: "URL to a KTX file that contains a cube map of the specular lighting and the convoluted specular mipmaps." },
    /**
     * 位置数组 [经度、纬度、高度] <br/>
     * 注意：xbsjUseOriginTransform为false，此属性才会生效。经度、纬度的单位是弧度，高度的单位是米。
     * @type {array}
     * @instance
     * @memberof Obj.Tileset
     */
    xbsjPosition: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '位置（经度, 纬度, 高度）' },
    /**
     * 姿态数组 [偏航角、俯仰角、翻转角] <br/>
     * 注意：xbsjUseOriginTransform为false，此属性才会生效。偏航角、俯仰角、翻转角的单位是弧度。
     * @type {array}
     * @default [0, 0, 0]
     * @instance
     * @memberof Obj.Tileset
     */
    xbsjRotation: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '姿态（偏航角, 俯仰角, 翻转角）' },
    /**
     * @description 缩放数组 [x向，y向，z向] <br/>
     * 注意：xbsjUseOriginTransform为false，此属性才会生效。
     * @type {array}
     * @default [1, 1, 1]
     * @instance
     * @memberof Obj.Tileset
     */
    xbsjScale: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [1.0, 1.0, 1.0], description: '缩放（x向, y向, z向）' },
    /**
     * 是否使用三维瓦片自带的默认位置姿态加载
     * @description 如果不使用默认位置姿态，将以xbsjPosition、xbsjRotation属性的设置为准来调整三位瓦片的位置姿态。
     * @type {boolean}
     * @instance
     * @memberof Obj.Tileset
     */
    xbsjUseOriginTransform: { type: 'boolean', default: true, description: "是否使用原始矩阵，否则将使用xbsjPosition、xbsjRotation来设置模型的位置和姿态." },
    /**
     * 多视口情况下，是否显示在左上角。
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    xbsjLeftTopView: { type: 'boolean', default: true, description: "是否显示在左上角视口" },
    /**
     * 多视口情况下，是否显示在右上角。
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    xbsjRightTopView: { type: 'boolean', default: true, description: "是否显示在右上角视口" },
    /**
     * 多视口情况下，是否显示在左下角。
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    xbsjLeftBottomView: { type: 'boolean', default: true, description: "是否显示在左下角视口" },
    /**
     * 多视口情况下，是否显示在右下角。
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Tileset
     */
    xbsjRightBottomView: { type: 'boolean', default: true, description: "是否显示在右下角视口" },
    /**
     * 样式设置<br/>
     * 具体使用参见：<br/>
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.Tileset
     * @see {@link https://github.com/AnalyticalGraphicsInc/3d-tiles/tree/master/specification/Styling style设置帮助}
     * @see {@link https://xiaofeii.gitee.io/cesium/Cesium-1.60/Build/Documentation/Cesium3DTileStyle.html?classFilter=style style类说明}
     */
    xbsjStyle: { type: 'string', default: '', description: "三维瓦片的样式设置" },
    /**
     * 压平GUID
     * @description 一旦指定，则会根据响应guid的压平多边形集合来对三维瓦片数据进行压平处理
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.Tileset
     */
    xbsjFlattenGuid: { type: 'string', default: '', description: "绑定压平纹理" },
    // TODO(vtxf): 未完成
    /**
     * 剖切面设置
     * @type {object}
     * @instance
     * @default ''
     * @memberof Obj.Tileset
     */
    xbsjClippingPlanes: _ClippingPlanes2.default.xbsjSchema,
    /**
     * 水淹高度设置
     * @type {number}
     * @instance
     * @default -Infinity
     * @memberof Obj.Tileset
     */
    xbsjCriticalElevation: { type: 'number', default: -Infinity, description: "水淹高度" },
    /**
     * 水淹颜色设置
     * @description 类型是一个包含4个元素的数组，元素为number类型，范围在0-1之间。
     * @type {array}
     * @instance
     * @default -Infinity
     * @memberof Obj.Tileset
     */
    xbsjCriticalElevationColor: { type: 'array', items: { type: 'number', minimum: 0, maximum: 1 }, minItems: 4, maxItems: 4, default: [0, 1, 0, 0.5], description: '剖切处的颜色' }
  }
};

exports.default = xbsjSchema;

/***/ }),
/* 283 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _extends2 = __webpack_require__(63);

var _extends3 = _interopRequireDefault(_extends2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _TerrainProvider = __webpack_require__(284);

var _TerrainProvider2 = _interopRequireDefault(_TerrainProvider);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 示例
// var xbsjTerrain = new XbsjEarth.Terrain(viewer.scene);
// xbsjTerrain.xbsjTerrainProvider = new XbsjEarth.XbsjCesiumTerrainProvider();
// xbsjTerrain.xbsjTerrainProvider.url = 'http://114.116.116.117/api/wmts/terrain/5cbb024d053f8d0e8018cc0d';

/**
 * 地形类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var Terrain = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Terrain, _XbsjCzmObj);

    function Terrain(earth, guid) {
        (0, _classCallCheck3.default)(this, Terrain);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Terrain.__proto__ || (0, _getPrototypeOf2.default)(Terrain)).call(this, earth, guid));

        var scene = earth.czm.scene;

        _this._scene = scene;

        earth._xbsjTerrains.push(_this);

        _this._terrainProvider = undefined;

        _this._disposers = [];
        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _XbsjBase2.default.registerProperty(_this, 'xbsjTerrainProvider', Terrain.defaultOptions.xbsjTerrainProvider);

        _this.xbsjTerrainProvider.XbsjCesiumTerrainProvider = new _TerrainProvider2.default.XbsjCesiumTerrainProvider();
        _this.xbsjTerrainProvider.XbsjEllipsoidTerrainProvider = new _TerrainProvider2.default.XbsjEllipsoidTerrainProvider();
        _XbsjBase2.default.registerProperty(_this.xbsjTerrainProvider, 'XbsjCesiumTerrainProvider');
        _XbsjBase2.default.registerProperty(_this.xbsjTerrainProvider, 'XbsjEllipsoidTerrainProvider');

        _this._disposers.push((0, _mobx.reaction)(function () {
            return {
                provider: _this.xbsjTerrainProvider,
                type: _this.xbsjTerrainProvider.type,
                providerOptions: (0, _extends3.default)({}, _this.xbsjTerrainProvider[_this.xbsjTerrainProvider.type])
                // ...this.xbsjTerrainProvider,
            };
        }, function () {
            if (_this.xbsjTerrainProvider.type === 'XbsjCesiumTerrainProvider') {
                var provider = _this.xbsjTerrainProvider['XbsjCesiumTerrainProvider'];

                var url = provider.url;
                if (provider.url.startsWith('Ion(')) {
                    var rr = /Ion\((\d+)/.exec(provider.url);
                    var assetId = rr[1] && +rr[1];
                    assetId && (url = Cesium.IonResource.fromAssetId(assetId));
                }

                _this._terrainProvider = new Cesium.CesiumTerrainProvider({
                    url: url,
                    requestVertexNormals: provider.requestVertexNormals,
                    requestWaterMask: provider.requestWaterMask,
                    requestMetadata: provider.requestMetadata
                });
            } else if (_this.xbsjTerrainProvider.type === 'XbsjEllipsoidTerrainProvider') {
                _this._terrainProvider = new Cesium.EllipsoidTerrainProvider();
            } else {
                throw new Error('xbsjTerrainProvider 未知类型！');
            }

            _this._terrainProvider && (_this._terrainProvider.show = _this.show);
            _this._earth._xbsjTerrainZIndexDirty = true;
        }, {
            fireImmediately: true
        }));

        _this._disposers.push((0, _mobx.autorun)(function () {
            var show = _this.show;
            _this._terrainProvider && (_this._terrainProvider.show = show);
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return [_this.show, _this.xbsjZIndex];
        }, function () {
            _this._earth._xbsjTerrainZIndexDirty = true;
        }, {
            fireImmediately: true
        }));
        return _this;
    }

    (0, _createClass3.default)(Terrain, [{
        key: 'flyTo',
        value: function flyTo() {
            if (this.rectangle && this.rectangle.length === 4) {
                this._scene.camera.flyTo({
                    destination: new (Function.prototype.bind.apply(Cesium.Rectangle, [null].concat((0, _toConsumableArray3.default)(this.rectangle))))()
                });
            }
        }
    }, {
        key: 'xbsjFromJSON',
        value: function xbsjFromJSON(jsonObject) {
            return (0, _get3.default)(Terrain.prototype.__proto__ || (0, _getPrototypeOf2.default)(Terrain.prototype), 'xbsjFromJSON', this).call(this, jsonObject);
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            var index = this._earth._xbsjTerrains.indexOf(this);
            if (index === -1) {
                throw new Error('this._earth._xbsjTerrains must contain!');
            }
            this._earth._xbsjTerrains.splice(index, 1);

            this._terrainProvider = undefined;
            this._earth._xbsjTerrainZIndexDirty = true;

            this._disposers.forEach(function (v) {
                return v();
            });
            this._disposers.length = 0;
            return (0, _get3.default)(Terrain.prototype.__proto__ || (0, _getPrototypeOf2.default)(Terrain.prototype), 'destroy', this).call(this);
        }
    }]);
    return Terrain;
}(_XbsjCzmObj3.default);

Terrain.TerrainProvider = _TerrainProvider2.default;

Terrain.defaultOptions = {
    /**
     * TerrainProvider设置
     * @type {object}
     * @property {string} type                             - 类型，可以是XbsjEllipsoidTerrainProvider/XbsjCesiumTerrainProvider
     * @property {Obj.Terrain.TerrainProvider.XbsjEllipsoidTerrainProvider} XbsjEllipsoidTerrainProvider      - XbsjEllipsoidTerrainProvider类型的具体设置
     * @property {Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider} XbsjCesiumTerrainProvider         - XbsjCesiumTerrainProvider类型的具体设置
     * @instance
     * @memberof Obj.Terrain
     */
    xbsjTerrainProvider: {
        type: 'XbsjEllipsoidTerrainProvider',
        XbsjEllipsoidTerrainProvider: null,
        XbsjCesiumTerrainProvider: null
    },
    /**
     * 用来确定显示优先级，场景中只显示优先级最高的地形。
     * @type {number}
     * @instance
     * @default 0
     * @memberof Obj.Terrain
     */
    xbsjZIndex: 0,
    /**
     * 是否在三维窗口中显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Terrain
     */
    show: true,
    /**
     * 作用范围 [西, 南, 东, 北]
     * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
     * @type {array}
     * @instance
     * @default [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5]
     * @memberof Obj.Terrain
     */
    rectangle: [-Math.PI, -Math.PI * 0.5, Math.PI, Math.PI * 0.5]
};

var xbsjSchema = {
    title: "Terrain Property",
    type: "object",
    properties: {
        /**
         * TerrainProvider设置
         * @type {object}
         * @property {string} type                             - 类型，可以是XbsjEllipsoidTerrainProvider/XbsjCesiumTerrainProvider
         * @property {Obj.Terrain.TerrainProvider.XbsjEllipsoidTerrainProvider} XbsjEllipsoidTerrainProvider      - XbsjEllipsoidTerrainProvider类型的具体设置
         * @property {Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider} XbsjCesiumTerrainProvider         - XbsjCesiumTerrainProvider类型的具体设置
         * @instance
         * @memberof Obj.Terrain
         */
        xbsjTerrainProvider: {
            type: 'object',
            title: "地形资源提供",
            description: "地形资源提供",
            properties: {
                type: {
                    type: "string",
                    default: 'XbsjEllipsoidTerrainProvider',
                    enum: ['XbsjEllipsoidTerrainProvider', 'XbsjCesiumTerrainProvider'],
                    description: "provider类型"
                },
                XbsjEllipsoidTerrainProvider: _TerrainProvider2.default.XbsjEllipsoidTerrainProvider.xbsjSchema,
                XbsjCesiumTerrainProvider: _TerrainProvider2.default.XbsjCesiumTerrainProvider.xbsjSchema
            }
        },
        /**
         * 用来确定显示优先级，场景中只显示优先级最高的地形。
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.Terrain
         */
        xbsjZIndex: { type: "number", title: "显示优先级", default: 0, description: '显示优先级' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Terrain
         */
        show: { type: "boolean", title: "显示", default: true, description: '显示' },
        /**
         * 作用范围 [西, 南, 东, 北]
         * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
         * @type {array}
         * @instance
         * @default [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5]
         * @memberof Obj.Terrain
         */
        rectangle: { type: "array", title: "作用范围 [西, 南, 东, 北]", default: [-Math.PI, -Math.PI * 0.5, Math.PI, Math.PI * 0.5], description: '作用范围 [西, 南, 东, 北]' }

        // disableDepthTestDistance只能设置最大值10000000，如果超过Cesium就不起作用了，导致从太空观察时，poi不绘制。

    } };Terrain.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'xbsjTerrainProvider', 'xbsjZIndex', 'rectangle']
}];

Terrain.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Terrain, 'Terrain');

exports.default = Terrain;

/***/ }),
/* 284 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _XbsjCesiumTerrainProvider = __webpack_require__(285);

var _XbsjCesiumTerrainProvider2 = _interopRequireDefault(_XbsjCesiumTerrainProvider);

var _XbsjEllipsoidTerrainProvider = __webpack_require__(286);

var _XbsjEllipsoidTerrainProvider2 = _interopRequireDefault(_XbsjEllipsoidTerrainProvider);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * @namespace
 * @memberof Obj.Terrain
 */
var TerrainProvider = {
  XbsjCesiumTerrainProvider: _XbsjCesiumTerrainProvider2.default,
  XbsjEllipsoidTerrainProvider: _XbsjEllipsoidTerrainProvider2.default
};

exports.default = TerrainProvider;

/***/ }),
/* 285 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * Cesium样式地形服务提供类
 * @memberof Obj.Terrain.TerrainProvider
 * @class
 * @extends XbsjBase
 */
var XbsjCesiumTerrainProvider = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjCesiumTerrainProvider, _XbsjBase);

    function XbsjCesiumTerrainProvider() {
        (0, _classCallCheck3.default)(this, XbsjCesiumTerrainProvider);
        return (0, _possibleConstructorReturn3.default)(this, (XbsjCesiumTerrainProvider.__proto__ || (0, _getPrototypeOf2.default)(XbsjCesiumTerrainProvider)).call(this));
    }

    (0, _createClass3.default)(XbsjCesiumTerrainProvider, [{
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(XbsjCesiumTerrainProvider.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsjCesiumTerrainProvider.prototype), 'destroy', this).call(this);
        }
    }]);
    return XbsjCesiumTerrainProvider;
}(_XbsjBase3.default);

XbsjCesiumTerrainProvider.defaultOptions = {
    url: '',
    requestVertexNormals: false,
    requestWaterMask: false,
    requestMetadata: false
};

var xbsjSchema = {
    title: "XbsjCesiumTerrainProvider Property",
    type: "object",
    properties: {
        /**
         * 服务路径
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider
         */
        url: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * 是否提供顶点法线
         * @type {boolean}
         * @instance
         * @default ''
         * @memberof Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider
         */
        requestVertexNormals: { type: "boolean", title: "requestVertexNormals", default: false, description: 'requestVertexNormals' },
        /**
         * 是否提供水面遮罩
         * @type {boolean}
         * @instance
         * @default ''
         * @memberof Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider
         */
        requestWaterMask: { type: "boolean", title: "requestWaterMask", default: false, description: 'requestWaterMask' },
        /**
         * 是否提供元信息
         * @type {boolean}
         * @instance
         * @default ''
         * @memberof Obj.Terrain.TerrainProvider.XbsjCesiumTerrainProvider
         */
        requestMetadata: { type: "boolean", title: "requestMetadata", default: false, description: 'requestMetadata' }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'requestVertexNormals', 'requestWaterMask', 'requestMetadata']
}];

XbsjCesiumTerrainProvider.xbsjSchema = xbsjSchema;
XbsjCesiumTerrainProvider.xbsjClassification = xbsjClassification;

exports.default = XbsjCesiumTerrainProvider;

/***/ }),
/* 286 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {};

/**
 * 椭球地形服务提供类
 * @memberof Obj.Terrain.TerrainProvider
 * @class
 * @extends XbsjBase
 */

var XbsjEllipsoidTerrainProvider = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjEllipsoidTerrainProvider, _XbsjBase);

    function XbsjEllipsoidTerrainProvider() {
        (0, _classCallCheck3.default)(this, XbsjEllipsoidTerrainProvider);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjEllipsoidTerrainProvider.__proto__ || (0, _getPrototypeOf2.default)(XbsjEllipsoidTerrainProvider)).call(this));

        (0, _mobx.extendObservable)(_this, defaultOptions);
        return _this;
    }

    return XbsjEllipsoidTerrainProvider;
}(_XbsjBase3.default);

XbsjEllipsoidTerrainProvider.defaultOptions = defaultOptions;

var xbsjSchema = {
    title: "XbsjEllipsoidTerrainProvider Property",
    type: "object",
    properties: {}
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: []
}];

XbsjEllipsoidTerrainProvider.xbsjSchema = xbsjSchema;
XbsjEllipsoidTerrainProvider.xbsjClassification = xbsjClassification;

exports.default = XbsjEllipsoidTerrainProvider;

/***/ }),
/* 287 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _freeze = __webpack_require__(288);

var _freeze2 = _interopRequireDefault(_freeze);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _map = __webpack_require__(79);

var _map2 = _interopRequireDefault(_map);

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _classification = __webpack_require__(291);

var _classification2 = _interopRequireDefault(_classification);

var _ImageryProvider = __webpack_require__(158);

var _ImageryProvider2 = _interopRequireDefault(_ImageryProvider);

var _jsonSchema = __webpack_require__(297);

var _jsonSchema2 = _interopRequireDefault(_jsonSchema);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    // imageryProvider: 
    // imageryProviderOptions: {},
    // rectangle: imageryProvider.rectangle
    alpha: 1.0,
    brightness: 1.0,
    contrast: 1.0,
    hue: 0.0,
    saturation: 1.0,
    gamma: 1.0,
    // splitDirection: ImagerySplitDirection.NONE
    // minificationFilter: TextureMinificationFilter.LINEAR
    // magnificationFilter: TextureMagnificationFilter.LINEAR
    show: true,
    // maximumAnisotropy: maximum supported
    // minimumTerrainLevel: 
    // maximumTerrainLevel: 
    // cutoutRectangle: 
    // colorToAlpha: 
    colorToAlphaThreshold: 0.004
};

// 需要改造的属性值默认值
(0, _assign2.default)(defaultOptions, {
    // imageryProvider: '',
    splitDirection: 'ImagerySplitDirection.NONE',
    // minificationFilter: 'TextureMinificationFilter.LINEAR',
    // magnificationFilter: 'TextureMagnificationFilter.LINEAR',
    rectangle: undefined
});

// 扩展的属性值默认值
(0, _assign2.default)(defaultOptions, {
    xbsjImageryProvider: {
        XbsjImageryProvider: {},
        UrlTemplateImageryProvider: {},
        WebMapTileServiceImageryProvider: {},
        createTileMapServiceImageryProvider: {},
        type: 'XbsjImageryProvider'
    },
    xbsjZIndex: 0
});

// classificationType
var splitDirectionArray = [['ImagerySplitDirection.NONE', 0.0], // Cesium.ImagerySplitDirection.NONE
['ImagerySplitDirection.LEFT', -1.0], // Cesium.ImagerySplitDirection.LEFT
['ImagerySplitDirection.RIGHT', 1.0]];
var splitDirectionMap = new _map2.default(splitDirectionArray, splitDirectionArray.map(function (_ref) {
    var _ref2 = (0, _slicedToArray3.default)(_ref, 2),
        k = _ref2[0],
        v = _ref2[1];

    return [v, k];
}));

var getProp = function getProp(maps, prop) {
    if (!maps.has(prop)) {
        throw new Error('prop ' + prop + ' is not right value!!!');
    }
    return maps.get(prop);
};

// 示例1
// 
// var xbsjImageryLayer = new XbsjEarth.Imagery(viewer.scene);
// xbsjImageryLayer.xbsjImageryProvider = {
//     type: 'XbsjImageryProvider',
//     uri: 'http://www.google.cn/maps/vt?lyrs=s&gl=CN&x={x}&y={y}&z={z}',
//     srcCoordType: 'GCJ02', // 原影像坐标系
//     dstCoordType: 'WGS84', // 转成WGS84坐标系
//     // rectangle: Cesium.Rectangle.fromDegrees(-180, -90, 180, 90),
//     rectangle: [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5],
// };
// xbsjImageryLayer.hue = 0.5;
// 
// 示例2
//
// var xbsjImageryLayer2 = new XbsjEarth.Imagery(viewer.scene);
// xbsjImageryLayer2.xbsjImageryProvider = {
//     type: 'XbsjImageryProvider',
//     uri: 'http://online2.map.bdimg.com/onlinelabel/?qt=tile&styles=pl&x={x}&y={y}&z={z}',
//     srcCoordType: 'BD09',
//     dstCoordType: 'WGS84', // 转成WGS84坐标系
//     rectangle: [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5],
// };
//
// 示例3
// var xbsjImageryLayer3 = new XbsjEarth.Imagery(viewer.scene);
// xbsjImageryLayer3.xbsjImageryProvider = {
//     type: 'UrlTemplateImageryProvider',
//     uri: 'http://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}&s=Gali',
//     rectangle: [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5],
// };

/**
 * 影像类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Imagery = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Imagery, _XbsjCzmObj);

    function Imagery(earth, guid) {
        (0, _classCallCheck3.default)(this, Imagery);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Imagery.__proto__ || (0, _getPrototypeOf2.default)(Imagery)).call(this, earth, guid));

        var scene = earth.czm.scene;
        _this._scene = scene;

        // this._imageryLayer = undefined;
        (0, _mobx.extendObservable)(_this, {
            _imageryLayer: undefined
        }, {
            _imageryLayer: _mobx.observable.ref
        });

        _this.disposers.push(function () {
            _this._imageryLayer && _this._scene.imageryLayers.remove(_this._imageryLayer);
            _this._imageryLayer = undefined;
        });

        earth._xbsjImageries.push(_this);
        _this.disposers.push(function () {
            var index = earth._xbsjImageries.indexOf(_this);
            if (index === -1) {
                throw new Error('earth._xbsjImageries must contain!');
            }
            earth._xbsjImageries.splice(index, 1);
        });

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this.xbsjImageryProvider.UrlTemplateImageryProvider = new _ImageryProvider2.default.UrlTemplateImageryProvider();
        _this.xbsjImageryProvider.XbsjImageryProvider = new _ImageryProvider2.default.XbsjImageryProvider();
        _this.xbsjImageryProvider.WebMapTileServiceImageryProvider = new _ImageryProvider2.default.WebMapTileServiceImageryProvider();
        _this.xbsjImageryProvider.createTileMapServiceImageryProvider = new _ImageryProvider2.default.createTileMapServiceImageryProvider();

        _this.disposers.push(_XbsjBase2.default.registerProperty(_this, 'xbsjImageryProvider', Imagery.defaultOptions.xbsjImageryProvider));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.xbsjImageryProvider, 'UrlTemplateImageryProvider', _ImageryProvider2.default.UrlTemplateImageryProvider.defaultOptions));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.xbsjImageryProvider, 'XbsjImageryProvider', _ImageryProvider2.default.XbsjImageryProvider.defaultOptions));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.xbsjImageryProvider, 'WebMapTileServiceImageryProvider', _ImageryProvider2.default.WebMapTileServiceImageryProvider.defaultOptions));
        _this.disposers.push(_XbsjBase2.default.registerProperty(_this.xbsjImageryProvider, 'createTileMapServiceImageryProvider', _ImageryProvider2.default.createTileMapServiceImageryProvider.defaultOptions));

        _this.disposers.push((0, _mobx.reaction)(function () {
            var type = _this.xbsjImageryProvider.type;
            var v = {
                provider: _this.xbsjImageryProvider && _this.xbsjImageryProvider[type] && _this.xbsjImageryProvider[type].provider,
                rectangle: _this.rectangle
            };
            return v;
        }, function (_ref3) {
            var provider = _ref3.provider,
                rectangle = _ref3.rectangle;

            _this._imageryLayer && _this._scene.imageryLayers.remove(_this._imageryLayer);
            if (provider) {
                var _Cesium$Rectangle;

                _this._imageryLayer = new Cesium.ImageryLayer(provider, {
                    alpha: _this.alpha,
                    brightness: _this.brightness,
                    contrast: _this.contrast,
                    hue: _this.hue,
                    saturation: _this.saturation,
                    gamma: _this.gamma,
                    show: _this.show,
                    colorToAlphaThreshold: _this.colorToAlphaThreshold,
                    splitDirection: getProp(splitDirectionMap, _this.splitDirection),
                    rectangle: rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(rectangle))
                });
                _this._scene.imageryLayers.add(_this._imageryLayer);
                _this._earth._xbsjImageryZIndexDirty = true;
            }
        }, {
            fireImmediately: true
        }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            var alpha = _this.alpha;
            var brightness = _this.brightness;
            var contrast = _this.contrast;
            var hue = _this.hue;
            var saturation = _this.saturation;
            var gamma = _this.gamma;
            var show = _this.show;
            var colorToAlphaThreshold = _this.colorToAlphaThreshold;
            var xbsjZIndex = _this.xbsjZIndex;
            var splitDirection = getProp(splitDirectionMap, _this.splitDirection);
            if (_this._imageryLayer) {
                _this._imageryLayer.alpha = alpha;
                _this._imageryLayer.brightness = brightness;
                _this._imageryLayer.contrast = contrast;
                _this._imageryLayer.hue = hue;
                _this._imageryLayer.saturation = saturation;
                _this._imageryLayer.gamma = gamma;
                _this._imageryLayer.show = show;
                _this._imageryLayer.colorToAlphaThreshold = colorToAlphaThreshold;
                _this._imageryLayer.splitDirection = splitDirection;
                _this._imageryLayer.xbsjZIndex = xbsjZIndex;
            }
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return [_this.show, _this.xbsjZIndex];
        }, function () {
            if (_this._imageryLayer) {
                _this._imageryLayer.show = _this.show;
                _this._imageryLayer.xbsjZIndex = _this.xbsjZIndex;
            }
            _this._earth._xbsjImageryZIndexDirty = true;
        }));
        return _this;
    }

    (0, _createClass3.default)(Imagery, [{
        key: 'flyTo',
        value: function flyTo() {
            if (this.rectangle && this.rectangle.length === 4) {
                this._scene.camera.flyTo({
                    destination: new Cesium.Rectangle(this.rectangle[0], this.rectangle[1], this.rectangle[2], this.rectangle[3])
                });
            }
        }
    }, {
        key: 'xbsjFromJSON',
        value: function xbsjFromJSON(jsonObject) {
            return (0, _get3.default)(Imagery.prototype.__proto__ || (0, _getPrototypeOf2.default)(Imagery.prototype), 'xbsjFromJSON', this).call(this, jsonObject);
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Imagery.prototype.__proto__ || (0, _getPrototypeOf2.default)(Imagery.prototype), 'destroy', this).call(this);
        }
    }]);
    return Imagery;
}(_XbsjCzmObj3.default);

Imagery.ImageryProvider = _ImageryProvider2.default;

Imagery.defaultImageryProviderConfig = (0, _freeze2.default)({
    createTileMapServiceImageryProvider: {
        url: _HTML2.default.cesiumDir + 'Assets/Textures/NaturalEarthII',
        fileExtension: 'jpg'
    },
    type: 'createTileMapServiceImageryProvider'
});

Imagery.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(Imagery, 'Imagery');

Imagery.xbsjSchema = _jsonSchema2.default;
Imagery.xbsjClassification = _classification2.default;

exports.default = Imagery;

/***/ }),
/* 288 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(289), __esModule: true };

/***/ }),
/* 289 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(290);
module.exports = __webpack_require__(14).Object.freeze;


/***/ }),
/* 290 */
/***/ (function(module, exports, __webpack_require__) {

// 19.1.2.5 Object.freeze(O)
var isObject = __webpack_require__(25);
var meta = __webpack_require__(75).onFreeze;

__webpack_require__(74)('freeze', function ($freeze) {
  return function freeze(it) {
    return $freeze && isObject(it) ? $freeze(meta(it)) : it;
  };
});


/***/ }),
/* 291 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var classification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'alpha', 'brightness', 'contrast', 'hue', 'saturation', 'gamma', 'colorToAlphaThreshold', 'splitDirection', 'rectangle', 'xbsjZIndex', 'xbsjImageryProvider']
}, {
    name: {
        chinese: '调试',
        english: 'Debug'
    },
    properties: []
}];

exports.default = classification;

/***/ }),
/* 292 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var ArcGisMapServerImageryProvider = function (_XbsjObject) {
    (0, _inherits3.default)(ArcGisMapServerImageryProvider, _XbsjObject);

    function ArcGisMapServerImageryProvider() {
        (0, _classCallCheck3.default)(this, ArcGisMapServerImageryProvider);
        return (0, _possibleConstructorReturn3.default)(this, (ArcGisMapServerImageryProvider.__proto__ || (0, _getPrototypeOf2.default)(ArcGisMapServerImageryProvider)).call(this));
    }

    (0, _createClass3.default)(ArcGisMapServerImageryProvider, [{
        key: 'createImageryProvider',
        value: function createImageryProvider() {
            var _Cesium$Rectangle;

            var rectangle = rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(this.rectangle));
            var imageryProvider = new Cesium.ArcGisMapServerImageryProvider({
                url: this.url,
                rectangle: rectangle
            });
            return imageryProvider;
        }
    }]);
    return ArcGisMapServerImageryProvider;
}(_XbsjObject3.default);

ArcGisMapServerImageryProvider.defaultOptions = {
    url: '',
    srcCoordType: '',
    dstCoordType: '',
    rectangle: undefined
};

_XbsjObject3.default.registerType(ArcGisMapServerImageryProvider, 'ArcGisMapServerImageryProvider');

exports.default = ArcGisMapServerImageryProvider;

/***/ }),
/* 293 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * UrlTemplate影像服务提供类
 * @memberof Obj.Imagery.ImageryProvider
 * @class
 * @extends XbsjBase
 */
var UrlTemplateImageryProvider = function (_XbsjBase) {
    (0, _inherits3.default)(UrlTemplateImageryProvider, _XbsjBase);

    function UrlTemplateImageryProvider() {
        (0, _classCallCheck3.default)(this, UrlTemplateImageryProvider);

        var _this = (0, _possibleConstructorReturn3.default)(this, (UrlTemplateImageryProvider.__proto__ || (0, _getPrototypeOf2.default)(UrlTemplateImageryProvider)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _imageryProvider: undefined
        }, {
            _imageryProvider: _mobx.observable.ref
        });

        _this._disposers = [];
        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._imageryProvider = _this.createImageryProvider();
        }));
        return _this;
    }

    (0, _createClass3.default)(UrlTemplateImageryProvider, [{
        key: 'createImageryProvider',
        value: function createImageryProvider() {
            var _Cesium$Rectangle;

            var rectangle = rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(this.rectangle));

            var tilingScheme = void 0;
            if (this.tilingScheme === 'WebMercator') {
                tilingScheme = new Cesium.WebMercatorTilingScheme();
            } else if (this.tilingScheme === 'Geographic') {
                tilingScheme = new Cesium.GeographicTilingScheme();
            }

            var imageryProvider = new Cesium.UrlTemplateImageryProvider({
                // url : 'http://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}&s=Gali',
                url: this.url,
                rectangle: rectangle,
                tilingScheme: tilingScheme
            });
            return imageryProvider;
        }
    }, {
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }, {
        key: 'provider',
        get: function get() {
            return this._imageryProvider;
        }
    }]);
    return UrlTemplateImageryProvider;
}(_XbsjBase3.default);

UrlTemplateImageryProvider.defaultOptions = {
    url: '',
    rectangle: undefined
};

var xbsjSchema = {
    title: "XbsjImageryProvider Property",
    type: "object",
    properties: {
        /**
         * 服务路径
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.UrlTemplateImageryProvider
         */
        url: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * 作用范围 [西, 南, 东, 北]
         * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
         * @type {array}
         * @instance
         * @default [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5]
         * @memberof Obj.Imagery.ImageryProvider.UrlTemplateImageryProvider
         */
        rectangle: { type: 'array | undefined', items: { type: 'number', minimum: -Math.PI, maximum: Math.PI }, minItems: 4, maxItems: 4, default: undefined, description: 'rectangle' },
        /**
         * tilingScheme
         * @type {string}
         * @instance
         * @default 'WebMercator'
         * @memberof Obj.Imagery.ImageryProvider.UrlTemplateImageryProvider
         */
        tilingScheme: { type: "string", title: "tilingScheme", default: "WebMercator", description: 'tilingScheme' }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'rectangle', 'tilingScheme']
}];

UrlTemplateImageryProvider.xbsjSchema = xbsjSchema;
UrlTemplateImageryProvider.xbsjClassification = xbsjClassification;

exports.default = UrlTemplateImageryProvider;

/***/ }),
/* 294 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * WMTS影像服务提供类
 * @memberof Obj.Imagery.ImageryProvider
 * @class
 * @extends XbsjBase
 */
var WebMapTileServiceImageryProvider = function (_XbsjBase) {
    (0, _inherits3.default)(WebMapTileServiceImageryProvider, _XbsjBase);

    function WebMapTileServiceImageryProvider() {
        (0, _classCallCheck3.default)(this, WebMapTileServiceImageryProvider);

        var _this = (0, _possibleConstructorReturn3.default)(this, (WebMapTileServiceImageryProvider.__proto__ || (0, _getPrototypeOf2.default)(WebMapTileServiceImageryProvider)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _imageryProvider: undefined,
            get provider() {
                return this._imageryProvider;
            }
        }, {
            _imageryProvider: _mobx.observable.ref,
            provider: _mobx.computed
        });

        _this._disposers = [];
        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._imageryProvider = _this.createImageryProvider();
        }));
        return _this;
    }

    (0, _createClass3.default)(WebMapTileServiceImageryProvider, [{
        key: 'createImageryProvider',
        value: function createImageryProvider() {
            var _Cesium$Rectangle;

            var rectangle = rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(this.rectangle));

            var tilingScheme = void 0;
            if (this.tilingScheme === 'WebMercator') {
                tilingScheme = new Cesium.WebMercatorTilingScheme();
            } else if (this.tilingScheme === 'Geographic') {
                tilingScheme = new Cesium.GeographicTilingScheme();
            }

            var tileMatrixLabels = this.tileMatrixLabels || undefined;

            // east: 3.141592653589793
            // north: 1.4844222297453322
            // south: -1.4844222297453324
            // west: -3.141592653589793

            var imageryProvider = new Cesium.WebMapTileServiceImageryProvider({
                url: this.url,
                format: this.format,
                layer: this.layer,
                style: this.style,
                tileMatrixSetID: this.tileMatrixSetID,
                tileMatrixLabels: tileMatrixLabels,
                tileWidth: this.tileWidth,
                tileHeight: this.tileHeight,
                tilingScheme: tilingScheme,
                rectangle: rectangle,
                minimumLevel: this.minimumLevel,
                maximumLevel: this.maximumLevel
            });
            return imageryProvider;
        }
    }, {
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }]);
    return WebMapTileServiceImageryProvider;
}(_XbsjBase3.default);

WebMapTileServiceImageryProvider.defaultOptions = {
    url: '',
    format: 'image/jpeg',
    layer: '',
    style: '',
    tileMatrixSetID: '',
    tileMatrixLabels: '',
    tileWidth: 256,
    tileHeight: 256,
    tilingScheme: 'WebMercator', // WebMercator Geographic   
    rectangle: undefined,
    minimumLevel: 0,
    maximumLevel: undefined
};

var xbsjSchema = {
    title: "WebMapTileServiceImageryProvider Property",
    type: "object",
    properties: {
        /**
         * 服务路径
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        url: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * format
         * @type {string}
         * @instance
         * @default 'image/jpeg'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        format: { type: "string", title: "format", default: "image/jpeg", description: 'format' },
        /**
         * layer
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        layer: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * style
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        style: { type: "string", title: "style", default: "", description: 'style' },
        /**
         * tileMatrixSetID
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        tileMatrixSetID: { type: "string", title: "tileMatrixSetID", default: "", description: 'tileMatrixSetID' },
        /**
         * tileMatrixLabels
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        tileMatrixLabels: { type: "string", title: "tileMatrixLabels", default: "", description: 'tileMatrixLabels' },
        /**
         * tileWidth
         * @type {number}
         * @instance
         * @default '256'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        tileWidth: { type: "number", title: "tileWidth", default: "256", description: 'tileWidth' },
        /**
         * tileHeight
         * @type {number}
         * @instance
         * @default '256'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        tileHeight: { type: "number", title: "tileHeight", default: "256", description: 'tileHeight' },
        /**
         * tilingScheme
         * @type {string}
         * @instance
         * @default 'WebMercator'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        tilingScheme: { type: "string", title: "tilingScheme", default: "WebMercator", description: 'tilingScheme' },
        /**
         * 作用范围 [西, 南, 东, 北]
         * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        rectangle: { type: "string", title: "url", default: "undefined", description: 'url' },
        /**
         * minimumLevel
         * @type {number}
         * @instance
         * @default '0'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        minimumLevel: { type: "string", title: "minimumLevel", default: "0", description: 'minimumLevel' },
        /**
         * maximumLevel
         * @type {number}
         * @instance
         * @default 'undefined'
         * @memberof Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider
         */
        maximumLevel: { type: "string", title: "maximumLevel", default: "undefined", description: 'maximumLevel' }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'format', 'layer', 'style', 'tileMatrixSetID', 'tileMatrixLabels', 'tileWidth', 'tileHeight', 'tilingScheme', 'rectangle', 'minimumLevel', 'maximumLevel']
}];

WebMapTileServiceImageryProvider.xbsjSchema = xbsjSchema;
WebMapTileServiceImageryProvider.xbsjClassification = xbsjClassification;

exports.default = WebMapTileServiceImageryProvider;

/***/ }),
/* 295 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 北京西部世界提供的坐标纠偏影像服务提供类
 * @memberof Obj.Imagery.ImageryProvider
 * @class
 * @extends XbsjBase
 */
var XbsjImageryProvider = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjImageryProvider, _XbsjBase);

    function XbsjImageryProvider() {
        (0, _classCallCheck3.default)(this, XbsjImageryProvider);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjImageryProvider.__proto__ || (0, _getPrototypeOf2.default)(XbsjImageryProvider)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _imageryProvider: undefined
        }, {
            _imageryProvider: _mobx.observable.ref
        });

        _this._disposers = [];
        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._imageryProvider = _this.createImageryProvider();
        }));
        return _this;
    }

    (0, _createClass3.default)(XbsjImageryProvider, [{
        key: 'createImageryProvider',
        value: function createImageryProvider() {
            var _Cesium$Rectangle;

            var rectangle = rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(this.rectangle));
            var imageryProvider = Cesium.XbsjImageryProviderTools.createImageryProvider({
                // uri: 'http://www.google.cn/maps/vt?lyrs=s&gl=CN&x={x}&y={y}&z={z}',
                // srcCoordType: 'GCJ02', // 原影像坐标系
                // dstCoordType: 'WGS84', // 转成WGS84坐标系
                // rectangle: Cesium.Rectangle.fromDegrees(-180, -90, 180, 90),
                uri: this.url,
                srcCoordType: this.srcCoordType,
                dstCoordType: this.dstCoordType,
                rectangle: rectangle,
                minimumLevel: this.minimumLevel,
                maximumLevel: this.maximumLevel
            });

            return imageryProvider;
        }
    }, {
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }, {
        key: 'provider',
        get: function get() {
            return this._imageryProvider;
        }
    }]);
    return XbsjImageryProvider;
}(_XbsjBase3.default);

XbsjImageryProvider.defaultOptions = {
    url: '',
    srcCoordType: 'WGS84',
    dstCoordType: 'WGS84',
    rectangle: undefined,
    minimumLevel: 0,
    maximumLevel: undefined
};

var xbsjSchema = {
    title: "XbsjImageryProvider Property",
    type: "object",
    properties: {
        /**
         * 服务路径
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        url: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * 原始坐标系
         * @type {string}
         * @instance
         * @default 'WGS84'
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        srcCoordType: { type: "string", title: "srcCoordType", default: "WGS84", description: 'srcCoordType' },
        /**
         * 目标坐标系
         * @type {string}
         * @instance
         * @default 'WGS84'
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        dstCoordType: { type: "string", title: "dstCoordType", default: "WGS84", description: 'dstCoordType' },
        /**
         * 作用范围 [西, 南, 东, 北] 包含4个元素的数组，分别表示西南东北，单位是弧度。
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        rectangle: { type: ['undefined', 'array'], items: { type: 'number', minimum: -Math.PI, maximum: Math.PI }, minItems: 4, maxItems: 4, default: undefined, description: 'rectangle' },
        /**
         * 最小级别
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        minimumLevel: { type: ['number'], title: "minimumLevel", default: 0, description: '最小级别' },
        /**
         * 最大级别
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.Imagery.ImageryProvider.XbsjImageryProvider
         */
        maximumLevel: { type: ['number', 'undefined'], title: "maximumLevel", default: undefined, description: '最大级别' }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'srcCoordType', 'dstCoordType', 'rectangle', 'minimumLevel', 'maximumLevel']
}];

XbsjImageryProvider.xbsjSchema = xbsjSchema;
XbsjImageryProvider.xbsjClassification = xbsjClassification;

exports.default = XbsjImageryProvider;

/***/ }),
/* 296 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * UrlTemplate影像服务提供类
 * @memberof Obj.Imagery.ImageryProvider
 * @class
 * @extends XbsjBase
 */
var createTileMapServiceImageryProvider = function (_XbsjBase) {
    (0, _inherits3.default)(createTileMapServiceImageryProvider, _XbsjBase);

    function createTileMapServiceImageryProvider() {
        (0, _classCallCheck3.default)(this, createTileMapServiceImageryProvider);

        var _this = (0, _possibleConstructorReturn3.default)(this, (createTileMapServiceImageryProvider.__proto__ || (0, _getPrototypeOf2.default)(createTileMapServiceImageryProvider)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _imageryProvider: undefined
        }, {
            _imageryProvider: _mobx.observable.ref
        });

        _this._disposers = [];
        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._imageryProvider = _this.createImageryProvider();
        }));
        return _this;
    }

    (0, _createClass3.default)(createTileMapServiceImageryProvider, [{
        key: 'createImageryProvider',
        value: function createImageryProvider() {
            var _Cesium$Rectangle;

            // 解决出现tilemapresource.xml加载不上的问题，因为url为空时创建的ImageryProvider会自动做这样的请求，所以干脆不创建！
            if (!this.url) {
                return undefined;
            }

            var rectangle = this.rectangle && (_Cesium$Rectangle = Cesium.Rectangle).fromRadians.apply(_Cesium$Rectangle, (0, _toConsumableArray3.default)(this.rectangle));
            var imageryProvider = new Cesium.TileMapServiceImageryProvider({
                // url : 'http://mt1.google.cn/vt/lyrs=s&hl=zh-CN&x={x}&y={y}&z={z}&s=Gali',
                url: this.url,
                rectangle: rectangle,
                fileExtension: this.fileExtension,
                maximumLevel: this.maximumLevel
            });
            return imageryProvider;
        }
    }, {
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }, {
        key: 'provider',
        get: function get() {
            return this._imageryProvider;
        }
    }]);
    return createTileMapServiceImageryProvider;
}(_XbsjBase3.default);

createTileMapServiceImageryProvider.defaultOptions = {
    url: '',
    fileExtension: 'png',
    maximumLevel: undefined,
    rectangle: undefined
};

var xbsjSchema = {
    title: "createTileMapServiceImageryProvider Property",
    type: "object",
    properties: {
        /**
         * 服务路径
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Imagery.ImageryProvider.createTileMapServiceImageryProvider
         */
        url: { type: "string", title: "url", default: "", description: 'url' },
        /**
         * 作用范围 [西, 南, 东, 北]
         * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
         * @type {array}
         * @instance
         * @default undefined
         * @memberof Obj.Imagery.ImageryProvider.createTileMapServiceImageryProvider
         */
        rectangle: { type: ['array', 'null'], items: { type: 'number', minimum: -Math.PI, maximum: Math.PI }, minItems: 4, maxItems: 4, default: null, description: 'rectangle' },
        /**
         * 文件扩展名
         * @type {string}
         * @instance
         * @default 'png'
         * @memberof Obj.Imagery.ImageryProvider.createTileMapServiceImageryProvider
         */
        fileExtension: { type: "string", title: "fileExtension", default: "png", description: 'fileExtension' },
        /**
         * maximumLevel
         * @type {number}
         * @instance
         * @default undefined
         * @memberof Obj.Imagery.ImageryProvider.createTileMapServiceImageryProvider
         */
        maximumLevel: { type: ["integer", "null"], title: "maximumLevel", default: null, description: 'maximumLevel' }
    }
};

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'rectangle', 'fileExtension', 'maximumLevel']
}];

createTileMapServiceImageryProvider.xbsjSchema = xbsjSchema;
createTileMapServiceImageryProvider.xbsjClassification = xbsjClassification;

exports.default = createTileMapServiceImageryProvider;

/***/ }),
/* 297 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _ImageryProvider = __webpack_require__(158);

var _ImageryProvider2 = _interopRequireDefault(_ImageryProvider);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

var jsonSchema = {
  title: "Imagery Property",
  type: "object",
  properties: {
    /**
     * 是否在三维窗口中显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Imagery
     */
    show: { type: "boolean", title: "show", default: true, description: "是否在三维窗口中显示" },
    /**
     * The alpha blending value of this layer, from 0.0 to 1.0.
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Imagery
     */
    alpha: { type: "number", title: "alpha", default: 1.0, description: "The alpha blending value of this layer, from 0.0 to 1.0." },
    /**
     * The brightness of this layer.  1.0 uses the unmodified imagery
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Imagery
     */
    brightness: { type: "number", title: "brightness", default: 1.0, description: "The brightness of this layer.  1.0 uses the unmodified imagery" },
    /**
     * The contrast of this layer.  1.0 uses the unmodified imagery color.
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Imagery
     */
    contrast: { type: "number", title: "contrast", default: 1.0, description: "The contrast of this layer.  1.0 uses the unmodified imagery color." },
    /**
     * The hue of this layer.  0.0 uses the unmodified imagery color.
     * @type {number}
     * @instance
     * @default 0.0
     * @memberof Obj.Imagery
     */
    hue: { type: "number", title: "hue", default: 0.0, description: "The hue of this layer.  0.0 uses the unmodified imagery color." },
    /**
     * The saturation of this layer.  1.0 uses the unmodified imagery color.
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Imagery
     */
    saturation: { type: "number", title: "saturation", default: 1.0, description: "The saturation of this layer.  1.0 uses the unmodified imagery color." },
    /**
     * The gamma correction to apply to this layer.  1.0 uses the unmodified imagery color.
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Imagery
     */
    gamma: { type: "number", title: "gamma", default: 1.0, description: "The gamma correction to apply to this layer.  1.0 uses the unmodified imagery color." },
    /**
     * Threshold for color-to-alpha.
     * @type {number}
     * @instance
     * @default 0.004
     * @memberof Obj.Imagery
     */
    colorToAlphaThreshold: { type: "number", title: "colorToAlphaThreshold", default: 0.004, description: "Threshold for color-to-alpha." },
    /**
     * The ImagerySplitDirection split to apply to this layer.
     * @description 只能取以下类型：'ImagerySplitDirection.NONE'/'ImagerySplitDirection.LEFT'/'ImagerySplitDirection.RIGHT'
     * @type {string}
     * @instance
     * @default 'ImagerySplitDirection.NONE'
     * @memberof Obj.Imagery
     */
    splitDirection: { type: "string", enum: ['ImagerySplitDirection.NONE', 'ImagerySplitDirection.LEFT', 'ImagerySplitDirection.RIGHT'], title: "splitDirection", default: "ImagerySplitDirection.NONE", description: "The ImagerySplitDirection split to apply to this layer." },
    /**
     * 作用范围 [西, 南, 东, 北]
     * @description 包含4个元素的数组，分别表示西南东北，单位是弧度。
     * @type {array}
     * @instance
     * @default [-Math.PI, -Math.PI*0.5, Math.PI, Math.PI*0.5]
     * @memberof Obj.Imagery
     */
    rectangle: {
      type: ["array", "undefined"],
      title: "rectangle",
      items: {
        type: "number"
      },
      default: undefined,
      minItems: 4,
      maxItems: 4,
      uniqueItems: false,
      description: "The rectangle of the layer.  This rectangle can limit the visible portion of the imagery provider."
    },
    /**
     * ImageryProvider设置
     * @type {object}
     * @property {string} type                             - 类型，可以是XbsjImageryProvider/UrlTemplateImageryProvider/WebMapTileServiceImageryProvider
     * @property {Obj.Imagery.ImageryProvider.XbsjImageryProvider} XbsjImageryProvider      - XbsjImageryProvider类型的具体设置
     * @property {Obj.Imagery.ImageryProvider.UrlTemplateImageryProvider} UrlTemplateImageryProvider         - UrlTemplateImageryProvider类型的具体设置
     * @property {Obj.Imagery.ImageryProvider.WebMapTileServiceImageryProvider} WebMapTileServiceImageryProvider         - WebMapTileServiceImageryProvider类型的具体设置
     * @instance
     * @memberof Obj.Imagery
     */
    xbsjImageryProvider: {
      type: "object",
      title: "xbsjImageryProvider",
      description: "影像资源信息配置",
      properties: {
        type: {
          type: "string",
          default: 'XbsjImageryProvider',
          enum: ['XbsjImageryProvider', 'UrlTemplateImageryProvider', 'WebMapTileServiceImageryProvider', 'createTileMapServiceImageryProvider'],
          description: "provider类型"
        },
        XbsjImageryProvider: _ImageryProvider2.default.XbsjImageryProvider.xbsjSchema,
        UrlTemplateImageryProvider: _ImageryProvider2.default.UrlTemplateImageryProvider.xbsjSchema,
        WebMapTileServiceImageryProvider: _ImageryProvider2.default.WebMapTileServiceImageryProvider.xbsjSchema,
        createTileMapServiceImageryProvider: _ImageryProvider2.default.createTileMapServiceImageryProvider.xbsjSchema
      }
    },
    /**
     * 用来确定显示优先级，优先级最高的影像显示在最上方。
     * @type {number}
     * @instance
     * @default 0
     * @memberof Obj.Imagery
     */
    xbsjZIndex: { type: "number", title: "xbsjZIndex", default: 0, description: "确定影像的叠加顺序，zIndex越大约靠近顶层" }
  }
};

exports.default = jsonSchema;

/***/ }),
/* 298 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _utils = __webpack_require__(80);

var _utils2 = _interopRequireDefault(_utils);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    url: '', //* @param {Resource|String} options.url The url to the .gltf file.
    basePath: '', //* @param {Resource|String} [options.basePath] The base path that paths in the glTF JSON are relative to.
    show: true, //* @param {Boolean} [options.show=true] Determines if the model primitive will be shown.
    // modelMatrix:  //* @param {Matrix4} [options.modelMatrix=Matrix4.IDENTITY] The 4x4 transformation matrix that transforms the model from model to world coordinates.
    scale: 1.0, //* @param {Number} [options.scale=1.0] A uniform scale applied to this model.
    minimumPixelSize: 0.0, //* @param {Number} [options.minimumPixelSize=0.0] The approximate minimum pixel size of the model regardless of zoom.
    maximumScale: undefined, //* @param {Number} [options.maximumScale] The maximum scale for the model.
    // id:  //* @param {Object} [options.id] A user-defined object to return when the model is picked with {@link Scene#pick}.
    allowPicking: true, //* @param {Boolean} [options.allowPicking=true] When <code>true</code>, each glTF mesh and primitive is pickable with {@link Scene#pick}.
    incrementallyLoadTextures: true, //* @param {Boolean} [options.incrementallyLoadTextures=true] Determine if textures may continue to stream in after the model is loaded.
    asynchronous: true, //* @param {Boolean} [options.asynchronous=true] Determines if model WebGL resource creation will be spread out over several frames or block until completion once all glTF files are loaded.
    clampAnimations: true, //* @param {Boolean} [options.clampAnimations=true] Determines if the model's animations should hold a pose over frames where no keyframes are specified.
    shadows: 'ShadowMode.ENABLED', //* @param {ShadowMode} [options.shadows=ShadowMode.ENABLED] Determines whether the model casts or receives shadows from each light source.
    debugShowBoundingVolume: false, //* @param {Boolean} [options.debugShowBoundingVolume=false] For debugging only. Draws the bounding sphere for each {@link DrawCommand} in the model.
    debugWireframe: false, //* @param {Boolean} [options.debugWireframe=false] For debugging only. Draws the model in wireframe.
    heightReference: 'HeightReference.NONE', //* @param {HeightReference} [options.heightReference] Determines how the model is drawn relative to terrain.
    // scene:  //* @param {Scene} [options.scene] Must be passed in for models that use the height reference property.
    distanceDisplayCondition: undefined, //* @param {DistanceDisplayCondition} [options.distanceDisplayCondition] The condition specifying at what distance from the camera that this model will be displayed.
    color: [1, 1, 1, 1], //* @param {Color} [options.color=Color.WHITE] A color that blends with the model's rendered color.
    colorBlendMode: 'ColorBlendMode.HIGHLIGHT', //* @param {ColorBlendMode} [options.colorBlendMode=ColorBlendMode.HIGHLIGHT] Defines how the color blends with the model.
    colorBlendAmount: 0.5, //* @param {Number} [options.colorBlendAmount=0.5] Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.
    silhouetteColor: [1.0, 0.0, 0.0, 1.0], //* @param {Color} [options.silhouetteColor=Color.RED] The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.
    silhouetteSize: 0.0, //* @param {Number} [options.silhouetteSize=0.0] The size of the silhouette in pixels.
    // clippingPlanes:  //* @param {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.
    // dequantizeInShader:  //* @param {Boolean} [options.dequantizeInShader=true] Determines if a {@link https://github.com/google/draco|Draco} encoded model is dequantized on the GPU. This decreases total memory usage for encoded models.
    luminanceAtZenith: 0.2, // Cesium 1.61以后默认值为0.2，之前为0.5
    specularEnvironmentMaps: undefined,

    xbsjPosition: [0, 0, 0],
    xbsjRotation: [0, 0, 0],
    xbsjScale: [1, 1, 1],

    attachedPathGuid: '',

    cameraAttachedOffsetPosition: [0, 0, 0],
    cameraAttachedOffsetRotation: [0, -Math.PI / 3, 0],
    viewDistance: 50.0
};

// // classificationType
// const classificationTypeArrays = [
//     ['ClassificationType.NONE', undefined],
//     ['ClassificationType.BOTH', Cesium.ClassificationType.BOTH],
//     ['ClassificationType.CESIUM_3D_TILE', Cesium.ClassificationType.CESIUM_3D_TILE],
//     ['ClassificationType.TERRAIN', Cesium.ClassificationType.TERRAIN],
// ]

// const classificationTypeMaps = new Map(classificationTypeArrays, classificationTypeArrays.map(([k, v]) => [v, k]));

var valueTransforms = {
    // classificationType: {
    //     jsonToCzm: jsonProp => classificationTypeMaps.get(jsonProp),
    //     czmToJson: czmProp => classificationTypeMaps.get(czmProp),
    // },
};

var sphericalHarmonicCoefficients = undefined;
function updateCoefficients(model) {
    var L00 = new Cesium.Cartesian3(0.170455150831422, 0.163151083190219, 0.196966760289763);
    var L1_1 = new Cesium.Cartesian3(-0.066550267689383, -0.022088055746048, 0.078835009246127);
    var L10 = new Cesium.Cartesian3(0.038364097478591, 0.045714300098753, 0.063498904606215);
    var L11 = new Cesium.Cartesian3(-0.014365363312810, -0.026490613715151, -0.050189404066020);
    var L2_2 = new Cesium.Cartesian3(-0.051532786917890, -0.050777795729986, -0.056449044453032);
    var L2_1 = new Cesium.Cartesian3(0.043454596136534, 0.046672590104157, 0.057530107646610);
    var L20 = new Cesium.Cartesian3(-0.001640466274110, 0.001286638231156, 0.007228908989616);
    var L21 = new Cesium.Cartesian3(-0.042260855700641, -0.046394335094707, -0.057562936365585);
    var L22 = new Cesium.Cartesian3(-0.004953478914091, -0.000479681664876, 0.008508150106928);
    sphericalHarmonicCoefficients = sphericalHarmonicCoefficients || [L00, L1_1, L10, L11, L2_2, L2_1, L20, L21, L22];

    // 环境贴图需要coefficients属性！没有的话会出问题 vtxf 20191105
    if (model.specularEnvironmentMaps) {
        model.sphericalHarmonicCoefficients = sphericalHarmonicCoefficients;
    } else {
        model.sphericalHarmonicCoefficients = undefined;
    }
}

var ShadowModeMap = void 0;
var ColorBlendModeMap = void 0;
var HeightReferenceMap = void 0;

/**
 * 模型（gltf加载）
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Model = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Model, _XbsjCzmObj);

    function Model(earth, guid) {
        (0, _classCallCheck3.default)(this, Model);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Model.__proto__ || (0, _getPrototypeOf2.default)(Model)).call(this, earth, guid));

        var scene = earth.czm.scene;
        (0, _mobx.extendObservable)(_this, {
            _primitive: undefined
        }, {
            _primitive: _mobx.observable.ref
        });
        _this.disposers.push(function () {
            _this._primitive && (scene.primitives.remove(_this._primitive), _this._primitive = undefined);
        });

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._createProperties = ['url', 'allowPicking', 'incrementallyLoadTextures', 'asynchronous'];

        _this._updateProperties = ['show', 'scale', 'minimumPixelSize', 'maximumScale',
        // 'allowPicking',
        // 'incrementallyLoadTextures',
        // 'asynchronous',
        'clampAnimations', 'debugShowBoundingVolume', 'debugWireframe', 'colorBlendAmount', 'luminanceAtZenith', 'xbsjPosition', 'xbsjRotation', 'xbsjScale', 'specularEnvironmentMaps'];

        _this._updateProperties2 = ['shadows', 'distanceDisplayCondition', 'color', 'colorBlendMode', 'silhouetteColor', 'silhouetteSize', 'heightReference'];

        _this._scratchCartesian = new Cesium.Cartesian3();
        _this._scratchModelMatrix = new Cesium.Matrix4();
        var updatePrimitive = function updatePrimitive() {
            if (_this._primitive) {
                _utils2.default.Math.getModelMatrix(_this.xbsjPosition, _this.xbsjRotation, _this.xbsjScale, _this._scratchModelMatrix);
                _this._primitive.modelMatrix = _this._scratchModelMatrix;

                _this._updateProperties.forEach(function (e) {
                    _this._primitive[e] = _this[e];
                });

                updateCoefficients(_this._primitive);
            }
        };

        ShadowModeMap = ShadowModeMap || {
            'ShadowMode.CAST_ONLY': Cesium.ShadowMode.CAST_ONLY,
            'ShadowMode.DISABLED': Cesium.ShadowMode.DISABLED,
            'ShadowMode.ENABLED': Cesium.ShadowMode.ENABLED,
            'ShadowMode.RECEIVE_ONLY': Cesium.ShadowMode.RECEIVE_ONLY
        };

        ColorBlendModeMap = ColorBlendModeMap || {
            'ColorBlendMode.HIGHLIGHT': Cesium.ColorBlendMode.HIGHLIGHT,
            'ColorBlendMode.REPLACE': Cesium.ColorBlendMode.REPLACE,
            'ColorBlendMode.MIX': Cesium.ColorBlendMode.MIX
        };

        HeightReferenceMap = HeightReferenceMap || {
            'HeightReference.NONE': Cesium.HeightReference.NONE,
            'HeightReference.CLAMP_TO_GROUND': Cesium.HeightReference.CLAMP_TO_GROUND,
            'HeightReference.RELATIVE_TO_GROUND': Cesium.HeightReference.RELATIVE_TO_GROUND
        };

        var updatePrimitive2 = function updatePrimitive2() {
            if (_this._primitive) {
                var _this$_primitive$colo, _this$_primitive$silh;

                _this._primitive.shadows = ShadowModeMap[_this.shadows];

                if (_this.distanceDisplayCondition) {
                    !_this._primitive.distanceDisplayCondition && (_this._primitive.distanceDisplayCondition = new Cesium.DistanceDisplayCondition());
                    _this._primitive.distanceDisplayCondition.near = _this.distanceDisplayCondition[0];
                    _this._primitive.distanceDisplayCondition.far = _this.distanceDisplayCondition[1];
                } else {
                    _this._primitive.distanceDisplayCondition = undefined;
                }

                (_this$_primitive$colo = _this._primitive.color).xbsjFromArray.apply(_this$_primitive$colo, (0, _toConsumableArray3.default)(_this.color));
                _this._primitive.colorBlendMode = ColorBlendModeMap[_this.colorBlendMode];
                (_this$_primitive$silh = _this._primitive.silhouetteColor).xbsjFromArray.apply(_this$_primitive$silh, (0, _toConsumableArray3.default)(_this.silhouetteColor));
                _this._primitive.silhouetteSize = _this.silhouetteSize;
                _this._primitive.heightReference = HeightReferenceMap[_this.heightReference];
            }
        };

        _this._color = new Cesium.Color(1, 1, 1, 1);
        _this._silhouetteColor = new Cesium.Color(1, 0, 0, 1);

        _this.disposers.push((0, _mobx.reaction)(function () {
            var o = {};
            _this._createProperties.forEach(function (p) {
                o[p] = _this[p];
            });

            return o;
        }, function (o) {
            _this._primitive && (_this._earth.czm.scene.primitives.remove(_this._primitive), _this._primitive = undefined);
            o.scene = _this._earth.czm.scene;
            _this._primitive = _this._earth.czm.scene.primitives.add(Cesium.Model.fromGltf(o));
            _this._primitive.id = _this;
            _this._primitive.color = _this._color;
            _this._primitive.silhouetteColor = _this._silhouetteColor;

            updatePrimitive();
            updatePrimitive2();
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            var o = {};
            _this._updateProperties.forEach(function (p) {
                o[p] = _this[p];
            });

            return (0, _stringify2.default)(o);
        }, function () {
            updatePrimitive();
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            var o = {};
            _this._updateProperties2.forEach(function (p) {
                o[p] = _this[p];
            });

            return (0, _stringify2.default)(o);
        }, function () {
            updatePrimitive2();
        }));

        // 检测位置编辑状态 // positionEditing
        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionProperty: 'xbsjPosition'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating',
            positionProperty: 'xbsjPosition'
        }));

        // 旋转状态
        _this.disposers.push((0, _registerInteractionProperty.registerRotationEditing)(_this._earth, _this, {
            positionProperty: 'xbsjPosition',
            rotationProperty: 'xbsjRotation'
        }));

        // cameraAttached
        _this.disposers.push((0, _registerInteractionProperty.registerCameraTracking)(_this._earth, _this, {
            cameraAttachedFunc: function cameraAttachedFunc(tracking) {
                var _this2 = this;

                var disposers = [];

                // 修复模型的相机绑定属性不起作用的问题
                var update = function update() {
                    var prv = _this2;
                    for (var i = 0; i < 3; ++i) {
                        tracking.position[i] = prv.xbsjPosition[i] + prv.cameraAttachedOffsetPosition[i];
                        tracking.rotation[i] = prv.xbsjRotation[i] + prv.cameraAttachedOffsetRotation[i];
                    }
                    tracking.viewDistance = prv.viewDistance;
                };

                update();
                disposers.push((0, _mobx.reaction)(function () {
                    return {
                        position: [].concat((0, _toConsumableArray3.default)(_this2.xbsjPosition)),
                        rotation: [].concat((0, _toConsumableArray3.default)(_this2.xbsjRotation)),
                        cameraAttachedOffsetPosition: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetPosition)),
                        cameraAttachedOffsetRotation: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetRotation)),
                        viewDistance: _this2.viewDistance
                    };
                }, update));
                this._earth.camera.tracking.isCameraLike = false;

                return function () {
                    disposers.forEach(function (d) {
                        return d();
                    });
                    disposers.length = 0;
                };
            }
        }));

        // 添加ready响应式属性
        {
            (0, _mobx.extendObservable)(_this, {
                _ready: false,
                get ready() {
                    return this._ready;
                },
                set ready(newVal) {
                    if (this._ready !== newVal) {
                        this._ready = newVal;
                    }
                }
            }, {
                ready: _mobx.computed
            });

            _this._readyDisposer = undefined;
            _this.disposers.push(function () {
                return _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
            });

            _this.disposers.push((0, _mobx.reaction)(function () {
                return _this._primitive;
            }, function (primitive) {
                _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
                _this.ready = false;

                if (primitive) {
                    _this._readyDisposer = function () {
                        var valid = true;
                        primitive.readyPromise.then(function () {
                            if (valid) {
                                _this.ready = true;
                            }
                            _this._readyDisposer = _this._readyDisposer && _this._readyDisposer();
                        });

                        return function () {
                            return valid = false;
                        };
                    }();
                } else {
                    _this.ready = false;
                }
            }));
        }

        _this.disposers.push(_XbsjBase2.default.registerPathAttachedGuid(_this, {
            positionProperty: 'xbsjPosition',
            rotationProperty: 'xbsjRotation'
        }));

        {
            (0, _mobx.extendObservable)(_this, {
                _selfClicked: false,
                _slefHovered: false
            });

            var _earth = _this._earth;
            _this.disposers.push((0, _mobx.autorun)(function () {
                if (_this._selfClicked) {
                    var _this$silhouetteColor;

                    (_this$silhouetteColor = _this.silhouetteColor).splice.apply(_this$silhouetteColor, [0, 4].concat((0, _toConsumableArray3.default)(_earth.interaction.picking.clickedColor)));
                    _this.silhouetteSize = 3;
                } else if (_this._slefHovered) {
                    var _this$silhouetteColor2;

                    (_this$silhouetteColor2 = _this.silhouetteColor).splice.apply(_this$silhouetteColor2, [0, 4].concat((0, _toConsumableArray3.default)(_earth.interaction.picking.hoveredColor)));
                    _this.silhouetteSize = 3;
                } else {
                    _this.silhouetteColor.splice(0, 4, 0, 0, 0, 1);
                    _this.silhouetteSize = 0;
                }
            }));
        }
        return _this;
    }

    (0, _createClass3.default)(Model, [{
        key: 'flyTo',
        value: function flyTo() {
            var _this3 = this;

            var camera = this._earth.czm.scene.camera;
            camera.cancelFlight();

            if (this._flyToDisposer) {
                throw new Error('_flyToDisposer should be undefined!');
            }

            camera._currentFlight = {
                cancelTween: function cancelTween() {
                    _this3._flyToDisposer = _this3._flyToDisposer && _this3._flyToDisposer();
                }
            };

            if (this.ready) {
                this._earth.camera.flyTo(this.xbsjPosition, this._primitive.boundingSphere.radius * 2.0);
            } else {
                this._flyToDisposer = (0, _mobx.reaction)(function () {
                    return _this3.ready;
                }, function (ready) {
                    if (ready) {
                        if (!_this3._primitive || !_this3._primitive.ready) {
                            throw new Error('this._primitive.ready should be true!');
                        }
                        _this3._earth.camera.flyTo(_this3.xbsjPosition, _this3._primitive.boundingSphere.radius * 2.0);
                        _this3._flyToDisposer = _this3._flyToDisposer && _this3._flyToDisposer();
                    }
                });
            }

            // 主要是用来清理！
            if (!this._flyToOnlyOnce) {
                this._flyToOnlyOnce = true;
                this.disposers.push(function () {
                    _this3._flyToDisposer = _this3._flyToDisposer && _this3._flyToDisposer();
                });
            }
        }

        // 拾取事件定制

    }, {
        key: 'onclick',
        value: function onclick(pickedObject) {
            this._selfClicked = true;
        }
    }, {
        key: 'onclickout',
        value: function onclickout() {
            this._selfClicked = false;
        }
    }, {
        key: 'onmouseover',
        value: function onmouseover(pickedObject) {
            this._slefHovered = true;
        }
    }, {
        key: 'onmouseout',
        value: function onmouseout() {
            this._slefHovered = false;
        }
    }]);
    return Model;
}(_XbsjCzmObj3.default);

Model.ShadowMode = {
    CAST_ONLY: 'ShadowMode.CAST_ONLY',
    DISABLED: 'ShadowMode.DISABLED',
    ENABLED: 'ShadowMode.ENABLED',
    RECEIVE_ONLY: 'ShadowMode.RECEIVE_ONLY'
};

Model.ColorBlendMode = {
    HIGHLIGHT: 'ColorBlendMode.HIGHLIGHT',
    REPLACE: 'ColorBlendMode.REPLACE',
    MIX: 'ColorBlendMode.MIX'
};

Model.HeightReference = {
    NONE: 'HeightReference.NONE',
    CLAMP_TO_GROUND: 'HeightReference.CLAMP_TO_GROUND',
    RELATIVE_TO_GROUND: 'HeightReference.RELATIVE_TO_GROUND'
};

var xbsjSchema = {
    title: "Model Property",
    type: "object",
    properties: {
        /**
         * 资源URL路径 The url to the .gltf file.
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Model
         */
        url: { type: "string", title: "资源URL路径", default: '', description: "资源URL路径" },
        /**
         * The base path that paths in the glTF JSON are relative to.
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Model
         */
        basePath: { type: "string", title: "The base path that paths in the glTF JSON are relative to.", default: '', description: "The base path that paths in the glTF JSON are relative to." },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Model
         */
        show: { type: "boolean", title: "是否在三维窗口中显示", default: true, description: "是否在三维窗口中显示" },
        /**
         * A uniform scale applied to this model.
         * @type {boolean}
         * @instance
         * @default 1.0
         * @memberof Obj.Model
         */
        scale: { type: "number", title: "A uniform scale applied to this model.", default: 1.0, description: "A uniform scale applied to this model." },
        /**
         * The approximate minimum pixel size of the model regardless of zoom.
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.Model
         */
        minimumPixelSize: { type: "number", title: "The approximate minimum pixel size of the model regardless of zoom.", default: 0.0, description: "The approximate minimum pixel size of the model regardless of zoom." },
        /**
         * The maximum scale for the model.
         * @type {number|undefined}
         * @instance
         * @default undefined
         * @memberof Obj.Model
         */
        maximumScale: { type: ["number", "undefined"], title: "The maximum scale for the model.", default: undefined, description: "The maximum scale for the model." },
        /**
         * When <code>true</code>, each glTF mesh and primitive is pickable with {@link Scene#pick}.
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Model
         */
        allowPicking: { type: "boolean", title: "When <code>true</code>, each glTF mesh and primitive is pickable with {@link Scene#pick}.", default: true, description: "When <code>true</code>, each glTF mesh and primitive is pickable with {@link Scene#pick}." },
        /**
         * Determine if textures may continue to stream in after the model is loaded.
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Model
         */
        incrementallyLoadTextures: { type: "boolean", default: true, description: "Determine if textures may continue to stream in after the model is loaded." },
        /**
         * Determines if model WebGL resource creation will be spread out over several frames or block until completion once all glTF files are loaded.
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Model
         */
        asynchronous: { type: "boolean", default: true, description: "Determines if model WebGL resource creation will be spread out over several frames or block until completion once all glTF files are loaded." },
        /**
         * Determines if the model's animations should hold a pose over frames where no keyframes are specified.
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Model
         */
        clampAnimations: { type: "boolean", default: true, description: "Determines if the model's animations should hold a pose over frames where no keyframes are specified." },
        /**
         * Determines whether the model casts or receives shadows from each light source. mode: ShadowMode.CAST_ONLY, ShadowMode.DISABLED, ShadowMode.ENABLED, ShadowMode.RECEIVE_ONLY
         * @type {string}
         * @instance
         * @default 'ShadowMode.ENABLED'
         * @memberof Obj.Model
         */
        shadows: { type: "string", default: 'ShadowMode.ENABLED', description: "Determines whether the model casts or receives shadows from each light source." },
        /**
         * For debugging only. Draws the bounding sphere for each {@link DrawCommand} in the model.
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Model
         */
        debugShowBoundingVolume: { type: "boolean", default: true, description: "For debugging only. Draws the bounding sphere for each {@link DrawCommand} in the model." },
        /**
         * For debugging only. Draws the model in wireframe.
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Model
         */
        debugWireframe: { type: "boolean", default: false, description: "For debugging only. Draws the model in wireframe." },
        /**
         * Determines how the model is drawn relative to terrain. 值如下：HeightReference.NONE, HeightReference.CLAMP_TO_GROUND, HeightReference.RELATIVE_TO_GROUND, 
         * @type {string}
         * @instance
         * @default 'HeightReference.NONE'
         * @memberof Obj.Model
         */
        heightReference: { type: "string", default: 'HeightReference.NONE', description: "Determines how the model is drawn relative to terrain." },
        /**
         * 模型视距范围，两个元素的数组，分别表示near和far。形式如：[200.0, 3000.0]
         * @type {number[]|undefined}
         * @instance
         * @default undefined
         * @memberof Obj.Model
         */
        distanceDisplayCondition: { type: ["array", "undefined"], default: 'undefined', description: " 两个元素的数组，分别表示near和far" },
        /**
         * 颜色叠加
         * @type {number[]}
         * @instance
         * @default [1, 1, 1, 1]
         * @memberof Obj.Model
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加' },
        /**
         * Defines how the color blends with the mode. mode: ColorBlendMode.HIGHLIGHT, ColorBlendMode.REPLACE, ColorBlendMode.MIX
         * @type {string}
         * @instance
         * @default 'ColorBlendMode.HIGHLIGHT'
         * @memberof Obj.Model
         */
        colorBlendMode: { type: 'string', default: 'ColorBlendMode.HIGHLIGHT', description: 'Defines how the color blends with the mode. ' },
        /**
         * Value used to determine the color strength when the <code>colorBlendMode</code> is <code>MIX</code>. A value of 0.0 results in the model's rendered color while a value of 1.0 results in a solid color, with any value in-between resulting in a mix of the two.
         * @type {number}
         * @instance
         * @default 0.5,
         * @memberof Obj.Model
         */
        colorBlendAmount: { type: 'number', default: 0.5, description: 'colorBlendAmount' },
        /**
         * The silhouette color. If more than 256 models have silhouettes enabled, there is a small chance that overlapping models will have minor artifacts.
         * @type {number[]}
         * @instance
         * @default [1.0, 0.0, 0.0, 1.0]
         * @memberof Obj.Model
         */
        silhouetteColor: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1.0, 0.0, 0.0, 1.0], description: 'silhouetteColor' },
        /**
         * The size of the silhouette in pixels.
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.Model
         */
        silhouetteSize: { type: 'number', default: 0.0, description: 'The size of the silhouette in pixels.' },
        // clippingPlanes:  //* @param {ClippingPlaneCollection} [options.clippingPlanes] The {@link ClippingPlaneCollection} used to selectively disable rendering the model.
        // dequantizeInShader:  //* @param {Boolean} [options.dequantizeInShader=true] Determines if a {@link https://github.com/google/draco|Draco} encoded model is dequantized on the GPU. This decreases total memory usage for encoded models.
        /**
         * 材质底色 Cesium 1.61以后默认值为0.2，之前为0.5
         * @type {number}
         * @instance
         * @default 0.2
         * @memberof Obj.Model
         */
        luminanceAtZenith: { type: 'number', default: 0.2, description: '材质底色' },
        /**
         * 环境贴图
         * @type {string|undefined}
         * @instance
         * @default undefined
         * @memberof Obj.Model
         */
        specularEnvironmentMaps: { type: ['string', 'undefined'], default: undefined, description: '环境贴图' },
        /**
         * 位置数组 [经度、纬度、高度] <br/>
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.Model
         */
        xbsjPosition: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '位置 [经度, 纬度, 高度]' },
        /**
         * 姿态数组 [偏航角、俯仰角、翻转角]
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.Model
         */
        xbsjRotation: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '姿态数组 [偏航角、俯仰角、翻转角]' },
        /**
         * 缩放数组 [x向缩放、y向缩放、z向缩放]
         * @type {number[]}
         * @instance
         * @default [1, 1, 1]
         * @memberof Obj.Model
         */
        xbsjScale: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [1, 1, 1], description: '姿态数组 [偏航角、俯仰角、翻转角]' },
        /**
         * 绑定的路径的guid
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Model
         */
        attachedPathGuid: { type: "string", default: '', description: "绑定的路径的guid" },
        /**
         * 相机绑定后的位置偏移
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.Model
         */
        cameraAttachedOffsetPosition: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0, 0, 0], description: '位置偏移[经度偏移量, 纬度偏移量，高度偏移量]' },
        /**
         * 相机绑定后的姿态偏移
         * @type {number[]}
         * @instance
         * @default [0, -Math.PI/3, 0]
         * @memberof Obj.Model
         */
        cameraAttachedOffsetRotation: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0, -Math.PI / 3, 0], description: '相机绑定后的姿态偏移' },
        /**
         * 相机飞入时的视距设定，即调用flyTo后，相机距离物体多远处停下来
         * @type {number}
         * @instance
         * @default 50.0
         * @memberof Obj.Model
         */
        viewDistance: { type: "number", default: 50.0, description: "相机飞入时的视距设定" }
    }
};

Model.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['url', 'basePath', 'show', 'scale', 'minimumPixelSize', 'maximumScale', 'allowPicking', 'incrementallyLoadTextures', 'asynchronous', 'clampAnimations', 'shadows', 'debugShowBoundingVolume', 'debugWireframe', 'heightReference', 'distanceDisplayCondition', 'color', 'colorBlendMode', 'colorBlendAmount', 'silhouetteColor', 'silhouetteSize', 'luminanceAtZenith', 'specularEnvironmentMaps', 'xbsjPosition', 'xbsjRotation', 'xbsjScale', 'attachedPathGuid', 'cameraAttachedOffsetPosition', 'cameraAttachedOffsetRotation', 'viewDistance']
}];

Model.xbsjClassification = xbsjClassification;

Model.defaultOptions = defaultOptions;

/**
 * 一个内置的环境贴图，可以设置给属性specularEnvironmentMaps。
 * @name xbsjEnvirement
 * @memberof Obj.Model
 * @static
 */

Model.xbsjEnvirement = _HTML2.default.getScriptBaseUrl('XbsjEarth') + 'images/envirment-003.ktx';

_XbsjObject2.default.registerType(Model, 'Model');

exports.default = Model;

/***/ }),
/* 299 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _x2js = __webpack_require__(300);

var _x2js2 = _interopRequireDefault(_x2js);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjWMTSParser = function () {
    function XbsjWMTSParser() {
        (0, _classCallCheck3.default)(this, XbsjWMTSParser);

        this.Layers = [];
        this.TileMatrixSets = [];
    }

    (0, _createClass3.default)(XbsjWMTSParser, [{
        key: "addUrlParam",
        value: function addUrlParam(url) {
            var idx = url.lastIndexOf("?");
            var queryParameters = {};

            if (idx > 0) {
                queryParameters = Cesium.queryToObject(url.substr(idx + 1));
                url = url.substr(0, idx);
            }
            this.url = url;

            queryParameters.Request = 'GetCapabilities';
            queryParameters.Service = 'wmts';

            this.queryParameters = queryParameters;

            return url + '?' + Cesium.objectToQuery(queryParameters);
        }
    }, {
        key: "makeTemplate",
        value: function makeTemplate(layer) {
            console.log(layer);
            var ret = this.url + '?REQUEST=GetTile&VERSION=1.0.0&SERVICE=wmts';

            ret += '&LAYER=' + layer;
            ret += '&STYLE={style}';
            ret += '&TILEMATRIXSET={TileMatrixSet}';
            ret += '&TILEMATRIX={TileMatrix}';
            ret += '&TILEROW={TileRow}';
            ret += '&TILECOL={TileCol}';

            //遍历queryParameters，提取非request参数
            for (var key in this.queryParameters) {
                var k = key.toLowerCase();
                if (k == 'request' || k == 'service') continue;
                ret += '&' + k + '=' + this.queryParameters[k];
            }
            console.log('make template', ret);

            return ret;
        }
    }, {
        key: "parser",
        value: function parser(url, proxy) {
            var _this = this;

            return new _promise2.default(function (resolve, reject) {
                //使用cesium请求
                Cesium.Resource.fetchText({
                    url: url
                    // queryParameters: queryParameters
                }).then(function (text) {
                    var x2jsone = new _x2js2.default();
                    _this.Layers = [];
                    _this.TileMatrixSets = [];
                    var contents = x2jsone.xml2js(text).Capabilities.Contents;

                    //先处理所有 tilematrixset
                    if (contents.TileMatrixSet instanceof Array) {
                        contents.TileMatrixSet.forEach(function (t) {
                            _this.addTileMatrixSet(t);
                        });
                    } else if (contents.TileMatrixSet) {
                        _this.addTileMatrixSet(contents.TileMatrixSet);
                    }

                    //再处理layer
                    if (contents.Layer instanceof Array) {
                        contents.Layer.forEach(function (layer) {
                            _this.addLayer(layer);
                        });
                    } else if (contents.Layer) {
                        _this.addLayer(contents.Layer);
                    }

                    resolve(_this.Layers);
                }).otherwise(function (err) {
                    reject(err);
                });
            });
        }
    }, {
        key: "addLayer",
        value: function addLayer(Layer) {
            var _this2 = this;

            var l = {
                title: Layer.Title.toString(),
                urls: [],
                styles: [],
                tileMatrixSets: []
            };

            //范围
            if (Layer.WGS84BoundingBox) {
                var lb = Layer.WGS84BoundingBox.LowerCorner.toString().split(" ");
                var rt = Layer.WGS84BoundingBox.UpperCorner.toString().split(" ");
                var w = parseFloat(lb[0]);
                var s = parseFloat(lb[1]);
                var e = parseFloat(rt[0]);
                var n = parseFloat(rt[1]);
                //限定下范围
                if (w < -180) w = -180;
                if (e > 180) e = 180;
                if (s < -90) s = -90;
                if (n > 90) n = 90;
                l.rectangle = [w, s, e, n];
            }
            //支持格式
            if (Layer.ResourceURL instanceof Array) {
                Layer.ResourceURL.forEach(function (r) {
                    if (r._resourceType == "tile") {
                        l.urls.push({
                            format: r._format,
                            template: r._template
                        });
                    }
                });
            } else {
                var r = Layer.ResourceURL;
                if (r && r._resourceType == "tile") {
                    l.urls.push({
                        format: r._format,
                        template: r._template
                    });
                } else if (Layer.Format) {
                    l.urls.push({
                        format: Layer.Format,
                        template: this.makeTemplate(l.title)
                    });
                }
            }
            function getLegend(s) {
                if (!s.LegendURL) return;
                return {
                    format: s.LegendURL['_format'],
                    height: parseInt(s.LegendURL['_height']),
                    width: parseInt(s.LegendURL['_width']),
                    href: s.LegendURL['_xlink:href']
                };
            }
            //支持的样式
            if (Layer.Style instanceof Array) {
                Layer.Style.forEach(function (s) {
                    l.styles.push({
                        id: s.Identifier.toString(),
                        legend: getLegend(s),
                        title: s.Title ? s.Title.toString() : s.Identifier.toString(),
                        default: s._isDefault == "true"
                    });
                });
            } else {
                var _s = Layer.Style;
                l.styles.push({
                    id: _s.Identifier.toString(),
                    legend: getLegend(_s),
                    title: _s.Title ? _s.Title.toString() : _s.Identifier.toString(),
                    default: _s._isDefault == "true"
                });
            }

            //支持的切片规则
            if (Layer.TileMatrixSetLink instanceof Array) {
                Layer.TileMatrixSetLink.forEach(function (tl) {
                    var tileMatrixSet = _this2.TileMatrixSets.find(function (t) {
                        return t.tileMatrixSetID == tl.TileMatrixSet;
                    });
                    if (tileMatrixSet) l.tileMatrixSets.push(tileMatrixSet);
                });
            } else {
                var tl = Layer.TileMatrixSetLink;
                var tileMatrixSet = this.TileMatrixSets.find(function (t) {
                    return t.tileMatrixSetID == tl.TileMatrixSet;
                });
                if (tileMatrixSet) l.tileMatrixSets.push(tileMatrixSet);
            }

            this.Layers.push(l);
        }
    }, {
        key: "getLevelScales28mm",
        value: function getLevelScales28mm() {
            //(6378137 * 2 * Math.PI  /256) 表示每像素多少米
            // 0.028 表示dpi 28mm
            // 100 表示转厘米
            //计算每一级别的标准比例尺
            var scale0 = 6378137 * 2 * Math.PI / 256 * 100 / 0.028;
            var scales = [];
            for (var i = 0; i < 25; i++) {
                scales[i] = scale0 / (1 << i);
            }
            return scales;
        }
    }, {
        key: "getLevelScales96dpi",
        value: function getLevelScales96dpi() {
            var dpi = 96; //每英寸多少点
            var res = 0.0254 / dpi; //每米/像素

            //(6378137 * 2 * Math.PI  /256) 表示每像素多少米
            //计算每一级别的标准比例尺
            var scale0 = 6378137 * 2 * Math.PI / 256 / res;
            var scales = [];
            for (var i = 0; i < 25; i++) {
                scales[i] = scale0 / (1 << i);
            }
            return scales;
        }
    }, {
        key: "getLevel",
        value: function getLevel(tileMatrixs, standerScales) {
            var ret = {
                minimumLevel: 0,
                maximumLevel: 0,
                tileMatrixLabels: []
            };
            //遍历 tileMatrixs 寻找
            var level = -1;
            for (var i = 0; i < tileMatrixs.length; i++) {
                var tm = tileMatrixs[i];

                //寻找满足条件的级别
                var tl = standerScales.findIndex(function (s) {
                    var error = s * 0.0001;
                    return tm.scale < s + error && tm.scale > s - error;
                });
                //没有合适的跳过
                if (tl < 0) {
                    continue;
                }
                //如果还没开始，那么添加第一个
                if (level < 0) {
                    ret.minimumLevel = level = tl;
                    //对前面label补全
                    for (var j = 0; j < ret.minimumLevel; j++) {
                        ret.tileMatrixLabels[ret.tileMatrixLabels.length] = '0';
                    }
                    ret.tileMatrixLabels[ret.tileMatrixLabels.length] = tm.id;
                }
                //如果等于下一级 那么再添加一个
                else if (tl == level + 1) {
                        ret.maximumLevel = tl;
                        ret.tileMatrixLabels[ret.tileMatrixLabels.length] = tm.id;
                        level += 1;
                    }
                    //如果级别不连续，那么停止
                    else {
                            break;
                        }
            }
            //如果没有合适的级别，那么不返回
            if (ret.tileMatrixLabels.length == 0) return undefined;
            return ret;
        }
    }, {
        key: "getLevel4326",
        value: function getLevel4326(tileMatrixs) {
            //标准4326分块顶层是两块，所以要去除第0个
            var scales = this.getLevelScales28mm();
            scales.splice(0, 1);

            //根据 tileMatrixs判定获取级别
            var ret = this.getLevel(tileMatrixs, scales);
            if (!ret) {
                scales = this.getLevelScales96dpi();
                scales.splice(0, 1);
                ret = this.getLevel(tileMatrixs, scales);
            }
            if (!ret) return;

            ret.tilingScheme = "Geographic";
            return ret;
        }
    }, {
        key: "getLevel3857",
        value: function getLevel3857(tileMatrixs) {
            var scales = this.getLevelScales28mm();
            //根据 tileMatrixs判定获取级别
            var ret = this.getLevel(tileMatrixs, scales);
            if (!ret) {
                scales = this.getLevelScales96dpi();
                ret = this.getLevel(tileMatrixs, scales);
            }

            if (!ret) return;

            ret.tilingScheme = "WebMercator";
            return ret;
        }
    }, {
        key: "addTileMatrixSet",
        value: function addTileMatrixSet(tms) {
            var t = {
                tileMatrixSetID: tms.Identifier.toString(),
                title: tms.Title ? tms.Title.toString() : tms.Identifier.toString()
            };

            var tileMatrixs = [];
            tms.TileMatrix.forEach(function (tm) {
                tileMatrixs.push({
                    id: tm.Identifier.toString(),
                    scale: parseFloat(tm.ScaleDenominator)
                });
            });

            var crs = tms.SupportedCRS.toString();
            t.crs = crs;

            //核心在这里需要找到 每个tilematrix set的投影方式，要么是 4326的 要么是 3857的
            if (crs.indexOf(":4490") > 0 || crs.indexOf(":4326") > 0 || crs.indexOf("OGC:2:84") > 0 || crs.indexOf('UNIT["degree",0.0174532925199') > 0) {
                t.params = this.getLevel4326(tileMatrixs);

                if (t.params) {
                    this.TileMatrixSets.push(t);
                } else {
                    console.log("not support 4326 tilematrixs:", tileMatrixs);
                }
            } else if (crs.indexOf("3857") > 0 || crs.indexOf("900913") > 0) {
                t.params = this.getLevel3857(tileMatrixs);

                if (t.params) {
                    this.TileMatrixSets.push(t);
                } else {
                    console.log("not support 4326 tilematrixs:", tileMatrixs);
                }
            }
            //不支持的
            else {
                    console.log("not support crs:", crs);
                }
        }
    }]);
    return XbsjWMTSParser;
}();

exports.default = XbsjWMTSParser;

/***/ }),
/* 300 */
/***/ (function(module, exports, __webpack_require__) {

var __WEBPACK_AMD_DEFINE_FACTORY__, __WEBPACK_AMD_DEFINE_ARRAY__, __WEBPACK_AMD_DEFINE_RESULT__;/*
	Copyright 2015 Axinom
	Copyright 2011-2013 Abdulla Abdurakhmanov
	Original sources are available at https://code.google.com/p/x2js/

	Licensed under the Apache License, Version 2.0 (the "License");
	you may not use this file except in compliance with the License.
	You may obtain a copy of the License at

	http://www.apache.org/licenses/LICENSE-2.0

	Unless required by applicable law or agreed to in writing, software
	distributed under the License is distributed on an "AS IS" BASIS,
	WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
	See the License for the specific language governing permissions and
	limitations under the License.
*/

/*
	Supported export methods:
	* AMD
	* <script> (window.X2JS)
	* Node.js

	Limitations:
	* Attribute namespace prefixes are not parsed as such.
	* Overall the serialization/deserializaton code is "best effort" and not foolproof.
*/

// Module definition pattern used is returnExports from https://github.com/umdjs/umd
(function (root, factory) {
	"use strict";

	/* global define */
	if (true) {
		// AMD. Register as an anonymous module.
		!(__WEBPACK_AMD_DEFINE_ARRAY__ = [], __WEBPACK_AMD_DEFINE_FACTORY__ = (factory),
				__WEBPACK_AMD_DEFINE_RESULT__ = (typeof __WEBPACK_AMD_DEFINE_FACTORY__ === 'function' ?
				(__WEBPACK_AMD_DEFINE_FACTORY__.apply(exports, __WEBPACK_AMD_DEFINE_ARRAY__)) : __WEBPACK_AMD_DEFINE_FACTORY__),
				__WEBPACK_AMD_DEFINE_RESULT__ !== undefined && (module.exports = __WEBPACK_AMD_DEFINE_RESULT__));
	} else if (typeof module === 'object' && module.exports) {
		// Node. Does not work with strict CommonJS, but only CommonJS-like
		// environments that support module.exports, like Node.
		module.exports = factory(require("xmldom").DOMParser);
	} else {
		// Browser globals (root is window)
		root.X2JS = factory();
	}
})(this, function (CustomDOMParser) {
	"use strict";

	// We return a constructor that can be used to make X2JS instances.
	return function X2JS(config) {
		var VERSION = "3.1.1";

		config = config || {};

		function initConfigDefaults() {
			// If set to "property" then <element>_asArray will be created
			// to allow you to access any element as an array (even if there is only one of it).
			config.arrayAccessForm = config.arrayAccessForm || "none";

			// If "text" then <empty></empty> will be transformed to "".
			// If "object" then <empty></empty> will be transformed to {}.
			config.emptyNodeForm = config.emptyNodeForm || "text";

			// Function that will be called for each elements, if the function returns true, the element will be skipped
			// function(name, value) { return true; };
			config.jsAttributeFilter = config.jsAttributeFilter;

			// Function that will be called for each elements, the element value will be replaced by the returned value
			// function(name, value) { return parseFloat(value); };
			config.jsAttributeConverter = config.jsAttributeConverter;

			// Allows attribute values to be converted on the fly during parsing to objects.
			// 	"test": function(name, value) { return true; }
			//	"convert": function(name, value) { return parseFloat(value); };
			// convert() will be called for every attribute where test() returns true
			// and the return value from convert() will replace the original value of the attribute.
			config.attributeConverters = config.attributeConverters || [];

			// Any elements that match the paths here will have their text parsed
			// as an XML datetime value (2011-11-12T13:00:00-07:00 style).
			// The path can be a plain string (parent.child1.child2),
			// a regex (/.*\.child2/) or function(elementPath).
			config.datetimeAccessFormPaths = config.datetimeAccessFormPaths || [];

			// Any elements that match the paths listed here will be stored in JavaScript objects
			// as arrays even if there is only one of them. The path can be a plain string
			// (parent.child1.child2), a regex (/.*\.child2/) or function(elementName, elementPath).
			config.arrayAccessFormPaths = config.arrayAccessFormPaths || [];

            // xmldom constructor arguments
            // @see https://github.com/jindw/xmldom#api-reference
			config.xmldomOptions = config.xmldomOptions || {};

			// If true, a toString function is generated to print nodes containing text or cdata.
			// Useful if you want to accept both plain text and CData as equivalent inputs.
			if (config.enableToStringFunc === undefined) {
				config.enableToStringFunc = true;
			}

			// If true, empty text tags are ignored for elements with child nodes.
			if (config.skipEmptyTextNodesForObj === undefined) {
				config.skipEmptyTextNodesForObj = true;
			}

			// If true, whitespace is trimmed from text nodes.
			if (config.stripWhitespaces === undefined) {
				config.stripWhitespaces = true;
			}

			// If true, double quotes are used in generated XML.
			if (config.useDoubleQuotes === undefined) {
				config.useDoubleQuotes = true;
			}

			// If true, the root element of the XML document is ignored when converting to objects.
			// The result will directly have the root element's children as its own properties.
			if (config.ignoreRoot === undefined) {
				config.ignoreRoot = false;
			}

			// Whether XML characters in text are escaped when reading/writing XML.
			if (config.escapeMode === undefined) {
				config.escapeMode = true;
			}

			// Prefix to use for properties that are created to represent XML attributes.
			if (config.attributePrefix === undefined) {
				config.attributePrefix = "_";
			}

			// If true, empty elements will created as self closing elements (<element />)
			// If false, empty elements will be created with start and end tags (<element></element>)
			if (config.selfClosingElements === undefined) {
				config.selfClosingElements = true;
			}

			// If this property defined as false and an XML element has CData node ONLY, it will be converted to text without additional property "__cdata"
			if (config.keepCData === undefined) {
				config.keepCData = false;
			}

			// If true, will output dates in UTC
			if (config.jsDateUTC === undefined) {
				config.jsDateUTC = false;
			}
		}

		function initRequiredPolyfills() {
			function pad(number) {
				var r = String(number);
				if (r.length === 1) {
					r = '0' + r;
				}
				return r;
			}
			// Hello IE8-
			if (typeof String.prototype.trim !== 'function') {
				String.prototype.trim = function trim() {
					return this.replace(/^\s+|^\n+|(\s|\n)+$/g, '');
				};
			}
			if (typeof Date.prototype.toISOString !== 'function') {
				// Implementation from http://stackoverflow.com/questions/2573521/how-do-i-output-an-iso-8601-formatted-string-in-javascript
				Date.prototype.toISOString = function toISOString() {
					var MS_IN_S = 1000;

					return this.getUTCFullYear()
						+ '-' + pad(this.getUTCMonth() + 1)
						+ '-' + pad(this.getUTCDate())
						+ 'T' + pad(this.getUTCHours())
						+ ':' + pad(this.getUTCMinutes())
						+ ':' + pad(this.getUTCSeconds())
						+ '.' + String((this.getUTCMilliseconds() / MS_IN_S).toFixed(3)).slice(2, 5)
						+ 'Z';
				};
			}
		}

		initConfigDefaults();
		initRequiredPolyfills();

		var DOMNodeTypes = {
			"ELEMENT_NODE": 1,
			"TEXT_NODE": 3,
			"CDATA_SECTION_NODE": 4,
			"COMMENT_NODE": 8,
			"DOCUMENT_NODE": 9
		};

		function getDomNodeLocalName(domNode) {
			var localName = domNode.localName;
			if (localName == null) {
				// Yeah, this is IE!!
				localName = domNode.baseName;
			}
			if (localName == null || localName === "") {
				// ==="" is IE too
				localName = domNode.nodeName;
			}
			return localName;
		}

		function getDomNodeNamespacePrefix(node) {
			return node.prefix;
		}

		function escapeXmlChars(str) {
			if (typeof str === "string")
				return str.replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#x27;');
			else
				return str;
		}

		function unescapeXmlChars(str) {
			return str.replace(/&lt;/g, '<').replace(/&gt;/g, '>').replace(/&quot;/g, '"').replace(/&#x27;/g, "'").replace(/&amp;/g, '&');
		}

		function ensureProperArrayAccessForm(element, childName, elementPath) {
			switch (config.arrayAccessForm) {
				case "property":
					if (!(element[childName] instanceof Array))
						element[childName + "_asArray"] = [element[childName]];
					else
						element[childName + "_asArray"] = element[childName];
					break;
			}

			if (!(element[childName] instanceof Array) && config.arrayAccessFormPaths.length > 0) {
				var match = false;

				for (var i = 0; i < config.arrayAccessFormPaths.length; i++) {
					var arrayPath = config.arrayAccessFormPaths[i];
					if (typeof arrayPath === "string") {
						if (arrayPath === elementPath) {
							match = true;
							break;
						}
					} else if (arrayPath instanceof RegExp) {
						if (arrayPath.test(elementPath)) {
							match = true;
							break;
						}
					} else if (typeof arrayPath === "function") {
						if (arrayPath(childName, elementPath)) {
							match = true;
							break;
						}
					}
				}

				if (match)
					element[childName] = [element[childName]];
			}
		}

		function xmlDateTimeToDate(prop) {
			// Implementation based up on http://stackoverflow.com/questions/8178598/xml-datetime-to-javascript-date-object
			// Improved to support full spec and optional parts
			var MINUTES_PER_HOUR = 60;

			var bits = prop.split(/[-T:+Z]/g);

			var d = new Date(bits[0], bits[1] - 1, bits[2]);
			var secondBits = bits[5].split("\.");
			d.setHours(bits[3], bits[4], secondBits[0]);
			if (secondBits.length > 1)
				d.setMilliseconds(secondBits[1]);

			// Get supplied time zone offset in minutes
			if (bits[6] && bits[7]) {
				var offsetMinutes = bits[6] * MINUTES_PER_HOUR + Number(bits[7]);
				var sign = /\d\d-\d\d:\d\d$/.test(prop) ? '-' : '+';

				// Apply the sign
				offsetMinutes = 0 + (sign === '-' ? -1 * offsetMinutes : offsetMinutes);

				// Apply offset and local timezone
				d.setMinutes(d.getMinutes() - offsetMinutes - d.getTimezoneOffset());
			} else if (prop.indexOf("Z", prop.length - 1) !== -1) {
				d = new Date(Date.UTC(d.getFullYear(), d.getMonth(), d.getDate(), d.getHours(), d.getMinutes(), d.getSeconds(), d.getMilliseconds()));
			}

			// d is now a local time equivalent to the supplied time
			return d;
		}

		function convertToDateIfRequired(value, childName, fullPath) {
			if (config.datetimeAccessFormPaths.length > 0) {
				var pathWithoutTextNode = fullPath.split("\.#")[0];

				for (var i = 0; i < config.datetimeAccessFormPaths.length; i++) {
					var candidatePath = config.datetimeAccessFormPaths[i];
					if (typeof candidatePath === "string") {
						if (candidatePath === pathWithoutTextNode)
							return xmlDateTimeToDate(value);
					} else if (candidatePath instanceof RegExp) {
						if (candidatePath.test(pathWithoutTextNode))
							return xmlDateTimeToDate(value);
					} else if (typeof candidatePath === "function") {
						if (candidatePath(pathWithoutTextNode))
							return xmlDateTimeToDate(value);
					}
				}
			}

			return value;
		}

		function deserializeRootElementChildren(rootElement) {
			var result = {};
			var children = rootElement.childNodes;

			// Alternative for firstElementChild which is not supported in some environments
			for (var i = 0; i < children.length; i++) {
				var child = children.item(i);
				if (child.nodeType === DOMNodeTypes.ELEMENT_NODE) {
					var childName = getDomNodeLocalName(child);

					if (config.ignoreRoot)
						result = deserializeDomChildren(child, childName);
					else
						result[childName] = deserializeDomChildren(child, childName);
				}
			}

			return result;
		}

		function deserializeElementChildren(element, elementPath) {
			var result = {};
			result.__cnt = 0;

			var nodeChildren = element.childNodes;

			// Child nodes.
			for (var iChild = 0; iChild < nodeChildren.length; iChild++) {
				var child = nodeChildren.item(iChild);
				var childName = getDomNodeLocalName(child);

				if (child.nodeType === DOMNodeTypes.COMMENT_NODE)
					continue;

				result.__cnt++;

				// We deliberately do not accept everything falsey here because
				// elements that resolve to empty string should still be preserved.
				if (result[childName] == null) {
					result[childName] = deserializeDomChildren(child, elementPath + "." + childName);
					ensureProperArrayAccessForm(result, childName, elementPath + "." + childName);
				} else {
					if (!(result[childName] instanceof Array)) {
						result[childName] = [result[childName]];
						ensureProperArrayAccessForm(result, childName, elementPath + "." + childName);
					}

					result[childName][result[childName].length] = deserializeDomChildren(child, elementPath + "." + childName);
				}
			}

			// Attributes
			for (var iAttribute = 0; iAttribute < element.attributes.length; iAttribute++) {
				var attribute = element.attributes.item(iAttribute);
				result.__cnt++;

				var adjustedValue = attribute.value;
				for (var iConverter = 0; iConverter < config.attributeConverters.length; iConverter++) {
					var converter = config.attributeConverters[iConverter];
					if (converter.test.call(null, attribute.name, attribute.value))
						adjustedValue = converter.convert.call(null, attribute.name, attribute.value);
				}

				result[config.attributePrefix + attribute.name] = adjustedValue;
			}

			// Node namespace prefix
			var namespacePrefix = getDomNodeNamespacePrefix(element);
			if (namespacePrefix) {
				result.__cnt++;
				result.__prefix = namespacePrefix;
			}

			if (result["#text"]) {
				result.__text = result["#text"];

				if (result.__text instanceof Array) {
					result.__text = result.__text.join("\n");
				}

				if (config.escapeMode)
					result.__text = unescapeXmlChars(result.__text);

				if (config.stripWhitespaces)
					result.__text = result.__text.trim();

				delete result["#text"];

				if (config.arrayAccessForm === "property")
					delete result["#text_asArray"];

				result.__text = convertToDateIfRequired(result.__text, "#text", elementPath + ".#text");
			}

			if (result.hasOwnProperty('#cdata-section')) {
				result.__cdata = result["#cdata-section"];
				delete result["#cdata-section"];

				if (config.arrayAccessForm === "property")
					delete result["#cdata-section_asArray"];
			}

			if (result.__cnt === 1 && result.__text) {
				result = result.__text;
			} else if (result.__cnt === 0 && config.emptyNodeForm === "text") {
				result = '';
			} else if (result.__cnt > 1 && result.__text !== undefined && config.skipEmptyTextNodesForObj) {
				if (config.stripWhitespaces && result.__text === "" || result.__text.trim() === "") {
					delete result.__text;
				}
			}
			delete result.__cnt;

			/**
			 * We are checking if we are creating a __cdata property or if we just add the content of cdata inside result.
			 * But, if we have a property inside xml tag (<tag PROPERTY="1"></tag>), and a cdata inside, we can't ignore it.
			 * In this case we are keeping __cdata property.
			 */
			if (!config.keepCData && (!result.hasOwnProperty('__text') && result.hasOwnProperty('__cdata') && Object.keys(result).length === 1)) {
				return (result.__cdata ? result.__cdata : '');
			}

			if (config.enableToStringFunc && (result.__text || result.__cdata)) {
				result.toString = function toString() {
					return (this.__text ? this.__text : '') + (this.__cdata ? this.__cdata : '');
				};
			}

			return result;
		}

		function deserializeDomChildren(node, parentPath) {
			if (node.nodeType === DOMNodeTypes.DOCUMENT_NODE) {
				return deserializeRootElementChildren(node);
			} else if (node.nodeType === DOMNodeTypes.ELEMENT_NODE) {
				return deserializeElementChildren(node, parentPath);
			} else if (node.nodeType === DOMNodeTypes.TEXT_NODE || node.nodeType === DOMNodeTypes.CDATA_SECTION_NODE) {
				return node.nodeValue;
			} else {
				return null;
			}
		}

		function serializeStartTag(jsObject, elementName, attributeNames, selfClosing) {
			var resultStr = "<" + ((jsObject && jsObject.__prefix) ? (jsObject.__prefix + ":") : "") + elementName;

			if (attributeNames) {
				for (var i = 0; i < attributeNames.length; i++) {
					var attributeName = attributeNames[i];
					var attributeValue = jsObject[attributeName];

					if (config.escapeMode)
						attributeValue = escapeXmlChars(attributeValue);

					resultStr += " " + attributeName.substr(config.attributePrefix.length) + "=";

					if (config.useDoubleQuotes)
						resultStr += '"' + attributeValue + '"';
					else
						resultStr += "'" + attributeValue + "'";
				}
			}

			if (!selfClosing)
				resultStr += ">";
			else
				resultStr += " />";

			return resultStr;
		}

		function serializeEndTag(jsObject, elementName) {
			return "</" + ((jsObject && jsObject.__prefix) ? (jsObject.__prefix + ":") : "") + elementName + ">";
		}

		function endsWith(str, suffix) {
			return str.indexOf(suffix, str.length - suffix.length) !== -1;
		}

		function isSpecialProperty(jsonObj, propertyName) {
			if ((config.arrayAccessForm === "property" && endsWith(propertyName.toString(), ("_asArray")))
				|| propertyName.toString().indexOf(config.attributePrefix) === 0
				|| propertyName.toString().indexOf("__") === 0
				|| (jsonObj[propertyName] instanceof Function))
				return true;
			else
				return false;
		}

		function getDataElementCount(jsObject) {
			var count = 0;

			if (jsObject instanceof Object) {
				for (var propertyName in jsObject) {
					if (isSpecialProperty(jsObject, propertyName))
						continue;

					count++;
				}
			}

			return count;
		}

		function getDataAttributeNames(jsObject) {
			var names = [];

			if (jsObject instanceof Object) {
				for (var attributeName in jsObject) {
					if (attributeName.toString().indexOf("__") === -1
						&& attributeName.toString().indexOf(config.attributePrefix) === 0) {
						names.push(attributeName);
					}
				}
			}

			return names;
		}

		function serializeComplexTextNodeContents(textNode) {
			var result = "";

			if (textNode.__cdata) {
				result += "<![CDATA[" + textNode.__cdata + "]]>";
			}

			if (textNode.__text || typeof (textNode.__text) === 'number' || typeof (textNode.__text) === 'boolean') {
				if (config.escapeMode)
					result += escapeXmlChars(textNode.__text);
				else
					result += textNode.__text;
			}

			return result;
		}

		function serializeTextNodeContents(textNode) {
			var result = "";

			if (textNode instanceof Object) {
				result += serializeComplexTextNodeContents(textNode);
			} else if (textNode !== null) {
				if (config.escapeMode)
					result += escapeXmlChars(textNode);
				else
					result += textNode;
			}

			return result;
		}

		function serializeArray(elementArray, elementName, attributes) {
			var result = "";

			if (elementArray.length === 0) {
				result += serializeStartTag(elementArray, elementName, attributes, true);
			} else {
				for (var i = 0; i < elementArray.length; i++) {
					result += serializeJavaScriptObject(elementArray[i], elementName, getDataAttributeNames(elementArray[i]));
				}
			}

			return result;
		}

		function serializeJavaScriptObject(element, elementName, attributes) {
			var result = "";

			// Filter out elements
			if (config.jsAttributeFilter && config.jsAttributeFilter.call(null, elementName, element)) {
				return result;
			}
			// Convert element
			if (config.jsAttributeConverter) {
				element = config.jsAttributeConverter.call(null, elementName, element);
			}
			if ((element === undefined || element === null || element === '') && config.selfClosingElements) {
				result += serializeStartTag(element, elementName, attributes, true);
			} else if (typeof element === 'object') {
				if (Object.prototype.toString.call(element) === '[object Array]') {
					result += serializeArray(element, elementName, attributes);
				} else if (element instanceof Date) {
					result += serializeStartTag(element, elementName, attributes, false);
					// Serialize date
					result += config.jsDateUTC ? element.toUTCString() : element.toISOString();
					result += serializeEndTag(element, elementName);
				} else {
					var childElementCount = getDataElementCount(element);
					if (childElementCount > 0 || typeof (element.__text) === 'number' || typeof (element.__text) === 'boolean' || element.__text || element.__cdata) {
						result += serializeStartTag(element, elementName, attributes, false);
						result += serializeJavaScriptObjectChildren(element);
						result += serializeEndTag(element, elementName);
					} else if (config.selfClosingElements) {
						result += serializeStartTag(element, elementName, attributes, true);
					} else {
						result += serializeStartTag(element, elementName, attributes, false);
						result += serializeEndTag(element, elementName);
					}
				}
			} else {
				result += serializeStartTag(element, elementName, attributes, false);
				result += serializeTextNodeContents(element);
				result += serializeEndTag(element, elementName);
			}

			return result;
		}

		function serializeJavaScriptObjectChildren(jsObject) {
			var result = "";

			var elementCount = getDataElementCount(jsObject);

			if (elementCount > 0) {
				for (var elementName in jsObject) {
					if (isSpecialProperty(jsObject, elementName))
						continue;

					var element = jsObject[elementName];
					var attributes = getDataAttributeNames(element);

					result += serializeJavaScriptObject(element, elementName, attributes);
				}
			}

			result += serializeTextNodeContents(jsObject);

			return result;
		}

		function parseXml(xml) {
			if (xml === undefined) {
				return null;
			}

			if (typeof xml !== "string") {
				return null;
			}

			var parser = null;
			var domNode = null;

			if (CustomDOMParser) {
				// This branch is used for node.js, with the xmldom parser.
				parser = new CustomDOMParser(config.xmldomOptions);

				domNode = parser.parseFromString(xml, "text/xml");
			} else if (window && window.DOMParser) {
				parser = new window.DOMParser();
				var parsererrorNS = null;

				var isIEParser = window.ActiveXObject || "ActiveXObject" in window;

				// IE9+ now is here
				if (!isIEParser && document.all && !document.addEventListener) {
					try {
						parsererrorNS = parser.parseFromString("INVALID", "text/xml").childNodes[0].namespaceURI;
					} catch (err) {
						parsererrorNS = null;
					}
				}

				try {
					domNode = parser.parseFromString(xml, "text/xml");
					if (parsererrorNS !== null && domNode.getElementsByTagNameNS(parsererrorNS, "parsererror").length > 0) {
						domNode = null;
					}
				} catch (err) {
					domNode = null;
				}
			} else {
				// IE :(
				if (xml.indexOf("<?") === 0) {
					xml = xml.substr(xml.indexOf("?>") + 2);
				}

				/* global ActiveXObject */
				domNode = new ActiveXObject("Microsoft.XMLDOM");
				domNode.async = "false";
				domNode.loadXML(xml);
			}

			return domNode;
		}

		this.asArray = function asArray(prop) {
			if (prop === undefined || prop === null) {
				return [];
			} else if (prop instanceof Array) {
				return prop;
			} else {
				return [prop];
			}
		};

		this.toXmlDateTime = function toXmlDateTime(dt) {
			if (dt instanceof Date) {
				return dt.toISOString();
			} else if (typeof (dt) === 'number') {
				return new Date(dt).toISOString();
			} else {
				return null;
			}
		};

		this.asDateTime = function asDateTime(prop) {
			if (typeof (prop) === "string") {
				return xmlDateTimeToDate(prop);
			} else {
				return prop;
			}
		};

		/*
			Internally the logic works in a cycle:
			DOM->JS - implemented by custom logic (deserialization).
			JS->XML - implemented by custom logic (serialization).
			XML->DOM - implemented by browser.
		*/

		// Transformns an XML string into DOM-tree
		this.xml2dom = function xml2dom(xml) {
			return parseXml(xml);
		};

		// Transforms a DOM tree to JavaScript objects.
		this.dom2js = function dom2js(domNode) {
			return deserializeDomChildren(domNode, null);
		};

		// Transforms JavaScript objects to a DOM tree.
		this.js2dom = function js2dom(jsObject) {
			var xml = this.js2xml(jsObject);
			return parseXml(xml);
		};

		// Transformns an XML string into JavaScript objects.
		this.xml2js = function xml2js(xml) {
			var domNode = parseXml(xml);
			if (domNode != null)
				return this.dom2js(domNode);
			else
				return null;
		};

		// Transforms JavaScript objects into an XML string.
		this.js2xml = function js2xml(jsObject) {
			return serializeJavaScriptObjectChildren(jsObject);
		};

		this.getVersion = function getVersion() {
			return VERSION;
		};
	};
});


/***/ }),
/* 301 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// 朝某个方向移动多少米

var geoMove_scratchCenter = void 0;
var geoMove_scratchHpr = void 0;
var geoMove_scratchMatrix4 = void 0;
var geoMove_scratchYAxis4 = void 0;
var geoMove_scratchYAxis = void 0;
var geoMove_quaternion = void 0;
var geoMove_one = void 0;
var geoMove_scratchMatrix42 = void 0;
var geoMove_scartchNewPos = void 0;
var geoMove_scartchNewCarto = void 0;

/**
 * 
 * @param {array} origin 原始坐标点，经纬度高度（弧度单位），形如[116.39 * Math.IP / 180, 39.9 * Math.PI / 180, 0]
 * @param {number} heading 偏转角度(0度时表示朝正东向，注意时弧度单位)
 * @param {number} geoDistance 偏移距离(单位是米)
 * @param {array} [result] 形式[0, 0, 0]
 * 
 * @example
 * 
 * XE.Tool.Math.geoMove([116.39 * Math.PI / 180.0, 39.9 * Math.PI / 180, 0], Math.PI*0.5, 10000)
 * // Math.PI*0.5表示朝北
 * // 结果 [2.0313887163962, 0.6948166161691356, 0]
 * // 注意结果是弧度单位，对应位置：2.0313887163962*180.0/Math.PI, 0.6948166161691356*180.0/Math.PI，
 * // 即[116.38999999999999, 39.81005964205274, 0]
 */
function geoMove(origin, heading, geoDistance, result) {
    geoMove_scratchCenter = geoMove_scratchCenter || new Cesium.Cartesian3();
    geoMove_scratchHpr = geoMove_scratchHpr || new Cesium.HeadingPitchRoll();
    geoMove_scratchMatrix4 = geoMove_scratchMatrix4 || new Cesium.Matrix4();
    geoMove_scratchYAxis4 = geoMove_scratchYAxis4 || new Cesium.Cartesian4();
    geoMove_scratchYAxis = geoMove_scratchYAxis || new Cesium.Cartesian3();
    geoMove_quaternion = geoMove_quaternion || new Cesium.Quaternion();
    geoMove_one = geoMove_one || new Cesium.Cartesian3(1, 1, 1);
    geoMove_scratchMatrix42 = geoMove_scratchMatrix42 || new Cesium.Matrix4();
    geoMove_scartchNewPos = geoMove_scartchNewPos || new Cesium.Cartesian3();
    geoMove_scartchNewCarto = geoMove_scartchNewCarto || new Cesium.Cartographic();

    var center = Cesium.Cartesian3.fromRadians(origin[0], origin[1], 0, undefined, geoMove_scratchCenter);
    var hpr = geoMove_scratchHpr;hpr.xbsjFromArray(heading, 0, 0);
    var transform = Cesium.Transforms.headingPitchRollToFixedFrame(center, hpr, undefined, undefined, geoMove_scratchMatrix4);
    var yAxis4 = Cesium.Matrix4.getColumn(transform, 1, geoMove_scratchYAxis4);
    var yAxis = geoMove_scratchYAxis;
    yAxis.x = yAxis4.x;
    yAxis.y = yAxis4.y;
    yAxis.z = yAxis4.z;
    var quat = Cesium.Quaternion.fromAxisAngle(yAxis, geoDistance * Cesium.Ellipsoid.WGS84.oneOverRadii.x, geoMove_quaternion);

    var mm = Cesium.Matrix4.fromTranslationQuaternionRotationScale(Cesium.Cartesian3.ZERO, quat, geoMove_one, geoMove_scratchMatrix42);

    var newPos = Cesium.Matrix4.multiplyByPoint(mm, center, geoMove_scartchNewPos);
    var newCarto = Cesium.Cartographic.fromCartesian(newPos, undefined, geoMove_scartchNewCarto);
    result = result || [0, 0, 0];
    result[0] = newCarto.longitude;
    result[1] = newCarto.latitude;
    result[2] = origin[2];

    return result;
}

exports.default = geoMove;

/***/ }),
/* 302 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var geoLerp_scratchStart = void 0;
var geoLerp_scratchEnd = void 0;
var geoLerp_scratchResult = void 0;
var geoLerp_scratchCarto = void 0;

function geoLerp(start, end, t, result) {
    var _Cesium$Cartesian, _Cesium$Cartesian2;

    geoLerp_scratchStart = geoLerp_scratchStart || new Cesium.Cartesian3();
    geoLerp_scratchEnd = geoLerp_scratchEnd || new Cesium.Cartesian3();
    geoLerp_scratchResult = geoLerp_scratchResult || new Cesium.Cartesian3();
    geoLerp_scratchCarto = geoLerp_scratchCarto || new Cesium.Cartographic();

    var cs = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(start).concat([undefined, geoLerp_scratchStart]));
    var ce = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(end).concat([undefined, geoLerp_scratchEnd]));

    var cr = Cesium.Cartesian3.lerp(cs, ce, t, geoLerp_scratchResult);

    if (!cr) {
        return undefined;
    }

    var carto = Cesium.Cartographic.fromCartesian(cr, undefined, geoLerp_scratchCarto);

    if (!carto) {
        return undefined;
    }

    result = result || [];
    result.splice(0, result.length, carto.longitude, carto.latitude, carto.height);

    return result;
}

exports.default = geoLerp;

/***/ }),
/* 303 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var hpr_camera = void 0;
var hpr_origin = void 0;
var hpr_destination = void 0;
var hpr_dir = void 0;
var hpr_up = void 0;
var hpr_result = void 0;

// 注意返回的heading为0时，朝东。
// vtxf(15017528)  9:36:48
// 注意这里的origin和destination是Cartesian3，即世界坐标系下的坐标点
// vtxf(15017528)  9:37:01
// 返回值是一个数据 [heading, pitch, roll]
function hpr(origin, destination, result) {
    try {
        var _Cesium$Cartesian, _Cesium$Cartesian2;

        hpr_camera = hpr_camera || new Cesium.Camera(window.xbsj_hpr_scene); // xbsj_hpr_scene是个很无奈的选择。。
        hpr_origin = hpr_origin || new Cesium.Cartesian3();
        hpr_destination = hpr_destination || new Cesium.Cartesian3();
        hpr_dir = hpr_dir || new Cesium.Cartesian3();
        hpr_up = hpr_up || new Cesium.Cartesian3();
        hpr_result = hpr_result || new Cesium.HeadingPitchRoll();

        var oc = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(origin).concat([undefined, hpr_origin]));
        var dc = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(destination).concat([undefined, hpr_destination]));

        if (Cesium.Cartesian3.equals(oc, dc)) {
            return undefined;
        }

        var dir = Cesium.Cartesian3.subtract(dc, oc, hpr_dir);
        dir = Cesium.Cartesian3.normalize(dir, dir);

        var up = Cesium.Cartesian3.normalize(oc, hpr_up);
        up = Cesium.Cartesian3.normalize(up, up);

        hpr_camera.setView({
            destination: oc,
            orientation: {
                direction: dir,
                up: up
            }
        });

        result = result || [0, 0, 0];

        var heading = hpr_camera.heading;
        heading -= Cesium.Math.PI_OVER_TWO;
        if (heading < 0) {
            heading += Cesium.Math.TWO_PI;
        }

        result.splice(0, result.length, heading, hpr_camera.pitch, hpr_camera.roll);

        return result;
    } catch (error) {
        return undefined;
    }
}

exports.default = hpr;

/***/ }),
/* 304 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var distance_sc1 = void 0;
var distance_sc2 = void 0;
function _distance1(left, right) {
    var _Cesium$Cartesian, _Cesium$Cartesian2;

    distance_sc1 = distance_sc1 || new Cesium.Cartesian3();
    distance_sc2 = distance_sc2 || new Cesium.Cartesian3();
    var lc = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(left).concat([undefined, distance_sc1]));
    var rc = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(right).concat([undefined, distance_sc2]));

    return Cesium.Cartesian3.distance(lc, rc);
}

function _distance2(positions) {
    var l = positions.length;
    var d = 0;
    for (var i = 0; i < l - 1; ++i) {
        d += _distance1(positions[i], positions[i + 1]);
    }

    return d;
}

function distance(l, r) {
    if (typeof r === 'undefined' && Array.isArray(l)) {
        return _distance2(l);
    } else {
        return _distance1(l, r);
    }
}

exports.default = distance;

/***/ }),
/* 305 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _defineProperties = __webpack_require__(112);

var _defineProperties2 = _interopRequireDefault(_defineProperties);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 直接修改Array，为了用起来简单。。
(0, _defineProperties2.default)(Array.prototype, {
    xeptr: {
        get: function get() {
            if (this.length !== 3) {
                throw new Error('ptr只有在表示位置时（只有三个元素），才能使用！');
            }
            this[0] = this[0] * Math.PI / 180.0;
            this[1] = this[1] * Math.PI / 180.0;
            return this;
        }
    },
    xePositionToRadians: {
        get: function get() {
            return this.xeptr;
        }
    },
    xeptd: {
        get: function get() {
            if (this.length !== 3) {
                throw new Error('ptd只有在表示位置时（只有三个元素），才能使用！');
            }
            this[0] = this[0] * 180.0 / Math.PI;
            this[1] = this[1] * 180.0 / Math.PI;
            return this;
        }
    },
    xePositionToDegrees: {
        get: function get() {
            return this.xeptd;
        }
    },
    xertr: {
        get: function get() {
            if (this.length !== 3) {
                throw new Error('rtr只有在表示姿态时（只有三个元素），才能使用！');
            }
            this[0] = this[0] * Math.PI / 180.0;
            this[1] = this[1] * Math.PI / 180.0;
            this[2] = this[2] * Math.PI / 180.0;
            return this;
        }
    },
    xeRotationToRadians: {
        get: function get() {
            return this.xertr;
        }
    },
    xertd: {
        get: function get() {
            if (this.length !== 3) {
                throw new Error('rtd只有在表示姿态时（只有三个元素），才能使用！');
            }
            this[0] = this[0] * 180.0 / Math.PI;
            this[1] = this[1] * 180.0 / Math.PI;
            this[2] = this[2] * 180.0 / Math.PI;
            return this;
        }
    },
    xeRotationToDegrees: {
        get: function get() {
            return this.xertd;
        }
    }
});

/**
 * positionMove会对position进行偏移处理，会修改数组自身！
 * @param {Number} x 东西向偏移量，单位米
 * @param {Number} y 南北向偏移量，单位米
 * @param {Number} z 上下方向偏移量，单位米
 * @returns {Number[]} 返回自身的对象 
 */
Array.prototype.xePositionMove = function () {
    var x = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
    var y = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 0;
    var z = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : 0;

    var c = 6378137 * Math.cos(this[1]);
    var diffX = x / c;
    var diffY = y / 6378137;
    var diffZ = z;
    this[0] += diffX;
    this[1] += diffY;
    this[2] += diffZ;
    return this;
};

/**
 * pm相当于positionMove的简写
 */
Array.prototype.xepm = Array.prototype.xePositionMove;

var scratchCartesian = void 0;
var scratchCartesian2 = void 0;

Array.prototype.xePositionDistance = function (other) {
    var _Cesium$Cartesian, _Cesium$Cartesian2;

    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchCartesian2 = scratchCartesian2 || new Cesium.Cartesian3();

    var self = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(this).concat([undefined, scratchCartesian]));
    var otherC = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(other).concat([undefined, scratchCartesian2]));

    return Cesium.Cartesian3.distance(self, otherC);
};

Array.prototype.xepd = Array.prototype.xePositionDistance;

Array.prototype.xePositionEqual = function (other) {
    return Cesium.Math.equalsEpsilon(this[0], other[0], 0, Cesium.Math.EPSILON7) && Cesium.Math.equalsEpsilon(this[1], other[1], 0, Cesium.Math.EPSILON7) && Cesium.Math.equalsEpsilon(this[2], other[2], 0, Cesium.Math.EPSILON3);
};

Array.prototype.xepe = Array.prototype.xePositionEqual;

Array.prototype.xeRotationEqual = function (other) {
    return Cesium.Math.equalsEpsilon(this[0], other[0], 0, Cesium.Math.EPSILON3) && Cesium.Math.equalsEpsilon(this[1], other[1], 0, Cesium.Math.EPSILON3) && Cesium.Math.equalsEpsilon(this[2], other[2], 0, Cesium.Math.EPSILON3);
};

Array.prototype.xere = Array.prototype.xeRotationEqual;

/***/ }),
/* 306 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


var _defineProperties = __webpack_require__(112);

var _defineProperties2 = _interopRequireDefault(_defineProperties);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchColor = void 0;

(0, _defineProperties2.default)(String.prototype, {
    xeColor: {
        get: function get() {
            scratchColor = scratchColor || new Cesium.Color();
            var color = Cesium.Color.fromCssColorString(this, scratchColor);
            if (color) {
                return [color.red, color.green, color.blue, color.alpha];
            }
        }
    },
    xec: {
        get: function get() {
            return this.xeColor;
        }
    }
});

/***/ }),
/* 307 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var _bezier2_scrtachC0 = void 0;
var _bezier2_scrtachC1 = void 0;
var _bezier2_scrtachC2 = void 0;
function _bezier2(c0, c1, c2, t, result) {
    _bezier2_scrtachC0 = _bezier2_scrtachC0 || new Cesium.Cartesian3();
    _bezier2_scrtachC1 = _bezier2_scrtachC1 || new Cesium.Cartesian3();
    _bezier2_scrtachC2 = _bezier2_scrtachC2 || new Cesium.Cartesian3();

    var cc0 = Cesium.Cartesian3.multiplyByScalar(c0, (1 - t) * (1 - t), _bezier2_scrtachC0);
    var cc1 = Cesium.Cartesian3.multiplyByScalar(c1, 2 * t * (1 - t), _bezier2_scrtachC1);
    var cc2 = Cesium.Cartesian3.multiplyByScalar(c2, t * t, _bezier2_scrtachC2);

    result = result || new Cesium.Cartesian3();

    result.x = cc0.x + cc1.x + cc2.x;
    result.y = cc0.y + cc1.y + cc2.y;
    result.z = cc0.z + cc1.z + cc2.z;

    return result;
}

var _bezier3_scrtachC0 = void 0;
var _bezier3_scrtachC1 = void 0;
var _bezier3_scrtachC2 = void 0;
var _bezier3_scrtachC3 = void 0;
function _bezier3(c0, c1, c2, c3, t, result) {
    _bezier3_scrtachC0 = _bezier3_scrtachC0 || new Cesium.Cartesian3();
    _bezier3_scrtachC1 = _bezier3_scrtachC1 || new Cesium.Cartesian3();
    _bezier3_scrtachC2 = _bezier3_scrtachC2 || new Cesium.Cartesian3();
    _bezier3_scrtachC3 = _bezier3_scrtachC3 || new Cesium.Cartesian3();

    var cc0 = Cesium.Cartesian3.multiplyByScalar(c0, (1 - t) * (1 - t) * (1 - t), _bezier3_scrtachC0);
    var cc1 = Cesium.Cartesian3.multiplyByScalar(c1, 3 * t * (1 - t) * (1 - t), _bezier3_scrtachC1);
    var cc2 = Cesium.Cartesian3.multiplyByScalar(c2, 3 * t * t * (1 - t), _bezier3_scrtachC2);
    var cc3 = Cesium.Cartesian3.multiplyByScalar(c3, t * t * t, _bezier3_scrtachC3);

    result = result || new Cesium.Cartesian3();

    result.x = cc0.x + cc1.x + cc2.x + cc3.x;
    result.y = cc0.y + cc1.y + cc2.y + cc3.y;
    result.z = cc0.z + cc1.z + cc2.z + cc3.z;

    return result;
}

var bezier2Length_scratchC0 = void 0;
var bezier2Length_scratchC1 = void 0;
var bezier2Length_scratchC2 = void 0;
var bezier2Length_scratchC3 = void 0;
function bezier2Length(p0, p1, p2) {
    var _Cesium$Cartesian, _Cesium$Cartesian2, _Cesium$Cartesian3;

    var slices = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 100;

    bezier2Length_scratchC0 = bezier2Length_scratchC0 || new Cesium.Cartesian3();
    bezier2Length_scratchC1 = bezier2Length_scratchC1 || new Cesium.Cartesian3();
    bezier2Length_scratchC2 = bezier2Length_scratchC2 || new Cesium.Cartesian3();
    bezier2Length_scratchC3 = bezier2Length_scratchC3 || new Cesium.Cartesian3();

    var c0 = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(p0).concat([undefined, bezier2Length_scratchC0]));
    var c1 = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(p1).concat([undefined, bezier2Length_scratchC1]));
    var c2 = (_Cesium$Cartesian3 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian3, (0, _toConsumableArray3.default)(p2).concat([undefined, bezier2Length_scratchC2]));

    var l = 0;
    var s = 1 / slices;
    var r0 = c0;
    for (var i = 1; i <= slices; i++) {
        var t = s * i;
        var r1 = _bezier2(c0, c1, c2, t, bezier2Length_scratchC3);
        var d = Cesium.Cartesian3.distance(r0, r1);
        l += d;
        r0 = r1;
    }

    return l;
}

var bezier2_scratchC0 = void 0;
var bezier2_scratchC1 = void 0;
var bezier2_scratchC2 = void 0;
var bezier2_scratchC3 = void 0;
var bezier2_scrtachC4 = void 0;
function bezier2(p0, p1, p2) {
    var _Cesium$Cartesian4, _Cesium$Cartesian5, _Cesium$Cartesian6;

    var slices = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 100;
    var result = arguments[4];

    bezier2_scratchC0 = bezier2_scratchC0 || new Cesium.Cartesian3();
    bezier2_scratchC1 = bezier2_scratchC1 || new Cesium.Cartesian3();
    bezier2_scratchC2 = bezier2_scratchC2 || new Cesium.Cartesian3();
    bezier2_scratchC3 = bezier2_scratchC3 || new Cesium.Cartesian3();
    bezier2_scrtachC4 = bezier2_scrtachC4 || new Cesium.Cartographic();

    var c0 = (_Cesium$Cartesian4 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian4, (0, _toConsumableArray3.default)(p0).concat([undefined, bezier2_scratchC0]));
    var c1 = (_Cesium$Cartesian5 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian5, (0, _toConsumableArray3.default)(p1).concat([undefined, bezier2_scratchC1]));
    var c2 = (_Cesium$Cartesian6 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian6, (0, _toConsumableArray3.default)(p2).concat([undefined, bezier2_scratchC2]));

    result = result || [];
    result.length = 0;

    var l = 0;
    var s = 1 / slices;
    var r0 = c0;
    result.push([].concat((0, _toConsumableArray3.default)(p0)));
    for (var i = 1; i <= slices; i++) {
        var t = s * i;
        var r1 = _bezier2(c0, c1, c2, t, bezier2_scratchC3);

        var carto = Cesium.Cartographic.fromCartesian(r1, undefined, bezier2_scrtachC4);
        result.push([carto.longitude, carto.latitude, carto.height]);

        var d = Cesium.Cartesian3.distance(r0, r1);
        l += d;
        r0 = r1;
    }

    return l;
}

var bezier3Length_scratchC0 = void 0;
var bezier3Length_scratchC1 = void 0;
var bezier3Length_scratchC2 = void 0;
var bezier3Length_scratchC3 = void 0;
var bezier3Length_scratchC4 = void 0;
function bezier3Length(p0, p1, p2, p3) {
    var _Cesium$Cartesian7, _Cesium$Cartesian8, _Cesium$Cartesian9, _Cesium$Cartesian10;

    var slices = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 100;

    bezier3Length_scratchC0 = bezier3Length_scratchC0 || new Cesium.Cartesian3();
    bezier3Length_scratchC1 = bezier3Length_scratchC1 || new Cesium.Cartesian3();
    bezier3Length_scratchC2 = bezier3Length_scratchC2 || new Cesium.Cartesian3();
    bezier3Length_scratchC3 = bezier3Length_scratchC3 || new Cesium.Cartesian3();
    bezier3Length_scratchC4 = bezier3Length_scratchC4 || new Cesium.Cartesian3();

    var c0 = (_Cesium$Cartesian7 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian7, (0, _toConsumableArray3.default)(p0).concat([undefined, bezier3Length_scratchC0]));
    var c1 = (_Cesium$Cartesian8 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian8, (0, _toConsumableArray3.default)(p1).concat([undefined, bezier3Length_scratchC1]));
    var c2 = (_Cesium$Cartesian9 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian9, (0, _toConsumableArray3.default)(p2).concat([undefined, bezier3Length_scratchC2]));
    var c3 = (_Cesium$Cartesian10 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian10, (0, _toConsumableArray3.default)(p3).concat([undefined, bezier3Length_scratchC3]));

    var l = 0;
    var s = 1 / slices;
    var r0 = c0;
    for (var i = 1; i <= slices; i++) {
        var t = s * i;
        var r1 = _bezier3(c0, c1, c2, c3, t, bezier3Length_scratchC4);
        var d = Cesium.Cartesian3.distance(r0, r1);
        l += d;
        r0 = r1;
    }

    return l;
}

var bezier3_scratchC0 = void 0;
var bezier3_scratchC1 = void 0;
var bezier3_scratchC2 = void 0;
var bezier3_scratchC3 = void 0;
var bezier3_scratchC4 = void 0;
var bezier3_scrtachC5 = void 0;
function bezier3(p0, p1, p2, p3) {
    var _Cesium$Cartesian11, _Cesium$Cartesian12, _Cesium$Cartesian13, _Cesium$Cartesian14;

    var slices = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 100;
    var result = arguments[5];

    bezier3_scratchC0 = bezier3_scratchC0 || new Cesium.Cartesian3();
    bezier3_scratchC1 = bezier3_scratchC1 || new Cesium.Cartesian3();
    bezier3_scratchC2 = bezier3_scratchC2 || new Cesium.Cartesian3();
    bezier3_scratchC3 = bezier3_scratchC3 || new Cesium.Cartesian3();
    bezier3_scratchC4 = bezier3_scratchC4 || new Cesium.Cartesian3();
    bezier3_scrtachC5 = bezier3_scrtachC5 || new Cesium.Cartographic();

    var c0 = (_Cesium$Cartesian11 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian11, (0, _toConsumableArray3.default)(p0).concat([undefined, bezier3_scratchC0]));
    var c1 = (_Cesium$Cartesian12 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian12, (0, _toConsumableArray3.default)(p1).concat([undefined, bezier3_scratchC1]));
    var c2 = (_Cesium$Cartesian13 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian13, (0, _toConsumableArray3.default)(p2).concat([undefined, bezier3_scratchC2]));
    var c3 = (_Cesium$Cartesian14 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian14, (0, _toConsumableArray3.default)(p3).concat([undefined, bezier3_scratchC3]));

    result = result || [];
    result.length = 0;

    var l = 0;
    var s = 1 / slices;
    var r0 = c0;
    result.push([].concat((0, _toConsumableArray3.default)(p0)));
    for (var i = 1; i <= slices; i++) {
        var t = s * i;
        var r1 = _bezier3(c0, c1, c2, c3, t, bezier3_scratchC4);

        var carto = Cesium.Cartographic.fromCartesian(r1, undefined, bezier3_scrtachC5);
        result.push([carto.longitude, carto.latitude, carto.height]);

        var d = Cesium.Cartesian3.distance(r0, r1);
        l += d;
        r0 = r1;
    }

    return l;
}

var Bezier = {
    bezier2Length: bezier2Length,
    bezier2: bezier2,
    bezier3Length: bezier3Length,
    bezier3: bezier3
};

exports.default = Bezier;

/***/ }),
/* 308 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

function _hasSamePosition1(left, right) {
    return left[0] === right[0] && left[1] === right[1] && left[2] === right[2];
}

function _hasSamePosition2(positions) {
    var l = positions.length;

    var result = false;
    for (var i = 0; i < l - 1; ++i) {
        if (_hasSamePosition1(positions[i], positions[i + 1])) {
            result = true;
            break;
        }
    }

    return result;
}

function hasSamePosition(left, right) {
    if (typeof right !== 'undefined') {
        return _hasSamePosition1(left, right);
    } else {
        return _hasSamePosition2(left);
    }
}

exports.default = hasSamePosition;

/***/ }),
/* 309 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
/***
 * 指定模型坐标a和b，和对应在地球上的A和B，求模型的位置姿态信息
 * @param {Cesium.Cartesian3} a 模型本地坐标点a，从3dmax中获取，数值应该都不大
 * @param {Cesium.Cartesian3} b 模型本地坐标点b，从3dmax中获取，数值应该都不大
 * @param {Cesium.Cartesian3} A 以地球球心为原点建立的笛卡尔坐标系下的坐标点A，数值应该会很大
 * @param {Cesium.Cartesian3} B 以地球球心为原点建立的笛卡尔坐标系下的坐标点A，数值应该会很大
 * @returns {
    *      scale: number, // 缩放值  
    *      rotation: Cesium.Quaternion, // 四元数旋转量  
    *      positionInCartesian: Cesium.Cartesian3, // 位置 世界坐标系  
    *      positionInRadians: Cesium.HeadingPitchRoll, // 位置 经纬度弧度  
    *      positionInDegrees: {  
    *          longitude: number,  
    *          latitude: number,  
    *          height: number,  
    *      }, // 位置 经纬度度数  
    *      hpr: Cesium.HeadingPitchRoll, // 欧拉角，弧度单位  
    *      hprInDegrees: {  
    *          heading: number,  
    *          pitch: number,  
    *          roll: number,  
    *      }, // 欧拉角，度数单位  
    *      modelMatrix: Cesium.Matrix4, // 矩阵  
    * }  
    */
var ab2Ab = function (a, b, A, B) {
    var rotationToCreate = function rotationToCreate() {
        var vec3 = {
            create: function create() {
                return new Cesium.Cartesian3();
            },
            fromValues: Cesium.Cartesian3.fromElements,
            dot: Cesium.Cartesian3.dot,
            cross: function cross(r, a, b) {
                return Cesium.Cartesian3.cross(a, b, r);
            },
            len: Cesium.Cartesian3.magnitude,
            normalize: function normalize(r, a) {
                return Cesium.Cartesian3.normalize(a, r);
            }
        };
        var setAxisAngle = function setAxisAngle(r, a, b) {
            return Cesium.Quaternion.fromAxisAngle(a, b, r);
        };
        var normalize = function normalize(r, a) {
            return Cesium.Quaternion.normalize(a, r);
        };

        var tmpvec3 = vec3.create();
        var xUnitVec3 = vec3.fromValues(1, 0, 0);
        var yUnitVec3 = vec3.fromValues(0, 1, 0);

        return function (out, a, b) {
            var dot = vec3.dot(a, b);
            if (dot < -0.999999) {
                vec3.cross(tmpvec3, xUnitVec3, a);
                if (vec3.len(tmpvec3) < 0.000001) vec3.cross(tmpvec3, yUnitVec3, a);
                vec3.normalize(tmpvec3, tmpvec3);
                setAxisAngle(out, tmpvec3, Math.PI);
                return out;
            } else if (dot > 0.999999) {
                out.x = 0;
                out.y = 0;
                out.z = 0;
                out.w = 1;
                return out;
            } else {
                vec3.cross(tmpvec3, a, b);
                out.x = tmpvec3.x;
                out.y = tmpvec3.y;
                out.z = tmpvec3.z;
                out.w = 1 + dot;
                return normalize(out, out);
            }
        };
    };

    var rotationTo;
    function ab2ABInner(a, b, A, B) {
        if (!rotationTo) {
            rotationTo = rotationToCreate();
        }

        var enuMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(A);
        var inverseEnuMatrix = new Cesium.Matrix4();
        inverseEnuMatrix = Cesium.Matrix4.inverse(enuMatrix, inverseEnuMatrix);

        var lA = new Cesium.Cartesian3();
        lA = Cesium.Matrix4.multiplyByPoint(inverseEnuMatrix, A, lA);
        // lA (0, 0, 0)

        var lB = new Cesium.Cartesian3();
        lB = Cesium.Matrix4.multiplyByPoint(inverseEnuMatrix, B, lB);

        var d = new Cesium.Cartesian3();
        Cesium.Cartesian3.subtract(b, a, d);
        var lD = new Cesium.Cartesian3();
        Cesium.Cartesian3.subtract(lB, lA, lD);

        var dl = Cesium.Cartesian3.magnitude(d);
        Cesium.Cartesian3.normalize(d, d);

        var lDl = Cesium.Cartesian3.magnitude(lD);
        Cesium.Cartesian3.normalize(lD, lD);

        var q = new Cesium.Quaternion();
        rotationTo(q, d, lD);

        var s = lDl / dl;

        var srM = Cesium.Matrix4.fromTranslationQuaternionRotationScale(Cesium.Cartesian3.ZERO, q, Cesium.Cartesian3.fromElements(s, s, s));

        var ta = new Cesium.Cartesian3();
        ta = Cesium.Matrix4.multiplyByPoint(srM, a, ta);

        var t = Cesium.Cartesian3.subtract(lA, ta, new Cesium.Cartesian3());

        var p = Cesium.Matrix4.multiplyByPoint(enuMatrix, t, new Cesium.Cartesian3());

        var modelMatrix = new Cesium.Matrix4();
        {
            var _enuMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(p);
            Cesium.Matrix4.multiply(_enuMatrix, srM, modelMatrix);
        }

        //    { // 验证矩阵是否可用
        //        var AA = Cesium.Matrix4.multiplyByPoint(modelMatrix, a, new Cesium.Cartesian3());
        //        var BB = Cesium.Matrix4.multiplyByPoint(modelMatrix, b, new Cesium.Cartesian3());
        //        var ba = Cesium.Cartesian3.equalsEpsilon(A, AA, 0.000001);
        //        var bb = Cesium.Cartesian3.equalsEpsilon(B, BB, 0.000001);
        //        console.log(`ba: ${ba} bb: ${bb}`);
        //    }

        var pd = Cesium.Cartographic.fromCartesian(p);
        var pdd = {
            longitude: Cesium.Math.toDegrees(pd.longitude),
            latitude: Cesium.Math.toDegrees(pd.latitude),
            height: pd.height
        };

        var hpr = Cesium.HeadingPitchRoll.fromQuaternion(q);
        var hprInDegrees = {
            heading: Cesium.Math.toDegrees(hpr.heading),
            pitch: Cesium.Math.toDegrees(hpr.pitch),
            roll: Cesium.Math.toDegrees(hpr.roll)
        };

        return {
            scale: s, // 缩放值
            rotation: q, // 四元数旋转量
            positionInCartesian: p, // 位置 世界坐标系
            positionInRadians: pd, // 位置 经纬度弧度
            positionInDegrees: pdd, // 位置 经纬度度数
            hpr: hpr, // 欧拉角
            hprInDegrees: hprInDegrees, // 欧拉角度数
            modelMatrix: modelMatrix // 矩阵
        };
    }

    return ab2ABInner;
}();

// 测试代码
// var d = 90 / 6378137 * Math.cos(39.9*Math.PI/180.0) * 180.0 / Math.PI;
// var r = ab2AB(new Cesium.Cartesian3(0, 0, 0), new Cesium.Cartesian3(9, 0, 0), Cesium.Cartesian3.fromDegrees(116.39, 39.9, 10), Cesium.Cartesian3.fromDegrees(116.39+d, 39.9+d, 10));

// 测试结果
// r
// hpr: HeadingPitchRoll {heading: -0.9144926619303422, pitch: -0.000006817781220470006, roll: 0.0000033545107762258553}
// hprInDegrees: {heading: -52.39656992429262, pitch: -0.0003906300895764828, roll: 0.00019219930980889525}
// modelMatrix: Matrix4 {0: -3.097668797368073, 1: -7.016404683562405, 2: 5.8702447516825496, 3: 0, 4: 8.534799207794942, 5: 0.01471073108238698, 6: 4.521310228614556, 7: 0, 8: -3.293464833696548, 9: 6.637402279298378, 10: 6.195420928260614, 11: 0, 12: -2177877.4065915043, 13: 4389228.925361875, 14: 4069480.0899964543, 15: 1}
// positionInCartesian: Cartesian3 {x: -2177877.4065915043, y: 4389228.925361875, z: 4069480.0899964543}
// positionInDegrees: {longitude: 116.39000000000004, latitude: 39.900000000000006, height: 9.999999999239673}
// positionInRadians: Cartographic {longitude: 2.0313887163962008, latitude: 0.6963863715457376, height: 9.999999999239673}
// rotation: Quaternion {x: -0, y: 0.000003799173703503064, z: 0.4414789948994098, w: 0.8972715848884179}
// scale: 9.658429484463856

exports.ab2Ab = ab2Ab;
exports.default = ab2Ab;

/***/ }),
/* 310 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _registerInteractionProperty = __webpack_require__(15);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    /**
     * 视频服务路径
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.CameraVideo
     */
    videoUrl: '',
    /**
     * 位置数组 [经度、纬度、高度]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.CameraVideo
     */
    position: [0, 0, 0],
    /**
     * 姿态数组 [偏航角、俯仰角、翻转角]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.CameraVideo
     */
    rotation: [0, 0, 0],
    // fov: 30.0 / 180.0 * Math.PI,
    // aspectRatio: 1.0,
    /**
     * 水平广角（单位弧度）
     * @type {number}
     * @instance
     * @default Math.PI / 3
     * @memberof Obj.CameraVideo
     */
    fovH: Math.PI / 3,
    /**
     * 垂直广角（单位弧度）
     * @type {number}
     * @instance
     * @default Math.PI / 6
     * @memberof Obj.CameraVideo
     */
    fovV: Math.PI / 6,
    /**
     * 近裁
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.CameraVideo
     */
    near: 1.0,
    /**
     * 远裁
     * @type {number}
     * @instance
     * @default 10000
     * @memberof Obj.CameraVideo
     */
    far: 10000.0,
    /**
     * 是否显示辅助线框
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.CameraVideo
     */
    showHelper: true,
    /**
     * 是否在三维窗口中显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.CameraVideo
     */
    show: true
};

function createVideoElement(videoSrc) {
    var videoElement = document.createElement('video');
    videoElement.src = videoSrc;
    // videoElement.type = 'video/mp4';
    videoElement.style.position = 'absolute';
    videoElement.style.zIndex = '-100';
    videoElement.style.visibility = 'hidden';
    videoElement.style.top = '0';
    videoElement.style.left = '0';
    videoElement.style.width = '100px';
    videoElement.style.height = '100px';
    videoElement.crossOrigin = '';
    videoElement.autoplay = true;
    videoElement.loop = true;
    videoElement.muted = true;
    document.body.appendChild(videoElement);

    return videoElement;
}

function destroyVideoElement(videoElement) {
    document.body.removeChild(videoElement);
}

var scratchSetViewQuaternion = void 0;
var scratchSetViewMatrix3 = void 0;
function hpr2m(_ref, result) {
    var position = _ref.position,
        heading = _ref.heading,
        pitch = _ref.pitch,
        roll = _ref.roll;

    scratchSetViewQuaternion = scratchSetViewQuaternion || new Cesium.Quaternion();
    scratchSetViewMatrix3 = scratchSetViewMatrix3 || new Cesium.Matrix3();

    // const inverseViewMatrix = Cesium.Transforms.headingPitchRollToFixedFrame(position, headingPitchRoll, undefined, undefined, result);
    var inverseViewMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(position, undefined, result);
    // const hpr = new Cesium.HeadingPitchRoll(heading - Cesium.Math.PI_OVER_TWO, pitch, roll);
    // var rotQuat = Cesium.Quaternion.fromHeadingPitchRoll(hpr, scratchSetViewQuaternion);
    // var rotMat = Cesium.Matrix3.fromQuaternion(rotQuat, scratchSetViewMatrix3);
    var rotMat = Cesium.Matrix3.fromRotationX(Cesium.Math.PI_OVER_TWO, scratchSetViewMatrix3);
    Cesium.Matrix4.multiplyByMatrix3(inverseViewMatrix, rotMat, inverseViewMatrix);

    rotMat = Cesium.Matrix3.fromRotationY(-heading, scratchSetViewMatrix3);
    Cesium.Matrix4.multiplyByMatrix3(inverseViewMatrix, rotMat, inverseViewMatrix);

    rotMat = Cesium.Matrix3.fromRotationX(pitch, scratchSetViewMatrix3);
    Cesium.Matrix4.multiplyByMatrix3(inverseViewMatrix, rotMat, inverseViewMatrix);

    rotMat = Cesium.Matrix3.fromRotationZ(-roll, scratchSetViewMatrix3);
    Cesium.Matrix4.multiplyByMatrix3(inverseViewMatrix, rotMat, inverseViewMatrix);

    return inverseViewMatrix;
}

/**
 * 视频融合类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var CameraVideo = function (_XbsjCzmObj) {
    (0, _inherits3.default)(CameraVideo, _XbsjCzmObj);

    function CameraVideo(earth, guid) {
        (0, _classCallCheck3.default)(this, CameraVideo);

        // const aspectRatio = this.frustum.aspectRatio;
        // const fov = this.frustum.fov;
        // if (aspectRatio > 1.0) {
        //     return fov;
        // } else {
        //     const fovV = fov;
        //     const fovH = Math.atan((aspectRatio * Math.tan(fovV * 0.5))) * 2.0;
        //     return fovH;
        // }

        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraVideo.__proto__ || (0, _getPrototypeOf2.default)(CameraVideo)).call(this, earth, guid));

        (0, _mobx.extendObservable)(_this, {
            _videoElement: undefined,
            twoPostionsEditing: false
        }, {
            _videoElement: _mobx.observable.ref
        });

        _this._cameraVideo = undefined;
        _this._videoElement = undefined;

        // autorun(() => {
        //     this._videoElement && destroyVideoElement(this._videoElement);
        //     this.videoUrl && (this._videoElement = createVideoElement(this.videoUrl));
        // });
        _this._disposers = _this._disposers || [];
        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._settingVideoElement = undefined;
        _this._hls = undefined;
        _this._disposers.push(function () {
            if (_this._settingVideoElement) {
                _this._settingVideoElement.unsubscribe();
                _this._settingVideoElement = undefined;
            }
            if (_this._hls) {
                _this._hls.destroy();
                _this._hls = undefined;
            }
        });

        var refreshSettingVideoElement = function refreshSettingVideoElement(videoUrl) {
            if (_this._settingVideoElement) {
                _this._settingVideoElement.unsubscribe();
                _this._settingVideoElement = undefined;
            }

            if (_this._hls) {
                _this._hls.destroy();
                _this._hls = undefined;
            }

            _this._videoElement && destroyVideoElement(_this._videoElement);

            if (!videoUrl.endsWith('.m3u8')) {
                _this.videoUrl && (_this._videoElement = createVideoElement(videoUrl));
            } else {
                _this._settingVideoElement = rxjs.iif(function () {
                    return typeof Hls !== 'undefined';
                }, rxjs.of(0),
                // rxjs.from(XE.HTML.loadJS('https://cdn.bootcss.com/hls.js/8.0.0-beta.3/hls.min.js'))
                _HTML2.default.loadJS(_HTML2.default.xbsjEarthDir + 'thirdParty/hls/v0.12.4/hls.min.js')).pipe(rxjs.operators.map(function (r) {
                    var hls = new Hls();
                    hls.loadSource(videoUrl);
                    hls.on(Hls.Events.MANIFEST_PARSED, function () {
                        var video = createVideoElement('');
                        hls.attachMedia(video);
                        video.play();
                        // TODO(vtxf): 这是一个坑，需要处理，如何判断video准备好了？
                        setTimeout(function () {
                            _this._videoElement = video;
                        }, 1000);
                    });

                    _this._hls = hls;
                })).subscribe();
            }
        };

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this.videoUrl;
        }, function () {
            // this._videoElement && destroyVideoElement(this._videoElement);
            // this.videoUrl && (this._videoElement = createVideoElement(this.videoUrl));
            refreshSettingVideoElement(_this.videoUrl);
        }, {
            fireImmediately: true
        }));

        _this._disposers.push((0, _mobx.autorun)(function () {
            if (!_this._cameraVideo) {
                if (!_this._videoElement) {
                    return;
                }

                // 准备inverseViewMatrix是为了定义视频拍摄的相机的姿态(位置和方向)
                // 此处设定为当前相机的欧拉角(heading\pitch\roll)和位置信息
                var inverseViewMatrix = hpr2m({
                    position: Cesium.Cartesian3.fromRadians(_this.position[0], _this.position[1], _this.position[2]),
                    heading: _this.rotation[0],
                    pitch: _this.rotation[1],
                    roll: _this.rotation[2]
                });

                var aspectRatio = Math.tan(_this.fovH * 0.5) / Math.tan(_this.fovV * 0.5);
                var fov = _this.fovH > _this.fovV ? _this.fovH : _this.fovV;

                // frustum是为了定义投影体的形状
                // frustum选填，可以直接置为undefined
                var frustum = new Cesium.PerspectiveFrustum({
                    fov: fov,
                    aspectRatio: aspectRatio,
                    near: _this.near,
                    far: _this.far
                });

                var cameraVideo = new Cesium.XbsjCameraVideo({
                    inverseViewMatrix: inverseViewMatrix,
                    frustum: frustum,
                    videoElement: _this._videoElement,
                    showHelperPrimitive: _this.showHelper
                });
                _this._earth.czm.scene.primitives.add(cameraVideo);
                _this._cameraVideo = cameraVideo;
                _this._cameraVideo.show = _this.show;
            } else {
                hpr2m({
                    position: Cesium.Cartesian3.fromRadians(_this.position[0], _this.position[1], _this.position[2]),
                    heading: _this.rotation[0],
                    pitch: _this.rotation[1],
                    roll: _this.rotation[2]
                }, _this._cameraVideo.inverseViewMatrix);

                var _aspectRatio = Math.tan(_this.fovH * 0.5) / Math.tan(_this.fovV * 0.5);
                var _fov = _this.fovH > _this.fovV ? _this.fovH : _this.fovV;

                _this._cameraVideo.frustum.fov = _fov;
                _this._cameraVideo.frustum.aspectRatio = _aspectRatio;
                _this._cameraVideo.frustum.near = _this.near;
                _this._cameraVideo.frustum.far = _this.far;

                _this._cameraVideo.videoElement = _this._videoElement;

                _this._cameraVideo.showHelperPrimitive = _this.showHelper;
                _this._cameraVideo.show = _this.show;
            }
        }));

        _this._disposers.push((0, _mobx.autorun)(function () {
            _this.twoPostionsEditing = _this._earth.interaction.directionCameraBinding.target === _this;
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this.twoPostionsEditing;
        }, function () {
            if (!_this.twoPostionsEditing && _this._earth.interaction.directionCameraBinding.target === _this) {
                _this._earth.interaction.directionCameraBinding.target = undefined;
            } else if (_this.twoPostionsEditing) {
                _this._earth.interaction.directionCameraBinding.target = _this;
            }
        }, {
            fireImmediately: true
        }));

        // 检测位置编辑状态 // positionEditing
        _this._disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this));
        // 旋转状态
        _this._disposers.push((0, _registerInteractionProperty.registerRotationEditing)(_this._earth, _this));
        return _this;
    }

    (0, _createClass3.default)(CameraVideo, [{
        key: 'setFovAndAspectRatioForCesium',

        /**
         * 采用Cesium方式设置fov角度和aspectRatio比例
         * @param {number} fov 
         * @param {number} aspectRatio 
         */
        value: function setFovAndAspectRatioForCesium(fov, aspectRatio) {
            if (aspectRatio > 1.0) {
                this.fovH = fov;
                this.fovV = 2.0 * Math.atan(Math.tan(fovH * 0.5) / aspectRatio);
            } else {
                this.fovV = fov;
                this.fovH = 2.0 * Math.atan(aspectRatio * Math.tan(fovV * 0.5));
            }
        }

        /**
         * 采用计算机图形学原生方式设置fov角度和aspectRatio比例
         * @param {number} fov 
         * @param {number} aspectRatio 
         */

    }, {
        key: 'setFovAndAspectRatioForWebGL',
        value: function setFovAndAspectRatioForWebGL(fov, aspectRatio) {
            this.fovV = fov;
            this.fovH = 2.0 * Math.atan(aspectRatio * Math.tan(fovV * 0.5));
        }

        /**
         * Cesium模式下的fov角度
         * @type {number}
         */

    }, {
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyTo({
                destination: Cesium.Cartesian3.fromRadians(this.position[0], this.position[1], this.position[2]),
                orientation: {
                    heading: this.rotation[0],
                    pitch: this.rotation[1],
                    roll: this.rotation[2]
                }
            });
        }

        /**
         * 以当前相机的位置姿态来设置视频融合的位置姿态。
         */

    }, {
        key: 'setPositionWithCurrentCamera',
        value: function setPositionWithCurrentCamera() {
            var camera = this._earth.czm.scene.camera;
            var carto = camera.positionCartographic;

            this.position = [carto.longitude, carto.latitude, carto.height];
            this.rotation = [camera.heading, camera.pitch, camera.roll];
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers && this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this._videoElement = this._videoElement && destroyVideoElement(this._videoElement);
            if (this._cameraVideo) {
                this._earth.czm.scene.primitives.remove(this._cameraVideo);
                this._cameraVideo = undefined;
            }
            return (0, _get3.default)(CameraVideo.prototype.__proto__ || (0, _getPrototypeOf2.default)(CameraVideo.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'isCameraLike',
        get: function get() {
            return true;
        }

        /**
         * 视频融合使用的用来播放视频的DOM元素
         * @type {DOMElement}
         */

    }, {
        key: 'videoElement',
        get: function get() {
            return this._videoElement;
        }
    }, {
        key: 'fov',
        get: function get() {
            return this.fovH > this.fovV ? this.fovH : this.fovV;
        }

        /**
         * aspectRatio
         * @type {number}
         */

    }, {
        key: 'aspectRatio',
        get: function get() {
            return Math.tan(this.fovH * 0.5) / Math.tan(this.fovV * 0.5);
        }
    }]);
    return CameraVideo;
}(_XbsjCzmObj3.default);

CameraVideo.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(CameraVideo, 'CameraVideo');

exports.default = CameraVideo;

/***/ }),
/* 311 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _registerInteractionProperty = __webpack_require__(15);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    /**
     * 位置数组 [经度、纬度、高度]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Viewshed
     */
    position: [0, 0, 0],
    /**
     * 姿态数组 [偏航角、俯仰角、翻转角]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Viewshed
     */
    rotation: [0, 0, 0],
    // fov: 30.0 / 180.0 * Math.PI,
    // aspectRatio: 1.0,
    /**
     * 水平广角（单位弧度）
     * @type {number}
     * @instance
     * @default Math.PI / 3
     * @memberof Obj.Viewshed
     */
    fovH: Math.PI / 3,
    /**
     * 垂直广角（单位弧度）
     * @type {number}
     * @instance
     * @default Math.PI / 6
     * @memberof Obj.Viewshed
     */
    fovV: Math.PI / 6,
    /**
     * 近裁
     * @type {number}
     * @instance
     * @default 5.0
     * @memberof Obj.Viewshed
     */
    near: 5.0,
    /**
     * 远裁
     * @type {number}
     * @instance
     * @default 200.0
     * @memberof Obj.Viewshed
     */
    far: 200.0,
    /**
     * 是否在三维窗口中显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Viewshed
     */
    show: true
};

/**
 * 视域分析类
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Viewshed = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Viewshed, _XbsjCzmObj);

    function Viewshed(earth, guid) {
        (0, _classCallCheck3.default)(this, Viewshed);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Viewshed.__proto__ || (0, _getPrototypeOf2.default)(Viewshed)).call(this, earth, guid));

        (0, _mobx.extendObservable)(_this, {
            twoPostionsEditing: false
        });

        // _viewshed只能内部使用，外部不要改值
        _this._viewshed = new Cesium.XbsjViewshed(earth.czm.scene);

        _this._earth.czm.scene.primitives.add(_this._viewshed);

        _this._disposers = _this._disposers || [];
        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._viewshed.position = Cesium.Cartesian3.fromRadians(_this.position[0], _this.position[1], _this.position[2]);
            _this._viewshed.heading = _this.rotation[0];
            _this._viewshed.pitch = _this.rotation[1];
            _this._viewshed.roll = _this.rotation[2];
            _this._viewshed.fovH = _this.fovH;
            _this._viewshed.fovV = _this.fovV;
            _this._viewshed.near = _this.near;
            _this._viewshed.far = _this.far;
            _this._viewshed.enabled = _this.show;
        }));

        _this._disposers.push((0, _mobx.autorun)(function () {
            _this.twoPostionsEditing = _this._earth.interaction.directionCameraBinding.target === _this;
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this.twoPostionsEditing;
        }, function () {
            if (!_this.twoPostionsEditing && _this._earth.interaction.directionCameraBinding.target === _this) {
                _this._earth.interaction.directionCameraBinding.target = undefined;
            } else if (_this.twoPostionsEditing) {
                _this._earth.interaction.directionCameraBinding.target = _this;
            }
        }, {
            fireImmediately: true
        }));

        // 检测位置编辑状态 // positionEditing
        _this._disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this));
        _this._disposers.push((0, _registerInteractionProperty.registerRotationEditing)(_this._earth, _this));
        return _this;
    }

    (0, _createClass3.default)(Viewshed, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyTo({
                destination: Cesium.Cartesian3.fromRadians(this.position[0], this.position[1], this.position[2]),
                orientation: {
                    heading: this.rotation[0],
                    pitch: this.rotation[1],
                    roll: this.rotation[2]
                }
            });
        }

        /**
         * 以当前相机姿态充值视域体
         */

    }, {
        key: 'setPositionWithCurrentCamera',
        value: function setPositionWithCurrentCamera() {
            var _this2 = this;

            var camera = this._earth.czm.scene.camera;
            var carto = camera.positionCartographic;

            (0, _mobx.runInAction)(function () {
                _this2.position = [carto.longitude, carto.latitude, carto.height];
                _this2.rotation = [camera.heading, camera.pitch, camera.roll];
            });
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this._earth.czm.scene.primitives.remove(this._viewshed);
            this._viewshed = undefined;
            return (0, _get3.default)(Viewshed.prototype.__proto__ || (0, _getPrototypeOf2.default)(Viewshed.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'isCameraLike',
        get: function get() {
            return true;
        }
    }]);
    return Viewshed;
}(_XbsjCzmObj3.default);

Viewshed.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(Viewshed, 'Viewshed');

exports.default = Viewshed;

/***/ }),
/* 312 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _utils = __webpack_require__(80);

var _utils2 = _interopRequireDefault(_utils);

var _interpolate = __webpack_require__(161);

var _CameraHelper = __webpack_require__(162);

var _CameraHelper2 = _interopRequireDefault(_CameraHelper);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var flyCartesian = void 0;

var _updateCurrentPositionAndRotation_anotherPos = void 0;
function computeRotationAlongThePath(d, currentPos, ds, length, positions, currentRotation) {
    _updateCurrentPositionAndRotation_anotherPos = _updateCurrentPositionAndRotation_anotherPos || [0, 0, 0];
    var anotherPos = _updateCurrentPositionAndRotation_anotherPos;
    var firstPos = void 0;
    var nextPos = void 0;
    var nextD = d + 0.01;
    if (nextD > length) {
        nextD = d - 0.01;
        if (nextD >= 0) {
            (0, _interpolate.interpolatePosition)(nextD, ds, positions, anotherPos);
            firstPos = anotherPos;
            nextPos = currentPos;
        }
    } else {
        (0, _interpolate.interpolatePosition)(nextD, ds, positions, anotherPos);
        firstPos = currentPos;
        nextPos = anotherPos;
    }

    if (firstPos && nextPos) {
        _utils2.default.Math.hpr(firstPos, nextPos, currentRotation);
        currentRotation[0] += Math.PI * 0.5;
    }

    return currentRotation;
}

/**
 * 路径
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Path = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Path, _XbsjCzmObj);

    function Path(earth, guid) {
        (0, _classCallCheck3.default)(this, Path);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Path.__proto__ || (0, _getPrototypeOf2.default)(Path)).call(this, earth, guid));

        _this._polyline = new _Polyline2.default(earth);
        _this.disposers.push(function () {
            return _this._polyline.destroy();
        });
        _this.disposers.push((0, _bind.track)(_this._polyline, 'positions', _this, 'positions'));
        _this.disposers.push((0, _bind.track)(_this._polyline, 'loop', _this, 'loop'));

        _this._polyline.show = _this.enabled && _this.show && _this.showHelper;
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.enabled && _this.show && _this.showHelper;
        }, function (show) {
            _this._polyline.show = show;
            _this._polyline.showHelper = show;
        }));

        /**
         * 是否处于创建状态<br/>
         * 设置为true以后，将进入重新创建的状态；此时可以使用鼠标左键在三维窗口中点击来创建路径的关键点，当点击鼠标右键，则表示创建完成。此时该属性会自动变成false。
         * @type {boolean}
         * @instance
         * @default false
         * @name creating
         * @memberof Obj.Path
         */
        _this.disposers.push((0, _registerInteractionProperty.registerPolylineCreating)(_this._earth, _this, {
            polylineCreatingProperty: 'creating'
        }));

        /**
         * 是否处于编辑状态<br/>
         * 设置为true以后，将进入重新创建的状态；此时可以使用鼠标左键在三维窗口中选取需要修改路径的关键点，当点击鼠标右键，则表示编辑完成。此时该属性会自动变成false。
         * @type {boolean}
         * @instance
         * @default false
         * @name editing
         * @memberof Obj.Path
         */
        _this.disposers.push((0, _registerInteractionProperty.registerPolylineEditing)(_this._earth, _this, {
            polylineEditingProperty: 'editing'
        }));

        _this._cameras = [];
        _this.disposers.push(function () {
            // this._cameras.forEach(e => destroyCamera(e, this._earth));
            _this._cameras.forEach(function (e) {
                return e.destroy();
            });
            _this._cameras.length = 0;
        });

        // 这是为了防止positions被换成新的数组，从而导致下面的observe失效！
        _this.disposers.push((0, _mobx.intercept)(_this, 'rotations', function (changed) {
            if (changed.type === 'update') {
                var _this$rotations;

                (_this$rotations = _this.rotations).splice.apply(_this$rotations, [0, _this.rotations.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
            }

            return null;
        }));

        _this.disposers.push((0, _mobx.intercept)(_this.rotations, function (changed) {
            if (changed.type === 'splice') {
                var _this$_cameras;

                for (var i = changed.index; i < changed.index + changed.removedCount; ++i) {
                    // destroyCamera(this._cameras[i], this._earth);
                    _this._cameras[i].destroy();
                }
                var cameras = changed.added.map(function () {
                    // const camera = createCamera(this._earth);
                    // return camera;
                    return new _CameraHelper2.default(_this._earth);
                });
                (_this$_cameras = _this._cameras).splice.apply(_this$_cameras, [changed.index, changed.removedCount].concat((0, _toConsumableArray3.default)(cameras)));
            }

            return changed;
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                }))),
                rotations: [].concat((0, _toConsumableArray3.default)(_this.rotations.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                }))),
                show: _this.enabled && _this.show && _this.showDirection
            };
        }, function () {
            // 中间状态positions增加了，rotations还没增加上
            if (_this.positions.length !== _this.rotations.length) {
                return;
            }
            for (var i = 0; i < _this.positions.length; ++i) {
                var rotation = _this.rotations[i];
                var position = _this.positions[i];
                _this._cameras[i].position = position;
                _this._cameras[i].rotation = rotation;
            }

            var show = _this.enabled && _this.show && _this.showDirection;
            _this._cameras.forEach(function (camera) {
                return camera.show = show;
            });
        }));

        _this._curve = new _Polyline2.default(earth);
        _this._curve.arcType = 'NONE';
        _this._curve.show = _this.enabled && _this.show;
        _this.disposers.push(function () {
            return _this._curve = _this._curve && _this._curve.destroy();
        });
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.enabled && _this.show;
        }, function (show) {
            _this._curve.show = show;
        }));

        (0, _mobx.extendObservable)(_this, {
            /**
             * 当前步进距离<br/>
             * 指当前播放状态下由第一个关键点沿路径运动到当前位置的长度，单位是米。<br/>
             * 当前playing属性为false时，此属性恒定不变；当playing为true，此属性会自动增加。
             * 随着currentD的变化，会实时计算currentPosition、currentRotation这两个属性。
             * currentPosition指当前位置，currentRotation指当前姿态
             * @type {number}
             * @instance
             * @default 0
             * @memberof Obj.Path
             */
            currentD: 0,
            /**
             * 当前相机是否可见<br/>
             * 当前相机指位于currentPosition处的一个相机。<br/>
             * 此属性，主要用来显示当前播放的位置，方便调试。<br/>
             * 注意：当设置cameraAttached为true时，务必手动将此属性设置为false。否则相机绑定以后，会发现前方有一个物体遮挡整个画面！
             * @type {boolean}
             * @instance
             * @default false
             * @memberof Obj.Path
             */
            currentShow: false,
            /**
             * 当前播放速度，单位为米/秒。<br/>
             * 注意，此属性可以实时修改，修改后的速度立即生效，所以可以动态修改路径上物体的前进速度！
             * @type {number}
             * @instance
             * @default 50.0,
             * @memberof Obj.Path
             */
            // currentSpeed: 50.0,
            /**
             * 是否循环播放<br/>
             * 如果为false，则playing设置为true时，会从当前位置播放到最后一个关键点，并停止播放，此时playing属性会自动变成false。
             * 若此属性为true时，播放到最后一个关键点以后，将自动重第一个关键点继续播放。
             * @type {boolean}
             * @instance
             * @default false,
             * @memberof Obj.Path
             */
            // loopPlay: false,
            _currentPosition: [0, 0, 0],
            _currentRotation: [0, 0, 0],
            /**
             * 当前相机位置，形式如：[0, 0, 0]<br/>
             * 该数组中的元素分别表示经度（单位弧度）、纬度（单位弧度）、高度（单位米）。
             * 注意该属性，为只读属性！
             * @type {number[]}
             * @instance
             * @readonly
             * @memberof Obj.Path
             */
            get currentPosition() {
                return this._currentPosition;
            },
            /**
             * 当前相机姿态，形式如：[0, 0, 0]<br/>
             * 该数组中的元素分别表示偏航角（单位弧度）、俯仰角（单位弧度）、翻转角（单位弧度）。
             * 注意该属性，为只读属性！
             * @type {number[]}
             * @instance
             * @readonly
             * @memberof Obj.Path
             */
            get currentRotation() {
                return this._currentRotation;
            }
        }, {
            currentPosition: _mobx.computed,
            currentRotation: _mobx.computed
        });
        // this.fromJsonFilterKeys.push('currentD', 'currentShow', 'currentSpeed');
        _this.fromJsonFilterKeys.push('currentD', 'currentShow');

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                }))),
                slices: _this.slices,
                loop: _this.loop
            };
        }, function () {
            var l = _this.positions.length;
            if (l < 3) {
                return;
            }
            (0, _interpolate.interpolatePositions)(_this.positions, _this.slices, _this.loop, _this._curve.positions);
        }));

        (0, _mobx.extendObservable)(_this, {
            _loopPositions: [],
            _loopRotations: [],
            _ds: [],
            get ds() {
                return this._ds;
            },
            /**
             * 当前路径的总长<br/>
             * 注意当loop设置true和false时，即使关键点没有变化，但是总长是会变化的。<br/>
             * 因为loop为true时，首末关键点会相连，这一段距离也会考虑到路径总长中。
             * @type {number[]}
             * @instance
             * @readonly
             * @memberof Obj.Path
             */
            get length() {
                if (this.loop && this._ds.length > 2) {
                    return this._ds[this._ds.length - 2];
                } else {
                    var d = this._ds.length === 0 ? 0 : this._ds[this._ds.length - 1];
                    return d;
                }
            }
        }, {
            ds: _mobx.computed,
            length: _mobx.computed
        });

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                cameraAttached: _this.cameraAttached,
                loop: _this.loop,
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                }))),
                rotations: [].concat((0, _toConsumableArray3.default)(_this.rotations.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                })))
            };
        }, function () {
            _this._updateCurrentPositionAndRotation();
        }, {
            delay: 100
        }));

        _this.disposers.push((0, _mobx.observe)(_this, 'currentD', function () {
            _this._updateCurrentPositionAndRotation();
        }));

        // this._currentCamera = createCamera(this._earth);
        _this._currentCamera = new _CameraHelper2.default(_this._earth);
        _this._currentPoints = new _Points2.default(_this._earth);
        _this.disposers.push(function () {
            _this._currentCamera = _this._currentCamera && _this._currentCamera.destroy();
            _this._currentPoints = _this._currentPoints && _this._currentPoints.destroy();
        });
        _this._currentPoints.points.push({});

        var updateCurrentCameraPositionAndRotation = function updateCurrentCameraPositionAndRotation() {
            var currentShow = _this.enabled && _this.currentShow;
            _this._currentCamera.show = currentShow;
            _this._currentPoints.show = currentShow;

            if (!currentShow) {
                return;
            }

            _this._currentPoints.points[0].position = [].concat((0, _toConsumableArray3.default)(_this.currentPosition));
            _this._currentCamera.position = _this.currentPosition;
            _this._currentCamera.rotation = _this.currentRotation;
        };

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                show: _this.enabled && _this.currentShow,
                position: [].concat((0, _toConsumableArray3.default)(_this.currentPosition)),
                rotation: [].concat((0, _toConsumableArray3.default)(_this.currentRotation))
            };
        }, updateCurrentCameraPositionAndRotation));

        (0, _mobx.extendObservable)(_this, {
            _target: [0, 0, 0],
            _targetEnabled: false
        });

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                _targetEnabled: _this._targetEnabled,
                _target: _this._target && [].concat((0, _toConsumableArray3.default)(_this._target)) || undefined
            };
        }, function () {
            _this._targetEnabled && _this.targetTo(_this._target);
        }));

        /**
         * 是否处于指定所有关键点相机的目标的状态<br/>
         * 设置为true以后，所有关键点相机都会同时旋转，指向目标点。鼠标左键点击以后，该属性会自动变为false。
         * 注意：关键点相机状态需要开启showDirection属性以后，才能方便观察！
         * @type {boolean}
         * @instance
         * @default false
         * @name targetPicking
         * @memberof Obj.Path
         */
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'targetPicking',
            positionProperty: '_target'
        }));

        _this.disposers.push((0, _mobx.intercept)(_this, 'targetPicking', function (changed) {
            _this._targetEnabled = changed.newValue;
            return changed;
        }));

        /**
         * 是否处于播放状态<br/>
         * 如果属性值为true，则所有'current'开头的相关属性会动态发生变化。
         * 可以通过手动设置为false，来结束播放状态。
         * 当loopPlay属性为false时，playing属性会在路径播放到最后一个关键点的位置时，自动变为false。
         * @type {boolean}
         * @instance
         * @default false
         * @name playing
         * @memberof Obj.Path
         */
        (0, _mobx.extendObservable)(_this, {
            _pathPlayingListener: undefined,
            get playing() {
                return !!this._pathPlayingListener;
            },
            set playing(val) {
                if (!!val && !this._pathPlayingListener) {
                    this._play();
                } else if (!val && this._pathPlayingListener) {
                    this._pathPlayingListener = this._pathPlayingListener && this._pathPlayingListener();
                }
            }
        }, {
            _pathPlayingListener: _mobx.observable.ref,
            playing: _mobx.computed
        });

        _this.disposers.push(function () {
            _this.playing = false;
        });

        //     /**
        //      * 是否处于相机绑定状态<br/>
        //      * 当该属性为true时，当前相机会实时使用currentPosition属性指定位置，实时使用currentRotation属性来指定姿态。
        //      * 注意：当鼠标左键在三维窗口中点击时，会自动打断相机绑定状态，该属性会自动变为false。
        //      * @type {boolean}
        //      * @instance
        //      * @default false
        //      * @name cameraAttached
        //      * @memberof Obj.Path
        //      */    
        //     extendObservable(this, {
        //         _currentFlight: undefined,        
        //         get cameraAttached() {
        //             return !!this._currentFlight;
        //         },
        //         set cameraAttached(val) {
        //             const scene = this._earth.czm.scene;

        //             if (!!val && !this._currentFlight) {
        //                 this._currentFlight = {
        //                     cancelTween: () => {
        //                         this._currentFlight = undefined;
        //                     }
        //                 };
        //                 scene.camera.cancelFlight();
        //                 scene.camera._currentFlight = this._currentFlight;
        //             } else if (!val && this._currentFlight) {
        //                 if (this._currentFlight !== scene.camera._currentFlight) {
        //                     throw new Error('this._currentCamera !== scene.camera._currentFlight');
        //                 }
        //                 scene.camera.cancelFlight();
        //                 this._currentFlight = undefined;
        //             }
        //         }
        //     }, {
        //         _currentFlight: observable.ref,
        //         cameraAttached: computed,
        //     });

        //     this.disposers.push(() => {
        //         this.cameraAttached = false;
        //     });

        // cameraAttached
        _this.disposers.push((0, _registerInteractionProperty.registerCameraTracking)(_this._earth, _this, {
            cameraAttachedFunc: function cameraAttachedFunc(tracking) {
                var _this2 = this;

                var disposers = [];
                disposers.push((0, _mobx.reaction)(function () {
                    return {
                        currentPosition: [].concat((0, _toConsumableArray3.default)(_this2.currentPosition)),
                        currentRotation: [].concat((0, _toConsumableArray3.default)(_this2.currentRotation)),
                        cameraAttachedOffsetPosition: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetPosition)),
                        cameraAttachedOffsetRotation: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetRotation)),
                        viewDistance: _this2.viewDistance
                    };
                }, function (prv) {
                    for (var i = 0; i < 3; ++i) {
                        tracking.position[i] = prv.currentPosition[i] + prv.cameraAttachedOffsetPosition[i];
                        tracking.rotation[i] = prv.currentRotation[i] + prv.cameraAttachedOffsetRotation[i];
                    }
                    tracking.viewDistance = prv.viewDistance;
                }));
                this._earth.camera.tracking.isCameraLike = true;
                return function () {
                    disposers.forEach(function (d) {
                        return d();
                    });
                    disposers.length = 0;
                };
            }
        }));
        return _this;
    }

    (0, _createClass3.default)(Path, [{
        key: '_updateCurrentPositionAndRotation',
        value: function _updateCurrentPositionAndRotation() {
            var d = this.currentD;
            this._ds = (0, _interpolate.computDs)(this.positions, this.rotations, this.loop, this._ds, this._loopPositions, this._loopRotations);
            var positions = this.loop ? this._loopPositions : this.positions;
            var rotations = this.loop ? this._loopRotations : this.rotations;
            (0, _interpolate.interpolatePosition)(d, this._ds, positions, this._currentPosition);

            if (!this.alwaysAlongThePath) {
                (0, _interpolate.interpolateRotation)(d, this._ds, rotations, this._currentRotation);
            } else {
                computeRotationAlongThePath(d, this._currentPosition, this._ds, this.length, positions, this._currentRotation);
            }

            // if (this.cameraAttached) {
            //     this.currentCameraApply();
            // }
        }

        /**
         * 同时给所有关键点增加高度
         * @param {number} height 高度，单位米 
         */

    }, {
        key: 'addHeight',
        value: function addHeight(height) {
            this.positions.forEach(function (e) {
                return e[2] += height;
            });
        }

        /**
         * 将所有关键点的方向指向target所在位置
         * @param {number[]} target 用来表示观察位置，包含三个元素的数组，分别表示经度、纬度、高度 
         * @param {number[]} includeIndex 索引数组，如果有值，则指只处理includeIndex有的索引，如果无值，则全部处理
         */

    }, {
        key: 'targetTo',
        value: function targetTo(target, includeIndex) {
            var _this3 = this;

            if (this.positions.length === this.rotations.length) {
                this.positions.forEach(function (e, i) {
                    if (!includeIndex || ~includeIndex.indexOf(i)) {
                        _utils2.default.Math.hpr(e, target, _this3.rotations[i]);
                        _this3.rotations[i][0] += Cesium.Math.PI_OVER_TWO;
                    }
                });
            }
        }

        /**
         * 自动延沿路径计算关键点的姿态<br/>
         * 注意：如果不设置参数，从修改所有关键点的姿态。<br/>
         * includeIndex是一个数组，囊括所有需要计算的关键点的索引。
         * @param {number[] | undefined} includeIndex 索引数组，如果有值，则指只处理includeIndex有的索引，如果无值，则全部处理
         */

    }, {
        key: 'directionAlongThePath',
        value: function directionAlongThePath(includeIndex) {
            // var l = this.positions.length;
            // for (let i=0; i<l-1; ++i) {
            //     if (!includeIndex || ~includeIndex.indexOf(i)) {
            //         Tool.Math.hpr(this.positions[i], this.positions[i+1], this.rotations[i]);
            //         this.rotations[i][0] += Cesium.Math.PI_OVER_TWO;     
            //     }
            // }

            // // 特殊处理最后一个索引
            // if (!includeIndex || !includeIndex.indexOf(l-1)) {
            //     if (this.loop) { // 如果是循环的话，求取和首点的方向
            //         Tool.Math.hpr(this.positions[l-1], this.positions[0], this.rotations[l-1]);
            //     } else {
            //         // 如果不是循环的，以最后两点连线的方向来定。
            //         Tool.Math.hpr(this.positions[l-2], this.positions[l-1], this.rotations[l-1]);
            //     }
            //     this.rotations[l-1][0] += Cesium.Math.PI_OVER_TWO;     
            //     computeRotationAlongThePath(this.ds[l-1], this.positions[l-1], this._ds, this.length, this.positions, this.rotations[l-1]);
            // }

            var l = this.positions.length;
            for (var i = 0; i < l; ++i) {
                if (!includeIndex || ~includeIndex.indexOf(i)) {
                    var ii = i + (this.loop ? 1 : 0);
                    var positions = this.loop ? this._loopPositions : this.positions;
                    computeRotationAlongThePath(this._ds[ii], positions[ii], this._ds, this.length, positions, this.rotations[i]);
                }
            }
        }

        /**
         * 根据索引值为first和last的关键点的姿态，对first和last之间的关键点自动进行插值处理。<br/>
         * 这样操作，可以做到自动进行相机姿态的平滑。<br/>
         * 如果参数不写，则自动根据首末关键点的姿态插值中间所有关键点的姿态。<br/>
         * 注意：first务必小于last
         * @param {number | undefined} first 第一个索引 
         * @param {number | undefined} last 最后一个索引
         */

    }, {
        key: 'directionLerpBetween',
        value: function directionLerpBetween() {
            var first = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 0;
            var last = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : -1;

            if (last === -1) {
                last = this.positions.length - 1;
            }

            if (last < first) {
                console.warn('directionLerpBetween 参数错误！');
                return;
            }

            this.directionLerpBetween_scratchDs = [];
            (0, _interpolate.computDs)(this.positions, this.rotations, false, this.directionLerpBetween_scratchDs);

            var ds = [this._ds[first], this._ds[last]];
            var rots = [this.rotations[first], this.rotations[last]];

            for (var i = first + 1; i < last; ++i) {
                (0, _interpolate.interpolateRotation)(this._ds[i], ds, rots, this.rotations[i]);
            }
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._polyline.flyTo();
        }
    }, {
        key: 'currentCameraApply',

        /**
         * 应用当前相机姿态<br/>
         * 将该路径的currentPosition和currentRotation设置为相机的position和rotation。
         */
        value: function currentCameraApply() {
            var _Cesium$Cartesian;

            flyCartesian = flyCartesian || new Cesium.Cartesian3();
            var scene = this._earth.czm.scene;

            (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(this.currentPosition).concat([undefined, flyCartesian]));
            var camera = scene.camera;
            camera.setView({
                destination: flyCartesian,
                orientation: {
                    heading: this.currentRotation[0],
                    pitch: this.currentRotation[1],
                    roll: this.currentRotation[2]
                }
            });
        }
    }, {
        key: '_play',
        value: function _play() {
            var _this4 = this;

            var scene = this._earth.czm.scene;

            // 如果位于末端，则从头开始
            if (this.currentSpeed > 0 && this.currentD === this.length) {
                this.currentD = 0;
            }

            // 如果倒速播放，则从尾开始
            if (this.currentSpeed < 0 && this.currentD === 0) {
                this.currentD = this.length;
            }

            var lastTime = Date.now();
            this._pathPlayingListener = scene.postUpdate.addEventListener(function (scene, time) {
                var currentTime = Date.now();
                var diffTime = currentTime - lastTime;
                lastTime = currentTime;

                if (_this4.currentSpeed > 0) {
                    // currentSpeed>0时，往前走
                    var currentD = _this4.currentD + diffTime * 0.001 * _this4.currentSpeed;
                    if (_this4.loopPlay) {
                        if (currentD > _this4.length) {
                            _this4.currentD = 0;
                        } else {
                            _this4.currentD = currentD;
                        }
                    } else {
                        if (currentD > _this4.length) {
                            _this4.currentD = _this4.length;
                            _this4._pathPlayingListener = _this4._pathPlayingListener && _this4._pathPlayingListener();
                        } else {
                            _this4.currentD = currentD;
                        }
                    }
                } else {
                    // 考虑一下currentSpeed<0时的走法
                    var _currentD = _this4.currentD + diffTime * 0.001 * _this4.currentSpeed;
                    if (_this4.loopPlay) {
                        // 如果循环播放的话
                        if (_currentD < 0) {
                            _this4.currentD = _this4.length;
                        } else {
                            _this4.currentD = _currentD;
                        }
                    } else {
                        if (_currentD < 0) {
                            // 播放到0就终止操作
                            _this4.currentD = 0;
                            _this4._pathPlayingListener = _this4._pathPlayingListener && _this4._pathPlayingListener();
                        } else {
                            _this4.currentD = _currentD;
                        }
                    }
                }
            });

            // scene.camera._currentFlight = {
            //     cancelTween: () => {
            //         updateCameraListener();
            //     }
            // }
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Path.prototype.__proto__ || (0, _getPrototypeOf2.default)(Path.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'isCameraLike',
        get: function get() {
            return true;
        }
    }]);
    return Path;
}(_XbsjCzmObj3.default);

Path.defaultOptions = {
    positions: [],
    rotations: [],
    show: true,
    showHelper: false,
    showDirection: false,
    loop: false,
    slices: 100,
    alwaysAlongThePath: false,
    cameraAttachedOffsetPosition: [0, 0, 0],
    cameraAttachedOffsetRotation: [0, 0, 0],
    viewDistance: 0,
    currentSpeed: 50.0,
    loopPlay: false
};

var xbsjSchema = {
    title: "Path Property",
    type: "object",
    properties: {
        /**
         * 显示路径
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Path
         */
        show: { type: "boolean", title: "显示路径", default: "true", description: '显示路径' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Path
         */
        showHelper: { type: "boolean", title: "辅助线框", default: "false", description: '辅助线框' },
        /**
         * 显示方向
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Path
         */
        showDirection: { type: "boolean", title: "显示方向", default: "true", description: '显示方向' },
        /**
         * 是否为环线
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Path
         */
        loop: { type: "boolean", title: "是否为环线", default: "false", description: '是否为环线' },
        /**
         * 曲线分段数
         * @type {number}
         * @instance
         * @default 100
         * @memberof Obj.Path
         */
        slices: { type: "number", title: "曲线分段数", default: "100", description: '曲线分段数' },
        /**
         * 始终沿着路径方向运动
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Path
         */
        alwaysAlongThePath: { type: "boolean", title: "始终沿着路径方向运动", default: "false", description: '始终沿着路径方向运动' },
        /**
         * 当前播放速度，单位为米/秒。<br/>
         * 注意，此属性可以实时修改，修改后的速度立即生效，所以可以动态修改路径上物体的前进速度！
         * @type {number}
         * @instance
         * @default 50.0,
         * @memberof Obj.Path
         */
        currentSpeed: { type: "number", title: "当前播放速度，单位为米", default: 50.0, description: '当前播放速度，单位为米' },
        /**
         * 是否循环播放<br/>
         * 如果为false，则playing设置为true时，会从当前位置播放到最后一个关键点，并停止播放，此时playing属性会自动变成false。
         * 若此属性为true时，播放到最后一个关键点以后，将自动重第一个关键点继续播放。
         * @type {boolean}
         * @instance
         * @default false,
         * @memberof Obj.Path
         */
        loopPlay: { type: "boolean", title: "是否循环播放", default: "false", description: '是否循环播放' }
    }
};

Path.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'showHelper', 'showDirection', 'loop', 'slices', 'alwaysAlongThePath']
}];

Path.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Path, 'Path');

exports.default = Path;

/***/ }),
/* 313 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _defineProperty2 = __webpack_require__(78);

var _defineProperty3 = _interopRequireDefault(_defineProperty2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjMutex = __webpack_require__(163);

var _XbsjMutex2 = _interopRequireDefault(_XbsjMutex);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _MakiIcon = __webpack_require__(314);

var _MakiIcon2 = _interopRequireDefault(_MakiIcon);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// var pinBuilder = new Cesium.XbsjPinBuilder();

// Sandcastle.addToolbarButton('创建POI', function () {
//     var bluePin = viewer.entities.add({
//         name : 'Blank blue pin',
//         position : Cesium.Cartesian3.fromDegrees(116.39, 39.9, 100),
//         billboard : {
//             // image : pinBuilder.fromColor(Cesium.Color.RED, 48, Cesium.Color.YELLOW).toDataURL(),
//             image : pinBuilder.fromMakiIconId('car', Cesium.Color.DARKGREEN, 96, Cesium.Color.WHITE),
//             verticalOrigin : Cesium.VerticalOrigin.BOTTOM
//         }
//     });
// });

var bcou = void 0;

/**
 * Pin用来展示一个兴趣点
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Pin = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Pin, _XbsjCzmObj);

    function Pin(earth, guid) {
        (0, _classCallCheck3.default)(this, Pin);

        // enabled和show关联的话，加入还有div等的看见与否，就没法通过enabled来控制了，所以还是分开好
        // 但是enabled以后，show虽然为true，但是仍然不可见。
        // this.disposers.push(bind(this, 'enabled', this, 'show'));

        var _this = (0, _possibleConstructorReturn3.default)(this, (Pin.__proto__ || (0, _getPrototypeOf2.default)(Pin)).call(this, earth, guid));

        _XbsjBase2.default.registerPosition(_this);

        // 此处的目的是为了解决Billboard导致拾取结果不准的问题
        // TODO(vtxf): 以后应该改成针对特定的collection,而不是把整个类都修改了！
        if (!bcou) {
            bcou = Cesium.BillboardCollection.prototype.update;
            Cesium.BillboardCollection.bcou = bcou;
            Cesium.BillboardCollection.prototype.update = function (frameState) {
                if (typeof Cesium.BillboardCollection.xbsjForceRSOpaqueDepthMask === 'undefined') {
                    Cesium.BillboardCollection.xbsjForceRSOpaqueDepthMask = false;
                }

                if (!this._rsOpaque || this._rsOpaque.depthMask !== Cesium.BillboardCollection.xbsjForceRSOpaqueDepthMask) {
                    this._rsOpaque = Cesium.RenderState.fromCache({
                        depthTest: {
                            enabled: true,
                            func: Cesium.WebGLConstants.LESS
                        },
                        depthMask: Cesium.BillboardCollection.xbsjForceRSOpaqueDepthMask
                    });
                }
                bcou.call(this, frameState);
            };
        }

        _XbsjBase2.default.registerProperty(_this, 'pinBuilder');
        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionEditingProperty: 'editing'
        }));
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerCameraTracking)(_this._earth, _this, {
            cameraAttachedFunc: function cameraAttachedFunc(tracking) {
                var _this2 = this;

                var disposers = [];

                disposers.push((0, _track2.default)(tracking, 'position', this, 'position'));
                // disposers.push(track(tracking, 'rotation', target, 'rotation'));
                tracking.rotation = [0, -Math.PI / 3, 0];
                disposers.push((0, _track2.default)(tracking, 'viewDistance', this, 'viewDistance'));
                this._earth.camera.tracking.isCameraLike = false;

                disposers.push((0, _mobx.reaction)(function () {
                    return {
                        position: [].concat((0, _toConsumableArray3.default)(_this2.position)),
                        cameraAttachedOffsetPosition: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetPosition)),
                        cameraAttachedOffsetRotation: [].concat((0, _toConsumableArray3.default)(_this2.cameraAttachedOffsetRotation)),
                        viewDistance: _this2.viewDistance
                    };
                }, function (prv) {
                    for (var i = 0; i < 3; ++i) {
                        tracking.position[i] = prv.position[i] + prv.cameraAttachedOffsetPosition[i];
                        tracking.rotation[i] = prv.cameraAttachedOffsetRotation[i];
                    }
                    tracking.viewDistance = prv.viewDistance;
                }));
                this._earth.camera.tracking.isCameraLike = false;

                return function () {
                    disposers.forEach(function (d) {
                        return d();
                    });
                    disposers.length = 0;
                };
            }
        }));

        _this._pinBuilder = _this._earth._pinBuilder;
        var viewer = _this._earth.czm.viewer;

        (0, _mobx.extendObservable)(_this, {
            _winPos: [0, 0, 0, 0], // [left, top, right, bottom]
            /**
             * pin的屏幕坐标，是一个数组，包含四个元素，分别表示[left, top, right, bottom]，注意是该属性是只读的。
             * @type {array}
             * @instance
             * @readonly
             * @default [0, 0, 0, 0]
             * @memberof Obj.Pin
             */
            get winPos() {
                return this._winPos;
            }
        }, {
            winPos: _mobx.computed
        });

        _this._cartesian = new Cesium.Cartesian3();
        _this._winCartesian = new Cesium.Cartesian2();

        var updateWinPos = function updateWinPos() {
            if (!_this.computingWinPos && !(_this.imageUrl && _this.isDivImage)) {
                return;
            }

            try {
                var _Cesium$Cartesian;

                var scene = _this._earth.czm.scene;
                var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this.position).concat([undefined, _this._cartesian]));
                if (cartesian) {
                    var winCart = scene.cartesianToCanvasCoordinates(cartesian, _this._winCartesian);
                    if (winCart) {
                        // 修复devicePixelRatio变化时，winPos对不上的问题
                        // this._winPos.splice(0, 2, winCart.x, scene.drawingBufferHeight - winCart.y);
                        var h = earth.czm.viewer.canvas.clientHeight;
                        var w = earth.czm.viewer.canvas.clientWidth;
                        _this._winPos.splice(0, 4, winCart.x, winCart.y, w - winCart.x, h - winCart.y);
                    }
                }
            } catch (error) {
                console.warn('Pin计算窗口坐标时有误');
            }
        };

        // this.position发生变化时，更新窗口坐标
        _this.disposers.push((0, _mobx.autorun)(function () {
            return updateWinPos();
        }));

        // 相机和窗口尺寸变化时，更新窗口坐标
        _this.disposers.push(function () {
            var earth = _this._earth;
            var mergeSource = rxjs.race(earth.eventSource.contextSizeChanged, earth.eventSource.cameraChanged);
            var subscription = mergeSource.subscribe(updateWinPos);
            return function () {
                subscription.unsubscribe();
            };
        }());

        _this._position = Cesium.Cartesian3.fromDegrees(0, 0, 0);
        _this._billboardEnt = viewer.entities.add({
            name: _this.name,
            position: _this._position,
            point: {
                pixelSize: 5.0,
                color: Cesium.Color.YELLOW,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 1.0
                // distanceDisplayCondition: distanceDisplayCondition,
                // translucencyByDistance: translucencyByDistance,
                // disableDepthTestDistance: Number.POSITIVE_INFINITY,
            },
            billboard: {
                // image : pinBuilder.fromColor(Cesium.Color.RED, 48, Cesium.Color.YELLOW).toDataURL(),
                // image : pinBuilder.fromMakiIconId('car', Cesium.Color.DARKGREEN, 96, Cesium.Color.WHITE),
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                horizontalOrigin: Cesium.HorizontalOrigin.CENTER,
                scale: 1.0
            },
            label: (0, _defineProperty3.default)({
                text: '',
                style: Cesium.LabelStyle.FILL_AND_OUTLINE,
                font: '48px 楷体',
                fillColor: Cesium.Color.WHITE,
                outlineColor: Cesium.Color.BLACK,
                outlineWidth: 6,
                scale: 0.5,
                disableDepthTestDistance: 1000000000,
                verticalOrigin: Cesium.VerticalOrigin.BOTTOM,
                horizontalOrigin: Cesium.HorizontalOrigin.LEFT,
                pixelOffset: new Cesium.Cartesian2(20, -25)
            }, 'verticalOrigin', Cesium.VerticalOrigin.BOTTOM),
            polyline: {
                show: false,
                positions: []
            }
        });
        _this.disposers.push(function () {
            viewer.entities.remove(_this._billboardEnt);
        });

        // 配置hovered和onClick属性
        {
            // this._billboardEnt.onclick = pickedObject => this.onclick && this.onclick(pickedObject);
            // const that = this;
            // Object.defineProperty(this._billboardEnt, '_hovered', {
            //     get() {
            //         return that._hovered;
            //     },
            //     set(newVal) {
            //         that._hovered = newVal;
            //     }
            // });
            _this._billboardEnt._xbsjOwner = _this;
        }

        _this.disposers.push(function () {
            _this._billboardEnt && viewer.entities.remove(_this._billboardEnt);
            _this._billboardEnt = undefined;
        });

        _this._fillColor = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this.pinBuilder.fillColor))))();
        _this._outlineColor = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this.pinBuilder.outlineColor))))();

        _this.disposers.push((0, _mobx.autorun)(function () {
            var _this$_fillColor, _this$_outlineColor;

            (_this$_fillColor = _this._fillColor).xbsjFromArray.apply(_this$_fillColor, (0, _toConsumableArray3.default)(_this.pinBuilder.fillColor));
            (_this$_outlineColor = _this._outlineColor).xbsjFromArray.apply(_this$_outlineColor, (0, _toConsumableArray3.default)(_this.pinBuilder.outlineColor));

            // isDivImage用来表示图像是否需要用div来显示，而不是作为三维程序中的一个图片。
            // if (this.imageUrl) {
            //     this._billboardEnt.billboard.image = this.imageUrl;
            // } else if (this.pinBuilder.makiIcon) {
            //     this._billboardEnt.billboard.image = this._pinBuilder.fromMakiIconId(this.pinBuilder.makiIcon, this._outlineColor, this.pinBuilder.size, this._fillColor);
            // } else if (this.pinBuilder.text) {
            //     this._billboardEnt.billboard.image = this._pinBuilder.fromText(this.pinBuilder.text, this._outlineColor, this.pinBuilder.size, this._fillColor);
            // } else {
            //     this._billboardEnt.billboard.image = this._pinBuilder.fromColor(this._outlineColor, this.pinBuilder.size, this._fillColor);
            // }
            if (_this.imageUrl && _this.isDivImage) {
                _this._billboardEnt.show = false;
            } else {
                if (_this.imageUrl && !_this.isDivImage) {
                    _this._billboardEnt.billboard.image = _this.imageUrl;
                } else if (_this.pinBuilder.makiIcon) {
                    _this._billboardEnt.billboard.image = _this._pinBuilder.fromMakiIconId(_this.pinBuilder.makiIcon, _this._outlineColor, _this.pinBuilder.size, _this._fillColor);
                } else if (_this.pinBuilder.text) {
                    _this._billboardEnt.billboard.image = _this._pinBuilder.fromText(_this.pinBuilder.text, _this._outlineColor, _this.pinBuilder.size, _this._fillColor);
                } else {
                    _this._billboardEnt.billboard.image = _this._pinBuilder.fromColor(_this._outlineColor, _this.pinBuilder.size, _this._fillColor);
                }

                _this._billboardEnt.label.outlineColor = _this._outlineColor;
                _this._billboardEnt.label.fillColor = _this._fillColor;

                _this._billboardEnt.polyline.material = _this._outlineColor;
            }
        }));

        (0, _mobx.extendObservable)(_this, {
            _innerShow: false
        });

        var updateInnerShow = function updateInnerShow() {
            var d = _this.position.xepd(_this._earth.camera.position);
            if (d > _this.near && d < _this.far) {
                _this._innerShow = true;
            } else {
                _this._innerShow = false;
            }
        };

        updateInnerShow();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                cameraPos: [].concat((0, _toConsumableArray3.default)(_this._earth.camera.position)),
                pos: [].concat((0, _toConsumableArray3.default)(_this.position)),
                near: _this.near,
                far: _this.far
            };
        }, updateInnerShow));

        var updateDivStyle = function updateDivStyle() {
            if (_this.imageUrl && _this.isDivImage) {
                if (!_this._divImage) {
                    var divImage = document.createElement('img');

                    _this.earth.czm.viewer.container.appendChild(divImage);
                    _this._divImage = divImage;

                    _this.disposers.push(function () {
                        _this.earth.czm.viewer.container.removeChild(_this._divImage);
                        _this._divImage = undefined;
                    });
                }

                // this._divImage.src赋值以后会自动改变字符串，所以没法用src来判断是否变化，只能重新设置一个变量_currentImageUrl
                if (!_this._currentImageUrl || _this._currentImageUrl !== _this.imageUrl) {
                    _this._divImage.src = _this.imageUrl;
                    _this._currentImageUrl = _this.imageUrl;
                    _this._divImage.style.position = 'absolute';
                    _this._divImage.style.left = '0px';
                    _this._divImage.style.bottom = '0px';
                    _this._divImage.style.pointerEvents = 'none';
                    _this._divImage.style.display = 'none'; // 暂时隐藏

                    _this._divImage.onload = function () {
                        console.log('divImage onload, width: ', _this._divImage.naturalWidth);
                        updateDivStyle();
                    };
                }
            }

            var divShow = !!_this.imageUrl && _this.isDivImage && _this._divImage && _this.enabled && _this.show && _this._innerShow;
            if (_this._divImage) {
                var _divImage = _this._divImage;
                _divImage.style.display = divShow ? 'block' : 'none';
                _divImage.style.width !== _this.scale * _divImage.naturalWidth + 'px' && (_divImage.style.width = _this.scale * _divImage.naturalWidth + 'px');
                _divImage.style.height !== _this.scale * _divImage.naturalHeight + 'px' && (_divImage.style.height = _this.scale * _divImage.naturalHeight + 'px');
                _divImage.style.left !== _this.winPos[0] + 'px' && (_divImage.style.left = _this.winPos[0] - _this.origin[0] * _divImage.naturalWidth * _this.scale + 'px');
                _divImage.style.bottom !== _this.winPos[3] + 'px' && (_divImage.style.bottom = _this.winPos[3] - _this.origin[1] * _divImage.naturalHeight * _this.scale + 'px');
            }

            var billboardShow = _this.enabled && _this.show && !_this.isDivImage;
            _this._billboardEnt.show = billboardShow;
        };

        updateDivStyle();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                enabled: _this.enabled,
                show: _this.show,
                isDivImage: _this.isDivImage,
                _innerShow: _this._innerShow,
                imageUrl: _this.imageUrl,
                origin: [].concat((0, _toConsumableArray3.default)(_this.origin)),
                winPos: [].concat((0, _toConsumableArray3.default)(_this.winPos))
            };
        }, updateDivStyle));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._billboardEnt.label.text = _this.pinBuilder.extText;
            _this._billboardEnt.label.font = _this.pinBuilder.extTextFont;
            _this._billboardEnt.label.pixelOffset = new Cesium.Cartesian2(_this.pinBuilder.extTextPixelOffset[0], _this.pinBuilder.extTextPixelOffset[1]);
        }));

        (0, _mobx.extendObservable)(_this, {
            _innerScale: 1.0
        });

        _this.disposers.push((0, _mobx.autorun)(function () {
            var _Cesium$Cartesian2;

            _this._billboardEnt.name = _this.name;
            _this._position = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(_this.position).concat([undefined, _this._position]));
            _this._billboardEnt.position = _this._position;
            var scale = _this.scale * _this._innerScale;
            _this._billboardEnt.billboard.scale = scale;
        }));

        var updateOrigin = function updateOrigin() {
            var h = [Cesium.HorizontalOrigin.LEFT, Cesium.HorizontalOrigin.CENTER, Cesium.HorizontalOrigin.RIGHT];
            var v = [Cesium.VerticalOrigin.BOTTOM, Cesium.VerticalOrigin.CENTER, Cesium.VerticalOrigin.TOP];
            _this._billboardEnt.billboard.horizontalOrigin = h[_this.origin[0] * 2.0 | 0];
            _this._billboardEnt.billboard.verticalOrigin = v[_this.origin[1] * 2.0 | 0];
        };
        updateOrigin();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this.origin));
        }, updateOrigin));

        _this._distanceDisplayCondition = new Cesium.DistanceDisplayCondition(_this.near, _this.far);
        _this.disposers.push((0, _mobx.autorun)(function () {
            if (_this.near < _this.far) {
                // near必须小于far，否则会导致三维停止响应
                _this._distanceDisplayCondition.near = _this.near;
                _this._distanceDisplayCondition.far = _this.far;
                _this._billboardEnt.billboard.distanceDisplayCondition = _this._distanceDisplayCondition;
                _this._billboardEnt.point.distanceDisplayCondition = _this._distanceDisplayCondition;
                _this._billboardEnt.label.distanceDisplayCondition = _this._distanceDisplayCondition;
            }
            var disableDepthTestDistance = _this.disableDepthTestDistance > 10000000 ? 10000000 : _this.disableDepthTestDistance;
            _this._billboardEnt.billboard.disableDepthTestDistance = disableDepthTestDistance;
            _this._billboardEnt.point.disableDepthTestDistance = disableDepthTestDistance;
            _this._billboardEnt.label.disableDepthTestDistance = disableDepthTestDistance;
        }));

        // this.disposers.push(autorun(() => {        
        //     this._billboardEnt.show = this.enabled && this.show;
        // }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._billboardEnt.point.show = _this.enabled && _this.show && _this.pointShow;
        }));

        var updateScratchCartesian1 = new Cesium.Cartesian3();
        var updateScratchCartesian2 = new Cesium.Cartesian3();
        var updateLine = function updateLine() {
            _this._billboardEnt.polyline.show = _this.enabled && _this.show && _this.lineShow;
            var p1 = Cesium.Cartesian3.fromRadians(_this.position[0], _this.position[1], _this.position[2], undefined, updateScratchCartesian1);
            var p2 = Cesium.Cartesian3.fromRadians(_this.position[0], _this.position[1], _this.position[2] - _this.lineHeight, undefined, updateScratchCartesian2);
            _this._billboardEnt.polyline.positions = [p1, p2];
        };
        updateLine();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                lineShow: _this.lineShow,
                lineHieght: _this.lineHeight
            };
        }, updateLine));

        {
            _this._mutex = new _XbsjMutex2.default();
            _this.disposers.push(function () {
                return _this._mutex = _this._mutex && _this._mutex.destroy();
            });

            var isStringValid = _XbsjMutex2.default.isStringValid;
            var setStringEmpty = _XbsjMutex2.default.setStringEmpty;

            var mutexCollection = [_XbsjMutex2.default.createObj([_this, 'imageUrl', isStringValid, setStringEmpty]), _XbsjMutex2.default.createObj([_this.pinBuilder, 'text', isStringValid, setStringEmpty]), _XbsjMutex2.default.createObj([_this.pinBuilder, 'makiIcon', isStringValid, setStringEmpty])];
            _this._mutex.mutexCollection = mutexCollection;
        }

        _this.disposers.push(_XbsjBase2.default.registerPathAttachedGuid(_this));
        return _this;
    }

    (0, _createClass3.default)(Pin, [{
        key: 'onmouseover',
        value: function onmouseover() {
            this._innerScale = 1.1;
        }
    }, {
        key: 'onmouseout',
        value: function onmouseout() {
            this._innerScale = 1.0;
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.camera.flyTo(this.position, this.viewDistance, [0, -Math.PI / 3, 0]);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Pin.prototype.__proto__ || (0, _getPrototypeOf2.default)(Pin.prototype), 'destroy', this).call(this);
        }
    }]);
    return Pin;
}(_XbsjCzmObj3.default);

Pin.defaultOptions = {
    position: [0, 0, 0],
    // viewDistance: 100.0,
    scale: 1.0,
    imageUrl: '',
    isDivImage: false,
    origin: [0.5, 0], // 目前只能设置为0.0，0.5，1.0
    pinBuilder: {
        text: '',
        extText: '',
        extTextFont: '48px 楷体',
        extTextPixelOffset: [30, -20],
        makiIcon: '',
        size: 48,
        fillColor: [1, 1, 1, 1],
        outlineColor: [0, 0.5, 0, 1]
    },
    near: 0,
    far: Number.MAX_VALUE,
    disableDepthTestDistance: Number.MAX_VALUE, // POSITIVE_INFINITY转化为json时，会变成null！
    show: true,
    attachedPathGuid: '',

    pointShow: false,
    lineShow: false,
    lineHeight: 0, // 向下衍生长度(单位米)

    computingWinPos: true, // 是否实时计算窗口坐标

    cameraAttachedOffsetPosition: [0, 0, 0],
    cameraAttachedOffsetRotation: [0, -Math.PI / 3, 0],
    viewDistance: 100.0
};

Pin.MakiIcon = _MakiIcon2.default;

/**
 * Pin构建器
 * @memberof Obj.Pin
 * @class
 * @name PinBuilder
 */

var xbsjSchema = {
    title: "Pin Property",
    type: "object",
    properties: {
        /**
         * 显示路径
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Pin
         */
        show: { type: "boolean", title: "显示路径", default: true, description: '显示路径' },
        /**
         * @description 原点
         * @type {array}
         * @instance
         * @default [0.5, 0]
         * @memberof Obj.Pin
         */
        origin: { type: "array", title: "原点", default: [0.5, 0], description: '原点' },
        /**
         * @description 位置数组 [经度、纬度、高度]
         * @type {array}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.Pin
         */
        position: { type: "array", title: "位置数组", default: [0, 0, 0], description: '位置数组' },
        /**
         * 视点距离，当相机飞入时的停止距离
         * @type number
         * @instance
         * @default 100
         * @memberof Obj.Pin
         */
        viewDistance: { type: "number", title: "显示路径", default: 100.0, description: '显示路径' },
        /**
         * 缩放比例
         * @type number
         * @instance
         * @default 1.0
         * @memberof Obj.Pin
         */
        scale: { type: "number", title: "缩放比例", default: 1.0, description: '缩放比例' },
        /**
         * 图像路径
         * @type string
         * @instance
         * @default ''
         * @memberof Obj.Pin
         */
        imageUrl: { type: "string", title: "图像路径", default: '', description: '图像路径' },
        /**
         * image是否用div绘制
         * @type boolean
         * @instance
         * @default false
         * @memberof Obj.Pin
         */
        isDivImage: { type: "boolean", title: "image是否用div绘制", default: 'false', description: 'image是否用div绘制' },
        /**
         * pin构建器
         * @type {Obj.Pin.PinBuilder}
         * @instance
         * @memberof Obj.Pin
         */
        pinBuilder: {
            title: "pinBuilder属性",
            type: "object",
            properties: {
                /**
                 * 文本，写在Pin中的文本
                 * @type string
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                text: { type: "string", title: "文本", default: '', description: '文本' },
                /**
                 * 附带文本，附带在Pin右边的文本
                 * @type string
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                extText: { type: "string", title: "附带文本", default: '', description: '附带文本' },
                /**
                 * 附带文本字体样式
                 * @type string
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                extTextFont: { type: "string", title: "附带文本字体样式", default: '', description: '附带文本字体样式' },
                /**
                 * 附带文本的像素偏移
                 * @type array
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                extTextPixelOffset: { type: "array", title: "像素偏移", default: [0, 0], description: '像素偏移' },
                /**
                 * 图像字符
                 * @type string
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                makiIcon: { type: "string", title: "图像字符", default: '', description: '图像字符' },
                /**
                 * 尺寸
                 * @type number
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                size: { type: "number", title: "尺寸", default: 48, description: '尺寸' },
                /**
                 * 填充颜色
                 * @type array
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                fillColor: { type: "array", title: "填充颜色", default: [1, 1, 1, 1], description: '填充颜色' },
                /**
                 * 轮廓颜色
                 * @type object
                 * @instance
                 * @memberof Obj.Pin.PinBuilder
                 */
                outlineColor: { type: "array", title: "轮廓颜色", default: [0, 0.5, 0, 1], description: '轮廓颜色' }
            }
        },
        /**
         * 点是否可见
         * @type boolean
         * @instance
         * @default false
         * @memberof Obj.Pin
         */
        pointShow: { type: "boolean", title: "点是否可见", default: false, description: '点是否可见' },
        /**
         * 指示线条是否可见
         * @type boolean
         * @instance
         * @default false
         * @memberof Obj.Pin
         */
        lineShow: { type: "boolean", title: "点是否可见", default: false, description: '点是否可见' },
        /**
         * 指示线条长度
         * @type number
         * @instance
         * @default 0
         * @memberof Obj.Pin
         */
        lineHeight: { type: "number", title: "指示线条长度", default: 0, description: '指示线条长度' },
        /**
         * 最近可视距离
         * @type number
         * @instance
         * @default 0
         * @memberof Obj.Pin
         */
        near: { type: "number", title: "最近可视距离", default: 0, description: '最近可视距离' },
        /**
         * 最远可视距离
         * @type number
         * @instance
         * @default Number.MAX_VALUE
         * @memberof Obj.Pin
         */
        far: { type: "number", title: "最远可视距离", default: Number.MAX_VALUE, description: '最远可视距离' },
        /**
         * 让深度检测失效的距离（在该距离以内不论是否被遮挡，都显示），设置为0时表示始终会被遮挡。
         * @type number
         * @instance
         * @default Number.MAX_VALUE
         * @memberof Obj.Pin
         */
        disableDepthTestDistance: { type: "number", title: "深度检测失效距离", default: Number.MAX_VALUE, description: '让深度检测失效的距离（在该距离以内不论是否被遮挡，都显示），设置为0时表示始终会被遮挡。' }

        // disableDepthTestDistance只能设置最大值10000000，如果超过Cesium就不起作用了，导致从太空观察时，poi不绘制。

    } };Pin.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['disableDepthTestDistance', 'far', 'imageUrl', 'isDivImage', 'near', 'origin', 'pinBuilder', 'pointShow', 'lineShow', 'lineHeight', 'position', 'scale', 'show', 'viewDistance']
}];

Pin.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Pin, 'Pin');

exports.default = Pin;

/***/ }),
/* 314 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var MakiIconArray = ["airfield", "airport", "alcohol-shop", "america-football", "art-gallery", "bakery", "bank", "bar", "baseball", "basketball", "beer", "bicycle", "building", "bus", "cafe", "camera", "campsite", "car", "cemetery", "cesium", "chemist", "cinema", "circle", "circle-stroked", "city", "clothing-store", "college", "commercial", "cricket", "cross", "dam", "danger", "disability", "dog-park", "embassy", "emergency-telephone", "entrance", "farm", "fast-food", "ferry", "fire-station", "fuel", "garden", "gift", "golf", "grocery", "hairdresser", "harbor", "heart", "heliport", "hospital", "ice-cream", "industrial", "land-use", "laundry", "library", "lighthouse", "lodging", "logging", "london-underground", "marker", "marker-stroked", "minefield", "mobilephone", "monument", "museum", "music", "oil-well", "park", "park2", "parking", "parking-garage", "pharmacy", "pitch", "place-of-worship", "playground", "police", "polling-place", "post", "prison", "rail", "rail-above", "rail-light", "rail-metro", "rail-underground", "religious-christian", "religious-jewish", "religious-muslim", "restaurant", "roadblock", "rocket", "school", "scooter", "shop", "skiing", "slaughterhouse", "soccer", "square", "square-stroked", "star", "star-stroked", "suitcase", "swimming", "telephone", "tennis", "theatre", "toilets", "town", "town-hall", "triangle", "triangle-stroked", "village", "warehouse", "waste-basket", "water", "wetland", "zoo"];

var MakiIcon = {};
MakiIconArray.forEach(function (e) {
    return MakiIcon[e] = e;
});

exports.default = MakiIcon;

/***/ }),
/* 315 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * ODLines用于展示OD线集合
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var ODLines = function (_XbsjCzmObj) {
    (0, _inherits3.default)(ODLines, _XbsjCzmObj);

    function ODLines(earth, guid) {
        (0, _classCallCheck3.default)(this, ODLines);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ODLines.__proto__ || (0, _getPrototypeOf2.default)(ODLines)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        var scene = _this._earth.czm.scene;

        _this._primitive = undefined;
        _this.disposers.push(function () {
            if (_this._primitive) {
                scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });

        var updateTimeRatio = function updateTimeRatio(instanceIndex, frameState) {
            var st = _this.data[instanceIndex].startTime;
            var dr = _this.data[instanceIndex].duration;
            var time = _this.currentTime;
            var diff = time > st ? time - st : time + _this.timeDuration - st;
            var timeRatio = Math.min(diff / dr, 1.0);
            return timeRatio;
        };

        var updatePrimitive = function updatePrimitive() {
            var color = _this.color;
            var show = _this.show;
            var primitive = _this._primitive;
            if (primitive) {
                primitive.show = show;
                var uniformsColor = primitive.appearance.material.uniforms.color;
                // uniformsColor不是Cesium.Color类型，真是奇葩了！！导致不能试用xbsjFromArray！然后Scanline就没问题。
                // uniformsColor.xbsjFromArray(...color);
                uniformsColor.red = color[0];
                uniformsColor.green = color[1];
                uniformsColor.blue = color[2];
                uniformsColor.alpha = color[3];
            }
        };

        var updatePrimitive2 = function updatePrimitive2() {
            if (_this._primitive) {
                scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }

            var primitive = Cesium.xbsjCreateODLinesPrimitive(_this.data, _this.color, updateTimeRatio, _this.translucentPass);
            _this._primitive = scene.primitives.add(primitive);
            updatePrimitive();
        };

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                data: (0, _stringify2.default)(_this.data),
                translucentPass: _this.translucentPass
            };
        }, updatePrimitive2));

        _this.disposers.push((0, _mobx.autorun)(updatePrimitive));

        (0, _mobx.extendObservable)(_this, {
            _pathPlayingListener: undefined,
            get playing() {
                return !!this._pathPlayingListener;
            },
            set playing(val) {
                if (!!val && !this._pathPlayingListener) {
                    this._play();
                } else if (!val && this._pathPlayingListener) {
                    this._pathPlayingListener = this._pathPlayingListener && this._pathPlayingListener();
                }
            }
        }, {
            _pathPlayingListener: _mobx.observable.ref,
            playing: _mobx.computed
        });

        _this.disposers.push(function () {
            _this.playing = false;
        });

        return _this;
    }

    (0, _createClass3.default)(ODLines, [{
        key: '_play',
        value: function _play() {
            var _this2 = this;

            var scene = this._earth.czm.scene;

            // 如果位于末端，则从头开始
            if (this.currentD === this.timeDuration) {
                this.currentD = 0;
            }

            var lastTimeStamp = Date.now();
            this._pathPlayingListener = scene.postUpdate.addEventListener(function (scene, time) {
                var currentTimestamp = Date.now();
                var diffTimeStamp = currentTimestamp - lastTimeStamp;
                lastTimeStamp = currentTimestamp;
                var currentTime = _this2.currentTime + diffTimeStamp * 0.001;
                if (_this2.loopPlay) {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = 0;
                    } else {
                        _this2.currentTime = currentTime;
                    }
                } else {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = _this2.timeDuration;
                        _this2._pathPlayingListener = _this2._pathPlayingListener && _this2._pathPlayingListener();
                    } else {
                        _this2.currentTime = currentTime;
                    }
                }
            });
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(ODLines.prototype.__proto__ || (0, _getPrototypeOf2.default)(ODLines.prototype), 'destroy', this).call(this);
        }
    }]);
    return ODLines;
}(_XbsjCzmObj3.default);

/*
 *  {
 *      positions: [], // [经度，纬度，高度] 经纬度单位是弧度
 *      width: 2.0, // 宽度
 *  }
 * 
 *  {
 *      startPos: [], // [经度，纬度，高度] 经纬度单位是弧度
 *      endPos: [],
 *      width: 2.0, // 宽度
 *  }
 */

ODLines.defaultOptions = {
    data: [],
    color: [1.0, 1.0, 0.0, 1.0],
    show: true,
    timeDuration: 5.0, // 单位秒
    currentTime: 0.0,
    loopPlay: true,
    translucentPass: true
};

var xbsjSchema = {
    title: "ODLines Property",
    type: "object",
    properties: {
        /**
         * 数据集，警告：目前该属性存储和数据量有关，可能很大 <br/>
         * @type {object[]}
         * @instance
         * @default []
         * @memberof Obj.ODLines
         * @example
         * // 数据形式如下： 
         * // 形式1：位置数组之间都是直线连接，适用于路径
         * [
         *    { 
         *        positions: [ 
         *            [2.0, 1.0, 0.0],  
         *            [2.2, 1.0, 0.0], 
         *            ... 
         *        ], // [经度，纬度，高度] 经纬度单位是弧度，其中高度可以省略 
         *        width: 2.0, // 宽度 
         *        color: [1, 1, 0, 0], // 颜色，rgba分量，都是0-1之间 
         *        startTime: 0.5, // OD线从某个时刻开始播放 
         *        duration: 2.0, // OD线从头到尾播放的总时长 
         *    },
         *    {
         *        positions: [ 
         *            [2.0, 1.0, 0.0],  
         *            ...
         *        ],
         *        ...,
         *    },
         *    ...
         * ]
         * 
         * // 形式2： 起点和终点会形成一条弧线，适用于航线
         * [
         *     { 
         *          startPos: [2.0, 1.0, 0.0], // 起始点 [经度，纬度，高度] 经纬度单位是弧度 
         *          endPos: [2.2, 1.0, 0.0], 终止点 [经度，纬度，高度] 经纬度单位是弧度 
         *          width: 2.0, // 宽度 
         *          color: [1, 1, 0, 0], // 颜色，rgba分量，都是0-1之间 
         *          startTime: 0.5, // OD线从某个时刻开始播放 
         *          duration: 2.0, // OD线从头到尾播放的总时长 
         *     },
         *     {
         *          startPos: [2.0, 1.0, 0.0],
         *          ...
         *     },
         *     ...
         * ]
         *  
         */
        data: [],
        /**
         * 是否在透明通道渲染
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.ODLines
         */
        translucentPass: true,
        /**
         * 显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.ODLines
         */
        show: { type: "boolean", title: "显示", default: true, description: '显示' },
        /**
         * 播放总时长，单位秒
         * @type {number}
         * @instance
         * @default 5.0
         * @memberof Obj.ODLines
         */
        timeDuration: { type: "number", title: "播放总时长", default: 5.0, description: '播放总时长' },
        /**
         * 当前播放时刻，单位秒
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.ODLines
         */
        currentTime: { type: "number", title: "当前播放时刻", default: 0.0, description: '当前播放时刻' },
        /**
         * 是否循环播放
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.ODLines
         */
        loopPlay: { type: "boolean", title: "是否循环播放", default: true, description: '是否循环播放' }

        // disableDepthTestDistance只能设置最大值10000000，如果超过Cesium就不起作用了，导致从太空观察时，poi不绘制。

    } };ODLines.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'data', 'color', 'timeDuration', 'currentTime', 'loopPlay', 'translucentPass']
}];

ODLines.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(ODLines, 'ODLines');

exports.default = ODLines;

/***/ }),
/* 316 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _registerInteractionProperty = __webpack_require__(15);

var _createGroundRectangle = __webpack_require__(81);

var _createGroundRectangle2 = _interopRequireDefault(_createGroundRectangle);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 扫描线
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var Scanline = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Scanline, _XbsjCzmObj);

    function Scanline(earth, guid) {
        (0, _classCallCheck3.default)(this, Scanline);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Scanline.__proto__ || (0, _getPrototypeOf2.default)(Scanline)).call(this, earth, guid));

        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionEditingProperty: 'editing'
        }));
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating'
        }));

        var scene = _this._earth.czm.scene;

        _this._primitive = undefined;
        _this.disposers.push(function () {
            if (_this._primitive) {
                scene.groundPrimitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        var updatePrimitive = function updatePrimitive() {
            var ratio = _this.currentTime / _this.timeDuration;
            var color = _this.color;
            var show = _this.show;
            var primitive = _this._primitive;
            if (primitive) {
                primitive.show = show;
                primitive.appearance.material.uniforms.time = ratio;
                var uniformsColor = primitive.appearance.material.uniforms.color;
                // uniformsColor居然不是Cesium.Color类型，为什么？？
                // uniformsColor.xbsjFromArray(...color);           
                uniformsColor.red = color[0];
                uniformsColor.green = color[1];
                uniformsColor.blue = color[2];
                uniformsColor.alpha = color[3];
            }
        };

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                radius: _this.radius
            };
        }, function () {
            if (_this._primitive) {
                scene.groundPrimitives.remove(_this._primitive);
                _this._primitive = undefined;
            }

            // GroundPrimitive后期改造导致不能用
            // const primitive = Cesium.xbsjCreateGroundScanline(cartesian, this.radius);
            var primitive = (0, _createGroundRectangle2.default)(_this.position, _this.radius);
            primitive.appearance.material = Cesium.Material.fromType('XbsjGroundScanline');
            _this._primitive = scene.groundPrimitives.add(primitive);
            updatePrimitive();
        }));

        _this.disposers.push((0, _mobx.autorun)(updatePrimitive));

        (0, _mobx.extendObservable)(_this, {
            _pathPlayingListener: undefined,
            get playing() {
                return !!this._pathPlayingListener;
            },
            set playing(val) {
                if (!!val && !this._pathPlayingListener) {
                    this._play();
                } else if (!val && this._pathPlayingListener) {
                    this._pathPlayingListener = this._pathPlayingListener && this._pathPlayingListener();
                }
            }
        }, {
            _pathPlayingListener: _mobx.observable.ref,
            playing: _mobx.computed
        });

        _this.disposers.push(function () {
            _this.playing = false;
        });
        return _this;
    }

    (0, _createClass3.default)(Scanline, [{
        key: '_play',
        value: function _play() {
            var _this2 = this;

            var scene = this._earth.czm.scene;

            // 如果位于末端，则从头开始
            if (this.currentTime === this.timeDuration) {
                this.currentTime = 0;
            }

            var lastTimeStamp = Date.now();
            this._pathPlayingListener = scene.postUpdate.addEventListener(function (scene, time) {
                var currentTimestamp = Date.now();
                var diffTimeStamp = currentTimestamp - lastTimeStamp;
                lastTimeStamp = currentTimestamp;
                var currentTime = _this2.currentTime + diffTimeStamp * 0.001;
                if (_this2.loopPlay) {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = 0;
                    } else {
                        _this2.currentTime = currentTime;
                    }
                } else {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = _this2.timeDuration;
                        _this2._pathPlayingListener = _this2._pathPlayingListener && _this2._pathPlayingListener();
                    } else {
                        _this2.currentTime = currentTime;
                    }
                }
            });
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.camera.flyTo(this.position, this.radius * 2.0, [0, -Math.PI / 3, 0]);
        }
    }]);
    return Scanline;
}(_XbsjCzmObj3.default);

Scanline.defaultOptions = {
    position: [0, 0, 0],
    radius: 100.0,
    color: [1.0, 1.0, 0.0, 1.0],
    show: true,
    timeDuration: 1.0, // 单位秒
    currentTime: 0.0,
    loopPlay: true
};

var xbsjSchema = {
    title: "Scanline Property",
    type: "object",
    properties: {
        /**
         * 位置数组 [经度、纬度、高度] <br/>
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.Scanline
         */
        position: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '位置 [经度, 纬度, 高度]' },
        /**
         * 半径，单位米
         * @type {number}
         * @instance
         * @default 100.0
         * @memberof Obj.Scanline
         */
        radius: { type: 'number', title: '半径', default: 100.0, description: '半径' },
        /**
         * 颜色叠加
         * @type {number[]}
         * @instance
         * @default [1, 1, 0, 1]
         * @memberof Obj.Scanline
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 0, 1], description: '颜色叠加' },
        /**
         * 显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Scanline
         */
        show: { type: "boolean", title: "显示", default: true, description: '显示' },
        /**
         * 播放持续时间，单位秒
         * @type {number}
         * @instance
         * @default 1.0
         * @memberof Obj.Scanline
         */
        timeDuration: { type: 'number', title: '播放持续时间，单位秒', default: 1.0, description: '播放持续时间，单位秒' },
        /**
         * 当前时间，单位秒
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.Scanline
         */
        currentTime: { type: 'number', title: '当前时间，单位秒', default: 0.0, description: '当前时间，单位秒' },
        /**
         * 是否循环播放
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Scanline
         */
        loopPlay: { type: 'boolean', title: '是否循环播放', default: true, description: '是否循环播放' }

        // disableDepthTestDistance只能设置最大值10000000，如果超过Cesium就不起作用了，导致从太空观察时，poi不绘制。

    } };Scanline.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['position', 'radius', 'color', 'show', 'timeDuration', 'currentTime', 'loopPlay']
}];

Scanline.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Scanline, 'Scanline');

exports.default = Scanline;

/***/ }),
/* 317 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 不对外
 * @ignore
 */
var Circle = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Circle, _XbsjCzmObj);

    function Circle(earth, guid) {
        (0, _classCallCheck3.default)(this, Circle);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Circle.__proto__ || (0, _getPrototypeOf2.default)(Circle)).call(this, earth, guid));

        _XbsjBase2.default.registerProperty(_this, 'material', Circle.defaultOptions.material);
        _XbsjBase2.default.registerProperty(_this.material, 'XbsjColorMaterial', Circle.defaultOptions.material.XbsjColorMaterial);
        _XbsjBase2.default.registerProperty(_this.material, 'XbsjPolylineDashMaterial', Circle.defaultOptions.material.XbsjPolylineDashMaterial);
        _XbsjBase2.default.registerProperty(_this.material, 'XbsjPolylineArrowMaterial', Circle.defaultOptions.material.XbsjPolylineArrowMaterial);

        _this._arcPolyline = new _Polyline2.default(earth);
        _this._edgePolyline = new _Polyline2.default(earth);
        _this._arcPolyline.type = 'NONE';
        _this._edgePolyline.type = 'NONE';

        _this._edgePolyline.positions = [[0, 0, 0], [0, 0, 0], [0, 0, 0]];
        _this._boundingSphere = new Cesium.BoundingSphere();

        _this._disposers = [];
        _this._disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._centerCartesian = new Cesium.Cartesian3();
        _this._hpr = new Cesium.HeadingPitchRoll();
        _this._enu = new Cesium.Matrix4();
        _this._carto = new Cesium.Cartographic();
        // this._positions = [];
        _this._scrachCartesian = new Cesium.Cartesian3();

        (0, _mobx.extendObservable)(_this, {
            _positions: []
        });

        _this._disposers.push((0, _mobx.autorun)(function () {
            var _this$_edgePolyline$p, _Cesium$Cartesian;

            _this._hpr.heading = _this.rotation[0];
            _this._hpr.pitch = _this.rotation[1];
            _this._hpr.roll = _this.rotation[2];

            (_this$_edgePolyline$p = _this._edgePolyline.positions[1]).splice.apply(_this$_edgePolyline$p, [0, 3].concat((0, _toConsumableArray3.default)(_this.center)));
            _this._centerCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this.center).concat([undefined, _this._centerCartesian]));
            Cesium.Cartesian3.clone(_this._centerCartesian, _this._boundingSphere.center);
            _this._boundingSphere.radius = _this.radius;
            _this._enu = Cesium.Transforms.headingPitchRollToFixedFrame(_this._centerCartesian, _this._hpr, undefined, undefined, _this._enu);

            var PI2 = Math.PI * 2.0;

            _this._positions.length = 0;
            if (_this.range[0] !== _this.range[1]) {
                var start = _this.range[0] % PI2;
                var ends = _this.range[1] % PI2;
                var end = ends <= start ? ends + PI2 : ends;

                for (var a = start; a < end; a += _this.granularity) {
                    _this._positions.push(_this._computPosition(a));
                }
                _this._positions.push(_this._computPosition(end));
            }

            // 放这里会导致死循环，不知道为什么，很无语 vtxf
            // const ps = this._positions.map(p => [...p]);
            // this._arcPolyline.positions.splice(0, this._arcPolyline.positions.length, ...ps);
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this._positions.map(function (p) {
                return [].concat((0, _toConsumableArray3.default)(p));
            });
        }, function (positions) {
            var _this$_arcPolyline$po;

            (_this$_arcPolyline$po = _this._arcPolyline.positions).splice.apply(_this$_arcPolyline$po, [0, _this._arcPolyline.positions.length].concat((0, _toConsumableArray3.default)(positions)));
            if (_this._positions.length > 0) {
                var _this$_edgePolyline$p2, _this$_edgePolyline$p3;

                (_this$_edgePolyline$p2 = _this._edgePolyline.positions[0]).splice.apply(_this$_edgePolyline$p2, [0, 3].concat((0, _toConsumableArray3.default)(_this._positions[0])));
                (_this$_edgePolyline$p3 = _this._edgePolyline.positions[2]).splice.apply(_this$_edgePolyline$p3, [0, 3].concat((0, _toConsumableArray3.default)(_this._positions[_this._positions.length - 1])));
            }
        }));

        ['show', 'width', 'depthTest', 'arcType', 'material'].forEach(function (p) {
            _this._disposers.push((0, _bind2.default)(_this._arcPolyline, p, _this, p));
        });

        ['width', 'depthTest', 'arcType', 'material'].forEach(function (p) {
            _this._disposers.push((0, _bind2.default)(_this, p, _this._edgePolyline, p));
        });

        _this._disposers.push((0, _mobx.autorun)(function () {
            _this._edgePolyline.show = _this.show && _this.edgeShow;
        }));

        _this._disposers.push((0, _mobx.reaction)(function () {
            return _this.show && _this.showHelper || _this.isSelected;
        }, function (show) {
            _this._arcPolyline.showHelper = show;
        }, {
            fireImmediately: true
        }));
        return _this;
    }

    (0, _createClass3.default)(Circle, [{
        key: '_computPosition',
        value: function _computPosition(angle) {
            var a = angle;
            var r = this.radius;
            var cos = Math.cos;
            var sin = Math.sin;
            var cartesian = this._scrachCartesian;
            if (this.axisType === 'pitch') {
                // -y
                Cesium.Cartesian3.fromElements(cos(a) * r, 0, sin(a) * r, cartesian);
            } else if (this.axisType === 'roll') {
                // x
                Cesium.Cartesian3.fromElements(0, cos(a) * r, sin(a) * r, cartesian);
            } else if (this.axisType === 'heading') {
                // -z
                Cesium.Cartesian3.fromElements(cos(-a) * r, sin(-a) * r, 0, cartesian);
            }
            Cesium.Matrix4.multiplyByPoint(this._enu, cartesian, cartesian);
            var carto = Cesium.Cartographic.fromCartesian(cartesian, undefined, this._carto);
            return [carto.longitude, carto.latitude, carto.height];
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this._arcPolyline = this._arcPolyline && this._arcPolyline.destroy();
            this._edgePolyline = this._edgePolyline && this._edgePolyline.destroy();

            return (0, _get3.default)(Circle.prototype.__proto__ || (0, _getPrototypeOf2.default)(Circle.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Circle;
}(_XbsjCzmObj3.default);

Circle.defaultOptions = {
    center: [0, 0, 0],
    radius: 1.0,
    rotation: [0, 0, 0],
    axisType: 'heading', // pitch roll
    granularity: 0.02,
    range: [0, Math.PI * 2.0],
    edgeShow: false,
    show: true,
    showHelper: false,
    width: 2,
    depthTest: false,
    arcType: 'NONE', // GEODESIC 地表最近距离插值 NONE 直线，不插值 RHUMB 保持地理方向一致的插值
    material: {
        type: 'XbsjColorMaterial',
        XbsjColorMaterial: {
            color: [1, 0, 1, 1] // color for the line.
        },
        XbsjPolylineDashMaterial: {
            color: [1, 0, 1, 1], // color for the line.
            gapColor: [0, 0, 0, 0], // color for the gaps in the line.
            dashLength: 16, // Dash length in pixels.
            dashPattern: 255 // The 16 bit stipple pattern for the line..
        },
        XbsjPolylineArrowMaterial: {
            color: [1, 0, 1, 1] // color for the line.
        }
    }
};

_XbsjObject2.default.registerType(Circle, 'Circle');

exports.default = Circle;

/***/ }),
/* 318 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _registerInteractionProperty = __webpack_require__(15);

var _updateRealSceneScale = __webpack_require__(82);

var _updateRealSceneScale2 = _interopRequireDefault(_updateRealSceneScale);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 不对外
 * @ignore
 */
var Cylinder = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Cylinder, _XbsjCzmObj);

    function Cylinder(earth, guid) {
        (0, _classCallCheck3.default)(this, Cylinder);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Cylinder.__proto__ || (0, _getPrototypeOf2.default)(Cylinder)).call(this, earth, guid));

        (0, _mobx.extendObservable)(_this, {
            positions: [[0, 0, 0], [0, 0, 0]],
            _realSceneScale: 1.0,
            _endRealSceneScale: 1.0,
            _primitive: undefined
        }, {
            _primitive: _mobx.observable.ref
        });

        _this.disposers.push(function () {
            if (_this._primitive) {
                _this._earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });

        _this.disposers.push((0, _bind2.default)(_this, 'positions.0', _this, 'startPosition'));
        _this.disposers.push((0, _bind2.default)(_this, 'positions.1', _this, 'endPosition'));

        _this._boundingSphere = new Cesium.BoundingSphere();
        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._primitive && (_this._primitive.show = _this.show);
        }));

        _this.disposers.push((0, _updateRealSceneScale2.default)(_this._earth, _this, {
            positionProperty: 'startPosition',
            screenScalePropery: '_realSceneScale',
            fixScreenSizeProperty: 'fixScreenSize',
            scaleProperty: 'radius'
        }));

        _this.disposers.push((0, _updateRealSceneScale2.default)(_this._earth, _this, {
            positionProperty: 'endPosition',
            screenScalePropery: '_endRealSceneScale',
            fixScreenSizeProperty: 'fixScreenSize',
            scaleProperty: 'radius'
        }));

        var that = _this;
        function setColor() {
            if (that._primitive) {
                that._primitive.color.red = that.color[0];
                that._primitive.color.green = that.color[1];
                that._primitive.color.blue = that.color[2];
                that._primitive.color.alpha = that.color[3];
            }
        }

        var setModelMatrix = function setModelMatrix() {
            var _Cesium$Cartesian, _Cesium$Cartesian2;

            if (!_this._primitive) {
                return;
            }

            _this._scratchCartesian = _this._scratchCartesian || new Cesium.Cartesian3();
            _this._scratchCartesian2 = _this._scratchCartesian2 || new Cesium.Cartesian3();
            _this._scratchCartesian3 = _this._scratchCartesian3 || new Cesium.Cartesian3();
            _this._scratchCartesian4 = _this._scratchCartesian4 || new Cesium.Cartesian3();
            _this._scratchQuat = _this._scratchQuat || new Cesium.Quaternion();

            var scratchCartesian = _this._scratchCartesian;
            var scratchCartesian2 = _this._scratchCartesian2;
            var scratchCartesian3 = _this._scratchCartesian3;
            var scratchCartesian4 = _this._scratchCartesian4;

            var startCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this.startPosition).concat([undefined, scratchCartesian]));
            var endCartesian = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(_this.endPosition).concat([undefined, scratchCartesian2]));
            var dir = Cesium.Cartesian3.subtract(endCartesian, startCartesian, scratchCartesian3);
            var depth = Cesium.Cartesian3.magnitude(dir);

            if (depth > 0) {
                depth = depth > 0 ? depth : 0.001;

                dir = Cesium.Cartesian3.normalize(dir, dir);
                var angle = Cesium.Cartesian3.angleBetween(dir, Cesium.Cartesian3.UNIT_Z);
                var axis = Cesium.Cartesian3.cross(Cesium.Cartesian3.UNIT_Z, dir, scratchCartesian4);

                var radius = Math.min(_this._realSceneScale, _this._endRealSceneScale, _this.maxSceneScale);
                var scale = Cesium.Cartesian3.fromElements(radius, radius, depth, scratchCartesian2);
                var quat = Cesium.Quaternion.fromAxisAngle(axis, angle, _this._scratchQuat);
                Cesium.Matrix4.fromTranslationQuaternionRotationScale(startCartesian, quat, scale, _this._primitive.modelMatrix);

                _this._boundingSphere.radius = depth;
                _this._boundingSphere.center = startCartesian;
            }
        };

        _this.disposers.push((0, _mobx.autorun)(function () {
            setModelMatrix();
        }));

        var updatePrimitive = function updatePrimitive(slices) {
            if (_this._primitive) {
                _this._earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }

            var CSG = Cesium.XbsjCSG;
            var cylinder = CSG.cylinder({
                start: [0, 0, 0],
                end: [0, 0, 1],
                // radius: this.radius,
                radius: 1.0,
                slices: slices
            });

            // cylinder.setColor(...this.color);
            var mesh = cylinder.toMesh();

            var primitive = new Cesium.XbsjCustomPrimitive({
                modelMatrix: Cesium.Matrix4.IDENTITY,
                positions: mesh.positions,
                // sts: mesh.sts,
                indices: mesh.indices,
                normals: mesh.normals,
                colors: mesh.colors,
                color: undefined,
                translucent: false,
                id: _this
            });

            _this._earth.czm.scene.primitives.add(primitive);
            _this._primitive = primitive;
        };
        updatePrimitive();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.slices;
        }, updatePrimitive));

        _this.disposers.push((0, _mobx.autorun)(function () {
            return setModelMatrix();
        }));
        _this.disposers.push((0, _mobx.autorun)(function () {
            return setColor();
        }));
        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._primitive && (_this._primitive.show = _this.show);
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolylineEditing)(_this._earth, _this, {
            polylineEditingProperty: 'editing'
        }));
        return _this;
    }

    (0, _createClass3.default)(Cylinder, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Cylinder.prototype.__proto__ || (0, _getPrototypeOf2.default)(Cylinder.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Cylinder;
}(_XbsjCzmObj3.default);

Cylinder.defaultOptions = {
    startPosition: [0, 0, 0],
    endPosition: [0, 0, 0],
    radius: 1.0,
    slices: 16,
    color: [1, 0, 0, 1],
    show: true,
    fixScreenSize: 0,
    maxSceneScale: Number.POSITIVE_INFINITY
};

_XbsjObject2.default.registerType(Cylinder, 'Cylinder');

exports.default = Cylinder;

/***/ }),
/* 319 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _createGroundRectangle = __webpack_require__(81);

var _createGroundRectangle2 = _interopRequireDefault(_createGroundRectangle);

var _registerInteractionProperty = __webpack_require__(15);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * GroundImage用来创建贴地图像，并且图像可以轮换
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var GroundImage = function (_XbsjCzmObj) {
    (0, _inherits3.default)(GroundImage, _XbsjCzmObj);

    function GroundImage(earth, guid) {
        (0, _classCallCheck3.default)(this, GroundImage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (GroundImage.__proto__ || (0, _getPrototypeOf2.default)(GroundImage)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this.textureWidth = 2048;
        _this.textureHeight = 2048;

        _XbsjBase2.default.registerPosition(_this);
        // 检测位置编辑状态 // positionEditing
        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionEditingProperty: 'editing'
        }));
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating'
        }));

        var scene = _this._earth.czm.scene;

        _this._groundPrimitive = undefined;
        _this.disposers.push(function () {
            _this._groundPrimitive && scene.groundPrimitives.remove(_this._groundPrimitive);
            _this._groundPrimitive = undefined;
        });

        _this._material = new Cesium.Material({
            fabric: {
                type: 'ImageMapXC',
                materials: {
                    left: {
                        type: 'ScaleImageXC',
                        uniforms: {
                            image: Cesium.Material.DefaultImageId,
                            repeat: new Cesium.Cartesian2(1.0, 1.0),
                            color: new Cesium.Color(1.0, 1.0, 1.0, 1.0),
                            stscale: new Cesium.Cartesian2(1.0, 1.0)
                        },
                        components: {
                            diffuse: 'texture2D(image, fract(repeat * materialInput.st) * stscale).rgb * color.rgb',
                            alpha: 'texture2D(image, fract(repeat * materialInput.st) * stscale).a * color.a'
                        }
                    },
                    right: {
                        type: 'ScaleImageXC',
                        uniforms: {
                            image: Cesium.Material.DefaultImageId,
                            repeat: new Cesium.Cartesian2(1.0, 1.0),
                            color: new Cesium.Color(1.0, 1.0, 1.0, 1.0),
                            stscale: new Cesium.Cartesian2(1.0, 1.0)
                        },
                        components: {
                            diffuse: 'texture2D(image, fract(repeat * materialInput.st) * stscale).rgb * color.rgb',
                            alpha: 'texture2D(image, fract(repeat * materialInput.st) * stscale).a * color.a'
                        }
                    }
                },
                uniforms: {
                    t: 0.0,
                    opacity: 1.0
                },
                components: {
                    diffuse: 'left.diffuse * (1.0 - t) + right.diffuse * t',
                    alpha: '(left.alpha * (1.0 - t) + right.alpha * t) * opacity'
                }
            }
        });

        var updateMaterialSize = function updateMaterialSize() {
            _this._leftHeatmapTexture && _this._leftHeatmapTexture.destroy();

            _this._leftHeatmapTexture = new Cesium.Texture({
                context: scene.context,
                width: _this.textureWidth,
                height: _this.textureHeight
            });

            _this._rightHeatmapTexture && _this._rightHeatmapTexture.destroy();

            _this._rightHeatmapTexture = new Cesium.Texture({
                context: scene.context,
                width: _this.textureWidth,
                height: _this.textureHeight
            });

            _this._material.materials.left.uniforms.image = _this._leftHeatmapTexture;
            _this._material.materials.right.uniforms.image = _this._rightHeatmapTexture;
            // this._material.materials.left.uniforms.color = new Cesium.Color(1, 0, 0, 1); test
        };

        updateMaterialSize();
        // this.disposers.push(reaction(() => ({
        //     width: this.textureWidth,
        //     height: this.textureHeight,
        // }), () => {
        //     updateMaterialSize();
        // }));

        _this._scratchRect = new Cesium.Rectangle();

        var updateGroundPrimitive = function updateGroundPrimitive() {
            _this._groundPrimitive && scene.groundPrimitives.remove(_this._groundPrimitive);
            _this._groundPrimitive = undefined;

            var ox = _this.origin[0];
            var oy = _this.origin[1];

            // const southWest = [...this.position].xePositionMove(-ox*this.width, -oy*this.height);
            // const eastNorth = [...this.position].xePositionMove((1.0-ox)*this.width, (1.0-oy)*this.height);            
            // const rect = Cesium.Rectangle.fromRadians(southWest[0], southWest[1], eastNorth[0], eastNorth[1], this._scratchRect);

            // // 测试
            // var l = 1.9017002778972645 + 0.000018;
            // var b = 0.5972050595291177 + 0.000038;
            // var rect = Cesium.Rectangle.fromRadians(l - 0.000038, b - 0.000018, l + 0.000038, b + 0.000018);

            // this._groundPrimitive = scene.groundPrimitives.add(new Cesium.GroundPrimitive({
            //     geometryInstances: new Cesium.GeometryInstance({
            //         geometry: new Cesium.RectangleGeometry({
            //             rectangle: rect,
            //             vertexFormat: Cesium.EllipsoidSurfaceAppearance.VERTEX_FORMAT
            //         })
            //     }),
            //     appearance: new Cesium.EllipsoidSurfaceAppearance({
            //         aboveGround: false
            //     }),
            //     // classificationType: Cesium.ClassificationType.TERRAIN
            //     // classificationType: Cesium.ClassificationType.CESIUM_3D_TILE
            //     classificationType: Cesium.ClassificationType.BOTH,
            // }));

            var groundImage = (0, _createGroundRectangle2.default)(_this.position, _this.width, _this.height, ox, oy, _this.rotation, undefined);
            _this._groundPrimitive = scene.groundPrimitives.add(groundImage);
            _this._groundPrimitive.show = _this.show; // 避免groundImage创建时设置show属性不起作用

            _this._groundPrimitive.appearance.material = _this._material;
        };

        updateGroundPrimitive();

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                origin: [].concat((0, _toConsumableArray3.default)(_this.origin)),
                rotation: _this.rotation,
                width: _this.width,
                height: _this.height
            };
        }, function () {
            updateGroundPrimitive();
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.show;
        }, function () {
            _this._groundPrimitive.show = _this.show;
        }));

        (0, _mobx.extendObservable)(_this, {
            _images: []
        });

        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this.imageUrls));
        }, function (imageUrls) {
            _this._fetchTexturesSubscription && _this._fetchTexturesSubscription.unsubscribe();
            _this._fetchTexturesSubscription = undefined;

            var promises = imageUrls.map(function (e) {
                return new _promise2.default(function (resolve, reject) {
                    Cesium.Resource.fetchImage({
                        url: e
                    }).then(function (image) {
                        resolve(image);
                    });
                    // 这样写也可以
                    // var img = new Image();
                    // img.src = e;
                    // img.onload = () => {
                    //     resolve(img);
                    // };
                });
            });

            var observable = new rxjs.Observable(function (observer) {
                _promise2.default.all(promises).then(function (images) {
                    observer.next(images);
                });
            });

            _this._fetchTexturesSubscription = observable.subscribe(function (images) {
                var _this$_images;

                images = images.filter(function (e) {
                    var r = e.width > _this.textureWidth || e.height > _this.textureHeight;
                    if (r) {
                        console.warn('\u8B66\u544A\uFF1A\u56FE\u7247\u5C3A\u5BF8\u5927\u4E8E' + _this.textureWidth + 'X' + _this.textureHeight + '\uFF0C\u5C06\u88AB\u5FFD\u7565\u3002\u3002');
                    }
                    return !r;
                });

                (_this$_images = _this._images).splice.apply(_this$_images, [0, _this._images.length].concat((0, _toConsumableArray3.default)(images)));

                if (_this._images.length > 0) {
                    var img = _this._images[0];
                    if (_this.autoWidth) {
                        _this.width = _this.height * img.naturalWidth / img.naturalHeight;
                    } else if (_this.autoHeight) {
                        _this.height = _this.width * img.naturalHeight / img.naturalWidth;
                    }
                }
            });
        }));

        _this._leftImage = undefined;
        _this._rightImage = undefined;

        var whiteImageBuffer = new Uint8Array([255, 255, 255, 0]);

        var imageChanged = function imageChanged() {
            var l = _this._images.length;
            if (l === 0) {
                _this._leftImage = undefined;
                _this._rightImage = undefined;

                _this._material.materials.left.uniforms.image.copyFrom({
                    width: 1,
                    height: 1,
                    arrayBufferView: whiteImageBuffer
                });
                _this._material.materials.left.uniforms.stscale = new Cesium.Cartesian2(1 / _this.textureWidth, 1 / _this.textureHeight);

                _this._material.materials.right.uniforms.image.copyFrom({
                    width: 1,
                    height: 1,
                    arrayBufferView: whiteImageBuffer
                });
                _this._material.materials.right.uniforms.stscale = new Cesium.Cartesian2(1 / _this.textureWidth, 1 / _this.textureHeight);

                return;
            }

            var currentTime = _this.currentTime > _this.timeDuration ? 0.0 : _this.currentTime;

            var index = 0;
            var intervalT = 0;

            // 等间距的操作模式
            if (l >= 2) {
                if (!_this.times || _this.times.length === 0) {
                    var interval = _this.timeDuration / (l - 1);
                    var pos = currentTime / interval;
                    index = Math.floor(pos);
                    intervalT = pos - index;
                } else {
                    index = _this.times.findIndex(function (time) {
                        return time > currentTime;
                    }) - 1;
                    if (index < 0) {
                        index = 0;
                        intervalT = 0;
                    } else if (index >= _this._images.length - 1) {
                        index = _this._images.length - 2;
                        intervalT = 1.0;
                    } else {
                        intervalT = (currentTime - _this.times[index]) / (_this.times[index + 1] - _this.times[index]);
                    }
                }
            }

            if (_this._leftImage !== _this._images[index]) {
                _this._leftImage = _this._images[index];
                var image = _this._leftImage;
                _this._material.materials.left.uniforms.image.copyFrom(image);
                _this._material.materials.left.uniforms.stscale = new Cesium.Cartesian2(image.width / _this.textureWidth, image.height / _this.textureHeight);
            }

            if (l >= 2 && _this._rightImage !== _this._images[index + 1]) {
                _this._rightImage = _this._images[index + 1];
                var _image = _this._rightImage;
                _this._material.materials.right.uniforms.image.copyFrom(_image);
                _this._material.materials.right.uniforms.stscale = new Cesium.Cartesian2(_image.width / _this.textureWidth, _image.height / _this.textureHeight);
            }

            _this._material.uniforms.t = intervalT;
        };

        imageChanged();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                currentTime: _this.currentTime,
                timeDuration: _this.timeDuration,
                images: [].concat((0, _toConsumableArray3.default)(_this._images)),
                times: [].concat((0, _toConsumableArray3.default)(_this.times))
            };
        }, imageChanged));

        (0, _mobx.extendObservable)(_this, {
            _pathPlayingListener: undefined,
            get playing() {
                return !!this._pathPlayingListener;
            },
            set playing(val) {
                if (!!val && !this._pathPlayingListener) {
                    this._play();
                } else if (!val && this._pathPlayingListener) {
                    this._pathPlayingListener = this._pathPlayingListener && this._pathPlayingListener();
                }
            }
        }, {
            _pathPlayingListener: _mobx.observable.ref,
            playing: _mobx.computed
        });

        _this.disposers.push(function () {
            _this.playing = false;
        });

        var updateOpacity = function updateOpacity() {
            _this._material.uniforms.opacity = _this.opacity;
        };
        updateOpacity();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.opacity;
        }, updateOpacity));
        return _this;
    }

    (0, _createClass3.default)(GroundImage, [{
        key: '_play',
        value: function _play() {
            var _this2 = this;

            var scene = this._earth.czm.scene;

            // 如果位于末端，则从头开始
            if (this.currentTime === this.timeDuration) {
                this.currentTime = 0;
            }

            var lastTimeStamp = Date.now();
            this._pathPlayingListener = scene.postUpdate.addEventListener(function (scene, time) {
                var currentTimestamp = Date.now();
                var diffTimeStamp = currentTimestamp - lastTimeStamp;
                lastTimeStamp = currentTimestamp;
                var currentTime = _this2.currentTime + diffTimeStamp * 0.001;
                if (_this2.loopPlay) {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = 0;
                    } else {
                        _this2.currentTime = currentTime;
                    }
                } else {
                    if (currentTime > _this2.timeDuration) {
                        _this2.currentTime = _this2.timeDuration;
                        _this2._pathPlayingListener = _this2._pathPlayingListener && _this2._pathPlayingListener();
                    } else {
                        _this2.currentTime = currentTime;
                    }
                }
            });
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.camera.flyTo(this.position, this.width, [0, -Math.PI / 3, 0]);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(GroundImage.prototype.__proto__ || (0, _getPrototypeOf2.default)(GroundImage.prototype), 'destroy', this).call(this);
        }
    }]);
    return GroundImage;
}(_XbsjCzmObj3.default);

GroundImage.defaultOptions = {
    position: [0, 0, 0],
    width: 100,
    height: 100,
    autoWidth: false,
    autoHeight: true,
    origin: [0.5, 0.5],
    rotation: 0.0,
    // textureWidth: 1024,
    // textureHeight: 1024,
    show: true,
    // ground: true,
    imageUrls: [],
    timeDuration: 1.0, // 单位秒
    currentTime: 0.0,
    loopPlay: true,
    times: [],
    opacity: 1.0
};

var xbsjSchema = {
    title: "GroundImage Property",
    type: "object",
    properties: {
        /**
         * 显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.GroundImage
         */
        show: { type: "boolean", title: "显示", default: true, description: '显示' },
        /**
         * @description 原点
         * @type {array}
         * @instance
         * @default [0.5, 0.5]
         * @memberof Obj.GroundImage
         */
        origin: { type: "array", items: { type: 'number' }, minItems: 2, maxItems: 2, title: "原点", default: [0.5, 0.5], description: '原点' },
        /**
         * @description 旋转角
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.GroundImage
         */
        rotation: { type: "number", title: "旋转角", default: 0, description: '旋转角' },
        /**
         * @description 位置数组 [经度、纬度、高度]
         * @type {array}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.GroundImage
         */
        position: { type: "array", items: { type: 'number' }, minItems: 3, maxItems: 3, title: "位置数组", default: [0, 0, 0], description: '位置数组' },
        /**
         * 宽度
         * @type {number}
         * @instance
         * @default 100
         * @memberof Obj.GroundImage
         */
        width: { type: "number", title: "东西方向长度", default: 100, description: '宽度' },
        /**
         * 高度
         * @type {number}
         * @instance
         * @default 100
         * @memberof Obj.GroundImage
         */
        height: { type: "number", title: "南北方向长度", default: 100, description: '高度' },
        /**
         * 是否自动计算宽度，根据高度和载入的图像自动计算宽度
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.GroundImage
         */
        autoWidth: { type: "boolean", title: "是否自动计算宽度", default: true, description: '是否自动计算宽度' },
        /**
         * 是否自动计算高度，根据宽度和载入的图像自动计算高度
         * @type {number}
         * @instance
         * @default true
         * @memberof Obj.GroundImage
         */
        autoHeight: { type: "boolean", title: "是否自动计算高度", default: true, description: '是否自动计算高度' },
        /**
         * 图像路径数组，形式如 ['xxx/xxx.jpg', 'zzz/zzz.png']
         * @type {string[]}
         * @instance
         * @default ''
         * @memberof Obj.GroundImage
         */
        imageUrls: { type: "array", items: { type: 'string' }, title: "图像路径", default: [], description: '图像路径' },
        /**
         * 播放总时长，单位秒
         * @type {number}
         * @instance
         * @default 1.0
         * @memberof Obj.GroundImage
         */
        timeDuration: { type: "number", title: "播放总时长", default: 1.0, description: '播放总时长' },
        /**
         * 当前播放时刻，单位秒
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.GroundImage
         */
        currentTime: { type: "number", title: "当前播放时刻", default: 0.0, description: '当前播放时刻' },
        /**
         * 是否循环播放
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.GroundImage
         */
        loopPlay: { type: "boolean", title: "是否循环播放", default: true, description: '是否循环播放' },
        /**
         * 每个图象的播放时刻<br/>
         * 警告：当length为0时，会使用timeDuration来均衡播放；length>0时，timeDuration属性将失效！
         * @type {number[]}
         * @instance
         * @default []
         * @memberof Obj.GroundImage
         * @example
         * x.imageUrls = ['xxx.jpg', 'ccc.png', 'ddd.png']; //
         * // 注意确保时刻总是升序，即数字由小到大，最后一个数字同时也表示了整个轮播的总时长
         * x.times = [0, 5, 6]; // 相当于第一张图片在0s出现，第二张图片在5s出现，0s-5s之间会从第一张图片过渡到第二张图片
         */
        times: { type: "boolean", title: "每个图象的播放时刻", default: [], description: '每个图象的播放时刻' },
        /**
         * 不透明度
         * @type {number}
         * @instance
         * @default 1.0
         * @memberof Obj.GroundImage
         */
        opacity: { type: "number", title: "不透明度", default: 1.0, description: "不透明度" }
    }
};

GroundImage.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'origin', 'rotation', 'position', 'width', 'height', 'autoWidth', 'autoHeight', 'imageUrls', 'timeDuration', 'currentTime', 'loopPlay', 'times']
}];

GroundImage.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(GroundImage, 'GroundImage');

exports.default = GroundImage;

/***/ }),
/* 320 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    positions: [],
    height: 0.0,
    show: true,
    baseWaterColor: [0.2, 0.3, 0.6, 1.0],
    blendColor: [0.5, 0.5, 0.5, 0.7],
    frequency: 5000.0,
    animationSpeed: 0.05,
    amplitude: 2.0,
    specularIntensity: 0.5,
    fadeFactor: 1.0,
    velocity: [10.0, 10.0],
    showHelper: false,
    outline: {
        show: true,
        color: [0, 1, 0, 1],
        width: 2.0
    },
    ground: false
};

function applyMaterial(primitive, water) {
    var _uniforms$baseWaterCo, _uniforms$blendColor;

    var uniforms = primitive.appearance.material.uniforms;

    (_uniforms$baseWaterCo = uniforms.baseWaterColor).xbsjFromArray.apply(_uniforms$baseWaterCo, (0, _toConsumableArray3.default)(water.baseWaterColor));
    (_uniforms$blendColor = uniforms.blendColor).xbsjFromArray.apply(_uniforms$blendColor, (0, _toConsumableArray3.default)(water.blendColor));
    uniforms.frequency = water.frequency;
    uniforms.animationSpeed = water.animationSpeed;
    uniforms.amplitude = water.amplitude;
    uniforms.specularIntensity = water.specularIntensity;
    uniforms.fadeFactor = water.fadeFactor;
    uniforms.sizeAndVelocity.z = water.velocity[0];
    uniforms.sizeAndVelocity.w = water.velocity[1];
}

/**
 * 水面
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Water = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Water, _XbsjCzmObj);

    function Water(earth, guid) {
        (0, _classCallCheck3.default)(this, Water);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Water.__proto__ || (0, _getPrototypeOf2.default)(Water)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._primitive = undefined;
        _this.disposers.push(function () {
            return _this._primitive && _this._earth.czm.scene.xbsjWaterManager.destroyWaterPolygonPrimitive(_this._primitive);
        });
        _this._groundPrimitive = undefined;
        _this.disposers.push(function () {
            return _this._groundPrimitive && _this._earth.czm.scene.xbsjWaterManager.destroyWaterPolygonPrimitive(_this._groundPrimitive);
        });

        _this._boundingSphere = new Cesium.BoundingSphere();

        {
            var updatePolygonPrimitive = function updatePolygonPrimitive() {
                if (_this._primitive) {
                    _this._primitive.show = _this.show;
                    applyMaterial(_this._primitive, _this);
                }

                if (_this._groundPrimitive) {
                    _this._groundPrimitive.show = _this.show;
                    applyMaterial(_this._groundPrimitive, _this);
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    // color: [...this.color],
                    show: _this.show,
                    baseWaterColor: [].concat((0, _toConsumableArray3.default)(_this.baseWaterColor)),
                    blendColor: [].concat((0, _toConsumableArray3.default)(_this.blendColor)),
                    frequency: _this.frequency,
                    animationSpeed: _this.animationSpeed,
                    amplitude: _this.amplitude,
                    specularIntensity: _this.specularIntensity,
                    fadeFactor: _this.fadeFactor,
                    velocity: [].concat((0, _toConsumableArray3.default)(_this.velocity))
                };
            }, updatePolygonPrimitive));

            var createPolygonPrimitive = function createPolygonPrimitive() {
                _this._primitive && _this._earth.czm.scene.xbsjWaterManager.destroyWaterPolygonPrimitive(_this._primitive);
                _this._primitive = undefined;

                _this._groundPrimitive && _this._earth.czm.scene.xbsjWaterManager.destroyWaterPolygonPrimitive(_this._groundPrimitive);
                _this._groundPrimitive = undefined;

                var cartesians = [];

                var l = _this.positions.length / 2;

                if (l < 3) {
                    return;
                }

                for (var i = 0; i < l; ++i) {
                    var cartesian = Cesium.Cartesian3.fromRadians(_this.positions[i * 2 + 0], _this.positions[i * 2 + 1], _this.height);
                    cartesians.push(cartesian);
                }

                if (!_this.ground) {
                    _this._primitive = _this._earth.czm.scene.xbsjWaterManager.createWaterPolygonPrimitive(cartesians, false);
                } else {
                    _this._groundPrimitive = _this._earth.czm.scene.xbsjWaterManager.createWaterPolygonPrimitive(cartesians, true);
                }
            };

            var updateBoundingSphere = function updateBoundingSphere() {
                var l = _this.positions.length / 2;
                if (l >= 3) {
                    var positionsWithHeight = [];
                    for (var i = 0; i < l; ++i) {
                        positionsWithHeight.push(_this.positions[i * 2], _this.positions[i * 2 + 1], _this.height);
                    }
                    var cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);
                    _this._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this._boundingSphere);
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                    height: _this.height,
                    ground: _this.ground
                };
            }, function () {
                createPolygonPrimitive();
                updatePolygonPrimitive();
                updateBoundingSphere();
            }));
        }

        _this._polyline = new _Polyline2.default(earth);
        _this.disposers.push(function () {
            return _this._polyline = _this._polyline && _this._polyline.destroy();
        });

        {
            _this._polyline.material.type = 'XbsjColorMaterial';
            _this._polyline.depthTest = false;
            _this._polyline.loop = true;

            _this.disposers.push((0, _mobx.autorun)(function () {
                _this._polyline.material['XbsjColorMaterial'].color = _this.outline.color;
                _this._polyline.width = _this.outline.width;
                _this._polyline.show = _this.show && _this.outline.show;
                _this._polyline.ground = _this.ground;
            }));

            {
                var getPolylinePositions = function getPolylinePositions() {
                    var l = _this.positions.length / 2;
                    var positions = [];
                    for (var i = 0; i < l; ++i) {
                        positions.push([_this.positions[i * 2], _this.positions[i * 2 + 1], _this.height]);
                    }
                    return positions;
                };

                var setPolylinePositions = function setPolylinePositions(positions) {
                    return _this._polyline && (_this._polyline.positions = positions);
                };
                setPolylinePositions(getPolylinePositions());
                _this.disposers.push((0, _mobx.reaction)(getPolylinePositions, setPolylinePositions));
            }
        }

        /**
         * 是否在三维窗口中编辑
         * @name editing
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Water
         */

        /**
         * 是否在三维窗口中进行点增加的编辑
         * @name creating
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Water
         */

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreatingWithHeight)(_this._earth, _this, {
            polygonCreatingWithHeight: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));
        return _this;
    }

    (0, _createClass3.default)(Water, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Water.prototype.__proto__ || (0, _getPrototypeOf2.default)(Water.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return Water;
}(_XbsjCzmObj3.default);

var xbsjSchema = {
    title: "Water Property",
    type: "object",
    properties: {
        /**
         * 位置数组，形式如 [[2.012, 0.65, 10], [1.9, 0.7, 20], ...] 每一个元素分别表示 经度、纬度、高度，其中经度纬度以弧度为单位，高度以米为单位
         * @type {array}
         * @instance
         * @default true
         * @memberof Obj.Water
         */
        positions: { type: 'array', title: '位置数组', default: [], description: '位置数组' },
        /**
         * 水面高度
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.Water
         */
        height: { type: 'number', title: '水面高度', default: 0.0, description: '水面高度' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Water
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 基本颜色叠加
         * @type {number[]}
         * @instance
         * @default [0.2, 0.3, 0.6, 1.0]
         * @memberof Obj.Water
         */
        baseWaterColor: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [0.2, 0.3, 0.6, 1.0], description: '颜色叠加' },
        /**
         * 混合颜色叠加
         * @type {number[]}
         * @instance
         * @default [0.5, 0.5, 0.5, 0.7]
         * @memberof Obj.Water
         */
        blendColor: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [0.5, 0.5, 0.5, 0.7], description: '颜色叠加' },
        /**
         * 频率
         * @type {number}
         * @instance
         * @default 5000.0
         * @memberof Obj.Water
         */
        frequency: { type: 'number', title: '频率', default: 5000.0, description: '频率' },
        /**
         * 运动速度
         * @type {number}
         * @instance
         * @default 0.05
         * @memberof Obj.Water
         */
        animationSpeed: { type: 'number', title: '运动速度', default: 0.05, description: '运动速度' },
        /**
         * amplitude
         * @type {number}
         * @instance
         * @default 2.0
         * @memberof Obj.Water
         */
        amplitude: { type: 'number', title: 'amplitude', default: 2.0, description: 'amplitude' },
        /**
         * specularIntensity
         * @type {number}
         * @instance
         * @default 0.5
         * @memberof Obj.Water
         */
        specularIntensity: { type: 'number', title: 'specularIntensity', default: 0.5, description: 'specularIntensity' },
        /**
         * fadeFactor
         * @type {number}
         * @instance
         * @default 1.0
         * @memberof Obj.Water
         */
        fadeFactor: { type: 'number', title: 'fadeFactor', default: 1.0, description: 'fadeFactor' },
        /**
         * 速度数组，有两个元素，分别表示东西向、南北向，分别以东和北作为正向
         * @type {number[]}
         * @instance
         * @default [10.0, 10.0]
         * @memberof Obj.Water
         */
        velocity: { type: 'array', items: { type: 'number' }, minItems: 2, maxItems: 2, default: [10.0, 10.0], description: '速度数组' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.Water
         */
        showHelper: { type: "boolean", title: "辅助线框", default: "false", description: '辅助线框' },
        /**
         * 外轮廓线
         * @type {object}
         * @property {string} show -  外轮廓线是否可见，默认为true
         * @property {Obj.Water.Material.Color} color - 外轮廓线颜色，默认为[0, 1, 0, 1]
         * @property {Obj.Water.Material.WaterDash} width - 外轮廓线宽度，默认为2.0
         * @instance
         * @memberof Obj.Water
         */
        outline: {}, // TODO(vtxf)
        /**
         * 是否贴地
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Water
         */
        ground: { type: 'boolean', title: '是否贴地', default: true, description: '是否贴地' }
    }
};

Water.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['positions', 'height', 'show', 'baseWaterColor', 'blendColor', 'frequency', 'animationSpeed', 'amplitude', 'specularIntensity', 'fadeFactor', 'velocity', 'showHelper', 'outline', 'ground']
}];

Water.xbsjClassification = xbsjClassification;

Water.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(Water, 'Water');

exports.default = Water;

/***/ }),
/* 321 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// const WindingOrder = Cesium.WindingOrder;
// const CullFace = Cesium.CullFace;
// const DepthFunction = Cesium.DepthFunction;
// const BlendEquation = Cesium.BlendEquation;
// const StencilFunction = Cesium.StencilFunction;
// const StencilOperation = Cesium.StencilOperation;

var defaults = {
    frontFace: WebGL2RenderingContext.CCW, // WindingOrder.COUNTER_CLOCKWISE,
    cull: {
        enabled: false,
        face: WebGL2RenderingContext.BACK // CullFace.BACK
    },
    lineWidth: 1,
    polygonOffset: {
        enabled: false,
        factor: 0,
        units: 0
    },
    scissorTest: {
        enabled: false,
        rectangle: {
            x: 0,
            y: 0,
            width: 0,
            height: 0
        }
    },
    depthRange: {
        near: 0,
        far: 1
    },
    depthTest: {
        enabled: false,
        func: WebGL2RenderingContext.LESS // DepthFunction.LESS
    },
    colorMask: {
        red: true,
        green: true,
        blue: true,
        alpha: true
    },
    depthMask: true,
    stencilMask: ~0,
    blending: {
        enabled: false,
        color: {
            red: 0.0,
            green: 0.0,
            blue: 0.0,
            alpha: 0.0
        },
        equationRgb: WebGL2RenderingContext.ADD, // BlendEquation.ADD,
        equationAlpha: WebGL2RenderingContext.ADD, // BlendEquation.ADD,
        functionSourceRgb: WebGL2RenderingContext.ONE, // BlendFunction.ONE,
        functionSourceAlpha: WebGL2RenderingContext.ONE, // BlendFunction.ONE,
        functionDestinationRgb: WebGL2RenderingContext.ZERO, // BlendFunction.ZERO,
        functionDestinationAlpha: WebGL2RenderingContext.ZERO // BlendFunction.ZERO,
    },
    stencilTest: {
        enabled: false,
        frontFunction: WebGL2RenderingContext.ALWAYS, // StencilFunction.ALWAYS,
        backFunction: WebGL2RenderingContext.ALWAYS, // StencilFunction.ALWAYS,
        reference: 0,
        mask: ~0,
        frontOperation: {
            fail: WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
            zFail: WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
            zPass: WebGL2RenderingContext.KEEP // StencilOperation.KEEP
        },
        backOperation: {
            fail: WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
            zFail: WebGL2RenderingContext.KEEP, // StencilOperation.KEEP,
            zPass: WebGL2RenderingContext.KEEP // StencilOperation.KEEP
        }
    },
    sampleCoverage: {
        enabled: false,
        value: 1.0,
        invert: false
    }
};

exports.default = defaults;

/***/ }),
/* 322 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _isFinite = __webpack_require__(323);

var _isFinite2 = _interopRequireDefault(_isFinite);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/*

        // 1.0 立方体顶点位置标号，以及坐标系示意图
        // 立方体
        //    v6----- v5
        //   /|      /|
        //  v1------v0|
        //  | |     | |
        //  | |v7---|-|v4
        //  |/      |/
        //  v2------v3
        // 坐标系
        //  z
        //  | /y
        //  |/
        //  o------x
        // 1.1 定义位置数组
        var v0 = [0.5, -0.5, 0.5];
        var v1 = [-0.5, -0.5, 0.5];
        var v2 = [-0.5, -0.5, -0.5];
        var v3 = [0.5, -0.5, -0.5];
        var v4 = [0.5, 0.5, -0.5];
        var v5 = [0.5, 0.5, 0.5];
        var v6 = [-0.5, 0.5, 0.5];
        var v7 = [-0.5, 0.5, -0.5];
        var positions = [
            // 下 -z
            ...v2, ...v3, ...v4, ...v7,
            // 前 -y
            ...v2, ...v3, ...v0, ...v1,
            // 后 +y
            ...v4, ...v7, ...v6, ...v5,
            // 左 -x
            ...v7, ...v2, ...v1, ...v6,
            // 右 +x
            ...v3, ...v4, ...v5, ...v0,
            // 上 +z
            ...v1, ...v0, ...v5, ...v6,
        ];


        // 1.2 定义法向数组
        var npx = [1, 0, 0];
        var nnx = [-1, 0, 0];
        var npy = [0, 1, 0];
        var nny = [0, -1, 0];
        var npz = [0, 0, 1];
        var nnz = [0, 0, -1];
        var normals = new Float32Array([
            // 下 -z
            ...nnz, ...nnz, ...nnz, ...nnz,
            // 前 -y
            ...nny, ...nny, ...nny, ...nny,
            // 后 +y
            ...npy, ...npy, ...npy, ...npy,
            // 左 -x
            ...nnx, ...nnx, ...nnx, ...nnx,
            // 右 +x
            ...npx, ...npx, ...npx, ...npx,
            // 上 +z
            ...npz, ...npz, ...npz, ...npz,
        ]);   
        // 1.3 定义纹理数组
        
        const sts = [
            0, 0, 1, 0, 1, 1, 0, 1,
            0, 0, 1, 0, 1, 1, 0, 1,
            0, 0, 1, 0, 1, 1, 0, 1,
            0, 0, 1, 0, 1, 1, 0, 1,
            0, 0, 1, 0, 1, 1, 0, 1,
            0, 0, 1, 0, 1, 1, 0, 1,
        ];
        // 1.4 定义索引
        cosnt indices = [
            0, 1, 2, 0, 2, 3,
            4, 5, 6, 4, 6, 7,
            8, 9, 10, 8, 10, 11,
            12, 13, 14, 12, 14, 15,
            16, 17, 18, 16, 18, 19,
            20, 21, 22, 20, 22, 23,
        ]


        // 1.5 定义纹理
        var texture = undefined;
        var imageUri = './images/earth.png';
        Cesium.Resource.createIfNeeded(imageUri).fetchImage().then(function(image) {
            console.log('image loaded!');
            var vtxfTexture;
            var context = viewer.scene.context;
            if (Cesium.defined(image.internalFormat)) {
                vtxfTexture = new Cesium.Texture({
                    context: context,
                    pixelFormat: image.internalFormat,
                    width: image.naturalWidth,
                    height: image.naturalHeight,
                    source: {
                        arrayBufferView: image.bufferView
                    }
                });
            } else {
                vtxfTexture = new Cesium.Texture({
                    context: context,
                    source: image
                });
            }
            texture = vtxfTexture;
        });       
*/

function createTextureFromImage(context, image) {
    var vtxfTexture;
    if (Cesium.defined(image.internalFormat)) {
        vtxfTexture = new Cesium.Texture({
            context: context,
            pixelFormat: image.internalFormat,
            width: image.width,
            height: image.height,
            source: {
                arrayBufferView: image.bufferView
            }
        });
    } else {
        vtxfTexture = new Cesium.Texture({
            context: context,
            source: image
        });
    }
    return vtxfTexture;
}

// var vtxfVertexShader =
// `
// // vtxf 使用double类型的position进行计算
// // attribute vec3 position3DHigh;
// // attribute vec3 position3DLow;
// attribute vec3 position;
// attribute vec3 normal;
// attribute vec2 st;
// attribute vec4 color;
// attribute float batchId;
// varying vec3 v_positionEC;
// varying vec3 v_normalEC;
// varying vec2 v_st;
// varying vec4 v_color;
// void main()
// {
//     // vtxf 使用double类型的position进行计算
//     // vec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);
//     // v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates
//     // v_normalEC = czm_normal * normal;                         // normal in eye coordinates
//     // v_st = st;
//     // gl_Position = czm_modelViewProjectionRelativeToEye * p;
//     v_positionEC = (czm_modelView * vec4(position, 1.0)).xyz;       // position in eye coordinates
//     v_normalEC = czm_normal * normal;                               // normal in eye coordinates
//     v_st = st;
//     v_color = color;
//     gl_Position = czm_modelViewProjection * vec4(position, 1.0);
// }
// `;

// var vtxfFragmentShader =
// `
// varying vec3 v_positionEC;
// varying vec3 v_normalEC;
// varying vec2 v_st;
// varying vec4 v_color;
// uniform sampler2D u_image;
// uniform vec4 u_color;
// void main()
// {
//     vec3 positionToEyeEC = -v_positionEC;
//     vec3 normalEC = normalize(v_normalEC);
// #ifdef FACE_FORWARD
//     normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);
// #endif

//     czm_materialInput materialInput;
//     materialInput.normalEC = normalEC;
//     materialInput.positionToEyeEC = positionToEyeEC;
//     materialInput.st = v_st;
//     //czm_material material = czm_getMaterial(materialInput);
//     czm_material material = czm_getDefaultMaterial(materialInput);
//     vec4 imageColor = texture2D(u_image, materialInput.st);

//     material.diffuse = imageColor.rgb;
//     material.alpha = imageColor.a;

//     material.diffuse *= v_color.rgb;
//     material.alpha *= v_color.a;

//     material.diffuse *= u_color.rgb;
//     material.alpha *= u_color.a;

// #ifdef FLAT
//     gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);
// #else
//     gl_FragColor = czm_phong(normalize(positionToEyeEC), material);
// #endif
// }
// `;   

var vtxfVertexShader = '\n// vtxf \u4F7F\u7528double\u7C7B\u578B\u7684position\u8FDB\u884C\u8BA1\u7B97\n// attribute vec3 position3DHigh;\n// attribute vec3 position3DLow;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 st;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nvoid main()\n{\n    v_positionEC = (czm_modelView * vec4(position, 1.0)).xyz;       // position in eye coordinates\n    v_normalEC = czm_normal * normal;                               // normal in eye coordinates\n    v_st = st;\n    v_color = color;\n    gl_Position = czm_modelViewProjection * vec4(position, 1.0);\n}\n';

var vtxfFragmentShader = '\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    vec3 normalEC = normalize(v_normalEC);\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n\n    vec4 imageColor = texture2D(u_image, fract(v_st));\n\n    vec3 diffuse = imageColor.rgb;\n    float alpha = imageColor.a;\n\n    diffuse *= v_color.rgb;\n    alpha *= v_color.a;\n\n    diffuse *= u_color.rgb;\n    alpha *= u_color.a;\n\n    gl_FragColor = vec4(diffuse, alpha);\n}\n';

var attributeLocations = {
    position: 0,
    normal: 1,
    textureCoordinates: 2
};

var defaultOptions = void 0;

function getRenderState(translucent, closed) {
    var rs = {
        depthTest: {
            enabled: true
        }
    };

    if (translucent) {
        rs.depthMask = false;
        rs.blending = Cesium.BlendingState.ALPHA_BLEND;
    }

    if (closed) {
        rs.cull = {
            enabled: true,
            face: Cesium.CullFace.BACK
        };
    }

    return rs;
};

function createVertexArray(context, positions, normals, sts, colors, indices, primitiveType) {
    positions = new Float32Array(positions);

    var normalAttribute = !!normals ? new Cesium.GeometryAttribute({
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 3,
        values: new Float32Array(normals)
    }) : {
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 3,
        normalize: false,
        value: [0, 0, 1]
    };

    var colorAttribute = !!colors ? new Cesium.GeometryAttribute({
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 4,
        values: new Float32Array(colors)
    }) : {
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 4,
        normalize: false,
        value: [1, 1, 1, 1]
    };

    var textureCoordinate = !!sts ? new Cesium.GeometryAttribute({
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 2,
        values: new Float32Array(sts)
    }) : {
        componentDatatype: Cesium.ComponentDatatype.FLOAT,
        componentsPerAttribute: 2,
        normalize: false,
        value: [1, 1]
    };

    var geometry = new Cesium.Geometry({
        attributes: {
            position: new Cesium.GeometryAttribute({
                // vtxf 使用double类型的position进行计算
                // componentDatatype : Cesium.ComponentDatatype.DOUBLE,
                componentDatatype: Cesium.ComponentDatatype.FLOAT,
                componentsPerAttribute: 3,
                values: positions
            }),
            normal: normalAttribute,
            textureCoordinates: textureCoordinate,
            color: colorAttribute
        },
        indices: new Uint16Array(indices),
        primitiveType: primitiveType,
        boundingSphere: Cesium.BoundingSphere.fromVertices(positions)
    });

    var vertexArray = Cesium.VertexArray.fromGeometry({
        context: context,
        geometry: geometry,
        attributeLocations: attributeLocations,
        bufferUsage: Cesium.BufferUsage.STATIC_DRAW
        // interleave : true
    });

    return vertexArray;
};

function getBS(positions, modelMatrix, bs) {
    var l = positions.length / 3 | 0;
    var min = [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY];
    var max = [Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];
    for (var i = 0; i < l; ++i) {
        for (var j = 0; j < 3; ++j) {
            min[j] = positions[i * 3 + j] > min[j] ? min[j] : positions[i * 3 + j];
            max[j] = positions[i * 3 + j] < max[j] ? max[j] : positions[i * 3 + j];
        }
    }

    var center = min.map(function (v, i) {
        return (v + max[i]) * 0.5;
    });
    center.map(function (v) {
        return (0, _isFinite2.default)(v) ? v : 0.0;
    });

    // let diameter = Math.max(...min.map((v, i) => max[i] - v));
    var diameter = Math.sqrt(min.map(function (v, i) {
        return max[i] - v;
    }).reduce(function (p, v) {
        return v * v + p;
    }, 0));
    diameter = (0, _isFinite2.default)(diameter) ? diameter : 0.0;

    if (!bs) {
        var _Cesium$Cartesian;

        bs = new Cesium.BoundingSphere((_Cesium$Cartesian = Cesium.Cartesian3).fromElements.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(center)), diameter * 0.5);
    } else {
        var _Cesium$Cartesian2;

        (_Cesium$Cartesian2 = Cesium.Cartesian3).fromElements.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(center).concat([bs.center]));
        bs.radius = diameter * 0.5;
    }
    Cesium.BoundingSphere.transform(bs, modelMatrix, bs);

    return bs;
}

function createCommand(context, primitive, options) {
    var vertexShaderSource = new Cesium.ShaderSource({
        sources: [options.vertexShaderSource]
    });

    // const fragmentShaderSource = new Cesium.ShaderSource({
    //     sources: [options.fragmentShaderSource]
    // });
    var fs = options.fragmentShaderSource;
    fs = 'uniform vec4 czm_pickColor;\n' + fs;
    var fragmentShaderSource = new Cesium.ShaderSource({
        sources: [fs]
    });

    var shaderProgram = Cesium.ShaderProgram.fromCache({
        context: context,
        vertexShaderSource: vertexShaderSource,
        fragmentShaderSource: fragmentShaderSource,
        attributeLocations: attributeLocations
    });

    var ONE = new Cesium.Cartesian4(1, 1, 1, 1);
    var uniformMap = {
        u_image: function u_image() {
            return primitive.texture || context.defaultTexture;
        },
        u_color: function u_color() {
            return primitive._color || ONE;
        },
        u_customParams: function u_customParams() {
            return primitive._customParams || ONE;
        },
        czm_pickColor: function czm_pickColor() {
            return primitive._pickId.color || ONE;
        }
    };

    var renderState = Cesium.RenderState.fromCache(options.renderState);

    try {
        var vertexArray = createVertexArray(context, options.positions, options.normals, options.sts, options.colors, options.indices, options.primitiveType);

        return new Cesium.DrawCommand({
            vertexArray: vertexArray,
            primitiveType: options.primitiveType,
            renderState: renderState,
            shaderProgram: shaderProgram,
            uniformMap: uniformMap,
            owner: this,
            pass: options.pass,
            modelMatrix: options.modelMatrix

        });
    } catch (error) {
        return undefined;
    }
}

var originCesiumDrawCommandShallowClone = void 0;
function fixDrawCommand() {
    // fixCesium
    // DrawCommand拷贝时，考虑一下execute函数的拷贝，这样截取执行操作时确保执行到正确的executeCommand方法
    if (!originCesiumDrawCommandShallowClone) {
        originCesiumDrawCommandShallowClone = originCesiumDrawCommandShallowClone || Cesium.DrawCommand.shallowClone;
        Cesium.DrawCommand.shallowClone = function (command, result) {
            result = originCesiumDrawCommandShallowClone.call(this, command, result);
            if (command.execute !== Cesium.DrawCommand.prototype.execute) {
                result.execute = command.execute;
            }

            return result;
        };
    }
}

var XbsjCustomPrimitive = function () {
    function XbsjCustomPrimitive(options) {
        (0, _classCallCheck3.default)(this, XbsjCustomPrimitive);

        fixDrawCommand();
        this.show = true;
        this._command = undefined;
        this._modelMatrix = new Cesium.Matrix4();
        this._bs = new Cesium.BoundingSphere();

        if (!options.modelMatrix) {
            Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY, this._modelMatrix);
        } else {
            Cesium.Matrix4.clone(options.modelMatrix, this._modelMatrix);
        }

        defaultOptions = defaultOptions || {
            positions: [0, 0, 0, 1, 0, 0, 0, 0.5, 0],
            normals: [0, 0, 1, 0, 0, 1, 0, 0, 1],
            sts: [0, 0, 1, 0, 0, 1],
            colors: [1, 0, 0, 1, 0, 1, 0, 1, 0, 0, 1, 1],
            indices: [0, 1, 2],
            vertexShaderSource: vtxfVertexShader,
            fragmentShaderSource: vtxfFragmentShader,
            pass: Cesium.Pass.OPAQUE,
            primitiveType: Cesium.PrimitiveType.TRIANGLES,
            modelMatrix: this._modelMatrix,
            renderState: {},
            texture: undefined,
            color: [1, 1, 1, 1],
            customParams: [0, 0, 0, 0]
        };

        this._options = (0, _assign2.default)({}, defaultOptions, options);
        this._texture = this._options.texture;
        // this._color = new Cesium.Color(...this._options.color);
        this._color = new (Function.prototype.bind.apply(Cesium.Cartesian4, [null].concat((0, _toConsumableArray3.default)(this._options.color))))();
        this._customParams = new (Function.prototype.bind.apply(Cesium.Cartesian4, [null].concat((0, _toConsumableArray3.default)(this._options.customParams))))();

        this._bs = getBS(options.positions, this._modelMatrix, this._bs);

        this._owner = options.owner;

        this._drawCallback = undefined;
    }

    (0, _createClass3.default)(XbsjCustomPrimitive, [{
        key: 'setDrawCallback',
        value: function setDrawCallback(drawCallback) {
            this._drawCallback = drawCallback;
        }
    }, {
        key: 'update',
        value: function update(frameState) {
            if (!this.show) {
                return;
            }
            if (!Cesium.defined(this._command)) {
                this._command = createCommand(frameState.context, this, this._options);

                {
                    // 用来进行选然后回调
                    var primitive = this;
                    this._command.execute = function () {
                        var _Cesium$DrawCommand$p;

                        for (var _len = arguments.length, params = Array(_len), _key = 0; _key < _len; _key++) {
                            params[_key] = arguments[_key];
                        }

                        (_Cesium$DrawCommand$p = Cesium.DrawCommand.prototype.execute).call.apply(_Cesium$DrawCommand$p, [this].concat(params));
                        primitive._drawCallback && primitive._drawCallback.apply(primitive, [primitive].concat(params));
                    };
                }

                {
                    this._pickId = this._pickId && this._pickId.destroy();
                    this._pickId = frameState.context.createPickId({
                        primitive: this,
                        id: this._owner
                    });
                    // 这种方式，可能因为shader会共用，导致设置的颜色不起作用。
                    // this._command.pickId = 'vec4' + this._pickId.color.toString();
                    // 所以干脆给一个固定值！
                    this._command.pickId = 'czm_pickColor';
                }

                this._command.boundingVolume = this._bs;
            }
            if (Cesium.defined(this._command)) {
                frameState.commandList.push(this._command);
            }
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (Cesium.defined(this._command)) {
                this._command.shaderProgram = this._command.shaderProgram && this._command.shaderProgram.destroy();
                this._command.vertexArray = this._command.vertexArray && this._command.vertexArray.destroy();
            }

            this._pickId = this._pickId && this._pickId.destroy();
            return Cesium.destroyObject(this);
        }
    }, {
        key: 'texture',
        get: function get() {
            return this._texture;
        },
        set: function set(val) {
            this._texture = val;
        }
    }, {
        key: 'color',
        get: function get() {
            var c = this._color;
            return [c.x, c.y, c.z, c.w];
        },
        set: function set(val) {
            Cesium.Cartesian4.fromArray(val, 0, this._color);
        }
    }, {
        key: 'customParams',
        get: function get() {
            var c = this._customParams;
            return [c.x, c.y, c.z, c.w];
        },
        set: function set(val) {
            Cesium.Cartesian4.fromArray(val, 0, this._customParams);
        }
    }, {
        key: 'modelMatrix',
        get: function get() {
            return this._modelMatrix;
        },
        set: function set(val) {
            Cesium.Matrix4.clone(val, this._modelMatrix);
            this._bs = getBS(this._options.positions, this._modelMatrix, this._bs);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._bs;
        }
    }]);
    return XbsjCustomPrimitive;
}();

XbsjCustomPrimitive.createTextureFromImage = createTextureFromImage;
XbsjCustomPrimitive.getRenderState = getRenderState;
XbsjCustomPrimitive.defaultVertexShader = vtxfVertexShader;
XbsjCustomPrimitive.defaultFragmentShader = vtxfFragmentShader;

exports.default = XbsjCustomPrimitive;

/***/ }),
/* 323 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(324), __esModule: true };

/***/ }),
/* 324 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(325);
module.exports = __webpack_require__(14).Number.isFinite;


/***/ }),
/* 325 */
/***/ (function(module, exports, __webpack_require__) {

// 20.1.2.2 Number.isFinite(number)
var $export = __webpack_require__(16);
var _isFinite = __webpack_require__(17).isFinite;

$export($export.S, 'Number', {
  isFinite: function isFinite(it) {
    return typeof it == 'number' && _isFinite(it);
  }
});


/***/ }),
/* 326 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _createGroundRectangle = __webpack_require__(81);

var _createGroundRectangle2 = _interopRequireDefault(_createGroundRectangle);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    position: [0, 0, 0],
    origin: [0.5, 0.5],
    rotation: 0,
    width: 1000,
    height: 1000,
    canvasWidth: 512,
    canvasHeight: 512,
    show: true,
    color: [1, 1, 1, 1],
    imageUrl: ''
};

/**
 * 自定义贴地矩形
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var CustomGroundRectangle = function (_XbsjCzmObj) {
    (0, _inherits3.default)(CustomGroundRectangle, _XbsjCzmObj);

    function CustomGroundRectangle(earth, guid) {
        (0, _classCallCheck3.default)(this, CustomGroundRectangle);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CustomGroundRectangle.__proto__ || (0, _getPrototypeOf2.default)(CustomGroundRectangle)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));
        // this.disposers.push(registerPositionEditing(this._earth, this));                
        // this.disposers.push(registerRotationEditing(this._earth, this));      

        (0, _mobx.extendObservable)(_this, {
            _texture: undefined,
            _groundPrimitive: undefined
        }, {
            _texture: _mobx.observable.ref,
            _groundPrimitive: _mobx.observable.ref
        });

        _this.disposers.push(function () {
            if (_this._groundPrimitive) {
                earth.czm.scene.groundPrimitives.remove(_this._groundPrimitive);
                _this._groundPrimitive = undefined;
            }
            if (_this._texture) {
                _this._texture = _this._texture && _this._texture.destroy();
            }
        });

        var updateTexture = function updateTexture() {
            _this._texture = _this._texture && _this._texture.destroy();
            var texture = new Cesium.Texture({
                context: earth.czm.scene.context,
                width: _this.canvasWidth,
                height: _this.canvasHeight,
                flipY: true
            });

            _this._texture = texture;
        };
        updateTexture();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                width: _this.canvasWidth,
                height: _this.canvasHeight
            };
        }, updateTexture));

        // texture变了，需要重新赋值
        var updateTexture2 = function updateTexture2() {
            var texture = _this._texture;
            _this._groundPrimitive && (_this._groundPrimitive.appearance.material.uniforms.image = texture);
        };
        updateTexture2();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                _texture: _this._texture
            };
        }, updateTexture2));

        var updateCanvas = function updateCanvas() {
            if (!_this._canvas) {
                var canvas = document.createElement('canvas');
                _this._canvas = canvas;
                _this._ctx = canvas.getContext('2d');
            }

            _this._canvas.width = _this.canvasWidth;
            _this._canvas.height = _this.canvasHeight;
        };
        updateCanvas();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                canvasWidth: _this.canvasWidth,
                canvasHeight: _this.canvasHeight
            };
        }, updateCanvas));

        _this._scratchColor = new Cesium.Color();
        var updateGroundPrimitive = function updateGroundPrimitive() {
            if (_this._groundPrimitive) {
                earth.czm.scene.groundPrimitives.remove(_this._groundPrimitive);
                _this._groundPrimitive = undefined;
            }

            var classificationType = Cesium.ClassificationType.BOTH;
            // const minHeight = 0;
            // const maxHeight = 0;
            var image = undefined;
            var color = undefined;
            // const groundPrimitive = Cesium.createXbsjGroundPrimitive(center, this.width, this.height, this.rotation, image, color, minHeight, maxHeight, classificationType);
            var groundPrimitive = (0, _createGroundRectangle2.default)(_this.position, _this.width, _this.height, _this.origin[0], _this.origin[1], _this.rotation, image, color, classificationType);

            _this._texture && (groundPrimitive.appearance.material.uniforms.image = _this._texture);

            ['red', 'green', 'blue', 'alpha'].forEach(function (v, i) {
                return _this._scratchColor[v] = _this.color[i];
            });
            groundPrimitive.appearance.material.uniforms.color = _this._scratchColor;

            _this._groundPrimitive = earth.czm.scene.groundPrimitives.add(groundPrimitive);
        };

        updateGroundPrimitive();

        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                origin: [].concat((0, _toConsumableArray3.default)(_this.origin)),
                rotation: _this.rotation,
                width: _this.width,
                height: _this.height,
                color: [].concat((0, _toConsumableArray3.default)(_this.color))
            };
        }, updateGroundPrimitive));

        // 修复贴地面不停地更新时，不能隐藏
        var updateGroundPrimitive2 = function updateGroundPrimitive2() {
            _this._groundPrimitive && (_this._groundPrimitive.show = _this.show);
        };

        updateGroundPrimitive2();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                show: _this.show,
                _groundPrimitive: _this._groundPrimitive
            };
        }, updateGroundPrimitive2));

        // 这种方式没法处理crossOrigin的情况，换成Cesium的加载方式，Cesium内部会处理好Image图像的加载
        // const updateImage = () => {
        //     if (this.imageUrl) {
        //         this._myImage = this._myImage || new Image();
        //         this._myImage.src = this.imageUrl;
        //         this._myImage.onload = () => {
        //             this.canvasWidth = this._myImage.naturalWidth;
        //             this.canvasHeight = this._myImage.naturalHeight;
        //             this.drawCanvas(ctx => {
        //                 ctx.clearRect(0, 0, this._myImage.naturalWidth, this._myImage.naturalHeight);
        //                 ctx.drawImage(this._myImage, 0, 0);
        //             });
        //         }
        //     }
        // };
        var updateImage = function updateImage() {
            if (_this._imageSubscription) {
                _this._imageSubscription.unsubscribe();
                _this._imageSubscription = undefined;
            }

            if (_this.imageUrl) {
                var _observable = new rxjs.Observable(function (observer) {
                    Cesium.Resource.createIfNeeded(_this.imageUrl).fetchImage().then(function (image) {
                        observer.next(image);
                    });
                });

                _this._imageSubscription = _observable.subscribe(function (image) {
                    _this.canvasWidth = image.naturalWidth;
                    _this.canvasHeight = image.naturalHeight;
                    _this.drawCanvas(function (ctx) {
                        ctx.clearRect(0, 0, image.naturalWidth, image.naturalHeight);
                        ctx.drawImage(image, 0, 0);
                    });
                    _this._innerImage = image;
                });
            }
        };

        updateImage();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.imageUrl;
        }, updateImage));
        return _this;
    }

    (0, _createClass3.default)(CustomGroundRectangle, [{
        key: 'drawCanvas',
        value: function drawCanvas(drawFun) {
            if (this.canvasWidth > 0 && this.canvasHeight > 0) {
                drawFun(this._ctx);
                this._texture.copyFrom(this._canvas);
            } else {
                console.warn('canvas尺寸未设置，无法绘制！');
            }
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            var radius = Math.sqrt(this.width * this.width + this.height * this.height);
            this._earth.camera.flyTo(this.position, radius * 3.0);
        }
    }]);
    return CustomGroundRectangle;
}(_XbsjCzmObj3.default);

var xbsjSchema = {
    title: "CustomGroundRectangle Property",
    type: "object",
    properties: {
        /**
         * 位置数组 [经度、纬度、高度] <br/>
         * @type {array}
         * @instance
         * @default [0, 0, 0]
         * @memberof Obj.CustomGroundRectangle
         */
        position: { type: 'array', items: { type: 'number' }, minItems: 3, maxItems: 3, default: [0.0, 0.0, 0.0], description: '位置（经度, 纬度, 高度）' },
        /**
         * 原点在纹理上的位置，旋转的中心点
         * @type {array}
         * @instance
         * @default [0.5, 0.5]
         * @memberof Obj.CustomGroundRectangle
         */
        origin: { type: 'array', items: { type: 'number' }, minItems: 2, maxItems: 2, default: [0.5, 0.5], description: '原点在纹理上的位置，旋转的中心点' },
        /**
         * 偏航角
         * @type {number}
         * @instance
         * @default 0
         * @memberof Obj.CustomGroundRectangle
         */
        rotation: { type: 'number', title: '偏航角', default: 0, description: '偏航角' },
        /**
         * 宽度，单位米
         * @type {number}
         * @instance
         * @default 1000
         * @memberof Obj.CustomGroundRectangle
         */
        width: { type: 'number', title: '宽度，单位米', default: 1000, description: '宽度，单位米' },
        /**
         * 高度，单位米
         * @type {number}
         * @instance
         * @default 1000
         * @memberof Obj.CustomGroundRectangle
         */
        height: { type: 'number', title: '高度，单位米', default: 1000, description: '高度，单位米' },
        /**
         * 画布宽度，单位像素
         * @type {number}
         * @instance
         * @default 512
         * @memberof Obj.CustomGroundRectangle
         */
        canvasWidth: { type: 'number', title: '画布宽度，单位像素', default: 512, description: '画布宽度，单位像素' },
        /**
         * 画布高度，单位像素
         * @type {number}
         * @instance
         * @default 512
         * @memberof Obj.CustomGroundRectangle
         */
        canvasHeight: { type: 'number', title: '画布高度，单位像素', default: 512, description: '画布高度，单位像素' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.CustomGroundRectangle
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 颜色叠加
         * @type {array}
         * @instance
         * @default [1, 1, 1, 1]
         * @memberof Obj.CustomGroundRectangle
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加' },
        /**
         * 纹理对应的图像url <br/>
         * 警告：一旦imageUrl有值，会导致drawCanvas调用失效！因此使用imageUrl之后，就不要再调用drawCanvas了！<br/>
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.CustomPrimitive
         */
        imageUrl: { type: 'string', title: '纹理对应的图像url', default: 0, description: '纹理对应的图像url' }
    }
};

CustomGroundRectangle.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['position', 'origin', 'rotation', 'width', 'height', 'canvasWidth', 'canvasHeight', 'show', 'color']
}];

CustomGroundRectangle.xbsjClassification = xbsjClassification;

CustomGroundRectangle.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(CustomGroundRectangle, 'CustomGroundRectangle');

exports.default = CustomGroundRectangle;

/***/ }),
/* 327 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _kriging = __webpack_require__(328);

var _kriging2 = _interopRequireDefault(_kriging);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var g_ctx = void 0;

/**
 * 获得调色板
 * @param {Array} gradient 颜色表，形式如: [[0, 'green'], [0.2, 'blue'], [0.6, 'yellow'], [1.0, 'red']]
 * @param {Uint8ClampedArray} result 必须含有256个元素 
 */
function getColorPalette(gradient, result) {
    if (result) {
        if (!result instanceof Uint8ClampedArray) {
            throw new Error('result类型不对！');
        }

        if (result.length !== 256 * 4) {
            throw new Error('result的数组长度不对，必须为256！');
        }
    }

    if (!g_ctx) {
        var paletteCanvas = document.createElement('canvas');
        var paletteCtx = paletteCanvas.getContext('2d');
        paletteCanvas.width = 256;
        paletteCanvas.height = 1;
        g_ctx = paletteCtx;
    }

    var lg = g_ctx.createLinearGradient(0, 0, 256, 1);
    gradient.forEach(function (e) {
        lg.addColorStop(e[0], e[1]);
    });

    g_ctx.clearRect(0, 0, 256, 1);
    g_ctx.fillStyle = lg;
    g_ctx.fillRect(0, 0, 256, 1);

    var data = g_ctx.getImageData(0, 0, 256, 1).data;

    if (!result) {
        result = new Uint8ClampedArray(data);
    } else {
        data.forEach(function (e, i) {
            return result[i] = e;
        });
    }

    return result;
};

function getColorFromColorPalette(ratio, palette, result) {
    // const value = element.value < min ? min : (element.value > max ? max : element.value);
    // const offset = (255 * (value - min) / (max - min)) | 0; // 256会导致1.0的值错误
    var min = 0,
        max = 1;

    ratio = ratio < min ? min : ratio > max ? max : ratio;
    var offset = 255 * ratio | 0;

    var red = palette[offset * 4];
    var green = palette[offset * 4 + 1];
    var blue = palette[offset * 4 + 2];
    var alpha = palette[offset * 4 + 3];

    if (!result) {
        result = [255, 255, 255, 255];
    }

    result[0] = red;
    result[1] = green;
    result[2] = blue;
    result[3] = alpha;

    return result;
}

var setImageDataFunc = void 0;

/**
 * 热力图
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var HeatMap = function (_XbsjCzmObj) {
    (0, _inherits3.default)(HeatMap, _XbsjCzmObj);

    function HeatMap(earth, guid) {
        (0, _classCallCheck3.default)(this, HeatMap);

        var _this = (0, _possibleConstructorReturn3.default)(this, (HeatMap.__proto__ || (0, _getPrototypeOf2.default)(HeatMap)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _XbsjBase2.default.registerPosition(_this);
        // 检测位置编辑状态 // positionEditing
        _this.disposers.push((0, _registerInteractionProperty.registerPositionEditing)(_this._earth, _this, {
            positionEditingProperty: 'editing'
        }));
        _this.disposers.push((0, _registerInteractionProperty.registerPositionPicking)(_this._earth, _this, {
            positionPickingProperty: 'creating'
        }));

        _this._customGroundRectangle = new XE.Obj.CustomGroundRectangle(earth);
        _this.disposers.push((0, _track2.default)(_this._customGroundRectangle, 'show', _this, 'show'));
        _this.disposers.push(function () {
            _this._customGroundRectangle = _this._customGroundRectangle && _this._customGroundRectangle.destroy();
        });

        var updateGroundRectangle = function updateGroundRectangle() {
            var cgr = _this._customGroundRectangle;
            cgr.position = _this.position;
            cgr.width = _this.width;
            cgr.height = _this.height;

            if (cgr.canvasWidth !== _this.dataWidth || cgr.canvasHeight !== _this.dataHeight) {
                cgr.canvasWidth = _this.dataWidth;
                cgr.canvasHeight = _this.dataHeight;
                cgr.drawCanvas(function (ctx) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, _this.dataWidth, _this.dataHeight);
                });
            }
        };
        updateGroundRectangle();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                position: [].concat((0, _toConsumableArray3.default)(_this.position)),
                width: _this.width,
                height: _this.height,
                dataWidth: _this.dataWidth,
                dataHeight: _this.dataHeight
            };
        }, updateGroundRectangle));

        _this._imageData = undefined;
        _this._colorPalette = new Uint8ClampedArray(256 * 4);
        _this._colorPalette.fill(255);
        _this.disposers.push(function () {
            _this._imageData = undefined;
            _this._colorPalette = undefined;
        });

        var updateColorPalette = function updateColorPalette() {
            getColorPalette(_this.gradient, _this._colorPalette);
        };
        updateColorPalette();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                gradient: [].concat((0, _toConsumableArray3.default)(_this.gradient))
            };
        }, updateColorPalette));
        return _this;
    }

    /**
     * 设置网格数据 <br/>
     * gridData[0] 西北角 <br/>
     * gridData[dataWidth-1] 东北角 <br/>
     * gridData[(dataHeight-1)*dataWidth] 西南角 <br/>
     * gridData[dataHeight*dataWidth-1] 东南角 <br/>
     * @param {number[]} gridData 网格数据数组，数组长度为width*height
     */

    (0, _createClass3.default)(HeatMap, [{
        key: 'setGridData',
        value: function setGridData(gridData) {
            var _this2 = this;

            var data = gridData;
            if (data && data.length && data.length === this.dataWidth * this.dataHeight) {
                if (!this._imageData || this._imageData.width !== this.dataWidth || this._imageData.height !== this.dataHeight) {
                    this._imageData = new ImageData(this.dataWidth, this.dataHeight);
                }

                var valueRange = this.maxValue - this.minValue;
                var color = [255, 255, 255, 255];
                var dataHeight = this.dataHeight;
                var dataWidth = this.dataWidth;
                var imageData = this._imageData.data;
                var minValue = this.minValue;
                var colorPalette = this._colorPalette;

                // 为了性能提升，用eval的方式来替代
                // valueRange
                // getColorFromColorPalette
                // for (let j=0; j<dataHeight; ++j) {
                //     for (let i=0; i<dataWidth; ++i) {
                //         const v = data[j*dataWidth+i];
                //         const ratio = (v - minValue) / valueRange;
                //         const c = getColorFromColorPalette(ratio, colorPalette, color);
                //         if (c) {
                //              const offset = (j*dataWidth+i) * 4;
                //              imageData[offset + 0] = c[0];
                //              imageData[offset + 1] = c[1];
                //              imageData[offset + 2] = c[2];
                //              imageData[offset + 3] = c[3];
                //         }
                //     }
                // }
                if (!setImageDataFunc) {
                    var evalString = '\n                    for (let j=0; j<dataHeight; ++j) {\n                        for (let i=0; i<dataWidth; ++i) {\n                            const v = data[j*dataWidth+i];\n                            const ratio = (v - minValue) / valueRange;\n                            const c = getColorFromColorPalette(ratio, colorPalette, color);\n                            if (c) {\n                                const offset = (j*dataWidth+i) * 4;\n                                imageData[offset + 0] = c[0];\n                                imageData[offset + 1] = c[1];\n                                imageData[offset + 2] = c[2];\n                                imageData[offset + 3] = c[3];\n                            }\n                        }\n                    }\n                ';
                    var evalWrapString = '\n                    "use strict";\n                    return (function(data, valueRange, color, dataHeight, dataWidth, imageData, minValue, colorPalette, getColorFromColorPalette){\n                        ' + evalString + '\n                    });\n                ';
                    setImageDataFunc = Function(evalWrapString)();
                }
                setImageDataFunc(data, valueRange, color, dataHeight, dataWidth, imageData, minValue, colorPalette, getColorFromColorPalette);

                var cgr = this._customGroundRectangle;
                cgr.canvasWidth = this.dataWidth;
                cgr.canvasHeight = this.dataHeight;
                cgr.drawCanvas(function (ctx) {
                    // 是否有必要？
                    // ctx.clearRect(0, 0, this.dataWidth, this.dataHeight);
                    ctx.putImageData(_this2._imageData, 0, 0);
                });
            } else {
                // const cgr = this._customGroundRectangle;
                // cgr.drawCanvas(ctx => {
                //     ctx.fillStyle = 'white';
                //     ctx.fillRect(0, 0, this.dataWidth, this.dataHeight);
                // });

                var _cgr = this._customGroundRectangle;
                _cgr.canvasWidth = this.dataWidth;
                _cgr.canvasHeight = this.dataHeight;
                _cgr.drawCanvas(function (ctx) {
                    ctx.fillStyle = 'white';
                    ctx.fillRect(0, 0, _this2.dataWidth, _this2.dataHeight);
                });
            }
        }

        /**
         * 从外部canvas拷贝图像数据
         * @param {Canvas} canvas 外部canvas
         */

    }, {
        key: 'copyfromOtherCanvas',
        value: function copyfromOtherCanvas(canvas) {
            if (canvas.width !== this.dataWidth || canvas.height !== this.dataHeight) {
                console.warn('请确保canvas尺寸一致！');
                return;
            }
            this._customGroundRectangle && this._customGroundRectangle._texture && this._customGroundRectangle._texture.copyFrom(canvas);
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.camera.flyTo(this.position, this.width, [0, -Math.PI / 3, 0]);
        }
    }]);
    return HeatMap;
}(_XbsjCzmObj3.default);

/**
 * 通过克里金插值算法绘制热力图
 * @param {object} posValues 形式如[[x, y, v], [], ...]  x在0-width范围之内，y在0-height范围之内，v必须大于0
 * @param {number} width 宽度
 * @param {number} height 高度
 * @param {object} krigingOptions 
 * @returns {number[] | undefined} 返回结果，如果为undefined，说明计算出错！
 * @static
 * @memberof Obj.HeatMap
 * @example
 * var gridData = new Array(100*100);
 * gridData.fill(0);
 * const posValues = [[10, 10, 100], [10, 90, 500], [90, 10, 300], [90, 90, 1000]];
 * var gridData = XE.Obj.HeatMap.getGridDataFromKriging(posValues, 100, 100, gridData);
 */

function getGridDataFromKriging(posValues, width, height, resultGridData) {
    var _ref = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : {},
        _ref$model = _ref.model,
        model = _ref$model === undefined ? "exponential" : _ref$model,
        _ref$sigma = _ref.sigma2,
        sigma2 = _ref$sigma === undefined ? 0 : _ref$sigma,
        _ref$alpha = _ref.alpha,
        alpha = _ref$alpha === undefined ? 100 : _ref$alpha;

    var gridData = resultGridData;

    try {
        // TODO(vtxf): posValues 需要去重，否则克里金插值可能报错
        var values = [];
        var xs = [];
        var ys = [];
        posValues.forEach(function (e) {
            xs.push(e[0]);
            ys.push(e[1]);
            values.push(e[2]);
        });

        var variogram = _kriging2.default.train(values, xs, ys, model, sigma2, alpha);

        for (var i = 0; i < width; ++i) {
            for (var j = 0; j < height; ++j) {
                gridData[j * width + i] = _kriging2.default.predict(i, j, variogram);
                if (!isFinite(gridData[j * width + i])) {
                    throw new Error('克里金插值计算出错！');
                }
            }
        }

        return gridData;
    } catch (error) {
        console.warn('error: ' + error);
        return undefined;
    }
}

/**
 * 网格数据插值
 * @param {*} ratio 0-1之间
 * @param {*} gridData0 第一个gridData数据
 * @param {*} gridData1 第二个gridData数据
 * @param {*} length 数组长度
 * @param {*} resultData 结果数据
 * @returns {number[] | undefined} 返回结果，如果为undefined，说明插值出错！
 * @static
 * @memberof Obj.HeatMap
 * @example
 * var d0 = [10, 20, 30, 40]
 * var d1 = [20, 30, 40, 50];
 * var r = new Array(4); r.fill(0);
 * r = XE.Obj.HeatMap.interpolateGridData(0.4, d0, d1, 4, r);
 */
function interpolateGridData(ratio, gridData0, gridData1, length, resultData) {
    try {
        if (!resultData) {
            return undefined;
        }

        for (var i = 0; i < length; ++i) {
            resultData[i] = gridData0[i] * (1.0 - ratio) + gridData1[i] * ratio;
        }

        return resultData;
    } catch (error) {
        return undefined;
    }
}

HeatMap.getGridDataFromKriging = getGridDataFromKriging;
HeatMap.interpolateGridData = interpolateGridData;

HeatMap.defaultOptions = {
    /**
     * @description 位置数组 [经度、纬度、高度]
     * @type {array}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.HeatMap
     */
    position: [0, 0, 0],
    /**
     * 宽度
     * @type {number}
     * @instance
     * @default 100
     * @memberof Obj.HeatMap
     */
    width: 100,
    /**
     * 高度
     * @type {number}
     * @instance
     * @default 100
     * @memberof Obj.HeatMap
     */
    height: 100,
    /**
     * @description 原点
     * @type {array}
     * @instance
     * @default [0.5, 0.5]
     * @memberof Obj.HeatMap
     */
    origin: [0.5, 0.5],
    /**
     * @description 旋转角
     * @type {number}
     * @instance
     * @default 0
     * @memberof Obj.HeatMap
     */
    rotation: 0.0,
    /**
     * 显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.HeatMap
     */
    show: true,
    /**
     * 调色板，形式如 [[x, y], [x1, y1], ...] x为数字，0-1之间；y表示颜色的字符串形式
     * @type {array}
     * @instance
     * @default [[0, 'green'], [0.2, 'blue'], [0.6, 'yellow'], [1.0, 'red']]
     * @memberof Obj.HeatMap
     * @example
     * xxx.gradient = [[0, 'green'], [0.2, 'blue'], [0.6, 'yellow'], [1.0, 'red']];
     */
    gradient: [[0, 'green'], [0.2, 'blue'], [0.6, 'yellow'], [1.0, 'red']],
    /**
     * 网格数据最小值
     * @type {number}
     * @instance
     * @default 0
     * @memberof Obj.HeatMap
     */
    minValue: 0,
    /**
     * 网格数据最大值
     * @type {number}
     * @instance
     * @default 1
     * @memberof Obj.HeatMap
     */
    maxValue: 1,
    /**
     * 网格数据宽度
     * @type {number}
     * @instance
     * @default 100
     * @memberof Obj.HeatMap
     */
    dataWidth: 100,
    /**
     * 网格数据高度
     * @type {number}
     * @instance
     * @default 100
     * @memberof Obj.HeatMap
     */
    dataHeight: 100
};

_XbsjObject2.default.registerType(HeatMap, 'HeatMap');

exports.default = HeatMap;

/***/ }),
/* 328 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
	value: true
});
// Extend the Array class
Array.prototype.max = function () {
	return Math.max.apply(null, this);
};
Array.prototype.min = function () {
	return Math.min.apply(null, this);
};
Array.prototype.mean = function () {
	var i, sum;
	for (i = 0, sum = 0; i < this.length; i++) {
		sum += this[i];
	}return sum / this.length;
};
Array.prototype.rep = function (n) {
	return Array.apply(null, new Array(n)).map(Number.prototype.valueOf, this[0]);
};
Array.prototype.pip = function (x, y) {
	var i,
	    j,
	    c = false;
	for (i = 0, j = this.length - 1; i < this.length; j = i++) {
		if (this[i][1] > y != this[j][1] > y && x < (this[j][0] - this[i][0]) * (y - this[i][1]) / (this[j][1] - this[i][1]) + this[i][0]) {
			c = !c;
		}
	}
	return c;
};

var kriging = function () {
	var kriging = {};

	// Matrix algebra
	var kriging_matrix_diag = function kriging_matrix_diag(c, n) {
		var i,
		    Z = [0].rep(n * n);
		for (i = 0; i < n; i++) {
			Z[i * n + i] = c;
		}return Z;
	};
	var kriging_matrix_transpose = function kriging_matrix_transpose(X, n, m) {
		var i,
		    j,
		    Z = Array(m * n);
		for (i = 0; i < n; i++) {
			for (j = 0; j < m; j++) {
				Z[j * n + i] = X[i * m + j];
			}
		}return Z;
	};
	var kriging_matrix_scale = function kriging_matrix_scale(X, c, n, m) {
		var i, j;
		for (i = 0; i < n; i++) {
			for (j = 0; j < m; j++) {
				X[i * m + j] *= c;
			}
		}
	};
	var kriging_matrix_add = function kriging_matrix_add(X, Y, n, m) {
		var i,
		    j,
		    Z = Array(n * m);
		for (i = 0; i < n; i++) {
			for (j = 0; j < m; j++) {
				Z[i * m + j] = X[i * m + j] + Y[i * m + j];
			}
		}return Z;
	};
	// Naive matrix multiplication
	var kriging_matrix_multiply = function kriging_matrix_multiply(X, Y, n, m, p) {
		var i,
		    j,
		    k,
		    Z = Array(n * p);
		for (i = 0; i < n; i++) {
			for (j = 0; j < p; j++) {
				Z[i * p + j] = 0;
				for (k = 0; k < m; k++) {
					Z[i * p + j] += X[i * m + k] * Y[k * p + j];
				}
			}
		}
		return Z;
	};
	// Cholesky decomposition
	var kriging_matrix_chol = function kriging_matrix_chol(X, n) {
		var i,
		    j,
		    k,
		    sum,
		    p = Array(n);
		for (i = 0; i < n; i++) {
			p[i] = X[i * n + i];
		}for (i = 0; i < n; i++) {
			for (j = 0; j < i; j++) {
				p[i] -= X[i * n + j] * X[i * n + j];
			}if (p[i] <= 0) return false;
			p[i] = Math.sqrt(p[i]);
			for (j = i + 1; j < n; j++) {
				for (k = 0; k < i; k++) {
					X[j * n + i] -= X[j * n + k] * X[i * n + k];
				}X[j * n + i] /= p[i];
			}
		}
		for (i = 0; i < n; i++) {
			X[i * n + i] = p[i];
		}return true;
	};
	// Inversion of cholesky decomposition
	var kriging_matrix_chol2inv = function kriging_matrix_chol2inv(X, n) {
		var i, j, k, sum;
		for (i = 0; i < n; i++) {
			X[i * n + i] = 1 / X[i * n + i];
			for (j = i + 1; j < n; j++) {
				sum = 0;
				for (k = i; k < j; k++) {
					sum -= X[j * n + k] * X[k * n + i];
				}X[j * n + i] = sum / X[j * n + j];
			}
		}
		for (i = 0; i < n; i++) {
			for (j = i + 1; j < n; j++) {
				X[i * n + j] = 0;
			}
		}for (i = 0; i < n; i++) {
			X[i * n + i] *= X[i * n + i];
			for (k = i + 1; k < n; k++) {
				X[i * n + i] += X[k * n + i] * X[k * n + i];
			}for (j = i + 1; j < n; j++) {
				for (k = j; k < n; k++) {
					X[i * n + j] += X[k * n + i] * X[k * n + j];
				}
			}
		}
		for (i = 0; i < n; i++) {
			for (j = 0; j < i; j++) {
				X[i * n + j] = X[j * n + i];
			}
		}
	};
	// Inversion via gauss-jordan elimination
	var kriging_matrix_solve = function kriging_matrix_solve(X, n) {
		var m = n;
		var b = Array(n * n);
		var indxc = Array(n);
		var indxr = Array(n);
		var ipiv = Array(n);
		var i, icol, irow, j, k, l, ll;
		var big, dum, pivinv, temp;

		for (i = 0; i < n; i++) {
			for (j = 0; j < n; j++) {
				if (i == j) b[i * n + j] = 1;else b[i * n + j] = 0;
			}
		}for (j = 0; j < n; j++) {
			ipiv[j] = 0;
		}for (i = 0; i < n; i++) {
			big = 0;
			for (j = 0; j < n; j++) {
				if (ipiv[j] != 1) {
					for (k = 0; k < n; k++) {
						if (ipiv[k] == 0) {
							if (Math.abs(X[j * n + k]) >= big) {
								big = Math.abs(X[j * n + k]);
								irow = j;
								icol = k;
							}
						}
					}
				}
			}
			++ipiv[icol];

			if (irow != icol) {
				for (l = 0; l < n; l++) {
					temp = X[irow * n + l];
					X[irow * n + l] = X[icol * n + l];
					X[icol * n + l] = temp;
				}
				for (l = 0; l < m; l++) {
					temp = b[irow * n + l];
					b[irow * n + l] = b[icol * n + l];
					b[icol * n + l] = temp;
				}
			}
			indxr[i] = irow;
			indxc[i] = icol;

			if (X[icol * n + icol] == 0) return false; // Singular

			pivinv = 1 / X[icol * n + icol];
			X[icol * n + icol] = 1;
			for (l = 0; l < n; l++) {
				X[icol * n + l] *= pivinv;
			}for (l = 0; l < m; l++) {
				b[icol * n + l] *= pivinv;
			}for (ll = 0; ll < n; ll++) {
				if (ll != icol) {
					dum = X[ll * n + icol];
					X[ll * n + icol] = 0;
					for (l = 0; l < n; l++) {
						X[ll * n + l] -= X[icol * n + l] * dum;
					}for (l = 0; l < m; l++) {
						b[ll * n + l] -= b[icol * n + l] * dum;
					}
				}
			}
		}
		for (l = n - 1; l >= 0; l--) {
			if (indxr[l] != indxc[l]) {
				for (k = 0; k < n; k++) {
					temp = X[k * n + indxr[l]];
					X[k * n + indxr[l]] = X[k * n + indxc[l]];
					X[k * n + indxc[l]] = temp;
				}
			}
		}return true;
	};

	// Variogram models
	var kriging_variogram_gaussian = function kriging_variogram_gaussian(h, nugget, range, sill, A) {
		return nugget + (sill - nugget) / range * (1.0 - Math.exp(-(1.0 / A) * Math.pow(h / range, 2)));
	};
	var kriging_variogram_exponential = function kriging_variogram_exponential(h, nugget, range, sill, A) {
		return nugget + (sill - nugget) / range * (1.0 - Math.exp(-(1.0 / A) * (h / range)));
	};
	var kriging_variogram_spherical = function kriging_variogram_spherical(h, nugget, range, sill, A) {
		if (h > range) return nugget + (sill - nugget) / range;
		return nugget + (sill - nugget) / range * (1.5 * (h / range) - 0.5 * Math.pow(h / range, 3));
	};

	// Train using gaussian processes with bayesian priors
	kriging.train = function (t, x, y, model, sigma2, alpha) {
		var variogram = {
			t: t,
			x: x,
			y: y,
			nugget: 0.0,
			range: 0.0,
			sill: 0.0,
			A: 1 / 3,
			n: 0
		};
		switch (model) {
			case "gaussian":
				variogram.model = kriging_variogram_gaussian;
				break;
			case "exponential":
				variogram.model = kriging_variogram_exponential;
				break;
			case "spherical":
				variogram.model = kriging_variogram_spherical;
				break;
		};

		// Lag distance/semivariance
		var i,
		    j,
		    k,
		    l,
		    n = t.length;
		var distance = Array((n * n - n) / 2);
		for (i = 0, k = 0; i < n; i++) {
			for (j = 0; j < i; j++, k++) {
				distance[k] = Array(2);
				distance[k][0] = Math.pow(Math.pow(x[i] - x[j], 2) + Math.pow(y[i] - y[j], 2), 0.5);
				distance[k][1] = Math.abs(t[i] - t[j]);
			}
		}distance.sort(function (a, b) {
			return a[0] - b[0];
		});
		variogram.range = distance[(n * n - n) / 2 - 1][0];

		// Bin lag distance
		var lags = (n * n - n) / 2 > 30 ? 30 : (n * n - n) / 2;
		var tolerance = variogram.range / lags;
		var lag = [0].rep(lags);
		var semi = [0].rep(lags);
		if (lags < 30) {
			for (l = 0; l < lags; l++) {
				lag[l] = distance[l][0];
				semi[l] = distance[l][1];
			}
		} else {
			for (i = 0, j = 0, k = 0, l = 0; i < lags && j < (n * n - n) / 2; i++, k = 0) {
				while (distance[j][0] <= (i + 1) * tolerance) {
					lag[l] += distance[j][0];
					semi[l] += distance[j][1];
					j++;k++;
					if (j >= (n * n - n) / 2) break;
				}
				if (k > 0) {
					lag[l] /= k;
					semi[l] /= k;
					l++;
				}
			}
			if (l < 2) return variogram; // Error: Not enough points
		}

		// Feature transformation
		n = l;
		variogram.range = lag[n - 1] - lag[0];
		var X = [1].rep(2 * n);
		var Y = Array(n);
		var A = variogram.A;
		for (i = 0; i < n; i++) {
			switch (model) {
				case "gaussian":
					X[i * 2 + 1] = 1.0 - Math.exp(-(1.0 / A) * Math.pow(lag[i] / variogram.range, 2));
					break;
				case "exponential":
					X[i * 2 + 1] = 1.0 - Math.exp(-(1.0 / A) * lag[i] / variogram.range);
					break;
				case "spherical":
					X[i * 2 + 1] = 1.5 * (lag[i] / variogram.range) - 0.5 * Math.pow(lag[i] / variogram.range, 3);
					break;
			};
			Y[i] = semi[i];
		}

		// Least squares
		var Xt = kriging_matrix_transpose(X, n, 2);
		var Z = kriging_matrix_multiply(Xt, X, 2, n, 2);
		Z = kriging_matrix_add(Z, kriging_matrix_diag(1 / alpha, 2), 2, 2);
		var cloneZ = Z.slice(0);
		if (kriging_matrix_chol(Z, 2)) kriging_matrix_chol2inv(Z, 2);else {
			kriging_matrix_solve(cloneZ, 2);
			Z = cloneZ;
		}
		var W = kriging_matrix_multiply(kriging_matrix_multiply(Z, Xt, 2, 2, n), Y, 2, n, 1);

		// Variogram parameters
		variogram.nugget = W[0];
		variogram.sill = W[1] * variogram.range + variogram.nugget;
		variogram.n = x.length;

		// Gram matrix with prior
		n = x.length;
		var K = Array(n * n);
		for (i = 0; i < n; i++) {
			for (j = 0; j < i; j++) {
				K[i * n + j] = variogram.model(Math.pow(Math.pow(x[i] - x[j], 2) + Math.pow(y[i] - y[j], 2), 0.5), variogram.nugget, variogram.range, variogram.sill, variogram.A);
				K[j * n + i] = K[i * n + j];
			}
			K[i * n + i] = variogram.model(0, variogram.nugget, variogram.range, variogram.sill, variogram.A);
		}

		// Inverse penalized Gram matrix projected to target vector
		var C = kriging_matrix_add(K, kriging_matrix_diag(sigma2, n), n, n);
		var cloneC = C.slice(0);
		if (kriging_matrix_chol(C, n)) kriging_matrix_chol2inv(C, n);else {
			kriging_matrix_solve(cloneC, n);
			C = cloneC;
		}

		// Copy unprojected inverted matrix as K
		var K = C.slice(0);
		var M = kriging_matrix_multiply(C, t, n, n, 1);
		variogram.K = K;
		variogram.M = M;

		return variogram;
	};

	// Model prediction
	kriging.predict = function (x, y, variogram) {
		var i,
		    k = Array(variogram.n);
		for (i = 0; i < variogram.n; i++) {
			k[i] = variogram.model(Math.pow(Math.pow(x - variogram.x[i], 2) + Math.pow(y - variogram.y[i], 2), 0.5), variogram.nugget, variogram.range, variogram.sill, variogram.A);
		}return kriging_matrix_multiply(k, variogram.M, 1, variogram.n, 1)[0];
	};
	kriging.variance = function (x, y, variogram) {
		var i,
		    k = Array(variogram.n);
		for (i = 0; i < variogram.n; i++) {
			k[i] = variogram.model(Math.pow(Math.pow(x - variogram.x[i], 2) + Math.pow(y - variogram.y[i], 2), 0.5), variogram.nugget, variogram.range, variogram.sill, variogram.A);
		}return variogram.model(0, variogram.nugget, variogram.range, variogram.sill, variogram.A) + kriging_matrix_multiply(kriging_matrix_multiply(k, variogram.K, 1, variogram.n, variogram.n), k, 1, variogram.n, 1)[0];
	};

	// Gridded matrices or contour paths
	kriging.grid = function (polygons, variogram, width) {
		var i,
		    j,
		    k,
		    n = polygons.length;
		if (n == 0) return;

		// Boundaries of polygons space
		var xlim = [polygons[0][0][0], polygons[0][0][0]];
		var ylim = [polygons[0][0][1], polygons[0][0][1]];
		for (i = 0; i < n; i++) {
			// Polygons
			for (j = 0; j < polygons[i].length; j++) {
				// Vertices
				if (polygons[i][j][0] < xlim[0]) xlim[0] = polygons[i][j][0];
				if (polygons[i][j][0] > xlim[1]) xlim[1] = polygons[i][j][0];
				if (polygons[i][j][1] < ylim[0]) ylim[0] = polygons[i][j][1];
				if (polygons[i][j][1] > ylim[1]) ylim[1] = polygons[i][j][1];
			}
		} // Alloc for O(n^2) space
		var xtarget, ytarget;
		var a = Array(2),
		    b = Array(2);
		var lxlim = Array(2); // Local dimensions
		var lylim = Array(2); // Local dimensions
		var x = Math.ceil((xlim[1] - xlim[0]) / width);
		var y = Math.ceil((ylim[1] - ylim[0]) / width);

		var A = Array(x + 1);
		for (i = 0; i <= x; i++) {
			A[i] = Array(y + 1);
		}for (i = 0; i < n; i++) {
			// Range for polygons[i]
			lxlim[0] = polygons[i][0][0];
			lxlim[1] = lxlim[0];
			lylim[0] = polygons[i][0][1];
			lylim[1] = lylim[0];
			for (j = 1; j < polygons[i].length; j++) {
				// Vertices
				if (polygons[i][j][0] < lxlim[0]) lxlim[0] = polygons[i][j][0];
				if (polygons[i][j][0] > lxlim[1]) lxlim[1] = polygons[i][j][0];
				if (polygons[i][j][1] < lylim[0]) lylim[0] = polygons[i][j][1];
				if (polygons[i][j][1] > lylim[1]) lylim[1] = polygons[i][j][1];
			}

			// Loop through polygon subspace
			a[0] = Math.floor((lxlim[0] - (lxlim[0] - xlim[0]) % width - xlim[0]) / width);
			a[1] = Math.ceil((lxlim[1] - (lxlim[1] - xlim[1]) % width - xlim[0]) / width);
			b[0] = Math.floor((lylim[0] - (lylim[0] - ylim[0]) % width - ylim[0]) / width);
			b[1] = Math.ceil((lylim[1] - (lylim[1] - ylim[1]) % width - ylim[0]) / width);
			for (j = a[0]; j <= a[1]; j++) {
				for (k = b[0]; k <= b[1]; k++) {
					xtarget = xlim[0] + j * width;
					ytarget = ylim[0] + k * width;
					if (polygons[i].pip(xtarget, ytarget)) A[j][k] = kriging.predict(xtarget, ytarget, variogram);
				}
			}
		}
		A.xlim = xlim;
		A.ylim = ylim;
		A.zlim = [variogram.t.min(), variogram.t.max()];
		A.width = width;
		return A;
	};
	kriging.contour = function (value, polygons, variogram) {};

	// Plotting on the DOM
	kriging.plot = function (canvas, grid, xlim, ylim, colors) {
		// Clear screen 
		var ctx = canvas.getContext("2d");
		ctx.clearRect(0, 0, canvas.width, canvas.height);

		// Starting boundaries
		var range = [xlim[1] - xlim[0], ylim[1] - ylim[0], grid.zlim[1] - grid.zlim[0]];
		var i, j, x, y, z;
		var n = grid.length;
		var m = grid[0].length;
		var wx = Math.ceil(grid.width * canvas.width / (xlim[1] - xlim[0]));
		var wy = Math.ceil(grid.width * canvas.height / (ylim[1] - ylim[0]));
		for (i = 0; i < n; i++) {
			for (j = 0; j < m; j++) {
				if (grid[i][j] == undefined) continue;
				x = canvas.width * (i * grid.width + grid.xlim[0] - xlim[0]) / range[0];
				y = canvas.height * (1 - (j * grid.width + grid.ylim[0] - ylim[0]) / range[1]);
				z = (grid[i][j] - grid.zlim[0]) / range[2];
				if (z < 0.0) z = 0.0;
				if (z > 1.0) z = 1.0;

				ctx.fillStyle = colors[Math.floor((colors.length - 1) * z)];
				ctx.fillRect(Math.round(x - wx / 2), Math.round(y - wy / 2), wx, wy);
			}
		}
	};

	return kriging;
}();

exports.default = kriging;

/***/ }),
/* 329 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _createGroundRectangle = __webpack_require__(81);

var _createGroundRectangle2 = _interopRequireDefault(_createGroundRectangle);

var _registerInteractionProperty = __webpack_require__(15);

var _fixCesiumResouce = __webpack_require__(330);

var _fixCesiumResouce2 = _interopRequireDefault(_fixCesiumResouce);

var _Tileset = __webpack_require__(91);

var _Tileset2 = _interopRequireDefault(_Tileset);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

//import TreeMeta from './TreeMeta'; // 用不上，数组可以任意写。。

function createTreeType(name, baseUrl, metaConfig) {
    var center = metaConfig.center,
        size = metaConfig.size,
        lod0Pixel = metaConfig.lod0Pixel;

    var currentPixel = lod0Pixel;
    var lods = metaConfig.lod.map(function (e) {
        var pair = [currentPixel, baseUrl + e.url];
        currentPixel *= 2.0;
        return pair;
    });

    return {
        name: name,
        center: center,
        size: size,
        lods: lods
    };
}

function getTreeMetaObservable(metaUrl) {
    var fetch$ = new rxjs.Observable(function (observer) {
        try {
            Cesium.Resource.fetchJson(metaUrl).then(function (data) {
                observer.next(data);
                observer.complete();
            }).otherwise(function (error) {
                // 没有获取数据也不要报错！
                // observer.error(error);
                observer.next(undefined);
                observer.complete();
            });
        } catch (error) {
            console.warn('catch \u83B7\u53D6\u6570\u636E\u51FA\u9519: fetchJson(metaUrl) ' + error);
            observer.next(undefined);
            observer.complete();
        }
    });

    return fetch$;
}

function createRandomKey() {
    // http://stackoverflow.com/questions/105034/how-to-create-a-guid-uuid-in-javascript
    return 'xxxxxxxx'.replace(/[xy]/g, function (c) {
        var r = Math.random() * 16 | 0;
        var v = c === 'x' ? r : r & 0x3 | 0x8;
        return v.toString(16);
    });
}

/**
 * 用于动态创建林区
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var Forest = function (_XbsjCzmObj) {
    (0, _inherits3.default)(Forest, _XbsjCzmObj);

    function Forest(earth, guid) {
        (0, _classCallCheck3.default)(this, Forest);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Forest.__proto__ || (0, _getPrototypeOf2.default)(Forest)).call(this, earth, guid));

        _this._treeData = [];
        _this._treeTypes = [];
        // extendObservable(this, {
        //     _treeData: [],
        //     _treeTypes: [],
        // }, {
        //     _treeData: observable.ref,
        //     // _treeTypes: observable.ref,
        // });

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        (0, _fixCesiumResouce2.default)();

        _this._tileset = new _Tileset2.default(earth);
        _this.disposers.push(function () {
            _this._tileset = _this._tileset && _this._tileset.destroy();
        });

        _this._tgid = undefined;
        _this.disposers.push(function () {
            window.xbsjTreeGeneratorManager.destroyGenerator(_this._tgid);
            _this._tgid = undefined;
        });

        _this._recreatingTreeTileset = undefined;
        _this.disposers.push(function () {
            if (_this._recreatingTreeTileset) {
                _this._recreatingTreeTileset.unsubscribe();
            }
        });

        // this._recreateTreeTilesetDelay();
        // this.disposers.push(reaction(() => ({
        //     treeData: JSON.stringify(this._treeData),
        //     _treeTypes: JSON.stringify(this._treeTypes)
        // }), () => this._recreateTreeTilesetDelay()));

        // const updateTreeData = () => {
        //     if (this.treeData && this.treeData.length > 0) {
        //         this._treeData = JSON.parse(JSON.stringify(this.treeData));
        //     }
        // };
        // updateTreeData();
        // this.disposers.push(reaction(() => JSON.stringify(this.treeData), updateTreeData));

        _this._loadingTreeMeta = undefined;
        _this.disposers.push(function () {
            if (_this._loadingTreeMeta) {
                _this._loadingTreeMeta.unsubscribe();
                _this._loadingTreeMeta = undefined;
            }
        });

        _this._loadTreeMeta(_this.treeMetas);
        _this.disposers.push((0, _mobx.reaction)(function () {
            return (0, _stringify2.default)(_this.treeMetas);
        }, function () {
            _this._loadTreeMeta(_this.treeMetas);
        }));

        _this._loadingTreeData = undefined;
        _this.disposers.push(function () {
            if (_this._loadingTreeData) {
                _this._loadingTreeData.unsubscribe();
                _this._loadingTreeData = undefined;
            }
        });

        _this._loadTreeData(_this.treeDataUrl);
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.treeDataUrl;
        }, function () {
            _this._loadTreeData(_this.treeDataUrl);
        }));

        var updateShow = function updateShow() {
            _this._tileset.show = _this.show;
        };
        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.show;
        }, updateShow));
        return _this;
    }

    (0, _createClass3.default)(Forest, [{
        key: 'flyTo',
        value: function flyTo() {
            this._tileset.flyTo();
        }
    }, {
        key: 'reload',
        value: function reload() {
            this._loadTreeData(this.treeDataUrl);
        }
    }, {
        key: 'recreate',
        value: function recreate() {
            this._recreateTreeTilesetDelay();
        }
    }, {
        key: 'getTreeData',
        value: function getTreeData() {
            return this._treeData;
        }
    }, {
        key: 'getTreeTypes',
        value: function getTreeTypes() {
            return this._treeTypes;
        }
    }, {
        key: '_recreateTreeTilesetDelay',
        value: function _recreateTreeTilesetDelay() {
            var _this2 = this;

            if (this._recreatingTreeTileset) {
                this._recreatingTreeTileset.unsubscribe();
            }
            this._recreatingTreeTileset = rxjs.timer(3000).subscribe(function () {
                return _this2._recreateTreeTileset();
            }, undefined, this._recreatingTreeTileset = undefined);
        }
    }, {
        key: '_recreateTreeTileset',
        value: function _recreateTreeTileset() {
            if (this._treeTypes && this._treeTypes.length > 0 && this._treeData && this._treeData.length > 0) {
                this._tgid = this._tgid && window.xbsjTreeGeneratorManager.destroyGenerator(this._tgid);
                this._tgid = window.xbsjTreeGeneratorManager.createGenerator(this._treeData, this._treeTypes);
                this._tileset.url = 'https://xbsjtree.cn/' + this._tgid + '/tileset.json';
            }
        }
    }, {
        key: '_loadTreeMeta',
        value: function _loadTreeMeta(metas) {
            var _this3 = this;

            if (this._loadingTreeMeta) {
                this._loadingTreeMeta.unsubscribe();
                this._loadingTreeMeta = undefined;
            }

            if (!metas || metas.length === 0) {
                return;
            }

            var indexAndMetaUrls = metas.map(function (m, i) {
                return { metaUrl: m.url, index: i };
            });
            var concurrent = 6;

            this._loadingTreeMeta = rxjs.from(indexAndMetaUrls).pipe(rxjs.operators.mergeMap(function (indexAndMetaUrl) {
                // debugger;
                var metaUrl = indexAndMetaUrl.metaUrl,
                    index = indexAndMetaUrl.index;

                return getTreeMetaObservable(metaUrl).pipe(rxjs.operators.map(function (metaData) {
                    return {
                        metaData: metaData,
                        metaUrl: metaUrl,
                        index: index
                    };
                }));
            }, undefined, concurrent), rxjs.operators.toArray(), rxjs.operators.map(function (results) {
                // debugger;
                if (results.some(function (e) {
                    return e.metaData !== undefined;
                })) {
                    var treeTypes = new Array(results.length);

                    results.forEach(function (r) {
                        var metaUrl = r.metaUrl,
                            metaData = r.metaData,
                            index = r.index;

                        var idx = metaUrl.lastIndexOf("?");
                        idx = idx === -1 ? undefined : idx;
                        var metaUrlBase = metaUrl.substring(0, idx);
                        if (metaUrlBase.endsWith('meta.json')) {
                            var baseUrl = metaUrlBase.substring(0, metaUrlBase.lastIndexOf('meta.json'));
                            var treeType = createTreeType('anonymous', baseUrl, metaData);
                            treeTypes[index] = treeType;
                        }
                    });

                    _this3._treeTypes = treeTypes;
                    _this3._recreateTreeTilesetDelay();
                }
            })).subscribe(undefined, function (error) {
                console.error('treeMeta error! ' + error);
                _this3._loadingTreeMeta = undefined;
            }, function () {
                _this3._loadingTreeMeta = undefined;
            });

            // this._loadingTreeMeta = fetch$.subscribe(treeMeta => {
            //     if (metaUrl.endsWith('meta.json')) {
            //         const baseUrl = metaUrl.substring(0, metaUrl.lastIndexOf('meta.json'));
            //         const treeType = createTreeType('anonymous', baseUrl, treeMeta)
            //         this._treeTypes = [treeType];
            //         this._recreateTreeTilesetDelay();
            //     }
            // }, error => {
            //     console.error('treeMeta error! ' + error);
            //     this._loadingTreeMeta = undefined;
            // }, () => {
            //     this._loadingTreeMeta = undefined;
            // });
        }
    }, {
        key: '_loadTreeData',
        value: function _loadTreeData(dataUrl) {
            var _this4 = this;

            if (this._loadingTreeData) {
                this._loadingTreeData.unsubscribe();
                this._loadingTreeData = undefined;
            }

            if (!dataUrl) {
                return;
            }

            var preStr = dataUrl.lastIndexOf('?') === -1 ? '?' : '&';
            var postStr = createRandomKey();
            var addedSearchStr = preStr + postStr;

            var fetch$ = new rxjs.Observable(function (observer) {
                Cesium.Resource.fetchJson(dataUrl + addedSearchStr).then(function (data) {
                    observer.next(data);
                    observer.complete();
                }).otherwise(function (error) {
                    observer.error(error);
                });
            });

            this._loadingTreeData = fetch$.subscribe(function (treeData) {
                _this4._treeData = treeData;
                _this4._recreateTreeTilesetDelay();
            }, function (error) {
                console.error('treeData error! ' + error);
                _this4._loadingTreeData = undefined;
            }, function () {
                _this4._loadingTreeData = undefined;
            });
        }
    }]);
    return Forest;
}(_XbsjCzmObj3.default);

Forest.testRandomTreeData = function () {
    var treeNum = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 500;
    var basePos = arguments[1];
    var width = arguments[2];
    var height = arguments[3];

    var tr = Math.PI / 180.0;
    basePos = basePos || [116.390 * tr, 39.9 * tr, 0.0];

    width = width || (Math.sqrt(treeNum) | 0) * 3.0;
    height = height || (Math.sqrt(treeNum) | 0) * 3.0;

    var rwidth = width / (Math.cos(basePos[1]) * 6378137);
    var rheight = height / 6378137;

    var treeData = [];
    {
        for (var i = 0; i < treeNum; ++i) {
            var s = Math.random() * 0.3 + 0.7;
            var tdi = {
                // position: [(116.390 + 0.01 * Math.random())*tr, (39.90 + 0.01 * Math.random())*tr, 1.0 * Math.random()],
                position: [basePos[0] + rwidth * Math.random(), basePos[1] + rheight * Math.random(), 1.0 * Math.random()],
                rotation: [Math.random() * Math.PI, 0, 0],
                // rotation: [Math.PI * 0.5, 0, 0],
                // rotation: [0, 0, 0],
                scale: [s, s, s],
                id: 'id' + i,
                type: 0
            };
            treeData.push(tdi);
        }
    }

    return treeData;
};

Forest.defaultOptions = {
    treeDataUrl: '',
    // treeData: [],
    treeMetas: [],
    show: true
};

var xbsjSchema = {
    title: "Forest Property",
    type: "object",
    properties: {
        /**
         * 显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.Forest
         */
        show: { type: "boolean", title: "显示", default: true, description: '显示' },
        /**
         * @description 点位信息url
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.Forest
         */
        treeDataUrl: { type: "string", title: "点位信息url", default: '', description: '点位信息url' },
        /**
         * @description 实例类型url集合
         * @type {Obj.Forest.TreeMeta[]}
         * @instance
         * @default []
         * @memberof Obj.Forest
         */
        treeMetas: { type: "array", items: { type: 'Obj.Forest.TreeMeta' }, minItems: 0, title: "实例类型url集合", default: [], description: '实例类型url集合' }
    }
};

Forest.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'treeDataUrl', 'treeMetas']
}];

Forest.xbsjClassification = xbsjClassification;

_XbsjObject2.default.registerType(Forest, 'Forest');

exports.default = Forest;

/***/ }),
/* 330 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _TreeGeneratorManager = __webpack_require__(331);

var _TreeGeneratorManager2 = _interopRequireDefault(_TreeGeneratorManager);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function fixCesiumResouce() {
    if (window.xbsjTreeGeneratorManager) {
        return;
    }

    var treeGeneratorManager = new _TreeGeneratorManager2.default();
    window.xbsjTreeGeneratorManager = treeGeneratorManager;

    var originFetchJson = Cesium.Resource.prototype.fetchJson;
    var originFetchArrayBuffer = Cesium.Resource.prototype.fetchArrayBuffer;

    Cesium.Resource.prototype.fetchJson = function () {
        if (this.url.startsWith('https://xbsjtree.cn/')) {
            var gid = this.url.substring(20, 20 + 36);
            // 20+36 是 /
            var contentUrl = this.url.substring(20 + 36 + 1);
            var generator = treeGeneratorManager.getGenerator(gid);
            if (generator) {
                var result = generator(contentUrl);
                // debugger;
                return Cesium.when.resolve(result);
            }
        } else {
            for (var _len = arguments.length, args = Array(_len), _key = 0; _key < _len; _key++) {
                args[_key] = arguments[_key];
            }

            return originFetchJson.call.apply(originFetchJson, [this].concat(args));
        }
    };

    Cesium.Resource.prototype.fetchArrayBuffer = function () {
        // if (this.url.startsWith('https://xbsjtree.cn/') && !this.url.endsWith('.json')) {
        if (this.url.startsWith('https://xbsjtree.cn/')) {
            var gid = this.url.substring(20, 20 + 36);
            // 20+36 是 /
            var contentUrl = this.url.substring(20 + 36 + 1);
            var generator = treeGeneratorManager.getGenerator(gid);
            if (generator) {
                var result = generator(contentUrl);
                // debugger;

                // tile块的json数据也会从这里走，需要把json转成buffer传递出去
                if (!(result instanceof ArrayBuffer)) {
                    var str = (0, _stringify2.default)(result);
                    result = new TextEncoder().encode(str);
                }

                return Cesium.when.resolve(result);
            }
        } else {
            for (var _len2 = arguments.length, args = Array(_len2), _key2 = 0; _key2 < _len2; _key2++) {
                args[_key2] = arguments[_key2];
            }

            return originFetchArrayBuffer.call.apply(originFetchArrayBuffer, [this].concat(args));
        }
    };
}

exports.default = fixCesiumResouce;

/***/ }),
/* 331 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _createTreeType = __webpack_require__(332);

var _createTreeType2 = _interopRequireDefault(_createTreeType);

var _createTreeTilesetGenerator = __webpack_require__(333);

var _createTreeTilesetGenerator2 = _interopRequireDefault(_createTreeTilesetGenerator);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var TreeGeneratorManager = function () {
    function TreeGeneratorManager() {
        (0, _classCallCheck3.default)(this, TreeGeneratorManager);

        this._generators = {};
    }

    (0, _createClass3.default)(TreeGeneratorManager, [{
        key: 'createGenerator',
        value: function createGenerator(treeData, treeTypes) {
            //const tr = Math.PI/180.0;
            // const treeData = [];
            // {
            //     const treeNum = 5000;
            //     for (let i=0; i<treeNum; ++i) {
            //         const s = Math.random() * 0.3 + 0.7;
            //         const tdi = {
            //             position: [(116.390 + 0.01 * Math.random())*tr, (39.90 + 0.01 * Math.random())*tr, 1.0 * Math.random()],
            //             rotation: [Math.random() * Math.PI, 0, 0],
            //             // rotation: [Math.PI * 0.5, 0, 0],
            //             // rotation: [0, 0, 0],
            //             scale: [s, s, s],
            //             id: `id${i}`,
            //             type: 0,
            //         };
            //         treeData.push(tdi);
            //     }
            // }
            var tilesetGenerator = (0, _createTreeTilesetGenerator2.default)(treeData, treeTypes);

            var gid = Cesium.createGuid();
            this._generators[gid] = tilesetGenerator;

            return gid;
        }
    }, {
        key: 'getGenerator',
        value: function getGenerator(gid) {
            return this._generators[gid];
        }
    }, {
        key: 'destroyGenerator',
        value: function destroyGenerator(gid) {
            delete this._generators[gid];
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._generators = undefined;
        }
    }]);
    return TreeGeneratorManager;
}();

exports.default = TreeGeneratorManager;

/***/ }),
/* 332 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
function createTreeType(name, baseUrl, metaConfig) {
    var center = metaConfig.center,
        size = metaConfig.size,
        lod0Pixel = metaConfig.lod0Pixel;

    var currentPixel = lod0Pixel;
    var lods = metaConfig.lod.map(function (e) {
        var pair = [currentPixel, baseUrl + e.url];
        currentPixel *= 2.0;
        return pair;
    });

    return {
        name: name,
        center: center,
        size: size,
        lods: lods
    };
}

exports.default = createTreeType;

/***/ }),
/* 333 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _initializeTreeData = __webpack_require__(334);

var _initializeTreeData2 = _interopRequireDefault(_initializeTreeData);

var _createBlocks = __webpack_require__(337);

var _createBlocks2 = _interopRequireDefault(_createBlocks);

var _fillBlocks = __webpack_require__(338);

var _fillBlocks2 = _interopRequireDefault(_fillBlocks);

var _createCmptFromBlock = __webpack_require__(339);

var _createCmptFromBlock2 = _interopRequireDefault(_createCmptFromBlock);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function getContent(contentUrl, tilesetGeneratorInfo) {
    // 生成cmpt
    var treeData = tilesetGeneratorInfo.treeData;
    var treeTypes = tilesetGeneratorInfo.treeTypes;

    if (contentUrl.endsWith('.cmpt')) {
        if (tilesetGeneratorInfo.cmptMaps.has(contentUrl)) {
            // 测试用
            // tilesetGeneratorInfo.cmptMaps.forEach((v, k, m) => {
            //     const contentUri = k;
            //     createCmptFromBlock(v.block, treeData, treeTypes, v.geometricError);
            // });
            try {
                var v = tilesetGeneratorInfo.cmptMaps.get(contentUrl);
                var cmptBuffer = (0, _createCmptFromBlock2.default)(v.block, treeData, treeTypes, v.geometricError);
                return cmptBuffer;
            } catch (error) {
                console.warn('createCmptFromBlock error!');
                return undefined;
            }
        }
    } else if (contentUrl === 'tileset.json') {
        return tilesetGeneratorInfo.tilesetJSON;
    } else if (contentUrl === 'root.json') {
        return tilesetGeneratorInfo.rootJSON;
    } else {
        return undefined;
    }
}

// 参数做成一个json配置文件
// {
//     treeData: [
//         positions: [], // 点位 [经度，纬度，高度，经度，纬度，高度，...] (经纬度以弧度表示；高度即海拔高度，单位是米)，必须是3的倍数
//         cartesians: [], // 可选，方便使用 Cesium.Cartesian类型数组
//         ids: ['abc', 'dewef', 'dsfdfa'], // id是字符串？
//         types: [0, 0, 0, ...], // type类型是字符串？
//     ],
//     treeTypes: [
//         {
//             name: 'yangshu1912',
//             lods: [
//                 [1, "rgba(255, 0, 255, 1.0)"], // [geometricError, color]
//                 [5, "xxx/yyy/zzz.gltf"], // [geometricError, uri]
//             ],
//             center: [0, 0, 0],
//             size: [3, 3, 7],
//         },
//     ]
// }

// treeData改造
// {
//     treeData: [
//         {
//             position: [], // 经纬度高度，经纬度是弧度单位，高度单位是米，3个元素
//             localPosition: [], // 本地坐标 后期补充
//             rotation: [], // heading/pitch/roll
//             scale: [], // x/y/z
//             id: undefined, // 可选
//             type: 0, // type为对应treeTypes中的索引
//         },
//         {
//             ...
//         },
//         ...
//     ]
// }

// 测试用
// import writeBufferOrJson from './writeBufferOrJson';

function createTreeTilesetGenerator(treeData, treeTypes) {
    var treeDataModelMatrix = (0, _initializeTreeData2.default)(treeData, treeTypes);

    // 创建的这个block的minmax并不是tree的实际包围盒，另外，还没有和相应的树的ge对应上
    var rootBlock = (0, _createBlocks2.default)(treeData, treeTypes);
    var tilesetGeneratorInfo = (0, _fillBlocks2.default)(rootBlock, treeData, treeTypes, treeDataModelMatrix);

    var tilesetGenerator = function tilesetGenerator(contentUrl) {
        return getContent(contentUrl, tilesetGeneratorInfo);
    };

    // {
    //     // 测试
    //     writeBufferOrJson('tileset.json', getContent('tileset.json', tilesetGeneratorInfo));
    //     writeBufferOrJson('root.json', getContent('root.json', tilesetGeneratorInfo));
    //     tilesetGeneratorInfo.cmptMaps.forEach((v, k, m) => {
    //         const content = getContent(k, tilesetGeneratorInfo);
    //         writeBufferOrJson(k, content);
    //     });
    // }

    return tilesetGenerator;
}

exports.default = createTreeTilesetGenerator;

/***/ }),
/* 334 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getMinMax = __webpack_require__(84);

var scratchCartesian = void 0;

// 这个treeData只能展现平面上的树，不考虑地球弯曲；如果需要考虑地球弯曲（面积过大），可以将几个treeData再往上合并
// 弯曲的临界值，假定为1度，在地球上相当于60海里，约等于100公里，即100公里范围内的树木可以不考虑弯曲
// 那么以下函数的使用范围就限定在100公里以内
// 100公里范围内的树木，如果统一坐标，浮点范围6-7位，差不多能覆盖
// import * as Cesium from 'cesium';
function initializeTreeData(treeData, treeTypes) {
    // {
    //     const positions = treeData.positions;
    //     const [min, max] = getMinMaxPosition(positions);
    //     const bottomCenter = [0.5*(min[0]+max[0]), 0.5*(min[1]+max[1]), min[2]];
    //     const bottomCenterCartesian = Cesium.Cartesian3.fromRadians(...bottomCenter, undefined, new Cesium.Cartesian3());
    //     const cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positions);

    //     const modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(bottomCenterCartesian, undefined, new Cesium.Matrix4());
    //     const inverseModelMatrix = Cesium.Matrix4.inverse(modelMatrix, new Cesium.Matrix4());

    //     // cartesians转成本地坐标
    //     cartesians.forEach((cartesian, i) => {
    //         cartesians[i] = Cesium.Matrix4.multiplyByPoint(inverseModelMatrix, cartesian, cartesian);
    //     });

    //     treeData.modelMatrix = modelMatrix;
    //     // treeData.inverseModelMatrix = inverseModelMatrix;
    //     // treeData.bottomCenter = bottomCenter;
    //     // treeData.bottomCenterCartesian = bottomCenterCartesian;
    //     treeData.cartesians = cartesians;
    // }
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();

    var treeDataModelMatrix = void 0;
    {
        var _Cesium$Cartesian;

        var oi = _getMinMax.objArrayIterator;
        var td = treeData;
        var minPos = [(0, _getMinMax.min)(oi(td, 'position', '0')), (0, _getMinMax.min)(oi(td, 'position', '1')), (0, _getMinMax.min)(oi(td, 'position', '2'))];
        var maxPos = [(0, _getMinMax.max)(oi(td, 'position', '0')), (0, _getMinMax.max)(oi(td, 'position', '1')), (0, _getMinMax.max)(oi(td, 'position', '2'))];
        var bottomCenter = [0.5 * (minPos[0] + maxPos[0]), 0.5 * (minPos[1] + maxPos[1]), minPos[2]];
        var bottomCenterCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, bottomCenter.concat([undefined, new Cesium.Cartesian3()]));

        var modelMatrix = Cesium.Transforms.eastNorthUpToFixedFrame(bottomCenterCartesian, undefined, new Cesium.Matrix4());
        var inverseModelMatrix = Cesium.Matrix4.inverse(modelMatrix, new Cesium.Matrix4());

        treeData.forEach(function (td) {
            var tdp = td.position;
            var cartesian = Cesium.Cartesian3.fromRadians(tdp[0], tdp[1], tdp[2], undefined, scratchCartesian);
            cartesian = Cesium.Matrix4.multiplyByPoint(inverseModelMatrix, cartesian, cartesian);
            if (!cartesian) {
                throw new Error('localPosition 计算错误！');
            }
            td.localPosition = [cartesian.x, cartesian.y, cartesian.z];
        });

        treeDataModelMatrix = modelMatrix;
    }

    return treeDataModelMatrix;

    // {
    //     const cartesians = treeData.cartesians;
    //     const [min, max] = getMinMaxCartesian(cartesians);
    //     // min.x -= treeData.maxTreeRadius;
    //     // min.y -= treeData.maxTreeRadius;
    //     // max.x += treeData.maxTreeRadius;
    //     // max.y += treeData.maxTreeRadius;
    //     // max.z += treeData.maxTreeHeight;
    //     // 为了确保<max比较时，能够不遗漏刚好在max上的点，所以扩展一下max
    //     min.x -= 0.001;
    //     min.y -= 0.001;
    //     max.x += 0.001;
    //     max.x += 0.001;
    //     max.y += 0.001;
    //     max.z += 0.001;
    //     treeData.minCartesian = min;
    //     treeData.maxCartesian = max;

    //     // 这里是否需要判断一下，不要让树的范围超过100公里
    // }

    // {
    //     // 随机计算rotations
    //     const tcl = treeData.cartesians.length;
    //     const rotations = new Array(tcl);
    //     for (let i=0; i<tcl; ++i) {
    //         rotations[i] = Math.random() * Math.PI * 2.0;
    //     }
    //     treeData.rotations = rotations;
    // }

    // {
    //     // treeTypes扩展extends，方便计算包围盒向四周的扩展尺寸
    //     treeTypes.forEach(v => {
    //         const c = v.center;
    //         const s = v.size;
    //         v.extends = [c[0] - s[0]*0.5, c[0] + s[0]*0.5, c[1] - s[1]*0.5, c[1] + s[1]*0.5, c[2] - s[2]*0.5, c[2] + s[2]*0.5];
    //         v.maxSize = Math.max(v.size[0], v.size[1], v.size[2]);
    //     });
    // }
}

exports.default = initializeTreeData;

/***/ }),
/* 335 */
/***/ (function(module, exports, __webpack_require__) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

// This method of obtaining a reference to the global object needs to be
// kept identical to the way it is obtained in runtime.js
var g = (function() { return this })() || Function("return this")();

// Use `getOwnPropertyNames` because not all browsers support calling
// `hasOwnProperty` on the global `self` object in a worker. See #183.
var hadRuntime = g.regeneratorRuntime &&
  Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime") >= 0;

// Save the old regeneratorRuntime in case it needs to be restored later.
var oldRuntime = hadRuntime && g.regeneratorRuntime;

// Force reevalutation of runtime.js.
g.regeneratorRuntime = undefined;

module.exports = __webpack_require__(336);

if (hadRuntime) {
  // Restore the original runtime.
  g.regeneratorRuntime = oldRuntime;
} else {
  // Remove the global property added by runtime.js.
  try {
    delete g.regeneratorRuntime;
  } catch(e) {
    g.regeneratorRuntime = undefined;
  }
}


/***/ }),
/* 336 */
/***/ (function(module, exports) {

/**
 * Copyright (c) 2014-present, Facebook, Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */

!(function(global) {
  "use strict";

  var Op = Object.prototype;
  var hasOwn = Op.hasOwnProperty;
  var undefined; // More compressible than void 0.
  var $Symbol = typeof Symbol === "function" ? Symbol : {};
  var iteratorSymbol = $Symbol.iterator || "@@iterator";
  var asyncIteratorSymbol = $Symbol.asyncIterator || "@@asyncIterator";
  var toStringTagSymbol = $Symbol.toStringTag || "@@toStringTag";

  var inModule = typeof module === "object";
  var runtime = global.regeneratorRuntime;
  if (runtime) {
    if (inModule) {
      // If regeneratorRuntime is defined globally and we're in a module,
      // make the exports object identical to regeneratorRuntime.
      module.exports = runtime;
    }
    // Don't bother evaluating the rest of this file if the runtime was
    // already defined globally.
    return;
  }

  // Define the runtime globally (as expected by generated code) as either
  // module.exports (if we're in a module) or a new, empty object.
  runtime = global.regeneratorRuntime = inModule ? module.exports : {};

  function wrap(innerFn, outerFn, self, tryLocsList) {
    // If outerFn provided and outerFn.prototype is a Generator, then outerFn.prototype instanceof Generator.
    var protoGenerator = outerFn && outerFn.prototype instanceof Generator ? outerFn : Generator;
    var generator = Object.create(protoGenerator.prototype);
    var context = new Context(tryLocsList || []);

    // The ._invoke method unifies the implementations of the .next,
    // .throw, and .return methods.
    generator._invoke = makeInvokeMethod(innerFn, self, context);

    return generator;
  }
  runtime.wrap = wrap;

  // Try/catch helper to minimize deoptimizations. Returns a completion
  // record like context.tryEntries[i].completion. This interface could
  // have been (and was previously) designed to take a closure to be
  // invoked without arguments, but in all the cases we care about we
  // already have an existing method we want to call, so there's no need
  // to create a new function object. We can even get away with assuming
  // the method takes exactly one argument, since that happens to be true
  // in every case, so we don't have to touch the arguments object. The
  // only additional allocation required is the completion record, which
  // has a stable shape and so hopefully should be cheap to allocate.
  function tryCatch(fn, obj, arg) {
    try {
      return { type: "normal", arg: fn.call(obj, arg) };
    } catch (err) {
      return { type: "throw", arg: err };
    }
  }

  var GenStateSuspendedStart = "suspendedStart";
  var GenStateSuspendedYield = "suspendedYield";
  var GenStateExecuting = "executing";
  var GenStateCompleted = "completed";

  // Returning this object from the innerFn has the same effect as
  // breaking out of the dispatch switch statement.
  var ContinueSentinel = {};

  // Dummy constructor functions that we use as the .constructor and
  // .constructor.prototype properties for functions that return Generator
  // objects. For full spec compliance, you may wish to configure your
  // minifier not to mangle the names of these two functions.
  function Generator() {}
  function GeneratorFunction() {}
  function GeneratorFunctionPrototype() {}

  // This is a polyfill for %IteratorPrototype% for environments that
  // don't natively support it.
  var IteratorPrototype = {};
  IteratorPrototype[iteratorSymbol] = function () {
    return this;
  };

  var getProto = Object.getPrototypeOf;
  var NativeIteratorPrototype = getProto && getProto(getProto(values([])));
  if (NativeIteratorPrototype &&
      NativeIteratorPrototype !== Op &&
      hasOwn.call(NativeIteratorPrototype, iteratorSymbol)) {
    // This environment has a native %IteratorPrototype%; use it instead
    // of the polyfill.
    IteratorPrototype = NativeIteratorPrototype;
  }

  var Gp = GeneratorFunctionPrototype.prototype =
    Generator.prototype = Object.create(IteratorPrototype);
  GeneratorFunction.prototype = Gp.constructor = GeneratorFunctionPrototype;
  GeneratorFunctionPrototype.constructor = GeneratorFunction;
  GeneratorFunctionPrototype[toStringTagSymbol] =
    GeneratorFunction.displayName = "GeneratorFunction";

  // Helper for defining the .next, .throw, and .return methods of the
  // Iterator interface in terms of a single ._invoke method.
  function defineIteratorMethods(prototype) {
    ["next", "throw", "return"].forEach(function(method) {
      prototype[method] = function(arg) {
        return this._invoke(method, arg);
      };
    });
  }

  runtime.isGeneratorFunction = function(genFun) {
    var ctor = typeof genFun === "function" && genFun.constructor;
    return ctor
      ? ctor === GeneratorFunction ||
        // For the native GeneratorFunction constructor, the best we can
        // do is to check its .name property.
        (ctor.displayName || ctor.name) === "GeneratorFunction"
      : false;
  };

  runtime.mark = function(genFun) {
    if (Object.setPrototypeOf) {
      Object.setPrototypeOf(genFun, GeneratorFunctionPrototype);
    } else {
      genFun.__proto__ = GeneratorFunctionPrototype;
      if (!(toStringTagSymbol in genFun)) {
        genFun[toStringTagSymbol] = "GeneratorFunction";
      }
    }
    genFun.prototype = Object.create(Gp);
    return genFun;
  };

  // Within the body of any async function, `await x` is transformed to
  // `yield regeneratorRuntime.awrap(x)`, so that the runtime can test
  // `hasOwn.call(value, "__await")` to determine if the yielded value is
  // meant to be awaited.
  runtime.awrap = function(arg) {
    return { __await: arg };
  };

  function AsyncIterator(generator) {
    function invoke(method, arg, resolve, reject) {
      var record = tryCatch(generator[method], generator, arg);
      if (record.type === "throw") {
        reject(record.arg);
      } else {
        var result = record.arg;
        var value = result.value;
        if (value &&
            typeof value === "object" &&
            hasOwn.call(value, "__await")) {
          return Promise.resolve(value.__await).then(function(value) {
            invoke("next", value, resolve, reject);
          }, function(err) {
            invoke("throw", err, resolve, reject);
          });
        }

        return Promise.resolve(value).then(function(unwrapped) {
          // When a yielded Promise is resolved, its final value becomes
          // the .value of the Promise<{value,done}> result for the
          // current iteration. If the Promise is rejected, however, the
          // result for this iteration will be rejected with the same
          // reason. Note that rejections of yielded Promises are not
          // thrown back into the generator function, as is the case
          // when an awaited Promise is rejected. This difference in
          // behavior between yield and await is important, because it
          // allows the consumer to decide what to do with the yielded
          // rejection (swallow it and continue, manually .throw it back
          // into the generator, abandon iteration, whatever). With
          // await, by contrast, there is no opportunity to examine the
          // rejection reason outside the generator function, so the
          // only option is to throw it from the await expression, and
          // let the generator function handle the exception.
          result.value = unwrapped;
          resolve(result);
        }, reject);
      }
    }

    var previousPromise;

    function enqueue(method, arg) {
      function callInvokeWithMethodAndArg() {
        return new Promise(function(resolve, reject) {
          invoke(method, arg, resolve, reject);
        });
      }

      return previousPromise =
        // If enqueue has been called before, then we want to wait until
        // all previous Promises have been resolved before calling invoke,
        // so that results are always delivered in the correct order. If
        // enqueue has not been called before, then it is important to
        // call invoke immediately, without waiting on a callback to fire,
        // so that the async generator function has the opportunity to do
        // any necessary setup in a predictable way. This predictability
        // is why the Promise constructor synchronously invokes its
        // executor callback, and why async functions synchronously
        // execute code before the first await. Since we implement simple
        // async functions in terms of async generators, it is especially
        // important to get this right, even though it requires care.
        previousPromise ? previousPromise.then(
          callInvokeWithMethodAndArg,
          // Avoid propagating failures to Promises returned by later
          // invocations of the iterator.
          callInvokeWithMethodAndArg
        ) : callInvokeWithMethodAndArg();
    }

    // Define the unified helper method that is used to implement .next,
    // .throw, and .return (see defineIteratorMethods).
    this._invoke = enqueue;
  }

  defineIteratorMethods(AsyncIterator.prototype);
  AsyncIterator.prototype[asyncIteratorSymbol] = function () {
    return this;
  };
  runtime.AsyncIterator = AsyncIterator;

  // Note that simple async functions are implemented on top of
  // AsyncIterator objects; they just return a Promise for the value of
  // the final result produced by the iterator.
  runtime.async = function(innerFn, outerFn, self, tryLocsList) {
    var iter = new AsyncIterator(
      wrap(innerFn, outerFn, self, tryLocsList)
    );

    return runtime.isGeneratorFunction(outerFn)
      ? iter // If outerFn is a generator, return the full iterator.
      : iter.next().then(function(result) {
          return result.done ? result.value : iter.next();
        });
  };

  function makeInvokeMethod(innerFn, self, context) {
    var state = GenStateSuspendedStart;

    return function invoke(method, arg) {
      if (state === GenStateExecuting) {
        throw new Error("Generator is already running");
      }

      if (state === GenStateCompleted) {
        if (method === "throw") {
          throw arg;
        }

        // Be forgiving, per 25.3.3.3.3 of the spec:
        // https://people.mozilla.org/~jorendorff/es6-draft.html#sec-generatorresume
        return doneResult();
      }

      context.method = method;
      context.arg = arg;

      while (true) {
        var delegate = context.delegate;
        if (delegate) {
          var delegateResult = maybeInvokeDelegate(delegate, context);
          if (delegateResult) {
            if (delegateResult === ContinueSentinel) continue;
            return delegateResult;
          }
        }

        if (context.method === "next") {
          // Setting context._sent for legacy support of Babel's
          // function.sent implementation.
          context.sent = context._sent = context.arg;

        } else if (context.method === "throw") {
          if (state === GenStateSuspendedStart) {
            state = GenStateCompleted;
            throw context.arg;
          }

          context.dispatchException(context.arg);

        } else if (context.method === "return") {
          context.abrupt("return", context.arg);
        }

        state = GenStateExecuting;

        var record = tryCatch(innerFn, self, context);
        if (record.type === "normal") {
          // If an exception is thrown from innerFn, we leave state ===
          // GenStateExecuting and loop back for another invocation.
          state = context.done
            ? GenStateCompleted
            : GenStateSuspendedYield;

          if (record.arg === ContinueSentinel) {
            continue;
          }

          return {
            value: record.arg,
            done: context.done
          };

        } else if (record.type === "throw") {
          state = GenStateCompleted;
          // Dispatch the exception by looping back around to the
          // context.dispatchException(context.arg) call above.
          context.method = "throw";
          context.arg = record.arg;
        }
      }
    };
  }

  // Call delegate.iterator[context.method](context.arg) and handle the
  // result, either by returning a { value, done } result from the
  // delegate iterator, or by modifying context.method and context.arg,
  // setting context.delegate to null, and returning the ContinueSentinel.
  function maybeInvokeDelegate(delegate, context) {
    var method = delegate.iterator[context.method];
    if (method === undefined) {
      // A .throw or .return when the delegate iterator has no .throw
      // method always terminates the yield* loop.
      context.delegate = null;

      if (context.method === "throw") {
        if (delegate.iterator.return) {
          // If the delegate iterator has a return method, give it a
          // chance to clean up.
          context.method = "return";
          context.arg = undefined;
          maybeInvokeDelegate(delegate, context);

          if (context.method === "throw") {
            // If maybeInvokeDelegate(context) changed context.method from
            // "return" to "throw", let that override the TypeError below.
            return ContinueSentinel;
          }
        }

        context.method = "throw";
        context.arg = new TypeError(
          "The iterator does not provide a 'throw' method");
      }

      return ContinueSentinel;
    }

    var record = tryCatch(method, delegate.iterator, context.arg);

    if (record.type === "throw") {
      context.method = "throw";
      context.arg = record.arg;
      context.delegate = null;
      return ContinueSentinel;
    }

    var info = record.arg;

    if (! info) {
      context.method = "throw";
      context.arg = new TypeError("iterator result is not an object");
      context.delegate = null;
      return ContinueSentinel;
    }

    if (info.done) {
      // Assign the result of the finished delegate to the temporary
      // variable specified by delegate.resultName (see delegateYield).
      context[delegate.resultName] = info.value;

      // Resume execution at the desired location (see delegateYield).
      context.next = delegate.nextLoc;

      // If context.method was "throw" but the delegate handled the
      // exception, let the outer generator proceed normally. If
      // context.method was "next", forget context.arg since it has been
      // "consumed" by the delegate iterator. If context.method was
      // "return", allow the original .return call to continue in the
      // outer generator.
      if (context.method !== "return") {
        context.method = "next";
        context.arg = undefined;
      }

    } else {
      // Re-yield the result returned by the delegate method.
      return info;
    }

    // The delegate iterator is finished, so forget it and continue with
    // the outer generator.
    context.delegate = null;
    return ContinueSentinel;
  }

  // Define Generator.prototype.{next,throw,return} in terms of the
  // unified ._invoke helper method.
  defineIteratorMethods(Gp);

  Gp[toStringTagSymbol] = "Generator";

  // A Generator should always return itself as the iterator object when the
  // @@iterator function is called on it. Some browsers' implementations of the
  // iterator prototype chain incorrectly implement this, causing the Generator
  // object to not be returned from this call. This ensures that doesn't happen.
  // See https://github.com/facebook/regenerator/issues/274 for more details.
  Gp[iteratorSymbol] = function() {
    return this;
  };

  Gp.toString = function() {
    return "[object Generator]";
  };

  function pushTryEntry(locs) {
    var entry = { tryLoc: locs[0] };

    if (1 in locs) {
      entry.catchLoc = locs[1];
    }

    if (2 in locs) {
      entry.finallyLoc = locs[2];
      entry.afterLoc = locs[3];
    }

    this.tryEntries.push(entry);
  }

  function resetTryEntry(entry) {
    var record = entry.completion || {};
    record.type = "normal";
    delete record.arg;
    entry.completion = record;
  }

  function Context(tryLocsList) {
    // The root entry object (effectively a try statement without a catch
    // or a finally block) gives us a place to store values thrown from
    // locations where there is no enclosing try statement.
    this.tryEntries = [{ tryLoc: "root" }];
    tryLocsList.forEach(pushTryEntry, this);
    this.reset(true);
  }

  runtime.keys = function(object) {
    var keys = [];
    for (var key in object) {
      keys.push(key);
    }
    keys.reverse();

    // Rather than returning an object with a next method, we keep
    // things simple and return the next function itself.
    return function next() {
      while (keys.length) {
        var key = keys.pop();
        if (key in object) {
          next.value = key;
          next.done = false;
          return next;
        }
      }

      // To avoid creating an additional object, we just hang the .value
      // and .done properties off the next function object itself. This
      // also ensures that the minifier will not anonymize the function.
      next.done = true;
      return next;
    };
  };

  function values(iterable) {
    if (iterable) {
      var iteratorMethod = iterable[iteratorSymbol];
      if (iteratorMethod) {
        return iteratorMethod.call(iterable);
      }

      if (typeof iterable.next === "function") {
        return iterable;
      }

      if (!isNaN(iterable.length)) {
        var i = -1, next = function next() {
          while (++i < iterable.length) {
            if (hasOwn.call(iterable, i)) {
              next.value = iterable[i];
              next.done = false;
              return next;
            }
          }

          next.value = undefined;
          next.done = true;

          return next;
        };

        return next.next = next;
      }
    }

    // Return an iterator with no values.
    return { next: doneResult };
  }
  runtime.values = values;

  function doneResult() {
    return { value: undefined, done: true };
  }

  Context.prototype = {
    constructor: Context,

    reset: function(skipTempReset) {
      this.prev = 0;
      this.next = 0;
      // Resetting context._sent for legacy support of Babel's
      // function.sent implementation.
      this.sent = this._sent = undefined;
      this.done = false;
      this.delegate = null;

      this.method = "next";
      this.arg = undefined;

      this.tryEntries.forEach(resetTryEntry);

      if (!skipTempReset) {
        for (var name in this) {
          // Not sure about the optimal order of these conditions:
          if (name.charAt(0) === "t" &&
              hasOwn.call(this, name) &&
              !isNaN(+name.slice(1))) {
            this[name] = undefined;
          }
        }
      }
    },

    stop: function() {
      this.done = true;

      var rootEntry = this.tryEntries[0];
      var rootRecord = rootEntry.completion;
      if (rootRecord.type === "throw") {
        throw rootRecord.arg;
      }

      return this.rval;
    },

    dispatchException: function(exception) {
      if (this.done) {
        throw exception;
      }

      var context = this;
      function handle(loc, caught) {
        record.type = "throw";
        record.arg = exception;
        context.next = loc;

        if (caught) {
          // If the dispatched exception was caught by a catch block,
          // then let that catch block handle the exception normally.
          context.method = "next";
          context.arg = undefined;
        }

        return !! caught;
      }

      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        var record = entry.completion;

        if (entry.tryLoc === "root") {
          // Exception thrown outside of any try block that could handle
          // it, so set the completion value of the entire function to
          // throw the exception.
          return handle("end");
        }

        if (entry.tryLoc <= this.prev) {
          var hasCatch = hasOwn.call(entry, "catchLoc");
          var hasFinally = hasOwn.call(entry, "finallyLoc");

          if (hasCatch && hasFinally) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            } else if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else if (hasCatch) {
            if (this.prev < entry.catchLoc) {
              return handle(entry.catchLoc, true);
            }

          } else if (hasFinally) {
            if (this.prev < entry.finallyLoc) {
              return handle(entry.finallyLoc);
            }

          } else {
            throw new Error("try statement without catch or finally");
          }
        }
      }
    },

    abrupt: function(type, arg) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc <= this.prev &&
            hasOwn.call(entry, "finallyLoc") &&
            this.prev < entry.finallyLoc) {
          var finallyEntry = entry;
          break;
        }
      }

      if (finallyEntry &&
          (type === "break" ||
           type === "continue") &&
          finallyEntry.tryLoc <= arg &&
          arg <= finallyEntry.finallyLoc) {
        // Ignore the finally entry if control is not jumping to a
        // location outside the try/catch block.
        finallyEntry = null;
      }

      var record = finallyEntry ? finallyEntry.completion : {};
      record.type = type;
      record.arg = arg;

      if (finallyEntry) {
        this.method = "next";
        this.next = finallyEntry.finallyLoc;
        return ContinueSentinel;
      }

      return this.complete(record);
    },

    complete: function(record, afterLoc) {
      if (record.type === "throw") {
        throw record.arg;
      }

      if (record.type === "break" ||
          record.type === "continue") {
        this.next = record.arg;
      } else if (record.type === "return") {
        this.rval = this.arg = record.arg;
        this.method = "return";
        this.next = "end";
      } else if (record.type === "normal" && afterLoc) {
        this.next = afterLoc;
      }

      return ContinueSentinel;
    },

    finish: function(finallyLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.finallyLoc === finallyLoc) {
          this.complete(entry.completion, entry.afterLoc);
          resetTryEntry(entry);
          return ContinueSentinel;
        }
      }
    },

    "catch": function(tryLoc) {
      for (var i = this.tryEntries.length - 1; i >= 0; --i) {
        var entry = this.tryEntries[i];
        if (entry.tryLoc === tryLoc) {
          var record = entry.completion;
          if (record.type === "throw") {
            var thrown = record.arg;
            resetTryEntry(entry);
          }
          return thrown;
        }
      }

      // The context.catch method must only be called with a location
      // argument that corresponds to a known catch block.
      throw new Error("illegal catch attempt");
    },

    delegateYield: function(iterable, resultName, nextLoc) {
      this.delegate = {
        iterator: values(iterable),
        resultName: resultName,
        nextLoc: nextLoc
      };

      if (this.method === "next") {
        // Deliberately forget the last sent value so that we don't
        // accidentally pass it on to the delegate.
        this.arg = undefined;
      }

      return ContinueSentinel;
    }
  };
})(
  // In sloppy mode, unbound `this` refers to the global object, fallback to
  // Function constructor if we're in global strict mode. That is sadly a form
  // of indirect eval which violates Content Security Policy.
  (function() { return this })() || Function("return this")()
);


/***/ }),
/* 337 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getMinMax = __webpack_require__(84);

var _standardBlocks = __webpack_require__(166);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// import * as Cesium from 'cesium';
function createBlocks(treeData, treeTypes) {
    // 数据分拆
    var maxSize = void 0;
    var minLocalPos = void 0;
    var maxLocalPos = void 0;

    {
        var oi = _getMinMax.objArrayIterator;
        var td = treeData;
        minLocalPos = [(0, _getMinMax.min)(oi(td, 'localPosition', '0')), (0, _getMinMax.min)(oi(td, 'localPosition', '1')), (0, _getMinMax.min)(oi(td, 'localPosition', '2'))];
        maxLocalPos = [(0, _getMinMax.max)(oi(td, 'localPosition', '0')), (0, _getMinMax.max)(oi(td, 'localPosition', '1')), (0, _getMinMax.max)(oi(td, 'localPosition', '2'))];

        for (var i = 0; i < 3; ++i) {
            minLocalPos[i] -= 0.001;
            maxLocalPos[i] += 0.001;
        }

        var width = maxLocalPos[0] - minLocalPos[0];
        var height = maxLocalPos[1] - minLocalPos[1];
        maxSize = (0, _getMinMax.max)([width, height]);
    }

    var minLevel = _standardBlocks.standardBlocks.findIndex(function (e) {
        return e < maxSize;
    }) - 1;
    // level 8 -- 156公里
    // level 21 -- 19米
    // TODO(vtxf): 需要根据tree的精度自动计算出来最合适的级别
    var maxLevel = 23; // 划分块最高级别，再往下就是单棵树自身细化
    if (minLevel < 0) {
        // 超乎想象
        throw new Error('超乎想象');
    }

    var treeNum = treeData.length;

    var rootBlock = {
        index: [].concat((0, _toConsumableArray3.default)(new Array(treeNum).keys())),
        level: minLevel,
        min: minLocalPos,
        max: maxLocalPos,
        children: [],
        name: 'R'
    };

    var toBlocks = [rootBlock];

    var _loop = function _loop() {
        var currentBlock = toBlocks.pop();
        var childrenLevel = currentBlock.level + 1;
        if (childrenLevel > maxLevel) {
            return 'continue';
        }

        var blockWidth = _standardBlocks.standardBlocks[childrenLevel];
        var blockSizes = [[0, 0], [0, 1], [1, 0], [1, 1]];
        blockSizes.forEach(function (blockSize) {
            // const min = Cesium.Cartesian3.clone(currentBlock.min);
            var min = [].concat((0, _toConsumableArray3.default)(currentBlock.min));
            min[0] += blockWidth * blockSize[0];
            min[1] += blockWidth * blockSize[1];
            // const max = Cesium.Cartesian3.clone(min);
            var max = [].concat((0, _toConsumableArray3.default)(min));
            max[0] += blockWidth;
            max[1] += blockWidth;
            max[2] = currentBlock.max[2];

            if (min[0] < currentBlock.max[0] && min[1] < currentBlock.max[1]) {
                max[0] = max[0] > currentBlock.max[0] ? currentBlock.max[0] : max[0];
                max[1] = max[1] > currentBlock.max[1] ? currentBlock.max[1] : max[1];

                var childBlock = {
                    index: [],
                    level: childrenLevel,
                    min: min,
                    max: max,
                    children: [],
                    name: '' + currentBlock.name + blockSize[0] + blockSize[1]
                };

                currentBlock.index.forEach(function (vi) {
                    var lp = treeData[vi].localPosition;
                    if (lp[0] >= min[0] && lp[0] < max[0] && lp[1] >= min[1] && lp[1] < max[1]) {
                        childBlock.index.push(vi);
                    }
                });

                if (childBlock.index.length > 0) {
                    currentBlock.children.push(childBlock);
                    toBlocks.push(childBlock);
                }
            }
        });
    };

    while (toBlocks.length > 0) {
        var _ret = _loop();

        if (_ret === 'continue') continue;
    }

    {
        (function () {
            // 计算每个包围盒扩展树的半径以后的包围盒大小，这里需要根据树的摆放姿态来计算
            // 先计算最小块的包围盒，然后根据最小块的包围盒再计算上一级的，直到rootBlock
            var toBlocks = [rootBlock];
            while (toBlocks.length > 0) {
                var current = toBlocks[toBlocks.length - 1];
                if (current.children && current.children.length > 0) {
                    if (current.children[0].extendMin) {
                        // // 所有子节点的extendMin和extendMax应该都以创建才对！
                        // const min = [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY];
                        // const max = [Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];
                        // current.children.forEach(c => {
                        //     for (let i=0; i<3; ++i) {
                        //         min[i] = min[i] < c.extendMin[i] ? min[i] : c.extendMin[i];
                        //         max[i] = max[i] > c.extendMax[i] ? max[i] : c.extendMax[i];
                        //     }
                        // });
                        // current.extendMin = min;
                        // current.extendMax = max;
                        var cc = current.children;
                        var ci = _getMinMax.objArrayIterator;
                        current.extendMin = [(0, _getMinMax.min)(ci(cc, 'extendMin', '0')), (0, _getMinMax.min)(ci(cc, 'extendMin', '1')), (0, _getMinMax.min)(ci(cc, 'extendMin', '2'))];
                        current.extendMax = [(0, _getMinMax.max)(ci(cc, 'extendMax', '0')), (0, _getMinMax.max)(ci(cc, 'extendMax', '1')), (0, _getMinMax.max)(ci(cc, 'extendMax', '2'))];

                        toBlocks.pop();
                    } else {
                        current.children.forEach(function (c) {
                            toBlocks.push(c);
                        });
                    }
                } else {
                    var _computeOBB = computeOBB(current, treeData, treeTypes),
                        _computeOBB2 = (0, _slicedToArray3.default)(_computeOBB, 2),
                        _min = _computeOBB2[0],
                        _max = _computeOBB2[1];

                    current.extendMin = _min;
                    current.extendMax = _max;
                    toBlocks.pop();
                }
            }
        })();
    }

    // console.log(rootBlock);
    return rootBlock;
}

var scratchCartesian = void 0;
var scratchTranslation = void 0;
var scratchScale = void 0;
var scratchQuat = void 0;
var scrtachMatrix4 = void 0;

// 计算每一个树做了旋转缩放平移变换后的min和max
function computeOBB(block, treeData, treeTypes) {
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchTranslation = scratchTranslation || new Cesium.Cartesian3();
    scratchScale = scratchScale || new Cesium.Cartesian3();
    scratchQuat = scratchQuat || new Cesium.Quaternion();
    scrtachMatrix4 = scrtachMatrix4 || new Cesium.Matrix4();

    var obbMin = [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY];
    var obbMax = [Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];

    var index = block.index;
    index.forEach(function (vi) {
        var lp = treeData[vi].localPosition;
        var treeType = treeTypes[treeData[vi].type || 0];
        var r = treeData[vi].rotation;
        var s = treeData[vi].scale;

        var modelMatrix = void 0;
        {
            var rotation = Cesium.Quaternion.fromHeadingPitchRoll(new Cesium.HeadingPitchRoll(r[0], r[1], r[2]), scratchQuat);
            var scale = Cesium.Cartesian3.fromElements(s[0], s[1], s[2], scratchScale);
            modelMatrix = Cesium.Matrix4.fromTranslationQuaternionRotationScale(Cesium.Cartesian3.ZERO, rotation, scale, scrtachMatrix4);
            // treeData[vi]._modelMatrix = modelMatrix; // 计算instance时需要用到
        }

        var offPoss = void 0;
        {
            var c = treeType.center;
            var _s = treeType.size.map(function (e) {
                return e * 0.5;
            });
            offPoss = [[c[0] - _s[0], c[1] - _s[1], c[2] - _s[2]], [c[0] + _s[0], c[1] - _s[1], c[2] - _s[2]], [c[0] + _s[0], c[1] + _s[1], c[2] - _s[2]], [c[0] - _s[0], c[1] + _s[1], c[2] - _s[2]], [c[0] - _s[0], c[1] - _s[1], c[2] + _s[2]], [c[0] + _s[0], c[1] - _s[1], c[2] + _s[2]], [c[0] + _s[0], c[1] + _s[1], c[2] + _s[2]], [c[0] - _s[0], c[1] + _s[1], c[2] + _s[2]]];

            offPoss = offPoss.map(function (e) {
                var r = Cesium.Matrix4.multiplyByPoint(modelMatrix, Cesium.Cartesian3.fromElements(e[0], e[1], e[2], scratchCartesian), scratchCartesian);
                return [r.x, r.y, r.z];
            });
        }

        var ci = _getMinMax.objArrayIterator;
        var minPos = [lp[0] + (0, _getMinMax.min)(ci(offPoss, '0')), lp[1] + (0, _getMinMax.min)(ci(offPoss, '1')), lp[2] + (0, _getMinMax.min)(ci(offPoss, '2'))];
        var maxPos = [lp[0] + (0, _getMinMax.max)(ci(offPoss, '0')), lp[1] + (0, _getMinMax.max)(ci(offPoss, '1')), lp[2] + (0, _getMinMax.max)(ci(offPoss, '2'))];

        for (var i = 0; i < 3; ++i) {
            obbMin[i] = obbMin[i] < minPos[i] ? obbMin[i] : minPos[i];
            obbMax[i] = obbMax[i] > maxPos[i] ? obbMax[i] : maxPos[i];
        }
    });

    return [obbMin, obbMax];
}

exports.default = createBlocks;

/***/ }),
/* 338 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _regenerator = __webpack_require__(165);

var _regenerator2 = _interopRequireDefault(_regenerator);

var _map = __webpack_require__(79);

var _map2 = _interopRequireDefault(_map);

var _getMinMax = __webpack_require__(84);

var _standardBlocks = __webpack_require__(166);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// import createCmptFromBlock from './createCmptFromBlock';

// 匹配对应ge的gltf模型
// fileCollectCallback function (filePath, bufferOrJson)
// import * as Cesium from 'cesium';
function fillBlocks(rootBlock, treeData, treeTypes, treeDataModelMatrix) {
    // 计算合适的block大小
    // 尽可能匹配大的ge，但不能超过指定的ge

    // "asset": {
    //     "generatetool": "cesiumlab2@www.cesiumlab.com",
    //     "gltfUpAxis": "Z",
    //     "version": "1.0"
    // },
    // "root": {
    // }

    // {
    //     "boundingVolume": {
    //         "box": [13.8909917790443, 75.6252969165798, 4.4912101989612, 250.031062056776, 0, 0, 0, 294.291605863953, 0, 0, 0, 305.924674833193]
    //     },
    //     "content": {
    //         "uri": "pnts/0_0_0_0.pnts"
    //     },
    //     "geometricError": 615840.3125,
    //     "refine": "REPLACE",
    //     "transform": [-0.94574995021245, -0.324895416516065, 0.0, 0.0, 0.181868044057958, -0.529406340838745, 0.828645244257314, 0.0, -0.269223041777036, 0.783691198500138, 0.559774114415571, 0.0, -1715445.83278121, 4993554.01298733, 3566790.44087262, 1.0]
    //     "children": []
    // }

    // const [min, max] = getMinMaxCartesian(treeData.cartesians, rootBlock.index);

    var tilesetGeneratorInfo = {
        cmptMaps: new _map2.default(),
        treeData: treeData,
        treeTypes: treeTypes,
        rootJSON: undefined, // 包含tile的层次结构信息
        tilesetJSON: undefined // 包含ENU矩阵信息，然后引入rootJSON，之所以分开，是方便以后合成
    };

    var rootTile = void 0;

    {
        // // maxTreeRadius，maxTreeHeight的扩展需要加上，平面方向上需要外扩maxTreeRadius，高度方向需要上扩maxTreeHeight，注意不需要向下扩
        // // maxTreeHeight的扩展分两步，center.z上加0.5*maxTreeHeight，然后size上再加0.5*maxTreeHeight
        // const center = Cesium.Cartesian3.midpoint(rootBlock.min, rootBlock.max, new Cesium.Cartesian3());
        // // const offset = Cesium.Cartesian3.subtract(center, treeData.bottomCenterCartesian, new Cesium.Cartesian3());
        // // offset.z += treeData.maxTreeHeight * 0.5;
        // const size = Cesium.Cartesian3.subtract(rootBlock.max, rootBlock.min, new Cesium.Cartesian3());
        // const boundingVolumeBox = [center.x, center.y, center.z + treeData.maxTreeHeight * 0.5, 
        //              size.x * 0.5 + treeData.maxTreeRadius, 0, 0,
        //              0, size.y * 0.5 + treeData.maxTreeRadius, 0,
        //              0, 0, size.z * 0.5 + treeData.maxTreeHeight * 0.5];

        // const center = Cesium.Cartesian3.midpoint(rootBlock.min, rootBlock.max, new Cesium.Cartesian3());
        // const size = Cesium.Cartesian3.subtract(rootBlock.max, rootBlock.min, new Cesium.Cartesian3());
        var boundingVolumeBox = void 0;
        {
            var rmin = rootBlock.extendMin;
            var rmax = rootBlock.extendMax;
            var c = [(rmin[0] + rmax[0]) * 0.5, (rmin[1] + rmax[1]) * 0.5, (rmin[2] + rmax[2]) * 0.5];
            var r = [(rmax[0] - rmin[0]) * 0.5, (rmax[1] - rmin[1]) * 0.5, (rmax[2] - rmin[2]) * 0.5];
            boundingVolumeBox = [c[0], c[1], c[2], r[0], 0, 0, 0, r[1], 0, 0, 0, r[2]];
        }
        var transform = Cesium.Matrix4.toArray(treeDataModelMatrix);
        var geometricError = _standardBlocks.standardBlockGeometricErrors[rootBlock.level];
        var contentUri = 'L' + rootBlock.level + '-' + rootBlock.name + '.cmpt';

        rootTile = {
            refine: "REPLACE",
            boundingVolume: {
                box: boundingVolumeBox
            },
            transform: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
            geometricError: geometricError * 16.0,
            content: {
                uri: contentUri
            },
            extras: {
                xbsjID: Cesium.createGuid(),
                parentXbsjID: null,
                level: rootBlock.level
            }
        };

        var tilesetJson = {
            asset: {
                generatetool: "cesiumlab2@www.cesiumlab.com",
                gltfUpAxis: "Z",
                version: "1.0"
            },
            root: {
                refine: "REPLACE",
                boundingVolume: {
                    box: boundingVolumeBox
                },
                transform: transform,
                geometricError: geometricError * 16.0,
                content: {
                    uri: './root.json'
                }
            }
        };

        tilesetGeneratorInfo.tilesetJSON = tilesetJson;
        // fileCollectCallback('tileset.json', tilesetJson);

        // 根据树种不同分类不同的树
        tilesetGeneratorInfo.cmptMaps.set(contentUri, {
            block: rootBlock,
            geometricError: geometricError
        });
        // createCmptFromBlock(rootBlock, treeData, treeTypes, geometricError, fileCollectCallback, contentUri);
    }

    // content生成
    // 子节点的计算
    var toBlocks = [{ parentBlock: rootBlock, parentTile: rootTile }]; // toBlocks表示需要处理的数据，注意处理的是子数据！也就是一次处理四个子块的数据

    var _loop = function _loop() {
        var _toBlocks$pop = toBlocks.pop(),
            parentBlock = _toBlocks$pop.parentBlock,
            parentTile = _toBlocks$pop.parentTile;

        parentBlock.children.forEach(function (childBlock) {
            // 先根据内容计算实际包围盒大小
            // const [min, max] = getMinMaxCartesian(treeData.cartesians, childBlock.index);

            var minLocalPos = void 0,
                maxLocalPos = void 0;
            {
                var oi = /*#__PURE__*/_regenerator2.default.mark(function oi(index) {
                    var cl, i, vi;
                    return _regenerator2.default.wrap(function oi$(_context) {
                        while (1) {
                            switch (_context.prev = _context.next) {
                                case 0:
                                    cl = childBlock.index.length;
                                    i = 0;

                                case 2:
                                    if (!(i < cl)) {
                                        _context.next = 9;
                                        break;
                                    }

                                    vi = childBlock.index[i];
                                    _context.next = 6;
                                    return treeData[vi].localPosition[index];

                                case 6:
                                    ++i;
                                    _context.next = 2;
                                    break;

                                case 9:
                                case 'end':
                                    return _context.stop();
                            }
                        }
                    }, oi, this);
                });

                minLocalPos = [(0, _getMinMax.min)(oi(0)), (0, _getMinMax.min)(oi(1)), (0, _getMinMax.min)(oi(2))];
                maxLocalPos = [(0, _getMinMax.max)(oi(0)), (0, _getMinMax.max)(oi(1)), (0, _getMinMax.max)(oi(2))];
            }

            // 实际的min和max应该小于包围盒的
            var cmin = childBlock.min;
            var cmax = childBlock.max;

            if (cmin[0] <= minLocalPos[0] && cmin[1] <= minLocalPos[1] && cmin[2] <= minLocalPos[2] && cmax[0] > maxLocalPos[0] && cmax[1] > maxLocalPos[1] && cmax[2] > maxLocalPos[2]) {
                var _boundingVolumeBox = void 0;
                {
                    var _rmin = childBlock.extendMin;
                    var _rmax = childBlock.extendMax;
                    var _c = [(_rmin[0] + _rmax[0]) * 0.5, (_rmin[1] + _rmax[1]) * 0.5, (_rmin[2] + _rmax[2]) * 0.5];
                    var _r = [(_rmax[0] - _rmin[0]) * 0.5, (_rmax[1] - _rmin[1]) * 0.5, (_rmax[2] - _rmin[2]) * 0.5];
                    _boundingVolumeBox = [_c[0], _c[1], _c[2], _r[0], 0, 0, 0, _r[1], 0, 0, 0, _r[2]];
                }

                var _transform = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];
                var _geometricError = _standardBlocks.standardBlockGeometricErrors[childBlock.level];
                var _contentUri = 'L' + childBlock.level + '-' + childBlock.name + '.cmpt';

                var childTile = {
                    refine: "REPLACE",
                    boundingVolume: {
                        box: _boundingVolumeBox
                    },
                    transform: _transform,
                    geometricError: _geometricError * 16.0,
                    extras: {
                        xbsjID: Cesium.createGuid(),
                        parentXbsjID: parentTile.xbsjID,
                        level: childBlock.level
                    },
                    content: {
                        uri: _contentUri
                    }
                };

                parentTile.children = parentTile.children || [];
                parentTile.children.push(childTile);

                // 根据树种不同分类不同的树
                // createCmptFromBlock(childBlock, treeData, treeTypes, geometricError, fileCollectCallback, contentUri);
                tilesetGeneratorInfo.cmptMaps.set(_contentUri, {
                    block: childBlock,
                    geometricError: _geometricError
                });

                if (childBlock.children.length > 0) {
                    toBlocks.push({
                        parentBlock: childBlock,
                        parentTile: childTile
                    });
                }
            } else {
                throw new Error('fillBlocks error');
            }
        });
    };

    while (toBlocks.length > 0) {
        _loop();
    }

    var rootJSON = {
        asset: {
            generatetool: "cesiumlab2@www.cesiumlab.com",
            gltfUpAxis: "Z",
            version: "1.0"
        },
        root: rootTile
    };
    tilesetGeneratorInfo.rootJSON = rootJSON;

    // fileCollectCallback('root.json', rootJSON);
    // console.log('created root.json');

    // {
    //     // 生成cmpt
    //     const treeData = tilesetGeneratorInfo.treeData;
    //     const treeTypes = tilesetGeneratorInfo.treeTypes;
    //     tilesetGeneratorInfo.cmptMaps.forEach((v, k, m) => {
    //         const contentUri = k;
    //         createCmptFromBlock(v.block, treeData, treeTypes, v.geometricError, fileCollectCallback, contentUri);
    //     });
    // }
    // console.log('created cpmts!');

    // JSON.stringify(rootTile, undefined, '    ');
    // console.log('ddd');

    return tilesetGeneratorInfo;
}

exports.default = fillBlocks;

/***/ }),
/* 339 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _createCMPT = __webpack_require__(340);

var _createCMPT2 = _interopRequireDefault(_createCMPT);

var _createI3DM = __webpack_require__(341);

var _createI3DM2 = _interopRequireDefault(_createI3DM);

var _getMinMax = __webpack_require__(84);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function createCmptFromBlock(childBlock, treeData, treeTypes, geometricError) {
    var typeIndexMap = {};
    childBlock.index.forEach(function (i) {
        // const typeIndex = treeData.types[i];
        var typeIndex = treeData[i].type || 0;
        typeIndexMap[typeIndex] = typeIndexMap[typeIndex] || [];
        typeIndexMap[typeIndex].push(i);
    });
    var tileBuffers = (0, _keys2.default)(typeIndexMap).map(function (k) {
        var treeType = treeTypes[k];
        var subIndex = typeIndexMap[k];
        // geometricError // 米/像素
        var lodIndex = treeType.lods.findIndex(function (lod) {
            var bestPixels = lod[0];
            // return treeType.treeHeight / bestPixels < geometricError;
            // return treeType.maxSize < geometricError * bestPixels;
            var maxSize = (0, _getMinMax.max)(treeType.size);
            return maxSize < geometricError * bestPixels;
        });
        // 如果找不到合适的精度，就用最精细的模型
        lodIndex = lodIndex < 0 ? treeType.lods.length - 1 : lodIndex;
        // TODO(vtxf): 这个路径需要根据实际情况来定
        // 如果在内存中，得考虑加上特殊的前置，方便以后截取再解析
        // 如果是文件，得考虑拷贝到合适的位置，然后修改成合适的路径
        // 目前测试，直接用
        var gltfUri = treeType.lods[lodIndex][1];
        // const tileBuffer = createI3DM(treeData.cartesians, treeData.rotations, subIndex, gltfUri);
        var tileBuffer = (0, _createI3DM2.default)(treeData, subIndex, gltfUri);
        return tileBuffer;
    });
    var cmptBuffer = (0, _createCMPT2.default)(tileBuffers);

    return cmptBuffer;
    // fileCollectCallback(contentUri, cmptBuffer);
}

exports.default = createCmptFromBlock;

/***/ }),
/* 340 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _memcpy = __webpack_require__(167);

var _memcpy2 = _interopRequireDefault(_memcpy);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var encoder = new TextEncoder();

// Composite
function createCMPT(tileBuffers) {
    // magic	4-byte ANSI string	"cmpt". This can be used to identify the content as a Composite tile.
    // version	uint32	The version of the Composite format. It is currently 1.
    // byteLength	uint32	The length of the entire Composite tile, including this header and each inner tile, in bytes.
    // tilesLength	uint32	The number of tiles in the Composite.

    var headerByteLength = 16;
    var titlesTotalByteLength = tileBuffers.reduce(function (accumulator, currentTile) {
        return accumulator + currentTile.byteLength;
    }, 0);
    var version = 1;
    var byteLength = headerByteLength + titlesTotalByteLength;
    var tilesLength = tileBuffers.length;
    var magic = encoder.encode('cmpt');

    var cmptBuffer = new ArrayBuffer(byteLength);

    var header = new Uint32Array(cmptBuffer, 0, 4);
    header[0] = new DataView(magic.buffer).getUint32(0, true);
    header[1] = version;
    header[2] = byteLength;
    header[3] = tilesLength;

    var byteOffset = 16;

    tileBuffers.forEach(function (tileBuffer) {
        if (tileBuffer.byteLength % 8 !== 0) {
            throw new Error('tileBuffer.byteLength % 8 !== 0'); // tileBuffer是自己处理的，必须是8的倍数！
        }

        (0, _memcpy2.default)(cmptBuffer, tileBuffer, byteOffset);
        byteOffset += tileBuffer.byteLength;
    });

    return cmptBuffer;
}

exports.default = createCMPT;

/***/ }),
/* 341 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _memcpy = __webpack_require__(167);

var _memcpy2 = _interopRequireDefault(_memcpy);

var _padding = __webpack_require__(342);

var _padding2 = _interopRequireDefault(_padding);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// Instanced 3D Model
var encoder = new TextEncoder();

var scratchMatrix3 = void 0;
var scratchHPR = void 0;

// index表示cartesians中的索引
// function createI3DM(cartesians, rotations, index, gltfUri) {
function createI3DM(treeData, index, gltfUri) {
    var header = {
        magic: "i3dm", // 4-byte ANSI string "i3dm". This can be used to identify the content as an Instanced 3D Model tile.
        version: 1, // uint32 The version of the Instanced 3D Model format. It is currently 1.
        byteLength: 0, // uint32 The length of the entire tile, including the header, in bytes.
        featureTableJSONByteLength: 0, // uint32 The length of the Feature Table JSON section in bytes.
        featureTableBinaryByteLength: 0, // uint32 The length of the Feature Table binary section in bytes.
        batchTableJSONByteLength: 0, // uint32 The length of the Batch Table JSON section in bytes. Zero indicates that there is no Batch Table.
        batchTableBinaryByteLength: 0, // uint32 The length of the Batch Table binary section in bytes. If batchTableJSONByteLength is zero, this will also be zero.
        gltfFormat: 0 // uint32 Indicates the format of the glTF field of the body. 0 indicates it is a uri, 1 indicates it is embedded binary glTF. See the glTF section below.
    };
    var headerByteLength = 32;

    var body = {
        featureTable: {
            JSON: undefined, // 注意是二进制
            JSONExtraByteLength: 0,
            Binary: undefined,
            BinaryExtraByteLength: 0
        },
        batchTable: {
            JSON: undefined, // 注意是二进制
            JSONExtraByteLength: 0,
            Binary: undefined,
            BinaryExtraByteLength: 0
        },
        urlOrBinaryGltf: undefined,
        urlOrBinaryGltfExtraByteLength: 0
    };

    {
        // const instanceLength = cartesians.length;
        var instanceLength = index.length;
        var NORMAL_UP_byteOffset = 4 * 3 * instanceLength;
        var NORMAL_RIGHT_byteOffset = 4 * 3 * instanceLength * 2;
        var SCALE_NON_UNIFORM_byteOffset = 4 * 3 * instanceLength * 3;
        var BATCH_ID_byteOffset = 4 * 3 * instanceLength * 4;
        {
            var featureTableJSON = {
                INSTANCES_LENGTH: instanceLength,
                POSITION: {
                    byteOffset: 0
                },
                // NORMAL_UP和NORMAL_RIGHT要么同时定义，要么都不定义
                // gltf2.0模型加载进来之后，+y朝上，+z朝东，+x朝北
                // 3dmax建模以后再用babylon插件导出时，
                // 相对于gltf模型的，默认的NORMAL_UP是[0, 1, 0]，即y轴为正上方；如果改成[0, 0, 1]，相当于认为模型的+z轴朝上。
                NORMAL_UP: {
                    byteOffset: NORMAL_UP_byteOffset
                },
                NORMAL_RIGHT: {
                    byteOffset: NORMAL_RIGHT_byteOffset
                },
                SCALE_NON_UNIFORM: {
                    byteOffset: SCALE_NON_UNIFORM_byteOffset
                },
                BATCH_ID: {
                    byteOffset: BATCH_ID_byteOffset // Uint16
                }
            };
            var featureTableJSONStr = (0, _stringify2.default)(featureTableJSON);
            body.featureTable.JSON = encoder.encode(featureTableJSONStr);

            var jsonByteLength = body.featureTable.JSON.byteLength;
            body.featureTable.JSONExtraByteLength = (8 - jsonByteLength % 8) % 8;
        }

        {
            // * 3 是因为需要考虑 NORMAL_UP和NORMAL_RIGHT
            // const f32array = new Float32Array(3 * instanceLength * 4); // 末尾多出来的相当于填写的是0
            var arrayBuffer = new ArrayBuffer((4 * 3 * 4 + 2) * instanceLength); // 最后的2个子节是batchID
            var f32array = new Float32Array(arrayBuffer, 0, 3 * instanceLength * 4);
            var uint16array = new Uint16Array(arrayBuffer, 4 * 3 * 4 * instanceLength, instanceLength);
            // cartesians.forEach((cartesian, i) => {
            //     f32array[i*3+0] = cartesian.x;
            //     f32array[i*3+1] = cartesian.y;
            //     f32array[i*3+2] = cartesian.z;
            // });
            // vi表示的是cartesians中的索引序号，i表示按顺序存储到buffer中去
            index.forEach(function (vi, i) {
                var tdi = treeData[vi];
                var lp = tdi.localPosition;
                f32array[i * 3 + 0] = lp[0];
                f32array[i * 3 + 1] = lp[1];
                f32array[i * 3 + 2] = lp[2];

                {
                    // 策略1：gltfUpAxis为Y时，
                    // 注意这里的计算是假定不改tilesetJSON文件中的gltfUpAxis，它的默认值应该是Y。
                    // normal up 相当于 +y轴
                    // normal right 相当于 模型左侧，注意是左侧，从眼睛方向观察模型，right轴相当于眼睛的右侧，也就是模型的左侧
                    // 模型的 +z轴相当于模型的前向，眼睛方向射向模型的轴则是-z轴
                    // normal的默认值应该是这样的：
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+0] = 0.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+1] = 1.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+2] = 0.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+0] = 1.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+1] = 0.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+2] = 0.0;
                }

                {
                    // 策略2：gltfUpAxis为Z时，
                    // 如果将tilesetJSON文件中的gltfUpAxis改成Z，那么相当于gltf模型要做一下翻转，从gltf模型的z轴向y轴方向转动90度，那么
                    // 相当于认为gltf模型的z轴是向上的，x轴仍然是模型的右侧，眼睛的左侧，朝东；-y轴则是前向；+y轴朝北
                    // 那么normal的默认值是这样的：
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+0] = 0.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+1] = 0.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+2] = 1.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+0] = 1.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+1] = 0.0;
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+2] = 0.0;
                    // 用这种方式的好处是gltf模型的朝向和本地ENU坐标系保持一致，不需要额外的转换
                }

                {
                    // // 比较两种策略后，选择策略2。
                    // // z轴始终保持朝上，可以做一些微小的调整，100公里以内，不做问题也不大
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+0] = 0.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+1] = 0.0;
                    // f32array[NORMAL_UP_byteOffset/4 + i*3+2] = 1.0;
                    // // 旋转轴，可以是一个随机的，这样每棵树的方向有一些差别，更加真实
                    // // TODO(vtxf): 暂时只支持heading
                    // // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+0] = Math.cos(rotations[vi]);
                    // // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+1] = Math.sin(rotations[vi]);
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+0] = Math.cos(-tdi.rotation[0]);
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+1] = Math.sin(-tdi.rotation[0]);
                    // f32array[NORMAL_RIGHT_byteOffset/4 + i*3+2] = 0.0;

                    scratchMatrix3 = scratchMatrix3 || new Cesium.Matrix3();
                    scratchHPR = scratchHPR || new Cesium.HeadingPitchRoll();
                    scratchHPR.heading = tdi.rotation[0];
                    scratchHPR.pitch = tdi.rotation[1];
                    scratchHPR.roll = tdi.rotation[2];
                    var matrix3 = Cesium.Matrix3.fromHeadingPitchRoll(scratchHPR, scratchMatrix3);

                    // 比较两种策略后，选择策略2。
                    // z轴始终保持朝上，可以做一些微小的调整，100公里以内，不做问题也不大
                    f32array[NORMAL_UP_byteOffset / 4 + i * 3 + 0] = matrix3[6];
                    f32array[NORMAL_UP_byteOffset / 4 + i * 3 + 1] = matrix3[7];
                    f32array[NORMAL_UP_byteOffset / 4 + i * 3 + 2] = matrix3[8];
                    f32array[NORMAL_RIGHT_byteOffset / 4 + i * 3 + 0] = matrix3[0];
                    f32array[NORMAL_RIGHT_byteOffset / 4 + i * 3 + 1] = matrix3[1];
                    f32array[NORMAL_RIGHT_byteOffset / 4 + i * 3 + 2] = matrix3[2];
                }

                {
                    f32array[SCALE_NON_UNIFORM_byteOffset / 4 + i * 3 + 0] = tdi.scale[0];
                    f32array[SCALE_NON_UNIFORM_byteOffset / 4 + i * 3 + 1] = tdi.scale[1];
                    f32array[SCALE_NON_UNIFORM_byteOffset / 4 + i * 3 + 2] = tdi.scale[2];
                }

                // BATCH_ID
                {
                    uint16array[i] = i;
                }
            });

            // body.featureTable.Binary = f32array;
            body.featureTable.Binary = arrayBuffer;

            var byteLength = body.featureTable.Binary.byteLength;
            body.featureTable.BinaryExtraByteLength = (8 - byteLength % 8) % 8;
        }

        {
            var ids = index.map(function (vi) {
                return '' + vi;
            });
            var batchTableJSON = {
                id: ids
            };

            var batchTableJSONStr = (0, _stringify2.default)(batchTableJSON);
            body.batchTable.JSON = encoder.encode(batchTableJSONStr);

            var _jsonByteLength = body.batchTable.JSON.byteLength;
            body.batchTable.JSONExtraByteLength = (8 - _jsonByteLength % 8) % 8;
        }

        {
            // const paddingLength = (8 - featureTableBinary.BYTES_PER_ELEMENT * featureTableBinary.length % 8) % 8;
            // const paddingGltfUri = ' '.repeat(paddingLength) + gltfUri;
            // body.urlOrBinaryGltf = encoder.encode(paddingGltfUri);
            body.urlOrBinaryGltf = encoder.encode(gltfUri);

            var _byteLength = body.urlOrBinaryGltf.byteLength;
            body.urlOrBinaryGltfExtraByteLength = (8 - _byteLength % 8) % 8;
        }
    }

    {
        header.featureTableJSONByteLength = body.featureTable.JSON.byteLength + body.featureTable.JSONExtraByteLength;
        header.featureTableBinaryByteLength = body.featureTable.Binary.byteLength + body.featureTable.BinaryExtraByteLength;
        header.batchTableJSONByteLength = (body.batchTable.JSON ? body.batchTable.JSON.byteLength : 0) + body.batchTable.JSONExtraByteLength;
        header.batchTableBinaryByteLength = (body.batchTable.Binary ? body.batchTable.Binary.byteLength : 0) + body.batchTable.BinaryExtraByteLength;

        var bodyByteLength = header.featureTableJSONByteLength + header.featureTableBinaryByteLength + header.batchTableJSONByteLength + header.batchTableBinaryByteLength + body.urlOrBinaryGltf.byteLength + body.urlOrBinaryGltfExtraByteLength;
        header.byteLength = headerByteLength + bodyByteLength;
    }

    var headerBuffer = new ArrayBuffer(headerByteLength);
    {
        var magic = new Uint8Array(headerBuffer, 0, 4);
        // TODO(vtxf): 这个地方写法太繁杂
        {
            var ml = header.magic.length;
            for (var i = 0; i < ml; ++i) {
                var codePoint = header.magic.codePointAt(i);
                if (codePoint > 255) {
                    throw new Error('codePoint > 255');
                }
                magic[i] = codePoint;
            }
        }
        var next = new Uint32Array(headerBuffer, 4, 7);
        next[0] = header.version;
        next[1] = header.byteLength;
        next[2] = header.featureTableJSONByteLength;
        next[3] = header.featureTableBinaryByteLength;
        next[4] = header.batchTableJSONByteLength;
        next[5] = header.batchTableBinaryByteLength;
        next[6] = header.gltfFormat;
    }

    var i3dmBuffer = new ArrayBuffer(header.byteLength);
    {
        var targetByteOffset = 0;

        (0, _memcpy2.default)(i3dmBuffer, headerBuffer, targetByteOffset);
        targetByteOffset += headerBuffer.byteLength;

        (0, _memcpy2.default)(i3dmBuffer, body.featureTable.JSON, targetByteOffset);
        targetByteOffset += body.featureTable.JSON.byteLength;
        (0, _padding2.default)(i3dmBuffer, targetByteOffset, body.featureTable.JSONExtraByteLength, 32); // 根据3dtiles格式的规则，字符串的padding要填空格\20
        targetByteOffset += body.featureTable.JSONExtraByteLength;

        (0, _memcpy2.default)(i3dmBuffer, body.featureTable.Binary, targetByteOffset);
        targetByteOffset += body.featureTable.Binary.byteLength;
        (0, _padding2.default)(i3dmBuffer, targetByteOffset, body.featureTable.BinaryExtraByteLength, 0); // 根据3dtiles格式的规则，可以填写0或者任意字符
        targetByteOffset += body.featureTable.BinaryExtraByteLength;

        if (body.batchTable.JSON) {
            (0, _memcpy2.default)(i3dmBuffer, body.batchTable.JSON, targetByteOffset);
            targetByteOffset += body.batchTable.JSON.byteLength;
            (0, _padding2.default)(i3dmBuffer, targetByteOffset, body.batchTable.JSONExtraByteLength, 32); // 根据3dtiles格式的规则，字符串的padding要填空格\20
            targetByteOffset += body.batchTable.JSONExtraByteLength;
        }

        if (body.batchTable.Binary) {
            (0, _memcpy2.default)(i3dmBuffer, body.batchTable.Binary, targetByteOffset);
            targetByteOffset += body.batchTable.Binary.byteLength;
            (0, _padding2.default)(i3dmBuffer, targetByteOffset, body.batchTable.BinaryExtraByteLength, 0); // 根据3dtiles格式的规则，可以填写0或者任意字符
            targetByteOffset += body.batchTable.BinaryExtraByteLength;
        }

        (0, _memcpy2.default)(i3dmBuffer, body.urlOrBinaryGltf, targetByteOffset);
        targetByteOffset += body.urlOrBinaryGltf.byteLength;

        var paddingCode = header.gltfFormat === 0 ? 32 : 0; // gltfFormat为0时表示是一个uri字符串，为1时，是二进制数据
        (0, _padding2.default)(i3dmBuffer, targetByteOffset, body.urlOrBinaryGltfExtraByteLength, paddingCode);
        targetByteOffset += body.urlOrBinaryGltfExtraByteLength;

        if (targetByteOffset !== header.byteLength) {
            throw new Error('targetByteOffset !== header.byteLength');
        }
    }

    return i3dmBuffer;
}

exports.default = createI3DM;

/***/ }),
/* 342 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
function padding(target, offset, byteLength) {
    var codePoint = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0;

    var p = new Uint8Array(target, offset, byteLength);
    for (var i = 0; i < byteLength; ++i) {
        p[i] = codePoint;
    }
}

exports.default = padding;

/***/ }),
/* 343 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _DynamicPoisPrimitive = __webpack_require__(344);

var _DynamicPoisPrimitive2 = _interopRequireDefault(_DynamicPoisPrimitive);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 图像配置

// const instanceData = [
// {
//     size: [800.0, 50.0],
//     origin: [0.0, 0.0],
//     subImageYOffset: 0,
//     subImageWidth: 1,
//     subImageHeight: 1,
//     animateImageNum: 4,
//     startTime: 0,
//     duration: 4000,
//     instancePosition: [-1.0, -1.0],
//     color: [255, 0, 0, 255],
// },
// ];

var defaultOptions = {
    show: true,
    imageUrl: ''
};

/**
 * 海量动态POI
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var DynamicPois = function (_XbsjCzmObj) {
    (0, _inherits3.default)(DynamicPois, _XbsjCzmObj);

    function DynamicPois(earth, guid) {
        (0, _classCallCheck3.default)(this, DynamicPois);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DynamicPois.__proto__ || (0, _getPrototypeOf2.default)(DynamicPois)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        // extendObservable(this, {
        //     _texture: undefined,
        // }, {
        //     _texture: observable.ref,
        // });

        _this._primitive = undefined;
        _this.disposers.push(function () {
            if (_this._primitive) {
                earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });
        _this._primitive = new _DynamicPoisPrimitive2.default();
        earth.czm.scene.primitives.add(_this._primitive);

        // // updatePrimitive2提到updatePrimitive之前，修复属性持续变化时，show设置之后不起作用的问题。
        // const updatePrimitive2 = () => {
        //     if (this._primitive) {
        //         this._primitive.show = this.show;
        //     }
        // };

        // updatePrimitive2();
        // this.disposers.push(reaction(() => ({
        //     show: this.show,
        // }), updatePrimitive2));

        // this.disposers.push(reaction(() => ({
        //     texture: this._texture,
        // }), updatePrimitive));

        // const updateCanvas = () => {
        //     const textureDirty = !(this._texture && this.canvasWidth === this._texture.width && this.canvasHeight === this._texture.height);

        //     if (textureDirty) {
        //         this._texture = this._texture && this._texture.destroy();

        //         if (this.canvasWidth > 0 && this.canvasHeight > 0) {
        //             this._texture = new Cesium.Texture({
        //                 context: earth.czm.scene.context,
        //                 width: this.canvasWidth,
        //                 height: this.canvasHeight,
        //                 source: undefined,
        //                 flipY: true,
        //             });
        //         }
        //     }

        //     if (!this._canvas) {
        //         const canvas = document.createElement('canvas');
        //         this._canvas = canvas;
        //         this._ctx = canvas.getContext('2d');
        //     }

        //     this._canvas.width = this.canvasWidth;
        //     this._canvas.height = this.canvasHeight;
        // }
        // this._updateCanvas = updateCanvas;

        // updateCanvas();
        // this.disposers.push(reaction(() => ({
        //     canvasWidth: this.canvasWidth,
        //     canvasHeight: this.canvasHeight,   
        // }), updateCanvas));

        // const updateImage = () => {
        //     if (this._imageSubscription) {
        //         this._imageSubscription.unsubscribe();
        //         this._imageSubscription = undefined;
        //     }

        //     if (this.imageUrl) {
        //         const observable = new rxjs.Observable(observer => {
        //             Cesium.Resource.createIfNeeded(this.imageUrl).fetchImage().then(function(image) {
        //                 observer.next(image);
        //             });
        //         });

        //         this._imageSubscription = observable.subscribe(image => {
        //             this.canvasWidth = image.naturalWidth;
        //             this.canvasHeight = image.naturalHeight;
        //             this.drawCanvas(ctx => {
        //                 ctx.clearRect(0, 0, image.naturalWidth, image.naturalHeight);
        //                 ctx.drawImage(image, 0, 0);
        //             });
        //             this._innerImage = image;
        //         });
        //     }
        // };

        // updateImage();
        // this.disposers.push(reaction(() => this.imageUrl, updateImage));
        return _this;
    }

    (0, _createClass3.default)(DynamicPois, [{
        key: 'getPrimitive',
        value: function getPrimitive() {
            return this._primitive;
        }

        // get texture() {
        //     return this._texture;
        // }

        // set texture(val) {
        //     this._texture = val;
        // }

    }, {
        key: 'flyTo',
        value: function flyTo() {
            // this._earth.camera.flyTo(this._bsCenter, this._bsRadius);
            // if (this._primitive) {
            //     const bs = this._primitive.boundingSphere;
            //     const carto = Cesium.Cartographic.fromCartesian(bs.center);
            //     const radius = bs.radius;
            //     this._earth.camera.flyTo([carto.longitude, carto.latitude, carto.height], radius*3.0);
            // }
        }
    }]);
    return DynamicPois;
}(_XbsjCzmObj3.default);

var xbsjSchema = {
    title: "DynamicPois Property",
    type: "object",
    properties: {
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.DynamicPois
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 纹理对应的图像url <br/>
         * 警告：一旦imageUrl有值，会导致drawCanvas调用失效！因此使用imageUrl之后，就不要再调用drawCanvas了！<br/>
         * @type {string}
         * @instance
         * @default ''
         * @memberof Obj.DynamicPois
         */
        imageUrl: { type: 'string', title: '纹理对应的图像url', default: 0, description: '纹理对应的图像url' }
    }
};

DynamicPois.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['show', 'imageUrl']
}];

DynamicPois.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(DynamicPois, 'DynamicPois');

exports.default = DynamicPois;

/***/ }),
/* 344 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _DynamicPoi = __webpack_require__(345);

var _DynamicPoi2 = _interopRequireDefault(_DynamicPoi);

var _createCommand = __webpack_require__(347);

var _createCommand2 = _interopRequireDefault(_createCommand);

var _propLayoutSpec3 = __webpack_require__(350);

var _propLayoutSpec4 = _interopRequireDefault(_propLayoutSpec3);

var _attributeBufferConfig = __webpack_require__(115);

var _createVertexArray = __webpack_require__(354);

var _createVertexArray2 = _interopRequireDefault(_createVertexArray);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function createInstanceBuffer(context, propLayoutSpec, propsSpec, instanceData) {
    var instanceBufferInfo = (0, _attributeBufferConfig.createOrSetBuffers)(propLayoutSpec, {
        userObjectIteratorOrIterable: instanceData,
        userObjectLength: instanceData.length,
        propsSpec: propsSpec
    });

    var instanceBuffer = Cesium.Buffer.createVertexBuffer({
        context: context,
        // bufferTarget: Cesium.WebGLConstants.ARRAY_BUFFER,
        // TODO(vtxf): Floate32的话，可能意味着buffer的大小必须是4的倍数，而此前并无此强制规定，是否可以改用Uint8Array?
        typedArray: new Float32Array(instanceBufferInfo.arrayBufferResult), // 不能直接用ArrayBuffer，很扯
        usage: Cesium.BufferUsage.STATIC_DRAW
    });

    instanceBuffer.vertexArrayDestroyable = false;

    return [instanceBuffer, instanceBufferInfo.arrayBufferResult];
} // @ts-check

function updateInstanceBuffer(propLayoutSpec, propsSpec, instanceData, instanceArrayBuffer, instanceBuffer) {
    var instanceBufferInfo = (0, _attributeBufferConfig.createOrSetBuffers)(propLayoutSpec, {
        userObjectIteratorOrIterable: instanceData,
        userObjectLength: instanceData.length,
        propsSpec: propsSpec,
        arrayBufferResult: instanceArrayBuffer
    });

    instanceBuffer.copyFromArrayView(new Float32Array(instanceBufferInfo.arrayBufferResult));
}

// function test(p) {
//     for (let i = 0; i < 10000; ++i) {
//         const c = Cesium.Cartesian3.fromDegrees(80.0 + Math.random() * 30.0, 20.0 + Math.random() * 50.0, 0.0);
//         const rs = 0.1 + 0.5 * Math.random();
//         const data = {
//             size: [159*rs, 183*rs],
//             origin: [0.5, 0.5],
//             subImageYOffset: 0,
//             subImageWidth: 159,
//             subImageHeight: 183,
//             animateImageNum: 5,
//             startTime: Math.random() * 2.0,
//             duration: Math.random() * 2.0,
//             // instancePosition: [-2177873.9967047274, 4389222.053178148, 4069473.6755001387],
//             instancePosition: [c.x, c.y, c.z],
//             color: [255, 255, 255, 255],
//             // rotationSpeed: Math.PI * 2.0 / (1.0 + Math.random() * 20.0),
//             rotationSpeed: 0.0,
//             scale: 1.0,
//             pixelOffset: [0, 100],
//         };
//         p.add(data);
//     }
// }

var DynamicPoisPrimitive = function () {
    function DynamicPoisPrimitive() {
        var _this = this;

        (0, _classCallCheck3.default)(this, DynamicPoisPrimitive);

        this._disposers = [];
        this._dynamicPois = [];

        this.show = true;
        this._bs = undefined;

        this._texture = undefined;
        this._textureSize = new Cesium.Cartesian4(1, 1, 1, 1);
        this._disposers.push(function () {
            _this._texture = _this._texture && _this._texture.destroy();
            _this._textureSize = undefined;
        });

        this._command = undefined;
        this._disposers.push(function () {
            if (Cesium.defined(_this._command)) {
                _this._command.shaderProgram = _this._command.shaderProgram && _this._command.shaderProgram.destroy();
                _this._command.vertexArray = _this._command.vertexArray && _this._command.vertexArray.destroy();
                _this._command = undefined;
            }
        });

        // this._pickId = this._pickId && this._pickId.destroy();

        this._instancePropertyDirty = true;
        this._instanceLengthDirty = true;

        this._instanceBuffer = undefined;
        this._disposers.push(function () {
            _this._instanceBuffer = _this._instanceBuffer && _this._instanceBuffer.destroy();
        });

        this._propLayoutSpec = _propLayoutSpec4.default;
        this._propsSpec = (0, _attributeBufferConfig.getPropsSpec)(this._propLayoutSpec);

        this._instanceData = [];

        this._imageUrl = '';
        this._imageUrlDirty = false;

        this._imageSubscription = undefined;
        this._disposers.push(function () {
            if (_this._imageSubscription) {
                _this._imageSubscription.unsubscribe();
                _this._imageSubscription = undefined;
            }
        });
    }

    (0, _createClass3.default)(DynamicPoisPrimitive, [{
        key: '_updateImage',
        value: function _updateImage(context) {
            var _this2 = this;

            if (!this._imageUrlDirty) {
                return;
            }

            this._imageUrlDirty = false;

            if (this._imageSubscription) {
                this._imageSubscription.unsubscribe();
                this._imageSubscription = undefined;
            }

            if (this._imageUrl) {
                var observable = new rxjs.Observable(function (observer) {
                    Cesium.Resource.createIfNeeded(_this2._imageUrl).fetchImage().then(function (image) {
                        observer.next(image);
                    });
                });

                this._imageSubscription = observable.subscribe(function (image) {
                    _this2._texture = _this2._texture && _this2._texture.destroy();

                    _this2._texture = new Cesium.Texture({
                        context: context,
                        source: image
                    });

                    var nw = image.naturalWidth;
                    var nh = image.naturalHeight;

                    _this2._textureSize.x = nw;
                    _this2._textureSize.y = nh;
                    _this2._textureSize.z = 1 / nw;
                    _this2._textureSize.w = 1 / nh;
                });
            }
        }
    }, {
        key: 'add',
        value: function add(options) {
            var dynamicPoi = new _DynamicPoi2.default(this, options);
            this._instanceData.push(dynamicPoi);

            this._instanceLengthDirty = true;
            return dynamicPoi;
        }
    }, {
        key: 'remove',
        value: function remove(dynamicPoi) {
            var index = this._instanceData.indexOf(dynamicPoi);
            if (-1 !== index) {
                // 销毁pickid
                var e = this._instanceData[index];
                e._pickId = e._pickId && e._pickId.destroy();
                e._pickColor = undefined;

                e._destroy();

                this._instanceData.splice(index, 1);
                this._instanceLengthDirty = true;
            }
        }
    }, {
        key: 'get',
        value: function get(index) {
            return this._instanceData[index];
        }
    }, {
        key: 'getLength',
        value: function getLength() {
            return this._instanceData.length;
        }
    }, {
        key: 'removeAll',
        value: function removeAll() {
            var length = this._instanceData.length;

            for (var i = 0; i < length; ++i) {
                // 销毁pickid
                var e = this._instanceData[i];
                e._pickId = e._pickId && e._pickId.destroy();
                e._pickColor = undefined;
                e._destroy();
            }

            this._instanceData.length = 0;
            this._instanceLengthDirty = true;
        }
    }, {
        key: 'update',
        value: function update(frameState) {
            var _this3 = this;

            if (!this.show) {
                return;
            }

            var context = frameState.context;
            this._updateImage(context);
            // if (!this._texture) {
            //     this._texture = new Cesium.Texture({
            //         context,
            //         width: 4,
            //         height: 1,
            //         source: {
            //             arrayBufferView: new Uint8Array([255, 0, 0, 255, 0, 255, 0, 255, 0, 0, 255, 255, 255, 255, 0, 255]),
            //         }
            //     });

            //     this._textureSize.x = 4;
            //     this._textureSize.y = 1;
            //     this._textureSize.z = 1/4;
            //     this._textureSize.w = 1/1;
            // }

            if (!Cesium.defined(this._command)) {
                var _getVertexShaderStrin = (0, _attributeBufferConfig.getVertexShaderStringAndAttributeLayoutSpec)(_propLayoutSpec4.default),
                    attributeLayoutSpec = _getVertexShaderStrin.attributeLayoutSpec,
                    vsDecl = _getVertexShaderStrin.vsDecl,
                    vsMainStart = _getVertexShaderStrin.vsMainStart;

                this._propLayoutSpec = _propLayoutSpec4.default;
                this._attributeLayoutSpec = attributeLayoutSpec;

                this._command = (0, _createCommand2.default)(context, this, vsDecl, vsMainStart);
                this._command.boundingVolume = this._bs;
                this._command.pickId = 'v_pickColor';
            }

            // userObject数量发生变化时需要重新创建vertexArray，否则直接修改instanceBuffer
            if (this._instanceLengthDirty) {
                this._instanceLengthDirty = false;
                this._instancePropertyDirty = false;

                this._instanceBuffer = this._instanceBuffer && this._instanceBuffer.destroy();
                this._instanceArrayBuffer = undefined;

                if (this._command.vertexArray) {
                    this._command.vertexArray.destroy();
                    this._command.vertexArray = undefined;
                    this._command.instanceCount = 0;
                }

                var instanceData = this._instanceData;

                if (instanceData.length > 0) {
                    var _context = frameState.context;

                    {
                        instanceData.forEach(function (e) {
                            if (!e._pickId) {
                                e._pickId = _context.createPickId({
                                    primitive: _this3,
                                    id: e
                                });
                                e._pickColor = e._pickId.color.toBytes();
                            }
                        });
                    }

                    var _propLayoutSpec = this._propLayoutSpec;
                    var propsSpec = this._propsSpec;

                    var _createInstanceBuffer = createInstanceBuffer(_context, _propLayoutSpec, propsSpec, instanceData),
                        _createInstanceBuffer2 = (0, _slicedToArray3.default)(_createInstanceBuffer, 2),
                        instanceBuffer = _createInstanceBuffer2[0],
                        instanceArrayBuffer = _createInstanceBuffer2[1];

                    this._instanceBuffer = instanceBuffer;
                    this._instanceArrayBuffer = instanceArrayBuffer;

                    var _attributeLayoutSpec = this._attributeLayoutSpec;
                    var vertexAttributes = this._command.shaderProgram.vertexAttributes;
                    var vertexArray = (0, _createVertexArray2.default)(_context, this._instanceBuffer, _attributeLayoutSpec, vertexAttributes);

                    this._command.vertexArray = vertexArray;
                    this._command.instanceCount = this._instanceData.length;
                }
            } else if (this._instancePropertyDirty) {
                this._instancePropertyDirty = false;

                var _propLayoutSpec2 = this._propLayoutSpec;
                var _propsSpec = this._propsSpec;
                updateInstanceBuffer(_propLayoutSpec2, _propsSpec, this._instanceData, this._instanceArrayBuffer, this._instanceBuffer);
            }

            if (Cesium.defined(this._command) && !!this._command.vertexArray) {
                frameState.commandList.push(this._command);
            }
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.reverse();
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            return Cesium.destroyObject(this);
        }
    }, {
        key: 'imageUrl',
        set: function set(val) {
            if (this._imageUrl !== val) {
                this._imageUrl = val;
                this._imageUrlDirty = true;
            }
        },
        get: function get() {
            return this._imageUrl;
        }
    }]);
    return DynamicPoisPrimitive;
}();

exports.default = DynamicPoisPrimitive;

/***/ }),
/* 345 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _doubleToFloats = __webpack_require__(346);

var _doubleToFloats2 = _interopRequireDefault(_doubleToFloats);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchResult = {
    high: undefined,
    low: undefined
}; // @ts-check


var generalProps = ['size', 'origin', 'subImageYOffset', 'subImageWidth', 'subImageHeight', 'animateImageNum', 'startTime', 'duration', 'rotationSpeed', 'scale', 'pixelOffset', 'color', 'show'];

var optionsDefaultValues = {
    size: undefined,
    origin: undefined,
    subImageYOffset: 0.0,
    subImageWidth: undefined,
    subImageHeight: undefined,
    animateImageNum: undefined,
    startTime: undefined,
    duration: undefined,
    rotationSpeed: 0.0,
    scale: 1.0,
    pixelOffset: [0.0, 0.0],
    color: [255, 255, 255, 255],
    show: true
};

var hiddenColor = [0, 0, 0, 0];

/***
 * @class 
 * @property {[number, number, number, number]} _color
 * @property {boolean} _show
 */

var DynamicPoi = function () {
    function DynamicPoi(dynamicPoisPrimitive, options) {
        var _this = this;

        (0, _classCallCheck3.default)(this, DynamicPoi);

        this._disposers = [];

        this._color = undefined;
        this._show = undefined;

        this._dynamicPoisPrimitive = dynamicPoisPrimitive;
        generalProps.forEach(function (e) {
            _this[e] = options[e] || optionsDefaultValues[e];
            if (typeof _this[e] === 'undefined') {
                console.warn('有属性值未undefined');
            }
        });

        this._instancePositionHigh = [0, 0, 0];
        this._instancePositionLow = [0, 0, 0];
        this.instancePosition = options.instancePosition;
    }

    (0, _createClass3.default)(DynamicPoi, [{
        key: 'onclick',
        value: function onclick() {
            this.scale = 1.5;
        }
    }, {
        key: 'onclickout',
        value: function onclickout() {
            this.scale = 1.0;
        }
    }, {
        key: 'onmouseover',
        value: function onmouseover() {
            this.scale = 1.2;
        }
    }, {
        key: 'onmouseout',
        value: function onmouseout() {
            this.scale = 1.0;
        }
    }, {
        key: 'isDestroyed',
        value: function isDestroyed() {
            return false;
        }

        // 给_dynamicPoisPrimitive来调用

    }, {
        key: '_destroy',
        value: function _destroy() {
            this._disposers.reverse();
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            return Cesium.destroyObject(this);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._dynamicPoisPrimitive.remove(this);
        }
    }, {
        key: 'instancePosition',
        get: function get() {
            return this._instancePosition;
        },
        set: function set(val) {
            if (this._instancePosition !== val) {
                this._instancePosition = val;

                for (var i = 0; i < 3; ++i) {
                    var r = (0, _doubleToFloats2.default)(this._instancePosition[i], scratchResult);
                    this._instancePositionHigh[i] = r.high;
                    this._instancePositionLow[i] = r.low;
                }

                this._dynamicPoisPrimitive._instancePropertyDirty = true;
            }
        }
    }, {
        key: 'instancePositionHigh',
        get: function get() {
            return this._instancePositionHigh;
        }
    }, {
        key: 'instancePositionLow',
        get: function get() {
            return this._instancePositionLow;
        }
    }, {
        key: 'blendColor',
        get: function get() {
            if (!this._show) {
                return hiddenColor;
            } else {
                return this._color;
            }
        }
    }, {
        key: 'allowPicking',
        get: function get() {
            return true;
        }
    }]);
    return DynamicPoi;
}();

function makeProp(propName) {
    (0, _defineProperty2.default)(DynamicPoi.prototype, propName, {
        get: function get() {
            return this['_' + propName];
        },
        set: function set(val) {
            if (this['_' + propName] !== val) {
                this['_' + propName] = val;
                this._dynamicPoisPrimitive._instancePropertyDirty = true;
            }
        }
    });
}

generalProps.forEach(makeProp);

exports.default = DynamicPoi;

/***/ }),
/* 346 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

// @ts-check

/***
 * doubleToFloats
 * @param {number} value 
 * @param {{
 *     high?: number,
 *     low?: number,
 * }} [result] 
 */
function doubleToFloats(value, result) {
    result = result || {};

    var doubleHigh;
    if (value >= 0.0) {
        doubleHigh = Math.floor(value / 65536.0) * 65536.0;
        result.high = doubleHigh;
        result.low = value - doubleHigh;
    } else {
        doubleHigh = Math.floor(-value / 65536.0) * 65536.0;
        result.high = -doubleHigh;
        result.low = value + doubleHigh;
    }

    return result;
}

exports.default = doubleToFloats;

/***/ }),
/* 347 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _createShaderProgram = __webpack_require__(348);

var _createShaderProgram2 = _interopRequireDefault(_createShaderProgram);

var _getRenderState = __webpack_require__(349);

var _getRenderState2 = _interopRequireDefault(_getRenderState);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// import propLayoutSpec from './propLayoutSpec';

// @ts-check
/// <reference path="../misc.d.ts" />

function createCommand(context, primitive, vsDecl, vsMainStart) {
    var shaderProgram = (0, _createShaderProgram2.default)(context, vsDecl, vsMainStart);

    var ONE = new Cesium.Cartesian4(1, 1, 1, 1);
    var uniformMap = {
        u_animateTexture: function u_animateTexture() {
            return primitive._texture || context.defaultTexture;
            // return context.defaultTexture;
        },
        u_engineTime: function u_engineTime() {
            return Date.now() % (1000 * 60 * 60 * 3) / 1000;
        },
        u_animateTextureSize: function u_animateTextureSize() {
            if (primitive._textureSize) {
                return primitive._textureSize;
            } else {
                return ONE;
            }
        }
    };

    var renderState = Cesium.RenderState.fromCache((0, _getRenderState2.default)(true, true));
    var primitiveType = Cesium.PrimitiveType.TRIANGLES;
    var pass = Cesium.Pass.TRANSLUCENT; // Cesium.Pass.OPAQUE;
    var modelMatrix = Cesium.Matrix4.IDENTITY;

    return new Cesium.DrawCommand({
        // vertexArray,
        primitiveType: primitiveType,
        renderState: renderState,
        shaderProgram: shaderProgram,
        uniformMap: uniformMap,
        owner: this,
        pass: pass,
        modelMatrix: modelMatrix,
        cull: false,
        instanceCount: primitive._instanceData.length
    });
}

exports.default = createCommand;

/***/ }),
/* 348 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

// @ts-check

/***
 * 
 * @param {string} vsDecl 
 * @param {string} vsMainStart 
 * @returns {string}
 */
var getVertexShaderSourceString = function getVertexShaderSourceString(vsDecl, vsMainStart) {
    var vertexShaderSourceString = "\n        precision highp float;\n\n        attribute vec2 positionOrTexCoord;\n\n        " + vsDecl + "\n\n        // uniform vec4 czm_viewport;\n        uniform float u_engineTime;\n        uniform vec4 u_animateTextureSize; // u_animateTextureSize => imageWidth, imageHeight, 1.0/imageWidth, 1.0/imageHeight\n\n        varying vec2 v_texCoord;\n        varying vec4 v_color;\n        varying vec4 v_pickColor;\n        void main() {\n            " + vsMainStart + "\n\n            vec4 p = czm_translateRelativeToEye(instancePositionHigh, instancePositionLow);\n            vec4 instancePosition = czm_modelViewProjectionRelativeToEye * p;\n            instancePosition /= instancePosition.w;\n\n            float rotationRatio = 0.0;\n            if (rotationSpeed != 0.0) {\n                float rotationDuration = 2.0 * 3.14159265 / rotationSpeed;\n                rotationRatio = mod(u_engineTime + startTime, rotationDuration) / rotationDuration;\n            }\n            vec2 localPos = (positionOrTexCoord - origin) * size * 2.0;\n            mat2 scaleM = mat2(scale, 0.0, 0.0, scale);\n            vec2 csr = vec2(cos(rotationRatio * 3.14159265 * 2.0), sin(rotationRatio * 3.14159265 * 2.0));\n            mat2 rotateM = mat2(csr, -csr.y, csr.x);\n            localPos = rotateM * scaleM * localPos;\n            localPos /= czm_viewport.zw;\n            vec2 offsetW = pixelOffset * 2.0 / czm_viewport.zw;\n            gl_Position = vec4(localPos + instancePosition.xy + offsetW, instancePosition.z, 1.0);\n\n            vec2 subImageSize = vec2(subImageWidth, subImageHeight);\n\n            float timeRatio = 0.0;\n            if (duration != 0.0) {\n                timeRatio = mod(u_engineTime + startTime, duration) / duration;\n            }\n            float diffX = floor(timeRatio * animateImageNum) * (subImageSize.x * u_animateTextureSize.z);\n            float diffY = subImageYOffset * u_animateTextureSize.w;\n\n            v_texCoord = positionOrTexCoord * subImageSize * u_animateTextureSize.zw + vec2(diffX, diffY);\n            v_color = blendColor;\n            v_pickColor = _pickColor;\n        }\n    ";

    return vertexShaderSourceString;
};

var fragmentShaderSourceString = "\n    precision highp float;\n    varying vec2 v_texCoord;\n    varying vec4 v_color;\n    varying vec4 v_pickColor;\n\n    uniform sampler2D u_animateTexture;\n    void main() {\n        gl_FragColor = texture2D(u_animateTexture, v_texCoord) * v_color;\n    }\n";

function createShaderProgram(context, vsDecl, vsMainStart) {
    var vertexShaderSource = new Cesium.ShaderSource({
        sources: [getVertexShaderSourceString(vsDecl, vsMainStart)]
    });

    var fragmentShaderSource = new Cesium.ShaderSource({
        sources: [fragmentShaderSourceString]
    });

    var shaderProgram = Cesium.ShaderProgram.fromCache({
        context: context,
        vertexShaderSource: vertexShaderSource,
        fragmentShaderSource: fragmentShaderSource
        // attributeLocations,
    });

    return shaderProgram;
}

exports.default = createShaderProgram;

/***/ }),
/* 349 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// @ts-check

function getRenderState(translucent, closed) {
    var rs = {
        depthTest: {
            enabled: true
        }
    };

    if (translucent) {
        rs.depthMask = false;
        rs.blending = Cesium.BlendingState.ALPHA_BLEND;
    }

    if (closed) {
        rs.cull = {
            enabled: true,
            face: Cesium.CullFace.BACK
        };
    }

    return rs;
};

exports.default = getRenderState;

/***/ }),
/* 350 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _attributeBufferConfig = __webpack_require__(115);

/***
 * @type { import('./attributeBufferConfig').PropLayoutSpec }
 */
var propLayoutSpec = {
    accessors: [{
        type: _attributeBufferConfig.AttributeType.FLOAT,
        size: 4,
        composite: [[2, 'size'], [2, 'origin']]
    }, {
        type: _attributeBufferConfig.AttributeType.FLOAT,
        size: 4,
        composite: [[1, 'subImageYOffset'], [1, 'subImageWidth'], [1, 'subImageHeight'], [1, 'animateImageNum']]
    },
    // {
    //     type: AttributeType.FLOAT,
    //     size: 2,
    //     composite: [
    //         [1, 'startTime'],
    //         [1, 'duration'],
    //     ],
    // },
    {
        type: _attributeBufferConfig.AttributeType.FLOAT,
        size: 4,
        composite: [[3, 'instancePositionHigh'], [1, 'startTime']]
    }, {
        type: _attributeBufferConfig.AttributeType.FLOAT,
        size: 4,
        composite: [[3, 'instancePositionLow'], [1, 'duration']]
    }, {
        type: _attributeBufferConfig.AttributeType.UNSIGNED_BYTE,
        size: 4,
        propName: '_pickColor'
    }, {
        type: _attributeBufferConfig.AttributeType.UNSIGNED_BYTE,
        size: 4,
        propName: 'blendColor'
    }, {
        type: _attributeBufferConfig.AttributeType.FLOAT,
        size: 4,
        composite: [[1, 'rotationSpeed'], [1, 'scale'], [2, 'pixelOffset']]
    }]
}; // @ts-check

exports.default = propLayoutSpec;

/***/ }),
/* 351 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(352), __esModule: true };

/***/ }),
/* 352 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(353);
module.exports = __webpack_require__(14).Object.values;


/***/ }),
/* 353 */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/tc39/proposal-object-values-entries
var $export = __webpack_require__(16);
var $values = __webpack_require__(168)(false);

$export($export.S, 'Object', {
  values: function values(it) {
    return $values(it);
  }
});


/***/ }),
/* 354 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _entries = __webpack_require__(355);

var _entries2 = _interopRequireDefault(_entries);

var _attributeBufferConfig = __webpack_require__(115);

var _webglConsts = __webpack_require__(169);

var _webglConsts2 = _interopRequireDefault(_webglConsts);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 示例
// const instanceData = [
//     {
//         size: [800.0, 50.0],
//         origin: [0.0, 0.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 0,
//         duration: 4000,
//         instancePosition: [-1.0, -1.0],
//         color: [255, 0, 0, 255],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [1.0, 0.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 5000,
//         duration: 20000,
//         instancePosition: [1.0, -1.0],
//         color: [0, 255, 0, 255],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [1.0, 1.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 10000,
//         duration: 20000,
//         instancePosition: [1.0, 1.0],
//         color: [0, 0, 255, 255],
//     },
//     {
//         size: [100.0, 50.0],
//         origin: [0.0, 1.0],
//         subImageYOffset: 0,
//         subImageWidth: 1,
//         subImageHeight: 1,
//         animateImageNum: 4,
//         startTime: 15000,
//         duration: 20000,
//         instancePosition: [-1.0, 1.0],
//         color: [255, 255, 0, 255],
//     },
// ];

/***
 * 创建实例用的VertexArray
 * 
 * @param {*} context Cesium的Context
 * @param { * } instanceBuffer
 * @param { import('./attributeBufferConfig').AttributeLayoutSpec } attributeLayoutSpec 提供attribute的名字、offset等信息
 * @param { {
 *     [x: string]: {
 *          index: number,
 *     },
 * } } vertexAttributes 提供index信息，从ShaderProgram.vertexAttribs获取，需要转化一下
 */
// @ts-check
/// <reference path="../misc.d.ts" />

function createVertexArray(context, instanceBuffer, attributeLayoutSpec, vertexAttributes) {

    // attributes的形式如下：
    // var attributes = [
    //     {
    //         index                  : 0,
    //         vertexBuffer           : buffer,
    //         componentsPerAttribute : 3,
    //         componentDatatype      : ComponentDatatype.FLOAT,
    //         offsetInBytes          : 0
    //         strideInBytes          : 24,
    //         normalize              : true,
    //         instanceDivisor        : 0 // not instanced
    //     },
    //     {
    //         vertexBuffer           : buffer,
    //         componentsPerAttribute : 3,
    //         componentDatatype      : ComponentDatatype.FLOAT,
    //         normalize              : true,
    //         offsetInBytes          : 12,
    //         strideInBytes          : 24
    //     }
    // ];

    var attributes = (0, _entries2.default)(attributeLayoutSpec).map(function (_ref) {
        var _ref2 = (0, _slicedToArray3.default)(_ref, 2),
            k = _ref2[0],
            v = _ref2[1];

        if (!vertexAttributes[k]) {
            console.warn('\u5C5E\u6027' + k + '\u6CA1\u6709\u4F7F\u7528\uFF01');
            return undefined;
        }

        var index = vertexAttributes[k].index;
        var componentsPerAttribute = v.size,
            offsetInBytes = v.offset,
            componentDatatype = v.type,
            strideInBytes = v.stride;

        // const strideInBytes = propsSpec.vertexByteLength;

        return {
            index: index,
            vertexBuffer: instanceBuffer,
            componentsPerAttribute: componentsPerAttribute,
            componentDatatype: componentDatatype,
            offsetInBytes: offsetInBytes,
            strideInBytes: strideInBytes,
            normalize: componentDatatype !== _webglConsts2.default.FLOAT ? true : false,
            instanceDivisor: 1
        };
    }).filter(function (e) {
        return !!e;
    });

    // 补充普通的顶点坐标
    {
        var vertexBuffer = Cesium.Buffer.createVertexBuffer({
            context: context,
            // bufferTarget: Cesium.WebGLConstants.ARRAY_BUFFER,
            // TODO(vtxf): Floate32的话，可能意味着buffer的大小必须是4的倍数，而此前并无此强制规定，是否可以改用Uint8Array?
            typedArray: new Float32Array([0, 0, 1, 0, 1, 1, 0, 1]), // 不能直接用ArrayBuffer，很扯
            usage: Cesium.BufferUsage.STATIC_DRAW
        });

        var index = vertexAttributes['positionOrTexCoord'].index;
        attributes.push({
            index: index,
            vertexBuffer: vertexBuffer,
            componentsPerAttribute: 2,
            componentDatatype: _webglConsts2.default.FLOAT,
            offsetInBytes: 0,
            strideInBytes: 0,
            normalize: false,
            instanceDivisor: 0
        });
    }

    var elementsBuffer = Cesium.Buffer.createIndexBuffer({
        context: context,
        typedArray: new Uint16Array([0, 1, 2, 0, 2, 3]),
        usage: Cesium.BufferUsage.STATIC_DRAW,
        indexDatatype: Cesium.IndexDatatype.UNSIGNED_SHORT
    });

    var va = new Cesium.VertexArray({
        context: context,
        attributes: attributes,
        indexBuffer: elementsBuffer
    });

    return va;
}

exports.default = createVertexArray;

/***/ }),
/* 355 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(356), __esModule: true };

/***/ }),
/* 356 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(357);
module.exports = __webpack_require__(14).Object.entries;


/***/ }),
/* 357 */
/***/ (function(module, exports, __webpack_require__) {

// https://github.com/tc39/proposal-object-values-entries
var $export = __webpack_require__(16);
var $entries = __webpack_require__(168)(true);

$export($export.S, 'Object', {
  entries: function entries(it) {
    return $entries(it);
  }
});


/***/ }),
/* 358 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _PlotBase2 = __webpack_require__(113);

var _PlotBase3 = _interopRequireDefault(_PlotBase2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

var _geoDistance = __webpack_require__(65);

var _geoDistance2 = _interopRequireDefault(_geoDistance);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 贴地道路
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var Road = function (_PlotBase) {
    (0, _inherits3.default)(Road, _PlotBase);

    function Road(earth, guid) {
        (0, _classCallCheck3.default)(this, Road);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Road.__proto__ || (0, _getPrototypeOf2.default)(Road)).call(this, earth, guid));

        var scene = _this._earth.czm.scene;
        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._onlyMove = false;
        _this._fixedPositionsNum = undefined;

        _this._road = undefined;
        _this.disposers.push(function () {
            if (_this._road) {
                scene.groundPrimitives.remove(_this._road);
                _this._road = undefined;
            }
        });

        _this._material = undefined;
        (0, _mobx.extendObservable)(_this, {
            _texture: undefined
        }, {
            _texture: _mobx.observable.ref
        });

        _this.disposers.push(function () {
            // material如果拿着texture，那么material销毁时，就会销毁这个texture，这里就不能重复销毁了！
            if (_this._material && _this._material.uniforms.image !== _this._texture) {
                _this._texture.destroy();
                _this._texture = undefined;
            }
            if (_this._material) {
                _this._material.destroy();
                _this._material = undefined;
            }
        });

        var updateTexture = function updateTexture() {
            var imageUrl = _HTML2.default.xbsjEarthDir + 'images/roadImages/4.jpg';
            if (_this.imageUrl !== '') {
                imageUrl = _this.imageUrl;
            }

            _this._loadingImage = _this._loadingImage && _this._loadingImage();
            _this._loadingImage = function () {
                var valid = true;
                Cesium.Resource.fetchImage({
                    url: imageUrl
                }).then(function (image) {
                    if (valid) {
                        var width = image.naturalWidth;
                        var height = image.naturalHeight;
                        _this._texture = new Cesium.Texture({
                            context: scene.context,
                            source: image,
                            width: width,
                            height: height
                            // sampler,
                            // pixelFormat: Cesium.PixelFormat.RGBA,
                            // pixelDatatype: Ceisum.PixelDatatype.UNSIGNED_BYTE,
                        });

                        if (Cesium.Math.isPowerOfTwo(width) && Cesium.Math.isPowerOfTwo(height)) {
                            var sampler = new Cesium.Sampler({
                                wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
                                wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
                                minificationFilter: Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,
                                magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
                            });
                            _this._texture.sampler = sampler;
                            _this._texture.generateMipmap(Cesium.MipmapHint.NICEST);
                        }

                        // 记录一下当前正在使用的imageUrl，和this.imageUrl有可能不同
                        _this._currentImageUrl = imageUrl;
                    }
                }).otherwise(function (error) {
                    console.error('图像加载错误！');
                    _this._loadingImage = _this._loadingImage && _this._loadingImage();
                });

                return function () {
                    valid = false;
                };
            }();
        };

        updateTexture();
        _this.disposers.push(XE.MVVM.watch(function () {
            return {
                imageUrl: _this.imageUrl
            };
        }, updateTexture));

        // const updateMaterial = () => {
        //     if (!this._material) {
        //         const material = Cesium.Material.fromType(Cesium.Material.ImageType);
        //         // material.uniforms.image = 'https://www.baidu.com/img/bd_logo1.png?where=super';
        //         material.uniforms.image = HTML.xbsjEarthDir + 'images/roadImages/4.jpg';
        //         material.uniforms.repeat = new Cesium.Cartesian2(100.0, 1.0);
        //         this._material = material;
        //     }

        //     const material = this._material;
        //     if (this.imageUrl === '') {
        //         material.uniforms.image = HTML.xbsjEarthDir + 'images/roadImages/4.jpg';
        //     } else {
        //         material.uniforms.image = this.imageUrl;
        //     }
        //     material.uniforms.repeat.x = this.repeat;
        // }
        // updateMaterial();
        // this.disposers.push(XE.MVVM.watch(() => ({
        //     repeat: this.repeat,
        //     imageUrl: this.imageUrl,
        // }), updateMaterial));

        _this._totalDistance = 100.0;

        var updateMaterial = function updateMaterial() {
            if (!_this._material) {
                var _material = Cesium.Material.fromType(Cesium.Material.ImageType);
                // material.uniforms.image = 'https://www.baidu.com/img/bd_logo1.png?where=super';
                // material.uniforms.image = HTML.xbsjEarthDir + 'images/roadImages/4.jpg';
                _material.uniforms.repeat = new Cesium.Cartesian2(100.0, 1.0);
                _this._material = _material;
            }
            var material = _this._material;
            material.uniforms.image = _this._texture;
            if (_this._texture) {
                material.uniforms.repeat.x = _this._totalDistance / _this.width * (_this._texture.height / _this._texture.width) / _this.scale;
            }
        };
        updateMaterial();
        _this.disposers.push(XE.MVVM.watch(function () {
            return {
                scale: _this.scale,
                _texture: _this._texture
            };
        }, updateMaterial));

        _this._boundingSphere = new Cesium.BoundingSphere(Cesium.Cartesian3.fromDegrees(0, 0, 0), 10.0);

        var updateRoad = function updateRoad() {
            if (_this._road) {
                scene.groundPrimitives.remove(_this._road);
                _this._road = undefined;
            }

            var positions = _this.positions;
            if (positions.length >= 2) {
                var positionsWithHeight = positions.reduce(function (a, c) {
                    return a.push.apply(a, (0, _toConsumableArray3.default)(c)), a;
                }, []);

                var _positions$reduce = positions.reduce(function (a, c) {
                    if (a[1]) {
                        a[0] += (0, _geoDistance2.default)(a[1], c);
                        return [a[0], c];
                    } else {
                        return [0, c];
                    }
                }, [0, undefined]),
                    _positions$reduce2 = (0, _slicedToArray3.default)(_positions$reduce, 1),
                    totalDistance = _positions$reduce2[0];

                _this._totalDistance = totalDistance;
                updateMaterial();

                var cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);

                _this._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this._boundingSphere);

                _this._road = scene.groundPrimitives.add(new Cesium.XbsjRoad({
                    geometryInstances: new Cesium.GeometryInstance({
                        geometry: new Cesium.GroundPolylineGeometry({
                            positions: cartesians,
                            width: _this.width
                        })
                    }),
                    appearance: new Cesium.PolylineMaterialAppearance({
                        material: _this._material
                    }),
                    asynchronous: false
                }));

                _this._road.show = _this.show;
            }
        };
        updateRoad();
        _this.disposers.push(XE.MVVM.watch(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                }))),
                width: _this.width
            };
        }, updateRoad));

        var updateRoad2 = function updateRoad2() {
            if (_this._road) {
                _this._road.show = _this.show;
            }
        };

        updateRoad2();
        _this.disposers.push(XE.MVVM.watch(function () {
            return {
                show: _this.show
            };
        }, updateRoad2));
        return _this;
    }

    (0, _createClass3.default)(Road, [{
        key: 'getTotalDistance',

        /**
         * 获取道路总长，单位米
         */
        value: function getTotalDistance() {
            return this._totalDistance;
        }

        /**
         * 获取道路总面积，单位平方米
         */

    }, {
        key: 'getTotalArea',
        value: function getTotalArea() {
            return this._totalDistance * this.width;
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.czm.scene.camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'onlyMove',
        get: function get() {
            return this._onlyMove;
        }
    }, {
        key: 'fixedPositionsNum',
        get: function get() {
            return this._fixedPositionsNum;
        }
    }]);
    return Road;
}(_PlotBase3.default);

Road.defaultOptions = {
    /**
     * 位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Road
     */
    positions: [],
    /**
     * 显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Road
     */
    show: true,
    /**
     * 道路宽度，单位米
     * @type {number}
     * @instance
     * @default 15.0
     * @memberof Obj.Road
     */
    width: 15.0,
    /**
     * 道路纹理缩放比例
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Road
     */
    scale: 1.0,
    /**
     * 道路纹理图像，图像的尺寸最好是2的幂次，即256、512、1024等
     * @type {number}
     * @instance
     * @default ''
     * @memberof Obj.Road
     */
    imageUrl: ''
};

_XbsjObject2.default.registerType(Road, 'Road');

exports.default = Road;

/***/ }),
/* 359 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _PlotBase2 = __webpack_require__(113);

var _PlotBase3 = _interopRequireDefault(_PlotBase2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

var _geoDistance = __webpack_require__(65);

var _geoDistance2 = _interopRequireDefault(_geoDistance);

var _GetXEPolylineVolumeGeometry = __webpack_require__(360);

var _GetXEPolylineVolumeGeometry2 = _interopRequireDefault(_GetXEPolylineVolumeGeometry);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 贴地道路
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var Wall = function (_PlotBase) {
    (0, _inherits3.default)(Wall, _PlotBase);

    function Wall(earth, guid) {
        (0, _classCallCheck3.default)(this, Wall);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Wall.__proto__ || (0, _getPrototypeOf2.default)(Wall)).call(this, earth, guid));

        var scene = _this._earth.czm.scene;
        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._onlyMove = false;
        _this._fixedPositionsNum = undefined;

        _this._primitive = undefined;
        _this.disposers.push(function () {
            if (_this._primitive) {
                scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;
            }
        });

        _this._roofPrimitive = undefined;
        _this.disposers.push(function () {
            if (_this._roofPrimitive) {
                scene.primitives.remove(_this._roofPrimitive);
                _this._roofPrimitive = undefined;
            }
        });

        _this._updateWallMaterialAndTexture(scene);
        _this._updateRoofMaterialAndTexture(scene);

        _this._boundingSphere = new Cesium.BoundingSphere(Cesium.Cartesian3.fromDegrees(0, 0, 0), 10.0);
        _this._updateWall(scene);

        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.show;
        }, function () {
            _this._updateShow();
        }));
        return _this;
    }

    (0, _createClass3.default)(Wall, [{
        key: '_updateMaterial',
        value: function _updateMaterial() {
            if (!this._material) {
                this._material = Cesium.Material.fromType('Image');
            }
            var material = this._material;
            material.uniforms.image = this._texture;
            if (this._texture) {
                material.uniforms.repeat.x = this._totalDistance / this.wallImageHeight * (this._texture.height / this._texture.width) / this.scale;
                material.uniforms.repeat.y = this.height / this.wallImageHeight;
            }
        }
    }, {
        key: '_updateShow',
        value: function _updateShow() {
            if (this._primitive) {
                this._primitive.show = this.show;
            }
            if (this._roofPrimitive) {
                this._roofPrimitive.show = this.show;
            }
        }
    }, {
        key: '_updateWall',
        value: function _updateWall(scene) {
            var _this2 = this;

            var updateWall = function updateWall() {
                if (_this2._primitive) {
                    scene.primitives.remove(_this2._primitive);
                    _this2._primitive = undefined;
                }
                if (_this2._roofPrimitive) {
                    scene.primitives.remove(_this2._roofPrimitive);
                    _this2._roofPrimitive = undefined;
                }
                var positions = _this2.positions;
                if (positions.length >= 2) {
                    var positionsWithHeight = positions.reduce(function (a, c) {
                        return a.push.apply(a, (0, _toConsumableArray3.default)(c)), a;
                    }, []);

                    var _positions$reduce = positions.reduce(function (a, c) {
                        if (a[1]) {
                            a[0] += (0, _geoDistance2.default)(a[1], c);
                            return [a[0], c];
                        } else {
                            return [0, c];
                        }
                    }, [0, undefined]),
                        _positions$reduce2 = (0, _slicedToArray3.default)(_positions$reduce, 1),
                        totalDistance = _positions$reduce2[0];

                    _this2._totalDistance = totalDistance;

                    // updateMaterial();
                    _this2._updateMaterial();
                    _this2._updateRoofMaterial();
                    _this2._updateShow();

                    var cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);
                    var cartesians2 = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);
                    _this2._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this2._boundingSphere);
                    {
                        var hd = _this2.depth * 0.5;
                        var h = _this2.height;
                        var wallShape = [new Cesium.Cartesian3(-hd, 0, 0.0), new Cesium.Cartesian3(hd, 0, 0.0), new Cesium.Cartesian3(hd, h, 0.99), new Cesium.Cartesian3(-hd, h, 0.99)];
                        var PolylineVolumeGeometry = (0, _GetXEPolylineVolumeGeometry2.default)();
                        // const PolylineVolumeGeometry = Cesium.PolylineVolumeGeometry;
                        // Create the polyline volume geometry instance.  The corderType option
                        // can be set to draw rounded, beveled or mitered corners.

                        var geometry = PolylineVolumeGeometry.createGeometry(new PolylineVolumeGeometry({
                            polylinePositions: cartesians,
                            vertexFormat: Cesium.VertexFormat.ALL,
                            shapePositions: wallShape,
                            cornerType: Cesium.CornerType.BEVELED
                        }));

                        if (geometry) {
                            // sts修正
                            // attributes中最后8个顶点刚好是两个侧面的，修改它们的纹理坐标就能覆盖上
                            {
                                // 修正两端侧面
                                var sts = geometry.attributes.st.values;
                                var faceLen = 4;
                                var start = sts.length - 2 * 2 * faceLen;
                                var step = _this2.depth / _this2._totalDistance;
                                sts[start + 1 * 2] += step;
                                sts[start + 2 * 2] += step;
                                sts[start + 4 * 2] -= step;
                                sts[start + 7 * 2] -= step;
                            }

                            {
                                // 修正顶面
                                var _sts = geometry.attributes.st.values;
                                var _faceLen = 4;
                                var end = _sts.length - 2 * 2 * _faceLen;
                                var _step = _this2.depth / _this2.wallImageHeight;

                                for (var i = 0; i < end; i += 16) {
                                    _sts[i + 4 * 2 + 1] = 0;
                                    _sts[i + 5 * 2 + 1] = _step;
                                }
                            }

                            var wallGeometry = new Cesium.GeometryInstance({
                                geometry: geometry
                            });
                            // Add all instances to primitives.
                            _this2._primitive = scene.primitives.add(new Cesium.Primitive({
                                geometryInstances: [wallGeometry],
                                appearance: new Cesium.MaterialAppearance({
                                    // vertexShaderSource: vs,
                                    // fragmentShaderSource: fs,
                                    material: _this2._material,
                                    translucent: false,
                                    closed: true,
                                    renderState: _this2.creating ? {
                                        depthMask: false
                                    } : undefined
                                }),
                                compressVertices: false,
                                asynchronous: false
                            }));
                        }
                    }
                    {
                        var _hd = _this2.depth * 0.5;
                        var _h = _this2.height;
                        var roofShape = [new Cesium.Cartesian3(-(_hd - 0.01), _h, 0.0), new Cesium.Cartesian3(_hd - 0.01, _h, 0.99), new Cesium.Cartesian3(_hd, _h + 0.01, 0.99), new Cesium.Cartesian3(-_hd, _h + 0.01, 0.0)];
                        var _PolylineVolumeGeometry = (0, _GetXEPolylineVolumeGeometry2.default)();
                        // const PolylineVolumeGeometry = Cesium.PolylineVolumeGeometry;
                        // Create the polyline volume geometry instance.  The corderType option
                        // can be set to draw rounded, beveled or mitered corners.
                        var roofGeometry = new Cesium.GeometryInstance({
                            geometry: new _PolylineVolumeGeometry({
                                polylinePositions: cartesians2,
                                vertexFormat: Cesium.VertexFormat.ALL,
                                shapePositions: roofShape,
                                cornerType: Cesium.CornerType.BEVELED
                            })
                        });
                        // Add all instances to primitives.
                        _this2._roofPrimitive = scene.primitives.add(new Cesium.Primitive({
                            geometryInstances: [roofGeometry],
                            appearance: new Cesium.MaterialAppearance({
                                material: _this2._roofMaterial,
                                translucent: false,
                                closed: true,
                                renderState: _this2.creating ? {
                                    depthMask: false
                                } : undefined
                            }),
                            compressVertices: false,
                            asynchronous: false
                        }));
                    }
                }
            };
            updateWall();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this2.positions.map(function (e) {
                        return [].concat((0, _toConsumableArray3.default)(e));
                    }))),
                    height: _this2.height,
                    depth: _this2.depth,
                    creating: _this2.creating
                };
            }, updateWall));
        }
    }, {
        key: '_updateWallMaterialAndTexture',
        value: function _updateWallMaterialAndTexture(scene) {
            var _this3 = this;

            this._material = undefined;
            (0, _mobx.extendObservable)(this, {
                _texture: undefined
            }, {
                _texture: _mobx.observable.ref
            });
            this.disposers.push(function () {
                // material如果拿着texture，那么material销毁时，就会销毁这个texture，这里就不能重复销毁了！
                if (_this3._material && _this3._material.uniforms.image !== _this3._texture) {
                    _this3._texture.destroy();
                    _this3._texture = undefined;
                }
                if (_this3._material) {
                    _this3._material.destroy();
                    _this3._material = undefined;
                }
            });
            var updateTexture = function updateTexture() {
                var imageUrl = _HTML2.default.xbsjEarthDir + 'images/wallImages/4.jpg';
                if (_this3.imageUrl !== '') {
                    imageUrl = _this3.imageUrl;
                }
                _this3._loadingImage = _this3._loadingImage && _this3._loadingImage();
                _this3._loadingImage = function () {
                    var valid = true;
                    Cesium.Resource.fetchImage({
                        url: imageUrl
                    }).then(function (image) {
                        if (valid) {
                            _this3._texture = createTexture(image, scene);

                            // 记录一下当前正在使用的imageUrl，和this.imageUrl有可能不同
                            _this3._currentImageUrl = imageUrl;
                        }
                    }).otherwise(function (error) {
                        console.error('图像加载错误！');
                        _this3._loadingImage = _this3._loadingImage && _this3._loadingImage();
                    });
                    return function () {
                        valid = false;
                    };
                }();
            };
            updateTexture();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    imageUrl: _this3.imageUrl
                };
            }, updateTexture));
            this._totalDistance = 100.0;

            this._updateMaterial();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    scale: _this3.scale,
                    _texture: _this3._texture,
                    _totalDistance: _this3._totalDistance,
                    wallImageHeight: _this3.wallImageHeight,
                    height: _this3.height
                };
            }, function () {
                return _this3._updateMaterial();
            }));
        }
    }, {
        key: '_updateRoofMaterial',
        value: function _updateRoofMaterial() {
            if (!this._roofMaterial) {
                this._roofMaterial = Cesium.Material.fromType('Image');
            }
            var material = this._roofMaterial;
            material.uniforms.image = this._roofTexture;
            if (this._roofTexture) {
                material.uniforms.repeat.x = this._totalDistance / this.roofImageHeight * (this._roofTexture.height / this._roofTexture.width) / this.scale;
                material.uniforms.repeat.y = this.depth / this.roofImageHeight;
            }
        }
    }, {
        key: '_updateRoofMaterialAndTexture',
        value: function _updateRoofMaterialAndTexture(scene) {
            var _this4 = this;

            this._roofMaterial = undefined;
            (0, _mobx.extendObservable)(this, {
                _roofTexture: undefined
            }, {
                _roofTexture: _mobx.observable.ref
            });
            this.disposers.push(function () {
                // material如果拿着texture，那么material销毁时，就会销毁这个texture，这里就不能重复销毁了！
                if (_this4._roofMaterial && _this4._roofMaterial.uniforms.image !== _this4._roofTexture) {
                    _this4._roofTexture.destroy();
                    _this4._roofTexture = undefined;
                }
                if (_this4._roofMaterial) {
                    _this4._roofMaterial.destroy();
                    _this4._roofMaterial = undefined;
                }
            });
            var updateTexture = function updateTexture() {
                var roofImageUrl = _HTML2.default.xbsjEarthDir + 'images/wallImages/4.jpg';
                if (_this4.roofImageUrl !== '') {
                    roofImageUrl = _this4.roofImageUrl;
                }
                _this4._loadingRoofImage = _this4._loadingRoofImage && _this4._loadingRoofImage();
                _this4._loadingRoofImage = function () {
                    var valid = true;
                    Cesium.Resource.fetchImage({
                        url: roofImageUrl
                    }).then(function (image) {
                        if (valid) {
                            _this4._roofTexture = createTexture(image, scene);
                            // 记录一下当前正在使用的imageUrl，和this.imageUrl有可能不同
                            _this4._currentRoofImageUrl = roofImageUrl;
                        }
                    }).otherwise(function (error) {
                        console.error('图像加载错误！');
                        _this4._loadingRoofImage = _this4._loadingRoofImage && _this4._loadingRoofImage();
                    });
                    return function () {
                        valid = false;
                    };
                }();
            };
            updateTexture();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    roofImageUrl: _this4.roofImageUrl
                };
            }, updateTexture));
            this._totalDistance = 100.0;

            this._updateRoofMaterial();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    scale: _this4.scale,
                    _roofTexture: _this4._roofTexture,
                    _totalDistance: _this4._totalDistance,
                    roofImageHeight: _this4.roofImageHeight,
                    depth: _this4.depth
                };
            }, function () {
                return _this4._updateRoofMaterial();
            }));
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._earth.czm.scene.camera.flyToBoundingSphere(this._boundingSphere);
        }

        /**
         * 获取道路总长，单位米
         */

    }, {
        key: 'getTotalDistance',
        value: function getTotalDistance() {
            return this._totalDistance;
        }
    }, {
        key: 'onlyMove',
        get: function get() {
            return this._onlyMove;
        }
    }, {
        key: 'fixedPositionsNum',
        get: function get() {
            return this._fixedPositionsNum;
        }
    }]);
    return Wall;
}(_PlotBase3.default);

Wall.defaultOptions = {
    /**
     * 位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Wall
     */
    positions: [],
    /**
     * 显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.Wall
     */
    show: true,
    /**
     * 墙的厚度，单位米
     * @type {number}
     * @instance
     * @default 15.0
     * @memberof Obj.Wall
     */
    depth: 0.8,
    /**
     * 墙的高度，单位米
     * @type {number}
     * @instance
     * @default 15.0
     * @memberof Obj.Wall
     */
    height: 3.0,
    /**
     * 墙纹理缩放比例
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Wall
     */
    scale: 1.0,
    /**
     * 墙纹理图像，图像的尺寸最好是2的幂次，即256、512、1024等
     * @type {number}
     * @instance
     * @default ''
     * @memberof Obj.Wall
     */
    imageUrl: '',
    /**
     * 墙纹理高度，单位米
     * @type {number}
     * @instance
     * @default 10.0
     * @memberof Obj.Wall
     */
    wallImageHeight: 3.0,
    /**
     * 墙顶纹理图像，图像的尺寸最好是2的幂次，即256、512、1024等
     * @type {number}
     * @instance
     * @default ''
     * @memberof Obj.Wall
     */
    roofImageUrl: '',
    /**
     * 墙顶纹理高度，单位米
     * @type {number}
     * @instance
     * @default 3.0
     * @memberof Obj.Wall
     */
    roofImageHeight: 3.0
};

_XbsjObject2.default.registerType(Wall, 'Wall');

exports.default = Wall;

function createTexture(image, scene) {
    var width = image.naturalWidth;
    var height = image.naturalHeight;
    var texture = new Cesium.Texture({
        context: scene.context,
        source: image,
        width: width,
        height: height
    });
    if (Cesium.Math.isPowerOfTwo(width) && Cesium.Math.isPowerOfTwo(height)) {
        var sampler = new Cesium.Sampler({
            wrapS: Cesium.TextureWrap.CLAMP_TO_EDGE,
            wrapT: Cesium.TextureWrap.CLAMP_TO_EDGE,
            minificationFilter: Cesium.TextureMinificationFilter.LINEAR_MIPMAP_LINEAR,
            magnificationFilter: Cesium.TextureMagnificationFilter.LINEAR
        });
        texture.sampler = sampler;
        texture.generateMipmap(Cesium.MipmapHint.NICEST);
    }
    return texture;
}

/***/ }),
/* 360 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _GetXEPolylineVolumeGeometryLibrary = __webpack_require__(361);

var _GetXEPolylineVolumeGeometryLibrary2 = _interopRequireDefault(_GetXEPolylineVolumeGeometryLibrary);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XEPolylineVolumeGeometry = void 0; // import arrayRemoveDuplicates from './arrayRemoveDuplicates.js';
// import BoundingRectangle from './BoundingRectangle.js';
// import BoundingSphere from './BoundingSphere.js';
// import Cartesian2 from './Cartesian2.js';
// import Cartesian3 from './Cartesian3.js';
// import ComponentDatatype from './ComponentDatatype.js';
// import CornerType from './CornerType.js';
// import defaultValue from './defaultValue.js';
// import defined from './defined.js';
// import DeveloperError from './DeveloperError.js';
// import Ellipsoid from './Ellipsoid.js';
// import Geometry from './Geometry.js';
// import GeometryAttribute from './GeometryAttribute.js';
// import GeometryAttributes from './GeometryAttributes.js';
// import GeometryPipeline from './GeometryPipeline.js';
// import IndexDatatype from './IndexDatatype.js';
// import CesiumMath from './Math.js';
// import oneTimeWarning from './oneTimeWarning.js';
// import PolygonPipeline from './PolygonPipeline.js';
// import PolylineVolumeGeometryLibrary from './PolylineVolumeGeometryLibrary.js';
// import PrimitiveType from './PrimitiveType.js';
// import VertexFormat from './VertexFormat.js';
// import WindingOrder from './WindingOrder.js';

function GetXEPolylineVolumeGeometry() {
    if (XEPolylineVolumeGeometry) {
        return XEPolylineVolumeGeometry;
    }

    var arrayRemoveDuplicates = Cesium.arrayRemoveDuplicates;
    var BoundingRectangle = Cesium.BoundingRectangle;
    var BoundingSphere = Cesium.BoundingSphere;
    var Cartesian2 = Cesium.Cartesian2;
    var Cartesian3 = Cesium.Cartesian3;
    var ComponentDatatype = Cesium.ComponentDatatype;
    var CornerType = Cesium.CornerType;
    var defaultValue = Cesium.defaultValue;
    var defined = Cesium.defined;
    var DeveloperError = Cesium.DeveloperError;
    var Ellipsoid = Cesium.Ellipsoid;
    var Geometry = Cesium.Geometry;
    var GeometryAttribute = Cesium.GeometryAttribute;
    var GeometryAttributes = Cesium.GeometryAttributes;
    var GeometryPipeline = Cesium.GeometryPipeline;
    var IndexDatatype = Cesium.IndexDatatype;
    var CesiumMath = Cesium.Math;
    var oneTimeWarning = Cesium.oneTimeWarning;
    var PolygonPipeline = Cesium.PolygonPipeline;
    // const PolylineVolumeGeometryLibrary = Cesium.PolylineVolumeGeometryLibrary;
    var PolylineVolumeGeometryLibrary = (0, _GetXEPolylineVolumeGeometryLibrary2.default)();
    var PrimitiveType = Cesium.PrimitiveType;
    var VertexFormat = Cesium.VertexFormat;
    var WindingOrder = Cesium.WindingOrder;

    function computeAttributes(combinedPositions, shape, boundingRectangle, vertexFormat) {
        var attributes = new GeometryAttributes();
        if (vertexFormat.position) {
            attributes.position = new GeometryAttribute({
                componentDatatype: ComponentDatatype.DOUBLE,
                componentsPerAttribute: 3,
                values: combinedPositions
            });
        }
        var shapeLength = shape.length;
        var vertexCount = combinedPositions.length / 3;
        var length = (vertexCount - shapeLength * 2) / (shapeLength * 2);
        var firstEndIndices = PolygonPipeline.triangulate(shape);

        var indicesCount = (length - 1) * shapeLength * 6 + firstEndIndices.length * 2;
        var indices = IndexDatatype.createTypedArray(vertexCount, indicesCount);
        var i, j;
        var ll, ul, ur, lr;
        var offset = shapeLength * 2;
        var index = 0;
        for (i = 0; i < length - 1; i++) {
            for (j = 0; j < shapeLength - 1; j++) {
                ll = j * 2 + i * shapeLength * 2;
                lr = ll + offset;
                ul = ll + 1;
                ur = ul + offset;

                indices[index++] = ul;
                indices[index++] = ll;
                indices[index++] = ur;
                indices[index++] = ur;
                indices[index++] = ll;
                indices[index++] = lr;
            }
            ll = shapeLength * 2 - 2 + i * shapeLength * 2;
            ul = ll + 1;
            ur = ul + offset;
            lr = ll + offset;

            indices[index++] = ul;
            indices[index++] = ll;
            indices[index++] = ur;
            indices[index++] = ur;
            indices[index++] = ll;
            indices[index++] = lr;
        }

        // 计算纹理坐标
        var ds = [0];
        for (i = 0; i < length - 1; i++) {
            var cp = combinedPositions;
            var c1 = new Cesium.Cartesian3(cp[i * 8 * 3], cp[i * 8 * 3 + 1], cp[i * 8 * 3 + 2]);
            var c2 = new Cesium.Cartesian3(cp[(i + 1) * 8 * 3], cp[(i + 1) * 8 * 3 + 1], cp[(i + 1) * 8 * 3 + 2]);
            var c3 = new Cesium.Cartesian3(cp[i * 8 * 3 + 3 * 1], cp[i * 8 * 3 + 3 * 1 + 1], cp[i * 8 * 3 + 3 * 1 + 2]);
            var c4 = new Cesium.Cartesian3(cp[(i + 1) * 8 * 3 + 3 * 1], cp[(i + 1) * 8 * 3 + 3 * 1 + 1], cp[(i + 1) * 8 * 3 + 3 * 1 + 2]);
            var d = Cesium.Cartesian3.distance(c1, c2);
            var d2 = Cesium.Cartesian3.distance(c3, c4);
            ds.push(ds[ds.length - 1] + Math.max(d, d2));
        }
        ds = ds.map(function (e) {
            return e / ds[ds.length - 1];
        });

        if (vertexFormat.st || vertexFormat.tangent || vertexFormat.bitangent) {
            // st required for tangent/bitangent calculation
            var st = new Float32Array(vertexCount * 2);
            // var lengthSt = 1 / (length - 1);
            // var heightSt = 1 / (boundingRectangle.height);
            // var heightOffset = boundingRectangle.height / 2;
            var s, t;
            var stindex = 0;
            for (i = 0; i < length; i++) {
                // s = i * lengthSt;
                s = ds[i];
                // t = heightSt * (shape[0].y + heightOffset);
                t = shape[0].z;
                st[stindex++] = s;
                st[stindex++] = t;
                for (j = 1; j < shapeLength; j++) {
                    // t = heightSt * (shape[j].y + heightOffset);
                    t = shape[j].z;
                    st[stindex++] = s;
                    st[stindex++] = t;
                    st[stindex++] = s;
                    st[stindex++] = t;
                }
                // t = heightSt * (shape[0].y + heightOffset);
                t = shape[0].z;
                st[stindex++] = s;
                st[stindex++] = t;
            }
            for (j = 0; j < shapeLength; j++) {
                s = 0;
                // t = heightSt * (shape[j].y + heightOffset);
                t = shape[j].z;
                st[stindex++] = s;
                st[stindex++] = t;
            }
            for (j = 0; j < shapeLength; j++) {
                // s = (length - 1) * lengthSt;
                s = 1.0 - 0.000000000001;
                // t = heightSt * (shape[j].y + heightOffset);
                t = shape[j].z;
                st[stindex++] = s;
                st[stindex++] = t;
            }

            attributes.st = new GeometryAttribute({
                componentDatatype: ComponentDatatype.FLOAT,
                componentsPerAttribute: 2,
                values: new Float32Array(st)
            });
        }

        var endOffset = vertexCount - shapeLength * 2;
        for (i = 0; i < firstEndIndices.length; i += 3) {
            var v0 = firstEndIndices[i] + endOffset;
            var v1 = firstEndIndices[i + 1] + endOffset;
            var v2 = firstEndIndices[i + 2] + endOffset;

            indices[index++] = v0;
            indices[index++] = v1;
            indices[index++] = v2;
            indices[index++] = v2 + shapeLength;
            indices[index++] = v1 + shapeLength;
            indices[index++] = v0 + shapeLength;
        }

        var geometry = new Geometry({
            attributes: attributes,
            indices: indices,
            boundingSphere: BoundingSphere.fromVertices(combinedPositions),
            primitiveType: PrimitiveType.TRIANGLES
        });

        if (vertexFormat.normal) {
            geometry = GeometryPipeline.computeNormal(geometry);
        }

        if (vertexFormat.tangent || vertexFormat.bitangent) {
            try {
                geometry = GeometryPipeline.computeTangentAndBitangent(geometry);
            } catch (e) {
                oneTimeWarning('polyline-volume-tangent-bitangent', 'Unable to compute tangents and bitangents for polyline volume geometry');
                //TODO https://github.com/AnalyticalGraphicsInc/cesium/issues/3609
            }

            if (!vertexFormat.tangent) {
                geometry.attributes.tangent = undefined;
            }
            if (!vertexFormat.bitangent) {
                geometry.attributes.bitangent = undefined;
            }
            if (!vertexFormat.st) {
                geometry.attributes.st = undefined;
            }
        }

        return geometry;
    }

    /**
     * A description of a polyline with a volume (a 2D shape extruded along a polyline).
     *
     * @alias PolylineVolumeGeometry
     * @constructor
     *
     * @param {Object} options Object with the following properties:
     * @param {Cartesian3[]} options.polylinePositions An array of {@link Cartesain3} positions that define the center of the polyline volume.
     * @param {Cartesian2[]} options.shapePositions An array of {@link Cartesian2} positions that define the shape to be extruded along the polyline
     * @param {Ellipsoid} [options.ellipsoid=Ellipsoid.WGS84] The ellipsoid to be used as a reference.
     * @param {Number} [options.granularity=CesiumMath.RADIANS_PER_DEGREE] The distance, in radians, between each latitude and longitude. Determines the number of positions in the buffer.
     * @param {VertexFormat} [options.vertexFormat=VertexFormat.DEFAULT] The vertex attributes to be computed.
     * @param {CornerType} [options.cornerType=CornerType.ROUNDED] Determines the style of the corners.
     *
     * @see PolylineVolumeGeometry#createGeometry
     *
     * @demo {@link https://sandcastle.cesium.com/index.html?src=Polyline%20Volume.html|Cesium Sandcastle Polyline Volume Demo}
     *
     * @example
     * function computeCircle(radius) {
     *   var positions = [];
     *   for (var i = 0; i < 360; i++) {
     *     var radians = Cesium.Math.toRadians(i);
     *     positions.push(new Cesium.Cartesian2(radius * Math.cos(radians), radius * Math.sin(radians)));
     *   }
     *   return positions;
     * }
     *
     * var volume = new Cesium.PolylineVolumeGeometry({
     *   vertexFormat : Cesium.VertexFormat.POSITION_ONLY,
     *   polylinePositions : Cesium.Cartesian3.fromDegreesArray([
     *     -72.0, 40.0,
     *     -70.0, 35.0
     *   ]),
     *   shapePositions : computeCircle(100000.0)
     * });
     */
    function PolylineVolumeGeometry(options) {
        options = defaultValue(options, defaultValue.EMPTY_OBJECT);
        var positions = options.polylinePositions;
        var shape = options.shapePositions;

        //>>includeStart('debug', pragmas.debug);
        if (!defined(positions)) {
            throw new DeveloperError('options.polylinePositions is required.');
        }
        if (!defined(shape)) {
            throw new DeveloperError('options.shapePositions is required.');
        }
        //>>includeEnd('debug');

        this._positions = positions;
        this._shape = shape;
        this._ellipsoid = Ellipsoid.clone(defaultValue(options.ellipsoid, Ellipsoid.WGS84));
        this._cornerType = defaultValue(options.cornerType, CornerType.ROUNDED);
        this._vertexFormat = VertexFormat.clone(defaultValue(options.vertexFormat, VertexFormat.DEFAULT));
        this._granularity = defaultValue(options.granularity, CesiumMath.RADIANS_PER_DEGREE);
        this._workerName = 'createPolylineVolumeGeometry';

        var numComponents = 1 + positions.length * Cartesian3.packedLength;
        // numComponents += 1 + shape.length * Cartesian2.packedLength;
        numComponents += 1 + shape.length * Cartesian3.packedLength;

        /**
         * The number of elements used to pack the object into an array.
         * @type {Number}
         */
        this.packedLength = numComponents + Ellipsoid.packedLength + VertexFormat.packedLength + 2;
    }

    /**
     * Stores the provided instance into the provided array.
     *
     * @param {PolylineVolumeGeometry} value The value to pack.
     * @param {Number[]} array The array to pack into.
     * @param {Number} [startingIndex=0] The index into the array at which to start packing the elements.
     *
     * @returns {Number[]} The array that was packed into
     */
    PolylineVolumeGeometry.pack = function (value, array, startingIndex) {
        //>>includeStart('debug', pragmas.debug);
        if (!defined(value)) {
            throw new DeveloperError('value is required');
        }
        if (!defined(array)) {
            throw new DeveloperError('array is required');
        }
        //>>includeEnd('debug');

        startingIndex = defaultValue(startingIndex, 0);

        var i;

        var positions = value._positions;
        var length = positions.length;
        array[startingIndex++] = length;

        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {
            Cartesian3.pack(positions[i], array, startingIndex);
        }

        var shape = value._shape;
        length = shape.length;
        array[startingIndex++] = length;

        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {
            Cartesian3.pack(shape[i], array, startingIndex);
        }

        Ellipsoid.pack(value._ellipsoid, array, startingIndex);
        startingIndex += Ellipsoid.packedLength;

        VertexFormat.pack(value._vertexFormat, array, startingIndex);
        startingIndex += VertexFormat.packedLength;

        array[startingIndex++] = value._cornerType;
        array[startingIndex] = value._granularity;

        return array;
    };

    var scratchEllipsoid = Ellipsoid.clone(Ellipsoid.UNIT_SPHERE);
    var scratchVertexFormat = new VertexFormat();
    var scratchOptions = {
        polylinePositions: undefined,
        shapePositions: undefined,
        ellipsoid: scratchEllipsoid,
        vertexFormat: scratchVertexFormat,
        cornerType: undefined,
        granularity: undefined
    };

    /**
     * Retrieves an instance from a packed array.
     *
     * @param {Number[]} array The packed array.
     * @param {Number} [startingIndex=0] The starting index of the element to be unpacked.
     * @param {PolylineVolumeGeometry} [result] The object into which to store the result.
     * @returns {PolylineVolumeGeometry} The modified result parameter or a new PolylineVolumeGeometry instance if one was not provided.
     */
    PolylineVolumeGeometry.unpack = function (array, startingIndex, result) {
        //>>includeStart('debug', pragmas.debug);
        if (!defined(array)) {
            throw new DeveloperError('array is required');
        }
        //>>includeEnd('debug');

        startingIndex = defaultValue(startingIndex, 0);

        var i;

        var length = array[startingIndex++];
        var positions = new Array(length);

        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {
            positions[i] = Cartesian3.unpack(array, startingIndex);
        }

        length = array[startingIndex++];
        var shape = new Array(length);

        for (i = 0; i < length; ++i, startingIndex += Cartesian3.packedLength) {
            shape[i] = Cartesian3.unpack(array, startingIndex);
        }

        var ellipsoid = Ellipsoid.unpack(array, startingIndex, scratchEllipsoid);
        startingIndex += Ellipsoid.packedLength;

        var vertexFormat = VertexFormat.unpack(array, startingIndex, scratchVertexFormat);
        startingIndex += VertexFormat.packedLength;

        var cornerType = array[startingIndex++];
        var granularity = array[startingIndex];

        if (!defined(result)) {
            scratchOptions.polylinePositions = positions;
            scratchOptions.shapePositions = shape;
            scratchOptions.cornerType = cornerType;
            scratchOptions.granularity = granularity;
            return new PolylineVolumeGeometry(scratchOptions);
        }

        result._positions = positions;
        result._shape = shape;
        result._ellipsoid = Ellipsoid.clone(ellipsoid, result._ellipsoid);
        result._vertexFormat = VertexFormat.clone(vertexFormat, result._vertexFormat);
        result._cornerType = cornerType;
        result._granularity = granularity;

        return result;
    };

    var brScratch = new BoundingRectangle();

    /**
     * Computes the geometric representation of a polyline with a volume, including its vertices, indices, and a bounding sphere.
     *
     * @param {PolylineVolumeGeometry} polylineVolumeGeometry A description of the polyline volume.
     * @returns {Geometry|undefined} The computed vertices and indices.
     */
    PolylineVolumeGeometry.createGeometry = function (polylineVolumeGeometry) {
        var positions = polylineVolumeGeometry._positions;
        var cleanPositions = arrayRemoveDuplicates(positions, Cartesian3.equalsEpsilon);
        var shape2D = polylineVolumeGeometry._shape;
        shape2D = PolylineVolumeGeometryLibrary.removeDuplicatesFromShape(shape2D);

        if (cleanPositions.length < 2 || shape2D.length < 3) {
            return undefined;
        }

        if (PolygonPipeline.computeWindingOrder2D(shape2D) === WindingOrder.CLOCKWISE) {
            shape2D.reverse();
        }
        var boundingRectangle = BoundingRectangle.fromPoints(shape2D, brScratch);

        var computedPositions = PolylineVolumeGeometryLibrary.computePositions(cleanPositions, shape2D, boundingRectangle, polylineVolumeGeometry, true);
        return computeAttributes(computedPositions, shape2D, boundingRectangle, polylineVolumeGeometry._vertexFormat);
    };

    XEPolylineVolumeGeometry = PolylineVolumeGeometry;
    return XEPolylineVolumeGeometry;
}

exports.default = GetXEPolylineVolumeGeometry;

/***/ }),
/* 361 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var XEPolylineVolumeGeometryLibrary = void 0;

function GetXEPolylineVolumeGeometryLibrary() {

    if (XEPolylineVolumeGeometryLibrary) {
        return XEPolylineVolumeGeometryLibrary;
    }

    // import Cartesian2 from './Cartesian2.js';
    // import Cartesian3 from './Cartesian3.js';
    // import Cartesian4 from './Cartesian4.js';
    // import Cartographic from './Cartographic.js';
    // import CornerType from './CornerType.js';
    // import EllipsoidTangentPlane from './EllipsoidTangentPlane.js';
    // import CesiumMath from './Math.js';
    // import Matrix3 from './Matrix3.js';
    // import Matrix4 from './Matrix4.js';
    // import PolylinePipeline from './PolylinePipeline.js';
    // import Quaternion from './Quaternion.js';
    // import Transforms from './Transforms.js';
    var Cartesian2 = Cesium.Cartesian2;
    var Cartesian3 = Cesium.Cartesian3;
    var Cartesian4 = Cesium.Cartesian4;
    var Cartographic = Cesium.Cartographic;
    var CornerType = Cesium.CornerType;
    var EllipsoidTangentPlane = Cesium.EllipsoidTangentPlane;
    var CesiumMath = Cesium.Math;
    var Matrix3 = Cesium.Matrix3;
    var Matrix4 = Cesium.Matrix4;
    var PolylinePipeline = Cesium.PolylinePipeline;
    var Quaternion = Cesium.Quaternion;
    var Transforms = Cesium.Transforms;

    var scratch2Array = [new Cartesian3(), new Cartesian3()];
    var scratchCartesian1 = new Cartesian3();
    var scratchCartesian2 = new Cartesian3();
    var scratchCartesian3 = new Cartesian3();
    var scratchCartesian4 = new Cartesian3();
    var scratchCartesian5 = new Cartesian3();
    var scratchCartesian6 = new Cartesian3();
    var scratchCartesian7 = new Cartesian3();
    var scratchCartesian8 = new Cartesian3();
    var scratchCartesian9 = new Cartesian3();

    var scratch1 = new Cartesian3();
    var scratch2 = new Cartesian3();

    /**
     * @private
     */
    var PolylineVolumeGeometryLibrary = {};

    var cartographic = new Cartographic();
    function scaleToSurface(positions, ellipsoid) {
        var heights = new Array(positions.length);
        for (var i = 0; i < positions.length; i++) {
            var pos = positions[i];
            cartographic = ellipsoid.cartesianToCartographic(pos, cartographic);
            heights[i] = cartographic.height;
            positions[i] = ellipsoid.scaleToGeodeticSurface(pos, pos);
        }
        return heights;
    }

    function subdivideHeights(points, h0, h1, granularity) {
        var p0 = points[0];
        var p1 = points[1];
        var angleBetween = Cartesian3.angleBetween(p0, p1);
        var numPoints = Math.ceil(angleBetween / granularity);
        var heights = new Array(numPoints);
        var i;
        if (h0 === h1) {
            for (i = 0; i < numPoints; i++) {
                heights[i] = h0;
            }
            heights.push(h1);
            return heights;
        }

        var dHeight = h1 - h0;
        var heightPerVertex = dHeight / numPoints;

        for (i = 1; i < numPoints; i++) {
            var h = h0 + i * heightPerVertex;
            heights[i] = h;
        }

        heights[0] = h0;
        heights.push(h1);
        return heights;
    }

    var nextScratch = new Cartesian3();
    var prevScratch = new Cartesian3();

    function computeRotationAngle(start, end, position, ellipsoid) {
        var tangentPlane = new EllipsoidTangentPlane(position, ellipsoid);
        var next = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, start, nextScratch), nextScratch);
        var prev = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, end, prevScratch), prevScratch);
        var angle = Cartesian2.angleBetween(next, prev);

        return prev.x * next.y - prev.y * next.x >= 0.0 ? -angle : angle;
    }

    var negativeX = new Cartesian3(-1, 0, 0);
    var transform = new Matrix4();
    var translation = new Matrix4();
    var rotationZ = new Matrix3();
    var scaleMatrix = Matrix3.IDENTITY.clone();
    var westScratch = new Cartesian3();
    var finalPosScratch = new Cartesian4();
    var heightCartesian = new Cartesian3();
    function addPosition(center, left, shape, finalPositions, ellipsoid, height, xScalar, repeat) {
        var west = westScratch;
        var finalPosition = finalPosScratch;
        transform = Transforms.eastNorthUpToFixedFrame(center, ellipsoid, transform);

        west = Matrix4.multiplyByPointAsVector(transform, negativeX, west);
        west = Cartesian3.normalize(west, west);
        var angle = computeRotationAngle(west, left, center, ellipsoid);
        rotationZ = Matrix3.fromRotationZ(angle, rotationZ);

        heightCartesian.z = height;
        transform = Matrix4.multiplyTransformation(transform, Matrix4.fromRotationTranslation(rotationZ, heightCartesian, translation), transform);
        var scale = scaleMatrix;
        scale[0] = xScalar;

        for (var j = 0; j < repeat; j++) {
            for (var i = 0; i < shape.length; i += 3) {
                finalPosition = Cartesian3.fromArray(shape, i, finalPosition);
                finalPosition = Matrix3.multiplyByVector(scale, finalPosition, finalPosition);
                finalPosition = Matrix4.multiplyByPoint(transform, finalPosition, finalPosition);
                finalPositions.push(finalPosition.x, finalPosition.y, finalPosition.z);
            }
        }

        return finalPositions;
    }

    var centerScratch = new Cartesian3();
    function addPositions(centers, left, shape, finalPositions, ellipsoid, heights, xScalar) {
        for (var i = 0; i < centers.length; i += 3) {
            var center = Cartesian3.fromArray(centers, i, centerScratch);
            finalPositions = addPosition(center, left, shape, finalPositions, ellipsoid, heights[i / 3], xScalar, 1);
        }
        return finalPositions;
    }

    function convertShapeTo3DDuplicate(shape2D, boundingRectangle) {
        //orientate 2D shape to XZ plane center at (0, 0, 0), duplicate points
        var length = shape2D.length;
        var shape = new Array(length * 6);
        var index = 0;
        var xOffset = boundingRectangle.x + boundingRectangle.width / 2;
        // var yOffset = boundingRectangle.y + boundingRectangle.height / 2; // vtxf
        var yOffset = boundingRectangle.height / 2;

        var point = shape2D[0];
        shape[index++] = point.x - xOffset;
        shape[index++] = 0.0;
        shape[index++] = point.y - yOffset;
        for (var i = 1; i < length; i++) {
            point = shape2D[i];
            var x = point.x - xOffset;
            var z = point.y - yOffset;
            shape[index++] = x;
            shape[index++] = 0.0;
            shape[index++] = z;

            shape[index++] = x;
            shape[index++] = 0.0;
            shape[index++] = z;
        }
        point = shape2D[0];
        shape[index++] = point.x - xOffset;
        shape[index++] = 0.0;
        shape[index++] = point.y - yOffset;

        return shape;
    }

    function convertShapeTo3D(shape2D, boundingRectangle) {
        //orientate 2D shape to XZ plane center at (0, 0, 0)
        var length = shape2D.length;
        var shape = new Array(length * 3);
        var index = 0;
        var xOffset = boundingRectangle.x + boundingRectangle.width / 2;
        // var yOffset = boundingRectangle.y + boundingRectangle.height / 2; // vtxf
        var yOffset = boundingRectangle.height / 2;

        for (var i = 0; i < length; i++) {
            shape[index++] = shape2D[i].x - xOffset;
            shape[index++] = 0;
            shape[index++] = shape2D[i].y - yOffset;
        }

        return shape;
    }

    var quaterion = new Quaternion();
    var startPointScratch = new Cartesian3();
    var rotMatrix = new Matrix3();
    function computeRoundCorner(pivot, startPoint, endPoint, cornerType, leftIsOutside, ellipsoid, finalPositions, shape, height, duplicatePoints) {
        var angle = Cartesian3.angleBetween(Cartesian3.subtract(startPoint, pivot, scratch1), Cartesian3.subtract(endPoint, pivot, scratch2));
        var granularity = cornerType === CornerType.BEVELED ? 0 : Math.ceil(angle / CesiumMath.toRadians(5));

        var m;
        if (leftIsOutside) {
            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(Cartesian3.negate(pivot, scratch1), angle / (granularity + 1), quaterion), rotMatrix);
        } else {
            m = Matrix3.fromQuaternion(Quaternion.fromAxisAngle(pivot, angle / (granularity + 1), quaterion), rotMatrix);
        }

        var left;
        var surfacePoint;
        startPoint = Cartesian3.clone(startPoint, startPointScratch);
        if (granularity > 0) {
            var repeat = duplicatePoints ? 2 : 1;
            for (var i = 0; i < granularity; i++) {
                startPoint = Matrix3.multiplyByVector(m, startPoint, startPoint);
                left = Cartesian3.subtract(startPoint, pivot, scratch1);
                left = Cartesian3.normalize(left, left);
                if (!leftIsOutside) {
                    left = Cartesian3.negate(left, left);
                }
                surfacePoint = ellipsoid.scaleToGeodeticSurface(startPoint, scratch2);
                finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, repeat);
            }
        } else {
            left = Cartesian3.subtract(startPoint, pivot, scratch1);
            left = Cartesian3.normalize(left, left);
            if (!leftIsOutside) {
                left = Cartesian3.negate(left, left);
            }
            surfacePoint = ellipsoid.scaleToGeodeticSurface(startPoint, scratch2);
            finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, 1);

            endPoint = Cartesian3.clone(endPoint, startPointScratch);
            left = Cartesian3.subtract(endPoint, pivot, scratch1);
            left = Cartesian3.normalize(left, left);
            if (!leftIsOutside) {
                left = Cartesian3.negate(left, left);
            }
            surfacePoint = ellipsoid.scaleToGeodeticSurface(endPoint, scratch2);
            finalPositions = addPosition(surfacePoint, left, shape, finalPositions, ellipsoid, height, 1, 1);
        }

        return finalPositions;
    }

    PolylineVolumeGeometryLibrary.removeDuplicatesFromShape = function (shapePositions) {
        var length = shapePositions.length;
        var cleanedPositions = [];
        for (var i0 = length - 1, i1 = 0; i1 < length; i0 = i1++) {
            var v0 = shapePositions[i0];
            var v1 = shapePositions[i1];

            if (!Cartesian2.equals(v0, v1)) {
                cleanedPositions.push(v1); // Shallow copy!
            }
        }

        return cleanedPositions;
    };

    PolylineVolumeGeometryLibrary.angleIsGreaterThanPi = function (forward, backward, position, ellipsoid) {
        var tangentPlane = new EllipsoidTangentPlane(position, ellipsoid);
        var next = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, forward, nextScratch), nextScratch);
        var prev = tangentPlane.projectPointOntoPlane(Cartesian3.add(position, backward, prevScratch), prevScratch);

        return prev.x * next.y - prev.y * next.x >= 0.0;
    };

    var scratchForwardProjection = new Cartesian3();
    var scratchBackwardProjection = new Cartesian3();

    PolylineVolumeGeometryLibrary.computePositions = function (positions, shape2D, boundingRectangle, geometry, duplicatePoints) {
        var ellipsoid = geometry._ellipsoid;
        var heights = scaleToSurface(positions, ellipsoid);
        var granularity = geometry._granularity;
        var cornerType = geometry._cornerType;
        var shapeForSides = duplicatePoints ? convertShapeTo3DDuplicate(shape2D, boundingRectangle) : convertShapeTo3D(shape2D, boundingRectangle);
        var shapeForEnds = duplicatePoints ? convertShapeTo3D(shape2D, boundingRectangle) : undefined;
        var heightOffset = boundingRectangle.height / 2;
        var width = boundingRectangle.width / 2;
        var length = positions.length;
        var finalPositions = [];
        var ends = duplicatePoints ? [] : undefined;

        var forward = scratchCartesian1;
        var backward = scratchCartesian2;
        var cornerDirection = scratchCartesian3;
        var surfaceNormal = scratchCartesian4;
        var pivot = scratchCartesian5;
        var start = scratchCartesian6;
        var end = scratchCartesian7;
        var left = scratchCartesian8;
        var previousPosition = scratchCartesian9;

        var position = positions[0];
        var nextPosition = positions[1];
        surfaceNormal = ellipsoid.geodeticSurfaceNormal(position, surfaceNormal);
        forward = Cartesian3.subtract(nextPosition, position, forward);
        forward = Cartesian3.normalize(forward, forward);
        left = Cartesian3.cross(surfaceNormal, forward, left);
        left = Cartesian3.normalize(left, left);
        var h0 = heights[0];
        var h1 = heights[1];
        if (duplicatePoints) {
            ends = addPosition(position, left, shapeForEnds, ends, ellipsoid, h0 + heightOffset, 1, 1);
        }
        previousPosition = Cartesian3.clone(position, previousPosition);
        position = nextPosition;
        backward = Cartesian3.negate(forward, backward);
        var subdividedHeights;
        var subdividedPositions;
        for (var i = 1; i < length - 1; i++) {
            var repeat = duplicatePoints ? 2 : 1;
            nextPosition = positions[i + 1];
            forward = Cartesian3.subtract(nextPosition, position, forward);
            forward = Cartesian3.normalize(forward, forward);
            cornerDirection = Cartesian3.add(forward, backward, cornerDirection);
            cornerDirection = Cartesian3.normalize(cornerDirection, cornerDirection);
            surfaceNormal = ellipsoid.geodeticSurfaceNormal(position, surfaceNormal);

            var forwardProjection = Cartesian3.multiplyByScalar(surfaceNormal, Cartesian3.dot(forward, surfaceNormal), scratchForwardProjection);
            Cartesian3.subtract(forward, forwardProjection, forwardProjection);
            Cartesian3.normalize(forwardProjection, forwardProjection);

            var backwardProjection = Cartesian3.multiplyByScalar(surfaceNormal, Cartesian3.dot(backward, surfaceNormal), scratchBackwardProjection);
            Cartesian3.subtract(backward, backwardProjection, backwardProjection);
            Cartesian3.normalize(backwardProjection, backwardProjection);

            var doCorner = !CesiumMath.equalsEpsilon(Math.abs(Cartesian3.dot(forwardProjection, backwardProjection)), 1.0, CesiumMath.EPSILON7);

            if (doCorner) {
                cornerDirection = Cartesian3.cross(cornerDirection, surfaceNormal, cornerDirection);
                cornerDirection = Cartesian3.cross(surfaceNormal, cornerDirection, cornerDirection);
                cornerDirection = Cartesian3.normalize(cornerDirection, cornerDirection);
                var scalar = 1 / Math.max(0.25, Cartesian3.magnitude(Cartesian3.cross(cornerDirection, backward, scratch1)));
                var leftIsOutside = PolylineVolumeGeometryLibrary.angleIsGreaterThanPi(forward, backward, position, ellipsoid);
                if (leftIsOutside) {
                    pivot = Cartesian3.add(position, Cartesian3.multiplyByScalar(cornerDirection, scalar * width, cornerDirection), pivot);
                    start = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, width, start), start);
                    scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);
                    scratch2Array[1] = Cartesian3.clone(start, scratch2Array[1]);
                    subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);
                    subdividedPositions = PolylinePipeline.generateArc({
                        positions: scratch2Array,
                        granularity: granularity,
                        ellipsoid: ellipsoid
                    });
                    finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);
                    left = Cartesian3.cross(surfaceNormal, forward, left);
                    left = Cartesian3.normalize(left, left);
                    end = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, width, end), end);
                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {
                        computeRoundCorner(pivot, start, end, cornerType, leftIsOutside, ellipsoid, finalPositions, shapeForSides, h1 + heightOffset, duplicatePoints);
                    } else {
                        cornerDirection = Cartesian3.negate(cornerDirection, cornerDirection);
                        finalPositions = addPosition(position, cornerDirection, shapeForSides, finalPositions, ellipsoid, h1 + heightOffset, scalar, repeat);
                    }
                    previousPosition = Cartesian3.clone(end, previousPosition);
                } else {
                    pivot = Cartesian3.add(position, Cartesian3.multiplyByScalar(cornerDirection, scalar * width, cornerDirection), pivot);
                    start = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, -width, start), start);
                    scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);
                    scratch2Array[1] = Cartesian3.clone(start, scratch2Array[1]);
                    subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);
                    subdividedPositions = PolylinePipeline.generateArc({
                        positions: scratch2Array,
                        granularity: granularity,
                        ellipsoid: ellipsoid
                    });
                    finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);
                    left = Cartesian3.cross(surfaceNormal, forward, left);
                    left = Cartesian3.normalize(left, left);
                    end = Cartesian3.add(pivot, Cartesian3.multiplyByScalar(left, -width, end), end);
                    if (cornerType === CornerType.ROUNDED || cornerType === CornerType.BEVELED) {
                        computeRoundCorner(pivot, start, end, cornerType, leftIsOutside, ellipsoid, finalPositions, shapeForSides, h1 + heightOffset, duplicatePoints);
                    } else {
                        finalPositions = addPosition(position, cornerDirection, shapeForSides, finalPositions, ellipsoid, h1 + heightOffset, scalar, repeat);
                    }
                    previousPosition = Cartesian3.clone(end, previousPosition);
                }
                backward = Cartesian3.negate(forward, backward);
            } else {
                finalPositions = addPosition(previousPosition, left, shapeForSides, finalPositions, ellipsoid, h0 + heightOffset, 1, 1);
                previousPosition = position;
            }
            h0 = h1;
            h1 = heights[i + 1];
            position = nextPosition;
        }

        scratch2Array[0] = Cartesian3.clone(previousPosition, scratch2Array[0]);
        scratch2Array[1] = Cartesian3.clone(position, scratch2Array[1]);
        subdividedHeights = subdivideHeights(scratch2Array, h0 + heightOffset, h1 + heightOffset, granularity);
        subdividedPositions = PolylinePipeline.generateArc({
            positions: scratch2Array,
            granularity: granularity,
            ellipsoid: ellipsoid
        });
        finalPositions = addPositions(subdividedPositions, left, shapeForSides, finalPositions, ellipsoid, subdividedHeights, 1);
        if (duplicatePoints) {
            ends = addPosition(position, left, shapeForEnds, ends, ellipsoid, h1 + heightOffset, 1, 1);
        }

        length = finalPositions.length;
        var posLength = duplicatePoints ? length + ends.length : length;
        var combinedPositions = new Float64Array(posLength);
        combinedPositions.set(finalPositions);
        if (duplicatePoints) {
            combinedPositions.set(ends, length);
        }

        return combinedPositions;
    };

    XEPolylineVolumeGeometryLibrary = PolylineVolumeGeometryLibrary;
    return XEPolylineVolumeGeometryLibrary;
}

exports.default = GetXEPolylineVolumeGeometryLibrary;

/***/ }),
/* 362 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _registerInteractionProperty = __webpack_require__(15);

var _uniquePolygonPositions = __webpack_require__(150);

var _uniquePolygonPositions2 = _interopRequireDefault(_uniquePolygonPositions);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _registerPickingParent = __webpack_require__(108);

var _registerPickingParent2 = _interopRequireDefault(_registerPickingParent);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var defaultOptions = {
    positions: [],
    height: 0.0,
    extrudedHeight: 0.0,
    show: true,
    color: [1, 1, 0, 0.5],
    showHelper: false,
    outline: {
        show: true,
        color: [0, 1, 0, 1],
        width: 2.0
    },
    depthTest: false
};

/**
 * 多边形
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */

var ClassificationPolygon = function (_XbsjCzmObj) {
    (0, _inherits3.default)(ClassificationPolygon, _XbsjCzmObj);

    function ClassificationPolygon(earth, guid) {
        (0, _classCallCheck3.default)(this, ClassificationPolygon);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ClassificationPolygon.__proto__ || (0, _getPrototypeOf2.default)(ClassificationPolygon)).call(this, earth, guid));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._primitive = undefined;
        _this.disposers.push(function () {
            return _this._primitive && _this._earth.czm.scene.primitives.remove(_this._primitive);
        });

        _this._classificationPrimitive = undefined;
        _this.disposers.push(function () {
            return _this._classificationPrimitive && _this._earth.czm.scene.primitives.remove(_this._classificationPrimitive);
        });

        _this._boundingSphere = new Cesium.BoundingSphere();

        {
            // const czmPolygonColor = new Cesium.Color(...this.color);
            var updatePolygonPrimitive = function updatePolygonPrimitive() {
                // czmPolygonColor.xbsjFromArray(...this.color);
                if (_this._primitive) {
                    _this._primitive.show = _this.show && _this.showHelper;
                }
                if (_this._classificationPrimitive) {
                    _this._classificationPrimitive.show = _this.show;
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    // color: [...this.color],
                    show: _this.show,
                    showHelper: _this.showHelper
                };
            }, updatePolygonPrimitive));

            var createPolygonPrimitive = function createPolygonPrimitive(positions) {
                _this._primitive && _this._earth.czm.scene.primitives.remove(_this._primitive);
                _this._primitive = undefined;

                if (positions.length >= 3) {
                    var polygonGeometry = new Cesium.PolygonGeometry({
                        polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromRadiansArray(positions)),
                        height: _this.height,
                        extrudedHeight: _this.extrudedHeight
                    });

                    var polygonInstance = new Cesium.GeometryInstance({
                        geometry: polygonGeometry,
                        id: _this
                    });

                    var primitive = new Cesium.Primitive({
                        geometryInstances: [polygonInstance],
                        appearance: new Cesium.MaterialAppearance({
                            material: Cesium.Material.fromType('Color'),
                            faceForward: true,
                            renderState: {
                                depthTest: {
                                    enabled: _this.depthTest
                                    // depthMask: this.depthMask, 设置无效，Appearance内部会强行设置
                                } },
                            closed: true
                        }),
                        asynchronous: false, // 防止闪烁
                        allowPicking: _this.allowPicking, // 不允许拾取
                        compressVertices: false // 提升效率
                    });
                    // primitive.appearance.material.uniforms.color = czmPolygonColor;
                    primitive.appearance.material.uniforms.color = Cesium.Color.YELLOW.withAlpha(0.5);

                    _this._primitive = _this._earth.czm.scene.primitives.add(primitive);
                    _this._primitive.show = _this.show;
                }
            };

            var createClassificationPolygonPrimitive = function createClassificationPolygonPrimitive(positions) {
                _this._classificationPrimitive && _this._earth.czm.scene.primitives.remove(_this._classificationPrimitive);
                _this._classificationPrimitive = undefined;

                if (positions.length >= 3) {
                    var c = _this.color;
                    var polygonGeometry = new Cesium.PolygonGeometry({
                        vertexFormat: Cesium.PerInstanceColorAppearance.VERTEX_FORMAT,
                        polygonHierarchy: new Cesium.PolygonHierarchy(Cesium.Cartesian3.fromRadiansArray(positions)),
                        height: _this.height,
                        extrudedHeight: _this.extrudedHeight
                    });

                    var polygonInstance = new Cesium.GeometryInstance({
                        geometry: polygonGeometry,
                        id: _this,
                        attributes: {
                            color: Cesium.ColorGeometryInstanceAttribute.fromColor(new Cesium.Color(c[0], c[1], c[2], c[3])),
                            show: new Cesium.ShowGeometryInstanceAttribute(true)
                        }
                    });

                    var classificationPrimitive = new Cesium.ClassificationPrimitive({
                        geometryInstances: [polygonInstance],
                        asynchronous: false, // 防止闪烁
                        allowPicking: _this.allowPicking, // 不允许拾取
                        compressVertices: false, // 提升效率
                        classificationType: 2
                    });

                    _this._classificationPrimitive = _this._earth.czm.scene.primitives.add(classificationPrimitive);
                    _this._classificationPrimitive.show = _this.show;
                }
            };

            var updateBoundingSphere = function updateBoundingSphere() {
                var l = _this.positions.length / 2;
                if (l >= 3) {
                    var positionsWithHeight = [];
                    for (var i = 0; i < l; ++i) {
                        positionsWithHeight.push(_this.positions[i * 2], _this.positions[i * 2 + 1], 0.5 * (_this.height + _this.extrudedHeight));
                    }
                    var cartesians = Cesium.Cartesian3.fromRadiansArrayHeights(positionsWithHeight);
                    _this._boundingSphere = Cesium.BoundingSphere.fromPoints(cartesians, _this._boundingSphere);
                }
            };

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                    height: _this.height,
                    extrudedHeight: _this.extrudedHeight,
                    depthTest: _this.depthTest
                };
            }, function () {
                var positions = (0, _uniquePolygonPositions2.default)(_this.positions);
                createPolygonPrimitive(positions);
                createClassificationPolygonPrimitive(positions);
                updatePolygonPrimitive();
                updateBoundingSphere();
            }));

            _this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    color: [].concat((0, _toConsumableArray3.default)(_this.color))
                };
            }, function () {
                var positions = (0, _uniquePolygonPositions2.default)(_this.positions);
                createClassificationPolygonPrimitive(positions);
            }));

            _this.disposers.push((0, _mobx.reaction)(function () {
                return _this.show;
            }, function () {
                _this._primitive.show = _this.show;
                _this._classificationPrimitive.show = _this.show;
            }));
        }

        _this._polyline = new _Polyline2.default(earth);
        _this.disposers.push(function () {
            return _this._polyline = _this._polyline && _this._polyline.destroy();
        });

        {

            _this._polyline.material.type = 'XbsjColorMaterial';
            _this._polyline.depthTest = _this.depthTest;
            _this._polyline.loop = true;

            (0, _registerPickingParent2.default)(_this._polyline, _this);

            _this.disposers.push((0, _mobx.autorun)(function () {
                _this._polyline.material['XbsjColorMaterial'].color = _this.outline.color;
                _this._polyline.width = _this.outline.width;
                _this._polyline.show = _this.show && _this.showHelper && _this.outline.show;
                _this._polyline.depthTest = _this.depthTest;
            }));

            {
                var getPolylinePositions = function getPolylinePositions() {
                    var l = _this.positions.length / 2;
                    var positions = [];
                    for (var i = 0; i < l; ++i) {
                        positions.push([_this.positions[i * 2], _this.positions[i * 2 + 1], _this.height]);
                    }
                    return positions;
                };

                var setPolylinePositions = function setPolylinePositions(positions) {
                    return _this._polyline && (_this._polyline.positions = positions);
                };
                setPolylinePositions(getPolylinePositions());
                _this.disposers.push((0, _mobx.reaction)(getPolylinePositions, setPolylinePositions));
            }
        }

        /**
         * 是否在三维窗口中编辑
         * @name editing
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.ClassificationPolygon
         */

        /**
         * 是否在三维窗口中进行点增加的编辑
         * @name creating
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.ClassificationPolygon
         */

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreatingWithHeight)(_this._earth, _this, {
            polygonCreatingWithHeight: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));

        (0, _mobx.extendObservable)(_this, {
            _extrudedPosition: [0, 0, 0]
        });

        var updateExtrudedPosition = function updateExtrudedPosition() {
            if (_this.positions.length > 0) {
                _this._extrudedPosition.splice(0, 3, _this.positions[0], _this.positions[1], _this.extrudedHeight);
            }
        };
        updateExtrudedPosition();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                extrudedHeight: _this.extrudedHeight
            };
        }, updateExtrudedPosition));

        var updateExtrudedHeight = function updateExtrudedHeight() {
            _this.extrudedHeight = _this._extrudedPosition[2];
        };
        updateExtrudedHeight();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this._extrudedPosition));
        }, updateExtrudedHeight));

        _this.disposers.push((0, _registerInteractionProperty.registerHeightEditing)(_this._earth, _this, {
            positionHeightEditing: 'extrudedHeightEditing',
            positionProperty: '_extrudedPosition'
        }));
        return _this;
    }

    (0, _createClass3.default)(ClassificationPolygon, [{
        key: 'flyTo',
        value: function flyTo() {
            var camera = this._earth.czm.scene.camera;
            camera.flyToBoundingSphere(this._boundingSphere);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(ClassificationPolygon.prototype.__proto__ || (0, _getPrototypeOf2.default)(ClassificationPolygon.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'boundingSphere',
        get: function get() {
            return this._boundingSphere;
        }
    }]);
    return ClassificationPolygon;
}(_XbsjCzmObj3.default);

/**
 * 外轮廓属性
 * @class 
 * @name Outline
 * @memberof Obj.ClassificationPolygon
 */

var outlineSchema = {
    title: "ClassificationPolygon outline Property",
    type: "object",
    properties: {
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.ClassificationPolygon.Outline
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 颜色叠加
         * @type {array}
         * @instance
         * @default [0, 1, 0, 1]
         * @memberof Obj.ClassificationPolygon.Outline
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [0, 1, 0, 1], description: '颜色叠加' },
        /**
         * 线框的宽度
         * @type {number}
         * @instance
         * @default 2.0
         * @memberof Obj.ClassificationPolygon.Outline
         */
        width: { type: 'number', title: '线框的宽度', default: 2.0, description: '线框的宽度' }
    }
};

var xbsjSchema = {
    title: "ClassificationPolygon Property",
    type: "object",
    properties: {
        /**
         * 位置数组，形式如 [2.012, 0.65, 1.9, 0.7, ...] 分别表示 [经度, 纬度, 经度, 纬度, ...]，注意经度纬度以弧度为单位。
         * @type {array}
         * @instance
         * @default true
         * @memberof Obj.ClassificationPolygon
         */
        positions: { type: 'array', title: '位置数组', default: [], description: '位置数组' },
        /**
         * 多边形的高度
         * @type {number}
         * @instance
         * @default 0.0
         * @memberof Obj.ClassificationPolygon
         */
        height: { type: 'number', title: '多边形的高度', default: 0.0, description: '多边形的高度' },
        /**
         * 是否在三维窗口中显示
         * @type {boolean}
         * @instance
         * @default true
         * @memberof Obj.ClassificationPolygon
         */
        show: { type: 'boolean', title: '是否在三维窗口中显示', default: true, description: '是否在三维窗口中显示' },
        /**
         * 颜色叠加
         * @type {array}
         * @instance
         * @default [1, 1, 1, 1]
         * @memberof Obj.ClassificationPolygon
         */
        color: { type: 'array', items: { type: 'number' }, minItems: 4, maxItems: 4, default: [1, 1, 1, 1], description: '颜色叠加' },
        /**
         * 是否显示辅助线框
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.ClassificationPolygon
         */
        showHelper: { type: 'boolean', title: '是否显示辅助线框', default: false, description: '是否显示辅助线框' },
        /**
         * 外轮廓属性
         * @type {Obj.ClassificationPolygon.Outline}
         * @instance
         * @memberof Obj.ClassificationPolygon
         */
        outline: outlineSchema,
        /**
         * 是否开启深度检测
         * @type {boolean}
         * @instance
         * @default false
         * @memberof Obj.ClassificationPolygon
         */
        depthTest: { type: 'boolean', title: '是否开启深度检测', default: false, description: '是否开启深度检测' }
    }
};

ClassificationPolygon.xbsjSchema = xbsjSchema;

var xbsjClassification = [{
    name: {
        chinese: '通用',
        english: 'General'
    },
    properties: ['positions', 'height', 'show', 'color', 'showHelper', 'outline', 'depthTest']
}];

ClassificationPolygon.xbsjClassification = xbsjClassification;

ClassificationPolygon.defaultOptions = defaultOptions;
_XbsjObject2.default.registerType(ClassificationPolygon, 'ClassificationPolygon');

exports.default = ClassificationPolygon;

/***/ }),
/* 363 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";

Object.defineProperty(exports, "__esModule", { value: true });
// http://en.wikipedia.org/wiki/Delaunay_triangulation
// https://github.com/ironwallaby/delaunay
var helpers_1 = __webpack_require__(171);
/**
 * Takes a set of {@link Point|points} and creates a
 * [Triangulated Irregular Network](http://en.wikipedia.org/wiki/Triangulated_irregular_network),
 * or a TIN for short, returned as a collection of Polygons. These are often used
 * for developing elevation contour maps or stepped heat visualizations.
 *
 * If an optional z-value property is provided then it is added as properties called `a`, `b`,
 * and `c` representing its value at each of the points that represent the corners of the
 * triangle.
 *
 * @name tin
 * @param {FeatureCollection<Point>} points input points
 * @param {String} [z] name of the property from which to pull z values
 * This is optional: if not given, then there will be no extra data added to the derived triangles.
 * @returns {FeatureCollection<Polygon>} TIN output
 * @example
 * // generate some random point data
 * var points = turf.randomPoint(30, {bbox: [50, 30, 70, 50]});
 *
 * // add a random property to each point between 0 and 9
 * for (var i = 0; i < points.features.length; i++) {
 *   points.features[i].properties.z = ~~(Math.random() * 9);
 * }
 * var tin = turf.tin(points, 'z');
 *
 * //addToMap
 * var addToMap = [tin, points]
 * for (var i = 0; i < tin.features.length; i++) {
 *   var properties  = tin.features[i].properties;
 *   properties.fill = '#' + properties.a + properties.b + properties.c;
 * }
 */
function tin(points, z) {
    // break down points
    var isPointZ = false;
    return helpers_1.featureCollection(triangulate(points.features.map(function (p) {
        var point = {
            x: p.geometry.coordinates[0],
            y: p.geometry.coordinates[1],
        };
        if (z) {
            point.z = p.properties[z];
        }
        else if (p.geometry.coordinates.length === 3) {
            isPointZ = true;
            point.z = p.geometry.coordinates[2];
        }
        return point;
    })).map(function (triangle) {
        var a = [triangle.a.x, triangle.a.y];
        var b = [triangle.b.x, triangle.b.y];
        var c = [triangle.c.x, triangle.c.y];
        var properties = {};
        // Add z coordinates to triangle points if user passed
        // them in that way otherwise add it as a property.
        if (isPointZ) {
            a.push(triangle.a.z);
            b.push(triangle.b.z);
            c.push(triangle.c.z);
        }
        else {
            properties = {
                a: triangle.a.z,
                b: triangle.b.z,
                c: triangle.c.z,
            };
        }
        return helpers_1.polygon([[a, b, c, a]], properties);
    }));
}
exports.default = tin;
var Triangle = /** @class */ (function () {
    function Triangle(a, b, c) {
        this.a = a;
        this.b = b;
        this.c = c;
        var A = b.x - a.x;
        var B = b.y - a.y;
        var C = c.x - a.x;
        var D = c.y - a.y;
        var E = A * (a.x + b.x) + B * (a.y + b.y);
        var F = C * (a.x + c.x) + D * (a.y + c.y);
        var G = 2 * (A * (c.y - b.y) - B * (c.x - b.x));
        var dx;
        var dy;
        // If the points of the triangle are collinear, then just find the
        // extremes and use the midpoint as the center of the circumcircle.
        this.x = (D * E - B * F) / G;
        this.y = (A * F - C * E) / G;
        dx = this.x - a.x;
        dy = this.y - a.y;
        this.r = dx * dx + dy * dy;
    }
    return Triangle;
}());
function byX(a, b) {
    return b.x - a.x;
}
function dedup(edges) {
    var j = edges.length;
    var a;
    var b;
    var i;
    var m;
    var n;
    outer: while (j) {
        b = edges[--j];
        a = edges[--j];
        i = j;
        while (i) {
            n = edges[--i];
            m = edges[--i];
            if ((a === m && b === n) || (a === n && b === m)) {
                edges.splice(j, 2);
                edges.splice(i, 2);
                j -= 2;
                continue outer;
            }
        }
    }
}
function triangulate(vertices) {
    // Bail if there aren't enough vertices to form any triangles.
    if (vertices.length < 3) {
        return [];
    }
    // Ensure the vertex array is in order of descending X coordinate
    // (which is needed to ensure a subquadratic runtime), and then find
    // the bounding box around the points.
    vertices.sort(byX);
    var i = vertices.length - 1;
    var xmin = vertices[i].x;
    var xmax = vertices[0].x;
    var ymin = vertices[i].y;
    var ymax = ymin;
    var epsilon = 1e-12;
    var a;
    var b;
    var c;
    var A;
    var B;
    var G;
    while (i--) {
        if (vertices[i].y < ymin) {
            ymin = vertices[i].y;
        }
        if (vertices[i].y > ymax) {
            ymax = vertices[i].y;
        }
    }
    // Find a supertriangle, which is a triangle that surrounds all the
    // vertices. This is used like something of a sentinel value to remove
    // cases in the main algorithm, and is removed before we return any
    // results.
    // Once found, put it in the "open" list. (The "open" list is for
    // triangles who may still need to be considered; the "closed" list is
    // for triangles which do not.)
    var dx = xmax - xmin;
    var dy = ymax - ymin;
    var dmax = (dx > dy) ? dx : dy;
    var xmid = (xmax + xmin) * 0.5;
    var ymid = (ymax + ymin) * 0.5;
    var open = [
        new Triangle({
            __sentinel: true,
            x: xmid - 20 * dmax,
            y: ymid - dmax,
        }, {
            __sentinel: true,
            x: xmid,
            y: ymid + 20 * dmax,
        }, {
            __sentinel: true,
            x: xmid + 20 * dmax,
            y: ymid - dmax,
        })
    ];
    var closed = [];
    var edges = [];
    var j;
    // Incrementally add each vertex to the mesh.
    i = vertices.length;
    while (i--) {
        // For each open triangle, check to see if the current point is
        // inside it's circumcircle. If it is, remove the triangle and add
        // it's edges to an edge list.
        edges.length = 0;
        j = open.length;
        while (j--) {
            // If this point is to the right of this triangle's circumcircle,
            // then this triangle should never get checked again. Remove it
            // from the open list, add it to the closed list, and skip.
            dx = vertices[i].x - open[j].x;
            if (dx > 0 && dx * dx > open[j].r) {
                closed.push(open[j]);
                open.splice(j, 1);
                continue;
            }
            // If not, skip this triangle.
            dy = vertices[i].y - open[j].y;
            if (dx * dx + dy * dy > open[j].r) {
                continue;
            }
            // Remove the triangle and add it's edges to the edge list.
            edges.push(open[j].a, open[j].b, open[j].b, open[j].c, open[j].c, open[j].a);
            open.splice(j, 1);
        }
        // Remove any doubled edges.
        dedup(edges);
        // Add a new triangle for each edge.
        j = edges.length;
        while (j) {
            b = edges[--j];
            a = edges[--j];
            c = vertices[i];
            // Avoid adding colinear triangles (which have error-prone
            // circumcircles)
            A = b.x - a.x;
            B = b.y - a.y;
            G = 2 * (A * (c.y - b.y) - B * (c.x - b.x));
            if (Math.abs(G) > epsilon) {
                open.push(new Triangle(a, b, c));
            }
        }
    }
    // Copy any remaining open triangles to the closed list, and then
    // remove any triangles that share a vertex with the supertriangle.
    Array.prototype.push.apply(closed, open);
    i = closed.length;
    while (i--) {
        if (closed[i].a.__sentinel ||
            closed[i].b.__sentinel ||
            closed[i].c.__sentinel) {
            closed.splice(i, 1);
        }
    }
    return closed;
}


/***/ }),
/* 364 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_bearing__ = __webpack_require__(365);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__turf_destination__ = __webpack_require__(368);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__turf_distance__ = __webpack_require__(370);




/**
 * Takes two {@link Point|points} and returns a point midway between them.
 * The midpoint is calculated geodesically, meaning the curvature of the earth is taken into account.
 *
 * @name midpoint
 * @param {Coord} point1 first point
 * @param {Coord} point2 second point
 * @returns {Feature<Point>} a point midway between `pt1` and `pt2`
 * @example
 * var point1 = turf.point([144.834823, -37.771257]);
 * var point2 = turf.point([145.14244, -37.830937]);
 *
 * var midpoint = turf.midpoint(point1, point2);
 *
 * //addToMap
 * var addToMap = [point1, point2, midpoint];
 * midpoint.properties['marker-color'] = '#f00';
 */
function midpoint(point1, point2) {
    var dist = Object(__WEBPACK_IMPORTED_MODULE_2__turf_distance__["a" /* default */])(point1, point2);
    var heading = Object(__WEBPACK_IMPORTED_MODULE_0__turf_bearing__["a" /* default */])(point1, point2);
    var midpoint = Object(__WEBPACK_IMPORTED_MODULE_1__turf_destination__["a" /* default */])(point1, dist / 2, heading);

    return midpoint;
}

/* harmony default export */ __webpack_exports__["default"] = (midpoint);


/***/ }),
/* 365 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = bearing;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_helpers__ = __webpack_require__(366);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__turf_invariant__ = __webpack_require__(85);


// http://en.wikipedia.org/wiki/Haversine_formula
// http://www.movable-type.co.uk/scripts/latlong.html
/**
 * Takes two {@link Point|points} and finds the geographic bearing between them,
 * i.e. the angle measured in degrees from the north line (0 degrees)
 *
 * @name bearing
 * @param {Coord} start starting Point
 * @param {Coord} end ending Point
 * @param {Object} [options={}] Optional parameters
 * @param {boolean} [options.final=false] calculates the final bearing if true
 * @returns {number} bearing in decimal degrees, between -180 and 180 degrees (positive clockwise)
 * @example
 * var point1 = turf.point([-75.343, 39.984]);
 * var point2 = turf.point([-75.534, 39.123]);
 *
 * var bearing = turf.bearing(point1, point2);
 *
 * //addToMap
 * var addToMap = [point1, point2]
 * point1.properties['marker-color'] = '#f00'
 * point2.properties['marker-color'] = '#0f0'
 * point1.properties.bearing = bearing
 */
function bearing(start, end, options) {
    if (options === void 0) { options = {}; }
    // Reverse calculation
    if (options.final === true) {
        return calculateFinalBearing(start, end);
    }
    var coordinates1 = Object(__WEBPACK_IMPORTED_MODULE_1__turf_invariant__["a" /* getCoord */])(start);
    var coordinates2 = Object(__WEBPACK_IMPORTED_MODULE_1__turf_invariant__["a" /* getCoord */])(end);
    var lon1 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates1[0]);
    var lon2 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates2[0]);
    var lat1 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates1[1]);
    var lat2 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates2[1]);
    var a = Math.sin(lon2 - lon1) * Math.cos(lat2);
    var b = Math.cos(lat1) * Math.sin(lat2) -
        Math.sin(lat1) * Math.cos(lat2) * Math.cos(lon2 - lon1);
    return Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["b" /* radiansToDegrees */])(Math.atan2(a, b));
}
/**
 * Calculates Final Bearing
 *
 * @private
 * @param {Coord} start starting Point
 * @param {Coord} end ending Point
 * @returns {number} bearing
 */
function calculateFinalBearing(start, end) {
    // Swap start & end
    var bear = bearing(end, start);
    bear = (bear + 180) % 360;
    return bear;
}


/***/ }),
/* 366 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export earthRadius */
/* unused harmony export factors */
/* unused harmony export unitsFactors */
/* unused harmony export areaFactors */
/* unused harmony export feature */
/* unused harmony export geometry */
/* unused harmony export point */
/* unused harmony export points */
/* unused harmony export polygon */
/* unused harmony export polygons */
/* unused harmony export lineString */
/* unused harmony export lineStrings */
/* unused harmony export featureCollection */
/* unused harmony export multiLineString */
/* unused harmony export multiPoint */
/* unused harmony export multiPolygon */
/* unused harmony export geometryCollection */
/* unused harmony export round */
/* unused harmony export radiansToLength */
/* unused harmony export lengthToRadians */
/* unused harmony export lengthToDegrees */
/* unused harmony export bearingToAzimuth */
/* harmony export (immutable) */ __webpack_exports__["b"] = radiansToDegrees;
/* harmony export (immutable) */ __webpack_exports__["a"] = degreesToRadians;
/* unused harmony export convertLength */
/* unused harmony export convertArea */
/* unused harmony export isNumber */
/* unused harmony export isObject */
/* unused harmony export validateBBox */
/* unused harmony export validateId */
/* unused harmony export radians2degrees */
/* unused harmony export degrees2radians */
/* unused harmony export distanceToDegrees */
/* unused harmony export distanceToRadians */
/* unused harmony export radiansToDistance */
/* unused harmony export bearingToAngle */
/* unused harmony export convertDistance */
/**
 * @module helpers
 */
/**
 * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.
 *
 * @memberof helpers
 * @type {number}
 */
var earthRadius = 6371008.8;
/**
 * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.
 *
 * @memberof helpers
 * @type {Object}
 */
var factors = {
    centimeters: earthRadius * 100,
    centimetres: earthRadius * 100,
    degrees: earthRadius / 111325,
    feet: earthRadius * 3.28084,
    inches: earthRadius * 39.370,
    kilometers: earthRadius / 1000,
    kilometres: earthRadius / 1000,
    meters: earthRadius,
    metres: earthRadius,
    miles: earthRadius / 1609.344,
    millimeters: earthRadius * 1000,
    millimetres: earthRadius * 1000,
    nauticalmiles: earthRadius / 1852,
    radians: 1,
    yards: earthRadius / 1.0936,
};
/**
 * Units of measurement factors based on 1 meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var unitsFactors = {
    centimeters: 100,
    centimetres: 100,
    degrees: 1 / 111325,
    feet: 3.28084,
    inches: 39.370,
    kilometers: 1 / 1000,
    kilometres: 1 / 1000,
    meters: 1,
    metres: 1,
    miles: 1 / 1609.344,
    millimeters: 1000,
    millimetres: 1000,
    nauticalmiles: 1 / 1852,
    radians: 1 / earthRadius,
    yards: 1 / 1.0936,
};
/**
 * Area of measurement factors based on 1 square meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var areaFactors = {
    acres: 0.000247105,
    centimeters: 10000,
    centimetres: 10000,
    feet: 10.763910417,
    inches: 1550.003100006,
    kilometers: 0.000001,
    kilometres: 0.000001,
    meters: 1,
    metres: 1,
    miles: 3.86e-7,
    millimeters: 1000000,
    millimetres: 1000000,
    yards: 1.195990046,
};
/**
 * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.
 *
 * @name feature
 * @param {Geometry} geometry input geometry
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature} a GeoJSON Feature
 * @example
 * var geometry = {
 *   "type": "Point",
 *   "coordinates": [110, 50]
 * };
 *
 * var feature = turf.feature(geometry);
 *
 * //=feature
 */
function feature(geom, properties, options) {
    if (options === void 0) { options = {}; }
    var feat = { type: "Feature" };
    if (options.id === 0 || options.id) {
        feat.id = options.id;
    }
    if (options.bbox) {
        feat.bbox = options.bbox;
    }
    feat.properties = properties || {};
    feat.geometry = geom;
    return feat;
}
/**
 * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.
 * For GeometryCollection type use `helpers.geometryCollection`
 *
 * @name geometry
 * @param {string} type Geometry Type
 * @param {Array<any>} coordinates Coordinates
 * @param {Object} [options={}] Optional Parameters
 * @returns {Geometry} a GeoJSON Geometry
 * @example
 * var type = "Point";
 * var coordinates = [110, 50];
 * var geometry = turf.geometry(type, coordinates);
 * // => geometry
 */
function geometry(type, coordinates, options) {
    if (options === void 0) { options = {}; }
    switch (type) {
        case "Point": return point(coordinates).geometry;
        case "LineString": return lineString(coordinates).geometry;
        case "Polygon": return polygon(coordinates).geometry;
        case "MultiPoint": return multiPoint(coordinates).geometry;
        case "MultiLineString": return multiLineString(coordinates).geometry;
        case "MultiPolygon": return multiPolygon(coordinates).geometry;
        default: throw new Error(type + " is invalid");
    }
}
/**
 * Creates a {@link Point} {@link Feature} from a Position.
 *
 * @name point
 * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Point>} a Point feature
 * @example
 * var point = turf.point([-75.343, 39.984]);
 *
 * //=point
 */
function point(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "Point",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.
 *
 * @name points
 * @param {Array<Array<number>>} coordinates an array of Points
 * @param {Object} [properties={}] Translate these properties to each Feature
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Point>} Point Feature
 * @example
 * var points = turf.points([
 *   [-75, 39],
 *   [-80, 45],
 *   [-78, 50]
 * ]);
 *
 * //=points
 */
function points(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return point(coords, properties);
    }), options);
}
/**
 * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.
 *
 * @name polygon
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Polygon>} Polygon Feature
 * @example
 * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });
 *
 * //=polygon
 */
function polygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {
        var ring = coordinates_1[_i];
        if (ring.length < 4) {
            throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
        }
        for (var j = 0; j < ring[ring.length - 1].length; j++) {
            // Check if first point of Polygon contains two numbers
            if (ring[ring.length - 1][j] !== ring[0][j]) {
                throw new Error("First and last Position are not equivalent.");
            }
        }
    }
    var geom = {
        type: "Polygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.
 *
 * @name polygons
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection
 * @example
 * var polygons = turf.polygons([
 *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],
 *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],
 * ]);
 *
 * //=polygons
 */
function polygons(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return polygon(coords, properties);
    }), options);
}
/**
 * Creates a {@link LineString} {@link Feature} from an Array of Positions.
 *
 * @name lineString
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<LineString>} LineString Feature
 * @example
 * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});
 * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});
 *
 * //=linestring1
 * //=linestring2
 */
function lineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    if (coordinates.length < 2) {
        throw new Error("coordinates must be an array of two or more positions");
    }
    var geom = {
        type: "LineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.
 *
 * @name lineStrings
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<LineString>} LineString FeatureCollection
 * @example
 * var linestrings = turf.lineStrings([
 *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],
 *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]
 * ]);
 *
 * //=linestrings
 */
function lineStrings(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return lineString(coords, properties);
    }), options);
}
/**
 * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.
 *
 * @name featureCollection
 * @param {Feature[]} features input features
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {FeatureCollection} FeatureCollection of Features
 * @example
 * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});
 * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});
 * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});
 *
 * var collection = turf.featureCollection([
 *   locationA,
 *   locationB,
 *   locationC
 * ]);
 *
 * //=collection
 */
function featureCollection(features, options) {
    if (options === void 0) { options = {}; }
    var fc = { type: "FeatureCollection" };
    if (options.id) {
        fc.id = options.id;
    }
    if (options.bbox) {
        fc.bbox = options.bbox;
    }
    fc.features = features;
    return fc;
}
/**
 * Creates a {@link Feature<MultiLineString>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiLineString
 * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiLineString>} a MultiLineString feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);
 *
 * //=multiLine
 */
function multiLineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiLineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPoint>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPoint
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPoint>} a MultiPoint feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPt = turf.multiPoint([[0,0],[10,10]]);
 *
 * //=multiPt
 */
function multiPoint(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPoint",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPolygon>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPolygon
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPolygon>} a multipolygon feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);
 *
 * //=multiPoly
 *
 */
function multiPolygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPolygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<GeometryCollection>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name geometryCollection
 * @param {Array<Geometry>} geometries an array of GeoJSON Geometries
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature
 * @example
 * var pt = turf.geometry("Point", [100, 0]);
 * var line = turf.geometry("LineString", [[101, 0], [102, 1]]);
 * var collection = turf.geometryCollection([pt, line]);
 *
 * // => collection
 */
function geometryCollection(geometries, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "GeometryCollection",
        geometries: geometries,
    };
    return feature(geom, properties, options);
}
/**
 * Round number to precision
 *
 * @param {number} num Number
 * @param {number} [precision=0] Precision
 * @returns {number} rounded number
 * @example
 * turf.round(120.4321)
 * //=120
 *
 * turf.round(120.4321, 2)
 * //=120.43
 */
function round(num, precision) {
    if (precision === void 0) { precision = 0; }
    if (precision && !(precision >= 0)) {
        throw new Error("precision must be a positive number");
    }
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(num * multiplier) / multiplier;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name radiansToLength
 * @param {number} radians in radians across the sphere
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} distance
 */
function radiansToLength(radians, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return radians * factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name lengthToRadians
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} radians
 */
function lengthToRadians(distance, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return distance / factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet
 *
 * @name lengthToDegrees
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} degrees
 */
function lengthToDegrees(distance, units) {
    return radiansToDegrees(lengthToRadians(distance, units));
}
/**
 * Converts any bearing angle from the north line direction (positive clockwise)
 * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line
 *
 * @name bearingToAzimuth
 * @param {number} bearing angle, between -180 and +180 degrees
 * @returns {number} angle between 0 and 360 degrees
 */
function bearingToAzimuth(bearing) {
    var angle = bearing % 360;
    if (angle < 0) {
        angle += 360;
    }
    return angle;
}
/**
 * Converts an angle in radians to degrees
 *
 * @name radiansToDegrees
 * @param {number} radians angle in radians
 * @returns {number} degrees between 0 and 360 degrees
 */
function radiansToDegrees(radians) {
    var degrees = radians % (2 * Math.PI);
    return degrees * 180 / Math.PI;
}
/**
 * Converts an angle in degrees to radians
 *
 * @name degreesToRadians
 * @param {number} degrees angle between 0 and 360 degrees
 * @returns {number} angle in radians
 */
function degreesToRadians(degrees) {
    var radians = degrees % 360;
    return radians * Math.PI / 180;
}
/**
 * Converts a length to the requested unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @param {number} length to be converted
 * @param {Units} [originalUnit="kilometers"] of the length
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted length
 */
function convertLength(length, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "kilometers"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(length >= 0)) {
        throw new Error("length must be a positive number");
    }
    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);
}
/**
 * Converts a area to the requested unit.
 * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches
 * @param {number} area to be converted
 * @param {Units} [originalUnit="meters"] of the distance
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted distance
 */
function convertArea(area, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "meters"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(area >= 0)) {
        throw new Error("area must be a positive number");
    }
    var startFactor = areaFactors[originalUnit];
    if (!startFactor) {
        throw new Error("invalid original units");
    }
    var finalFactor = areaFactors[finalUnit];
    if (!finalFactor) {
        throw new Error("invalid final units");
    }
    return (area / startFactor) * finalFactor;
}
/**
 * isNumber
 *
 * @param {*} num Number to validate
 * @returns {boolean} true/false
 * @example
 * turf.isNumber(123)
 * //=true
 * turf.isNumber('foo')
 * //=false
 */
function isNumber(num) {
    return !isNaN(num) && num !== null && !Array.isArray(num);
}
/**
 * isObject
 *
 * @param {*} input variable to validate
 * @returns {boolean} true/false
 * @example
 * turf.isObject({elevation: 10})
 * //=true
 * turf.isObject('foo')
 * //=false
 */
function isObject(input) {
    return (!!input) && (input.constructor === Object);
}
/**
 * Validate BBox
 *
 * @private
 * @param {Array<number>} bbox BBox to validate
 * @returns {void}
 * @throws Error if BBox is not valid
 * @example
 * validateBBox([-180, -40, 110, 50])
 * //=OK
 * validateBBox([-180, -40])
 * //=Error
 * validateBBox('Foo')
 * //=Error
 * validateBBox(5)
 * //=Error
 * validateBBox(null)
 * //=Error
 * validateBBox(undefined)
 * //=Error
 */
function validateBBox(bbox) {
    if (!bbox) {
        throw new Error("bbox is required");
    }
    if (!Array.isArray(bbox)) {
        throw new Error("bbox must be an Array");
    }
    if (bbox.length !== 4 && bbox.length !== 6) {
        throw new Error("bbox must be an Array of 4 or 6 numbers");
    }
    bbox.forEach(function (num) {
        if (!isNumber(num)) {
            throw new Error("bbox must only contain numbers");
        }
    });
}
/**
 * Validate Id
 *
 * @private
 * @param {string|number} id Id to validate
 * @returns {void}
 * @throws Error if Id is not valid
 * @example
 * validateId([-180, -40, 110, 50])
 * //=Error
 * validateId([-180, -40])
 * //=Error
 * validateId('Foo')
 * //=OK
 * validateId(5)
 * //=OK
 * validateId(null)
 * //=Error
 * validateId(undefined)
 * //=Error
 */
function validateId(id) {
    if (!id) {
        throw new Error("id is required");
    }
    if (["string", "number"].indexOf(typeof id) === -1) {
        throw new Error("id must be a number or a string");
    }
}
// Deprecated methods
function radians2degrees() {
    throw new Error("method has been renamed to `radiansToDegrees`");
}
function degrees2radians() {
    throw new Error("method has been renamed to `degreesToRadians`");
}
function distanceToDegrees() {
    throw new Error("method has been renamed to `lengthToDegrees`");
}
function distanceToRadians() {
    throw new Error("method has been renamed to `lengthToRadians`");
}
function radiansToDistance() {
    throw new Error("method has been renamed to `radiansToLength`");
}
function bearingToAngle() {
    throw new Error("method has been renamed to `bearingToAzimuth`");
}
function convertDistance() {
    throw new Error("method has been renamed to `convertLength`");
}


/***/ }),
/* 367 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export earthRadius */
/* unused harmony export factors */
/* unused harmony export unitsFactors */
/* unused harmony export areaFactors */
/* unused harmony export feature */
/* unused harmony export geometry */
/* unused harmony export point */
/* unused harmony export points */
/* unused harmony export polygon */
/* unused harmony export polygons */
/* unused harmony export lineString */
/* unused harmony export lineStrings */
/* unused harmony export featureCollection */
/* unused harmony export multiLineString */
/* unused harmony export multiPoint */
/* unused harmony export multiPolygon */
/* unused harmony export geometryCollection */
/* unused harmony export round */
/* unused harmony export radiansToLength */
/* unused harmony export lengthToRadians */
/* unused harmony export lengthToDegrees */
/* unused harmony export bearingToAzimuth */
/* unused harmony export radiansToDegrees */
/* unused harmony export degreesToRadians */
/* unused harmony export convertLength */
/* unused harmony export convertArea */
/* harmony export (immutable) */ __webpack_exports__["a"] = isNumber;
/* unused harmony export isObject */
/* unused harmony export validateBBox */
/* unused harmony export validateId */
/* unused harmony export radians2degrees */
/* unused harmony export degrees2radians */
/* unused harmony export distanceToDegrees */
/* unused harmony export distanceToRadians */
/* unused harmony export radiansToDistance */
/* unused harmony export bearingToAngle */
/* unused harmony export convertDistance */
/**
 * @module helpers
 */
/**
 * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.
 *
 * @memberof helpers
 * @type {number}
 */
var earthRadius = 6371008.8;
/**
 * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.
 *
 * @memberof helpers
 * @type {Object}
 */
var factors = {
    centimeters: earthRadius * 100,
    centimetres: earthRadius * 100,
    degrees: earthRadius / 111325,
    feet: earthRadius * 3.28084,
    inches: earthRadius * 39.370,
    kilometers: earthRadius / 1000,
    kilometres: earthRadius / 1000,
    meters: earthRadius,
    metres: earthRadius,
    miles: earthRadius / 1609.344,
    millimeters: earthRadius * 1000,
    millimetres: earthRadius * 1000,
    nauticalmiles: earthRadius / 1852,
    radians: 1,
    yards: earthRadius / 1.0936,
};
/**
 * Units of measurement factors based on 1 meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var unitsFactors = {
    centimeters: 100,
    centimetres: 100,
    degrees: 1 / 111325,
    feet: 3.28084,
    inches: 39.370,
    kilometers: 1 / 1000,
    kilometres: 1 / 1000,
    meters: 1,
    metres: 1,
    miles: 1 / 1609.344,
    millimeters: 1000,
    millimetres: 1000,
    nauticalmiles: 1 / 1852,
    radians: 1 / earthRadius,
    yards: 1 / 1.0936,
};
/**
 * Area of measurement factors based on 1 square meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var areaFactors = {
    acres: 0.000247105,
    centimeters: 10000,
    centimetres: 10000,
    feet: 10.763910417,
    inches: 1550.003100006,
    kilometers: 0.000001,
    kilometres: 0.000001,
    meters: 1,
    metres: 1,
    miles: 3.86e-7,
    millimeters: 1000000,
    millimetres: 1000000,
    yards: 1.195990046,
};
/**
 * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.
 *
 * @name feature
 * @param {Geometry} geometry input geometry
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature} a GeoJSON Feature
 * @example
 * var geometry = {
 *   "type": "Point",
 *   "coordinates": [110, 50]
 * };
 *
 * var feature = turf.feature(geometry);
 *
 * //=feature
 */
function feature(geom, properties, options) {
    if (options === void 0) { options = {}; }
    var feat = { type: "Feature" };
    if (options.id === 0 || options.id) {
        feat.id = options.id;
    }
    if (options.bbox) {
        feat.bbox = options.bbox;
    }
    feat.properties = properties || {};
    feat.geometry = geom;
    return feat;
}
/**
 * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.
 * For GeometryCollection type use `helpers.geometryCollection`
 *
 * @name geometry
 * @param {string} type Geometry Type
 * @param {Array<any>} coordinates Coordinates
 * @param {Object} [options={}] Optional Parameters
 * @returns {Geometry} a GeoJSON Geometry
 * @example
 * var type = "Point";
 * var coordinates = [110, 50];
 * var geometry = turf.geometry(type, coordinates);
 * // => geometry
 */
function geometry(type, coordinates, options) {
    if (options === void 0) { options = {}; }
    switch (type) {
        case "Point": return point(coordinates).geometry;
        case "LineString": return lineString(coordinates).geometry;
        case "Polygon": return polygon(coordinates).geometry;
        case "MultiPoint": return multiPoint(coordinates).geometry;
        case "MultiLineString": return multiLineString(coordinates).geometry;
        case "MultiPolygon": return multiPolygon(coordinates).geometry;
        default: throw new Error(type + " is invalid");
    }
}
/**
 * Creates a {@link Point} {@link Feature} from a Position.
 *
 * @name point
 * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Point>} a Point feature
 * @example
 * var point = turf.point([-75.343, 39.984]);
 *
 * //=point
 */
function point(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "Point",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.
 *
 * @name points
 * @param {Array<Array<number>>} coordinates an array of Points
 * @param {Object} [properties={}] Translate these properties to each Feature
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Point>} Point Feature
 * @example
 * var points = turf.points([
 *   [-75, 39],
 *   [-80, 45],
 *   [-78, 50]
 * ]);
 *
 * //=points
 */
function points(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return point(coords, properties);
    }), options);
}
/**
 * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.
 *
 * @name polygon
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Polygon>} Polygon Feature
 * @example
 * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });
 *
 * //=polygon
 */
function polygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {
        var ring = coordinates_1[_i];
        if (ring.length < 4) {
            throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
        }
        for (var j = 0; j < ring[ring.length - 1].length; j++) {
            // Check if first point of Polygon contains two numbers
            if (ring[ring.length - 1][j] !== ring[0][j]) {
                throw new Error("First and last Position are not equivalent.");
            }
        }
    }
    var geom = {
        type: "Polygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.
 *
 * @name polygons
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection
 * @example
 * var polygons = turf.polygons([
 *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],
 *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],
 * ]);
 *
 * //=polygons
 */
function polygons(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return polygon(coords, properties);
    }), options);
}
/**
 * Creates a {@link LineString} {@link Feature} from an Array of Positions.
 *
 * @name lineString
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<LineString>} LineString Feature
 * @example
 * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});
 * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});
 *
 * //=linestring1
 * //=linestring2
 */
function lineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    if (coordinates.length < 2) {
        throw new Error("coordinates must be an array of two or more positions");
    }
    var geom = {
        type: "LineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.
 *
 * @name lineStrings
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<LineString>} LineString FeatureCollection
 * @example
 * var linestrings = turf.lineStrings([
 *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],
 *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]
 * ]);
 *
 * //=linestrings
 */
function lineStrings(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return lineString(coords, properties);
    }), options);
}
/**
 * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.
 *
 * @name featureCollection
 * @param {Feature[]} features input features
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {FeatureCollection} FeatureCollection of Features
 * @example
 * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});
 * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});
 * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});
 *
 * var collection = turf.featureCollection([
 *   locationA,
 *   locationB,
 *   locationC
 * ]);
 *
 * //=collection
 */
function featureCollection(features, options) {
    if (options === void 0) { options = {}; }
    var fc = { type: "FeatureCollection" };
    if (options.id) {
        fc.id = options.id;
    }
    if (options.bbox) {
        fc.bbox = options.bbox;
    }
    fc.features = features;
    return fc;
}
/**
 * Creates a {@link Feature<MultiLineString>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiLineString
 * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiLineString>} a MultiLineString feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);
 *
 * //=multiLine
 */
function multiLineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiLineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPoint>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPoint
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPoint>} a MultiPoint feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPt = turf.multiPoint([[0,0],[10,10]]);
 *
 * //=multiPt
 */
function multiPoint(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPoint",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPolygon>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPolygon
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPolygon>} a multipolygon feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);
 *
 * //=multiPoly
 *
 */
function multiPolygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPolygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<GeometryCollection>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name geometryCollection
 * @param {Array<Geometry>} geometries an array of GeoJSON Geometries
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature
 * @example
 * var pt = turf.geometry("Point", [100, 0]);
 * var line = turf.geometry("LineString", [[101, 0], [102, 1]]);
 * var collection = turf.geometryCollection([pt, line]);
 *
 * // => collection
 */
function geometryCollection(geometries, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "GeometryCollection",
        geometries: geometries,
    };
    return feature(geom, properties, options);
}
/**
 * Round number to precision
 *
 * @param {number} num Number
 * @param {number} [precision=0] Precision
 * @returns {number} rounded number
 * @example
 * turf.round(120.4321)
 * //=120
 *
 * turf.round(120.4321, 2)
 * //=120.43
 */
function round(num, precision) {
    if (precision === void 0) { precision = 0; }
    if (precision && !(precision >= 0)) {
        throw new Error("precision must be a positive number");
    }
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(num * multiplier) / multiplier;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name radiansToLength
 * @param {number} radians in radians across the sphere
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} distance
 */
function radiansToLength(radians, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return radians * factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name lengthToRadians
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} radians
 */
function lengthToRadians(distance, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return distance / factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet
 *
 * @name lengthToDegrees
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} degrees
 */
function lengthToDegrees(distance, units) {
    return radiansToDegrees(lengthToRadians(distance, units));
}
/**
 * Converts any bearing angle from the north line direction (positive clockwise)
 * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line
 *
 * @name bearingToAzimuth
 * @param {number} bearing angle, between -180 and +180 degrees
 * @returns {number} angle between 0 and 360 degrees
 */
function bearingToAzimuth(bearing) {
    var angle = bearing % 360;
    if (angle < 0) {
        angle += 360;
    }
    return angle;
}
/**
 * Converts an angle in radians to degrees
 *
 * @name radiansToDegrees
 * @param {number} radians angle in radians
 * @returns {number} degrees between 0 and 360 degrees
 */
function radiansToDegrees(radians) {
    var degrees = radians % (2 * Math.PI);
    return degrees * 180 / Math.PI;
}
/**
 * Converts an angle in degrees to radians
 *
 * @name degreesToRadians
 * @param {number} degrees angle between 0 and 360 degrees
 * @returns {number} angle in radians
 */
function degreesToRadians(degrees) {
    var radians = degrees % 360;
    return radians * Math.PI / 180;
}
/**
 * Converts a length to the requested unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @param {number} length to be converted
 * @param {Units} [originalUnit="kilometers"] of the length
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted length
 */
function convertLength(length, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "kilometers"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(length >= 0)) {
        throw new Error("length must be a positive number");
    }
    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);
}
/**
 * Converts a area to the requested unit.
 * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches
 * @param {number} area to be converted
 * @param {Units} [originalUnit="meters"] of the distance
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted distance
 */
function convertArea(area, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "meters"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(area >= 0)) {
        throw new Error("area must be a positive number");
    }
    var startFactor = areaFactors[originalUnit];
    if (!startFactor) {
        throw new Error("invalid original units");
    }
    var finalFactor = areaFactors[finalUnit];
    if (!finalFactor) {
        throw new Error("invalid final units");
    }
    return (area / startFactor) * finalFactor;
}
/**
 * isNumber
 *
 * @param {*} num Number to validate
 * @returns {boolean} true/false
 * @example
 * turf.isNumber(123)
 * //=true
 * turf.isNumber('foo')
 * //=false
 */
function isNumber(num) {
    return !isNaN(num) && num !== null && !Array.isArray(num);
}
/**
 * isObject
 *
 * @param {*} input variable to validate
 * @returns {boolean} true/false
 * @example
 * turf.isObject({elevation: 10})
 * //=true
 * turf.isObject('foo')
 * //=false
 */
function isObject(input) {
    return (!!input) && (input.constructor === Object);
}
/**
 * Validate BBox
 *
 * @private
 * @param {Array<number>} bbox BBox to validate
 * @returns {void}
 * @throws Error if BBox is not valid
 * @example
 * validateBBox([-180, -40, 110, 50])
 * //=OK
 * validateBBox([-180, -40])
 * //=Error
 * validateBBox('Foo')
 * //=Error
 * validateBBox(5)
 * //=Error
 * validateBBox(null)
 * //=Error
 * validateBBox(undefined)
 * //=Error
 */
function validateBBox(bbox) {
    if (!bbox) {
        throw new Error("bbox is required");
    }
    if (!Array.isArray(bbox)) {
        throw new Error("bbox must be an Array");
    }
    if (bbox.length !== 4 && bbox.length !== 6) {
        throw new Error("bbox must be an Array of 4 or 6 numbers");
    }
    bbox.forEach(function (num) {
        if (!isNumber(num)) {
            throw new Error("bbox must only contain numbers");
        }
    });
}
/**
 * Validate Id
 *
 * @private
 * @param {string|number} id Id to validate
 * @returns {void}
 * @throws Error if Id is not valid
 * @example
 * validateId([-180, -40, 110, 50])
 * //=Error
 * validateId([-180, -40])
 * //=Error
 * validateId('Foo')
 * //=OK
 * validateId(5)
 * //=OK
 * validateId(null)
 * //=Error
 * validateId(undefined)
 * //=Error
 */
function validateId(id) {
    if (!id) {
        throw new Error("id is required");
    }
    if (["string", "number"].indexOf(typeof id) === -1) {
        throw new Error("id must be a number or a string");
    }
}
// Deprecated methods
function radians2degrees() {
    throw new Error("method has been renamed to `radiansToDegrees`");
}
function degrees2radians() {
    throw new Error("method has been renamed to `degreesToRadians`");
}
function distanceToDegrees() {
    throw new Error("method has been renamed to `lengthToDegrees`");
}
function distanceToRadians() {
    throw new Error("method has been renamed to `lengthToRadians`");
}
function radiansToDistance() {
    throw new Error("method has been renamed to `radiansToLength`");
}
function bearingToAngle() {
    throw new Error("method has been renamed to `bearingToAzimuth`");
}
function convertDistance() {
    throw new Error("method has been renamed to `convertLength`");
}


/***/ }),
/* 368 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = destination;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_helpers__ = __webpack_require__(369);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__turf_invariant__ = __webpack_require__(85);
// http://en.wikipedia.org/wiki/Haversine_formula
// http://www.movable-type.co.uk/scripts/latlong.html


/**
 * Takes a {@link Point} and calculates the location of a destination point given a distance in
 * degrees, radians, miles, or kilometers; and bearing in degrees.
 * This uses the [Haversine formula](http://en.wikipedia.org/wiki/Haversine_formula) to account for global curvature.
 *
 * @name destination
 * @param {Coord} origin starting point
 * @param {number} distance distance from the origin point
 * @param {number} bearing ranging from -180 to 180
 * @param {Object} [options={}] Optional parameters
 * @param {string} [options.units='kilometers'] miles, kilometers, degrees, or radians
 * @param {Object} [options.properties={}] Translate properties to Point
 * @returns {Feature<Point>} destination point
 * @example
 * var point = turf.point([-75.343, 39.984]);
 * var distance = 50;
 * var bearing = 90;
 * var options = {units: 'miles'};
 *
 * var destination = turf.destination(point, distance, bearing, options);
 *
 * //addToMap
 * var addToMap = [point, destination]
 * destination.properties['marker-color'] = '#f00';
 * point.properties['marker-color'] = '#0f0';
 */
function destination(origin, distance, bearing, options) {
    if (options === void 0) { options = {}; }
    // Handle input
    var coordinates1 = Object(__WEBPACK_IMPORTED_MODULE_1__turf_invariant__["a" /* getCoord */])(origin);
    var longitude1 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates1[0]);
    var latitude1 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(coordinates1[1]);
    var bearingRad = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["a" /* degreesToRadians */])(bearing);
    var radians = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["b" /* lengthToRadians */])(distance, options.units);
    // Main
    var latitude2 = Math.asin(Math.sin(latitude1) * Math.cos(radians) +
        Math.cos(latitude1) * Math.sin(radians) * Math.cos(bearingRad));
    var longitude2 = longitude1 + Math.atan2(Math.sin(bearingRad) * Math.sin(radians) * Math.cos(latitude1), Math.cos(radians) - Math.sin(latitude1) * Math.sin(latitude2));
    var lng = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["d" /* radiansToDegrees */])(longitude2);
    var lat = Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["d" /* radiansToDegrees */])(latitude2);
    return Object(__WEBPACK_IMPORTED_MODULE_0__turf_helpers__["c" /* point */])([lng, lat], options.properties);
}


/***/ }),
/* 369 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export earthRadius */
/* unused harmony export factors */
/* unused harmony export unitsFactors */
/* unused harmony export areaFactors */
/* unused harmony export feature */
/* unused harmony export geometry */
/* harmony export (immutable) */ __webpack_exports__["c"] = point;
/* unused harmony export points */
/* unused harmony export polygon */
/* unused harmony export polygons */
/* unused harmony export lineString */
/* unused harmony export lineStrings */
/* unused harmony export featureCollection */
/* unused harmony export multiLineString */
/* unused harmony export multiPoint */
/* unused harmony export multiPolygon */
/* unused harmony export geometryCollection */
/* unused harmony export round */
/* unused harmony export radiansToLength */
/* harmony export (immutable) */ __webpack_exports__["b"] = lengthToRadians;
/* unused harmony export lengthToDegrees */
/* unused harmony export bearingToAzimuth */
/* harmony export (immutable) */ __webpack_exports__["d"] = radiansToDegrees;
/* harmony export (immutable) */ __webpack_exports__["a"] = degreesToRadians;
/* unused harmony export convertLength */
/* unused harmony export convertArea */
/* unused harmony export isNumber */
/* unused harmony export isObject */
/* unused harmony export validateBBox */
/* unused harmony export validateId */
/* unused harmony export radians2degrees */
/* unused harmony export degrees2radians */
/* unused harmony export distanceToDegrees */
/* unused harmony export distanceToRadians */
/* unused harmony export radiansToDistance */
/* unused harmony export bearingToAngle */
/* unused harmony export convertDistance */
/**
 * @module helpers
 */
/**
 * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.
 *
 * @memberof helpers
 * @type {number}
 */
var earthRadius = 6371008.8;
/**
 * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.
 *
 * @memberof helpers
 * @type {Object}
 */
var factors = {
    centimeters: earthRadius * 100,
    centimetres: earthRadius * 100,
    degrees: earthRadius / 111325,
    feet: earthRadius * 3.28084,
    inches: earthRadius * 39.370,
    kilometers: earthRadius / 1000,
    kilometres: earthRadius / 1000,
    meters: earthRadius,
    metres: earthRadius,
    miles: earthRadius / 1609.344,
    millimeters: earthRadius * 1000,
    millimetres: earthRadius * 1000,
    nauticalmiles: earthRadius / 1852,
    radians: 1,
    yards: earthRadius / 1.0936,
};
/**
 * Units of measurement factors based on 1 meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var unitsFactors = {
    centimeters: 100,
    centimetres: 100,
    degrees: 1 / 111325,
    feet: 3.28084,
    inches: 39.370,
    kilometers: 1 / 1000,
    kilometres: 1 / 1000,
    meters: 1,
    metres: 1,
    miles: 1 / 1609.344,
    millimeters: 1000,
    millimetres: 1000,
    nauticalmiles: 1 / 1852,
    radians: 1 / earthRadius,
    yards: 1 / 1.0936,
};
/**
 * Area of measurement factors based on 1 square meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var areaFactors = {
    acres: 0.000247105,
    centimeters: 10000,
    centimetres: 10000,
    feet: 10.763910417,
    inches: 1550.003100006,
    kilometers: 0.000001,
    kilometres: 0.000001,
    meters: 1,
    metres: 1,
    miles: 3.86e-7,
    millimeters: 1000000,
    millimetres: 1000000,
    yards: 1.195990046,
};
/**
 * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.
 *
 * @name feature
 * @param {Geometry} geometry input geometry
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature} a GeoJSON Feature
 * @example
 * var geometry = {
 *   "type": "Point",
 *   "coordinates": [110, 50]
 * };
 *
 * var feature = turf.feature(geometry);
 *
 * //=feature
 */
function feature(geom, properties, options) {
    if (options === void 0) { options = {}; }
    var feat = { type: "Feature" };
    if (options.id === 0 || options.id) {
        feat.id = options.id;
    }
    if (options.bbox) {
        feat.bbox = options.bbox;
    }
    feat.properties = properties || {};
    feat.geometry = geom;
    return feat;
}
/**
 * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.
 * For GeometryCollection type use `helpers.geometryCollection`
 *
 * @name geometry
 * @param {string} type Geometry Type
 * @param {Array<any>} coordinates Coordinates
 * @param {Object} [options={}] Optional Parameters
 * @returns {Geometry} a GeoJSON Geometry
 * @example
 * var type = "Point";
 * var coordinates = [110, 50];
 * var geometry = turf.geometry(type, coordinates);
 * // => geometry
 */
function geometry(type, coordinates, options) {
    if (options === void 0) { options = {}; }
    switch (type) {
        case "Point": return point(coordinates).geometry;
        case "LineString": return lineString(coordinates).geometry;
        case "Polygon": return polygon(coordinates).geometry;
        case "MultiPoint": return multiPoint(coordinates).geometry;
        case "MultiLineString": return multiLineString(coordinates).geometry;
        case "MultiPolygon": return multiPolygon(coordinates).geometry;
        default: throw new Error(type + " is invalid");
    }
}
/**
 * Creates a {@link Point} {@link Feature} from a Position.
 *
 * @name point
 * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Point>} a Point feature
 * @example
 * var point = turf.point([-75.343, 39.984]);
 *
 * //=point
 */
function point(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "Point",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.
 *
 * @name points
 * @param {Array<Array<number>>} coordinates an array of Points
 * @param {Object} [properties={}] Translate these properties to each Feature
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Point>} Point Feature
 * @example
 * var points = turf.points([
 *   [-75, 39],
 *   [-80, 45],
 *   [-78, 50]
 * ]);
 *
 * //=points
 */
function points(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return point(coords, properties);
    }), options);
}
/**
 * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.
 *
 * @name polygon
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Polygon>} Polygon Feature
 * @example
 * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });
 *
 * //=polygon
 */
function polygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {
        var ring = coordinates_1[_i];
        if (ring.length < 4) {
            throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
        }
        for (var j = 0; j < ring[ring.length - 1].length; j++) {
            // Check if first point of Polygon contains two numbers
            if (ring[ring.length - 1][j] !== ring[0][j]) {
                throw new Error("First and last Position are not equivalent.");
            }
        }
    }
    var geom = {
        type: "Polygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.
 *
 * @name polygons
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection
 * @example
 * var polygons = turf.polygons([
 *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],
 *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],
 * ]);
 *
 * //=polygons
 */
function polygons(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return polygon(coords, properties);
    }), options);
}
/**
 * Creates a {@link LineString} {@link Feature} from an Array of Positions.
 *
 * @name lineString
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<LineString>} LineString Feature
 * @example
 * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});
 * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});
 *
 * //=linestring1
 * //=linestring2
 */
function lineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    if (coordinates.length < 2) {
        throw new Error("coordinates must be an array of two or more positions");
    }
    var geom = {
        type: "LineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.
 *
 * @name lineStrings
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<LineString>} LineString FeatureCollection
 * @example
 * var linestrings = turf.lineStrings([
 *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],
 *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]
 * ]);
 *
 * //=linestrings
 */
function lineStrings(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return lineString(coords, properties);
    }), options);
}
/**
 * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.
 *
 * @name featureCollection
 * @param {Feature[]} features input features
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {FeatureCollection} FeatureCollection of Features
 * @example
 * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});
 * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});
 * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});
 *
 * var collection = turf.featureCollection([
 *   locationA,
 *   locationB,
 *   locationC
 * ]);
 *
 * //=collection
 */
function featureCollection(features, options) {
    if (options === void 0) { options = {}; }
    var fc = { type: "FeatureCollection" };
    if (options.id) {
        fc.id = options.id;
    }
    if (options.bbox) {
        fc.bbox = options.bbox;
    }
    fc.features = features;
    return fc;
}
/**
 * Creates a {@link Feature<MultiLineString>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiLineString
 * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiLineString>} a MultiLineString feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);
 *
 * //=multiLine
 */
function multiLineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiLineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPoint>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPoint
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPoint>} a MultiPoint feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPt = turf.multiPoint([[0,0],[10,10]]);
 *
 * //=multiPt
 */
function multiPoint(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPoint",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPolygon>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPolygon
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPolygon>} a multipolygon feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);
 *
 * //=multiPoly
 *
 */
function multiPolygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPolygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<GeometryCollection>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name geometryCollection
 * @param {Array<Geometry>} geometries an array of GeoJSON Geometries
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature
 * @example
 * var pt = turf.geometry("Point", [100, 0]);
 * var line = turf.geometry("LineString", [[101, 0], [102, 1]]);
 * var collection = turf.geometryCollection([pt, line]);
 *
 * // => collection
 */
function geometryCollection(geometries, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "GeometryCollection",
        geometries: geometries,
    };
    return feature(geom, properties, options);
}
/**
 * Round number to precision
 *
 * @param {number} num Number
 * @param {number} [precision=0] Precision
 * @returns {number} rounded number
 * @example
 * turf.round(120.4321)
 * //=120
 *
 * turf.round(120.4321, 2)
 * //=120.43
 */
function round(num, precision) {
    if (precision === void 0) { precision = 0; }
    if (precision && !(precision >= 0)) {
        throw new Error("precision must be a positive number");
    }
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(num * multiplier) / multiplier;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name radiansToLength
 * @param {number} radians in radians across the sphere
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} distance
 */
function radiansToLength(radians, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return radians * factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name lengthToRadians
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} radians
 */
function lengthToRadians(distance, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return distance / factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet
 *
 * @name lengthToDegrees
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} degrees
 */
function lengthToDegrees(distance, units) {
    return radiansToDegrees(lengthToRadians(distance, units));
}
/**
 * Converts any bearing angle from the north line direction (positive clockwise)
 * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line
 *
 * @name bearingToAzimuth
 * @param {number} bearing angle, between -180 and +180 degrees
 * @returns {number} angle between 0 and 360 degrees
 */
function bearingToAzimuth(bearing) {
    var angle = bearing % 360;
    if (angle < 0) {
        angle += 360;
    }
    return angle;
}
/**
 * Converts an angle in radians to degrees
 *
 * @name radiansToDegrees
 * @param {number} radians angle in radians
 * @returns {number} degrees between 0 and 360 degrees
 */
function radiansToDegrees(radians) {
    var degrees = radians % (2 * Math.PI);
    return degrees * 180 / Math.PI;
}
/**
 * Converts an angle in degrees to radians
 *
 * @name degreesToRadians
 * @param {number} degrees angle between 0 and 360 degrees
 * @returns {number} angle in radians
 */
function degreesToRadians(degrees) {
    var radians = degrees % 360;
    return radians * Math.PI / 180;
}
/**
 * Converts a length to the requested unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @param {number} length to be converted
 * @param {Units} [originalUnit="kilometers"] of the length
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted length
 */
function convertLength(length, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "kilometers"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(length >= 0)) {
        throw new Error("length must be a positive number");
    }
    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);
}
/**
 * Converts a area to the requested unit.
 * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches
 * @param {number} area to be converted
 * @param {Units} [originalUnit="meters"] of the distance
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted distance
 */
function convertArea(area, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "meters"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(area >= 0)) {
        throw new Error("area must be a positive number");
    }
    var startFactor = areaFactors[originalUnit];
    if (!startFactor) {
        throw new Error("invalid original units");
    }
    var finalFactor = areaFactors[finalUnit];
    if (!finalFactor) {
        throw new Error("invalid final units");
    }
    return (area / startFactor) * finalFactor;
}
/**
 * isNumber
 *
 * @param {*} num Number to validate
 * @returns {boolean} true/false
 * @example
 * turf.isNumber(123)
 * //=true
 * turf.isNumber('foo')
 * //=false
 */
function isNumber(num) {
    return !isNaN(num) && num !== null && !Array.isArray(num);
}
/**
 * isObject
 *
 * @param {*} input variable to validate
 * @returns {boolean} true/false
 * @example
 * turf.isObject({elevation: 10})
 * //=true
 * turf.isObject('foo')
 * //=false
 */
function isObject(input) {
    return (!!input) && (input.constructor === Object);
}
/**
 * Validate BBox
 *
 * @private
 * @param {Array<number>} bbox BBox to validate
 * @returns {void}
 * @throws Error if BBox is not valid
 * @example
 * validateBBox([-180, -40, 110, 50])
 * //=OK
 * validateBBox([-180, -40])
 * //=Error
 * validateBBox('Foo')
 * //=Error
 * validateBBox(5)
 * //=Error
 * validateBBox(null)
 * //=Error
 * validateBBox(undefined)
 * //=Error
 */
function validateBBox(bbox) {
    if (!bbox) {
        throw new Error("bbox is required");
    }
    if (!Array.isArray(bbox)) {
        throw new Error("bbox must be an Array");
    }
    if (bbox.length !== 4 && bbox.length !== 6) {
        throw new Error("bbox must be an Array of 4 or 6 numbers");
    }
    bbox.forEach(function (num) {
        if (!isNumber(num)) {
            throw new Error("bbox must only contain numbers");
        }
    });
}
/**
 * Validate Id
 *
 * @private
 * @param {string|number} id Id to validate
 * @returns {void}
 * @throws Error if Id is not valid
 * @example
 * validateId([-180, -40, 110, 50])
 * //=Error
 * validateId([-180, -40])
 * //=Error
 * validateId('Foo')
 * //=OK
 * validateId(5)
 * //=OK
 * validateId(null)
 * //=Error
 * validateId(undefined)
 * //=Error
 */
function validateId(id) {
    if (!id) {
        throw new Error("id is required");
    }
    if (["string", "number"].indexOf(typeof id) === -1) {
        throw new Error("id must be a number or a string");
    }
}
// Deprecated methods
function radians2degrees() {
    throw new Error("method has been renamed to `radiansToDegrees`");
}
function degrees2radians() {
    throw new Error("method has been renamed to `degreesToRadians`");
}
function distanceToDegrees() {
    throw new Error("method has been renamed to `lengthToDegrees`");
}
function distanceToRadians() {
    throw new Error("method has been renamed to `lengthToRadians`");
}
function radiansToDistance() {
    throw new Error("method has been renamed to `radiansToLength`");
}
function bearingToAngle() {
    throw new Error("method has been renamed to `bearingToAzimuth`");
}
function convertDistance() {
    throw new Error("method has been renamed to `convertLength`");
}


/***/ }),
/* 370 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_invariant__ = __webpack_require__(85);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__turf_helpers__ = __webpack_require__(371);


//http://en.wikipedia.org/wiki/Haversine_formula
//http://www.movable-type.co.uk/scripts/latlong.html
/**
 * Calculates the distance between two {@link Point|points} in degrees, radians, miles, or kilometers.
 * This uses the [Haversine formula](http://en.wikipedia.org/wiki/Haversine_formula) to account for global curvature.
 *
 * @name distance
 * @param {Coord} from origin point
 * @param {Coord} to destination point
 * @param {Object} [options={}] Optional parameters
 * @param {string} [options.units='kilometers'] can be degrees, radians, miles, or kilometers
 * @returns {number} distance between the two points
 * @example
 * var from = turf.point([-75.343, 39.984]);
 * var to = turf.point([-75.534, 39.123]);
 * var options = {units: 'miles'};
 *
 * var distance = turf.distance(from, to, options);
 *
 * //addToMap
 * var addToMap = [from, to];
 * from.properties.distance = distance;
 * to.properties.distance = distance;
 */
function distance(from, to, options) {
    if (options === void 0) { options = {}; }
    var coordinates1 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_invariant__["a" /* getCoord */])(from);
    var coordinates2 = Object(__WEBPACK_IMPORTED_MODULE_0__turf_invariant__["a" /* getCoord */])(to);
    var dLat = Object(__WEBPACK_IMPORTED_MODULE_1__turf_helpers__["a" /* degreesToRadians */])((coordinates2[1] - coordinates1[1]));
    var dLon = Object(__WEBPACK_IMPORTED_MODULE_1__turf_helpers__["a" /* degreesToRadians */])((coordinates2[0] - coordinates1[0]));
    var lat1 = Object(__WEBPACK_IMPORTED_MODULE_1__turf_helpers__["a" /* degreesToRadians */])(coordinates1[1]);
    var lat2 = Object(__WEBPACK_IMPORTED_MODULE_1__turf_helpers__["a" /* degreesToRadians */])(coordinates2[1]);
    var a = Math.pow(Math.sin(dLat / 2), 2) +
        Math.pow(Math.sin(dLon / 2), 2) * Math.cos(lat1) * Math.cos(lat2);
    return Object(__WEBPACK_IMPORTED_MODULE_1__turf_helpers__["b" /* radiansToLength */])(2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)), options.units);
}
/* harmony default export */ __webpack_exports__["a"] = (distance);


/***/ }),
/* 371 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export earthRadius */
/* unused harmony export factors */
/* unused harmony export unitsFactors */
/* unused harmony export areaFactors */
/* unused harmony export feature */
/* unused harmony export geometry */
/* unused harmony export point */
/* unused harmony export points */
/* unused harmony export polygon */
/* unused harmony export polygons */
/* unused harmony export lineString */
/* unused harmony export lineStrings */
/* unused harmony export featureCollection */
/* unused harmony export multiLineString */
/* unused harmony export multiPoint */
/* unused harmony export multiPolygon */
/* unused harmony export geometryCollection */
/* unused harmony export round */
/* harmony export (immutable) */ __webpack_exports__["b"] = radiansToLength;
/* unused harmony export lengthToRadians */
/* unused harmony export lengthToDegrees */
/* unused harmony export bearingToAzimuth */
/* unused harmony export radiansToDegrees */
/* harmony export (immutable) */ __webpack_exports__["a"] = degreesToRadians;
/* unused harmony export convertLength */
/* unused harmony export convertArea */
/* unused harmony export isNumber */
/* unused harmony export isObject */
/* unused harmony export validateBBox */
/* unused harmony export validateId */
/* unused harmony export radians2degrees */
/* unused harmony export degrees2radians */
/* unused harmony export distanceToDegrees */
/* unused harmony export distanceToRadians */
/* unused harmony export radiansToDistance */
/* unused harmony export bearingToAngle */
/* unused harmony export convertDistance */
/**
 * @module helpers
 */
/**
 * Earth Radius used with the Harvesine formula and approximates using a spherical (non-ellipsoid) Earth.
 *
 * @memberof helpers
 * @type {number}
 */
var earthRadius = 6371008.8;
/**
 * Unit of measurement factors using a spherical (non-ellipsoid) earth radius.
 *
 * @memberof helpers
 * @type {Object}
 */
var factors = {
    centimeters: earthRadius * 100,
    centimetres: earthRadius * 100,
    degrees: earthRadius / 111325,
    feet: earthRadius * 3.28084,
    inches: earthRadius * 39.370,
    kilometers: earthRadius / 1000,
    kilometres: earthRadius / 1000,
    meters: earthRadius,
    metres: earthRadius,
    miles: earthRadius / 1609.344,
    millimeters: earthRadius * 1000,
    millimetres: earthRadius * 1000,
    nauticalmiles: earthRadius / 1852,
    radians: 1,
    yards: earthRadius / 1.0936,
};
/**
 * Units of measurement factors based on 1 meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var unitsFactors = {
    centimeters: 100,
    centimetres: 100,
    degrees: 1 / 111325,
    feet: 3.28084,
    inches: 39.370,
    kilometers: 1 / 1000,
    kilometres: 1 / 1000,
    meters: 1,
    metres: 1,
    miles: 1 / 1609.344,
    millimeters: 1000,
    millimetres: 1000,
    nauticalmiles: 1 / 1852,
    radians: 1 / earthRadius,
    yards: 1 / 1.0936,
};
/**
 * Area of measurement factors based on 1 square meter.
 *
 * @memberof helpers
 * @type {Object}
 */
var areaFactors = {
    acres: 0.000247105,
    centimeters: 10000,
    centimetres: 10000,
    feet: 10.763910417,
    inches: 1550.003100006,
    kilometers: 0.000001,
    kilometres: 0.000001,
    meters: 1,
    metres: 1,
    miles: 3.86e-7,
    millimeters: 1000000,
    millimetres: 1000000,
    yards: 1.195990046,
};
/**
 * Wraps a GeoJSON {@link Geometry} in a GeoJSON {@link Feature}.
 *
 * @name feature
 * @param {Geometry} geometry input geometry
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature} a GeoJSON Feature
 * @example
 * var geometry = {
 *   "type": "Point",
 *   "coordinates": [110, 50]
 * };
 *
 * var feature = turf.feature(geometry);
 *
 * //=feature
 */
function feature(geom, properties, options) {
    if (options === void 0) { options = {}; }
    var feat = { type: "Feature" };
    if (options.id === 0 || options.id) {
        feat.id = options.id;
    }
    if (options.bbox) {
        feat.bbox = options.bbox;
    }
    feat.properties = properties || {};
    feat.geometry = geom;
    return feat;
}
/**
 * Creates a GeoJSON {@link Geometry} from a Geometry string type & coordinates.
 * For GeometryCollection type use `helpers.geometryCollection`
 *
 * @name geometry
 * @param {string} type Geometry Type
 * @param {Array<any>} coordinates Coordinates
 * @param {Object} [options={}] Optional Parameters
 * @returns {Geometry} a GeoJSON Geometry
 * @example
 * var type = "Point";
 * var coordinates = [110, 50];
 * var geometry = turf.geometry(type, coordinates);
 * // => geometry
 */
function geometry(type, coordinates, options) {
    if (options === void 0) { options = {}; }
    switch (type) {
        case "Point": return point(coordinates).geometry;
        case "LineString": return lineString(coordinates).geometry;
        case "Polygon": return polygon(coordinates).geometry;
        case "MultiPoint": return multiPoint(coordinates).geometry;
        case "MultiLineString": return multiLineString(coordinates).geometry;
        case "MultiPolygon": return multiPolygon(coordinates).geometry;
        default: throw new Error(type + " is invalid");
    }
}
/**
 * Creates a {@link Point} {@link Feature} from a Position.
 *
 * @name point
 * @param {Array<number>} coordinates longitude, latitude position (each in decimal degrees)
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Point>} a Point feature
 * @example
 * var point = turf.point([-75.343, 39.984]);
 *
 * //=point
 */
function point(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "Point",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Point} {@link FeatureCollection} from an Array of Point coordinates.
 *
 * @name points
 * @param {Array<Array<number>>} coordinates an array of Points
 * @param {Object} [properties={}] Translate these properties to each Feature
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Point>} Point Feature
 * @example
 * var points = turf.points([
 *   [-75, 39],
 *   [-80, 45],
 *   [-78, 50]
 * ]);
 *
 * //=points
 */
function points(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return point(coords, properties);
    }), options);
}
/**
 * Creates a {@link Polygon} {@link Feature} from an Array of LinearRings.
 *
 * @name polygon
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<Polygon>} Polygon Feature
 * @example
 * var polygon = turf.polygon([[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]], { name: 'poly1' });
 *
 * //=polygon
 */
function polygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    for (var _i = 0, coordinates_1 = coordinates; _i < coordinates_1.length; _i++) {
        var ring = coordinates_1[_i];
        if (ring.length < 4) {
            throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");
        }
        for (var j = 0; j < ring[ring.length - 1].length; j++) {
            // Check if first point of Polygon contains two numbers
            if (ring[ring.length - 1][j] !== ring[0][j]) {
                throw new Error("First and last Position are not equivalent.");
            }
        }
    }
    var geom = {
        type: "Polygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Polygon} {@link FeatureCollection} from an Array of Polygon coordinates.
 *
 * @name polygons
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygon coordinates
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<Polygon>} Polygon FeatureCollection
 * @example
 * var polygons = turf.polygons([
 *   [[[-5, 52], [-4, 56], [-2, 51], [-7, 54], [-5, 52]]],
 *   [[[-15, 42], [-14, 46], [-12, 41], [-17, 44], [-15, 42]]],
 * ]);
 *
 * //=polygons
 */
function polygons(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return polygon(coords, properties);
    }), options);
}
/**
 * Creates a {@link LineString} {@link Feature} from an Array of Positions.
 *
 * @name lineString
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<LineString>} LineString Feature
 * @example
 * var linestring1 = turf.lineString([[-24, 63], [-23, 60], [-25, 65], [-20, 69]], {name: 'line 1'});
 * var linestring2 = turf.lineString([[-14, 43], [-13, 40], [-15, 45], [-10, 49]], {name: 'line 2'});
 *
 * //=linestring1
 * //=linestring2
 */
function lineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    if (coordinates.length < 2) {
        throw new Error("coordinates must be an array of two or more positions");
    }
    var geom = {
        type: "LineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link LineString} {@link FeatureCollection} from an Array of LineString coordinates.
 *
 * @name lineStrings
 * @param {Array<Array<Array<number>>>} coordinates an array of LinearRings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north]
 * associated with the FeatureCollection
 * @param {string|number} [options.id] Identifier associated with the FeatureCollection
 * @returns {FeatureCollection<LineString>} LineString FeatureCollection
 * @example
 * var linestrings = turf.lineStrings([
 *   [[-24, 63], [-23, 60], [-25, 65], [-20, 69]],
 *   [[-14, 43], [-13, 40], [-15, 45], [-10, 49]]
 * ]);
 *
 * //=linestrings
 */
function lineStrings(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    return featureCollection(coordinates.map(function (coords) {
        return lineString(coords, properties);
    }), options);
}
/**
 * Takes one or more {@link Feature|Features} and creates a {@link FeatureCollection}.
 *
 * @name featureCollection
 * @param {Feature[]} features input features
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {FeatureCollection} FeatureCollection of Features
 * @example
 * var locationA = turf.point([-75.343, 39.984], {name: 'Location A'});
 * var locationB = turf.point([-75.833, 39.284], {name: 'Location B'});
 * var locationC = turf.point([-75.534, 39.123], {name: 'Location C'});
 *
 * var collection = turf.featureCollection([
 *   locationA,
 *   locationB,
 *   locationC
 * ]);
 *
 * //=collection
 */
function featureCollection(features, options) {
    if (options === void 0) { options = {}; }
    var fc = { type: "FeatureCollection" };
    if (options.id) {
        fc.id = options.id;
    }
    if (options.bbox) {
        fc.bbox = options.bbox;
    }
    fc.features = features;
    return fc;
}
/**
 * Creates a {@link Feature<MultiLineString>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiLineString
 * @param {Array<Array<Array<number>>>} coordinates an array of LineStrings
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiLineString>} a MultiLineString feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiLine = turf.multiLineString([[[0,0],[10,10]]]);
 *
 * //=multiLine
 */
function multiLineString(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiLineString",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPoint>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPoint
 * @param {Array<Array<number>>} coordinates an array of Positions
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPoint>} a MultiPoint feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPt = turf.multiPoint([[0,0],[10,10]]);
 *
 * //=multiPt
 */
function multiPoint(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPoint",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<MultiPolygon>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name multiPolygon
 * @param {Array<Array<Array<Array<number>>>>} coordinates an array of Polygons
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<MultiPolygon>} a multipolygon feature
 * @throws {Error} if no coordinates are passed
 * @example
 * var multiPoly = turf.multiPolygon([[[[0,0],[0,10],[10,10],[10,0],[0,0]]]]);
 *
 * //=multiPoly
 *
 */
function multiPolygon(coordinates, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "MultiPolygon",
        coordinates: coordinates,
    };
    return feature(geom, properties, options);
}
/**
 * Creates a {@link Feature<GeometryCollection>} based on a
 * coordinate array. Properties can be added optionally.
 *
 * @name geometryCollection
 * @param {Array<Geometry>} geometries an array of GeoJSON Geometries
 * @param {Object} [properties={}] an Object of key-value pairs to add as properties
 * @param {Object} [options={}] Optional Parameters
 * @param {Array<number>} [options.bbox] Bounding Box Array [west, south, east, north] associated with the Feature
 * @param {string|number} [options.id] Identifier associated with the Feature
 * @returns {Feature<GeometryCollection>} a GeoJSON GeometryCollection Feature
 * @example
 * var pt = turf.geometry("Point", [100, 0]);
 * var line = turf.geometry("LineString", [[101, 0], [102, 1]]);
 * var collection = turf.geometryCollection([pt, line]);
 *
 * // => collection
 */
function geometryCollection(geometries, properties, options) {
    if (options === void 0) { options = {}; }
    var geom = {
        type: "GeometryCollection",
        geometries: geometries,
    };
    return feature(geom, properties, options);
}
/**
 * Round number to precision
 *
 * @param {number} num Number
 * @param {number} [precision=0] Precision
 * @returns {number} rounded number
 * @example
 * turf.round(120.4321)
 * //=120
 *
 * turf.round(120.4321, 2)
 * //=120.43
 */
function round(num, precision) {
    if (precision === void 0) { precision = 0; }
    if (precision && !(precision >= 0)) {
        throw new Error("precision must be a positive number");
    }
    var multiplier = Math.pow(10, precision || 0);
    return Math.round(num * multiplier) / multiplier;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from radians to a more friendly unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name radiansToLength
 * @param {number} radians in radians across the sphere
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} distance
 */
function radiansToLength(radians, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return radians * factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into radians
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @name lengthToRadians
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} radians
 */
function lengthToRadians(distance, units) {
    if (units === void 0) { units = "kilometers"; }
    var factor = factors[units];
    if (!factor) {
        throw new Error(units + " units is invalid");
    }
    return distance / factor;
}
/**
 * Convert a distance measurement (assuming a spherical Earth) from a real-world unit into degrees
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, centimeters, kilometres, feet
 *
 * @name lengthToDegrees
 * @param {number} distance in real units
 * @param {string} [units="kilometers"] can be degrees, radians, miles, or kilometers inches, yards, metres,
 * meters, kilometres, kilometers.
 * @returns {number} degrees
 */
function lengthToDegrees(distance, units) {
    return radiansToDegrees(lengthToRadians(distance, units));
}
/**
 * Converts any bearing angle from the north line direction (positive clockwise)
 * and returns an angle between 0-360 degrees (positive clockwise), 0 being the north line
 *
 * @name bearingToAzimuth
 * @param {number} bearing angle, between -180 and +180 degrees
 * @returns {number} angle between 0 and 360 degrees
 */
function bearingToAzimuth(bearing) {
    var angle = bearing % 360;
    if (angle < 0) {
        angle += 360;
    }
    return angle;
}
/**
 * Converts an angle in radians to degrees
 *
 * @name radiansToDegrees
 * @param {number} radians angle in radians
 * @returns {number} degrees between 0 and 360 degrees
 */
function radiansToDegrees(radians) {
    var degrees = radians % (2 * Math.PI);
    return degrees * 180 / Math.PI;
}
/**
 * Converts an angle in degrees to radians
 *
 * @name degreesToRadians
 * @param {number} degrees angle between 0 and 360 degrees
 * @returns {number} angle in radians
 */
function degreesToRadians(degrees) {
    var radians = degrees % 360;
    return radians * Math.PI / 180;
}
/**
 * Converts a length to the requested unit.
 * Valid units: miles, nauticalmiles, inches, yards, meters, metres, kilometers, centimeters, feet
 *
 * @param {number} length to be converted
 * @param {Units} [originalUnit="kilometers"] of the length
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted length
 */
function convertLength(length, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "kilometers"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(length >= 0)) {
        throw new Error("length must be a positive number");
    }
    return radiansToLength(lengthToRadians(length, originalUnit), finalUnit);
}
/**
 * Converts a area to the requested unit.
 * Valid units: kilometers, kilometres, meters, metres, centimetres, millimeters, acres, miles, yards, feet, inches
 * @param {number} area to be converted
 * @param {Units} [originalUnit="meters"] of the distance
 * @param {Units} [finalUnit="kilometers"] returned unit
 * @returns {number} the converted distance
 */
function convertArea(area, originalUnit, finalUnit) {
    if (originalUnit === void 0) { originalUnit = "meters"; }
    if (finalUnit === void 0) { finalUnit = "kilometers"; }
    if (!(area >= 0)) {
        throw new Error("area must be a positive number");
    }
    var startFactor = areaFactors[originalUnit];
    if (!startFactor) {
        throw new Error("invalid original units");
    }
    var finalFactor = areaFactors[finalUnit];
    if (!finalFactor) {
        throw new Error("invalid final units");
    }
    return (area / startFactor) * finalFactor;
}
/**
 * isNumber
 *
 * @param {*} num Number to validate
 * @returns {boolean} true/false
 * @example
 * turf.isNumber(123)
 * //=true
 * turf.isNumber('foo')
 * //=false
 */
function isNumber(num) {
    return !isNaN(num) && num !== null && !Array.isArray(num);
}
/**
 * isObject
 *
 * @param {*} input variable to validate
 * @returns {boolean} true/false
 * @example
 * turf.isObject({elevation: 10})
 * //=true
 * turf.isObject('foo')
 * //=false
 */
function isObject(input) {
    return (!!input) && (input.constructor === Object);
}
/**
 * Validate BBox
 *
 * @private
 * @param {Array<number>} bbox BBox to validate
 * @returns {void}
 * @throws Error if BBox is not valid
 * @example
 * validateBBox([-180, -40, 110, 50])
 * //=OK
 * validateBBox([-180, -40])
 * //=Error
 * validateBBox('Foo')
 * //=Error
 * validateBBox(5)
 * //=Error
 * validateBBox(null)
 * //=Error
 * validateBBox(undefined)
 * //=Error
 */
function validateBBox(bbox) {
    if (!bbox) {
        throw new Error("bbox is required");
    }
    if (!Array.isArray(bbox)) {
        throw new Error("bbox must be an Array");
    }
    if (bbox.length !== 4 && bbox.length !== 6) {
        throw new Error("bbox must be an Array of 4 or 6 numbers");
    }
    bbox.forEach(function (num) {
        if (!isNumber(num)) {
            throw new Error("bbox must only contain numbers");
        }
    });
}
/**
 * Validate Id
 *
 * @private
 * @param {string|number} id Id to validate
 * @returns {void}
 * @throws Error if Id is not valid
 * @example
 * validateId([-180, -40, 110, 50])
 * //=Error
 * validateId([-180, -40])
 * //=Error
 * validateId('Foo')
 * //=OK
 * validateId(5)
 * //=OK
 * validateId(null)
 * //=Error
 * validateId(undefined)
 * //=Error
 */
function validateId(id) {
    if (!id) {
        throw new Error("id is required");
    }
    if (["string", "number"].indexOf(typeof id) === -1) {
        throw new Error("id must be a number or a string");
    }
}
// Deprecated methods
function radians2degrees() {
    throw new Error("method has been renamed to `radiansToDegrees`");
}
function degrees2radians() {
    throw new Error("method has been renamed to `degreesToRadians`");
}
function distanceToDegrees() {
    throw new Error("method has been renamed to `lengthToDegrees`");
}
function distanceToRadians() {
    throw new Error("method has been renamed to `lengthToRadians`");
}
function radiansToDistance() {
    throw new Error("method has been renamed to `radiansToLength`");
}
function bearingToAngle() {
    throw new Error("method has been renamed to `bearingToAzimuth`");
}
function convertDistance() {
    throw new Error("method has been renamed to `convertLength`");
}


/***/ }),
/* 372 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony export (immutable) */ __webpack_exports__["default"] = booleanPointInPolygon;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__turf_invariant__ = __webpack_require__(85);

// http://en.wikipedia.org/wiki/Even%E2%80%93odd_rule
// modified from: https://github.com/substack/point-in-polygon/blob/master/index.js
// which was modified from http://www.ecse.rpi.edu/Homepages/wrf/Research/Short_Notes/pnpoly.html
/**
 * Takes a {@link Point} and a {@link Polygon} or {@link MultiPolygon} and determines if the point
 * resides inside the polygon. The polygon can be convex or concave. The function accounts for holes.
 *
 * @name booleanPointInPolygon
 * @param {Coord} point input point
 * @param {Feature<Polygon|MultiPolygon>} polygon input polygon or multipolygon
 * @param {Object} [options={}] Optional parameters
 * @param {boolean} [options.ignoreBoundary=false] True if polygon boundary should be ignored when determining if
 * the point is inside the polygon otherwise false.
 * @returns {boolean} `true` if the Point is inside the Polygon; `false` if the Point is not inside the Polygon
 * @example
 * var pt = turf.point([-77, 44]);
 * var poly = turf.polygon([[
 *   [-81, 41],
 *   [-81, 47],
 *   [-72, 47],
 *   [-72, 41],
 *   [-81, 41]
 * ]]);
 *
 * turf.booleanPointInPolygon(pt, poly);
 * //= true
 */
function booleanPointInPolygon(point, polygon, options) {
    if (options === void 0) { options = {}; }
    // validation
    if (!point) {
        throw new Error("point is required");
    }
    if (!polygon) {
        throw new Error("polygon is required");
    }
    var pt = Object(__WEBPACK_IMPORTED_MODULE_0__turf_invariant__["a" /* getCoord */])(point);
    var geom = Object(__WEBPACK_IMPORTED_MODULE_0__turf_invariant__["b" /* getGeom */])(polygon);
    var type = geom.type;
    var bbox = polygon.bbox;
    var polys = geom.coordinates;
    // Quick elimination if point is not inside bbox
    if (bbox && inBBox(pt, bbox) === false) {
        return false;
    }
    // normalize to multipolygon
    if (type === "Polygon") {
        polys = [polys];
    }
    var insidePoly = false;
    for (var i = 0; i < polys.length && !insidePoly; i++) {
        // check if it is in the outer ring first
        if (inRing(pt, polys[i][0], options.ignoreBoundary)) {
            var inHole = false;
            var k = 1;
            // check for the point in any of the holes
            while (k < polys[i].length && !inHole) {
                if (inRing(pt, polys[i][k], !options.ignoreBoundary)) {
                    inHole = true;
                }
                k++;
            }
            if (!inHole) {
                insidePoly = true;
            }
        }
    }
    return insidePoly;
}
/**
 * inRing
 *
 * @private
 * @param {Array<number>} pt [x,y]
 * @param {Array<Array<number>>} ring [[x,y], [x,y],..]
 * @param {boolean} ignoreBoundary ignoreBoundary
 * @returns {boolean} inRing
 */
function inRing(pt, ring, ignoreBoundary) {
    var isInside = false;
    if (ring[0][0] === ring[ring.length - 1][0] && ring[0][1] === ring[ring.length - 1][1]) {
        ring = ring.slice(0, ring.length - 1);
    }
    for (var i = 0, j = ring.length - 1; i < ring.length; j = i++) {
        var xi = ring[i][0];
        var yi = ring[i][1];
        var xj = ring[j][0];
        var yj = ring[j][1];
        var onBoundary = (pt[1] * (xi - xj) + yi * (xj - pt[0]) + yj * (pt[0] - xi) === 0) &&
            ((xi - pt[0]) * (xj - pt[0]) <= 0) && ((yi - pt[1]) * (yj - pt[1]) <= 0);
        if (onBoundary) {
            return !ignoreBoundary;
        }
        var intersect = ((yi > pt[1]) !== (yj > pt[1])) &&
            (pt[0] < (xj - xi) * (pt[1] - yi) / (yj - yi) + xi);
        if (intersect) {
            isInside = !isInside;
        }
    }
    return isInside;
}
/**
 * inBBox
 *
 * @private
 * @param {Position} pt point [x,y]
 * @param {BBox} bbox BBox [west, south, east, north]
 * @returns {boolean} true/false if point is inside BBox
 */
function inBBox(pt, bbox) {
    return bbox[0] <= pt[0] &&
        bbox[1] <= pt[1] &&
        bbox[2] >= pt[0] &&
        bbox[3] >= pt[1];
}


/***/ }),
/* 373 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var vertexShader = exports.vertexShader = "\n// vtxf \u4F7F\u7528double\u7C7B\u578B\u7684position\u8FDB\u884C\u8BA1\u7B97\n// attribute vec3 position3DHigh;\n// attribute vec3 position3DLow;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 st;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nvoid main()\n{\n    // vtxf \u4F7F\u7528double\u7C7B\u578B\u7684position\u8FDB\u884C\u8BA1\u7B97\n    // vec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);\n    // v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    // v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    // v_st = st;\n    // gl_Position = czm_modelViewProjectionRelativeToEye * p;\n    v_positionEC = (czm_modelView * vec4(position, 1.0)).xyz;       // position in eye coordinates\n    v_normalEC = czm_normal * normal;                               // normal in eye coordinates\n    v_st = st;\n    v_color = color;\n    gl_Position = czm_modelViewProjection * vec4(position, 1.0);\n}\n";

var fragmentShader = exports.fragmentShader = "\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    vec3 normalEC = normalize(v_normalEC);\n// #ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n// #endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    //czm_material material = czm_getMaterial(materialInput);\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec4 imageColor = texture2D(u_image, fract(materialInput.st));\n\n    material.diffuse = imageColor.rgb;\n    material.alpha = imageColor.a;\n\n    material.diffuse *= v_color.rgb;\n    material.alpha *= v_color.a;\n    \n    material.diffuse *= u_color.rgb;\n    material.alpha *= u_color.a;\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n";

/***/ }),
/* 374 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.totalArea = totalArea;

var scratchV0 = void 0;
var scratchV1 = void 0;
var scratchV2 = void 0;

var scratchPos0 = void 0;
var scratchPos1 = void 0;
var scratchVec2 = void 0;

function triangleArea(pos0, pos1, pos2) {
    scratchPos0 = scratchPos0 || new Cesium.Cartesian3();
    scratchPos1 = scratchPos1 || new Cesium.Cartesian3();
    scratchVec2 = scratchVec2 || new Cesium.Cartesian3();

    var vec0 = Cesium.Cartesian3.subtract(pos1, pos0, scratchPos0);
    var vec1 = Cesium.Cartesian3.subtract(pos2, pos0, scratchPos1);
    var vec2 = Cesium.Cartesian3.cross(vec0, vec1, scratchVec2);
    var area = 0.5 * Cesium.Cartesian3.magnitude(vec2);
    return area;
}

function totalArea(positions) {
    scratchV0 = scratchV0 || new Cesium.Cartesian3();
    scratchV1 = scratchV1 || new Cesium.Cartesian3();
    scratchV2 = scratchV2 || new Cesium.Cartesian3();

    var triangleNums = positions.length / 9;

    var a = 0;
    for (var i = 0; i < triangleNums; ++i) {
        var v0 = Cesium.Cartesian3.fromElements(positions[i * 9 + 0], positions[i * 9 + 1], positions[i * 9 + 2], scratchV0);
        var v1 = Cesium.Cartesian3.fromElements(positions[i * 9 + 3], positions[i * 9 + 4], positions[i * 9 + 5], scratchV1);
        var v2 = Cesium.Cartesian3.fromElements(positions[i * 9 + 6], positions[i * 9 + 7], positions[i * 9 + 8], scratchV2);
        a += triangleArea(v0, v1, v2);
    }

    return a;
}

/***/ }),
/* 375 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _slicedToArray2 = __webpack_require__(31);

var _slicedToArray3 = _interopRequireDefault(_slicedToArray2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj2 = __webpack_require__(11);

var _XbsjCzmObj3 = _interopRequireDefault(_XbsjCzmObj2);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

var _geoDistance = __webpack_require__(65);

var _geoDistance2 = _interopRequireDefault(_geoDistance);

var _registerInteractionProperty = __webpack_require__(15);

var _Geometry = __webpack_require__(114);

var _Geometry2 = _interopRequireDefault(_Geometry);

var _CustomPrimitive = __webpack_require__(83);

var _CustomPrimitive2 = _interopRequireDefault(_CustomPrimitive);

var _shader = __webpack_require__(376);

var _Surface = __webpack_require__(170);

var _Surface2 = _interopRequireDefault(_Surface);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 挖坑填充面
 * @memberof Obj
 * @class
 * @extends XbsjCzmObj
 */
var CutSurface = function (_XbsjCzmObj) {
    (0, _inherits3.default)(CutSurface, _XbsjCzmObj);

    function CutSurface(earth, guid) {
        (0, _classCallCheck3.default)(this, CutSurface);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CutSurface.__proto__ || (0, _getPrototypeOf2.default)(CutSurface)).call(this, earth, guid));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreatingWithHeight)(_this._earth, _this, {
            polygonCreatingWithHeight: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));

        _this.disposers.push((0, _bind2.default)(_this, 'enabled', _this, 'show'));

        _this._createSampledPositions();
        // this._createPolygon();
        _this._createBottomSurface();
        _this._createWall();
        // this._createTexturePosRot();
        _this._createDiscard();

        _this._averageHeight = 0;
        return _this;
    }

    // _createPolygon() {
    //     this._polygon = new XE.Obj.Polygon(this._earth);
    //     this._polygon.loop = true;
    //     this._polygon.ground = false;
    //     this._polygon.color = [0, 1, 0, 0.5];
    //     this._polygon.depthTest = true,
    //     this._polygon.width = 3;
    //     this.disposers.push(() => {
    //         this._polygon = this._polygon && this._polygon.destroy();
    //     });
    //     this._polygon.show = this.showHelper && this.show;

    //     XE.Earth.Interaction.Picking.registerPickingParent(this._polygon, this);

    //     const updatePolygon = () => {
    //         this._polygon.show = this.showHelper && this.show;
    //         this._polygon.height = this.height;
    //     }

    //     updatePolygon();
    //     this.disposers.push(XE.MVVM.watch(() => {
    //         return {
    //             show: this.show,
    //             showHelper: this.showHelper,
    //             height: this.height,
    //         }
    //     }, updatePolygon));

    //     const recreatePolygon = () => {
    //         this._polygon.positions = this.positions;
    //         updatePolygon();
    //     }

    //     recreatePolygon();
    //     this.disposers.push(XE.MVVM.watch(() => {
    //         return {
    //             positions: [...this.positions],
    //         }
    //     }, recreatePolygon));
    // }

    (0, _createClass3.default)(CutSurface, [{
        key: '_createDiscard',
        value: function _createDiscard() {
            var _this2 = this;

            var f = new XE.Obj.FlattenedPolygonCollection(uia.earth);
            f.flattenDiscard = true;
            f.polygons.push({});
            this._fpc = f;
            // XE.cso.xbsjFlattenGuid = f.guid

            this.disposers.push(function () {
                _this2._fpc = _this2._fpc && _this2._fpc.destroy();
            });

            var update = function update() {
                _this2._fpc.polygons[0].positions = [].concat((0, _toConsumableArray3.default)(_this2.positions));
            };

            update();
            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this2.positions))
                };
            }, update));
        }
    }, {
        key: 'getDiscardGuid',
        value: function getDiscardGuid() {
            return this._fpc.guid;
        }
    }, {
        key: '_createBottomSurface',
        value: function _createBottomSurface() {
            var _this3 = this;

            this._bottomSurface = new _Surface2.default(this._earth);
            this._bottomSurface.showHelper = false;
            this.disposers.push(function () {
                _this3._bottomSurface = _this3._bottomSurface && _this3._bottomSurface.destroy();
            });
            // this.disposers.push(bind(this._bottomSurface, 'positions', this, 'positions'));
            XE.Earth.Interaction.Picking.registerPickingParent(this._bottomSurface, this);

            var update = function update() {
                _this3._bottomSurface.show = _this3.showHelper && _this3.show;
            };

            update();
            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    show: _this3.show,
                    showHelper: _this3.showHelper
                };
            }, update));

            var recreate = function recreate() {
                var positions = [];
                var pl = _this3.positions.length / 2;
                for (var i = 0; i < pl; ++i) {
                    positions.push([_this3.positions[i * 2 + 0], _this3.positions[i * 2 + 1], _this3.height]);
                }

                _this3._bottomSurface.positions = positions;

                update();
            };

            recreate();

            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this3.positions)),
                    height: _this3.height
                };
            }, recreate));

            this.disposers.push((0, _bind2.default)(this, 'bottomImageUrl', this._bottomSurface, 'imageUrl'));
            this.disposers.push((0, _bind2.default)(this, 'bottomTextureRotation', this._bottomSurface, 'textureRotation'));
            this.disposers.push((0, _bind2.default)(this, 'bottomImageHeight', this._bottomSurface, 'imageHeight'));
            this.disposers.push((0, _bind2.default)(this, 'bottomImageWidthScale', this._bottomSurface, 'imageWidthScale'));

            (0, _mobx.extendObservable)(this, {
                bottomTextureRotationEditing: false
            });

            this.disposers.push((0, _bind2.default)(this, 'bottomTextureRotationEditing', this._bottomSurface, 'textureRotationEditing'));
        }

        // _createTexturePosRot() {
        //     // // 检测位置编辑状态 // positionEditing
        //     // this.disposers.push(registerPositionEditing(this._earth, this, {
        //     //     positionEditingProperty: 'texturePositionEditing',
        //     //     positionProperty: 'texturePosition',
        //     // }));

        //     extendObservable(this, {
        //         _texturePosition: [0, 0, 0],
        //     });

        //     this.disposers.push(bind(this, '_texturePosition', this._cp, 'position'));

        //     // 旋转状态
        //     this.disposers.push(registerRotationEditing(this._earth, this, {
        //         rotationEditingProperty: 'textureRotationEditing',
        //         positionProperty: '_texturePosition',
        //         rotationProperty: 'textureRotation',
        //     }));
        // }

    }, {
        key: '_createWall',
        value: function _createWall() {
            var _this4 = this;

            this._cp = new _CustomPrimitive2.default(this._earth);
            this._cp.renderState.depthTest.enabled = true;
            this._cp.vertexShaderSource = _shader.vertexShader;
            this._cp.fragmentShaderSource = _shader.fragmentShader;
            this.disposers.push((0, _bind2.default)(this._cp, 'imageUrl', this, 'wallImageUrl'));
            this.disposers.push(function () {
                _this4._cp = _this4._cp && _this4._cp.destroy();
            });

            var updateTin = function updateTin() {
                _this4._cp.show = _this4.show;
            };

            updateTin();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    show: _this4.show
                };
            }, updateTin));

            var recreateTin = function recreateTin() {
                if (!_this4._sampledPositions) {
                    return;
                }

                if (_this4._sampledPositions.length > 2) {
                    var l = _this4._sampledPositions.length;

                    var ds = [];
                    ds.push(0);
                    var sp = _this4._sampledPositions;
                    _this4._scratchCartesian03251552 = _this4._scratchCartesian03251552 || new Cesium.Cartesian3();
                    _this4._scratchCartesian03251553 = _this4._scratchCartesian03251553 || new Cesium.Cartesian3();
                    for (var i = 0; i < l; ++i) {
                        var cartesian = Cesium.Cartesian3.fromRadians(sp[i][0], sp[i][1], 0.0, undefined, _this4._scratchCartesian03251552);
                        var cartesian2 = Cesium.Cartesian3.fromRadians(sp[(i + 1) % l][0], sp[(i + 1) % l][1], 0.0, undefined, _this4._scratchCartesian03251553);
                        var d = Cesium.Cartesian3.distance(cartesian, cartesian2);
                        ds.push(ds[i] + d);
                    }

                    var gps = new Array((l + 1) * 3 * 2);
                    var sts = new Array((l + 1) * 2 * 2);
                    for (var _i = 0; _i < l + 1; ++_i) {
                        gps[_i * 3 + 0] = _this4._sampledPositions[_i % l][0];
                        gps[_i * 3 + 1] = _this4._sampledPositions[_i % l][1];
                        gps[_i * 3 + 2] = _this4.height;
                        sts[_i * 2 + 0] = ds[_i];
                        sts[_i * 2 + 1] = _this4.height;
                    }

                    for (var _i2 = 0; _i2 < l + 1; ++_i2) {
                        gps[(l + 1 + _i2) * 3 + 0] = _this4._sampledPositions[_i2 % l][0];
                        gps[(l + 1 + _i2) * 3 + 1] = _this4._sampledPositions[_i2 % l][1];
                        gps[(l + 1 + _i2) * 3 + 2] = _this4._sampledPositions[_i2 % l][2];
                        sts[(l + 1 + _i2) * 2 + 0] = ds[_i2];
                        sts[(l + 1 + _i2) * 2 + 1] = _this4._sampledPositions[_i2 % l][2];
                    }

                    var tempIndex = new Array(l * 6);
                    for (var _i3 = 0; _i3 < l; ++_i3) {
                        tempIndex[_i3 * 6 + 0] = _i3;
                        tempIndex[_i3 * 6 + 1] = _i3 + 1;
                        tempIndex[_i3 * 6 + 2] = _i3 + (l + 1);

                        tempIndex[_i3 * 6 + 3] = _i3 + 1;
                        tempIndex[_i3 * 6 + 4] = _i3 + 1 + (l + 1);
                        tempIndex[_i3 * 6 + 5] = _i3 + (l + 1);
                    }

                    var gps2 = new Array(l * 6);
                    var sts2 = new Array(l * 6 * 2);
                    for (var _i4 = 0; _i4 < l * 6; ++_i4) {
                        var index = tempIndex[_i4];
                        gps2[_i4] = [gps[index * 3 + 0], gps[index * 3 + 1], gps[index * 3 + 2]];

                        var s = sts[index * 2 + 0] / _this4._cp.canvasWidth * _this4._cp.canvasHeight / _this4.wallImageHeight / _this4.wallImageWidthScale;
                        var t = sts[index * 2 + 1] / _this4._cp.canvasHeight * _this4._cp.canvasHeight / _this4.wallImageHeight;

                        sts2[_i4 * 2 + 0] = s;
                        sts2[_i4 * 2 + 1] = t;
                    }

                    var _Geometry$getLocalPos = _Geometry2.default.getLocalPositions(gps2),
                        _Geometry$getLocalPos2 = (0, _slicedToArray3.default)(_Geometry$getLocalPos, 2),
                        localPositions = _Geometry$getLocalPos2[0],
                        origin = _Geometry$getLocalPos2[1];

                    var normals = undefined;
                    {
                        if (!_this4._normalCs) {
                            _this4._normalCs = [new Cesium.Cartesian3(), new Cesium.Cartesian3(), new Cesium.Cartesian3()];
                        }

                        normals = new Array(localPositions.length);

                        if (localPositions.length % 9 !== 0) {
                            throw new Error('localPositions.length % 9 !== 0');
                        }

                        for (var _i5 = 0; _i5 < localPositions.length / 9; _i5++) {
                            for (var j = 0; j < 3; ++j) {
                                Cesium.Cartesian3.fromArray(localPositions, _i5 * 9 + j * 3, _this4._normalCs[j]);
                            }

                            Cesium.Cartesian3.subtract(_this4._normalCs[1], _this4._normalCs[0], _this4._normalCs[1]);
                            Cesium.Cartesian3.normalize(_this4._normalCs[1], _this4._normalCs[1]);
                            Cesium.Cartesian3.subtract(_this4._normalCs[2], _this4._normalCs[0], _this4._normalCs[2]);
                            Cesium.Cartesian3.normalize(_this4._normalCs[2], _this4._normalCs[2]);

                            var n = Cesium.Cartesian3.cross(_this4._normalCs[1], _this4._normalCs[2], _this4._normalCs[0]);

                            for (var _j = 0; _j < 3; ++_j) {
                                Cesium.Cartesian3.pack(n, normals, _i5 * 9 + _j * 3);
                            }
                        }
                    }

                    if (localPositions.length <= 0) {
                        return;
                    }

                    _this4._cp.positions = localPositions;
                    _this4._cp.position = origin;
                    // this._cp.sts = sts;
                    _this4._cp.sts = sts2;
                    _this4._cp.normals = normals;
                    _this4._cp.indices = [].concat((0, _toConsumableArray3.default)(new Array(localPositions.length / 3).keys()));
                }

                updateTin();
            };

            recreateTin();
            this.disposers.push(XE.MVVM.watch(function () {
                return {
                    _sampledPositions: [].concat((0, _toConsumableArray3.default)(_this4._sampledPositions)),
                    height: _this4.height,
                    canvasWidth: _this4._cp.canvasWidth,
                    canvasHeight: _this4._cp.canvasHeight,
                    imageHeight: _this4.wallImageHeight,
                    imageWidthScale: _this4.wallImageWidthScale
                };
            }, recreateTin));
        }
    }, {
        key: '_createSampledPositions',
        value: function _createSampledPositions() {
            var _this5 = this;

            (0, _mobx.extendObservable)(this, {
                _sampledPositions: []
            });

            this._scratchCarto = this._scratchCarto || new Cesium.Cartographic(0, 0);

            var createInterPositions = function createInterPositions() {
                var l = _this5.positions.length / 2 | 0;
                var interPositions = [];

                _this5._scratchCC1 = _this5._scratchCC1 || new Cesium.Cartesian3();
                _this5._scratchCC2 = _this5._scratchCC2 || new Cesium.Cartesian3();
                _this5._scratchCC3 = _this5._scratchCC3 || new Cesium.Cartesian3();
                _this5._scratchCarto = _this5._scratchCarto || new Cesium.Cartographic();
                for (var i = 0; i < l; ++i) {
                    var ni = (i + 1) % l;
                    var c1 = Cesium.Cartesian3.fromRadians(_this5.positions[i * 2 + 0], _this5.positions[i * 2 + 1], 0, undefined, _this5._scratchCC1);
                    var c2 = Cesium.Cartesian3.fromRadians(_this5.positions[ni * 2 + 0], _this5.positions[ni * 2 + 1], 0, undefined, _this5._scratchCC2);
                    var d = Cesium.Cartesian3.distance(c1, c2);
                    var n = Math.ceil(d / _this5.sampledDistance) | 0;
                    interPositions.push(new Cesium.Cartographic(_this5.positions[i * 2 + 0], _this5.positions[i * 2 + 1]));
                    for (var j = 1; j < n; ++j) {
                        var lp = Cesium.Cartesian3.lerp(c1, c2, j / n, _this5._scratchCC3);
                        var carto = Cesium.Cartographic.fromCartesian(lp, undefined, _this5._scratchCarto);
                        interPositions.push(new Cesium.Cartographic(carto.longitude, carto.latitude));
                    }
                }

                return interPositions;
            };

            this._updateSampledPositionsTrigger = new rxjs.Subject();
            this._sampleHeightSubscription = this._updateSampledPositionsTrigger.pipe(rxjs.operators.debounceTime(2000), rxjs.operators.map(function () {
                return createInterPositions();
            }), rxjs.operators.switchMap(function (interPositions) {
                var objectsToExclude = [];
                if (_this5._cp && _this5._cp._primitive) {
                    objectsToExclude.push(_this5._cp._primitive);
                }
                // if (this._polygon && this._polygon._primitive) {
                //     objectsToExclude.push(this._polygon._primitive);
                // }
                // if (this._polygon && this._polygon._polyline && this._polygon._polyline._primitive) {
                //     objectsToExclude.push(this._polygon._polyline._primitive);
                // }
                if (_this5._bottomSurface && _this5._bottomSurface._cp) {
                    objectsToExclude.push(_this5._bottomSurface._cp);
                }

                var earth = _this5._earth;
                var polyline = earth.interaction.editingPolygonBinding._editing._editing._polyline;
                var points = earth.interaction.editingPolygonBinding._editing._editing._points;
                var polyline2 = earth.interaction.flattenedPolygonCreatingBinding._polylineCreating._editing._polyline;

                if (polyline && polyline._primitive) {
                    objectsToExclude.push(polyline._primitive);
                }
                if (points && points._primitive) {
                    objectsToExclude.push(points._primitive);
                }
                if (polyline2 && polyline2._primitive) {
                    objectsToExclude.push(polyline2._primitive);
                }

                _this5._fpc.enabled = false;
                var promise = _this5._earth.czm.scene.sampleHeightMostDetailed(interPositions, objectsToExclude);
                return rxjs.from(promise);
            })).subscribe(function (updatedPosition) {
                if (updatedPosition.length > 0 && updatedPosition.every(function (e) {
                    return isFinite(e.height);
                })) {
                    _this5._fpc.enabled = true;
                    _this5._sampledPositions = updatedPosition.map(function (e) {
                        return [e.longitude, e.latitude, e.height];
                    });
                    var th = updatedPosition.reduce(function (p, c) {
                        p += c.height;return p;
                    }, 0.0);
                    _this5._averageHeight = th / updatedPosition.length;
                } else {
                    console.warn('有位置点不能找到高程值，可能是没有开启地形深度监测！');
                }
            });

            this.disposers.push(function () {
                if (_this5._sampleHeightSubscription) {
                    _this5._sampleHeightSubscription.unsubscribe();
                    _this5._sampleHeightSubscription = undefined;
                }
                if (_this5._updateSampledPositionsTrigger) {
                    _this5._updateSampledPositionsTrigger.unsubscribe();
                    _this5._updateSampledPositionsTrigger = undefined;
                }
            });

            var updateSampledPositions = function updateSampledPositions() {
                _this5._updateSampledPositionsTrigger.next();
            };

            updateSampledPositions();

            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    positions: [].concat((0, _toConsumableArray3.default)(_this5.positions)),
                    sampledDistance: _this5.sampledDistance
                };
            }, updateSampledPositions));
        }
    }, {
        key: 'flyTo',
        value: function flyTo() {
            this._polygon.flyTo();
        }

        /**
         * 获取总体积，单位立方米，大于0表示挖方，小于0表示填方
         */

    }, {
        key: 'getTotalVolume',
        value: function getTotalVolume() {
            return (this._averageHeight - this.height) * this._bottomSurface.getTotalArea();
        }

        /**
         * 获取总面积，单位平方米
         */

    }, {
        key: 'getTotalArea',
        value: function getTotalArea() {
            return this._bottomSurface.getTotalArea();
        }
    }]);
    return CutSurface;
}(_XbsjCzmObj3.default);

CutSurface.defaultOptions = {
    /**
     * 位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.CutSurface
     */
    positions: [],
    /**
     * 采样间距
     * @type {number}
     * @instance
     * @default 10.0
     * @memberof Obj.CutSurface
     */
    sampledDistance: 10.0,
    /**
     * 平面高度，单位米
     * @type {number}
     * @instance
     * @default 0.0
     * @memberof Obj.CutSurface
     */
    height: 0.0,
    /**
     * 内部位置数组 [[经度、纬度、高度], ...]
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.CutSurface
     */
    innerPositions: [],
    /**
     * 显示
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.CutSurface
     */
    show: true,
    /**
     * 显示辅助信息
     * @type {boolean}
     * @instance
     * @default true
     * @memberof Obj.CutSurface
     */
    showHelper: true,
    /**
     * 图像路径
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.CutSurface
     */
    wallImageUrl: '',
    // texturePosition: [0, 0, 0],
    /**
     * 图像高度，单位米
     * @type {number}
     * @instance
     * @default 3.0
     * @memberof Obj.CutSurface
     */
    wallImageHeight: 3.0,
    /**
     * 图像宽度拉伸比例
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.CutSurface
     */
    wallImageWidthScale: 1.0,
    /**
     * 底部图像路径
     * @type {string}
     * @instance
     * @default ''
     * @memberof Obj.Surface
     */
    bottomImageUrl: '',
    // texturePosition: [0, 0, 0],
    /**
     * 纹理旋转角度(欧拉角，[偏航角, 俯仰角, 翻滚角])
     * @type {number[]}
     * @instance
     * @default [0, 0, 0]
     * @memberof Obj.Surface
     */
    bottomTextureRotation: [0, 0, 0],
    /**
     * 图像高度，单位米
     * @type {number}
     * @instance
     * @default 3.0
     * @memberof Obj.Surface
     */
    bottomImageHeight: 3.0,
    /**
     * 图像宽度拉伸比例
     * @type {number}
     * @instance
     * @default 1.0
     * @memberof Obj.Surface
     */
    bottomImageWidthScale: 1.0
};

_XbsjObject2.default.registerType(CutSurface, 'CutSurface');

exports.default = CutSurface;

/***/ }),
/* 376 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var vertexShader = exports.vertexShader = "\n// vtxf \u4F7F\u7528double\u7C7B\u578B\u7684position\u8FDB\u884C\u8BA1\u7B97\n// attribute vec3 position3DHigh;\n// attribute vec3 position3DLow;\nattribute vec3 position;\nattribute vec3 normal;\nattribute vec2 st;\nattribute vec4 color;\nattribute float batchId;\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nvoid main()\n{\n    // vtxf \u4F7F\u7528double\u7C7B\u578B\u7684position\u8FDB\u884C\u8BA1\u7B97\n    // vec4 p = czm_translateRelativeToEye(position3DHigh, position3DLow);\n    // v_positionEC = (czm_modelViewRelativeToEye * p).xyz;      // position in eye coordinates\n    // v_normalEC = czm_normal * normal;                         // normal in eye coordinates\n    // v_st = st;\n    // gl_Position = czm_modelViewProjectionRelativeToEye * p;\n    v_positionEC = (czm_modelView * vec4(position, 1.0)).xyz;       // position in eye coordinates\n    v_normalEC = czm_normal * normal;                               // normal in eye coordinates\n    v_st = st;\n    v_color = color;\n    gl_Position = czm_modelViewProjection * vec4(position, 1.0);\n}\n";

var fragmentShader = exports.fragmentShader = "\nvarying vec3 v_positionEC;\nvarying vec3 v_normalEC;\nvarying vec2 v_st;\nvarying vec4 v_color;\nuniform sampler2D u_image;\nuniform vec4 u_color;\nvoid main()\n{\n    vec3 positionToEyeEC = -v_positionEC;\n    vec3 normalEC = normalize(v_normalEC);\n// #ifdef FACE_FORWARD\n    normalEC = faceforward(normalEC, vec3(0.0, 0.0, 1.0), -normalEC);\n// #endif\n\n    czm_materialInput materialInput;\n    materialInput.normalEC = normalEC;\n    materialInput.positionToEyeEC = positionToEyeEC;\n    materialInput.st = v_st;\n    //czm_material material = czm_getMaterial(materialInput);\n    czm_material material = czm_getDefaultMaterial(materialInput);\n    vec4 imageColor = texture2D(u_image, fract(materialInput.st));\n\n    material.diffuse = imageColor.rgb;\n    material.alpha = imageColor.a;\n\n    material.diffuse *= v_color.rgb;\n    material.alpha *= v_color.a;\n    \n    material.diffuse *= u_color.rgb;\n    material.alpha *= u_color.a;\n\n#ifdef FLAT\n    gl_FragColor = vec4(material.diffuse + material.emission, material.alpha);\n#else\n    gl_FragColor = czm_phong(normalize(positionToEyeEC), material, czm_lightDirectionEC);\n#endif\n}\n";

/***/ }),
/* 377 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends2 = __webpack_require__(63);

var _extends3 = _interopRequireDefault(_extends2);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _SceneTree = __webpack_require__(172);

var _SceneTree2 = _interopRequireDefault(_SceneTree);

var _CameraView = __webpack_require__(433);

var _CameraView2 = _interopRequireDefault(_CameraView);

var _CameraFlight = __webpack_require__(435);

var _CameraFlight2 = _interopRequireDefault(_CameraFlight);

var _Camera = __webpack_require__(439);

var _Camera2 = _interopRequireDefault(_Camera);

var _Interaction = __webpack_require__(447);

var _Interaction2 = _interopRequireDefault(_Interaction);

var _Analyzation = __webpack_require__(467);

var _Analyzation2 = _interopRequireDefault(_Analyzation);

var _Misc = __webpack_require__(471);

var _Misc2 = _interopRequireDefault(_Misc);

var _initViewer = __webpack_require__(473);

var _initViewer2 = _interopRequireDefault(_initViewer);

var _XbsjTerrainListener = __webpack_require__(474);

var _XbsjTerrainListener2 = _interopRequireDefault(_XbsjTerrainListener);

var _XbsjImageryListener = __webpack_require__(475);

var _XbsjImageryListener2 = _interopRequireDefault(_XbsjImageryListener);

var _registerObject2 = __webpack_require__(197);

var _registerObject3 = _interopRequireDefault(_registerObject2);

var _registerObjectFromGuid2 = __webpack_require__(476);

var _registerObjectFromGuid3 = _interopRequireDefault(_registerObjectFromGuid2);

var _TerrainEffect = __webpack_require__(477);

var _TerrainEffect2 = _interopRequireDefault(_TerrainEffect);

var _Weather = __webpack_require__(486);

var _Weather2 = _interopRequireDefault(_Weather);

var _Effect = __webpack_require__(506);

var _Effect2 = _interopRequireDefault(_Effect);

var _PostProcess = __webpack_require__(133);

var _PostProcess2 = _interopRequireDefault(_PostProcess);

var _Context = __webpack_require__(509);

var _Context2 = _interopRequireDefault(_Context);

var _EventSource = __webpack_require__(510);

var _EventSource2 = _interopRequireDefault(_EventSource);

var _capture2 = __webpack_require__(513);

var _capture3 = _interopRequireDefault(_capture2);

var _pickPosition2 = __webpack_require__(514);

var _pickPosition3 = _interopRequireDefault(_pickPosition2);

var _getSceneSize2 = __webpack_require__(515);

var _getSceneSize3 = _interopRequireDefault(_getSceneSize2);

var _mobx = __webpack_require__(2);

var _Status = __webpack_require__(516);

var _Status2 = _interopRequireDefault(_Status);

var _extendGetter = __webpack_require__(193);

var _extendGetter2 = _interopRequireDefault(_extendGetter);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地球类
 * @class
 */

// import PickedObject from '../PickedObject';
var Earth = function (_XbsjBase) {
    (0, _inherits3.default)(Earth, _XbsjBase);

    function Earth(container, cesiumOptions) {
        var _this$fromJsonFilterK;

        (0, _classCallCheck3.default)(this, Earth);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Earth.__proto__ || (0, _getPrototypeOf2.default)(Earth)).call(this));

        var filters = ['cameraFlight', 'weather', 'terrainEffect', 'postProcess', 'effect'];
        (_this$fromJsonFilterK = _this.fromJsonFilterKeys).push.apply(_this$fromJsonFilterK, filters);

        var viewer = (0, _initViewer2.default)(container, cesiumOptions);
        _this._viewer = viewer;

        _this.disposers.push(function () {
            return _this._viewer.destroy();
        });

        _this._scene = viewer.scene;

        window.xbsj_hpr_scene = _this._scene; // 用于hpr这个函数。。。 很hack的写法。。

        _this._czm = {
            get viewer() {
                return viewer;
            },
            get scene() {
                return viewer.scene;
            },
            get camera() {
                return viewer.camera;
            }
        };

        /**
         * 原始Cesium的对象集合，czm是对Cesium的简称。
         * @description 可以通过此对象调用Cesium相关接口，
         * @name czm
         * @instance
         * @memberof Earth
         * @type {object}
         * @property {Cesium.Viewer} viewer      - 返回Cesium的viewer对象
         * @property {Cesium.Scene} scene      - 返回Cesium的scene对象
         * @property {Cesium.Camera} camera      - 返回Cesium的camera对象
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'czm');

        // 用来监测变量创建和销毁的事件
        _this._xbsjObjectOpsEvent = new Cesium.Event();
        // this._xbsjObjectsMap = new Map();
        (0, _mobx.extendObservable)(_this, {
            _xbsjObjectsMap: _mobx.observable.map(),
            get flattenedPolygonCollection() {
                return this.getAllObjects('FlattenedPolygonCollection');
            },
            get tilesetCollection() {
                return this.getAllObjects('Tileset');
            },
            get clippingPlaneCollection() {
                return this.getAllObjects('ClippingPlane');
            },
            get pathCollection() {
                return this.getAllObjects('Path');
            }
        }, {
            flattenedPolygonCollection: _mobx.computed,
            tilesetCollection: _mobx.computed,
            clippingPlaneCollection: _mobx.computed,
            pathCollection: _mobx.computed
        });

        _this.disposers.push(function () {
            // 清理_xbsjObjectsMap
            if (_this._xbsjObjectsMap.size !== 0) {
                var objects = [].concat((0, _toConsumableArray3.default)(_this._xbsjObjectsMap.values()));
                console.log('\u5171\u8BA1\u6709' + objects.length + '\u4E2A\u5BF9\u8C61\u672A\u88AB\u6E05\u7406\uFF01\u5206\u522B\u662F\uFF1A');
                objects.forEach(function (obj) {
                    return 'guid: ' + obj.name + ' $name\uFF1A' + obj.xbsjGuid;
                });
                console.log('这些对象将被自动清理掉！');
                objects.forEach(function (obj) {
                    return obj.destroy();
                });
            } else {
                console.log('所有对象都已清理！');
            }

            if (_this._xbsjObjectsMap.size !== 0) {
                console.error('仍有对象未清理！');
            }
        });

        _this._context = new _Context2.default(_this);
        (0, _extendGetter2.default)(_this, 'context');

        _this._eventSource = new _EventSource2.default(_this);
        (0, _extendGetter2.default)(_this, 'eventSource');

        _this.disposers.push(function () {
            _this._eventSource.destory();
            _this._context.destroy();
        });

        _this._terrainListener = new _XbsjTerrainListener2.default(_this);
        _this._imageryListener = new _XbsjImageryListener2.default(_this);

        _this.disposers.push(function () {
            _this._terrainListener.destroy();
            _this._imageryListener.destroy();
        });

        // this.sceneTree = new SceneTree.Tree(this);
        // this.disposers.push(() => (this.sceneTree = this.sceneTree && this.sceneTree.destroy()));
        // this.disposers.push(XbsjBase.registerProperty(this, 'sceneTree'));

        function createManager(managerName, managerConstructor, earth) {
            earth[managerName] = new managerConstructor(earth);
            earth.disposers.push(function () {
                return earth[managerName] = earth[managerName] && earth[managerName].destroy();
            });
            earth.disposers.push(_XbsjBase3.default.registerProperty(earth, managerName));
        }

        [{
            managerName: 'sceneTree',
            managerConstructor: _SceneTree2.default.Tree
        }, {
            managerName: 'cameraViewManager',
            managerConstructor: _CameraView2.default.Manager
        }].forEach(function (_ref) {
            var managerName = _ref.managerName,
                managerConstructor = _ref.managerConstructor;

            createManager(managerName, managerConstructor, _this);
        });

        _this._cameraFlight = new _CameraFlight2.default(_this);
        (0, _extendGetter2.default)(_this, 'cameraFlight');

        _this._camera = new _Camera2.default(_this);
        /**
         * 相机管理器
         * @name camera
         * @type {Earth.Camera}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'camera');

        _this._interaction = new _Interaction2.default(_this);
        /**
         * 交互类
         * @name interaction
         * @type {XbsjInteraction}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'interaction');

        _this._analyzation = new _Analyzation2.default(_this);
        /**
         * 分析类
         * @name analyzation
         * @type {Analyzation}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'analyzation');

        _this._misc = new _Misc2.default(_this);
        /**
         * 杂项
         * @type {Misc}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'misc');

        _this._terrainEffect = new _TerrainEffect2.default(_this);
        /**
         * 地形特效
         * @name terrainEffect
         * @type {TerrainEffect}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'terrainEffect');

        // this._pickedObject = new PickedObject(this);
        // /**
        //  * 拾取对象
        //  * @name pickedObject
        //  * @type {PickedObject}
        //  * @readonly
        //  */
        // extendGetter(this, 'pickedObject');        

        _this._weather = new _Weather2.default(_this);
        /**
         * 天气
         * @type {Weather}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'weather');

        _this._effect = new _Effect2.default(_this);
        _this.disposers.push(function () {
            return _this._effect = _this._effect && _this._effect.destroy();
        });

        /**
         * 特效
         * @type {Effect}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'effect');

        _this._postProcess = new _PostProcess2.default(_this);
        _this.disposers.push(function () {
            return _this._postProcess = _this._postProcess && _this._postProcess.destroy();
        });
        /**
         * 后处理
         * @type {PostProcess}
         * @readonly
         */
        (0, _extendGetter2.default)(_this, 'postProcess');

        _this.disposers.push(function () {
            // this._cameraViewManager.destroy();
            _this._cameraFlight.destroy();
            _this._camera.destroy();
            _this._interaction.destroy();
            _this._analyzation.destroy();
            _this._misc.destroy();

            _this._terrainListener.destroy();
            _this._imageryListener.destroy();

            _this._terrainEffect.destroy();
        });

        _this._pinBuilder = new Cesium.XbsjPinBuilder();
        // this.disposers.push(() => {
        //     // pinBuilder销毁
        // })

        _this._status = new _Status2.default(_this);
        (0, _extendGetter2.default)(_this, 'status');
        return _this;
    }

    /**
     * 通过JSON数据对象来设置属性
     * @param {*} jsonObject 
     */

    (0, _createClass3.default)(Earth, [{
        key: 'xbsjFromJSON',
        value: function xbsjFromJSON(jsonObject) {
            (0, _get3.default)(Earth.prototype.__proto__ || (0, _getPrototypeOf2.default)(Earth.prototype), 'xbsjFromJSON', this).call(this, jsonObject);

            try {
                this.cameraFlight.xbsjFromJSON(jsonObject.cameraFlight);
            } catch (ex) {
                console.log('cameraFlight fromJSON failed', ex);
            }

            try {
                this.weather.xbsjFromJSON(jsonObject.weather);
            } catch (ex) {
                console.log('weather fromJSON failed', ex);
            }

            try {
                this.terrainEffect.xbsjFromJSON(jsonObject.terrainEffect);
            } catch (ex) {
                console.log('terrainEffect fromJSON failed', ex);
            }

            try {
                this.postProcess.xbsjFromJSON(jsonObject.postProcess);
            } catch (ex) {
                console.log('postProcess fromJSON failed', ex);
            }

            try {
                this.effect.xbsjFromJSON(jsonObject.effect);
            } catch (ex) {
                console.log('effect fromJSON failed', ex);
            }
        }

        /**
         * 转化成一个JSON数据对象
         * @description 注意：每次都会创建一个新对象！
         * @method
         * @returns {object} 创建的JSON数据对象
         */

    }, {
        key: 'toJSON',
        value: function toJSON() {
            var jsonObject = (0, _extends3.default)({}, (0, _get3.default)(Earth.prototype.__proto__ || (0, _getPrototypeOf2.default)(Earth.prototype), 'toJSON', this).call(this), {
                // cameraViewManager: this.cameraViewManager.toJSON(),  //视角管理器
                cameraFlight: this.cameraFlight.toJSON(), //相机飞行器
                weather: this.weather.toJSON(), //天气
                terrainEffect: this.terrainEffect.toJSON(), //地形效果
                postProcess: this.postProcess.toJSON(), //后处理效果
                effect: this.effect.toJSON() //其他效果
            });

            return jsonObject;
        }
    }, {
        key: 'registerObject',
        value: function registerObject(guid, attachFunc, detachFunc) {
            return (0, _registerObject3.default)(this, guid, attachFunc, detachFunc);
        }
    }, {
        key: 'registerObjectFromGuid',
        value: function registerObjectFromGuid(selfObject, guidProperty, objectProperty) {
            return (0, _registerObjectFromGuid3.default)(this, selfObject, guidProperty, objectProperty);
        }

        /**
         * 根据guid获取某个对象
         * @param {string} id 对象的guid
         */

    }, {
        key: 'getObject',
        value: function getObject(id) {
            return this._xbsjObjectsMap.get(id);
        }

        /**
         * 获取某一类对象的集合
         * @param {string} [filterType] 对象类型名
         */

    }, {
        key: 'getAllObjects',
        value: function getAllObjects(filterType) {
            var results = [];
            this._xbsjObjectsMap.forEach(function (xbsjObj, guid) {
                if (!filterType || xbsjObj.xbsjType === filterType) {
                    results.push(xbsjObj);
                }
            });

            return results;
        }

        /**
         * 截图
         * @param {number} width 图像宽度，单位像素
         * @param {number} height 图像高度，单位像素
         * @returns {string} 返回图像的base64为字符串
         */

    }, {
        key: 'capture',
        value: function capture(width, height, format) {
            return (0, _capture3.default)(this._scene, width, height, format);
        }

        /**
         * 位置拾取
         * @param {object} movePosition windows窗口坐标，形式如 {x: 10, y: 50 }
         * @param {array} result 返回值一个位置，形式如 [1.0, 0.5, 50.0]，表示[经度, 纬度, 高度]，经纬度以弧度为单位，高度以米为单位
         */

    }, {
        key: 'pickPosition',
        value: function pickPosition(movePosition, result) {
            return (0, _pickPosition3.default)(this._scene, movePosition, result);
        }

        /**
         * 假定物体在屏幕上的大小来计算该物体实际尺寸，单位米
         * @param {array} position 位置，形式如[1.0, 0.5, 50.0]，表示[经度, 纬度, 高度]，经纬度以弧度为单位，高度以米为单位
         * @param {number} screenSize 窗口上的实际像素大小，单位像素
         * @returns {number} 返回实际尺寸大小，单位米
         */

    }, {
        key: 'getSceneSize',
        value: function getSceneSize(position, screenSize) {
            return (0, _getSceneSize3.default)(this._scene, position, screenSize);
        }
    }, {
        key: 'czmObjectOpsEvent',
        get: function get() {
            return this._xbsjObjectOpsEvent;
        }
    }]);
    return Earth;
}(_XbsjBase3.default);

Earth.defaultOptions = {
    /**
     * 场景树
     * @type {SceneTree.Tree}
     * @readonly
     * @instance
     * @memberof Earth
     */
    sceneTree: {},
    /**
     * 视角管理器
     * @type {CameraView.Manager}
     * @readonly
     * @instance
     * @memberof Earth
     */
    cameraViewManager: {}
};

Earth.Interaction = _Interaction2.default;

exports.default = Earth;

/***/ }),
/* 378 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _Group = __webpack_require__(173);

var _Group2 = _interopRequireDefault(_Group);

var _Leaf = __webpack_require__(117);

var _Leaf2 = _interopRequireDefault(_Leaf);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _mobx = __webpack_require__(2);

var _rxjs = __webpack_require__(379);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 场景结构树
 * @class
 * @memberof SceneTree
 * @param {object} czmObject earth实例
 * @extends XbsjBase
 * @example
 * // 节点创建方法1(直接通过JSON配置创建节点)：
 * {
 *     const leafConfig = {
 *         "ref": 'pin1',
 *         "czmObject": {
 *             "name": 'Pin1',
 *             "xbsjType": "Pin",
 *             "position": [1.9017005694855162, 0.5972477268978722, 488.7695178987821],
 *             "near": 300,
 *         },
 *     };
 *     earth.sceneTree.root.children.push(leafConfig);
 *     var pin = earth.sceneTree.$refs.pin1.czmObject;
 *
 *     return pin;
 * }
 *
 * 节点创建方法2(先创建节点，然后再加入场景树)：
 * {
 *     const objConfig = {
 *         "name": 'Pin1',
 *         "xbsjType": "Pin",
 *         "position": [1.9017005694855162, 0.5972477268978722, 488.7695178987821],
 *         "near": 300,
 *     };
 *     const pin = new XE.Obj.Pin(earth);  
 *     pin.xbsjFromJSON(objConfig);
 *     // XE.SceneTree.Leaf是场景树的叶子节点类
 *     earth.sceneTree.root.children.push(new XE.SceneTree.Leaf(pin));
 *
 *     return pin;
 * }
 */
var Tree = function (_XbsjBase) {
    (0, _inherits3.default)(Tree, _XbsjBase);

    function Tree(earth) {
        (0, _classCallCheck3.default)(this, Tree);

        // this._fromJsonFilterKeys.push('root');
        var _this = (0, _possibleConstructorReturn3.default)(this, (Tree.__proto__ || (0, _getPrototypeOf2.default)(Tree)).call(this));

        _this.toJsonFilterKeys.push('currentSelectedNode');

        _this.root = new _Group2.default(earth);
        _this.disposers.push(function () {
            return _this.root.destroy();
        });
        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            _currentSelectedNode: undefined,
            get currentSelectedNode() {
                return this._currentSelectedNode;
            }
        }, {
            currentSelectedNode: _mobx.computed
        });

        // only for Debug
        _this.disposers.push((0, _mobx.autorun)(function () {
            XE && (XE.cso = _this.currentSelectedNode && _this.currentSelectedNode.czmObject);
            XE && (XE.csn = _this.currentSelectedNode);
        }));

        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'root'));
        _this._$refs = {};
        return _this;
    }

    /**
     * 获取Earth对象
     * @readonly
     */

    (0, _createClass3.default)(Tree, [{
        key: 'addSceneObject',

        /**
         * 加入一个sceneNode，如果有当前选中节点，则优先加在选中节点处。
         * @param {SceneTree.Group|SceneTree.Leaf} sceneNode sceneNode对象，类型要么是Group，要么是Leaf。
         */
        value: function addSceneObject(sceneNode) {
            var csn = this.currentSelectedNode;
            if (csn && csn.children) {
                csn.children.push(sceneNode);
            } else if (csn && csn.parent) {
                var index = csn.parent.children.indexOf(csn);
                csn.parent.children.splice(index, 0, sceneNode);
            } else {
                this.root.children.push(sceneNode);
            }
        }
    }, {
        key: 'earth',
        get: function get() {
            return this._earth;
        }

        /**
         * 获取指定节点<br/>
         * 使用方法类似Vue，创建节点时，只需要增加ref属性，以后就可以通过$refs查询到该节点
         * @example
         * {
         *     const leafConfig = {
         *         "ref": 'pin1',
         *         "czmObject": {
         *             "name": 'Pin1',
         *             "xbsjType": "Pin",
         *             "position": [1.9017005694855162, 0.5972477268978722, 488.7695178987821],
         *             "near": 300,
         *         },
         *     };
         *     earth.sceneTree.root.children.push(leafConfig);
         *     // 注意这样获取到的是Leaf类型的对象，即叶子节点，并不是叶子节点下挂接的czmObject对象！
         *     var pinNode = earth.sceneTree.$refs.pin1;
         *     // 增加.czmObject，才能获取到节点下挂接的对象！
         *     var pin = earth.sceneTree.$refs.pin1.czmObject;
         *
         *     return pin;
         * }
         */

    }, {
        key: '$refs',
        get: function get() {
            return this._$refs;
        }
    }]);
    return Tree;
}(_XbsjBase3.default);

Tree.defaultOptions = {
    /**
     * 根节点对象<br/>
     * 警告：此节点不能删除！<br/>
     * @type {SceneTree.Group}
     * @readonly
     */
    root: {}
};

exports.default = Tree;

/***/ }),
/* 379 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
Object.defineProperty(__webpack_exports__, "__esModule", { value: true });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__internal_Observable__ = __webpack_require__(12);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Observable", function() { return __WEBPACK_IMPORTED_MODULE_0__internal_Observable__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__internal_observable_ConnectableObservable__ = __webpack_require__(381);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "ConnectableObservable", function() { return __WEBPACK_IMPORTED_MODULE_1__internal_observable_ConnectableObservable__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__internal_operators_groupBy__ = __webpack_require__(383);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "GroupedObservable", function() { return __WEBPACK_IMPORTED_MODULE_2__internal_operators_groupBy__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__internal_symbol_observable__ = __webpack_require__(51);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "observable", function() { return __WEBPACK_IMPORTED_MODULE_3__internal_symbol_observable__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__internal_Subject__ = __webpack_require__(52);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Subject", function() { return __WEBPACK_IMPORTED_MODULE_4__internal_Subject__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__internal_BehaviorSubject__ = __webpack_require__(384);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "BehaviorSubject", function() { return __WEBPACK_IMPORTED_MODULE_5__internal_BehaviorSubject__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__internal_ReplaySubject__ = __webpack_require__(385);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "ReplaySubject", function() { return __WEBPACK_IMPORTED_MODULE_6__internal_ReplaySubject__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_7__internal_AsyncSubject__ = __webpack_require__(125);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "AsyncSubject", function() { return __WEBPACK_IMPORTED_MODULE_7__internal_AsyncSubject__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_8__internal_scheduler_asap__ = __webpack_require__(390);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "asapScheduler", function() { return __WEBPACK_IMPORTED_MODULE_8__internal_scheduler_asap__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_9__internal_scheduler_async__ = __webpack_require__(126);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "asyncScheduler", function() { return __WEBPACK_IMPORTED_MODULE_9__internal_scheduler_async__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_10__internal_scheduler_queue__ = __webpack_require__(178);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "queueScheduler", function() { return __WEBPACK_IMPORTED_MODULE_10__internal_scheduler_queue__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_11__internal_scheduler_animationFrame__ = __webpack_require__(394);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "animationFrameScheduler", function() { return __WEBPACK_IMPORTED_MODULE_11__internal_scheduler_animationFrame__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_12__internal_scheduler_VirtualTimeScheduler__ = __webpack_require__(397);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "VirtualTimeScheduler", function() { return __WEBPACK_IMPORTED_MODULE_12__internal_scheduler_VirtualTimeScheduler__["b"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "VirtualAction", function() { return __WEBPACK_IMPORTED_MODULE_12__internal_scheduler_VirtualTimeScheduler__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_13__internal_Scheduler__ = __webpack_require__(179);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Scheduler", function() { return __WEBPACK_IMPORTED_MODULE_13__internal_Scheduler__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_14__internal_Subscription__ = __webpack_require__(22);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Subscription", function() { return __WEBPACK_IMPORTED_MODULE_14__internal_Subscription__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_15__internal_Subscriber__ = __webpack_require__(24);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Subscriber", function() { return __WEBPACK_IMPORTED_MODULE_15__internal_Subscriber__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_16__internal_Notification__ = __webpack_require__(180);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "Notification", function() { return __WEBPACK_IMPORTED_MODULE_16__internal_Notification__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "NotificationKind", function() { return __WEBPACK_IMPORTED_MODULE_16__internal_Notification__["b"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_17__internal_util_pipe__ = __webpack_require__(176);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "pipe", function() { return __WEBPACK_IMPORTED_MODULE_17__internal_util_pipe__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_18__internal_util_noop__ = __webpack_require__(122);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "noop", function() { return __WEBPACK_IMPORTED_MODULE_18__internal_util_noop__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_19__internal_util_identity__ = __webpack_require__(127);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "identity", function() { return __WEBPACK_IMPORTED_MODULE_19__internal_util_identity__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_20__internal_util_isObservable__ = __webpack_require__(398);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "isObservable", function() { return __WEBPACK_IMPORTED_MODULE_20__internal_util_isObservable__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_21__internal_util_ArgumentOutOfRangeError__ = __webpack_require__(399);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "ArgumentOutOfRangeError", function() { return __WEBPACK_IMPORTED_MODULE_21__internal_util_ArgumentOutOfRangeError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_22__internal_util_EmptyError__ = __webpack_require__(400);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "EmptyError", function() { return __WEBPACK_IMPORTED_MODULE_22__internal_util_EmptyError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_23__internal_util_ObjectUnsubscribedError__ = __webpack_require__(88);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "ObjectUnsubscribedError", function() { return __WEBPACK_IMPORTED_MODULE_23__internal_util_ObjectUnsubscribedError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_24__internal_util_UnsubscriptionError__ = __webpack_require__(175);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "UnsubscriptionError", function() { return __WEBPACK_IMPORTED_MODULE_24__internal_util_UnsubscriptionError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_25__internal_util_TimeoutError__ = __webpack_require__(401);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "TimeoutError", function() { return __WEBPACK_IMPORTED_MODULE_25__internal_util_TimeoutError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_26__internal_observable_bindCallback__ = __webpack_require__(402);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "bindCallback", function() { return __WEBPACK_IMPORTED_MODULE_26__internal_observable_bindCallback__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_27__internal_observable_bindNodeCallback__ = __webpack_require__(403);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "bindNodeCallback", function() { return __WEBPACK_IMPORTED_MODULE_27__internal_observable_bindNodeCallback__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_28__internal_observable_combineLatest__ = __webpack_require__(404);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "combineLatest", function() { return __WEBPACK_IMPORTED_MODULE_28__internal_observable_combineLatest__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_29__internal_observable_concat__ = __webpack_require__(408);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "concat", function() { return __WEBPACK_IMPORTED_MODULE_29__internal_observable_concat__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_30__internal_observable_defer__ = __webpack_require__(188);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "defer", function() { return __WEBPACK_IMPORTED_MODULE_30__internal_observable_defer__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_31__internal_observable_empty__ = __webpack_require__(44);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "empty", function() { return __WEBPACK_IMPORTED_MODULE_31__internal_observable_empty__["b"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_32__internal_observable_forkJoin__ = __webpack_require__(416);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "forkJoin", function() { return __WEBPACK_IMPORTED_MODULE_32__internal_observable_forkJoin__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_33__internal_observable_from__ = __webpack_require__(54);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "from", function() { return __WEBPACK_IMPORTED_MODULE_33__internal_observable_from__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_34__internal_observable_fromEvent__ = __webpack_require__(417);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "fromEvent", function() { return __WEBPACK_IMPORTED_MODULE_34__internal_observable_fromEvent__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_35__internal_observable_fromEventPattern__ = __webpack_require__(418);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "fromEventPattern", function() { return __WEBPACK_IMPORTED_MODULE_35__internal_observable_fromEventPattern__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_36__internal_observable_generate__ = __webpack_require__(419);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "generate", function() { return __WEBPACK_IMPORTED_MODULE_36__internal_observable_generate__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_37__internal_observable_iif__ = __webpack_require__(420);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "iif", function() { return __WEBPACK_IMPORTED_MODULE_37__internal_observable_iif__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_38__internal_observable_interval__ = __webpack_require__(421);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "interval", function() { return __WEBPACK_IMPORTED_MODULE_38__internal_observable_interval__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_39__internal_observable_merge__ = __webpack_require__(422);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "merge", function() { return __WEBPACK_IMPORTED_MODULE_39__internal_observable_merge__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_40__internal_observable_never__ = __webpack_require__(190);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "never", function() { return __WEBPACK_IMPORTED_MODULE_40__internal_observable_never__["b"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_41__internal_observable_of__ = __webpack_require__(123);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "of", function() { return __WEBPACK_IMPORTED_MODULE_41__internal_observable_of__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_42__internal_observable_onErrorResumeNext__ = __webpack_require__(423);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "onErrorResumeNext", function() { return __WEBPACK_IMPORTED_MODULE_42__internal_observable_onErrorResumeNext__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_43__internal_observable_pairs__ = __webpack_require__(424);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "pairs", function() { return __WEBPACK_IMPORTED_MODULE_43__internal_observable_pairs__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_44__internal_observable_partition__ = __webpack_require__(425);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "partition", function() { return __WEBPACK_IMPORTED_MODULE_44__internal_observable_partition__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_45__internal_observable_race__ = __webpack_require__(428);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "race", function() { return __WEBPACK_IMPORTED_MODULE_45__internal_observable_race__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_46__internal_observable_range__ = __webpack_require__(429);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "range", function() { return __WEBPACK_IMPORTED_MODULE_46__internal_observable_range__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_47__internal_observable_throwError__ = __webpack_require__(182);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "throwError", function() { return __WEBPACK_IMPORTED_MODULE_47__internal_observable_throwError__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_48__internal_observable_timer__ = __webpack_require__(430);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "timer", function() { return __WEBPACK_IMPORTED_MODULE_48__internal_observable_timer__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_49__internal_observable_using__ = __webpack_require__(431);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "using", function() { return __WEBPACK_IMPORTED_MODULE_49__internal_observable_using__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_50__internal_observable_zip__ = __webpack_require__(432);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "zip", function() { return __WEBPACK_IMPORTED_MODULE_50__internal_observable_zip__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_51__internal_scheduled_scheduled__ = __webpack_require__(187);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "scheduled", function() { return __WEBPACK_IMPORTED_MODULE_51__internal_scheduled_scheduled__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "EMPTY", function() { return __WEBPACK_IMPORTED_MODULE_31__internal_observable_empty__["a"]; });
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "NEVER", function() { return __WEBPACK_IMPORTED_MODULE_40__internal_observable_never__["a"]; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_52__internal_config__ = __webpack_require__(87);
/* harmony reexport (binding) */ __webpack_require__.d(__webpack_exports__, "config", function() { return __WEBPACK_IMPORTED_MODULE_52__internal_config__["a"]; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */























































//# sourceMappingURL=index.js.map


/***/ }),
/* 380 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = toSubscriber;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__symbol_rxSubscriber__ = __webpack_require__(121);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Observer__ = __webpack_require__(174);
/** PURE_IMPORTS_START _Subscriber,_symbol_rxSubscriber,_Observer PURE_IMPORTS_END */



function toSubscriber(nextOrObserver, error, complete) {
    if (nextOrObserver) {
        if (nextOrObserver instanceof __WEBPACK_IMPORTED_MODULE_0__Subscriber__["a" /* Subscriber */]) {
            return nextOrObserver;
        }
        if (nextOrObserver[__WEBPACK_IMPORTED_MODULE_1__symbol_rxSubscriber__["a" /* rxSubscriber */]]) {
            return nextOrObserver[__WEBPACK_IMPORTED_MODULE_1__symbol_rxSubscriber__["a" /* rxSubscriber */]]();
        }
    }
    if (!nextOrObserver && !error && !complete) {
        return new __WEBPACK_IMPORTED_MODULE_0__Subscriber__["a" /* Subscriber */](__WEBPACK_IMPORTED_MODULE_2__Observer__["a" /* empty */]);
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Subscriber__["a" /* Subscriber */](nextOrObserver, error, complete);
}
//# sourceMappingURL=toSubscriber.js.map


/***/ }),
/* 381 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ConnectableObservable; });
/* unused harmony export connectableObservableDescriptor */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subject__ = __webpack_require__(52);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__operators_refCount__ = __webpack_require__(382);
/** PURE_IMPORTS_START tslib,_Subject,_Observable,_Subscriber,_Subscription,_operators_refCount PURE_IMPORTS_END */






var ConnectableObservable = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ConnectableObservable, _super);
    function ConnectableObservable(source, subjectFactory) {
        var _this = _super.call(this) || this;
        _this.source = source;
        _this.subjectFactory = subjectFactory;
        _this._refCount = 0;
        _this._isComplete = false;
        return _this;
    }
    ConnectableObservable.prototype._subscribe = function (subscriber) {
        return this.getSubject().subscribe(subscriber);
    };
    ConnectableObservable.prototype.getSubject = function () {
        var subject = this._subject;
        if (!subject || subject.isStopped) {
            this._subject = this.subjectFactory();
        }
        return this._subject;
    };
    ConnectableObservable.prototype.connect = function () {
        var connection = this._connection;
        if (!connection) {
            this._isComplete = false;
            connection = this._connection = new __WEBPACK_IMPORTED_MODULE_4__Subscription__["a" /* Subscription */]();
            connection.add(this.source
                .subscribe(new ConnectableSubscriber(this.getSubject(), this)));
            if (connection.closed) {
                this._connection = null;
                connection = __WEBPACK_IMPORTED_MODULE_4__Subscription__["a" /* Subscription */].EMPTY;
            }
        }
        return connection;
    };
    ConnectableObservable.prototype.refCount = function () {
        return Object(__WEBPACK_IMPORTED_MODULE_5__operators_refCount__["a" /* refCount */])()(this);
    };
    return ConnectableObservable;
}(__WEBPACK_IMPORTED_MODULE_2__Observable__["a" /* Observable */]));

var connectableProto = ConnectableObservable.prototype;
var connectableObservableDescriptor = {
    operator: { value: null },
    _refCount: { value: 0, writable: true },
    _subject: { value: null, writable: true },
    _connection: { value: null, writable: true },
    _subscribe: { value: connectableProto._subscribe },
    _isComplete: { value: connectableProto._isComplete, writable: true },
    getSubject: { value: connectableProto.getSubject },
    connect: { value: connectableProto.connect },
    refCount: { value: connectableProto.refCount }
};
var ConnectableSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ConnectableSubscriber, _super);
    function ConnectableSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    ConnectableSubscriber.prototype._error = function (err) {
        this._unsubscribe();
        _super.prototype._error.call(this, err);
    };
    ConnectableSubscriber.prototype._complete = function () {
        this.connectable._isComplete = true;
        this._unsubscribe();
        _super.prototype._complete.call(this);
    };
    ConnectableSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (connectable) {
            this.connectable = null;
            var connection = connectable._connection;
            connectable._refCount = 0;
            connectable._subject = null;
            connectable._connection = null;
            if (connection) {
                connection.unsubscribe();
            }
        }
    };
    return ConnectableSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subject__["b" /* SubjectSubscriber */]));
var RefCountOperator = /*@__PURE__*/ (function () {
    function RefCountOperator(connectable) {
        this.connectable = connectable;
    }
    RefCountOperator.prototype.call = function (subscriber, source) {
        var connectable = this.connectable;
        connectable._refCount++;
        var refCounter = new RefCountSubscriber(subscriber, connectable);
        var subscription = source.subscribe(refCounter);
        if (!refCounter.closed) {
            refCounter.connection = connectable.connect();
        }
        return subscription;
    };
    return RefCountOperator;
}());
var RefCountSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](RefCountSubscriber, _super);
    function RefCountSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    RefCountSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (!connectable) {
            this.connection = null;
            return;
        }
        this.connectable = null;
        var refCount = connectable._refCount;
        if (refCount <= 0) {
            this.connection = null;
            return;
        }
        connectable._refCount = refCount - 1;
        if (refCount > 1) {
            this.connection = null;
            return;
        }
        var connection = this.connection;
        var sharedConnection = connectable._connection;
        this.connection = null;
        if (sharedConnection && (!connection || sharedConnection === connection)) {
            sharedConnection.unsubscribe();
        }
    };
    return RefCountSubscriber;
}(__WEBPACK_IMPORTED_MODULE_3__Subscriber__["a" /* Subscriber */]));
//# sourceMappingURL=ConnectableObservable.js.map


/***/ }),
/* 382 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = refCount;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function refCount() {
    return function refCountOperatorFunction(source) {
        return source.lift(new RefCountOperator(source));
    };
}
var RefCountOperator = /*@__PURE__*/ (function () {
    function RefCountOperator(connectable) {
        this.connectable = connectable;
    }
    RefCountOperator.prototype.call = function (subscriber, source) {
        var connectable = this.connectable;
        connectable._refCount++;
        var refCounter = new RefCountSubscriber(subscriber, connectable);
        var subscription = source.subscribe(refCounter);
        if (!refCounter.closed) {
            refCounter.connection = connectable.connect();
        }
        return subscription;
    };
    return RefCountOperator;
}());
var RefCountSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](RefCountSubscriber, _super);
    function RefCountSubscriber(destination, connectable) {
        var _this = _super.call(this, destination) || this;
        _this.connectable = connectable;
        return _this;
    }
    RefCountSubscriber.prototype._unsubscribe = function () {
        var connectable = this.connectable;
        if (!connectable) {
            this.connection = null;
            return;
        }
        this.connectable = null;
        var refCount = connectable._refCount;
        if (refCount <= 0) {
            this.connection = null;
            return;
        }
        connectable._refCount = refCount - 1;
        if (refCount > 1) {
            this.connection = null;
            return;
        }
        var connection = this.connection;
        var sharedConnection = connectable._connection;
        this.connection = null;
        if (sharedConnection && (!connection || sharedConnection === connection)) {
            sharedConnection.unsubscribe();
        }
    };
    return RefCountSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));
//# sourceMappingURL=refCount.js.map


/***/ }),
/* 383 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export groupBy */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return GroupedObservable; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__Subject__ = __webpack_require__(52);
/** PURE_IMPORTS_START tslib,_Subscriber,_Subscription,_Observable,_Subject PURE_IMPORTS_END */





function groupBy(keySelector, elementSelector, durationSelector, subjectSelector) {
    return function (source) {
        return source.lift(new GroupByOperator(keySelector, elementSelector, durationSelector, subjectSelector));
    };
}
var GroupByOperator = /*@__PURE__*/ (function () {
    function GroupByOperator(keySelector, elementSelector, durationSelector, subjectSelector) {
        this.keySelector = keySelector;
        this.elementSelector = elementSelector;
        this.durationSelector = durationSelector;
        this.subjectSelector = subjectSelector;
    }
    GroupByOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new GroupBySubscriber(subscriber, this.keySelector, this.elementSelector, this.durationSelector, this.subjectSelector));
    };
    return GroupByOperator;
}());
var GroupBySubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](GroupBySubscriber, _super);
    function GroupBySubscriber(destination, keySelector, elementSelector, durationSelector, subjectSelector) {
        var _this = _super.call(this, destination) || this;
        _this.keySelector = keySelector;
        _this.elementSelector = elementSelector;
        _this.durationSelector = durationSelector;
        _this.subjectSelector = subjectSelector;
        _this.groups = null;
        _this.attemptedToUnsubscribe = false;
        _this.count = 0;
        return _this;
    }
    GroupBySubscriber.prototype._next = function (value) {
        var key;
        try {
            key = this.keySelector(value);
        }
        catch (err) {
            this.error(err);
            return;
        }
        this._group(value, key);
    };
    GroupBySubscriber.prototype._group = function (value, key) {
        var groups = this.groups;
        if (!groups) {
            groups = this.groups = new Map();
        }
        var group = groups.get(key);
        var element;
        if (this.elementSelector) {
            try {
                element = this.elementSelector(value);
            }
            catch (err) {
                this.error(err);
            }
        }
        else {
            element = value;
        }
        if (!group) {
            group = (this.subjectSelector ? this.subjectSelector() : new __WEBPACK_IMPORTED_MODULE_4__Subject__["a" /* Subject */]());
            groups.set(key, group);
            var groupedObservable = new GroupedObservable(key, group, this);
            this.destination.next(groupedObservable);
            if (this.durationSelector) {
                var duration = void 0;
                try {
                    duration = this.durationSelector(new GroupedObservable(key, group));
                }
                catch (err) {
                    this.error(err);
                    return;
                }
                this.add(duration.subscribe(new GroupDurationSubscriber(key, group, this)));
            }
        }
        if (!group.closed) {
            group.next(element);
        }
    };
    GroupBySubscriber.prototype._error = function (err) {
        var groups = this.groups;
        if (groups) {
            groups.forEach(function (group, key) {
                group.error(err);
            });
            groups.clear();
        }
        this.destination.error(err);
    };
    GroupBySubscriber.prototype._complete = function () {
        var groups = this.groups;
        if (groups) {
            groups.forEach(function (group, key) {
                group.complete();
            });
            groups.clear();
        }
        this.destination.complete();
    };
    GroupBySubscriber.prototype.removeGroup = function (key) {
        this.groups.delete(key);
    };
    GroupBySubscriber.prototype.unsubscribe = function () {
        if (!this.closed) {
            this.attemptedToUnsubscribe = true;
            if (this.count === 0) {
                _super.prototype.unsubscribe.call(this);
            }
        }
    };
    return GroupBySubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));
var GroupDurationSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](GroupDurationSubscriber, _super);
    function GroupDurationSubscriber(key, group, parent) {
        var _this = _super.call(this, group) || this;
        _this.key = key;
        _this.group = group;
        _this.parent = parent;
        return _this;
    }
    GroupDurationSubscriber.prototype._next = function (value) {
        this.complete();
    };
    GroupDurationSubscriber.prototype._unsubscribe = function () {
        var _a = this, parent = _a.parent, key = _a.key;
        this.key = this.parent = null;
        if (parent) {
            parent.removeGroup(key);
        }
    };
    return GroupDurationSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));
var GroupedObservable = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](GroupedObservable, _super);
    function GroupedObservable(key, groupSubject, refCountSubscription) {
        var _this = _super.call(this) || this;
        _this.key = key;
        _this.groupSubject = groupSubject;
        _this.refCountSubscription = refCountSubscription;
        return _this;
    }
    GroupedObservable.prototype._subscribe = function (subscriber) {
        var subscription = new __WEBPACK_IMPORTED_MODULE_2__Subscription__["a" /* Subscription */]();
        var _a = this, refCountSubscription = _a.refCountSubscription, groupSubject = _a.groupSubject;
        if (refCountSubscription && !refCountSubscription.closed) {
            subscription.add(new InnerRefCountSubscription(refCountSubscription));
        }
        subscription.add(groupSubject.subscribe(subscriber));
        return subscription;
    };
    return GroupedObservable;
}(__WEBPACK_IMPORTED_MODULE_3__Observable__["a" /* Observable */]));

var InnerRefCountSubscription = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](InnerRefCountSubscription, _super);
    function InnerRefCountSubscription(parent) {
        var _this = _super.call(this) || this;
        _this.parent = parent;
        parent.count++;
        return _this;
    }
    InnerRefCountSubscription.prototype.unsubscribe = function () {
        var parent = this.parent;
        if (!parent.closed && !this.closed) {
            _super.prototype.unsubscribe.call(this);
            parent.count -= 1;
            if (parent.count === 0 && parent.attemptedToUnsubscribe) {
                parent.unsubscribe();
            }
        }
    };
    return InnerRefCountSubscription;
}(__WEBPACK_IMPORTED_MODULE_2__Subscription__["a" /* Subscription */]));
//# sourceMappingURL=groupBy.js.map


/***/ }),
/* 384 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return BehaviorSubject; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subject__ = __webpack_require__(52);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_ObjectUnsubscribedError__ = __webpack_require__(88);
/** PURE_IMPORTS_START tslib,_Subject,_util_ObjectUnsubscribedError PURE_IMPORTS_END */



var BehaviorSubject = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](BehaviorSubject, _super);
    function BehaviorSubject(_value) {
        var _this = _super.call(this) || this;
        _this._value = _value;
        return _this;
    }
    Object.defineProperty(BehaviorSubject.prototype, "value", {
        get: function () {
            return this.getValue();
        },
        enumerable: true,
        configurable: true
    });
    BehaviorSubject.prototype._subscribe = function (subscriber) {
        var subscription = _super.prototype._subscribe.call(this, subscriber);
        if (subscription && !subscription.closed) {
            subscriber.next(this._value);
        }
        return subscription;
    };
    BehaviorSubject.prototype.getValue = function () {
        if (this.hasError) {
            throw this.thrownError;
        }
        else if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_2__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        else {
            return this._value;
        }
    };
    BehaviorSubject.prototype.next = function (value) {
        _super.prototype.next.call(this, this._value = value);
    };
    return BehaviorSubject;
}(__WEBPACK_IMPORTED_MODULE_1__Subject__["a" /* Subject */]));

//# sourceMappingURL=BehaviorSubject.js.map


/***/ }),
/* 385 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ReplaySubject; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subject__ = __webpack_require__(52);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__scheduler_queue__ = __webpack_require__(178);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__operators_observeOn__ = __webpack_require__(389);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__util_ObjectUnsubscribedError__ = __webpack_require__(88);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__SubjectSubscription__ = __webpack_require__(177);
/** PURE_IMPORTS_START tslib,_Subject,_scheduler_queue,_Subscription,_operators_observeOn,_util_ObjectUnsubscribedError,_SubjectSubscription PURE_IMPORTS_END */







var ReplaySubject = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ReplaySubject, _super);
    function ReplaySubject(bufferSize, windowTime, scheduler) {
        if (bufferSize === void 0) {
            bufferSize = Number.POSITIVE_INFINITY;
        }
        if (windowTime === void 0) {
            windowTime = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this) || this;
        _this.scheduler = scheduler;
        _this._events = [];
        _this._infiniteTimeWindow = false;
        _this._bufferSize = bufferSize < 1 ? 1 : bufferSize;
        _this._windowTime = windowTime < 1 ? 1 : windowTime;
        if (windowTime === Number.POSITIVE_INFINITY) {
            _this._infiniteTimeWindow = true;
            _this.next = _this.nextInfiniteTimeWindow;
        }
        else {
            _this.next = _this.nextTimeWindow;
        }
        return _this;
    }
    ReplaySubject.prototype.nextInfiniteTimeWindow = function (value) {
        var _events = this._events;
        _events.push(value);
        if (_events.length > this._bufferSize) {
            _events.shift();
        }
        _super.prototype.next.call(this, value);
    };
    ReplaySubject.prototype.nextTimeWindow = function (value) {
        this._events.push(new ReplayEvent(this._getNow(), value));
        this._trimBufferThenGetEvents();
        _super.prototype.next.call(this, value);
    };
    ReplaySubject.prototype._subscribe = function (subscriber) {
        var _infiniteTimeWindow = this._infiniteTimeWindow;
        var _events = _infiniteTimeWindow ? this._events : this._trimBufferThenGetEvents();
        var scheduler = this.scheduler;
        var len = _events.length;
        var subscription;
        if (this.closed) {
            throw new __WEBPACK_IMPORTED_MODULE_5__util_ObjectUnsubscribedError__["a" /* ObjectUnsubscribedError */]();
        }
        else if (this.isStopped || this.hasError) {
            subscription = __WEBPACK_IMPORTED_MODULE_3__Subscription__["a" /* Subscription */].EMPTY;
        }
        else {
            this.observers.push(subscriber);
            subscription = new __WEBPACK_IMPORTED_MODULE_6__SubjectSubscription__["a" /* SubjectSubscription */](this, subscriber);
        }
        if (scheduler) {
            subscriber.add(subscriber = new __WEBPACK_IMPORTED_MODULE_4__operators_observeOn__["a" /* ObserveOnSubscriber */](subscriber, scheduler));
        }
        if (_infiniteTimeWindow) {
            for (var i = 0; i < len && !subscriber.closed; i++) {
                subscriber.next(_events[i]);
            }
        }
        else {
            for (var i = 0; i < len && !subscriber.closed; i++) {
                subscriber.next(_events[i].value);
            }
        }
        if (this.hasError) {
            subscriber.error(this.thrownError);
        }
        else if (this.isStopped) {
            subscriber.complete();
        }
        return subscription;
    };
    ReplaySubject.prototype._getNow = function () {
        return (this.scheduler || __WEBPACK_IMPORTED_MODULE_2__scheduler_queue__["a" /* queue */]).now();
    };
    ReplaySubject.prototype._trimBufferThenGetEvents = function () {
        var now = this._getNow();
        var _bufferSize = this._bufferSize;
        var _windowTime = this._windowTime;
        var _events = this._events;
        var eventsCount = _events.length;
        var spliceCount = 0;
        while (spliceCount < eventsCount) {
            if ((now - _events[spliceCount].time) < _windowTime) {
                break;
            }
            spliceCount++;
        }
        if (eventsCount > _bufferSize) {
            spliceCount = Math.max(spliceCount, eventsCount - _bufferSize);
        }
        if (spliceCount > 0) {
            _events.splice(0, spliceCount);
        }
        return _events;
    };
    return ReplaySubject;
}(__WEBPACK_IMPORTED_MODULE_1__Subject__["a" /* Subject */]));

var ReplayEvent = /*@__PURE__*/ (function () {
    function ReplayEvent(time, value) {
        this.time = time;
        this.value = value;
    }
    return ReplayEvent;
}());
//# sourceMappingURL=ReplaySubject.js.map


/***/ }),
/* 386 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return QueueAction; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncAction__ = __webpack_require__(66);
/** PURE_IMPORTS_START tslib,_AsyncAction PURE_IMPORTS_END */


var QueueAction = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](QueueAction, _super);
    function QueueAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    QueueAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay > 0) {
            return _super.prototype.schedule.call(this, state, delay);
        }
        this.delay = delay;
        this.state = state;
        this.scheduler.flush(this);
        return this;
    };
    QueueAction.prototype.execute = function (state, delay) {
        return (delay > 0 || this.closed) ?
            _super.prototype.execute.call(this, state, delay) :
            this._execute(state, delay);
    };
    QueueAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        return scheduler.flush(this);
    };
    return QueueAction;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncAction__["a" /* AsyncAction */]));

//# sourceMappingURL=QueueAction.js.map


/***/ }),
/* 387 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Action; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START tslib,_Subscription PURE_IMPORTS_END */


var Action = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](Action, _super);
    function Action(scheduler, work) {
        return _super.call(this) || this;
    }
    Action.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return this;
    };
    return Action;
}(__WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]));

//# sourceMappingURL=Action.js.map


/***/ }),
/* 388 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return QueueScheduler; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__ = __webpack_require__(67);
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var QueueScheduler = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](QueueScheduler, _super);
    function QueueScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    return QueueScheduler;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__["a" /* AsyncScheduler */]));

//# sourceMappingURL=QueueScheduler.js.map


/***/ }),
/* 389 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* unused harmony export observeOn */
/* unused harmony export ObserveOnOperator */
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ObserveOnSubscriber; });
/* unused harmony export ObserveOnMessage */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__Notification__ = __webpack_require__(180);
/** PURE_IMPORTS_START tslib,_Subscriber,_Notification PURE_IMPORTS_END */



function observeOn(scheduler, delay) {
    if (delay === void 0) {
        delay = 0;
    }
    return function observeOnOperatorFunction(source) {
        return source.lift(new ObserveOnOperator(scheduler, delay));
    };
}
var ObserveOnOperator = /*@__PURE__*/ (function () {
    function ObserveOnOperator(scheduler, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        this.scheduler = scheduler;
        this.delay = delay;
    }
    ObserveOnOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ObserveOnSubscriber(subscriber, this.scheduler, this.delay));
    };
    return ObserveOnOperator;
}());

var ObserveOnSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ObserveOnSubscriber, _super);
    function ObserveOnSubscriber(destination, scheduler, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        var _this = _super.call(this, destination) || this;
        _this.scheduler = scheduler;
        _this.delay = delay;
        return _this;
    }
    ObserveOnSubscriber.dispatch = function (arg) {
        var notification = arg.notification, destination = arg.destination;
        notification.observe(destination);
        this.unsubscribe();
    };
    ObserveOnSubscriber.prototype.scheduleMessage = function (notification) {
        var destination = this.destination;
        destination.add(this.scheduler.schedule(ObserveOnSubscriber.dispatch, this.delay, new ObserveOnMessage(notification, this.destination)));
    };
    ObserveOnSubscriber.prototype._next = function (value) {
        this.scheduleMessage(__WEBPACK_IMPORTED_MODULE_2__Notification__["a" /* Notification */].createNext(value));
    };
    ObserveOnSubscriber.prototype._error = function (err) {
        this.scheduleMessage(__WEBPACK_IMPORTED_MODULE_2__Notification__["a" /* Notification */].createError(err));
        this.unsubscribe();
    };
    ObserveOnSubscriber.prototype._complete = function () {
        this.scheduleMessage(__WEBPACK_IMPORTED_MODULE_2__Notification__["a" /* Notification */].createComplete());
        this.unsubscribe();
    };
    return ObserveOnSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));

var ObserveOnMessage = /*@__PURE__*/ (function () {
    function ObserveOnMessage(notification, destination) {
        this.notification = notification;
        this.destination = destination;
    }
    return ObserveOnMessage;
}());

//# sourceMappingURL=observeOn.js.map


/***/ }),
/* 390 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return asap; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__AsapAction__ = __webpack_require__(391);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsapScheduler__ = __webpack_require__(393);
/** PURE_IMPORTS_START _AsapAction,_AsapScheduler PURE_IMPORTS_END */


var asap = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_1__AsapScheduler__["a" /* AsapScheduler */](__WEBPACK_IMPORTED_MODULE_0__AsapAction__["a" /* AsapAction */]);
//# sourceMappingURL=asap.js.map


/***/ }),
/* 391 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AsapAction; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_Immediate__ = __webpack_require__(392);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__AsyncAction__ = __webpack_require__(66);
/** PURE_IMPORTS_START tslib,_util_Immediate,_AsyncAction PURE_IMPORTS_END */



var AsapAction = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AsapAction, _super);
    function AsapAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    AsapAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && delay > 0) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        scheduler.actions.push(this);
        return scheduler.scheduled || (scheduler.scheduled = __WEBPACK_IMPORTED_MODULE_1__util_Immediate__["a" /* Immediate */].setImmediate(scheduler.flush.bind(scheduler, null)));
    };
    AsapAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.recycleAsyncId.call(this, scheduler, id, delay);
        }
        if (scheduler.actions.length === 0) {
            __WEBPACK_IMPORTED_MODULE_1__util_Immediate__["a" /* Immediate */].clearImmediate(id);
            scheduler.scheduled = undefined;
        }
        return undefined;
    };
    return AsapAction;
}(__WEBPACK_IMPORTED_MODULE_2__AsyncAction__["a" /* AsyncAction */]));

//# sourceMappingURL=AsapAction.js.map


/***/ }),
/* 392 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return Immediate; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
var nextHandle = 1;
var tasksByHandle = {};
function runIfPresent(handle) {
    var cb = tasksByHandle[handle];
    if (cb) {
        cb();
    }
}
var Immediate = {
    setImmediate: function (cb) {
        var handle = nextHandle++;
        tasksByHandle[handle] = cb;
        Promise.resolve().then(function () { return runIfPresent(handle); });
        return handle;
    },
    clearImmediate: function (handle) {
        delete tasksByHandle[handle];
    },
};
//# sourceMappingURL=Immediate.js.map


/***/ }),
/* 393 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AsapScheduler; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__ = __webpack_require__(67);
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var AsapScheduler = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AsapScheduler, _super);
    function AsapScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AsapScheduler.prototype.flush = function (action) {
        this.active = true;
        this.scheduled = undefined;
        var actions = this.actions;
        var error;
        var index = -1;
        var count = actions.length;
        action = action || actions.shift();
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (++index < count && (action = actions.shift()));
        this.active = false;
        if (error) {
            while (++index < count && (action = actions.shift())) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AsapScheduler;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__["a" /* AsyncScheduler */]));

//# sourceMappingURL=AsapScheduler.js.map


/***/ }),
/* 394 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return animationFrame; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__AnimationFrameAction__ = __webpack_require__(395);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AnimationFrameScheduler__ = __webpack_require__(396);
/** PURE_IMPORTS_START _AnimationFrameAction,_AnimationFrameScheduler PURE_IMPORTS_END */


var animationFrame = /*@__PURE__*/ new __WEBPACK_IMPORTED_MODULE_1__AnimationFrameScheduler__["a" /* AnimationFrameScheduler */](__WEBPACK_IMPORTED_MODULE_0__AnimationFrameAction__["a" /* AnimationFrameAction */]);
//# sourceMappingURL=animationFrame.js.map


/***/ }),
/* 395 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AnimationFrameAction; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncAction__ = __webpack_require__(66);
/** PURE_IMPORTS_START tslib,_AsyncAction PURE_IMPORTS_END */


var AnimationFrameAction = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AnimationFrameAction, _super);
    function AnimationFrameAction(scheduler, work) {
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        return _this;
    }
    AnimationFrameAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (delay !== null && delay > 0) {
            return _super.prototype.requestAsyncId.call(this, scheduler, id, delay);
        }
        scheduler.actions.push(this);
        return scheduler.scheduled || (scheduler.scheduled = requestAnimationFrame(function () { return scheduler.flush(null); }));
    };
    AnimationFrameAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if ((delay !== null && delay > 0) || (delay === null && this.delay > 0)) {
            return _super.prototype.recycleAsyncId.call(this, scheduler, id, delay);
        }
        if (scheduler.actions.length === 0) {
            cancelAnimationFrame(id);
            scheduler.scheduled = undefined;
        }
        return undefined;
    };
    return AnimationFrameAction;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncAction__["a" /* AsyncAction */]));

//# sourceMappingURL=AnimationFrameAction.js.map


/***/ }),
/* 396 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return AnimationFrameScheduler; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__ = __webpack_require__(67);
/** PURE_IMPORTS_START tslib,_AsyncScheduler PURE_IMPORTS_END */


var AnimationFrameScheduler = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](AnimationFrameScheduler, _super);
    function AnimationFrameScheduler() {
        return _super !== null && _super.apply(this, arguments) || this;
    }
    AnimationFrameScheduler.prototype.flush = function (action) {
        this.active = true;
        this.scheduled = undefined;
        var actions = this.actions;
        var error;
        var index = -1;
        var count = actions.length;
        action = action || actions.shift();
        do {
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        } while (++index < count && (action = actions.shift()));
        this.active = false;
        if (error) {
            while (++index < count && (action = actions.shift())) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    return AnimationFrameScheduler;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncScheduler__["a" /* AsyncScheduler */]));

//# sourceMappingURL=AnimationFrameScheduler.js.map


/***/ }),
/* 397 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "b", function() { return VirtualTimeScheduler; });
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return VirtualAction; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncAction__ = __webpack_require__(66);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__AsyncScheduler__ = __webpack_require__(67);
/** PURE_IMPORTS_START tslib,_AsyncAction,_AsyncScheduler PURE_IMPORTS_END */



var VirtualTimeScheduler = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](VirtualTimeScheduler, _super);
    function VirtualTimeScheduler(SchedulerAction, maxFrames) {
        if (SchedulerAction === void 0) {
            SchedulerAction = VirtualAction;
        }
        if (maxFrames === void 0) {
            maxFrames = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this, SchedulerAction, function () { return _this.frame; }) || this;
        _this.maxFrames = maxFrames;
        _this.frame = 0;
        _this.index = -1;
        return _this;
    }
    VirtualTimeScheduler.prototype.flush = function () {
        var _a = this, actions = _a.actions, maxFrames = _a.maxFrames;
        var error, action;
        while ((action = actions[0]) && action.delay <= maxFrames) {
            actions.shift();
            this.frame = action.delay;
            if (error = action.execute(action.state, action.delay)) {
                break;
            }
        }
        if (error) {
            while (action = actions.shift()) {
                action.unsubscribe();
            }
            throw error;
        }
    };
    VirtualTimeScheduler.frameTimeFactor = 10;
    return VirtualTimeScheduler;
}(__WEBPACK_IMPORTED_MODULE_2__AsyncScheduler__["a" /* AsyncScheduler */]));

var VirtualAction = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](VirtualAction, _super);
    function VirtualAction(scheduler, work, index) {
        if (index === void 0) {
            index = scheduler.index += 1;
        }
        var _this = _super.call(this, scheduler, work) || this;
        _this.scheduler = scheduler;
        _this.work = work;
        _this.index = index;
        _this.active = true;
        _this.index = scheduler.index = index;
        return _this;
    }
    VirtualAction.prototype.schedule = function (state, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        if (!this.id) {
            return _super.prototype.schedule.call(this, state, delay);
        }
        this.active = false;
        var action = new VirtualAction(this.scheduler, this.work);
        this.add(action);
        return action.schedule(state, delay);
    };
    VirtualAction.prototype.requestAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        this.delay = scheduler.frame + delay;
        var actions = scheduler.actions;
        actions.push(this);
        actions.sort(VirtualAction.sortActions);
        return true;
    };
    VirtualAction.prototype.recycleAsyncId = function (scheduler, id, delay) {
        if (delay === void 0) {
            delay = 0;
        }
        return undefined;
    };
    VirtualAction.prototype._execute = function (state, delay) {
        if (this.active === true) {
            return _super.prototype._execute.call(this, state, delay);
        }
    };
    VirtualAction.sortActions = function (a, b) {
        if (a.delay === b.delay) {
            if (a.index === b.index) {
                return 0;
            }
            else if (a.index > b.index) {
                return 1;
            }
            else {
                return -1;
            }
        }
        else if (a.delay > b.delay) {
            return 1;
        }
        else {
            return -1;
        }
    };
    return VirtualAction;
}(__WEBPACK_IMPORTED_MODULE_1__AsyncAction__["a" /* AsyncAction */]));

//# sourceMappingURL=VirtualTimeScheduler.js.map


/***/ }),
/* 398 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isObservable;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function isObservable(obj) {
    return !!obj && (obj instanceof __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */] || (typeof obj.lift === 'function' && typeof obj.subscribe === 'function'));
}
//# sourceMappingURL=isObservable.js.map


/***/ }),
/* 399 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return ArgumentOutOfRangeError; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function ArgumentOutOfRangeErrorImpl() {
    Error.call(this);
    this.message = 'argument out of range';
    this.name = 'ArgumentOutOfRangeError';
    return this;
}
ArgumentOutOfRangeErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
var ArgumentOutOfRangeError = ArgumentOutOfRangeErrorImpl;
//# sourceMappingURL=ArgumentOutOfRangeError.js.map


/***/ }),
/* 400 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return EmptyError; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function EmptyErrorImpl() {
    Error.call(this);
    this.message = 'no elements in sequence';
    this.name = 'EmptyError';
    return this;
}
EmptyErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
var EmptyError = EmptyErrorImpl;
//# sourceMappingURL=EmptyError.js.map


/***/ }),
/* 401 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return TimeoutError; });
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function TimeoutErrorImpl() {
    Error.call(this);
    this.message = 'Timeout has occurred';
    this.name = 'TimeoutError';
    return this;
}
TimeoutErrorImpl.prototype = /*@__PURE__*/ Object.create(Error.prototype);
var TimeoutError = TimeoutErrorImpl;
//# sourceMappingURL=TimeoutError.js.map


/***/ }),
/* 402 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = bindCallback;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__ = __webpack_require__(125);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__operators_map__ = __webpack_require__(53);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_canReportError__ = __webpack_require__(118);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__util_isScheduler__ = __webpack_require__(45);
/** PURE_IMPORTS_START _Observable,_AsyncSubject,_operators_map,_util_canReportError,_util_isArray,_util_isScheduler PURE_IMPORTS_END */






function bindCallback(callbackFunc, resultSelector, scheduler) {
    if (resultSelector) {
        if (Object(__WEBPACK_IMPORTED_MODULE_5__util_isScheduler__["a" /* isScheduler */])(resultSelector)) {
            scheduler = resultSelector;
        }
        else {
            return function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return bindCallback(callbackFunc, scheduler).apply(void 0, args).pipe(Object(__WEBPACK_IMPORTED_MODULE_2__operators_map__["a" /* map */])(function (args) { return Object(__WEBPACK_IMPORTED_MODULE_4__util_isArray__["a" /* isArray */])(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
            };
        }
    }
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var context = this;
        var subject;
        var params = {
            context: context,
            subject: subject,
            callbackFunc: callbackFunc,
            scheduler: scheduler,
        };
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
            if (!scheduler) {
                if (!subject) {
                    subject = new __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__["a" /* AsyncSubject */]();
                    var handler = function () {
                        var innerArgs = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            innerArgs[_i] = arguments[_i];
                        }
                        subject.next(innerArgs.length <= 1 ? innerArgs[0] : innerArgs);
                        subject.complete();
                    };
                    try {
                        callbackFunc.apply(context, args.concat([handler]));
                    }
                    catch (err) {
                        if (Object(__WEBPACK_IMPORTED_MODULE_3__util_canReportError__["a" /* canReportError */])(subject)) {
                            subject.error(err);
                        }
                        else {
                            console.warn(err);
                        }
                    }
                }
                return subject.subscribe(subscriber);
            }
            else {
                var state = {
                    args: args, subscriber: subscriber, params: params,
                };
                return scheduler.schedule(dispatch, 0, state);
            }
        });
    };
}
function dispatch(state) {
    var _this = this;
    var self = this;
    var args = state.args, subscriber = state.subscriber, params = state.params;
    var callbackFunc = params.callbackFunc, context = params.context, scheduler = params.scheduler;
    var subject = params.subject;
    if (!subject) {
        subject = params.subject = new __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__["a" /* AsyncSubject */]();
        var handler = function () {
            var innerArgs = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                innerArgs[_i] = arguments[_i];
            }
            var value = innerArgs.length <= 1 ? innerArgs[0] : innerArgs;
            _this.add(scheduler.schedule(dispatchNext, 0, { value: value, subject: subject }));
        };
        try {
            callbackFunc.apply(context, args.concat([handler]));
        }
        catch (err) {
            subject.error(err);
        }
    }
    this.add(subject.subscribe(subscriber));
}
function dispatchNext(state) {
    var value = state.value, subject = state.subject;
    subject.next(value);
    subject.complete();
}
function dispatchError(state) {
    var err = state.err, subject = state.subject;
    subject.error(err);
}
//# sourceMappingURL=bindCallback.js.map


/***/ }),
/* 403 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = bindNodeCallback;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__ = __webpack_require__(125);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__operators_map__ = __webpack_require__(53);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_canReportError__ = __webpack_require__(118);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_isScheduler__ = __webpack_require__(45);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__util_isArray__ = __webpack_require__(28);
/** PURE_IMPORTS_START _Observable,_AsyncSubject,_operators_map,_util_canReportError,_util_isScheduler,_util_isArray PURE_IMPORTS_END */






function bindNodeCallback(callbackFunc, resultSelector, scheduler) {
    if (resultSelector) {
        if (Object(__WEBPACK_IMPORTED_MODULE_4__util_isScheduler__["a" /* isScheduler */])(resultSelector)) {
            scheduler = resultSelector;
        }
        else {
            return function () {
                var args = [];
                for (var _i = 0; _i < arguments.length; _i++) {
                    args[_i] = arguments[_i];
                }
                return bindNodeCallback(callbackFunc, scheduler).apply(void 0, args).pipe(Object(__WEBPACK_IMPORTED_MODULE_2__operators_map__["a" /* map */])(function (args) { return Object(__WEBPACK_IMPORTED_MODULE_5__util_isArray__["a" /* isArray */])(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
            };
        }
    }
    return function () {
        var args = [];
        for (var _i = 0; _i < arguments.length; _i++) {
            args[_i] = arguments[_i];
        }
        var params = {
            subject: undefined,
            args: args,
            callbackFunc: callbackFunc,
            scheduler: scheduler,
            context: this,
        };
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
            var context = params.context;
            var subject = params.subject;
            if (!scheduler) {
                if (!subject) {
                    subject = params.subject = new __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__["a" /* AsyncSubject */]();
                    var handler = function () {
                        var innerArgs = [];
                        for (var _i = 0; _i < arguments.length; _i++) {
                            innerArgs[_i] = arguments[_i];
                        }
                        var err = innerArgs.shift();
                        if (err) {
                            subject.error(err);
                            return;
                        }
                        subject.next(innerArgs.length <= 1 ? innerArgs[0] : innerArgs);
                        subject.complete();
                    };
                    try {
                        callbackFunc.apply(context, args.concat([handler]));
                    }
                    catch (err) {
                        if (Object(__WEBPACK_IMPORTED_MODULE_3__util_canReportError__["a" /* canReportError */])(subject)) {
                            subject.error(err);
                        }
                        else {
                            console.warn(err);
                        }
                    }
                }
                return subject.subscribe(subscriber);
            }
            else {
                return scheduler.schedule(dispatch, 0, { params: params, subscriber: subscriber, context: context });
            }
        });
    };
}
function dispatch(state) {
    var _this = this;
    var params = state.params, subscriber = state.subscriber, context = state.context;
    var callbackFunc = params.callbackFunc, args = params.args, scheduler = params.scheduler;
    var subject = params.subject;
    if (!subject) {
        subject = params.subject = new __WEBPACK_IMPORTED_MODULE_1__AsyncSubject__["a" /* AsyncSubject */]();
        var handler = function () {
            var innerArgs = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                innerArgs[_i] = arguments[_i];
            }
            var err = innerArgs.shift();
            if (err) {
                _this.add(scheduler.schedule(dispatchError, 0, { err: err, subject: subject }));
            }
            else {
                var value = innerArgs.length <= 1 ? innerArgs[0] : innerArgs;
                _this.add(scheduler.schedule(dispatchNext, 0, { value: value, subject: subject }));
            }
        };
        try {
            callbackFunc.apply(context, args.concat([handler]));
        }
        catch (err) {
            this.add(scheduler.schedule(dispatchError, 0, { err: err, subject: subject }));
        }
    }
    this.add(subject.subscribe(subscriber));
}
function dispatchNext(arg) {
    var value = arg.value, subject = arg.subject;
    subject.next(value);
    subject.complete();
}
function dispatchError(arg) {
    var err = arg.err, subject = arg.subject;
    subject.error(err);
}
//# sourceMappingURL=bindNodeCallback.js.map


/***/ }),
/* 404 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = combineLatest;
/* unused harmony export CombineLatestOperator */
/* unused harmony export CombineLatestSubscriber */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isScheduler__ = __webpack_require__(45);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__OuterSubscriber__ = __webpack_require__(89);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_subscribeToResult__ = __webpack_require__(90);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__fromArray__ = __webpack_require__(68);
/** PURE_IMPORTS_START tslib,_util_isScheduler,_util_isArray,_OuterSubscriber,_util_subscribeToResult,_fromArray PURE_IMPORTS_END */






var NONE = {};
function combineLatest() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var resultSelector = null;
    var scheduler = null;
    if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isScheduler__["a" /* isScheduler */])(observables[observables.length - 1])) {
        scheduler = observables.pop();
    }
    if (typeof observables[observables.length - 1] === 'function') {
        resultSelector = observables.pop();
    }
    if (observables.length === 1 && Object(__WEBPACK_IMPORTED_MODULE_2__util_isArray__["a" /* isArray */])(observables[0])) {
        observables = observables[0];
    }
    return Object(__WEBPACK_IMPORTED_MODULE_5__fromArray__["a" /* fromArray */])(observables, scheduler).lift(new CombineLatestOperator(resultSelector));
}
var CombineLatestOperator = /*@__PURE__*/ (function () {
    function CombineLatestOperator(resultSelector) {
        this.resultSelector = resultSelector;
    }
    CombineLatestOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new CombineLatestSubscriber(subscriber, this.resultSelector));
    };
    return CombineLatestOperator;
}());

var CombineLatestSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](CombineLatestSubscriber, _super);
    function CombineLatestSubscriber(destination, resultSelector) {
        var _this = _super.call(this, destination) || this;
        _this.resultSelector = resultSelector;
        _this.active = 0;
        _this.values = [];
        _this.observables = [];
        return _this;
    }
    CombineLatestSubscriber.prototype._next = function (observable) {
        this.values.push(NONE);
        this.observables.push(observable);
    };
    CombineLatestSubscriber.prototype._complete = function () {
        var observables = this.observables;
        var len = observables.length;
        if (len === 0) {
            this.destination.complete();
        }
        else {
            this.active = len;
            this.toRespond = len;
            for (var i = 0; i < len; i++) {
                var observable = observables[i];
                this.add(Object(__WEBPACK_IMPORTED_MODULE_4__util_subscribeToResult__["a" /* subscribeToResult */])(this, observable, observable, i));
            }
        }
    };
    CombineLatestSubscriber.prototype.notifyComplete = function (unused) {
        if ((this.active -= 1) === 0) {
            this.destination.complete();
        }
    };
    CombineLatestSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        var values = this.values;
        var oldVal = values[outerIndex];
        var toRespond = !this.toRespond
            ? 0
            : oldVal === NONE ? --this.toRespond : this.toRespond;
        values[outerIndex] = innerValue;
        if (toRespond === 0) {
            if (this.resultSelector) {
                this._tryResultSelector(values);
            }
            else {
                this.destination.next(values.slice());
            }
        }
    };
    CombineLatestSubscriber.prototype._tryResultSelector = function (values) {
        var result;
        try {
            result = this.resultSelector.apply(this, values);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return CombineLatestSubscriber;
}(__WEBPACK_IMPORTED_MODULE_3__OuterSubscriber__["a" /* OuterSubscriber */]));

//# sourceMappingURL=combineLatest.js.map


/***/ }),
/* 405 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return subscribeToPromise; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__hostReportError__ = __webpack_require__(119);
/** PURE_IMPORTS_START _hostReportError PURE_IMPORTS_END */

var subscribeToPromise = function (promise) {
    return function (subscriber) {
        promise.then(function (value) {
            if (!subscriber.closed) {
                subscriber.next(value);
                subscriber.complete();
            }
        }, function (err) { return subscriber.error(err); })
            .then(null, __WEBPACK_IMPORTED_MODULE_0__hostReportError__["a" /* hostReportError */]);
        return subscriber;
    };
};
//# sourceMappingURL=subscribeToPromise.js.map


/***/ }),
/* 406 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return subscribeToIterable; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__symbol_iterator__ = __webpack_require__(69);
/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */

var subscribeToIterable = function (iterable) {
    return function (subscriber) {
        var iterator = iterable[__WEBPACK_IMPORTED_MODULE_0__symbol_iterator__["a" /* iterator */]]();
        do {
            var item = iterator.next();
            if (item.done) {
                subscriber.complete();
                break;
            }
            subscriber.next(item.value);
            if (subscriber.closed) {
                break;
            }
        } while (true);
        if (typeof iterator.return === 'function') {
            subscriber.add(function () {
                if (iterator.return) {
                    iterator.return();
                }
            });
        }
        return subscriber;
    };
};
//# sourceMappingURL=subscribeToIterable.js.map


/***/ }),
/* 407 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (binding) */ __webpack_require__.d(__webpack_exports__, "a", function() { return subscribeToObservable; });
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__symbol_observable__ = __webpack_require__(51);
/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */

var subscribeToObservable = function (obj) {
    return function (subscriber) {
        var obs = obj[__WEBPACK_IMPORTED_MODULE_0__symbol_observable__["a" /* observable */]]();
        if (typeof obs.subscribe !== 'function') {
            throw new TypeError('Provided object does not correctly implement Symbol.observable');
        }
        else {
            return obs.subscribe(subscriber);
        }
    };
};
//# sourceMappingURL=subscribeToObservable.js.map


/***/ }),
/* 408 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = concat;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__of__ = __webpack_require__(123);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__operators_concatAll__ = __webpack_require__(409);
/** PURE_IMPORTS_START _of,_operators_concatAll PURE_IMPORTS_END */


function concat() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    return Object(__WEBPACK_IMPORTED_MODULE_1__operators_concatAll__["a" /* concatAll */])()(__WEBPACK_IMPORTED_MODULE_0__of__["a" /* of */].apply(void 0, observables));
}
//# sourceMappingURL=concat.js.map


/***/ }),
/* 409 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = concatAll;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__mergeAll__ = __webpack_require__(186);
/** PURE_IMPORTS_START _mergeAll PURE_IMPORTS_END */

function concatAll() {
    return Object(__WEBPACK_IMPORTED_MODULE_0__mergeAll__["a" /* mergeAll */])(1);
}
//# sourceMappingURL=concatAll.js.map


/***/ }),
/* 410 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = mergeMap;
/* unused harmony export MergeMapOperator */
/* unused harmony export MergeMapSubscriber */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_subscribeToResult__ = __webpack_require__(90);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__OuterSubscriber__ = __webpack_require__(89);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__InnerSubscriber__ = __webpack_require__(183);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__map__ = __webpack_require__(53);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__observable_from__ = __webpack_require__(54);
/** PURE_IMPORTS_START tslib,_util_subscribeToResult,_OuterSubscriber,_InnerSubscriber,_map,_observable_from PURE_IMPORTS_END */






function mergeMap(project, resultSelector, concurrent) {
    if (concurrent === void 0) {
        concurrent = Number.POSITIVE_INFINITY;
    }
    if (typeof resultSelector === 'function') {
        return function (source) { return source.pipe(mergeMap(function (a, i) { return Object(__WEBPACK_IMPORTED_MODULE_5__observable_from__["a" /* from */])(project(a, i)).pipe(Object(__WEBPACK_IMPORTED_MODULE_4__map__["a" /* map */])(function (b, ii) { return resultSelector(a, b, i, ii); })); }, concurrent)); };
    }
    else if (typeof resultSelector === 'number') {
        concurrent = resultSelector;
    }
    return function (source) { return source.lift(new MergeMapOperator(project, concurrent)); };
}
var MergeMapOperator = /*@__PURE__*/ (function () {
    function MergeMapOperator(project, concurrent) {
        if (concurrent === void 0) {
            concurrent = Number.POSITIVE_INFINITY;
        }
        this.project = project;
        this.concurrent = concurrent;
    }
    MergeMapOperator.prototype.call = function (observer, source) {
        return source.subscribe(new MergeMapSubscriber(observer, this.project, this.concurrent));
    };
    return MergeMapOperator;
}());

var MergeMapSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](MergeMapSubscriber, _super);
    function MergeMapSubscriber(destination, project, concurrent) {
        if (concurrent === void 0) {
            concurrent = Number.POSITIVE_INFINITY;
        }
        var _this = _super.call(this, destination) || this;
        _this.project = project;
        _this.concurrent = concurrent;
        _this.hasCompleted = false;
        _this.buffer = [];
        _this.active = 0;
        _this.index = 0;
        return _this;
    }
    MergeMapSubscriber.prototype._next = function (value) {
        if (this.active < this.concurrent) {
            this._tryNext(value);
        }
        else {
            this.buffer.push(value);
        }
    };
    MergeMapSubscriber.prototype._tryNext = function (value) {
        var result;
        var index = this.index++;
        try {
            result = this.project(value, index);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.active++;
        this._innerSub(result, value, index);
    };
    MergeMapSubscriber.prototype._innerSub = function (ish, value, index) {
        var innerSubscriber = new __WEBPACK_IMPORTED_MODULE_3__InnerSubscriber__["a" /* InnerSubscriber */](this, undefined, undefined);
        var destination = this.destination;
        destination.add(innerSubscriber);
        Object(__WEBPACK_IMPORTED_MODULE_1__util_subscribeToResult__["a" /* subscribeToResult */])(this, ish, value, index, innerSubscriber);
    };
    MergeMapSubscriber.prototype._complete = function () {
        this.hasCompleted = true;
        if (this.active === 0 && this.buffer.length === 0) {
            this.destination.complete();
        }
        this.unsubscribe();
    };
    MergeMapSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.destination.next(innerValue);
    };
    MergeMapSubscriber.prototype.notifyComplete = function (innerSub) {
        var buffer = this.buffer;
        this.remove(innerSub);
        this.active--;
        if (buffer.length > 0) {
            this._next(buffer.shift());
        }
        else if (this.active === 0 && this.hasCompleted) {
            this.destination.complete();
        }
    };
    return MergeMapSubscriber;
}(__WEBPACK_IMPORTED_MODULE_2__OuterSubscriber__["a" /* OuterSubscriber */]));

//# sourceMappingURL=mergeMap.js.map


/***/ }),
/* 411 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = scheduleObservable;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__symbol_observable__ = __webpack_require__(51);
/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_observable PURE_IMPORTS_END */



function scheduleObservable(input, scheduler) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var sub = new __WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]();
        sub.add(scheduler.schedule(function () {
            var observable = input[__WEBPACK_IMPORTED_MODULE_2__symbol_observable__["a" /* observable */]]();
            sub.add(observable.subscribe({
                next: function (value) { sub.add(scheduler.schedule(function () { return subscriber.next(value); })); },
                error: function (err) { sub.add(scheduler.schedule(function () { return subscriber.error(err); })); },
                complete: function () { sub.add(scheduler.schedule(function () { return subscriber.complete(); })); },
            }));
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleObservable.js.map


/***/ }),
/* 412 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = schedulePromise;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function schedulePromise(input, scheduler) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var sub = new __WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]();
        sub.add(scheduler.schedule(function () {
            return input.then(function (value) {
                sub.add(scheduler.schedule(function () {
                    subscriber.next(value);
                    sub.add(scheduler.schedule(function () { return subscriber.complete(); }));
                }));
            }, function (err) {
                sub.add(scheduler.schedule(function () { return subscriber.error(err); }));
            });
        }));
        return sub;
    });
}
//# sourceMappingURL=schedulePromise.js.map


/***/ }),
/* 413 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = scheduleIterable;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__symbol_iterator__ = __webpack_require__(69);
/** PURE_IMPORTS_START _Observable,_Subscription,_symbol_iterator PURE_IMPORTS_END */



function scheduleIterable(input, scheduler) {
    if (!input) {
        throw new Error('Iterable cannot be null');
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var sub = new __WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]();
        var iterator;
        sub.add(function () {
            if (iterator && typeof iterator.return === 'function') {
                iterator.return();
            }
        });
        sub.add(scheduler.schedule(function () {
            iterator = input[__WEBPACK_IMPORTED_MODULE_2__symbol_iterator__["a" /* iterator */]]();
            sub.add(scheduler.schedule(function () {
                if (subscriber.closed) {
                    return;
                }
                var value;
                var done;
                try {
                    var result = iterator.next();
                    value = result.value;
                    done = result.done;
                }
                catch (err) {
                    subscriber.error(err);
                    return;
                }
                if (done) {
                    subscriber.complete();
                }
                else {
                    subscriber.next(value);
                    this.schedule();
                }
            }));
        }));
        return sub;
    });
}
//# sourceMappingURL=scheduleIterable.js.map


/***/ }),
/* 414 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isInteropObservable;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__symbol_observable__ = __webpack_require__(51);
/** PURE_IMPORTS_START _symbol_observable PURE_IMPORTS_END */

function isInteropObservable(input) {
    return input && typeof input[__WEBPACK_IMPORTED_MODULE_0__symbol_observable__["a" /* observable */]] === 'function';
}
//# sourceMappingURL=isInteropObservable.js.map


/***/ }),
/* 415 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = isIterable;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__symbol_iterator__ = __webpack_require__(69);
/** PURE_IMPORTS_START _symbol_iterator PURE_IMPORTS_END */

function isIterable(input) {
    return input && typeof input[__WEBPACK_IMPORTED_MODULE_0__symbol_iterator__["a" /* iterator */]] === 'function';
}
//# sourceMappingURL=isIterable.js.map


/***/ }),
/* 416 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = forkJoin;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__operators_map__ = __webpack_require__(53);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_isObject__ = __webpack_require__(120);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__from__ = __webpack_require__(54);
/** PURE_IMPORTS_START _Observable,_util_isArray,_operators_map,_util_isObject,_from PURE_IMPORTS_END */





function forkJoin() {
    var sources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        sources[_i] = arguments[_i];
    }
    if (sources.length === 1) {
        var first_1 = sources[0];
        if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isArray__["a" /* isArray */])(first_1)) {
            return forkJoinInternal(first_1, null);
        }
        if (Object(__WEBPACK_IMPORTED_MODULE_3__util_isObject__["a" /* isObject */])(first_1) && Object.getPrototypeOf(first_1) === Object.prototype) {
            var keys = Object.keys(first_1);
            return forkJoinInternal(keys.map(function (key) { return first_1[key]; }), keys);
        }
    }
    if (typeof sources[sources.length - 1] === 'function') {
        var resultSelector_1 = sources.pop();
        sources = (sources.length === 1 && Object(__WEBPACK_IMPORTED_MODULE_1__util_isArray__["a" /* isArray */])(sources[0])) ? sources[0] : sources;
        return forkJoinInternal(sources, null).pipe(Object(__WEBPACK_IMPORTED_MODULE_2__operators_map__["a" /* map */])(function (args) { return resultSelector_1.apply(void 0, args); }));
    }
    return forkJoinInternal(sources, null);
}
function forkJoinInternal(sources, keys) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var len = sources.length;
        if (len === 0) {
            subscriber.complete();
            return;
        }
        var values = new Array(len);
        var completed = 0;
        var emitted = 0;
        var _loop_1 = function (i) {
            var source = Object(__WEBPACK_IMPORTED_MODULE_4__from__["a" /* from */])(sources[i]);
            var hasValue = false;
            subscriber.add(source.subscribe({
                next: function (value) {
                    if (!hasValue) {
                        hasValue = true;
                        emitted++;
                    }
                    values[i] = value;
                },
                error: function (err) { return subscriber.error(err); },
                complete: function () {
                    completed++;
                    if (completed === len || !hasValue) {
                        if (emitted === len) {
                            subscriber.next(keys ?
                                keys.reduce(function (result, key, i) { return (result[key] = values[i], result); }, {}) :
                                values);
                        }
                        subscriber.complete();
                    }
                }
            }));
        };
        for (var i = 0; i < len; i++) {
            _loop_1(i);
        }
    });
}
//# sourceMappingURL=forkJoin.js.map


/***/ }),
/* 417 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = fromEvent;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isFunction__ = __webpack_require__(86);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__operators_map__ = __webpack_require__(53);
/** PURE_IMPORTS_START _Observable,_util_isArray,_util_isFunction,_operators_map PURE_IMPORTS_END */




var toString = Object.prototype.toString;
function fromEvent(target, eventName, options, resultSelector) {
    if (Object(__WEBPACK_IMPORTED_MODULE_2__util_isFunction__["a" /* isFunction */])(options)) {
        resultSelector = options;
        options = undefined;
    }
    if (resultSelector) {
        return fromEvent(target, eventName, options).pipe(Object(__WEBPACK_IMPORTED_MODULE_3__operators_map__["a" /* map */])(function (args) { return Object(__WEBPACK_IMPORTED_MODULE_1__util_isArray__["a" /* isArray */])(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        function handler(e) {
            if (arguments.length > 1) {
                subscriber.next(Array.prototype.slice.call(arguments));
            }
            else {
                subscriber.next(e);
            }
        }
        setupSubscription(target, eventName, handler, subscriber, options);
    });
}
function setupSubscription(sourceObj, eventName, handler, subscriber, options) {
    var unsubscribe;
    if (isEventTarget(sourceObj)) {
        var source_1 = sourceObj;
        sourceObj.addEventListener(eventName, handler, options);
        unsubscribe = function () { return source_1.removeEventListener(eventName, handler, options); };
    }
    else if (isJQueryStyleEventEmitter(sourceObj)) {
        var source_2 = sourceObj;
        sourceObj.on(eventName, handler);
        unsubscribe = function () { return source_2.off(eventName, handler); };
    }
    else if (isNodeStyleEventEmitter(sourceObj)) {
        var source_3 = sourceObj;
        sourceObj.addListener(eventName, handler);
        unsubscribe = function () { return source_3.removeListener(eventName, handler); };
    }
    else if (sourceObj && sourceObj.length) {
        for (var i = 0, len = sourceObj.length; i < len; i++) {
            setupSubscription(sourceObj[i], eventName, handler, subscriber, options);
        }
    }
    else {
        throw new TypeError('Invalid event target');
    }
    subscriber.add(unsubscribe);
}
function isNodeStyleEventEmitter(sourceObj) {
    return sourceObj && typeof sourceObj.addListener === 'function' && typeof sourceObj.removeListener === 'function';
}
function isJQueryStyleEventEmitter(sourceObj) {
    return sourceObj && typeof sourceObj.on === 'function' && typeof sourceObj.off === 'function';
}
function isEventTarget(sourceObj) {
    return sourceObj && typeof sourceObj.addEventListener === 'function' && typeof sourceObj.removeEventListener === 'function';
}
//# sourceMappingURL=fromEvent.js.map


/***/ }),
/* 418 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = fromEventPattern;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isFunction__ = __webpack_require__(86);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__operators_map__ = __webpack_require__(53);
/** PURE_IMPORTS_START _Observable,_util_isArray,_util_isFunction,_operators_map PURE_IMPORTS_END */




function fromEventPattern(addHandler, removeHandler, resultSelector) {
    if (resultSelector) {
        return fromEventPattern(addHandler, removeHandler).pipe(Object(__WEBPACK_IMPORTED_MODULE_3__operators_map__["a" /* map */])(function (args) { return Object(__WEBPACK_IMPORTED_MODULE_1__util_isArray__["a" /* isArray */])(args) ? resultSelector.apply(void 0, args) : resultSelector(args); }));
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var handler = function () {
            var e = [];
            for (var _i = 0; _i < arguments.length; _i++) {
                e[_i] = arguments[_i];
            }
            return subscriber.next(e.length === 1 ? e[0] : e);
        };
        var retValue;
        try {
            retValue = addHandler(handler);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        if (!Object(__WEBPACK_IMPORTED_MODULE_2__util_isFunction__["a" /* isFunction */])(removeHandler)) {
            return undefined;
        }
        return function () { return removeHandler(handler, retValue); };
    });
}
//# sourceMappingURL=fromEventPattern.js.map


/***/ }),
/* 419 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = generate;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_identity__ = __webpack_require__(127);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isScheduler__ = __webpack_require__(45);
/** PURE_IMPORTS_START _Observable,_util_identity,_util_isScheduler PURE_IMPORTS_END */



function generate(initialStateOrOptions, condition, iterate, resultSelectorOrObservable, scheduler) {
    var resultSelector;
    var initialState;
    if (arguments.length == 1) {
        var options = initialStateOrOptions;
        initialState = options.initialState;
        condition = options.condition;
        iterate = options.iterate;
        resultSelector = options.resultSelector || __WEBPACK_IMPORTED_MODULE_1__util_identity__["a" /* identity */];
        scheduler = options.scheduler;
    }
    else if (resultSelectorOrObservable === undefined || Object(__WEBPACK_IMPORTED_MODULE_2__util_isScheduler__["a" /* isScheduler */])(resultSelectorOrObservable)) {
        initialState = initialStateOrOptions;
        resultSelector = __WEBPACK_IMPORTED_MODULE_1__util_identity__["a" /* identity */];
        scheduler = resultSelectorOrObservable;
    }
    else {
        initialState = initialStateOrOptions;
        resultSelector = resultSelectorOrObservable;
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var state = initialState;
        if (scheduler) {
            return scheduler.schedule(dispatch, 0, {
                subscriber: subscriber,
                iterate: iterate,
                condition: condition,
                resultSelector: resultSelector,
                state: state
            });
        }
        do {
            if (condition) {
                var conditionResult = void 0;
                try {
                    conditionResult = condition(state);
                }
                catch (err) {
                    subscriber.error(err);
                    return undefined;
                }
                if (!conditionResult) {
                    subscriber.complete();
                    break;
                }
            }
            var value = void 0;
            try {
                value = resultSelector(state);
            }
            catch (err) {
                subscriber.error(err);
                return undefined;
            }
            subscriber.next(value);
            if (subscriber.closed) {
                break;
            }
            try {
                state = iterate(state);
            }
            catch (err) {
                subscriber.error(err);
                return undefined;
            }
        } while (true);
        return undefined;
    });
}
function dispatch(state) {
    var subscriber = state.subscriber, condition = state.condition;
    if (subscriber.closed) {
        return undefined;
    }
    if (state.needIterate) {
        try {
            state.state = state.iterate(state.state);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
    }
    else {
        state.needIterate = true;
    }
    if (condition) {
        var conditionResult = void 0;
        try {
            conditionResult = condition(state.state);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        if (!conditionResult) {
            subscriber.complete();
            return undefined;
        }
        if (subscriber.closed) {
            return undefined;
        }
    }
    var value;
    try {
        value = state.resultSelector(state.state);
    }
    catch (err) {
        subscriber.error(err);
        return undefined;
    }
    if (subscriber.closed) {
        return undefined;
    }
    subscriber.next(value);
    if (subscriber.closed) {
        return undefined;
    }
    return this.schedule(state);
}
//# sourceMappingURL=generate.js.map


/***/ }),
/* 420 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = iif;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__defer__ = __webpack_require__(188);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__empty__ = __webpack_require__(44);
/** PURE_IMPORTS_START _defer,_empty PURE_IMPORTS_END */


function iif(condition, trueResult, falseResult) {
    if (trueResult === void 0) {
        trueResult = __WEBPACK_IMPORTED_MODULE_1__empty__["a" /* EMPTY */];
    }
    if (falseResult === void 0) {
        falseResult = __WEBPACK_IMPORTED_MODULE_1__empty__["a" /* EMPTY */];
    }
    return Object(__WEBPACK_IMPORTED_MODULE_0__defer__["a" /* defer */])(function () { return condition() ? trueResult : falseResult; });
}
//# sourceMappingURL=iif.js.map


/***/ }),
/* 421 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = interval;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__scheduler_async__ = __webpack_require__(126);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isNumeric__ = __webpack_require__(189);
/** PURE_IMPORTS_START _Observable,_scheduler_async,_util_isNumeric PURE_IMPORTS_END */



function interval(period, scheduler) {
    if (period === void 0) {
        period = 0;
    }
    if (scheduler === void 0) {
        scheduler = __WEBPACK_IMPORTED_MODULE_1__scheduler_async__["a" /* async */];
    }
    if (!Object(__WEBPACK_IMPORTED_MODULE_2__util_isNumeric__["a" /* isNumeric */])(period) || period < 0) {
        period = 0;
    }
    if (!scheduler || typeof scheduler.schedule !== 'function') {
        scheduler = __WEBPACK_IMPORTED_MODULE_1__scheduler_async__["a" /* async */];
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        subscriber.add(scheduler.schedule(dispatch, period, { subscriber: subscriber, counter: 0, period: period }));
        return subscriber;
    });
}
function dispatch(state) {
    var subscriber = state.subscriber, counter = state.counter, period = state.period;
    subscriber.next(counter);
    this.schedule({ subscriber: subscriber, counter: counter + 1, period: period }, period);
}
//# sourceMappingURL=interval.js.map


/***/ }),
/* 422 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = merge;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isScheduler__ = __webpack_require__(45);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__operators_mergeAll__ = __webpack_require__(186);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__fromArray__ = __webpack_require__(68);
/** PURE_IMPORTS_START _Observable,_util_isScheduler,_operators_mergeAll,_fromArray PURE_IMPORTS_END */




function merge() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var concurrent = Number.POSITIVE_INFINITY;
    var scheduler = null;
    var last = observables[observables.length - 1];
    if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isScheduler__["a" /* isScheduler */])(last)) {
        scheduler = observables.pop();
        if (observables.length > 1 && typeof observables[observables.length - 1] === 'number') {
            concurrent = observables.pop();
        }
    }
    else if (typeof last === 'number') {
        concurrent = observables.pop();
    }
    if (scheduler === null && observables.length === 1 && observables[0] instanceof __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */]) {
        return observables[0];
    }
    return Object(__WEBPACK_IMPORTED_MODULE_2__operators_mergeAll__["a" /* mergeAll */])(concurrent)(Object(__WEBPACK_IMPORTED_MODULE_3__fromArray__["a" /* fromArray */])(observables, scheduler));
}
//# sourceMappingURL=merge.js.map


/***/ }),
/* 423 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = onErrorResumeNext;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__from__ = __webpack_require__(54);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__empty__ = __webpack_require__(44);
/** PURE_IMPORTS_START _Observable,_from,_util_isArray,_empty PURE_IMPORTS_END */




function onErrorResumeNext() {
    var sources = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        sources[_i] = arguments[_i];
    }
    if (sources.length === 0) {
        return __WEBPACK_IMPORTED_MODULE_3__empty__["a" /* EMPTY */];
    }
    var first = sources[0], remainder = sources.slice(1);
    if (sources.length === 1 && Object(__WEBPACK_IMPORTED_MODULE_2__util_isArray__["a" /* isArray */])(first)) {
        return onErrorResumeNext.apply(void 0, first);
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var subNext = function () { return subscriber.add(onErrorResumeNext.apply(void 0, remainder).subscribe(subscriber)); };
        return Object(__WEBPACK_IMPORTED_MODULE_1__from__["a" /* from */])(first).subscribe({
            next: function (value) { subscriber.next(value); },
            error: subNext,
            complete: subNext,
        });
    });
}
//# sourceMappingURL=onErrorResumeNext.js.map


/***/ }),
/* 424 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = pairs;
/* unused harmony export dispatch */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscription__ = __webpack_require__(22);
/** PURE_IMPORTS_START _Observable,_Subscription PURE_IMPORTS_END */


function pairs(obj, scheduler) {
    if (!scheduler) {
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
            var keys = Object.keys(obj);
            for (var i = 0; i < keys.length && !subscriber.closed; i++) {
                var key = keys[i];
                if (obj.hasOwnProperty(key)) {
                    subscriber.next([key, obj[key]]);
                }
            }
            subscriber.complete();
        });
    }
    else {
        return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
            var keys = Object.keys(obj);
            var subscription = new __WEBPACK_IMPORTED_MODULE_1__Subscription__["a" /* Subscription */]();
            subscription.add(scheduler.schedule(dispatch, 0, { keys: keys, index: 0, subscriber: subscriber, subscription: subscription, obj: obj }));
            return subscription;
        });
    }
}
function dispatch(state) {
    var keys = state.keys, index = state.index, subscriber = state.subscriber, subscription = state.subscription, obj = state.obj;
    if (!subscriber.closed) {
        if (index < keys.length) {
            var key = keys[index];
            subscriber.next([key, obj[key]]);
            subscription.add(this.schedule({ keys: keys, index: index + 1, subscriber: subscriber, subscription: subscription, obj: obj }));
        }
        else {
            subscriber.complete();
        }
    }
}
//# sourceMappingURL=pairs.js.map


/***/ }),
/* 425 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = partition;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__util_not__ = __webpack_require__(426);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_subscribeTo__ = __webpack_require__(128);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__operators_filter__ = __webpack_require__(427);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _util_not,_util_subscribeTo,_operators_filter,_Observable PURE_IMPORTS_END */




function partition(source, predicate, thisArg) {
    return [
        Object(__WEBPACK_IMPORTED_MODULE_2__operators_filter__["a" /* filter */])(predicate, thisArg)(new __WEBPACK_IMPORTED_MODULE_3__Observable__["a" /* Observable */](Object(__WEBPACK_IMPORTED_MODULE_1__util_subscribeTo__["a" /* subscribeTo */])(source))),
        Object(__WEBPACK_IMPORTED_MODULE_2__operators_filter__["a" /* filter */])(Object(__WEBPACK_IMPORTED_MODULE_0__util_not__["a" /* not */])(predicate, thisArg))(new __WEBPACK_IMPORTED_MODULE_3__Observable__["a" /* Observable */](Object(__WEBPACK_IMPORTED_MODULE_1__util_subscribeTo__["a" /* subscribeTo */])(source)))
    ];
}
//# sourceMappingURL=partition.js.map


/***/ }),
/* 426 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = not;
/** PURE_IMPORTS_START  PURE_IMPORTS_END */
function not(pred, thisArg) {
    function notPred() {
        return !(notPred.pred.apply(notPred.thisArg, arguments));
    }
    notPred.pred = pred;
    notPred.thisArg = thisArg;
    return notPred;
}
//# sourceMappingURL=not.js.map


/***/ }),
/* 427 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = filter;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__Subscriber__ = __webpack_require__(24);
/** PURE_IMPORTS_START tslib,_Subscriber PURE_IMPORTS_END */


function filter(predicate, thisArg) {
    return function filterOperatorFunction(source) {
        return source.lift(new FilterOperator(predicate, thisArg));
    };
}
var FilterOperator = /*@__PURE__*/ (function () {
    function FilterOperator(predicate, thisArg) {
        this.predicate = predicate;
        this.thisArg = thisArg;
    }
    FilterOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new FilterSubscriber(subscriber, this.predicate, this.thisArg));
    };
    return FilterOperator;
}());
var FilterSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](FilterSubscriber, _super);
    function FilterSubscriber(destination, predicate, thisArg) {
        var _this = _super.call(this, destination) || this;
        _this.predicate = predicate;
        _this.thisArg = thisArg;
        _this.count = 0;
        return _this;
    }
    FilterSubscriber.prototype._next = function (value) {
        var result;
        try {
            result = this.predicate.call(this.thisArg, value, this.count++);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        if (result) {
            this.destination.next(value);
        }
    };
    return FilterSubscriber;
}(__WEBPACK_IMPORTED_MODULE_1__Subscriber__["a" /* Subscriber */]));
//# sourceMappingURL=filter.js.map


/***/ }),
/* 428 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = race;
/* unused harmony export RaceOperator */
/* unused harmony export RaceSubscriber */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__fromArray__ = __webpack_require__(68);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__OuterSubscriber__ = __webpack_require__(89);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__util_subscribeToResult__ = __webpack_require__(90);
/** PURE_IMPORTS_START tslib,_util_isArray,_fromArray,_OuterSubscriber,_util_subscribeToResult PURE_IMPORTS_END */





function race() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    if (observables.length === 1) {
        if (Object(__WEBPACK_IMPORTED_MODULE_1__util_isArray__["a" /* isArray */])(observables[0])) {
            observables = observables[0];
        }
        else {
            return observables[0];
        }
    }
    return Object(__WEBPACK_IMPORTED_MODULE_2__fromArray__["a" /* fromArray */])(observables, undefined).lift(new RaceOperator());
}
var RaceOperator = /*@__PURE__*/ (function () {
    function RaceOperator() {
    }
    RaceOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new RaceSubscriber(subscriber));
    };
    return RaceOperator;
}());

var RaceSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](RaceSubscriber, _super);
    function RaceSubscriber(destination) {
        var _this = _super.call(this, destination) || this;
        _this.hasFirst = false;
        _this.observables = [];
        _this.subscriptions = [];
        return _this;
    }
    RaceSubscriber.prototype._next = function (observable) {
        this.observables.push(observable);
    };
    RaceSubscriber.prototype._complete = function () {
        var observables = this.observables;
        var len = observables.length;
        if (len === 0) {
            this.destination.complete();
        }
        else {
            for (var i = 0; i < len && !this.hasFirst; i++) {
                var observable = observables[i];
                var subscription = Object(__WEBPACK_IMPORTED_MODULE_4__util_subscribeToResult__["a" /* subscribeToResult */])(this, observable, observable, i);
                if (this.subscriptions) {
                    this.subscriptions.push(subscription);
                }
                this.add(subscription);
            }
            this.observables = null;
        }
    };
    RaceSubscriber.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        if (!this.hasFirst) {
            this.hasFirst = true;
            for (var i = 0; i < this.subscriptions.length; i++) {
                if (i !== outerIndex) {
                    var subscription = this.subscriptions[i];
                    subscription.unsubscribe();
                    this.remove(subscription);
                }
            }
            this.subscriptions = null;
        }
        this.destination.next(innerValue);
    };
    return RaceSubscriber;
}(__WEBPACK_IMPORTED_MODULE_3__OuterSubscriber__["a" /* OuterSubscriber */]));

//# sourceMappingURL=race.js.map


/***/ }),
/* 429 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = range;
/* unused harmony export dispatch */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/** PURE_IMPORTS_START _Observable PURE_IMPORTS_END */

function range(start, count, scheduler) {
    if (start === void 0) {
        start = 0;
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        if (count === undefined) {
            count = start;
            start = 0;
        }
        var index = 0;
        var current = start;
        if (scheduler) {
            return scheduler.schedule(dispatch, 0, {
                index: index, count: count, start: start, subscriber: subscriber
            });
        }
        else {
            do {
                if (index++ >= count) {
                    subscriber.complete();
                    break;
                }
                subscriber.next(current++);
                if (subscriber.closed) {
                    break;
                }
            } while (true);
        }
        return undefined;
    });
}
function dispatch(state) {
    var start = state.start, index = state.index, count = state.count, subscriber = state.subscriber;
    if (index >= count) {
        subscriber.complete();
        return;
    }
    subscriber.next(start);
    if (subscriber.closed) {
        return;
    }
    state.index = index + 1;
    state.start = start + 1;
    this.schedule(state);
}
//# sourceMappingURL=range.js.map


/***/ }),
/* 430 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = timer;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__scheduler_async__ = __webpack_require__(126);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isNumeric__ = __webpack_require__(189);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__util_isScheduler__ = __webpack_require__(45);
/** PURE_IMPORTS_START _Observable,_scheduler_async,_util_isNumeric,_util_isScheduler PURE_IMPORTS_END */




function timer(dueTime, periodOrScheduler, scheduler) {
    if (dueTime === void 0) {
        dueTime = 0;
    }
    var period = -1;
    if (Object(__WEBPACK_IMPORTED_MODULE_2__util_isNumeric__["a" /* isNumeric */])(periodOrScheduler)) {
        period = Number(periodOrScheduler) < 1 && 1 || Number(periodOrScheduler);
    }
    else if (Object(__WEBPACK_IMPORTED_MODULE_3__util_isScheduler__["a" /* isScheduler */])(periodOrScheduler)) {
        scheduler = periodOrScheduler;
    }
    if (!Object(__WEBPACK_IMPORTED_MODULE_3__util_isScheduler__["a" /* isScheduler */])(scheduler)) {
        scheduler = __WEBPACK_IMPORTED_MODULE_1__scheduler_async__["a" /* async */];
    }
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var due = Object(__WEBPACK_IMPORTED_MODULE_2__util_isNumeric__["a" /* isNumeric */])(dueTime)
            ? dueTime
            : (+dueTime - scheduler.now());
        return scheduler.schedule(dispatch, due, {
            index: 0, period: period, subscriber: subscriber
        });
    });
}
function dispatch(state) {
    var index = state.index, period = state.period, subscriber = state.subscriber;
    subscriber.next(index);
    if (subscriber.closed) {
        return;
    }
    else if (period === -1) {
        return subscriber.complete();
    }
    state.index = index + 1;
    this.schedule(state, period);
}
//# sourceMappingURL=timer.js.map


/***/ }),
/* 431 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = using;
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0__Observable__ = __webpack_require__(12);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__from__ = __webpack_require__(54);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__empty__ = __webpack_require__(44);
/** PURE_IMPORTS_START _Observable,_from,_empty PURE_IMPORTS_END */



function using(resourceFactory, observableFactory) {
    return new __WEBPACK_IMPORTED_MODULE_0__Observable__["a" /* Observable */](function (subscriber) {
        var resource;
        try {
            resource = resourceFactory();
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var result;
        try {
            result = observableFactory(resource);
        }
        catch (err) {
            subscriber.error(err);
            return undefined;
        }
        var source = result ? Object(__WEBPACK_IMPORTED_MODULE_1__from__["a" /* from */])(result) : __WEBPACK_IMPORTED_MODULE_2__empty__["a" /* EMPTY */];
        var subscription = source.subscribe(subscriber);
        return function () {
            subscription.unsubscribe();
            if (resource) {
                resource.unsubscribe();
            }
        };
    });
}
//# sourceMappingURL=using.js.map


/***/ }),
/* 432 */
/***/ (function(module, __webpack_exports__, __webpack_require__) {

"use strict";
/* harmony export (immutable) */ __webpack_exports__["a"] = zip;
/* unused harmony export ZipOperator */
/* unused harmony export ZipSubscriber */
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_0_tslib__ = __webpack_require__(13);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_1__fromArray__ = __webpack_require__(68);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_2__util_isArray__ = __webpack_require__(28);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_3__Subscriber__ = __webpack_require__(24);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_4__OuterSubscriber__ = __webpack_require__(89);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_5__util_subscribeToResult__ = __webpack_require__(90);
/* harmony import */ var __WEBPACK_IMPORTED_MODULE_6__internal_symbol_iterator__ = __webpack_require__(69);
/** PURE_IMPORTS_START tslib,_fromArray,_util_isArray,_Subscriber,_OuterSubscriber,_util_subscribeToResult,_.._internal_symbol_iterator PURE_IMPORTS_END */







function zip() {
    var observables = [];
    for (var _i = 0; _i < arguments.length; _i++) {
        observables[_i] = arguments[_i];
    }
    var resultSelector = observables[observables.length - 1];
    if (typeof resultSelector === 'function') {
        observables.pop();
    }
    return Object(__WEBPACK_IMPORTED_MODULE_1__fromArray__["a" /* fromArray */])(observables, undefined).lift(new ZipOperator(resultSelector));
}
var ZipOperator = /*@__PURE__*/ (function () {
    function ZipOperator(resultSelector) {
        this.resultSelector = resultSelector;
    }
    ZipOperator.prototype.call = function (subscriber, source) {
        return source.subscribe(new ZipSubscriber(subscriber, this.resultSelector));
    };
    return ZipOperator;
}());

var ZipSubscriber = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ZipSubscriber, _super);
    function ZipSubscriber(destination, resultSelector, values) {
        if (values === void 0) {
            values = Object.create(null);
        }
        var _this = _super.call(this, destination) || this;
        _this.iterators = [];
        _this.active = 0;
        _this.resultSelector = (typeof resultSelector === 'function') ? resultSelector : null;
        _this.values = values;
        return _this;
    }
    ZipSubscriber.prototype._next = function (value) {
        var iterators = this.iterators;
        if (Object(__WEBPACK_IMPORTED_MODULE_2__util_isArray__["a" /* isArray */])(value)) {
            iterators.push(new StaticArrayIterator(value));
        }
        else if (typeof value[__WEBPACK_IMPORTED_MODULE_6__internal_symbol_iterator__["a" /* iterator */]] === 'function') {
            iterators.push(new StaticIterator(value[__WEBPACK_IMPORTED_MODULE_6__internal_symbol_iterator__["a" /* iterator */]]()));
        }
        else {
            iterators.push(new ZipBufferIterator(this.destination, this, value));
        }
    };
    ZipSubscriber.prototype._complete = function () {
        var iterators = this.iterators;
        var len = iterators.length;
        this.unsubscribe();
        if (len === 0) {
            this.destination.complete();
            return;
        }
        this.active = len;
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            if (iterator.stillUnsubscribed) {
                var destination = this.destination;
                destination.add(iterator.subscribe(iterator, i));
            }
            else {
                this.active--;
            }
        }
    };
    ZipSubscriber.prototype.notifyInactive = function () {
        this.active--;
        if (this.active === 0) {
            this.destination.complete();
        }
    };
    ZipSubscriber.prototype.checkIterators = function () {
        var iterators = this.iterators;
        var len = iterators.length;
        var destination = this.destination;
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            if (typeof iterator.hasValue === 'function' && !iterator.hasValue()) {
                return;
            }
        }
        var shouldComplete = false;
        var args = [];
        for (var i = 0; i < len; i++) {
            var iterator = iterators[i];
            var result = iterator.next();
            if (iterator.hasCompleted()) {
                shouldComplete = true;
            }
            if (result.done) {
                destination.complete();
                return;
            }
            args.push(result.value);
        }
        if (this.resultSelector) {
            this._tryresultSelector(args);
        }
        else {
            destination.next(args);
        }
        if (shouldComplete) {
            destination.complete();
        }
    };
    ZipSubscriber.prototype._tryresultSelector = function (args) {
        var result;
        try {
            result = this.resultSelector.apply(this, args);
        }
        catch (err) {
            this.destination.error(err);
            return;
        }
        this.destination.next(result);
    };
    return ZipSubscriber;
}(__WEBPACK_IMPORTED_MODULE_3__Subscriber__["a" /* Subscriber */]));

var StaticIterator = /*@__PURE__*/ (function () {
    function StaticIterator(iterator) {
        this.iterator = iterator;
        this.nextResult = iterator.next();
    }
    StaticIterator.prototype.hasValue = function () {
        return true;
    };
    StaticIterator.prototype.next = function () {
        var result = this.nextResult;
        this.nextResult = this.iterator.next();
        return result;
    };
    StaticIterator.prototype.hasCompleted = function () {
        var nextResult = this.nextResult;
        return nextResult && nextResult.done;
    };
    return StaticIterator;
}());
var StaticArrayIterator = /*@__PURE__*/ (function () {
    function StaticArrayIterator(array) {
        this.array = array;
        this.index = 0;
        this.length = 0;
        this.length = array.length;
    }
    StaticArrayIterator.prototype[__WEBPACK_IMPORTED_MODULE_6__internal_symbol_iterator__["a" /* iterator */]] = function () {
        return this;
    };
    StaticArrayIterator.prototype.next = function (value) {
        var i = this.index++;
        var array = this.array;
        return i < this.length ? { value: array[i], done: false } : { value: null, done: true };
    };
    StaticArrayIterator.prototype.hasValue = function () {
        return this.array.length > this.index;
    };
    StaticArrayIterator.prototype.hasCompleted = function () {
        return this.array.length === this.index;
    };
    return StaticArrayIterator;
}());
var ZipBufferIterator = /*@__PURE__*/ (function (_super) {
    __WEBPACK_IMPORTED_MODULE_0_tslib__["a" /* __extends */](ZipBufferIterator, _super);
    function ZipBufferIterator(destination, parent, observable) {
        var _this = _super.call(this, destination) || this;
        _this.parent = parent;
        _this.observable = observable;
        _this.stillUnsubscribed = true;
        _this.buffer = [];
        _this.isComplete = false;
        return _this;
    }
    ZipBufferIterator.prototype[__WEBPACK_IMPORTED_MODULE_6__internal_symbol_iterator__["a" /* iterator */]] = function () {
        return this;
    };
    ZipBufferIterator.prototype.next = function () {
        var buffer = this.buffer;
        if (buffer.length === 0 && this.isComplete) {
            return { value: null, done: true };
        }
        else {
            return { value: buffer.shift(), done: false };
        }
    };
    ZipBufferIterator.prototype.hasValue = function () {
        return this.buffer.length > 0;
    };
    ZipBufferIterator.prototype.hasCompleted = function () {
        return this.buffer.length === 0 && this.isComplete;
    };
    ZipBufferIterator.prototype.notifyComplete = function () {
        if (this.buffer.length > 0) {
            this.isComplete = true;
            this.parent.notifyInactive();
        }
        else {
            this.destination.complete();
        }
    };
    ZipBufferIterator.prototype.notifyNext = function (outerValue, innerValue, outerIndex, innerIndex, innerSub) {
        this.buffer.push(innerValue);
        this.parent.checkIterators();
    };
    ZipBufferIterator.prototype.subscribe = function (value, index) {
        return Object(__WEBPACK_IMPORTED_MODULE_5__util_subscribeToResult__["a" /* subscribeToResult */])(this, this.observable, this, index);
    };
    return ZipBufferIterator;
}(__WEBPACK_IMPORTED_MODULE_4__OuterSubscriber__["a" /* OuterSubscriber */]));
//# sourceMappingURL=zip.js.map


/***/ }),
/* 433 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _View = __webpack_require__(191);

var _View2 = _interopRequireDefault(_View);

var _Manager = __webpack_require__(434);

var _Manager2 = _interopRequireDefault(_Manager);

var _Status = __webpack_require__(129);

var _Status2 = _interopRequireDefault(_Status);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机视角命名空间
 * @description 包含视角、管理器等内容
 * @namespace
 */
var CameraView = {
  View: _View2.default,
  Manager: _Manager2.default,
  Status: _Status2.default
};

exports.default = CameraView;

/***/ }),
/* 434 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _View = __webpack_require__(191);

var _View2 = _interopRequireDefault(_View);

var _Status = __webpack_require__(129);

var _Status2 = _interopRequireDefault(_Status);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 视点管理器
 * @class
 * @memberof CameraView
 * @extends XbsjBase
 */
var Manager = function (_XbsjBase) {
    (0, _inherits3.default)(Manager, _XbsjBase);

    function Manager(earth) {
        (0, _classCallCheck3.default)(this, Manager);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Manager.__proto__ || (0, _getPrototypeOf2.default)(Manager)).call(this));

        _this._earth = earth;
        _this._scene = earth.czm.scene;
        //设置两者的相机固定位置
        _this.globe = new _View2.default(_this._earth);
        _this.china = new _View2.default(_this._earth);
        _this.lastView = new _Status2.default(_this._earth);

        _this.defaultGlobe();
        _this.defaultChina();

        _this._interceptDisposer = _XbsjBase3.default.registerArrayProperty(_this, 'views', function (elementJson) {
            var view = new _View2.default(_this._earth);
            elementJson = elementJson && elementJson.toJSON && elementJson.toJSON() || elementJson;
            view.xbsjFromJSON(elementJson);
            return view;
        }, function (view) {
            view.destroy();
        });

        //增加一个计算属性
        (0, _mobx.extendObservable)(_this, {
            get defaultView() {
                if (this.defaultViewIndex >= this.views.length || this.defaultViewIndex < 0) return undefined;
                return this.views[this.defaultViewIndex];
            }
        }, {
            defaultView: _mobx.computed
        });

        return _this;
    }

    (0, _createClass3.default)(Manager, [{
        key: 'toJSON',
        value: function toJSON(key) {
            this.lastView.initWithCurrent();
            return (0, _get3.default)(Manager.prototype.__proto__ || (0, _getPrototypeOf2.default)(Manager.prototype), 'toJSON', this).call(this, key);
        }
    }, {
        key: 'xbsjFromJSON',
        value: function xbsjFromJSON(jsonObject) {
            (0, _get3.default)(Manager.prototype.__proto__ || (0, _getPrototypeOf2.default)(Manager.prototype), 'xbsjFromJSON', this).call(this, jsonObject);
            this.lastView && this.lastView.flyTo(1);
        }

        /**
         * 设置默认全球视角
         */

    }, {
        key: 'defaultGlobe',
        value: function defaultGlobe() {
            this.globe.position = [2.1031217486531677, 0.5042461979915104, 22191651.019924622];
            this.globe.rotation = [0, -1.5704894508531937, 0];

            this.globe.near = 0.1;
            this.globe.far = 10000000000;
            this.globe.duration = 0.5;
        }

        /**
         * 设置默认中国视角
         */

    }, {
        key: 'defaultChina',
        value: function defaultChina() {
            this.china.position = [1.8770894704964525, 0.662547523843314, 8511735.797037361];
            this.china.rotation = [0, -1.5701114159178209, 0];
            this.china.near = 0.1;
            this.china.far = 10000000000;
            this.china.duration = 0.5;
        }

        /**
         * 创建一个新的视角
         * @returns {CameraView.View}
         */

    }, {
        key: 'newView',
        value: function newView() {
            var _this2 = this;

            return new _promise2.default(function (resolve, reject) {
                var view = new _View2.default(_this2._earth);
                view.initWithCurrent().then(function () {
                    resolve(view);
                }).catch(function (err) {
                    reject(err);
                });
            });
        }

        /**
         * 获取当前相机状态
         */

    }, {
        key: 'getCurrentCameraStatus',
        value: function getCurrentCameraStatus() {
            var cs = new _Status2.default(this._earth);
            cs.initWithCurrent();
            return cs;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            if (this._interceptDisposer) {
                this._interceptDisposer();
                this._interceptDisposer = undefined;
            }
            if (this._observeDisposer) {
                this._observeDisposer();
                this._observeDisposer = undefined;
            }
            return (0, _get3.default)(Manager.prototype.__proto__ || (0, _getPrototypeOf2.default)(Manager.prototype), 'destroy', this).call(this);
        }
    }]);
    return Manager;
}(_XbsjBase3.default);

Manager.defaultOptions = {
    /**
     * 全球视角
     * @instance
     * @type {CameraView.View}
     * @memberof CameraView.Manager
     */
    globe: null,
    /**
     * 中国视角
     * @instance
     * @type {CameraView.View}
     * @memberof CameraView.Manager
     */
    china: null,
    lastView: null,
    /**
     * 视角数组
     * @instance
     * @type {CameraView.View[]}
     * @memberof CameraView.Manager
     */
    views: [],
    /**
     * 默认视角数组的索引
     * @instance
     * @type {number}
     * @memberof CameraView.Manager
     */
    defaultViewIndex: 0
};

_XbsjObject2.default.registerType(Manager, 'CameraView.Manager');

exports.default = Manager;

/***/ }),
/* 435 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _RotateGlobe = __webpack_require__(436);

var _RotateGlobe2 = _interopRequireDefault(_RotateGlobe);

var _RotateCenter = __webpack_require__(437);

var _RotateCenter2 = _interopRequireDefault(_RotateCenter);

var _CameraTrack = __webpack_require__(438);

var _CameraTrack2 = _interopRequireDefault(_CameraTrack);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机自动飞行类
 * @class
 * @extends XbsjObject
 */
var CameraFlight = function (_XbsjObject) {
    (0, _inherits3.default)(CameraFlight, _XbsjObject);

    function CameraFlight(earth) {
        (0, _classCallCheck3.default)(this, CameraFlight);

        // this._earth = earth;


        //环绕地球飞行
        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraFlight.__proto__ || (0, _getPrototypeOf2.default)(CameraFlight)).call(this, earth));

        _this.rotateGlobe = new _RotateGlobe2.default(_this);

        //环绕中心飞行
        _this.rotateCenter = new _RotateCenter2.default(_this);

        //跟踪飞行
        _this.track = new _CameraTrack2.default(_this);

        _this.disposers.push(function () {
            _this.rotateGlobe = _this.rotateGlobe && _this.rotateGlobe.destroy();
            _this.rotateCenter = _this.rotateCenter && _this.rotateCenter.destroy();
            _this.track = _this.track && _this.track.destroy();
        });

        //flying无需存储
        (0, _mobx.extendObservable)(_this, {
            flying: undefined
        });

        //当前默认第几条路径
        //当前的飞行路径列表
        _this.defaultPathFlyIndex = 0;

        (0, _mobx.extendObservable)(_this, {
            get pathFly() {
                if (this._defaultPathFlyIndex < 0 || this._defaultPathFlyIndex >= this.paths.length) return undefined;
                return this.paths[this.defaultPathFlyIndex];
            }
        }, {
            pathFly: _mobx.computed
        });

        return _this;
    }

    //开始了


    (0, _createClass3.default)(CameraFlight, [{
        key: "_started",
        value: function _started(f) {
            this.flying = f;
        }
        //停止了

    }, {
        key: "_canceled",
        value: function _canceled() {
            this.flying = undefined;
        }
    }, {
        key: "destroy",
        value: function destroy() {
            return (0, _get3.default)(CameraFlight.prototype.__proto__ || (0, _getPrototypeOf2.default)(CameraFlight.prototype), "destroy", this).call(this);
        }
    }]);
    return CameraFlight;
}(_XbsjObject3.default);

CameraFlight.defaultOptions = {
    /**
     * 全球环绕飞行
     * @instance
     * @type {RotateGlobe}
     * @memberof CameraFlight
     */
    rotateGlobe: null,
    /**
    * 绕中心点飞行
    * @instance
    * @type {RotateCenter}
    * @memberof CameraFlight
    */
    rotateCenter: null,
    /**
    * 跟踪飞行
    * @instance
    * @type {CameraTrack}
    * @memberof CameraFlight
    */
    track: null,
    /**
    * 飞行路径数组
    * @instance
    * @type {PathFly[]}
    * @memberof CameraFlight
    */
    paths: [],
    /**
     * 默认飞行路径的索引
     * @instance
     * @type {number}
     * @memberof CameraFlight
     */
    defaultPathFlyIndex: 0
};
_XbsjObject3.default.registerType(CameraFlight, 'CameraFlight');

exports.default = CameraFlight;

/***/ }),
/* 436 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var RotateGlobe = function (_XbsjObject) {
    (0, _inherits3.default)(RotateGlobe, _XbsjObject);

    function RotateGlobe(flight) {
        (0, _classCallCheck3.default)(this, RotateGlobe);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RotateGlobe.__proto__ || (0, _getPrototypeOf2.default)(RotateGlobe)).call(this, flight._earth));

        _this._flight = flight;
        // this._earth = flight._earth;


        _this._running = false;

        //点击鼠标按下则取消
        _this._sseh = new Cesium.ScreenSpaceEventHandler(flight._earth.czm.viewer.canvas);

        _this._sseh.setInputAction(function () {
            _this.cancel();
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);

        (0, _mobx.extendObservable)(_this, {
            get mode() {
                return 'rotateGlobe';
            }
        }, {
            mode: _mobx.computed
        });
        return _this;
    }
    /**
     * 开始飞行 自动飞行为互斥状态，这个飞行开始后，cameraflight下其他自动飞行被取消
     */

    (0, _createClass3.default)(RotateGlobe, [{
        key: 'start',
        value: function start() {
            var _this2 = this;

            if (this._running) return;
            this._flight._started(this);
            var camera = this._earth.czm.viewer.camera;
            var carto = camera.positionCartographic;
            //飞到当前经度 + 设定的纬度 + 设定的高度  完成后添加 postupdater事件
            camera.flyTo({
                destination: Cesium.Cartesian3.fromRadians(carto.longitude, this.latitude, this.height),
                orientation: {
                    heading: 0.0,
                    pitch: -0.5 * Cesium.Math.PI,
                    roll: 0.0
                },
                complete: function complete() {
                    _this2._running = true;

                    var lastT = undefined;
                    //添加postupdate事件来更新camera位置
                    _this2._eventDisposer = _this2._earth.czm.viewer.scene.postUpdate.addEventListener(function (scene, time) {
                        if (!lastT) {
                            lastT = new Date().getTime();
                            return;
                        }
                        //计算时差 秒，
                        var duration = (new Date().getTime() - lastT) / 1000;
                        //计算走过的经度
                        var lng = camera.positionCartographic.longitude + duration * Cesium.Math.PI * 2 / _this2.cycle;
                        //直接设置相机
                        camera.setView({
                            destination: Cesium.Cartesian3.fromRadians(lng, _this2.latitude, _this2.height),
                            orientation: {
                                heading: 0.0,
                                pitch: -0.5 * Cesium.Math.PI,
                                roll: 0.0
                            }
                        });
                        lastT = new Date().getTime();
                    });
                },
                duration: 0.5
            });
        }
        /**
         * 取消飞行 
         */

    }, {
        key: 'cancel',
        value: function cancel() {
            if (!this._running) return;

            //取消postupdate事件
            if (this._eventDisposer) {
                this._eventDisposer();
                this._eventDisposer = undefined;
            }
            //
            this._flight._canceled();
            this._running = false;
        }

        //注销事件

    }, {
        key: 'destroy',
        value: function destroy() {

            this.cancel();
            this._sseh.destroy();
            return (0, _get3.default)(RotateGlobe.prototype.__proto__ || (0, _getPrototypeOf2.default)(RotateGlobe.prototype), 'destroy', this).call(this);
        }
    }]);
    return RotateGlobe;
}(_XbsjObject3.default);

RotateGlobe.defaultOptions = {
    /**
     * 相机高度
     * @type {number}
     * @instance
     * @default 10000000
     * @memberof RotateGlobe
     */
    height: 10000000,
    /**
     * 飞行一圈的周期，单位为秒
     * @type {number}
     * @instance
     * @default 60
     * @memberof RotateGlobe
     */
    cycle: 60,
    /**
     * 相机所在纬线高度 单位弧度
     * @type {number}
     * @instance
     * @default 北纬38°
     * @memberof RotateGlobe
     */
    latitude: 38.0 * 3.1415926 / 180
};

_XbsjObject3.default.registerType(RotateGlobe, 'RotateGlobe');

exports.default = RotateGlobe;

/***/ }),
/* 437 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 环绕中心点飞行
 * @class
 * @extends XbsjObject
 */
var RotateCenter = function (_XbsjObject) {
    (0, _inherits3.default)(RotateCenter, _XbsjObject);

    function RotateCenter(flight) {
        (0, _classCallCheck3.default)(this, RotateCenter);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RotateCenter.__proto__ || (0, _getPrototypeOf2.default)(RotateCenter)).call(this, flight._earth));

        _this._flight = flight;
        // this._earth = flight._earth;


        _this._running = false;

        //点击鼠标按下则取消
        _this._sseh = new Cesium.ScreenSpaceEventHandler(flight._earth.czm.viewer.canvas);

        _this._sseh.setInputAction(function () {
            _this.cancel();
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);

        (0, _mobx.extendObservable)(_this, {
            get mode() {
                return 'rotateCenter';
            }
        }, {
            mode: _mobx.computed
        });
        return _this;
    }

    /**
     * 开始飞行 自动飞行为互斥状态，这个飞行开始后，cameraflight下其他自动飞行被取消
     */

    (0, _createClass3.default)(RotateCenter, [{
        key: 'start',
        value: function start() {
            var _this2 = this;

            if (this._running) return;
            this._flight._started(this);
            var camera = this._earth.czm.viewer.camera;
            var scene = this._earth.czm.viewer.scene;

            var ray = camera.getPickRay(new Cesium.Cartesian2(scene.canvas.width * 0.5, scene.canvas.height * 0.5));
            //获取屏幕中心点，如果获取不到，不进行飞行
            var position = scene.globe.pick(ray, scene);
            if (!position) return;
            console.log(position);
            var transform = Cesium.Transforms.eastNorthUpToFixedFrame(position);
            camera.lookAtTransform(transform);
            //获取当前heading，使用设置 pitch 和 range
            //飞到当前经度 + 设定的纬度 + 设定的高度  完成后添加 postupdater事件
            var y = this.range * Math.sin(this.pitch);
            var z = this.range * Math.cos(this.pitch);
            var camposition = new Cesium.Cartesian3(0, y, z);
            var newposition = camera.cameraToWorldCoordinatesPoint(camposition);
            //camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
            var heading = 0;
            camera.flyTo({
                destination: camposition,
                orientation: {
                    heading: heading,
                    pitch: this.pitch,
                    roll: 0.0
                },
                endTransform: transform,
                complete: function complete() {
                    //camera.lookAtTransform(Cesium.Matrix4.IDENTITY);
                    _this2._running = true;

                    //设置相机的frame，增加heading值
                    var lastT = undefined;
                    //添加postupdate事件来更新camera位置
                    _this2._eventDisposer = _this2._earth.czm.viewer.scene.postUpdate.addEventListener(function (scene, time) {
                        if (!lastT) {
                            lastT = new Date().getTime();
                            return;
                        }
                        //计算时差 秒，
                        var duration = (new Date().getTime() - lastT) / 1000;
                        //计算走过的经度
                        heading += duration * Cesium.Math.PI * 2 / _this2.cycle;
                        //直接设置相机
                        camera.lookAtTransform(transform, new Cesium.HeadingPitchRange(heading, _this2.pitch, _this2.range));

                        lastT = new Date().getTime();
                    });
                },
                duration: 0.5
            });
        }
        /**
         * 取消飞行 
         */

    }, {
        key: 'cancel',
        value: function cancel() {
            if (!this._running) return;

            //设置
            var camera = this._earth.czm.viewer.camera;
            camera.lookAtTransform(Cesium.Matrix4.IDENTITY);

            //取消postupdate事件
            if (this._eventDisposer) {
                this._eventDisposer();
                this._eventDisposer = undefined;
            }
            //
            this._flight._canceled();
            this._running = false;
        }

        //注销事件

    }, {
        key: 'destroy',
        value: function destroy() {

            this.cancel();
            this._sseh.destroy();
            return (0, _get3.default)(RotateCenter.prototype.__proto__ || (0, _getPrototypeOf2.default)(RotateCenter.prototype), 'destroy', this).call(this);
        }
    }]);
    return RotateCenter;
}(_XbsjObject3.default);

RotateCenter.defaultOptions = {
    /**
     * 距离中心点距离
     * @type {number}
     * @instance
     * @default 50000
     * @memberof RotateCenter
     */
    range: 50000,
    /**
     * 飞行一圈的周期，单位为秒
     * @type {number}
     * @instance
     * @default 60
     * @memberof RotateCenter
     */
    cycle: 60,
    /**
     * 相对中心点的俯仰角 单位弧度
     * @type {number}
     * @instance
     * @default -PI/6
     * @memberof RotateCenter
     */
    pitch: -30 * 3.1415926 / 180
};

_XbsjObject3.default.registerType(RotateCenter, 'RotateCenter');

exports.default = RotateCenter;

/***/ }),
/* 438 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机跟踪飞行类（还未实现）
 * @class
 * @extends XbsjObject
 * @memberof CameraFlight
 */
var CameraTrack = function (_XbsjObject) {
    (0, _inherits3.default)(CameraTrack, _XbsjObject);

    function CameraTrack(flight) {
        (0, _classCallCheck3.default)(this, CameraTrack);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraTrack.__proto__ || (0, _getPrototypeOf2.default)(CameraTrack)).call(this, flight._earth));

        _this._flight = flight;
        // this._earth = flight._earth;

        (0, _mobx.extendObservable)(_this, {
            get mode() {
                return 'track';
            }
        }, {
            mode: _mobx.computed
        });
        return _this;
    }

    // 开始飞行


    (0, _createClass3.default)(CameraTrack, [{
        key: 'start',
        value: function start() {
            if (this._running) return;
        }
    }, {
        key: 'cancel',
        value: function cancel() {
            if (!this._running) return;

            //设置
            this._earth.czm.viewer.trackedEntity = undefined;

            //取消postupdate事件
            if (this._eventDisposer) {
                this._eventDisposer();
                this._eventDisposer = undefined;
            }
            //
            this._flight._canceled();
            this._running = false;
        }

        //注销事件

    }, {
        key: 'destroy',
        value: function destroy() {
            this.cancel();
            return (0, _get3.default)(CameraTrack.prototype.__proto__ || (0, _getPrototypeOf2.default)(CameraTrack.prototype), 'destroy', this).call(this);
        }
    }]);
    return CameraTrack;
}(_XbsjObject3.default);

_XbsjObject3.default.registerType(CameraTrack, 'CameraTrack');

exports.default = CameraTrack;

/***/ }),
/* 439 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _Immersion = __webpack_require__(440);

var _Immersion2 = _interopRequireDefault(_Immersion);

var _Viewport = __webpack_require__(441);

var _Viewport2 = _interopRequireDefault(_Viewport);

var _Navigator = __webpack_require__(442);

var _Navigator2 = _interopRequireDefault(_Navigator);

var _Interaction = __webpack_require__(443);

var _Interaction2 = _interopRequireDefault(_Interaction);

var _extendStatus = __webpack_require__(444);

var _extendStatus2 = _interopRequireDefault(_extendStatus);

var _flyTo2 = __webpack_require__(192);

var _flyTo3 = _interopRequireDefault(_flyTo2);

var _flyAround2 = __webpack_require__(445);

var _flyAround3 = _interopRequireDefault(_flyAround2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _utils = __webpack_require__(80);

var _utils2 = _interopRequireDefault(_utils);

var _Tracking = __webpack_require__(446);

var _Tracking2 = _interopRequireDefault(_Tracking);

var _extendGetter = __webpack_require__(193);

var _extendGetter2 = _interopRequireDefault(_extendGetter);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机管理类
 * @class
 */
var Camera = function (_XbsjBase) {
    (0, _inherits3.default)(Camera, _XbsjBase);

    function Camera(earth) {
        (0, _classCallCheck3.default)(this, Camera);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Camera.__proto__ || (0, _getPrototypeOf2.default)(Camera)).call(this));

        _this._earth = earth;
        _this._xbsjCameraImmersion = new _Immersion2.default(earth);
        _this._viewport = new _Viewport2.default(earth);
        _this._navigator = new _Navigator2.default(earth);
        _this._interaction = new _Interaction2.default(earth);
        _this.disposers.push(function () {
            _this._xbsjCameraImmersion.destroy();
            _this._viewport.destroy();
            _this._navigator.desotry();
            _this._interaction.destroy();
        });

        (0, _extendStatus2.default)(_this);

        _this._tracking = new _Tracking2.default(earth);
        _this.disposers.push(function () {
            return _this._tracking = _this._tracking && _this._tracking.destroy();
        });
        (0, _extendGetter2.default)(_this, 'tracking');
        return _this;
    }

    /**
     * 沉浸式管理
     * @type {Camera.Immersion}
     * @readonly
     */

    (0, _createClass3.default)(Camera, [{
        key: "flyTo",

        /**
         * 相机飞入
         * @param {number[]} position 目标位置
         * @param {number} [viewDistance] 距离目标多远距离时停下，默认为0，即直接飞到目标点处
         * @param {number[]} [rotation] 相机飞入后的姿态控制，从什么角度观察目标
         * @param {number} [duration] 飞行持续时间，如果是0，则直接跳转
         */
        value: function flyTo(position, // 必须有
        viewDistance, // 可选项
        rotation, // 可选项
        duration) // 可选项
        {
            var czmCamera = this._earth.czm.camera;
            return (0, _flyTo3.default)(czmCamera, position, viewDistance, rotation, duration);
        }

        /**
         * 相机环绕飞行
         * @param {number[]} position 目标位置
         * @param {number} [viewDistance] 环绕距离，默认为当前相机到目标点距离
         * @param {number[]} [rotation] 相机飞入后的姿态控制，从什么角度观察目标
         * @param {number} [flyToDuration] 环绕飞行之前飞向目标代理的时间，如果是0，则直接跳转，默认为3秒
         * @param {number} [aroundSpeed] 弧度/秒
         */

    }, {
        key: "flyAround",
        value: function flyAround(position, // 必选
        viewDistance, // 可选项
        rotation) // 可选项
        {
            var flyToDuration = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 3;
            var aroundSpeed = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : Math.PI / 10;

            var czmCamera = this._earth.czm.camera;

            if (typeof viewDistance === 'undefined') {
                viewDistance = _utils2.default.distance(this.position, position);
            }

            return (0, _flyAround3.default)(czmCamera, position, viewDistance, rotation, flyToDuration, aroundSpeed);
        }
    }, {
        key: "destroy",
        value: function destroy() {
            return (0, _get3.default)(Camera.prototype.__proto__ || (0, _getPrototypeOf2.default)(Camera.prototype), "destroy", this).call(this);
        }
    }, {
        key: "immersion",
        get: function get() {
            return this._xbsjCameraImmersion;
        }

        /**
         * 视口管理 
         * @type {Camera.Viewport}
         * @readonly
         */

    }, {
        key: "viewport",
        get: function get() {
            return this._viewport;
        }

        /**
         * 指北针管理 
         * @type {Camera.Navigator}
         * @readonly
         */

    }, {
        key: "navigator",
        get: function get() {
            return this._navigator;
        }

        /**
         * 交互类
         * @type {Camera.Interaction}
         * @readonly
         */

    }, {
        key: "interaction",
        get: function get() {
            return this._interaction;
        }
    }, {
        key: "isCameraLike",
        get: function get() {
            return true;
        }
    }]);
    return Camera;
}(_XbsjBase3.default);

Camera.Immersion = _Immersion2.default;
Camera.Viewport = _Viewport2.default;
Camera.Navigator = _Navigator2.default;
Camera.Interaction = _Interaction2.default;

exports.default = Camera;

/***/ }),
/* 440 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 沉浸式管理
 * @class 
 * @memberof Camera
 */

var Immersion = function (_XbsjBase) {
    (0, _inherits3.default)(Immersion, _XbsjBase);

    function Immersion(earth) {
        (0, _classCallCheck3.default)(this, Immersion);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Immersion.__proto__ || (0, _getPrototypeOf2.default)(Immersion)).call(this));

        (0, _mobx.extendObservable)(_this, {
            _velocity: 0.0,
            _baseVelocity: 0.0,
            velocityRatio: 1.0,
            get velocity() {
                return this._velocity;
            },
            get baseVelocity() {
                return this._baseVelocity;
            }
        }, {
            velocity: _mobx.computed,
            baseVelocity: _mobx.computed
        });

        _this._earth = earth;

        _this._cameraImmersion = _this._earth.czm.scene.xbsjCameraImmersion;

        _this.disposers.push((0, _mobx.autorun)(function () {
            if (_this.enabled) {
                _this._cameraImmersion.start();
            } else {
                _this._cameraImmersion.cancel();
            }
        }));

        _this.disposers.push(_this._cameraImmersion.keyboardStepEvent.addEventListener(function (newVal) {
            if (_this.velocityRatio !== newVal) {
                _this.velocityRatio = newVal;
            }
        }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._cameraImmersion.keyboardStep = _this.velocityRatio;
        }));

        _this.disposers.push(_this._cameraImmersion.velocityEvent.addEventListener(function (velocity) {
            if (_this._velocity !== velocity) {
                _this._velocity = velocity;
            }
        }));

        _this.disposers.push(_this._cameraImmersion.baseVelocityEvent.addEventListener(function (baseVelocity) {
            if (_this._baseVelocity !== baseVelocity) {
                _this._baseVelocity = baseVelocity;
            }
        }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._cameraImmersion.ghostMode.enabled = _this.ghostMode;
        }));

        _this.disposers.push(_this._cameraImmersion.ghostMode.changed.addEventListener(function () {
            _this.ghostMode = _this._cameraImmersion.ghostMode.enabled;
        }));
        return _this;
    }

    (0, _createClass3.default)(Immersion, [{
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Immersion.prototype.__proto__ || (0, _getPrototypeOf2.default)(Immersion.prototype), 'destroy', this).call(this);
        }
    }]);
    return Immersion;
}(_XbsjBase3.default);

Immersion.defaultOptions = {
    /**
     * 是否开启沉浸式漫游（键盘+鼠标）<br />
     * <br />
     * 快捷键说明 <br />
     * <br />
     *  W(↑) 水平方向前进 <br />
     *  S(↓) 水平方向后退 <br />
     *  A(←) 水平方向左移 <br />
     *  D(→) 水平方向右移 <br />
     *  <br />
     *  SHIFT + W(↑) 视线方向前进 <br />
     *  SHIFT + S(↓) 视线方向后退 <br />
     *  <br />
     *  Q 向左旋转 <br />
     *  E 向右旋转 <br />
     *  R 视点抬高 <br />
     *  F 视点降低 <br />
     *  <br />
     *  1 减速（默认速度的基础上*0.8） <br />
     *  2 恢复默认速度 <br />
     *  3 提速（默认速度的基础上*1.2） <br />
     *  4 默认速度模式，有两种可以相互切换：固定速度/自动计算，默认为自动计算，会根据距离物体的远近来适当调速；固定速度，则固定为室内漫游速度。 <br />
     * @instance
     * @type {boolean}
     * @default true
     * @memberof Camera.Immersion
     */
    enabled: true,
    /**
     * 鼠标交互模式更改为第一人称漫游模式 enabled属性为true时才能起作用
     * @instance
     * @type {boolean}
     * @default false
     * @memberof Camera.Immersion
     */
    ghostMode: false
};

exports.default = Immersion;

/***/ }),
/* 441 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function initViewportEventHandler(container, viewport, splitPositionCallback) {
    var handler = new Cesium.ScreenSpaceEventHandler(container);

    var isInVerticalSpliter = false;
    var isInHorizontalSpliter = false;

    function move(movement) {
        if (!isInVerticalSpliter && !isInHorizontalSpliter) {
            return;
        }

        splitPositionCallback({
            x: isInVerticalSpliter ? movement.endPosition.x : undefined,
            y: isInHorizontalSpliter ? movement.endPosition.y : undefined
        });
    }

    var beginMove = function beginMove(movement) {
        var x = movement.position.x;
        var y = movement.position.y;
        var destX = viewport.splitX * container.offsetWidth;
        var destY = viewport.splitY * container.offsetHeight;

        var splitX = viewport.splitX;
        var splitY = viewport.splitY;
        var innerDividerVisible = splitX > 0 && splitX < 1 || splitY > 0 && splitY < 1;

        isInVerticalSpliter = x > destX - 6 && x < destX + 6 && innerDividerVisible;
        isInHorizontalSpliter = y > destY - 6 && y < destY + 6 && innerDividerVisible;
    };

    handler.setInputAction(function (movement) {
        beginMove(movement);
    }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    handler.setInputAction(function (movement) {
        beginMove(movement);
    }, Cesium.ScreenSpaceEventType.PINCH_START);

    handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE);

    handler.setInputAction(function () {
        isInVerticalSpliter = false;
        isInHorizontalSpliter = false;
    }, Cesium.ScreenSpaceEventType.LEFT_UP);
    handler.setInputAction(function () {
        isInVerticalSpliter = false;
        isInHorizontalSpliter = false;
    }, Cesium.ScreenSpaceEventType.PINCH_END);

    return handler;
}

function addStyle(newStyle) {
    var styleElement = document.getElementById('styles_js');

    if (!styleElement) {
        styleElement = document.createElement('style');
        styleElement.type = 'text/css';
        styleElement.id = 'styles_js';
        document.getElementsByTagName('head')[0].appendChild(styleElement);
    }

    styleElement.appendChild(document.createTextNode(newStyle));
}

/**
 * 视口管理器
 * @class
 * @memberof Camera
 */

var Viewport = function (_XbsjBase) {
    (0, _inherits3.default)(Viewport, _XbsjBase);

    function Viewport(earth) {
        (0, _classCallCheck3.default)(this, Viewport);

        // document.styleSheets[0].addRule('.xbsjEarthSpliter:hover', 'background: padding-box #555 !important;');
        var _this = (0, _possibleConstructorReturn3.default)(this, (Viewport.__proto__ || (0, _getPrototypeOf2.default)(Viewport)).call(this));

        addStyle('.xbsjEarthSpliter:hover { background: padding-box #555 !important; }');

        _this._earth = earth;
        var scene = earth.czm.scene;
        var cw = _this._earth.czm.viewer.cesiumWidget;
        (0, _mobx.extendObservable)(_this, {
            /**
             * 左右屏分割比例
             * @description 比例在0-1之间
             * @type {number}
             * @instance
             * @default 1.0
             * @memberof Camera.Viewport
             */
            splitX: 1.0,
            /**
             * 上下屏分割比例
             * @description 比例在0-1之间
             * @type {number}
             * @instance
             * @default 1.0
             * @memberof Camera.Viewport
             */
            splitY: 1.0,
            /**
             * 分割线可见性
             * @description 比例在0-1之间
             * @type {boolean}
             * @instance
             * @default true
             * @memberof Camera.Viewport
             */
            dividerVisible: true
        });

        var verticalSpliter = document.createElement('div');
        verticalSpliter.style.cssText = '\n        position: absolute; \n        width: 2px; \n        background: black; \n        background-clip: padding-box;\n        height: 100%; \n        left: 50%; \n        top: 0px;\n        border-style: solid;\n        border-color: transparent;\n        border-image: initial;\n        border-width: 0px 5px;\n        box-sizing: content-box;\n        cursor: w-resize;\n        ';
        verticalSpliter.className = 'xbsjEarthSpliter';

        cw.container.appendChild(verticalSpliter);
        // initViewportVerticalSplit(verticalSpliter, splitPosition => {
        //     this.splitX = splitPosition;
        // });
        _this._verticalSpliter = verticalSpliter;
        _this.disposers.push(function () {
            _this._verticalSpliter && _this._verticalSpliter.parentElement.removeChild(_this._verticalSpliter);
        });

        var horizontalSpliter = document.createElement('div');
        horizontalSpliter.style.cssText = '\n        position: absolute; \n        height: 2px; \n        background: black; \n        background-clip: padding-box;\n        width: 100%; \n        top: 50%; \n        left: 0px;\n        border-style: solid;\n        border-color: transparent;\n        border-image: initial;\n        border-width: 5px 0px;\n        box-sizing: content-box;\n        cursor: n-resize;\n        ';
        horizontalSpliter.className = 'xbsjEarthSpliter';

        cw.container.appendChild(horizontalSpliter);
        // initViewportHorizontalSplit(horizontalSpliter, splitPosition => {
        //     this.splitY = splitPosition;
        // });
        _this._horizontalSpliter = horizontalSpliter;
        _this.disposers.push(function () {
            _this._horizontalSpliter && _this._horizontalSpliter.parentElement.removeChild(_this._horizontalSpliter);
        });

        _this._handler = initViewportEventHandler(cw.container, _this, function (_ref) {
            var x = _ref.x,
                y = _ref.y;

            if (typeof x !== 'undefined') {
                _this.splitX = x / cw.container.offsetWidth;
            }

            if (typeof y !== 'undefined') {
                _this.splitY = y / cw.container.offsetHeight;
            }
        });

        _this.disposers.push(function () {
            _this._handler = _this._handler && _this._handler.destroy();
        });

        scene.context.viewportSplit = scene.context.viewportSplit || new Cesium.Cartesian4(1.0, 1.0, 1.0, 1.0);

        _this._changed = new Cesium.Event();

        _this.disposers.push((0, _mobx.autorun)(function () {
            var dividerVisible = _this.dividerVisible;
            var splitX = _this.splitX;
            var splitY = _this.splitY;

            // this._verticalSpliter.style.left = 100.0 * this.splitX + "%";
            _this._verticalSpliter.style.left = 'calc(' + 100.0 * splitX + '% - 6px)';
            scene.context.viewportSplit.x = splitX;
            scene.imagerySplitPosition = splitX;

            _this._horizontalSpliter.style.top = 'calc(' + 100.0 * splitY + '% - 6px)';
            scene.context.viewportSplit.y = splitY;

            var innerDividerVisible = splitX > 0 && splitX < 1 || splitY > 0 && splitY < 1;

            _this._verticalSpliter.style.visibility = innerDividerVisible && dividerVisible ? 'visible' : 'hidden';
            _this._horizontalSpliter.style.visibility = innerDividerVisible && dividerVisible ? 'visible' : 'hidden';

            _this._changed.raiseEvent();
        }));
        return _this;
    }

    (0, _createClass3.default)(Viewport, [{
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Viewport.prototype.__proto__ || (0, _getPrototypeOf2.default)(Viewport.prototype), 'destroy', this).call(this);
        }
    }]);
    return Viewport;
}(_XbsjBase3.default);

exports.default = Viewport;

/***/ }),
/* 442 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _keys = __webpack_require__(33);

var _keys2 = _interopRequireDefault(_keys);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// import XbsjTools from '../../utils/XbsjTools';

var defaultOptions = {
    /**
     * 是否显示指北针
     * @type {boolean}
     * @default false
     * @instance
     * @memberof Camera.Navigator
     */
    showCompass: false,
    /**
     * 指北针样式（位置）设置
     * @type {object}
     * @instance
     * @property {number} top 上边距，默认值18
     * @property {number} right 右边距，默认值18
     * @property {number} bottom 下边距，默认值undefined
     * @property {number} left 左边距，默认值undefined
     * @memberof Camera.Navigator
     */
    compassStyle: {
        top: 18,
        right: 18,
        bottom: undefined,
        left: undefined
    },
    /**
     * 是否显示比例尺
     * @type {boolean}
     * @default false
     * @instance
     * @memberof Camera.Navigator
     */
    showDistanceLegend: false,
    /**
     * 比例尺样式（位置）设置
     * @type {object}
     * @instance
     * @property {number} top 上边距，默认值undefined
     * @property {number} right 右边距，默认值18
     * @property {number} bottom 下边距，默认值18
     * @property {number} left 左边距，默认值undefined
     * @memberof Camera.Navigator
     */
    distanceLegendStyle: {
        top: undefined,
        right: 18,
        bottom: 18,
        left: undefined
    }
};

/**
 * 指北针控制
 * @class
 * @memberof Camera
 */

var Navigator = function (_XbsjBase) {
    (0, _inherits3.default)(Navigator, _XbsjBase);

    function Navigator(earth) {
        (0, _classCallCheck3.default)(this, Navigator);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Navigator.__proto__ || (0, _getPrototypeOf2.default)(Navigator)).call(this));

        _this._earth = earth;
        _this._disposers = [];

        _XbsjBase3.default.registerProperty(_this, 'compassStyle');
        _XbsjBase3.default.registerProperty(_this, 'distanceLegendStyle');

        // navigation插件设置
        if (Cesium.viewerCesiumNavigationMixin) {
            var navigationOptions = {};
            // navigationOptions.defaultResetView = Cesium.Rectangle.fromDegrees(71, 3, 90, 14);
            // Only the compass will show on the map
            navigationOptions.enableCompass = true;
            navigationOptions.enableZoomControls = false;
            navigationOptions.enableDistanceLegend = true;
            navigationOptions.enableCompassOuterRing = true;

            var viewer = _this._earth.czm.viewer;
            viewer.extend(Cesium.viewerCesiumNavigationMixin, navigationOptions);

            // 原始compass样式
            // .compass {
            //     pointer-events: auto;
            //     right: 0;
            //     overflow: hidden;
            //     top: 100px;
            // }
            var compassDiv = viewer.cesiumNavigation.navigationDiv.children[0];
            compassDiv.classList.remove('compass');
            compassDiv.style['pointer-events'] = 'auto';
            compassDiv.style['overflow'] = 'hidden';
            compassDiv.style.position = 'absolute';
            compassDiv.style.width = '95px';
            compassDiv.style.height = '95px';

            var distanceLegendDiv = viewer.cesiumNavigation.distanceLegendDiv.children[0];

            // 修复指北针左键操作不了，只有中键和右键能用的问题
            // hack pointerxxx事件中执行prevenddefault会导致子node的mousedown不响应，而cesium的eventhandler都是用的pointerxxx
            // 这里想到的办法是让指北针挂在container之下，这样就不受cesium的handler的影响了！
            earth.czm.viewer.container.appendChild(earth.czm.viewer.cesiumNavigation.container);

            _this._disposers.push((0, _mobx.autorun)(function () {
                viewer.cesiumNavigation.navigationViewModel.showCompass = _this.showCompass;
                viewer.cesiumNavigation.distanceLegendViewModel.enableDistanceLegend = _this.showDistanceLegend;

                var compassStyle = compassDiv.style;
                (0, _keys2.default)(_this.compassStyle).forEach(function (k) {
                    return compassStyle[k] = _this.compassStyle[k] && _this.compassStyle[k] + 'px' || '';
                });

                var distanceLegendStyle = distanceLegendDiv.style;
                (0, _keys2.default)(_this.distanceLegendStyle).forEach(function (k) {
                    return distanceLegendStyle[k] = _this.distanceLegendStyle[k] && _this.distanceLegendStyle[k] + 'px' || '';
                });
            }));
        }
        return _this;
    }

    (0, _createClass3.default)(Navigator, [{
        key: 'desotry',
        value: function desotry() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }]);
    return Navigator;
}(_XbsjBase3.default);

Navigator.defaultOptions = defaultOptions;

exports.default = Navigator;

/***/ }),
/* 443 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 相机交互模式控制
 * @class 
 * @memberof Camera
 */
var Interaction = function () {
    function Interaction(earth) {
        var _this = this;

        (0, _classCallCheck3.default)(this, Interaction);

        this._earth = earth;
        (0, _mobx.extendObservable)(this, {
            /**
             * 是否使用Cesium的交互模式（右键缩放）
             * @type {boolean}
             * @default false
             * @instance
             * @memberof Camera.Interaction
             */
            useCesiumNavigator: false
        });

        var viewer = earth.czm.viewer;
        var scene = viewer.scene;

        // 原始设置
        // scene.screenSpaceCameraController.lookEventTypes = { eventType : CameraEventType.LEFT_DRAG, modifier : KeyboardEventModifier.SHIFT };
        // scene.screenSpaceCameraController.zoomEventTypes = [CameraEventType.RIGHT_DRAG, CameraEventType.WHEEL, CameraEventType.PINCH]
        this._originLookEventTypes = scene.screenSpaceCameraController.lookEventTypes;
        this._originZoomEventTypes = scene.screenSpaceCameraController.zoomEventTypes;

        this._disposers = [];
        this._disposers.push((0, _mobx.autorun)(function () {
            if (_this.useCesiumNavigator) {
                scene.screenSpaceCameraController.lookEventTypes = _this._originLookEventTypes;
                scene.screenSpaceCameraController.zoomEventTypes = _this._originZoomEventTypes;
            } else {
                scene.screenSpaceCameraController.lookEventTypes = [{ eventType: Cesium.CameraEventType.RIGHT_DRAG }, { eventType: Cesium.CameraEventType.RIGHT_DRAG, modifier: Cesium.KeyboardEventModifier.SHIFT }];
                scene.screenSpaceCameraController.zoomEventTypes = [Cesium.CameraEventType.WHEEL, Cesium.CameraEventType.PINCH];
            }
        }));

        // 去除系统默认事件
        viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
        viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);

        var scratchCartesian = new Cesium.Cartesian3();
        viewer.screenSpaceEventHandler.setInputAction(function (event) {
            var pp = Cesium.xbsjPickPosition(viewer.scene, event.position, scratchCartesian);
            if (pp) {
                Cesium.xbsjFlyAround(viewer.camera, pp);
            }
        }, Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);

        // const screenSpaceEventHandler = new Cesium.ScreenSpaceEventHandler(viewer.scene.canvas);
        viewer.screenSpaceEventHandler.setInputAction(function (event) {
            if (_this._earth.camera && _this._earth.camera.tracking && _this._earth.camera.tracking.enabled) {// 如果相机跟踪状态下，左键不能结束！
                // do nothing!
            } else {
                viewer.camera.cancelFlight();
            }
        }, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    }

    (0, _createClass3.default)(Interaction, [{
        key: "destroy",
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }]);
    return Interaction;
}();

exports.default = Interaction;

/***/ }),
/* 444 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function extendStatus(camera) {
    var earth = camera._earth;
    var scene = earth.czm.scene;

    (0, _mobx.extendObservable)(camera, {
        _flying: false,
        /**
         * 位置 [经度，纬度，高度]
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Camera
         */
        position: [0, 0, 0],
        /**
         * 姿态 [偏航角，俯仰角，翻转角]
         * @type {number[]}
         * @instance
         * @default [0, 0, 0]
         * @memberof Camera
         */
        rotation: [0, 0, 0],
        /**
         * 是否正在飞行
         * @type {boolean}
         * @instance
         * @readonly
         * @memberof Camera
         */
        get flying() {
            return camera._flying;
        }
    }, {
        flying: _mobx.computed
    });

    camera.disposers.push(_XbsjBase2.default.registerPosition(camera));
    camera.disposers.push(_XbsjBase2.default.registerRotation(camera));

    camera.disposers.push(scene.camera.currentFlightEvent.addEventListener(function () {
        camera._flying = !!scene.camera._currentFlight;
    }));

    var rawCameraPosition = [];
    var rawCameraRotation = [];

    var updateCameraStatus = function updateCameraStatus() {
        var czmCamera = scene.camera;
        var carto = czmCamera.positionCartographic;

        rawCameraPosition.splice(0, rawCameraPosition.length, carto.longitude, carto.latitude, carto.height);
        rawCameraRotation.splice(0, rawCameraRotation.length, czmCamera.heading, czmCamera.pitch, czmCamera.roll);

        (0, _mobx.runInAction)(function () {
            if (!camera.position.xepe(rawCameraPosition)) {
                camera.position.splice(0, 3, carto.longitude, carto.latitude, carto.height);
            }

            if (!camera.rotation.xere(rawCameraRotation)) {
                camera.rotation.splice(0, 3, czmCamera.heading, czmCamera.pitch, czmCamera.roll);
            }
        });
    };

    updateCameraStatus();
    camera.disposers.push(scene.preUpdate.addEventListener(updateCameraStatus));

    var flyCartesian = void 0;

    camera.disposers.push((0, _mobx.reaction)(function () {
        return {
            position: [].concat((0, _toConsumableArray3.default)(camera.position)),
            rotation: [].concat((0, _toConsumableArray3.default)(camera.rotation))
        };
    }, function (_ref) {
        var position = _ref.position,
            rotation = _ref.rotation;

        var camera = scene.camera;
        var carto = scene.camera.positionCartographic;

        rawCameraPosition.splice(0, rawCameraPosition.length, carto.longitude, carto.latitude, carto.height);
        rawCameraRotation.splice(0, rawCameraRotation.length, camera.heading, camera.pitch, camera.roll);
        var equal = position.xepe(rawCameraPosition) && rotation.xere(rawCameraRotation);

        if (!equal) {
            var _Cesium$Cartesian;

            flyCartesian = flyCartesian || new Cesium.Cartesian3();
            (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, flyCartesian]));
            camera.setView({
                destination: flyCartesian,
                orientation: {
                    heading: rotation[0],
                    pitch: rotation[1],
                    roll: rotation[2]
                }
            });
        }
    }));
}

exports.default = extendStatus;

/***/ }),
/* 445 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _flyTo = __webpack_require__(192);

var _flyTo2 = _interopRequireDefault(_flyTo);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchCartesian = void 0;
function flyAround(czmCamera, position, viewDistance, rotation) {
    var flyToDuration = arguments.length > 4 && arguments[4] !== undefined ? arguments[4] : 3;
    var aroundSpeed = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : 3.14 / 10;

    (0, _flyTo2.default)(czmCamera, position, viewDistance, rotation, flyToDuration, {
        complete: function complete() {
            var _Cesium$Cartesian;

            scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
            var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, scratchCartesian]));
            Cesium.xbsjFlyAround(czmCamera, cartesian, viewDistance, undefined, aroundSpeed);
        }
    });
}

exports.default = flyAround;

/***/ }),
/* 446 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function registerMouseMoveHandler(container, moveCallback, scrollCallback, endCallback) {
    var handler = new Cesium.ScreenSpaceEventHandler(container);

    var moving = false;

    function move(movement) {
        moving && moveCallback(movement);
    }

    var beginMove = function beginMove(movement) {
        moving = true;
    };

    var endMove = function endMove() {
        moving = false;
    };

    handler.setInputAction(beginMove, Cesium.ScreenSpaceEventType.LEFT_DOWN);
    handler.setInputAction(beginMove, Cesium.ScreenSpaceEventType.PINCH_START);

    handler.setInputAction(move, Cesium.ScreenSpaceEventType.MOUSE_MOVE);
    handler.setInputAction(move, Cesium.ScreenSpaceEventType.PINCH_MOVE);

    handler.setInputAction(endMove, Cesium.ScreenSpaceEventType.LEFT_UP);
    handler.setInputAction(endMove, Cesium.ScreenSpaceEventType.PINCH_END);

    handler.setInputAction(scrollCallback, Cesium.ScreenSpaceEventType.WHEEL);

    handler.setInputAction(endCallback, Cesium.ScreenSpaceEventType.RIGHT_UP);

    return function () {
        handler.destroy();
    };
}

var Tracking = function (_XbsjBase) {
    (0, _inherits3.default)(Tracking, _XbsjBase);

    function Tracking(earth) {
        (0, _classCallCheck3.default)(this, Tracking);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Tracking.__proto__ || (0, _getPrototypeOf2.default)(Tracking)).call(this));

        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            enabled: false,
            position: [0, 0, 0],
            rotation: [0, 0, 0],
            viewDistance: 50.0,
            isCameraLike: false,

            offsetPosition: [0, 0, 0], // 注意三个方向的单位都是米
            offsetRotation: [0, 0, 0],
            offsetViewDistance: 0.0

            // autoFix: false, // 自动修正方向和位置
        });

        var cw = earth.czm.viewer.cesiumWidget;
        _this.disposers.push(registerMouseMoveHandler(cw.container, function (movement) {
            // console.log('start: ' + movement.startPosition.x + ' ' + movement.startPosition.y);    
            // console.log('end: ' + movement.endPosition.x + ' ' + movement.endPosition.y);    
            if (!_this.enabled) {
                return;
            }

            var h = cw.container.offsetHeight;
            var diffX = movement.endPosition.x - movement.startPosition.x;
            var diffY = -(movement.endPosition.y - movement.startPosition.y);
            var diffHeading = diffX / h * Math.PI * 2.0;
            var diffPith = diffY / h * Math.PI * 2.0;
            _this.offsetRotation[0] += diffHeading;
            _this.offsetRotation[1] += diffPith;
        }, function (delta) {
            if (!_this.enabled) {
                return;
            }

            var scale = delta > 0 ? 0.8 : 1.2;
            var finalDist = _this.viewDistance + _this.offsetViewDistance;
            finalDist = finalDist > 0 ? finalDist : 1.0;
            _this.offsetViewDistance = finalDist * scale - _this.viewDistance;
        }, function () {
            _this.enabled = false;
        }));

        _this._finalPosition = [0, 0, 0];
        _this._finalRotation = [0, 0, 0];
        _this._finalViewDistance = 0.0;

        _this.disposers.push((0, _mobx.autorun)(function () {
            var enabled = _this.enabled;

            var position = _this.position;
            var offsetPosition = _this.offsetPosition;
            var rotation = _this.rotation;
            var offsetRotation = _this.offsetRotation;
            var viewDistance = _this.viewDistance;
            var offsetViewDistance = _this.offsetViewDistance;

            if (!enabled) {
                return;
            }

            for (var i = 0; i < 3; ++i) {
                _this._finalPosition[i] = position[i] + offsetPosition[i];
                _this._finalRotation[i] = rotation[i] + offsetRotation[i];
            }

            if (!_this.isCameraLike) {
                _this._finalRotation[0] += Math.PI * 0.5;
            }

            _this._finalViewDistance = viewDistance + offsetViewDistance;
            _this._earth.camera && _this._earth.camera.flyTo(_this._finalPosition, _this._finalViewDistance, _this._finalRotation, 0);
        }));

        // 如果enabled开启则将系统的鼠标事件关掉！
        _this.disposers.push((0, _mobx.autorun)(function () {
            var enabled = _this.enabled;
            _this._earth.czm && (_this._earth.czm.scene.screenSpaceCameraController.enableInputs = !enabled);
        }));

        var scene = _this._earth.czm.scene;

        _this.disposers.push((0, _mobx.intercept)(_this, 'enabled', function (changed) {
            if (changed.newValue && !changed.object.value) {
                // 避免设置eanble为false时，导致相机先设置，再停止
                _this.offsetPosition.splice(0, 3, 0, 0, 0);
                _this.offsetRotation.splice(0, 3, 0, 0, 0);
                _this.offsetViewDistance = 0.0;
            } else if (!changed.newValue && changed.object.value) {
                // disabled之前
                if (_this._currentFlight) {
                    _this._currentFlight = undefined;
                    scene.camera.cancelFlight();
                }
            }

            return changed;
        }));

        _this.disposers.push((0, _mobx.observe)(_this, 'enabled', function (changed) {
            if (changed.newValue && !changed.oldValue) {
                // enabled之后
                if (_this._currentFlight) {
                    console.error('this._currentFlight should not be defined!');
                }

                _this._currentFlight = {
                    cancelTween: function cancelTween() {
                        if (_this._currentFlight) {
                            _this._currentFlight = undefined;
                            _this.enabled && (_this.enabled = false);
                        }
                    }
                };
                scene.camera.cancelFlight();
                scene.camera._currentFlight = _this._currentFlight;
            }
        }));
        return _this;
    }

    return Tracking;
}(_XbsjBase3.default);

exports.default = Tracking;

/***/ }),
/* 447 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _defineProperty = __webpack_require__(49);

var _defineProperty2 = _interopRequireDefault(_defineProperty);

var _Picking = __webpack_require__(448);

var _Picking2 = _interopRequireDefault(_Picking);

var _PositionPickingBinding = __webpack_require__(450);

var _PositionPickingBinding2 = _interopRequireDefault(_PositionPickingBinding);

var _DirectionCameraBinding = __webpack_require__(452);

var _DirectionCameraBinding2 = _interopRequireDefault(_DirectionCameraBinding);

var _MovableObjectBinding = __webpack_require__(454);

var _MovableObjectBinding2 = _interopRequireDefault(_MovableObjectBinding);

var _RotatableObjectBinding = __webpack_require__(457);

var _RotatableObjectBinding2 = _interopRequireDefault(_RotatableObjectBinding);

var _CreatingPolylineBinding = __webpack_require__(131);

var _CreatingPolylineBinding2 = _interopRequireDefault(_CreatingPolylineBinding);

var _CreatingPolygonBinding = __webpack_require__(461);

var _CreatingPolygonBinding2 = _interopRequireDefault(_CreatingPolygonBinding);

var _HeightEditingBinding = __webpack_require__(195);

var _HeightEditingBinding2 = _interopRequireDefault(_HeightEditingBinding);

var _PolygonCreatingWithHeightBinding = __webpack_require__(462);

var _PolygonCreatingWithHeightBinding2 = _interopRequireDefault(_PolygonCreatingWithHeightBinding);

var _EditingPolygonBinding = __webpack_require__(463);

var _EditingPolygonBinding2 = _interopRequireDefault(_EditingPolygonBinding);

var _EditingPolylineBinding = __webpack_require__(196);

var _EditingPolylineBinding2 = _interopRequireDefault(_EditingPolylineBinding);

var _CameraTrackingBinding = __webpack_require__(466);

var _CameraTrackingBinding2 = _interopRequireDefault(_CameraTrackingBinding);

var _XbsjMutex = __webpack_require__(163);

var _XbsjMutex2 = _interopRequireDefault(_XbsjMutex);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _registerInteractionProperty = __webpack_require__(15);

var _registerInteractionProperty2 = _interopRequireDefault(_registerInteractionProperty);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function defineGetProperty(object, propertyName) {
    (0, _defineProperty2.default)(object, propertyName.slice(1), {
        get: function get() {
            return object[propertyName];
        }
    });
}

/**
 * 交互操作类
 */

var XbsjInteraction = function (_XbsjBase) {
    (0, _inherits3.default)(XbsjInteraction, _XbsjBase);

    function XbsjInteraction(earth) {
        (0, _classCallCheck3.default)(this, XbsjInteraction);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsjInteraction.__proto__ || (0, _getPrototypeOf2.default)(XbsjInteraction)).call(this));

        _this._earth = earth;
        _this._mutex = new _XbsjMutex2.default();
        _this.disposers.push(function () {
            return _this._mutex = _this._mutex && _this._mutex.destroy();
        });

        /**
         * 拾取操作
         * @name picking
         * @type {Picking}
         * @instance
         * @memberof XbsjInteraction
         * @readonly
         */
        _this._picking = new _Picking2.default(earth);
        defineGetProperty(_this, '_picking');
        // this._picking.enabled = true;

        _this._positionPickingBinding = new _PositionPickingBinding2.default(earth);
        defineGetProperty(_this, '_positionPickingBinding');
        _this._directionCameraBinding = new _DirectionCameraBinding2.default(earth);
        defineGetProperty(_this, '_directionCameraBinding');
        _this._movableObjectBinding = new _MovableObjectBinding2.default(earth);
        defineGetProperty(_this, '_movableObjectBinding');
        _this._rotatableObjectBinding = new _RotatableObjectBinding2.default(earth);
        defineGetProperty(_this, '_rotatableObjectBinding');
        _this._creatingPolylineBinding = new _CreatingPolylineBinding2.default(earth);
        defineGetProperty(_this, '_creatingPolylineBinding');
        _this._creatingPolygonBinding = new _CreatingPolygonBinding2.default(earth);
        defineGetProperty(_this, '_creatingPolygonBinding');
        _this._heightEditingBinding = new _HeightEditingBinding2.default(earth);
        defineGetProperty(_this, '_heightEditingBinding');
        _this._flattenedPolygonCreatingBinding = new _PolygonCreatingWithHeightBinding2.default(earth);
        defineGetProperty(_this, '_flattenedPolygonCreatingBinding');
        _this._editingPolygonBinding = new _EditingPolygonBinding2.default(earth);
        defineGetProperty(_this, '_editingPolygonBinding');
        _this._editingPolylineBinding = new _EditingPolylineBinding2.default(earth);
        defineGetProperty(_this, '_editingPolylineBinding');
        _this._cameraTrackingBinding = new _CameraTrackingBinding2.default(earth);
        defineGetProperty(_this, '_cameraTrackingBinding');

        _this.disposers.push(function () {
            _this._picking = _this._picking && _this._picking.destroy();
            _this._positionPickingBinding = _this._positionPickingBinding && _this._positionPickingBinding.destroy();
            _this._directionCameraBinding = _this._directionCameraBinding && _this._directionCameraBinding.destroy();
            _this._movableObjectBinding = _this._movableObjectBinding && _this._movableObjectBinding.destroy();
            _this._rotatableObjectBinding = _this._rotatableObjectBinding && _this._rotatableObjectBinding.destroy();
            _this._creatingPolylineBinding = _this._creatingPolylineBinding && _this._creatingPolylineBinding.destroy();
            _this._creatingPolygonBinding = _this._creatingPolygonBinding && _this._creatingPolygonBinding.destroy();
            _this._heightEditingBinding = _this._heightEditingBinding && _this._heightEditingBinding.destroy();
            _this._flattenedPolygonCreatingBinding = _this._flattenedPolygonCreatingBinding && _this._flattenedPolygonCreatingBinding.destroy();
            _this._editingPolygonBinding = _this._editingPolygonBinding && _this._editingPolygonBinding.destroy();
            _this._editingPolylineBinding = _this._editingPolylineBinding && _this._editingPolylineBinding.destroy();
            _this._cameraTrackingBinding = _this._cameraTrackingBinding && _this._cameraTrackingBinding.destroy();
        });

        var setUndefined = _XbsjMutex2.default.setUndefined;
        var isDefined = _XbsjMutex2.default.isDefined;

        var createObj = function createObj(ma) {
            return {
                binding: ma[0],
                property: ma[1],
                isValidFunc: ma[2],
                validFunc: ma[3]
            };
        };
        var mutexCollection = [
        // createObj([this._picking, 'enabled', isTrue, setFalse]),
        createObj([_this._positionPickingBinding, 'target', isDefined, setUndefined]), createObj([_this._directionCameraBinding, 'target', isDefined, setUndefined]), createObj([_this._movableObjectBinding, 'target', isDefined, setUndefined]), createObj([_this._rotatableObjectBinding, 'target', isDefined, setUndefined]), createObj([_this._creatingPolylineBinding, 'target', isDefined, setUndefined]), createObj([_this._creatingPolygonBinding, 'target', isDefined, setUndefined]), createObj([_this._heightEditingBinding, 'target', isDefined, setUndefined]), createObj([_this._flattenedPolygonCreatingBinding, 'target', isDefined, setUndefined]), createObj([_this._editingPolygonBinding, 'target', isDefined, setUndefined]), createObj([_this._editingPolylineBinding, 'target', isDefined, setUndefined]), createObj([_this._cameraTrackingBinding, 'target', isDefined, setUndefined])];

        _this._mutex.mutexCollection = mutexCollection;

        _this.disposers.push((0, _mobx.reaction)(function () {
            return mutexCollection.some(function (e) {
                return e.isValidFunc(e.binding[e.property]);
            });
        }, function (validInteraction) {
            _this._picking.shouldEnabled = !validInteraction;
            // this._picking.enabled = !validInteraction;
        }));
        return _this;
    }

    return XbsjInteraction;
}(_XbsjBase3.default);

XbsjInteraction.InteractionProperty = _registerInteractionProperty2.default;
XbsjInteraction.Picking = _Picking2.default;

exports.default = XbsjInteraction;

/***/ }),
/* 448 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjCzmObj = __webpack_require__(11);

var _XbsjCzmObj2 = _interopRequireDefault(_XbsjCzmObj);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _createDefaultTilesetPickingStyle = __webpack_require__(449);

var _createDefaultTilesetPickingStyle2 = _interopRequireDefault(_createDefaultTilesetPickingStyle);

var _registerPickingParent = __webpack_require__(108);

var _registerPickingParent2 = _interopRequireDefault(_registerPickingParent);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function getPickedObjectID(pickedObject) {
    if (!pickedObject) {
        return undefined;
    }

    // 针对tileset需要特殊处理
    if (pickedObject.primitive && pickedObject.primitive.xbsjTileset) {
        return pickedObject.primitive.xbsjTileset;
    }

    if (pickedObject.id && pickedObject.id instanceof Cesium.Entity && pickedObject.id._xbsjOwner) {
        return pickedObject.id._xbsjOwner;
    }

    if (pickedObject.id && pickedObject.id.allowPicking && typeof pickedObject.id.onclick === 'function' && typeof pickedObject.id.onmouseover === 'function') {
        return pickedObject.id;
    }

    return undefined;
}

function initSilhouette(earth) {
    // 拾取外轮廓设定
    var silhouetteHovered = Cesium.PostProcessStageLibrary.createEdgeDetectionStage();
    silhouetteHovered.uniforms.color = Cesium.Color.GREEN;
    silhouetteHovered.uniforms.length = 0.01;
    silhouetteHovered.selected = [];

    var silhouetteClicked = Cesium.PostProcessStageLibrary.createEdgeDetectionStage();
    silhouetteClicked.uniforms.color = Cesium.Color.LIME;
    silhouetteClicked.uniforms.length = 0.01;
    silhouetteClicked.selected = [];

    earth.czm.scene.postProcessStages.add(Cesium.PostProcessStageLibrary.createSilhouetteStage([silhouetteHovered, silhouetteClicked]));

    return [silhouetteHovered, silhouetteClicked];
}

/**
 * 拾取交互操作
 */

var Picking = function (_XbsjBase) {
    (0, _inherits3.default)(Picking, _XbsjBase);

    function Picking(earth) {
        (0, _classCallCheck3.default)(this, Picking);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Picking.__proto__ || (0, _getPrototypeOf2.default)(Picking)).call(this));

        _this._earth = earth;
        _this._observer = undefined;
        _this._mouseMoveSource$ = undefined;

        (0, _mobx.extendObservable)(_this, {
            /**
             * 是否开启拾取
             * @instance
             * @memberof Picking
             */
            enabled: false, // 对外接口
            shouldEnabled: true // 是否真的可用，还需要看内部条件是否满足，即没有其他交互操作。
        });

        (0, _mobx.extendObservable)(_this, {
            _hoveredObj: undefined,
            _hoveredAttachedInfo: undefined,
            _clickedObj: undefined,
            _clickedAttachedInfo: undefined,
            get hoveredObj() {
                return this._hoveredObj;
            },
            get hoveredAttachedInfo() {
                return this._hoveredAttachedInfo;
            },
            get clickedObj() {
                return this._clickedObj;
            },
            get clickedAttachedInfo() {
                return this._clickedAttachedInfo;
            }
        }, {
            _hoveredObj: _mobx.observable.ref,
            _hoveredAttachedInfo: _mobx.observable.ref,
            _clickedObj: _mobx.observable.ref,
            _clickedAttachedInfo: _mobx.observable.ref,
            hoveredObj: _mobx.computed,
            hoveredAttachedInfo: _mobx.computed,
            clickedObj: _mobx.computed,
            clickedAttachedInfo: _mobx.computed
        });

        // 一旦加载会导致 model.silhouetteSize等的设置报错！
        // this._hs = initSilhouette(earth);

        _this.disposers.push((0, _mobx.autorun)(function () {
            if (_this.enabled && _this.shouldEnabled) {
                _this._start();
            } else {
                _this._cancel();
            }
        }));

        _this._defaultTilesetPickingStyle = (0, _createDefaultTilesetPickingStyle2.default)(_this);
        return _this;
    }

    (0, _createClass3.default)(Picking, [{
        key: '_start',
        value: function _start() {
            if (!(this.enabled && this.shouldEnabled)) {
                return;
            }
            // this._mouseMoveSource$ = this._mouseMoveSource$ || this._earth.eventSource.mouse.get('MOUSE_MOVE');
            this._mouseMoveSource$ = this._mouseMoveSource$ || this._earth.eventSource.mouse.mouseMove;
            this._mouseMoveSubscription = this._mouseMoveSource$.subscribe(this._onMouseMove.bind(this));
            this._leftClickSource$ = this._leftClickSource$ || this._earth.eventSource.mouse.get('LEFT_CLICK');
            this._leftClickSubscription = this._leftClickSource$.subscribe(this._onLeftClick.bind(this));
        }
    }, {
        key: '_pickFunc',
        value: function _pickFunc(pickedObject, pickedCzmObjProperty, pickedObjectProperty, actionOver, actionOut) {
            var alwaysOver = arguments.length > 5 && arguments[5] !== undefined ? arguments[5] : false;

            var pickedCzmObj = getPickedObjectID(pickedObject);
            if (pickedCzmObj) {
                if (pickedCzmObj === this[pickedCzmObjProperty] && pickedObject === this[pickedObjectProperty]) {
                    // do nothing
                    if (alwaysOver) {
                        _XbsjCzmObj2.default.hierachyExec(this[pickedCzmObjProperty], actionOver, this[pickedObjectProperty]);
                    }
                } else {
                    if (this[pickedCzmObjProperty] && this[pickedObjectProperty]) {
                        _XbsjCzmObj2.default.hierachyExec(this[pickedCzmObjProperty], actionOut, this[pickedObjectProperty]);
                    }
                    this[pickedObjectProperty] = undefined;
                    this[pickedCzmObjProperty] = undefined;

                    this[pickedObjectProperty] = pickedObject;
                    this[pickedCzmObjProperty] = pickedCzmObj;
                    _XbsjCzmObj2.default.hierachyExec(this[pickedCzmObjProperty], actionOver, this[pickedObjectProperty]);
                }
            } else {
                if (this[pickedCzmObjProperty] && this[pickedObjectProperty]) {
                    _XbsjCzmObj2.default.hierachyExec(this[pickedCzmObjProperty], actionOut, this[pickedObjectProperty]);
                }
                this[pickedObjectProperty] = undefined;
                this[pickedCzmObjProperty] = undefined;
            }
        }
    }, {
        key: '_onMouseMove',
        value: function _onMouseMove(movement) {
            if (this.hoverEnable) {
                // pickTranslucentDepth是为了拾取位置坐标的，不是为了拾取物体准备的，这里这样设置没有意义
                // 另外一点需要注意的是 scene.pick之后不能进行 pickPosition的操作，这样会导致拾取结果不准
                // 测量模块解决此问题的办法是把pickPosition放到onTick事件中去做，因为onTick会先于leftClick执行，所以确保了pickPosition在之前操作
                // 如果pickPosition只能在scene.pick之后操作的话，需要先执行scene.render()，然后再调用pickPosition
                // const originPickTranslucentDepth = this._earth.czm.scene.pickTranslucentDepth;
                // this._earth.czm.scene.pickTranslucentDepth = false;    

                var pickedObject = this._earth.czm.scene.pick(movement.endPosition);
                this._pickFunc(pickedObject, '_hoveredObj', '_hoveredAttachedInfo', 'onmouseover', 'onmouseout');
                // this._earth.czm.scene.pickTranslucentDepth = originPickTranslucentDepth;
            }
        }
    }, {
        key: '_onLeftClick',
        value: function _onLeftClick(movement) {
            // const originPickTranslucentDepth = this._earth.czm.scene.pickTranslucentDepth;
            // this._earth.czm.scene.pickTranslucentDepth = false;

            var pickedObject = this._earth.czm.scene.pick(movement.position);
            this._pickFunc(pickedObject, '_clickedObj', '_clickedAttachedInfo', 'onclick', 'onclickout', true);
            // this._earth.czm.scene.pickTranslucentDepth = originPickTranslucentDepth;
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            if (this.enabled && this.shouldEnabled) {
                return;
            }

            this._mouseMoveSubscription = this._mouseMoveSubscription && this._mouseMoveSubscription.unsubscribe();
            this._leftClickSubscription = this._leftClickSubscription && this._leftClickSubscription.unsubscribe();

            this._pickFunc(undefined, '_hoveredObj', '_hoveredAttachedInfo', 'onmouseover', 'onmouseout');
            this._pickFunc(undefined, '_clickedObj', '_clickedAttachedInfo', 'onclick', 'onclickout', true);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._cancel();
            this._mouseMoveSource$ = undefined;
            return (0, _get3.default)(Picking.prototype.__proto__ || (0, _getPrototypeOf2.default)(Picking.prototype), 'destroy', this).call(this);
        }
    }]);
    return Picking;
}(_XbsjBase3.default);

Picking.defaultOptions = {
    /**
     * 鼠标滑过时是否响应
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Picking
     */
    hoverEnable: true,
    /**
     * 鼠标点击时拾取对象的高亮颜色设置 [r, g, b, a]
     * @description 长度为4的数组，分别表示 [r, g, b, a]，元素取值范围0-1之间
     * @type {number[]}
     * @default [1, 0, 0, 1]
     * @instance
     * @memberof Picking
     */
    clickedColor: [1, 0, 0, 1], //红色
    /**
     * 鼠标划过时拾取对象的高亮颜色设置 [r, g, b, a]
     * @description 长度为4的数组，分别表示 [r, g, b, a]，元素取值范围0-1之间
     * @type {number[]}
     * @default [1, 1, 0, 1]
     * @instance
     * @memberof Picking
     */
    hoveredColor: [1, 1, 0, 1] //黄色
};

Picking.registerPickingParent = _registerPickingParent2.default;

exports.default = Picking;

/***/ }),
/* 449 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _Tileset = __webpack_require__(91);

var _Tileset2 = _interopRequireDefault(_Tileset);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function highlight(feature, owner, pickedObject, pickedColor, result) {
    if (owner instanceof _Tileset2.default && pickedObject instanceof Cesium.Cesium3DTileFeature && !pickedObject.tileset.isDestroyed()) {
        var id = pickedObject.getProperty('id');
        var tileset = owner._tileset;

        if (feature.tileset === tileset && feature.getProperty('id') === id) {
            if (!result) {
                result = new Cesium.Color();
            }

            result.red = pickedColor[0];
            result.green = pickedColor[1];
            result.blue = pickedColor[2];
            result.alpha = pickedColor[3];

            return result;
        }
    } else {
        return undefined;
    }
}

function createDefaultTilesetPickingStyle(picking) {
    var pickingStyle = new Cesium.Cesium3DTileStyle({});
    pickingStyle.color = {
        evaluateColor: function evaluateColor(feature, result) {
            var xbsjTileset = feature && feature.tileset && feature.tileset.xbsjTileset;

            if (xbsjTileset) {
                if (xbsjTileset._clickedAttachedInfo && highlight(feature, xbsjTileset, xbsjTileset._clickedAttachedInfo, picking.clickedColor, result)) {
                    return result;
                }

                if (xbsjTileset._hoveredAttachedInfo && highlight(feature, xbsjTileset, xbsjTileset._hoveredAttachedInfo, picking.hoveredColor, result)) {
                    return result;
                }
            }

            return Cesium.Color.clone(Cesium.Color.WHITE, result);
        }
    };

    return pickingStyle;
}

exports.default = createDefaultTilesetPickingStyle;

/***/ }),
/* 450 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _PositionPicking = __webpack_require__(451);

var _PositionPicking2 = _interopRequireDefault(_PositionPicking);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var PositionPickingBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(PositionPickingBinding, _XbsjInteractionBindi);

    function PositionPickingBinding(earth) {
        (0, _classCallCheck3.default)(this, PositionPickingBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PositionPickingBinding.__proto__ || (0, _getPrototypeOf2.default)(PositionPickingBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._positionPicking = new _PositionPicking2.default(earth);
        _this.disposers.push(function () {
            return _this._positionPicking = _this._positionPicking && _this._positionPicking.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(PositionPickingBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            if (this._disableProperty) {
                throw new Error('_disableProperty should not be defined!');
            }

            var originPosition = [].concat((0, _toConsumableArray3.default)(target.position));

            var positionBinding = (0, _bind2.default)(this._positionPicking, 'position', target, 'position');
            var disableProperty = _XbsjEditing2.default.enableProperty(this._positionPicking, function () {
                if (!_this2._positionPicking.steps.lastStep) {
                    var _positionPicking$posi;

                    (_positionPicking$posi = _this2._positionPicking.position).splice.apply(_positionPicking$posi, [0, 3].concat((0, _toConsumableArray3.default)(originPosition)));
                }
                _this2.target = undefined;
            });

            this._disableProperty = function () {
                disableProperty();
                positionBinding();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableProperty = this._disableProperty && this._disableProperty();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(PositionPickingBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(PositionPickingBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'positionPicking',
        get: function get() {
            return this._positionPicking;
        }
    }]);
    return PositionPickingBinding;
}(_XbsjInteractionBinding2.default);

exports.default = PositionPickingBinding;

/***/ }),
/* 451 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _mobx = __webpack_require__(2);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var PositionPicking = function (_XbsjEditing) {
    (0, _inherits3.default)(PositionPicking, _XbsjEditing);

    function PositionPicking(earth) {
        (0, _classCallCheck3.default)(this, PositionPicking);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PositionPicking.__proto__ || (0, _getPrototypeOf2.default)(PositionPicking)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            position: [0, 0, 0]
        });

        // 这地方的代码完全可以挪出去独立开
        _this._points = new _Points2.default(earth);
        _this._points.points.push({});
        _this._points.points[0].color.splice(0, 4, 1, 1, 0, 1.0);
        _this.disposers.push(function () {
            return _this._points = _this._points && _this._points.destroy();
        });

        _this.disposers.push((0, _mobx.autorun)(function () {
            if (_this.position && _this.enabled) {
                var point = _this._points.points[0];
                _this.position.forEach(function (p, i) {
                    return point.position[i] = p;
                });
                _this._points.show = true;
            } else {
                _this._points.show = false;
            }
        }));
        return _this;
    }

    (0, _createClass3.default)(PositionPicking, [{
        key: '_init',
        value: function _init() {
            var _this2 = this;

            this.mouseMove$ = this.mouseMove$ || this._earth.eventSource.mouse.mouseMovePickedPosition;
            this.leftClick$ = this.leftClick$ || this._earth.eventSource.mouse.leftClickPickedPosition;
            this.rightClick$ = this.rightClick$ || this._earth.eventSource.mouse.rightClick;

            this._stepsOp = this._stepsOp || [[this.mouseMove$, function (_ref) {
                var position = _ref.position;

                if (position) {
                    position.forEach(function (p, i) {
                        return _this2.position[i] = p;
                    });
                }
            }, this.leftClick$, function (_ref2) {
                var position = _ref2.position;

                if (position) {
                    position.forEach(function (p, i) {
                        return _this2.position[i] = p;
                    });
                    _this2._steps.next();
                }
            }, this.rightClick$, function () {
                _this2._steps.enabled = false;
            }]];

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this3 = this;

            this._init();

            if (this._steps.enabled) {
                throw new Error('_disableSteps should be undefined!');
            }
            this._disableSteps = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this3.enabled = false;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableSteps = this._disableSteps && this._disableSteps();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(PositionPicking.prototype.__proto__ || (0, _getPrototypeOf2.default)(PositionPicking.prototype), 'destroy', this).call(this);
        }
    }]);
    return PositionPicking;
}(_XbsjEditing3.default);

exports.default = PositionPicking;

/***/ }),
/* 452 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _DirectionEditing = __webpack_require__(453);

var _DirectionEditing2 = _interopRequireDefault(_DirectionEditing);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// class DirectionCameraBinding {
var DirectionCameraBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(DirectionCameraBinding, _XbsjInteractionBindi);

    function DirectionCameraBinding(earth) {
        (0, _classCallCheck3.default)(this, DirectionCameraBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DirectionCameraBinding.__proto__ || (0, _getPrototypeOf2.default)(DirectionCameraBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        });

        _this._falseCamera = new Cesium.Camera(_this._earth.czm.scene);

        _this._directionEditing = new _DirectionEditing2.default(earth);
        _this.disposers.push(function () {
            return _this._directionEditing = _this._directionEditing && _this._directionEditing.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(DirectionCameraBinding, [{
        key: '_start',
        value: function _start(cameraLike) {
            var _this2 = this;

            if (this._disabledProperty) {
                throw new Error('_disabledProperty should not be defined!');
            }

            var originFar = cameraLike.far;
            var originPosition = [].concat((0, _toConsumableArray3.default)(cameraLike.position));
            var originRotation = [].concat((0, _toConsumableArray3.default)(cameraLike.rotation));

            var disableBinding = (0, _mobx.reaction)(function () {
                return {
                    pos0: _this2._directionEditing.position0 ? [].concat((0, _toConsumableArray3.default)(_this2._directionEditing.position0)) : undefined,
                    pos1: _this2._directionEditing.position1 ? [].concat((0, _toConsumableArray3.default)(_this2._directionEditing.position1)) : undefined
                };
            }, function (_ref) {
                var pos0 = _ref.pos0,
                    pos1 = _ref.pos1;

                if (!pos0 || !pos1) {
                    return;
                }
                _this2._updateCameraLike(pos0, pos1, cameraLike);
            });

            var disabledProperty = _XbsjEditing2.default.enableProperty(this._directionEditing, function () {
                if (!_this2._directionEditing.steps.lastStep) {
                    cameraLike.far = originFar;
                    cameraLike.position = originPosition;
                    cameraLike.rotation = originRotation;
                }
                _this2.target = undefined;
            });

            this._disabledProperty = function () {
                disabledProperty();
                disableBinding();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disabledProperty = this._disabledProperty && this._disabledProperty();
        }
    }, {
        key: '_updateCameraLike',
        value: function _updateCameraLike(srcPos0, srcPos1, cameraLike) {
            var _Cesium$Cartesian, _Cesium$Cartesian2;

            this._scratchPos0 = this._scratchPos0 || new Cesium.Cartesian3();
            this._scratchPos1 = this._scratchPos1 || new Cesium.Cartesian3();
            this._scratchUp = this._scratchUp || new Cesium.Cartesian3();
            this._scratchDir = this._scratchDir || new Cesium.Cartesian3();
            var pos0 = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(srcPos0).concat([undefined, this._scratchPos0]));
            var pos1 = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(srcPos1).concat([undefined, this._scratchPos1]));
            var far = Cesium.Cartesian3.distance(pos0, pos1);
            cameraLike.far = Math.max(far, cameraLike.near + 0.01);
            cameraLike.position = [].concat((0, _toConsumableArray3.default)(srcPos0));
            var dir = Cesium.Cartesian3.subtract(pos1, pos0, this._scratchDir);
            dir = Cesium.Cartesian3.normalize(dir, dir);
            var up = Cesium.Cartesian3.normalize(pos0, this._scratchUp);
            up = Cesium.Cartesian3.normalize(up, up);
            this._falseCamera && this._falseCamera.setView({
                destination: pos0,
                orientation: {
                    direction: dir,
                    up: up
                }
            });
            cameraLike.rotation = [this._falseCamera.heading, this._falseCamera.pitch, this._falseCamera.roll];
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(DirectionCameraBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(DirectionCameraBinding.prototype), 'destroy', this).call(this);
        }
    }]);
    return DirectionCameraBinding;
}(_XbsjInteractionBinding2.default);

exports.default = DirectionCameraBinding;

/***/ }),
/* 453 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _mobx = __webpack_require__(2);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function copyPosition(dest, src) {
    dest[0] = src[0];
    dest[1] = src[1];
    dest[2] = src[2];
}

var DirectionEditing = function (_XbsjEditing) {
    (0, _inherits3.default)(DirectionEditing, _XbsjEditing);

    function DirectionEditing(earth) {
        (0, _classCallCheck3.default)(this, DirectionEditing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DirectionEditing.__proto__ || (0, _getPrototypeOf2.default)(DirectionEditing)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            position0: undefined,
            position1: undefined
        });

        // 这地方的代码完全可以挪出去独立开
        _this._points = new _Points2.default(earth);
        _this.disposers.push(function () {
            return _this._points = _this._points && _this._points.destroy();
        });
        _this._points.points.push({});
        _this._points.points.push({});

        _this._polylineArrow = new _Polyline2.default(earth);
        _this.disposers.push(function () {
            return _this._polylineArrow = _this._polylineArrow && _this._polylineArrow.destroy();
        });
        _this._polylineArrow.material = {
            type: 'XbsjPolylineArrowMaterial',
            XbsjPolylineArrowMaterial: {
                color: [1, 1, 0, 1.0]
            }
        };
        _this._polylineArrow.depthTest = false;
        _this._polylineArrow.width = 20;

        _this._polylineArrow.positions.push([0, 0, 0]);
        _this._polylineArrow.positions.push([0, 0, 0]);

        _this.disposers.push((0, _mobx.autorun)(function () {
            if (_this.position0 && _this.enabled) {
                _this._points.points[0].show = true;
                copyPosition(_this._points.points[0].position, _this.position0);
            } else {
                _this._points.points[0].show = false;
            }

            if (_this.position1 && _this.enabled) {
                _this._points.points[1].show = true;
                copyPosition(_this._points.points[1].position, _this.position1);
            } else {
                _this._points.points[1].show = false;
            }

            if (_this.position0 && _this.position1 && _this.enabled) {
                _this._polylineArrow.show = true;
                copyPosition(_this._polylineArrow.positions[0], _this.position0);
                copyPosition(_this._polylineArrow.positions[1], _this.position1);
            } else {
                _this._polylineArrow.show = false;
            }
        }));
        return _this;
    }

    (0, _createClass3.default)(DirectionEditing, [{
        key: '_init',
        value: function _init() {
            var _this2 = this;

            this.mouseMove$ = this.mouseMove$ || this._earth.eventSource.mouse.mouseMovePickedPosition;
            this.leftClick$ = this.leftClick$ || this._earth.eventSource.mouse.leftClickPickedPosition;
            this.rightClick$ = this.rightClick$ || this._earth.eventSource.mouse.rightClick;

            this._stepsOp = this._stepsOp || [[this.mouseMove$, function (_ref) {
                var position = _ref.position;

                if (position) {
                    _this2.position0 = _this2.position0 || [0, 0, 0];
                    copyPosition(_this2.position0, position);
                }
            }, this.leftClick$, function (_ref2) {
                var position = _ref2.position;

                if (position) {
                    _this2.position0 = _this2.position0 || [0, 0, 0];
                    copyPosition(_this2.position0, position);
                    _this2._steps.next();
                }
            }, this.rightClick$, function (movement) {
                _this2._steps.enabled = false;
            }], [this.mouseMove$, function (_ref3) {
                var position = _ref3.position;

                if (position) {
                    _this2.position1 = _this2.position1 || [0, 0, 0];
                    copyPosition(_this2.position1, position);
                }
            }, this.leftClick$, function (_ref4) {
                var position = _ref4.position;

                if (position) {
                    _this2.position1 = _this2.position1 || [0, 0, 0];
                    copyPosition(_this2.position1, position);
                    _this2._steps.next();
                }
            }, this.rightClick$, function (movement) {
                console.log('rightClick 0');
                _this2.position1 = undefined;
                _this2._steps.prev();
            }]];

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this3 = this;

            this._init();

            this.position0 = undefined;
            this.position1 = undefined;

            if (this._disableSteps) {
                throw new Error('_disableSteps should be undefined!');
            }
            this._disableSteps = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this3.enabled = false;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableSteps = this._disableSteps && this._disableSteps();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(DirectionEditing.prototype.__proto__ || (0, _getPrototypeOf2.default)(DirectionEditing.prototype), 'destroy', this).call(this);
        }
    }]);
    return DirectionEditing;
}(_XbsjEditing3.default);

exports.default = DirectionEditing;

/***/ }),
/* 454 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _CoordinatesMoving = __webpack_require__(130);

var _CoordinatesMoving2 = _interopRequireDefault(_CoordinatesMoving);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var MovableObjectBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(MovableObjectBinding, _XbsjInteractionBindi);

    function MovableObjectBinding(earth) {
        (0, _classCallCheck3.default)(this, MovableObjectBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MovableObjectBinding.__proto__ || (0, _getPrototypeOf2.default)(MovableObjectBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._coordinatesMove = new _CoordinatesMoving2.default(earth);
        _this.disposers.push(function () {
            _this._coordinatesMove = _this._coordinatesMove && _this._coordinatesMove.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(MovableObjectBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            if (this._disableMoving) {
                throw new Error('_disableMoving should not be true!');
            }

            var unbindingPosition = (0, _bind2.default)(this._coordinatesMove, 'position', target, 'position');
            var disabledMoving = _XbsjEditing2.default.enableProperty(this._coordinatesMove, function () {
                return _this2.target = undefined;
            });
            this._disableMoving = function () {
                disabledMoving && disabledMoving();
                unbindingPosition && unbindingPosition();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableMoving = this._disableMoving && this._disableMoving();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(MovableObjectBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(MovableObjectBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'coordinatesMove',
        get: function get() {
            return this._coordinatesMove;
        }
    }]);
    return MovableObjectBinding;
}(_XbsjInteractionBinding2.default);

exports.default = MovableObjectBinding;

/***/ }),
/* 455 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var scratchBs = void 0;
var scratchCartesian = void 0;
var scratchRay = void 0;
var scratchCarto = void 0;

// 模拟鼠标和指定半径的球体相交，用于求取某高度上的虚拟交点
function pickVirtualSphere(scene, windowCoordinates, radius, result) {
    scratchBs = scratchBs || new Cesium.BoundingSphere();
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchRay = scratchRay || new Cesium.Ray();
    scratchCarto = scratchCarto || new Cesium.Cartographic();

    var ray = scene.camera.getPickRay(windowCoordinates, scratchRay);
    var bs = scratchBs;
    bs.radius = radius;
    var intersection = Cesium.IntersectionTests.raySphere(ray, bs);

    if (intersection) {
        var dis = intersection.start > 0 ? intersection.start : intersection.end;
        if (dis) {
            // dis仍然有可能为undefined，所以此处加一个判断
            var cartesian = Cesium.Ray.getPoint(ray, dis, scratchCartesian);
            var carto = Cesium.Cartographic.fromCartesian(cartesian, undefined, scratchCarto);
            if (!result) {
                result = [0, 0, 0];
            }
            result[0] = carto.longitude;
            result[1] = carto.latitude;
            result[2] = carto.height;
            return result;
        } else {
            return undefined;
        }
    } else {
        return undefined;
    }
}

exports.default = pickVirtualSphere;

/***/ }),
/* 456 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var scratchBs = void 0;
var scratchCartesian = void 0;
var scratchCartesian2 = void 0;
var scratchCartesian3 = void 0;
var scratchRay = void 0;
var scratchCarto = void 0;
var scratchPlane = void 0;

// 求取绕向上轴构成的某个平面与鼠标相交，
// 目前这个平面假定为向上轴和相机right轴构成
function pickHeightPosition(scene, position, windowCoordinates, result) {
    var _Cesium$Cartesian;

    scratchBs = scratchBs || new Cesium.BoundingSphere();
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchCartesian2 = scratchCartesian2 || new Cesium.Cartesian3();
    scratchCartesian3 = scratchCartesian3 || new Cesium.Cartesian3();
    scratchRay = scratchRay || new Cesium.Ray();
    scratchCarto = scratchCarto || new Cesium.Cartographic();
    scratchPlane = scratchPlane || new Cesium.Plane(Cesium.Cartesian3.UNIT_X, 0.0);

    // 模型高度方向和相机right方向建立plane
    var pivot = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, scratchCartesian]));
    var pivotNormal = Cesium.Cartesian3.normalize(pivot, scratchCartesian2);

    var planeNormal = Cesium.Cartesian3.cross(scene.camera.right, pivotNormal, scratchCartesian2);

    // 计算过北极的面片，方便以后做平面平移
    // const scratchCC = new Cesium.Cartesian3(0, 0, 6378137);
    // const pivotToNorth = Cesium.Cartesian3.subtract(scratchCC, pivot, scratchCC);
    // const pivotEast = Cesium.Cartesian3.cross(pivotToNorth, pivotNormal, new Cesium.Cartesian3());
    // const planeNormal = pivotEast;

    Cesium.Cartesian3.normalize(planeNormal, planeNormal);
    var plane = Cesium.Plane.fromPointNormal(pivot, planeNormal, scratchPlane);

    // 相机拾取射线求交这个plane
    var ray = scene.camera.getPickRay(windowCoordinates, scratchRay);
    var intersect = Cesium.IntersectionTests.rayPlane(ray, plane, scratchCartesian3);
    if (!intersect) {
        return undefined;
    }

    var carto = Cesium.Cartographic.fromCartesian(intersect, undefined, scratchCarto);
    if (!result) {
        result = [0, 0, 0];
    }

    result[0] = carto.longitude;
    result[1] = carto.latitude;
    result[2] = carto.height;

    // 交点如果在高度线上，则高亮

    return result;
}

exports.default = pickHeightPosition;

/***/ }),
/* 457 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _CirclesRotating = __webpack_require__(194);

var _CirclesRotating2 = _interopRequireDefault(_CirclesRotating);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var RotatableObjectBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(RotatableObjectBinding, _XbsjInteractionBindi);

    function RotatableObjectBinding(earth) {
        (0, _classCallCheck3.default)(this, RotatableObjectBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RotatableObjectBinding.__proto__ || (0, _getPrototypeOf2.default)(RotatableObjectBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._circlesRotating = new _CirclesRotating2.default(earth);
        _this.disposers.push(function () {
            return _this._circlesRotating = _this._circlesRotating && _this._circlesRotating.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(RotatableObjectBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            if (this._disableRotating) {
                throw new Error('_disableRotating should not be true!');
            }

            this._circlesRotating.isCameraLike = target.isCameraLike;

            var disposers = [];
            if (target.isCameraLike) {
                disposers.push((0, _bind2.default)(this._circlesRotating, 'position', target, 'position'));
                // 相机模式下，heading角度0指向北
                disposers.push((0, _bind2.default)(this._circlesRotating, 'rotation', target, 'rotation', {
                    r1Tor2: function r1Tor2(r1, result) {
                        return result.splice(0, 3, r1[0] + Math.PI * 0.5, r1[1], r1[2]), result;
                    },
                    r2Tor1: function r2Tor1(r2, result) {
                        return result.splice(0, 3, r2[0] - Math.PI * 0.5, r2[1], r2[2]), result;
                    },
                    equals: function equals(r1, r2) {
                        var ee = Cesium.Math.equalsEpsilon;
                        var e1 = ee(r1[0] + Math.PI * 0.5, r2[0], 0, Cesium.Math.EPSILON4);
                        return e1 && r1[1] === r2[1] && r1[2] === r2[2];
                    }
                }));
            } else {
                disposers.push((0, _bind2.default)(this._circlesRotating, 'position', target, 'position'));
                disposers.push((0, _bind2.default)(this._circlesRotating, 'rotation', target, 'rotation'));
            }

            var disabledRotating = _XbsjEditing2.default.enableProperty(this._circlesRotating, function () {
                return _this2.target = undefined;
            });

            this._disableRotating = function () {
                disabledRotating && disabledRotating();
                disposers.forEach(function (d) {
                    return d();
                });
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableRotating = this._disableRotating && this._disableRotating();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(RotatableObjectBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(RotatableObjectBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._circlesRotating;
        }
    }]);
    return RotatableObjectBinding;
}(_XbsjInteractionBinding2.default);

exports.default = RotatableObjectBinding;

/***/ }),
/* 458 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var scratchRay = void 0;
var scratchPlane = void 0;

function pickVirtualPlane(scene, planePivot, planeNormal, windowCoordinates, result) {
    result = result || new Cesium.Cartesian3();

    scratchRay = scratchRay || new Cesium.Ray();
    scratchPlane = scratchPlane || new Cesium.Plane(Cesium.Cartesian3.UNIT_X, 0.0);

    var ray = scene.camera.getPickRay(windowCoordinates, scratchRay);
    var plane = Cesium.Plane.fromPointNormal(planePivot, planeNormal, scratchPlane);
    result = Cesium.IntersectionTests.rayPlane(ray, plane, result);

    return result;
}

exports.default = pickVirtualPlane;

/***/ }),
/* 459 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _CustomPrimitive = __webpack_require__(83);

var _CustomPrimitive2 = _interopRequireDefault(_CustomPrimitive);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Circle = function (_XbsjBase) {
    (0, _inherits3.default)(Circle, _XbsjBase);

    function Circle(earth) {
        (0, _classCallCheck3.default)(this, Circle);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Circle.__proto__ || (0, _getPrototypeOf2.default)(Circle)).call(this, earth));

        _this._primitive = new _CustomPrimitive2.default(earth);
        _this.disposers.push(function () {
            _this._primitive = _this._primitive && _this._primitive.destroy();
        });
        _this._primitive.modelMatrix = [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1];

        {
            var p = _this._primitive;
            p.positions = [-1, -1, 0, 1, -1, 0, 1, 1, 0, -1, 1, 0];
            // p.normals = [0,0,1,0,0,1,0,0,1,0,0,1];
            p.sts = [0, 0, 1, 0, 1, 1, 0, 1];
            // p.colors = [1,1,0,1, 1,1,1,1, 1,1,1,1, 1,1,1,1];
            p.indices = [0, 1, 2, 0, 2, 3];
            // p.rotation = [0, 1.57, 0];
            p.renderState = XE.Obj.CustomPrimitive.getRenderState(true, false);
            p.renderState.depthTest.enabled = false;
            p.pass = 8;
        }

        {
            _this._texture = new Cesium.Texture({
                context: earth.czm.scene.context,
                width: 256,
                height: 256,
                source: undefined,
                flipY: false
            });

            _this._primitive.texture = _this._texture;

            _this.disposers.push(function () {
                _this._texture = _this._texture && _this._texture.destroy();
                _this._primitive.texture = undefined;
            });
        }

        var canvas = document.createElement('canvas');
        canvas.width = 256;
        canvas.height = 256;
        _this._canvas = canvas;
        _this._ctx = canvas.getContext('2d');

        (0, _mobx.extendObservable)(_this, {
            modelMatrix: [1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1, 0, 0, 0, 0, 1],
            scale: 1.0,
            show: true,
            color: [1, 1, 0, 1],
            baseRotation: 0.0, // 对于cameraLike，即朝北时为0的情况，此时需要设置baseRotation为pi/2，否则为0。
            rotation: 0.0,
            startRotation: 0.0,
            endRotation: 0.0
        });

        _this._scratchMatrix = new Cesium.Matrix4();
        _this._scratchMatrix2 = new Cesium.Matrix4();
        _this._scratchMatrix3 = new Cesium.Matrix4();
        var updateCircle = function updateCircle() {
            var scaleMatrix = Cesium.Matrix4.fromUniformScale(_this.scale, _this._scratchMatrix);
            var rtMatrix = Cesium.Matrix4.fromColumnMajorArray(_this.modelMatrix, _this._scratchMatrix2);
            var modelMatrix = Cesium.Matrix4.multiply(rtMatrix, scaleMatrix, _this._scratchMatrix3);
            Cesium.Matrix4.toArray(modelMatrix, _this._primitive.modelMatrix);
        };

        updateCircle();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                modelMatrix: [].concat((0, _toConsumableArray3.default)(_this.modelMatrix)),
                scale: _this.scale
            };
        }, updateCircle));

        var updateCircle2 = function updateCircle2() {
            _this._primitive.show = _this.show;
        };

        updateCircle2();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                show: _this.show
            };
        }, updateCircle2));

        var updateTexture = function updateTexture() {
            var ctx = _this._ctx;
            var color = _this.color;
            var colorStr = 'rgba(' + (color[0] * 255 | 0) + ', ' + (color[1] * 255 | 0) + ', ' + (color[2] * 255 | 0) + ', ' + color[3] + ')';
            ctx.clearRect(0, 0, 256, 256);

            // 测试
            // ctx.lineWidth = 4;
            // ctx.beginPath();
            // ctx.moveTo(128, 128);
            // ctx.lineTo(128+64, 128);
            // ctx.strokeStyle = 'rgb(0, 0, 0)';
            // ctx.stroke();     

            // ctx.lineWidth = 2;
            // ctx.beginPath();
            // ctx.moveTo(128, 128);
            // // ctx.lineTo(128+64), 128);
            // ctx.lineTo(128+64*Math.cos(this.rotation), 128+64*Math.sin(this.rotation));
            // ctx.strokeStyle = colorStr;
            // ctx.stroke();

            ctx.lineWidth = 6;
            ctx.beginPath();
            ctx.arc(128, 128, 64, 0, Math.PI * 2, false); // 绘制
            ctx.strokeStyle = 'rgba(0, 0, 0, ' + color[3] + ')';
            ctx.stroke();

            ctx.lineWidth = 4;
            ctx.beginPath();
            ctx.arc(128, 128, 64, 0, Math.PI * 2, false); // 绘制
            ctx.strokeStyle = colorStr;
            ctx.stroke();

            // {
            //     ctx.lineWidth = 4;
            //     ctx.beginPath();

            //     let startRotation = Cesium.Math.zeroToTwoPi(this.startRotation);
            //     let endRotation = Cesium.Math.zeroToTwoPi(this.endRotation);
            //     if (endRotation < startRotation) {
            //         endRotation += (Math.PI * 2.0);
            //     }
            //     ctx.moveTo(128, 128);
            //     ctx.arc(128, 128, 64, startRotation, endRotation, (endRotation - startRotation) > Math.PI); // 绘制
            //     ctx.lineTo(128, 128);

            //     ctx.fillStyle = 'rgba(255, 255, 255, 0.5)';
            //     ctx.fill();
            // }

            {
                ctx.lineWidth = 1;
                ctx.beginPath();

                var startRotation = Cesium.Math.zeroToTwoPi(_this.startRotation);
                var endRotation = Cesium.Math.zeroToTwoPi(_this.endRotation);
                if (endRotation < startRotation) {
                    endRotation += Math.PI * 2.0;
                }

                if (_this.startRotation !== _this.endRotation || _this.startRotation !== 0.0) {
                    ctx.moveTo(128, 128);
                    ctx.arc(128, 128, 64, startRotation, endRotation, endRotation - startRotation > Math.PI); // 绘制
                    ctx.lineTo(128, 128);

                    ctx.strokeStyle = 'rgba(255, 255, 0, 1.0)';
                    ctx.stroke();
                }
            }

            var rotation = Cesium.Math.negativePiToPi(_this.rotation);
            var baseRotation = _this.baseRotation;
            {
                ctx.lineWidth = 3;
                ctx.beginPath();
                ctx.moveTo(128, 128);
                // ctx.arc(128, 128, 64, 0, rotation, rotation < 0); // 绘制
                // baseRotation 可能是0，也可能是pi/2,需要确保绘制较短的弧线！
                // Cesium.Math.negativePiToPi(rotation - baseRotation) < 0 用来寻找最短弧线
                ctx.arc(128, 128, 64, baseRotation, rotation, Cesium.Math.negativePiToPi(rotation - baseRotation) < 0); // 绘制
                ctx.lineTo(128, 128);
                // ctx.strokeStyle = "yellow";
                // ctx.stroke();  
                // ctx.fillStyle = "rgba(255, 255, 0, 0.5)";
                ctx.fillStyle = 'rgba(' + (color[0] * 255 | 0) + ', ' + (color[1] * 255 | 0) + ', ' + (color[2] * 255 | 0) + ', 0.5)';
                ctx.fill();
            }

            {
                ctx.save();
                ctx.font = "16px console";
                ctx.textBaseline = "middle";
                var rotationOnCircle = Cesium.Math.negativePiToPi(rotation - baseRotation);
                var angle = (rotationOnCircle * 180.0 / Math.PI * 10 | 0) / 10;
                var angleStr = -angle + '\xB0';
                var width = ctx.measureText(angleStr).width; // TextMetrics object
                ctx.translate(128, 128);
                ctx.rotate(Math.PI * 0.5);
                // ctx.rotate(rotation * 0.5);
                // baseRotation为pi/2时，以下旋转有一部分不是最短圆弧的中心点
                // ctx.rotate((rotation + baseRotation) * 0.5);
                // 需要先把rotation转到-90-270，这样+90再除2就刚好落在最短圆弧中心点
                rotation = Cesium.Math.negativePiToPi(rotation - baseRotation) + baseRotation; // 对于baseRotation为90时，范围在-90-270；对于baserotation为0时，范围在-180-180
                ctx.rotate((rotation + baseRotation) * 0.5);
                ctx.scale(-1, 1);
                ctx.translate(-128, -128);
                ctx.fillStyle = 'white';
                ctx.fillText(angleStr, 128 - width * 0.5, 128 - 64 - 10);
                ctx.lineWidth = 1;
                // ctx.strokeStyle = 'black';
                // ctx.strokeText(angleStr, 128-width*0.5, 128-64-10);

                ctx.restore();
            }

            _this._texture.copyFrom(_this._canvas);
        };

        updateTexture();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                color: [].concat((0, _toConsumableArray3.default)(_this.color)),
                rotation: _this.rotation,
                startRotation: _this.startRotation,
                endRotation: _this.endRotation,
                baseRotation: _this.baseRotation
            };
        }, updateTexture));
        return _this;
    }

    return Circle;
}(_XbsjBase3.default);

exports.default = Circle;

/***/ }),
/* 460 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _mobx = __webpack_require__(2);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _bind = __webpack_require__(10);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function extendKeyMap(PolylinePointAdding) {
    Object.defineProperty(PolylinePointAdding.prototype, '_actionMapDirty', {
        get: function get() {
            return typeof this.__actionMapDirty === 'undefined' ? true : this.__actionMapDirty;
        },
        set: function set(val) {
            this.__actionMapDirty = !!val;
        }
    });

    // Object.defineProperty(PolylinePointAdding.prototype, 'addingAction', {
    //     /***
    //      * @returns {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
    //      */
    //     get () {
    //         return this._addingAction || 'LEFTCLICK';
    //     },
    //     /***
    //      * @param val {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
    //      */
    //     set (val) {
    //         if (this.addingAction !== val) {
    //             this._addingAction = val;
    //             this._actionMapDirty = true;
    //         }
    //     }
    // });

    Object.defineProperty(PolylinePointAdding.prototype, 'deletingAction', {
        /***
         * @returns {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
         */
        get: function get() {
            return this._deletingAction || 'RIGHTCLICK';
            // return this._deletingAction || 'SHIFT_RIGHTCLICK';
        },

        /***
         * @param val {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
         */
        set: function set(val) {
            if (this.deletingAction !== val) {
                this._deletingAction = val;
                this._actionMapDirty = true;
            }
        }
    });

    Object.defineProperty(PolylinePointAdding.prototype, 'endAction', {
        /***
         * @returns {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
         */
        get: function get() {
            return this._endAction || 'SHIFT_RIGHTCLICK';
            // return this._endAction || 'RIGHTCLICK';
        },

        /***
         * @param val {'LEFTCLICK' | 'RIGHTCLICK' | 'CTRL_LEFTCLICK' | 'CTRL_RIGHTCLICK' | 'SHIFT_LEFTCLICK' | 'SHIFT_RIGHTCLICK'}
         */
        set: function set(val) {
            if (this.endAction !== val) {
                this._endAction = val;
                this._actionMapDirty = true;
            }
        }
    });
}

var PolylinePointAdding = function (_XbsjEditing) {
    (0, _inherits3.default)(PolylinePointAdding, _XbsjEditing);

    function PolylinePointAdding(earth) {
        (0, _classCallCheck3.default)(this, PolylinePointAdding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PolylinePointAdding.__proto__ || (0, _getPrototypeOf2.default)(PolylinePointAdding)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            positions: [],
            rotations: undefined,
            loop: false,
            fixedPositionsNum: undefined,
            polylineShow: true
        });

        // 这是为了防止positions被换成新的数组，从而导致下面的observe失效！
        _this.disposers.push((0, _mobx.intercept)(_this, 'positions', function (changed) {
            if (changed.type === 'update') {
                var _this$positions;

                (_this$positions = _this.positions).splice.apply(_this$positions, [0, _this.positions.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
            }

            return null;
        }));

        _this.disposers.push((0, _mobx.intercept)(_this.positions, function (changed) {
            if (changed.type === 'splice') {
                if (_this.rotations) {
                    var _this$rotations;

                    var news = new Array(changed.added.length).fill([0, 0, 0]);
                    (_this$rotations = _this.rotations).splice.apply(_this$rotations, [changed.index, changed.removedCount].concat((0, _toConsumableArray3.default)(news)));
                }
            }

            return changed;
        }));

        _this._createHelpers();
        return _this;
    }

    (0, _createClass3.default)(PolylinePointAdding, [{
        key: '_createHelpers',
        value: function _createHelpers() {
            var _this2 = this;

            var earth = this._earth;
            // 这地方的代码完全可以挪出去独立开
            this._points = new _Points2.default(earth);
            this.disposers.push(function () {
                return _this2._points = _this2._points && _this2._points.destroy();
            });
            this._points.forcePass = Cesium.Pass.OVERLAY;

            this._polyline = new _Polyline2.default(earth);
            this._polyline.material['XbsjColorMaterial'].color.splice(0, 4, 1, 1, 0, 1.0);
            this._polyline.depthTest = false;
            this._polyline.material.type = 'XbsjColorMaterial';
            this._polyline.width = 2;
            this.disposers.push(function () {
                return _this2._polyline = _this2._polyline && _this2._polyline.destroy();
            });

            this.disposers.push((0, _bind.track)(this._polyline, 'loop', this, 'loop'));

            this.disposers.push((0, _mobx.autorun)(function () {
                // console.log(this._points);
                var diffLen = _this2.positions.length - _this2._points.points.length;
                if (diffLen > 0) {
                    for (var i = 0; i < diffLen; ++i) {
                        _this2._points.points.push({});
                    }
                } else if (diffLen < 0) {
                    for (var _i = 0; _i < -diffLen; ++_i) {
                        _this2._points.points[_this2.positions.length + _i].show = false;
                        _this2._points.points[_this2.positions.length + _i].color.splice(0, 4, 1, 1, 0, 1.0);
                    }
                }

                _this2.positions.forEach(function (value, index) {
                    var _points$points$index$;

                    _this2._points.points[index].show = _this2.enabled;
                    (_points$points$index$ = _this2._points.points[index].position).splice.apply(_points$points$index$, [0, 3].concat((0, _toConsumableArray3.default)(value)));
                });

                _this2._polyline.positions = _this2.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                });
                _this2._polyline.show = _this2.enabled && _this2.polylineShow;
            }));
        }
    }, {
        key: '_isNearFirstPos',
        value: function _isNearFirstPos(position, tolerance) {
            var _Cesium$Cartesian, _Cesium$Cartesian2;

            this._currentCartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(position).concat([undefined, this._currentCartesian]));
            this._currentPosition = this._earth.czm.scene.cartesianToCanvasCoordinates(this._currentCartesian, this._currentPosition);

            this._firstCartesian = (_Cesium$Cartesian2 = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian2, (0, _toConsumableArray3.default)(this.positions[0]).concat([undefined, this._firstCartesian]));
            this._firstPosition = this._earth.czm.scene.cartesianToCanvasCoordinates(this._firstCartesian, this._firstPosition);

            if (this._firstPosition && this._currentPosition) {
                // const d0 = this._firstCartesian.x - position[0];
                // const d1 = this._firstCartesian.y - position[1];
                // return  (d0*d0 + d1*d1) < (tolerance * tolerance);
                return Cesium.Cartesian2.distanceSquared(this._currentPosition, this._firstPosition) < tolerance * tolerance;
            } else {
                return false;
            }
        }

        /***
         * @param actionType {}
         */

    }, {
        key: '_getClickAction',
        value: function _getClickAction(actionType) {
            var mouse = this._earth.eventSource.mouse;
            this._actionMap = this._actionMap || {
                'LEFTCLICK': mouse.leftClick,
                'RIGHTCLICK': mouse.rightClick,
                'CTRL_LEFTCLICK': mouse.ctrlLeftClick,
                'CTRL_RIGHTLICK': mouse.ctrlRightClick,
                'SHIFT_LEFTCLICK': mouse.shiftLeftClick,
                'SHIFT_RIGHTCLICK': mouse.shiftRightClick
            };
            return this._actionMap[actionType];
        }
    }, {
        key: '_init',
        value: function _init() {
            var _this3 = this;

            if (this._actionMapDirty) {
                this._actionMapDirty = false;

                this._stepsOp = undefined;
                this._steps = undefined;

                this.mouseMove$ = this.mouseMove$ || this._earth.eventSource.mouse.mouseMovePickedPosition;
                this.leftClick$ = this.leftClick$ || this._earth.eventSource.mouse.leftClickPickedPosition;

                this.deletingAction$ = this._getClickAction(this.deletingAction);
                this.endAction$ = this._getClickAction(this.endAction);
                // this.rightClick$ = this.rightClick$ || this._earth.eventSource.mouse.rightClick;
                // this.shiftRightClick$ = this.shiftRightClick$ || this._earth.eventSource.mouse.shiftRightClick;
                // this.ctrlRightClick$ = this.ctrlRightClick$ || this._earth.eventSource.mouse.ctrlRightClick;
            }

            if (!this._stepsOp) {
                var _stepsOp$, _stepsOp$2;

                this._stepsOp = [[this.mouseMove$, function (_ref) {
                    var position = _ref.position;

                    if (!position) {
                        return;
                    }

                    if (_this3.positions.length === 0) {
                        // this.positions.push([...position]);
                        // console.error('至少要有一个点！');
                    } else {
                        var targetPos = _this3.positions[_this3.positions.length - 1];
                        targetPos.splice.apply(targetPos, [0, 3].concat((0, _toConsumableArray3.default)(position)));

                        // if (this._isNearFirstPos(position, 5)) {
                        //     this._points.points[0].pixelSize = 16;
                        // } else {
                        //     this._points.points[0].pixelSize = 6;
                        // }
                    }
                }, this.leftClick$, function (_ref2) {
                    var position = _ref2.position;

                    if (!position) {
                        return;
                    }

                    if (_this3.positions.length === 0) {
                        _this3.positions.push([].concat((0, _toConsumableArray3.default)(position)));
                    } else {
                        var targetPos = _this3.positions[_this3.positions.length - 1];
                        targetPos.splice.apply(targetPos, [0, 3].concat((0, _toConsumableArray3.default)(position)));
                    }
                    // this._points.points[0].pixelSize = 6;

                    _this3.positions.push([].concat((0, _toConsumableArray3.default)(position)));

                    if (_this3.fixedPositionsNum && _this3.positions.length > _this3.fixedPositionsNum) {
                        _this3._steps.next();
                    }
                }]];

                this.deletingAction$ && (_stepsOp$ = this._stepsOp[0]).push.apply(_stepsOp$, [this.deletingAction$, function () {
                    // this._steps.next();
                    if (_this3.positions.length > 0) {
                        _this3.positions.pop();
                    }
                }]);

                this.endAction$ && (_stepsOp$2 = this._stepsOp[0]).push.apply(_stepsOp$2, [this.endAction$, function () {
                    _this3._steps.next(); // 下一步结束
                }]);
            }

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this4 = this;

            this._init();

            this.positions.length = 0; // 首先清除所有点坐标

            if (this.positions.length > 0) {
                this.positions.push(this.positions[0]); // 先加一个点，用于mouseMove！
            } else {
                this.positions.push([0, 0, 0]); // 先加一个点，用于mouseMove！
            }
            if (this._disableSteps) {
                throw new Error('_disableSteps should be undefined!');
            }
            this._disableSteps = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this4.enabled = false;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this.positions.pop();
            this._disableSteps = this._disableSteps && this._disableSteps();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(PolylinePointAdding.prototype.__proto__ || (0, _getPrototypeOf2.default)(PolylinePointAdding.prototype), 'destroy', this).call(this);
        }
    }]);
    return PolylinePointAdding;
}(_XbsjEditing3.default);

extendKeyMap(PolylinePointAdding);

exports.default = PolylinePointAdding;

/***/ }),
/* 461 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _EditingPolylineLike = __webpack_require__(132);

var _EditingPolylineLike2 = _interopRequireDefault(_EditingPolylineLike);

var _CreatingPolylineBinding = __webpack_require__(131);

var _CreatingPolylineBinding2 = _interopRequireDefault(_CreatingPolylineBinding);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var CreatingPolygonBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(CreatingPolygonBinding, _XbsjInteractionBindi);

    function CreatingPolygonBinding(earth) {
        (0, _classCallCheck3.default)(this, CreatingPolygonBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CreatingPolygonBinding.__proto__ || (0, _getPrototypeOf2.default)(CreatingPolygonBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._editing = new _CreatingPolylineBinding2.default(earth);
        _this.disposers.push(function () {
            return _this._editing = _this._editing && _this._editing.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(CreatingPolygonBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            this._editingPolylineLike = new _EditingPolylineLike2.default(target, target.positions, 'height', true);
            var disposer = function disposer() {
                return _this2._editingPolylineLike = _this2._editingPolylineLike && _this2._editingPolylineLike.destroy();
            };

            var untargetProperty = _XbsjInteractionBinding2.default.targetProperty(this._editing, this._editingPolylineLike, function () {
                _this2.target = undefined;
            });

            this._disableProperty = function () {
                untargetProperty();
                disposer();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableProperty = this._disableProperty && this._disableProperty();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(CreatingPolygonBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(CreatingPolygonBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._editing;
        }
    }]);
    return CreatingPolygonBinding;
}(_XbsjInteractionBinding2.default);

exports.default = CreatingPolygonBinding;

/***/ }),
/* 462 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _CreatingPolylineBinding = __webpack_require__(131);

var _CreatingPolylineBinding2 = _interopRequireDefault(_CreatingPolylineBinding);

var _HeightEditingBinding = __webpack_require__(195);

var _HeightEditingBinding2 = _interopRequireDefault(_HeightEditingBinding);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

var _EditingPolylineLike = __webpack_require__(132);

var _EditingPolylineLike2 = _interopRequireDefault(_EditingPolylineLike);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var PositionWrapper = function () {
    function PositionWrapper(positionsOwner, index) {
        (0, _classCallCheck3.default)(this, PositionWrapper);

        this._index = index;
        this._positionsOwner = positionsOwner;

        (0, _mobx.extendObservable)(this, {
            position: [0, 0, 0]
        });

        this._disposer = (0, _bind2.default)(this, 'position', this._positionsOwner, 'positions.' + index);
    }

    (0, _createClass3.default)(PositionWrapper, [{
        key: 'destroy',
        value: function destroy() {
            this._disposer = this._disposer && this._disposer();
        }
    }]);
    return PositionWrapper;
}();

var PolygonCreatingWithHeightBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(PolygonCreatingWithHeightBinding, _XbsjInteractionBindi);

    function PolygonCreatingWithHeightBinding(earth) {
        (0, _classCallCheck3.default)(this, PolygonCreatingWithHeightBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PolygonCreatingWithHeightBinding.__proto__ || (0, _getPrototypeOf2.default)(PolygonCreatingWithHeightBinding)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            onlyOnce: true
        });

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding        

        _this._polylineCreating = new _CreatingPolylineBinding2.default(earth);
        _this.disposers.push(function () {
            return _this._polylineCreating = _this._polylineCreating && _this._polylineCreating.destroy();
        });

        _this._heightEditing = new _HeightEditingBinding2.default(earth);
        _this.disposers.push(function () {
            return _this._heightEditing = _this._heightEditing && _this._heightEditing.destroy();
        });
        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._heightEditing.onlyOnce = _this.onlyOnce;
        }));

        _this._createHelpers();
        return _this;
    }

    (0, _createClass3.default)(PolygonCreatingWithHeightBinding, [{
        key: '_createHelpers',
        value: function _createHelpers() {
            var _this2 = this;

            var earth = this._earth;
            // 高度调整用的polygon
            this._polygon = new _Polygon2.default(earth);
            this.disposers.push(function () {
                return _this2._polygon = _this2._polygon && _this2._polygon.destroy();
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                _this2._polygon.height = _this2.target && _this2.target.height;
            }));

            this._polygon.show = false;
            this._polygon.showHelper = false;
            this.disposers.push((0, _mobx.reaction)(function () {
                return !!_this2._heightEditing.target;
            }, function (show) {
                _this2._polygon.show = show;
                _this2._polygon.showHelper = show;
            }));

            this.disposers.push((0, _mobx.reaction)(function () {
                return _this2.target ? [].concat((0, _toConsumableArray3.default)(_this2.target.positions)) : undefined;
            }, function (positions) {
                if (positions) {
                    _this2._polygon.positions = positions;
                }
            }));
        }
    }, {
        key: '_startPolygonEditing',
        value: function _startPolygonEditing() {
            var _this3 = this;

            if (this._disabledPolygonEditing) {
                throw new Error('_disabledPolygonEditing sholud be undefined!');
            }

            var untargetProperty = _XbsjInteractionBinding2.default.targetProperty(this._polylineCreating, this._editingPolylineLike, function () {
                return _this3._nextStep();
            });

            this._disabledPolygonEditing = function () {
                untargetProperty();
            };
        }
    }, {
        key: '_nextStep',
        value: function _nextStep() {
            var lastStep = this._polylineCreating.editing.steps.lastStep;
            if (lastStep && this._editingPolylineLike.positions.length >= 3) {
                this._startHeightEditing();
            } else {
                this.target = undefined; // 操作取消！
            }

            this._disabledPolygonEditing = this._disabledPolygonEditing && this._disabledPolygonEditing();
        }
    }, {
        key: '_startHeightEditing',
        value: function _startHeightEditing() {
            var _this4 = this;

            if (this._positionWrapper) {
                throw new Error('error');
            }
            this._positionWrapper = new PositionWrapper(this._editingPolylineLike, 0);

            var untargetProperty = _XbsjInteractionBinding2.default.targetProperty(this._heightEditing, this._positionWrapper, function () {
                _this4.target = undefined;
            });

            this._disabledHeightEditing = function () {
                untargetProperty();
            };
        }
    }, {
        key: '_start',
        value: function _start() {
            this._editingPolylineLike = new _EditingPolylineLike2.default(this.target, this.target.positions, 'height');

            this._startPolygonEditing();
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disabledPolygonEditing = this._disabledPolygonEditing && this._disabledPolygonEditing();
            this._disabledHeightEditing = this._disabledHeightEditing && this._disabledHeightEditing();

            this._positionWrapper = this._positionWrapper && this._positionWrapper.destroy();
            this._editingPolylineLike = this._editingPolylineLike && this._editingPolylineLike.destroy();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(PolygonCreatingWithHeightBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(PolygonCreatingWithHeightBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'polylineCreating',
        get: function get() {
            return this._polylineCreating;
        }
    }, {
        key: 'heightEditing',
        get: function get() {
            return this._heightEditing;
        }
    }]);
    return PolygonCreatingWithHeightBinding;
}(_XbsjInteractionBinding2.default);

exports.default = PolygonCreatingWithHeightBinding;

/***/ }),
/* 463 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _EditingPolylineLike = __webpack_require__(132);

var _EditingPolylineLike2 = _interopRequireDefault(_EditingPolylineLike);

var _EditingPolylineBinding = __webpack_require__(196);

var _EditingPolylineBinding2 = _interopRequireDefault(_EditingPolylineBinding);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var EditingPolygonBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(EditingPolygonBinding, _XbsjInteractionBindi);

    function EditingPolygonBinding(earth) {
        (0, _classCallCheck3.default)(this, EditingPolygonBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (EditingPolygonBinding.__proto__ || (0, _getPrototypeOf2.default)(EditingPolygonBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        });

        _this._editing = new _EditingPolylineBinding2.default(earth);
        _this.disposers.push(function () {
            return _this._editing = _this._editing && _this._editing.destroy();
        });
        return _this;
    }

    (0, _createClass3.default)(EditingPolygonBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            this._editingPolylineLike = new _EditingPolylineLike2.default(target, target.positions, 'height', true);
            var disposer = function disposer() {
                return _this2._editingPolylineLike = _this2._editingPolylineLike && _this2._editingPolylineLike.destroy();
            };

            var untargetProperty = _XbsjInteractionBinding2.default.targetProperty(this._editing, this._editingPolylineLike, function () {
                _this2.target = undefined;
            });

            this._disableProperty = function () {
                untargetProperty();
                disposer();
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableProperty = this._disableProperty && this._disableProperty();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(EditingPolygonBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(EditingPolygonBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editing',
        get: function get() {
            return this._editing;
        }
    }]);
    return EditingPolygonBinding;
}(_XbsjInteractionBinding2.default);

exports.default = EditingPolygonBinding;

/***/ }),
/* 464 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjSteps = __webpack_require__(55);

var _XbsjSteps2 = _interopRequireDefault(_XbsjSteps);

var _XbsjEditing2 = __webpack_require__(19);

var _XbsjEditing3 = _interopRequireDefault(_XbsjEditing2);

var _mobx = __webpack_require__(2);

var _Points = __webpack_require__(43);

var _Points2 = _interopRequireDefault(_Points);

var _Polyline = __webpack_require__(20);

var _Polyline2 = _interopRequireDefault(_Polyline);

var _CoordinatesMoving = __webpack_require__(130);

var _CoordinatesMoving2 = _interopRequireDefault(_CoordinatesMoving);

var _CirclesRotating = __webpack_require__(194);

var _CirclesRotating2 = _interopRequireDefault(_CirclesRotating);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _InteractionPanel = __webpack_require__(465);

var _InteractionPanel2 = _interopRequireDefault(_InteractionPanel);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var PolylineEditing = function (_XbsjEditing) {
    (0, _inherits3.default)(PolylineEditing, _XbsjEditing);

    function PolylineEditing(earth) {
        (0, _classCallCheck3.default)(this, PolylineEditing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (PolylineEditing.__proto__ || (0, _getPrototypeOf2.default)(PolylineEditing)).call(this));

        _this._earth = earth;
        (0, _mobx.extendObservable)(_this, {
            positions: [],
            rotations: undefined,
            isCameraLike: false,
            // rotations: [],
            // rotationsEnabled: false,
            loop: false,
            onlyMove: false,
            _nearPointIndex: -1,
            polylineShow: true
        });

        // 这是为了防止positions被换成新的数组，从而导致下面的observe失效！
        _this.disposers.push((0, _mobx.intercept)(_this, 'positions', function (changed) {
            if (changed.type === 'update') {
                var _this$positions;

                (_this$positions = _this.positions).splice.apply(_this$positions, [0, _this.positions.length].concat((0, _toConsumableArray3.default)(changed.newValue)));
            }

            return null;
        }));

        _this.disposers.push((0, _mobx.intercept)(_this.positions, function (changed) {
            if (changed.type === 'splice') {
                if (_this.rotations) {
                    var _this$rotations;

                    var news = new Array(changed.added.length).fill([0, 0, 0]);
                    (_this$rotations = _this.rotations).splice.apply(_this$rotations, [changed.index, changed.removedCount].concat((0, _toConsumableArray3.default)(news)));
                }
            }

            return changed;
        }));

        _this._currentMovingIndex = -1;

        _this._coordinatesMove = new _CoordinatesMoving2.default(earth);
        _this.disposers.push(function () {
            _this._coordinatesMove = _this._coordinatesMove && _this._coordinatesMove.destroy();
        });

        _this._circlesRotating = new _CirclesRotating2.default(earth);
        _this.disposers.push(function () {
            _this._circlesRotating = _this._circlesRotating && _this._circlesRotating.destroy();
        });

        _this._panel = new _InteractionPanel2.default(earth);
        _this.disposers.push(function () {
            _this._panel = _this._panel && _this._panel.destroy();
        });
        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._panel.rotate = !!_this.rotations;
        }));

        _this._createHelper();

        {
            // 目的是为了实现延迟，代码写得有点冗长

            // 如果是隐藏，则延迟1秒后操作！
            _this._nearPointIndex_setting = 0;
            _this.disposers.push(function () {
                return _this._nearPointIndex_setting > 0 && clearTimeout(_this._nearPointIndex_setting);
            });

            _this.disposers.push((0, _mobx.intercept)(_this, '_nearPointIndex', function (changed) {
                if (changed.newValue !== -1) {
                    if (_this._nearPointIndex_setting > 0) {
                        clearTimeout(_this._nearPointIndex_setting);
                        _this._nearPointIndex_setting = 0;
                    }
                    return changed;
                } else {
                    if (_this._nearPointIndex_setting === 0) {
                        _this._nearPointIndex_setting = setTimeout(function () {
                            _this._nearPointIndex_setting = -1; // -1时表示可以更改_nearPointIndex
                            _this._nearPointIndex = -1;
                        }, 500);
                        return null;
                    } else if (_this._nearPointIndex_setting === -1) {
                        _this._nearPointIndex_setting = 0;
                        return changed;
                    } else {
                        return null;
                    }
                }
            }));

            // panel也跟随显示与否
            var scratchCartesian3 = new Cesium.Cartesian3();
            var scratchCartesian2 = new Cesium.Cartesian2();
            _this.disposers.push((0, _mobx.autorun)(function () {
                var npi = _this._nearPointIndex;

                if (_this.onlyMove) {
                    _this._panel.show && (_this._panel.show = false);
                    return;
                }

                if (npi !== -1) {
                    _this._panel.show = true;
                    var pos = _this.positions.length > npi && _this.positions[npi];
                    if (typeof pos !== 'undefined') {
                        var cartesian3 = Cesium.Cartesian3.fromRadians(pos[0], pos[1], pos[2], undefined, scratchCartesian3);
                        var cartesian2 = _this._earth.czm.scene.cartesianToCanvasCoordinates(cartesian3, scratchCartesian2);
                        var height = _this._earth.czm.scene.canvas.clientHeight;
                        _this._panel.left = cartesian2.x;
                        _this._panel.bottom = height - cartesian2.y;
                    }
                } else {
                    _this._panel.show = false;
                }
            }));
        }

        return _this;
    }

    (0, _createClass3.default)(PolylineEditing, [{
        key: '_createHelper',
        value: function _createHelper() {
            var _this2 = this;

            var earth = this._earth;

            // 这地方的代码完全可以挪出去独立开
            this._points = new _Points2.default(earth);
            this.disposers.push(function () {
                return _this2._points = _this2._points && _this2._points.destroy();
            });
            this._points.forcePass = Cesium.Pass.OVERLAY;

            this._polyline = new _Polyline2.default(earth);
            this._polyline.material['XbsjColorMaterial'].color.splice(0, 4, 1, 1, 0, 1.0);
            this._polyline.depthTest = false;
            this._polyline.material.type = 'XbsjColorMaterial';
            this._polyline.width = 2;
            this.disposers.push(function () {
                return _this2._polyline = _this2._polyline && _this2._polyline.destroy();
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                // console.log(this._points);
                var diffLen = _this2.positions.length - _this2._points.points.length;
                if (diffLen > 0) {
                    for (var i = 0; i < diffLen; ++i) {
                        _this2._points.points.push({});
                    }
                } else if (diffLen < 0) {
                    for (var _i = 0; _i < -diffLen; ++_i) {
                        _this2._points.points[_this2.positions.length + _i].show = false;
                        _this2._points.points[_this2.positions.length + _i].color.splice(0, 4, 1, 1, 0, 1.0);
                    }
                }

                _this2.positions.forEach(function (value, index) {
                    var _points$points$index$;

                    _this2._points.points[index].show = _this2.enabled;
                    (_points$points$index$ = _this2._points.points[index].position).splice.apply(_points$points$index$, [0, 3].concat((0, _toConsumableArray3.default)(value)));
                });

                _this2._polyline.positions = _this2.positions.map(function (e) {
                    return [].concat((0, _toConsumableArray3.default)(e));
                });
            }));

            this.disposers.push((0, _mobx.autorun)(function () {
                _this2._polyline.loop = _this2.loop;
                // this._polyline.show = this.enabled;
                _this2._polyline.show = _this2.enabled && _this2.polylineShow;
            }));

            var points = this._points;
            this.disposers.push((0, _mobx.autorun)(function () {
                points.points.forEach(function (e) {
                    return e.pixelSize = 6;
                });

                if (_this2._nearPointIndex >= 0 && _this2._nearPointIndex < points.points.length) {
                    var index = _this2._nearPointIndex;
                    points.points[index].pixelSize = 16;
                }
            }));
        }
    }, {
        key: '_getNearPointIndex',
        value: function _getNearPointIndex(windowPosition, tolerance) {
            var _this3 = this;

            var index = this.positions.findIndex(function (value, index) {
                var _Cesium$Cartesian;

                var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this3.positions[index]).concat([undefined, _this3._firstCartesian]));
                if (!cartesian) return false;
                var winPosition = _this3._earth.czm.scene.cartesianToCanvasCoordinates(cartesian, _this3._firstPosition);
                if (!winPosition) return false;
                return Cesium.Cartesian2.distanceSquared(windowPosition, winPosition) < tolerance * tolerance;
            });

            return index;
        }
    }, {
        key: '_init',
        value: function _init() {
            var _this4 = this;

            this.mouseMove$ = this.mouseMove$ || this._earth.eventSource.mouse.mouseMove;
            this.panel$ = this.panel$ || this._panel.eventSource;
            this.leftClick$ = this.leftClick$ || this._earth.eventSource.mouse.leftClick;
            this.ctrlLeftClick$ = this.ctrlLeftClick$ || this._earth.eventSource.mouse.ctrlLeftClick;
            this.shiftLeftClick$ = this.shiftLeftClick$ || this._earth.eventSource.mouse.shiftLeftClick;
            this.rightClick$ = this.rightClick$ || this._earth.eventSource.mouse.rightClick;

            this._stepsOp = this._stepsOp || [
            // [
            //     this.mouseMove$, movement => {
            //         const index = this._getNearPointIndex(movement.endPosition, 5);
            //         if (index !== -1 && this._currentMovingIndex !== index) {
            //             this._nearPointIndex = index;                        
            //         } else {
            //             this._nearPointIndex = -1;
            //         }
            //     },
            //     this.leftClick$, movement => {
            //         if (this._nearPointIndex >= 0 && this._nearPointIndex < this.positions.length) {
            //             this._startMoving(this._nearPointIndex);
            //             this._nearPointIndex = -1;
            //         }
            //     },
            //     this.ctrlLeftClick$, movement => {
            //         if (this._nearPointIndex >= 0 && this._nearPointIndex < this.positions.length) {
            //             this.positions.splice(this._nearPointIndex, 0, this.positions[this._nearPointIndex]);
            //             this._startMoving(this._nearPointIndex + 1);
            //             this._nearPointIndex = -1;
            //         }
            //     },
            //     this.shiftLeftClick$, movement => {
            //         if (this._nearPointIndex >= 0 && this._nearPointIndex < this.positions.length) {
            //             this.positions.splice(this._nearPointIndex, 1);
            //         }
            //     },
            //     this.rightClick$, () => {
            //         if (!this._cancelMovingFunc) {
            //             this._steps.enabled = false;
            //         }
            //     }
            // ],
            [this.mouseMove$, function (movement) {
                var index = _this4._getNearPointIndex(movement.endPosition, 5);
                if (index !== -1 && _this4._currentMovingIndex !== index) {
                    _this4._nearPointIndex = index;
                    // this._panel.show = true;             
                } else {
                    _this4._nearPointIndex = -1;
                    // this._panel.show = false;                     
                }
            }, this.leftClick$, function () {
                if (_this4._nearPointIndex !== -1) {
                    _this4.onlyMove && _this4._startMoving(_this4._nearPointIndex);
                }
            }, this.panel$, function (mode) {
                if (_this4._nearPointIndex >= 0 && _this4._nearPointIndex < _this4.positions.length) {
                    if (mode === 'move') {
                        _this4._startMoving(_this4._nearPointIndex);
                    } else if (mode === 'rotate') {
                        _this4._startRotating(_this4._nearPointIndex);
                    } else if (mode === 'add') {
                        _this4.positions.splice(_this4._nearPointIndex, 0, _this4.positions[_this4._nearPointIndex]);
                        _this4._startMoving(_this4._nearPointIndex + 1);
                        _this4._coordinatesMove.skipFirstStep({ xAxisActive: true, yAxisActive: true });
                    } else if (mode === 'delete') {
                        _this4.positions.splice(_this4._nearPointIndex, 1);
                    }

                    // _nearPointIndex_setting写在这仅仅是为了_nearPointIndex能即时生效，代码写得很糟糕！
                    if (_this4._nearPointIndex_setting > 0) {
                        clearTimeout(_this4._nearPointIndex_setting);
                    }
                    _this4._nearPointIndex_setting = -1;
                    _this4._nearPointIndex = -1;
                }
            }, this.rightClick$, function () {
                if (!_this4._cancelMovingFunc && !_this4._cancelRotatingFunc) {
                    _this4._steps.enabled = false;
                }
            }]];

            if (!this._steps) {
                this._steps = new _XbsjSteps2.default(this._earth, this._stepsOp);
            }
        }
    }, {
        key: '_startMoving',
        value: function _startMoving(index) {
            var _this5 = this;

            if (this._cancelMovingFunc) {
                this._cancelMoving();
            }

            if (this._cancelRotatingFunc) {
                this._cancelRotating();
            }

            this._currentMovingIndex = index;
            var currentBinding = (0, _bind2.default)(this._coordinatesMove, 'position', this, 'positions.' + index);
            var disableProperty = _XbsjEditing3.default.enableProperty(this._coordinatesMove, function () {
                _this5._cancelMoving();
            });
            this._cancelMovingFunc = function () {
                disableProperty();
                currentBinding();
                _this5._currentMovingIndex = -1;
            };
        }
    }, {
        key: '_cancelMoving',
        value: function _cancelMoving() {
            this._cancelMovingFunc = this._cancelMovingFunc && this._cancelMovingFunc();
        }
    }, {
        key: '_startRotating',
        value: function _startRotating(index) {
            var _this6 = this;

            if (this._cancelRotatingFunc) {
                this._cancelRotating();
            }

            if (this._cancelMovingFunc) {
                this._cancelMoving();
            }

            // if (this.rotationsEnabled) {
            //     this._currentRotatingIndex = index;
            //     const currentBinding = bind(this._circlesRotating, 'position', this, `positions.${index}`);
            //     const currentBinding2 = bind(this._circlesRotating, 'rotation', this, `rotations.${index}`);
            //     const disableProperty = XbsjEditing.enableProperty(this._circlesRotating, () => {
            //         this._cancelRotating();
            //     });
            //     this._cancelRotatingFunc = () => {
            //         disableProperty();
            //         currentBinding2();
            //         currentBinding();
            //         this._currentRotatingIndex = -1;
            //     }
            // }
            if (this.rotations) {
                this._currentRotatingIndex = index;
                var currentBinding = (0, _bind2.default)(this._circlesRotating, 'position', this, 'positions.' + index);

                var currentBinding2 = void 0;
                if (!this.isCameraLike) {
                    currentBinding2 = (0, _bind2.default)(this._circlesRotating, 'rotation', this, 'rotations.' + index);
                } else {
                    currentBinding2 = (0, _bind2.default)(this._circlesRotating, 'rotation', this, 'rotations.' + index, {
                        r1Tor2: function r1Tor2(r1, result) {
                            return result.splice(0, 3, r1[0] + Math.PI * 0.5, r1[1], r1[2]), result;
                        },
                        r2Tor1: function r2Tor1(r2, result) {
                            return result.splice(0, 3, r2[0] - Math.PI * 0.5, r2[1], r2[2]), result;
                        },
                        equals: function equals(r1, r2) {
                            var ee = Cesium.Math.equalsEpsilon;
                            var e1 = ee(r1[0] + Math.PI * 0.5, r2[0], 0, Cesium.Math.EPSILON4);
                            return e1 && r1[1] === r2[1] && r1[2] === r2[2];
                        }
                    });
                }

                var disableProperty = _XbsjEditing3.default.enableProperty(this._circlesRotating, function () {
                    _this6._cancelRotating();
                });
                this._cancelRotatingFunc = function () {
                    disableProperty();
                    currentBinding2();
                    currentBinding();
                    _this6._currentRotatingIndex = -1;
                };
            }
        }
    }, {
        key: '_cancelRotating',
        value: function _cancelRotating() {
            this._cancelRotatingFunc = this._cancelRotatingFunc && this._cancelRotatingFunc();
        }
    }, {
        key: '_start',
        value: function _start() {
            var _this7 = this;

            this._init();

            if (this._stepsDisable) {
                throw new Error('_stepsDisable should not exists!');
            }
            this._stepsDisable = _XbsjEditing3.default.enableProperty(this._steps, function () {
                return _this7.enabled = false;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._cancelMoving();
            this._cancelRotating();
            this._stepsDisable = this._stepsDisable && this._stepsDisable();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this.enabled = false;
            return (0, _get3.default)(PolylineEditing.prototype.__proto__ || (0, _getPrototypeOf2.default)(PolylineEditing.prototype), 'destroy', this).call(this);
        }
    }]);
    return PolylineEditing;
}(_XbsjEditing3.default);

exports.default = PolylineEditing;

/***/ }),
/* 465 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var moveSvg = '\n<svg t="1565617511231" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="11001" width="48" height="48"><path d="M918.557 489.053L794.902 365.398c-12.526-12.526-32.868-12.526-45.394 0-12.526 12.526-12.526 32.868 0 45.394l68.842 68.842H542.983V206.37l68.541 68.541c12.526 12.526 32.868 12.526 45.394 0 12.526-12.526 12.526-32.868 0-45.394L533.663 106.263l-0.301-0.301c-0.301-0.301-0.601-0.601-0.902-0.802-0.1-0.1-0.2-0.2-0.401-0.301-0.301-0.2-0.601-0.501-0.802-0.701-0.1-0.1-0.2-0.2-0.301-0.2a3.584 3.584 0 0 0-1.002-0.701c-0.1 0-0.1-0.1-0.2-0.1-0.401-0.301-0.701-0.501-1.102-0.802-4.209-2.806-9.219-4.71-14.53-5.211h-0.2c-0.501 0-0.902-0.1-1.403-0.1h-3.207c-0.501 0-0.902 0.1-1.403 0.1h-0.2c-5.311 0.501-10.321 2.405-14.53 5.211-0.401 0.301-0.701 0.501-1.102 0.802-0.1 0-0.1 0.1-0.2 0.1-0.301 0.2-0.601 0.501-1.002 0.701-0.1 0.1-0.2 0.2-0.301 0.2-0.301 0.2-0.601 0.501-0.802 0.701-0.1 0.1-0.2 0.2-0.401 0.301-0.301 0.301-0.601 0.501-0.902 0.802l-0.301 0.301-123.353 123.555c-12.526 12.526-12.526 32.868 0 45.394a32.034 32.034 0 0 0 22.647 9.419c8.217 0 16.434-3.106 22.647-9.419l68.742-68.742v273.063H205.386l68.842-68.842c12.526-12.526 12.526-32.868 0-45.394-12.526-12.526-32.868-12.526-45.394 0L105.48 488.752c-6.012 6.012-9.419 14.129-9.419 22.647s3.407 16.634 9.419 22.647l122.753 122.753c6.213 6.213 14.43 9.419 22.647 9.419s16.434-3.106 22.647-9.419c12.526-12.526 12.526-32.868 0-45.394l-67.639-67.74h273.063V817.43l-69.844-69.844c-12.526-12.526-32.868-12.526-45.394 0-12.526 12.526-12.526 32.868 0 45.394L488.27 917.536c6.012 6.012 14.129 9.419 22.647 9.419 8.518 0 16.634-3.407 22.647-9.419l123.755-123.755c12.526-12.526 12.526-32.868 0-45.394-12.526-12.526-32.868-12.526-45.394 0l-68.942 68.942V543.665h275.568l-68.842 68.842c-12.526 12.526-12.526 32.868 0 45.394a32.034 32.034 0 0 0 22.647 9.419c8.217 0 16.434-3.106 22.647-9.419l123.455-123.455c12.625-12.526 12.625-32.868 0.099-45.393z" fill="#1296db" p-id="11002"></path></svg>\n';

var rotateSvg = '\n<svg t="1565617290828" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="8474" width="48" height="48"><path d="M611.392 805.12l27.008 77.12a395.072 395.072 0 0 1-104.128 21.376l-5.568-81.536c28.288-1.92 56.128-7.616 82.688-16.96z m-439.552-84.288c19.136 29.888 42.176 57.152 68.544 81.024l54.848-60.544a314.496 314.496 0 0 1-54.528-64.448l-68.864 43.968z m22.72-167.616l-80.832 11.84c2.88 19.904 7.36 39.744 13.312 58.944l78.08-24.064a312.512 312.512 0 0 1-10.56-46.72z m133.376 308.736a398.016 398.016 0 0 0 100.48 34.816l16.128-80.128a312.64 312.64 0 0 1-79.68-27.52l-36.928 72.832z m358.528-95.104l46.528 67.136a400.64 400.64 0 0 0 78.528-71.488l-62.592-52.544a320 320 0 0 1-62.464 56.896zM506.944 109.632a394.56 394.56 0 0 0-248.768 87.616l-89.6-89.6-61.888 309.504 309.568-61.888-99.712-99.712A313.28 313.28 0 0 1 507.008 191.36a316.096 316.096 0 0 1 287.104 447.232l74.24 34.112a399.36 399.36 0 0 0 36.096-165.568 397.952 397.952 0 0 0-397.504-397.504z" p-id="8475" fill="#1296db"></path></svg>\n';

var addSvg = '\n<svg t="1565617059625" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="6656" width="48" height="48"><path d="M903.37727 439.522292 584.476173 439.522292 584.476173 120.622218c0-32.020274-25.961278-57.981553-57.981553-57.981553l-28.990265 0c-32.020274 0-57.982576 25.962302-57.982576 57.981553l0 318.900074L120.621706 439.522292c-32.020274 0-57.981553 25.962302-57.981553 57.981553l0 28.991288c0 32.020274 25.962302 57.981553 57.981553 57.981553l318.900074 0L439.52178 903.377782c0 32.019251 25.962302 57.981553 57.982576 57.981553l28.990265 0c32.020274 0 57.981553-25.962302 57.981553-57.981553L584.476173 584.476685l318.901097 0c32.020274 0 57.981553-25.961278 57.981553-57.981553l0-28.991288C961.358823 465.484593 935.397544 439.522292 903.37727 439.522292z" p-id="6657" fill="#1296db"></path></svg>\n';

var deleteSvg = '\n<svg t="1565617135691" class="icon" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="7670" width="48" height="48"><path d="M512 620.544l253.3376 253.3376a76.6976 76.6976 0 1 0 108.544-108.544L620.6464 512l253.2352-253.3376a76.6976 76.6976 0 1 0-108.544-108.544L512 403.3536 258.6624 150.1184a76.6976 76.6976 0 1 0-108.544 108.544L403.3536 512 150.1184 765.3376a76.6976 76.6976 0 1 0 108.544 108.544L512 620.6464z" p-id="7671" fill="#1296db"></path></svg>\n';

var InteractionPanel = function (_XbsjBase) {
    (0, _inherits3.default)(InteractionPanel, _XbsjBase);

    function InteractionPanel(earth) {
        (0, _classCallCheck3.default)(this, InteractionPanel);

        var _this = (0, _possibleConstructorReturn3.default)(this, (InteractionPanel.__proto__ || (0, _getPrototypeOf2.default)(InteractionPanel)).call(this));

        _this._earth = earth;

        (0, _mobx.extendObservable)(_this, {
            left: undefined,
            top: undefined,
            right: undefined,
            bottom: undefined
        });

        (0, _mobx.extendObservable)(_this, {
            rotate: true,
            // position: [0, 0, 0],
            show: false
        });

        _this._eventSource = new rxjs.Subject();

        var pannel = document.createElement('div');
        var pannel2 = document.createElement('div');

        _this.disposers.push(function () {
            cw.container.removeChild(pannel);
            cw.container.removeChild(pannel2);
        });

        var css = '\n            .xbsjEarthPanel .icon path {\n                fill: #CCC\t\t\n            }\n\n            .xbsjEarthPanel .icon:hover path {\n                fill: #FFF\n            }\n            \n            .xbsjEarthPanel .icon {\n                width: 24px;\n                height: 24px;\n            }\n        ';

        _HTML2.default.addCSS(css);

        _this._setPanel(pannel);
        _this._setPanel2(pannel2);

        var cw = _this._earth.czm.viewer.cesiumWidget;
        cw.container.appendChild(pannel);
        cw.container.appendChild(pannel2);

        _this.disposers.push((0, _mobx.autorun)(function () {
            pannel.style.visibility = _this.rotate && _this.show ? 'visible' : 'hidden';
            pannel2.style.visibility = !_this.rotate && _this.show ? 'visible' : 'hidden';
        }));
        return _this;
    }

    (0, _createClass3.default)(InteractionPanel, [{
        key: '_setPanel',
        value: function _setPanel(pannel) {
            var _this2 = this;

            var cssText = '\n            position: absolute; \n            left: 0px; \n            top: 0px;   \n            width: 96px;\n            height: 24px;\n            margin: 0px;\n            padding: 5px;\n\n            cursor: pointer;\n\n            font-size: 0px;\n            box-sizing: content-box;\n            border-radius: 5px;            \n\n            background: rgba(0, 0, 0, 0.8);\n        ';

            pannel.style.cssText = cssText;
            pannel.className = 'xbsjEarthPanel';
            pannel.onmouseover = function () {
                _this2.show = true;
            };

            var buttonConfigs = [{
                title: '移动',
                type: 'move',
                svg: moveSvg
            }, {
                title: '旋转',
                type: 'rotate',
                svg: rotateSvg
            }, {
                title: '添加',
                type: 'add',
                svg: addSvg
            }, {
                title: '删除',
                type: 'delete',
                svg: deleteSvg
            }];

            buttonConfigs.forEach(function (e) {
                var button = _HTML2.default.createElement(e.svg);
                button.title = e.title;
                button.onclick = function () {
                    _this2._eventSource.next(e.type);
                };
                pannel.appendChild(button);
                return button;
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                typeof _this2.left !== 'undefined' ? pannel.style.left = _this2.left + 'px' : pannel.style.left = '';
                typeof _this2.top !== 'undefined' ? pannel.style.top = _this2.top + 'px' : pannel.style.top = '';
                typeof _this2.right !== 'undefined' ? pannel.style.right = _this2.right + 'px' : pannel.style.right = '';
                typeof _this2.bottom !== 'undefined' ? pannel.style.bottom = _this2.bottom + 'px' : pannel.style.bottom = '';
            }));
        }
    }, {
        key: '_setPanel2',
        value: function _setPanel2(pannel) {
            var _this3 = this;

            var cssText = '\n            position: absolute; \n            left: 0px; \n            top: 0px;   \n            width: 72px;\n            height: 24px;\n            margin: 0px;\n            padding: 5px;\n\n            cursor: pointer;\n\n            font-size: 0px;\n            box-sizing: content-box;\n            border-radius: 5px;            \n\n            background: rgba(0, 0, 0, 0.8);\n        ';

            pannel.style.cssText = cssText;
            pannel.className = 'xbsjEarthPanel';
            pannel.onmouseover = function () {
                _this3.show = true;
            };

            var buttonConfigs = [{
                title: '移动',
                type: 'move',
                svg: moveSvg
            }, {
                title: '添加',
                type: 'add',
                svg: addSvg
            }, {
                title: '删除',
                type: 'delete',
                svg: deleteSvg
            }];

            buttonConfigs.forEach(function (e) {
                var button = _HTML2.default.createElement(e.svg);
                button.title = e.title;
                button.onclick = function () {
                    _this3._eventSource.next(e.type);
                };
                pannel.appendChild(button);
                return button;
            });

            this.disposers.push((0, _mobx.autorun)(function () {
                typeof _this3.left !== 'undefined' ? pannel.style.left = _this3.left + 'px' : pannel.style.left = '';
                typeof _this3.top !== 'undefined' ? pannel.style.top = _this3.top + 'px' : pannel.style.top = '';
                typeof _this3.right !== 'undefined' ? pannel.style.right = _this3.right + 'px' : pannel.style.right = '';
                typeof _this3.bottom !== 'undefined' ? pannel.style.bottom = _this3.bottom + 'px' : pannel.style.bottom = '';
            }));
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(InteractionPanel.prototype.__proto__ || (0, _getPrototypeOf2.default)(InteractionPanel.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'eventSource',
        get: function get() {
            return this._eventSource;
        }
    }]);
    return InteractionPanel;
}(_XbsjBase3.default);

exports.default = InteractionPanel;

/***/ }),
/* 466 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _track = __webpack_require__(42);

var _track2 = _interopRequireDefault(_track);

var _XbsjInteractionBinding = __webpack_require__(29);

var _XbsjInteractionBinding2 = _interopRequireDefault(_XbsjInteractionBinding);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var CameraTrackingBinding = function (_XbsjInteractionBindi) {
    (0, _inherits3.default)(CameraTrackingBinding, _XbsjInteractionBindi);

    function CameraTrackingBinding(earth) {
        (0, _classCallCheck3.default)(this, CameraTrackingBinding);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CameraTrackingBinding.__proto__ || (0, _getPrototypeOf2.default)(CameraTrackingBinding)).call(this, earth));

        _this.target = undefined;
        _this.disposers.push(function () {
            return _this.target = undefined;
        }); // 自动销毁currentBinding

        _this._cameraTracking = earth.camera.tracking;
        return _this;
    }

    (0, _createClass3.default)(CameraTrackingBinding, [{
        key: '_start',
        value: function _start(target) {
            var _this2 = this;

            if (this._disableOp) {
                throw new Error('_disableOp should not be undefined!');
            }

            var earth = this._earth;

            var disposers = [];

            earth.camera.tracking.enabled && (earth.camera.tracking.enabled = false);
            disposers.push(target.cameraTrackingFunc(earth.camera.tracking));
            earth.camera.tracking.enabled = true;

            disposers.push((0, _mobx.intercept)(earth.camera.tracking, 'enabled', function (changed) {
                if (!changed.newValue && changed.newValue !== changed.oldValue) {
                    _this2.target = undefined;
                }

                return changed;
            }));

            this._disableOp = function () {
                disposers.forEach(function (d) {
                    return d();
                });
                earth.camera.tracking.enabled = false;
            };
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            this._disableOp = this._disableOp && this._disableOp();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(CameraTrackingBinding.prototype.__proto__ || (0, _getPrototypeOf2.default)(CameraTrackingBinding.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'coordinatesMove',
        get: function get() {
            return this._coordinatesMove;
        }
    }]);
    return CameraTrackingBinding;
}(_XbsjInteractionBinding2.default);

exports.default = CameraTrackingBinding;

/***/ }),
/* 467 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _Measurement = __webpack_require__(468);

var _Measurement2 = _interopRequireDefault(_Measurement);

var _CutFillComputingOld = __webpack_require__(469);

var _CutFillComputingOld2 = _interopRequireDefault(_CutFillComputingOld);

var _CutFillComputing = __webpack_require__(470);

var _CutFillComputing2 = _interopRequireDefault(_CutFillComputing);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 分析类
 * @class
 * @extends XbsjBase
 */
var Analyzation = function (_XbsjBase) {
    (0, _inherits3.default)(Analyzation, _XbsjBase);

    function Analyzation(earth) {
        (0, _classCallCheck3.default)(this, Analyzation);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Analyzation.__proto__ || (0, _getPrototypeOf2.default)(Analyzation)).call(this));

        _this._earth = earth;
        _this._measurement = new _Measurement2.default(_this._earth);
        _this._cutFillComputingOld = new _CutFillComputingOld2.default(_this._earth);
        _this._cutFillComputing = new _CutFillComputing2.default(_this._earth);
        return _this;
    }

    /**
     * 测量类
     * @type {Measurement}
     * @readonly
     */

    (0, _createClass3.default)(Analyzation, [{
        key: 'destroy',

        /**
         * 销毁对象
         */
        value: function destroy() {
            this._measurement.destroy();
            this._cutFillComputing.destroy();
            this._cutFillComputingOld.destroy();
            return (0, _get3.default)(Analyzation.prototype.__proto__ || (0, _getPrototypeOf2.default)(Analyzation.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'measurement',
        get: function get() {
            return this._measurement;
        }

        /**
         * 挖填方计算
         * @type {CutFillComputing}
         * @readonly
         */

    }, {
        key: 'cutFillComputing',
        get: function get() {
            return this._cutFillComputing;
        }
    }, {
        key: 'cutFillComputingOld',
        get: function get() {
            return this._cutFillComputingOld;
        }
    }]);
    return Analyzation;
}(_XbsjBase3.default);

Analyzation.CutFillComputing = _CutFillComputing2.default;
Analyzation.Measurement = _Measurement2.default;

exports.default = Analyzation;

/***/ }),
/* 468 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function modeToType(mode) {
    switch (mode) {
        case 1:
            return 'SPACE_DISTANCE';
        case 2:
            return 'TRIANGLE_DISTANCE';
        case 3:
            return 'SPACE_AREA';
        default:
            return 'NONE';
    }
}

/**
 * 测量类
 * @class
 * @memberof Analyzation
 * @extends XbsjBase
 */

var Measurement = function (_XbsjBase) {
    (0, _inherits3.default)(Measurement, _XbsjBase);

    function Measurement(earth) {
        (0, _classCallCheck3.default)(this, Measurement);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Measurement.__proto__ || (0, _getPrototypeOf2.default)(Measurement)).call(this));

        _this._earth = earth;
        var viewer = earth.czm.viewer;
        _this._pointM = viewer.xbsjMeasurement.createPointMeasurement();
        _this._polylineM = viewer.xbsjMeasurement.createPolylineMeasurement();

        (0, _mobx.extendObservable)(_this, {
            /**
             * 模式设置
             * @description 可以是以下类型：'NONE', 'POINT', 'SPACE_DISTANCE', 'TRIANGLE_DISTANCE', 'SPACE_AREA'<br/>
             * NONE 表示不进行任何测量<br/>
             * POINT 表示位置测量<br/>
             * SPACE_DISTANCE 表示空间距离测量<br/>
             * TRIANGLE_DISTANCE 表示三角测量，测量两点直线距离的同时，测量水平距离和垂直距离<br/>
             * SPACE_AREA 表示面积测量<br/>
             * @type {string}
             * @default 'NONE'
             * @instance
             * @memberof Analyzation.Measurement
             */
            type: 'NONE' // 'NONE', 'POINT', 'SPACE_DISTANCE', 'TRIANGLE_DISTANCE', 'SPACE_AREA'
        });

        _this._listenerDisposer1 = _this._pointM.getActiveChangedEvent().addEventListener(function () {
            _this.type = _this._pointM.isActive() ? 'POINT' : 'NONE';
        });

        _this._listenerDisposer2 = _this._polylineM.getActiveChangedEvent().addEventListener(function () {
            _this.type = _this._polylineM.isActive() ? modeToType(_this._polylineM.getMode()) : 'NONE';
        });

        _this._observerDisposer = (0, _mobx.observe)(_this, 'type', function (changed) {
            changed.newValue;
            if (changed.oldValue === 'POINT') {
                _this._pointM.end();
            } else if (changed.oldValue === 'SPACE_DISTANCE' || changed.oldValue === 'TRIANGLE_DISTANCE' || changed.oldValue === 'SPACE_AREA') {
                _this._polylineM.end();
            }

            if (changed.newValue === 'POINT') {
                _this._pointM.start();
            } else if (changed.newValue === 'SPACE_DISTANCE') {
                _this._polylineM.setMode(1);
                _this._polylineM.start();
            } else if (changed.newValue === 'TRIANGLE_DISTANCE') {
                _this._polylineM.setMode(2);
                _this._polylineM.start();
            } else if (changed.newValue === 'SPACE_AREA') {
                _this._polylineM.setMode(3);
                _this._polylineM.start();
            }
        });
        return _this;
    }

    /**
     * 清理测量结果
     */

    (0, _createClass3.default)(Measurement, [{
        key: 'clearResults',
        value: function clearResults() {
            this._pointM.clearResults();
            this._polylineM.clearResults();
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._listenerDisposer1 = this._listenerDisposer1 && this._listenerDisposer1();
            this._listenerDisposer2 = this._listenerDisposer2 && this._listenerDisposer2();
            this._observerDisposer = this._observerDisposer && this._observerDisposer();
            return (0, _get3.default)(Measurement.prototype.__proto__ || (0, _getPrototypeOf2.default)(Measurement.prototype), 'destroy', this).call(this);
        }
    }]);
    return Measurement;
}(_XbsjBase3.default);

exports.default = Measurement;

/***/ }),
/* 469 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 挖填方分析
 * @class
 * @memberof Analyzation
 * @extends XbsjBase
 */
var CutFillComputing = function (_XbsjBase) {
    (0, _inherits3.default)(CutFillComputing, _XbsjBase);

    function CutFillComputing(earth) {
        (0, _classCallCheck3.default)(this, CutFillComputing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CutFillComputing.__proto__ || (0, _getPrototypeOf2.default)(CutFillComputing)).call(this));

        _this._earth = earth;
        _this._xbsjCutFillComputing = new Cesium.XbsjCutFillComputing();
        _this._resultGraphics = _this._earth.czm.scene.primitives.add(new Cesium.XbsjCutFillResultGraphics());

        (0, _mobx.extendObservable)(_this, {
            /**
             * 是否开启
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {boolean}
             * @default false
             */
            enabled: false,
            /**
             * 计算网格大小，单位是米
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 1.0
             */
            gridWidth: 1.0,
            /**
             * 计算网格高度，单位是米
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 0.0
             */
            height: 0.0,
            /**
             * 计算网格所构成的多边形坐标位置，形如： [经度, 纬度, 经度, 纬度, ...]
             * @description 注意：必须是偶数个元素！
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number[]}
             * @default []
             */
            positions: [],
            /**
             * 是否正在进行网格计算
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {boolean}
             * @default false
             */
            computing: false,
            /**
             * 计算精度
             * @description 0-1之间，0表示刚开始，1表示完成
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 0.0
             */
            progress: 0.0,
            /**
             * 计算结果
             * @instance
             * @memberof Earth
             * @type {object}
             * @property {number} gridWidth      - 计算时的网格大小
             * @property {number} area      - 面积，单位平方米
             * @property {number} cut      - 挖方体积，单位立方米
             * @property {number} fill      - 填方体积，单位立方米
             * @property {number} total      - 总填方体积，单位立方米
             * @readonly
             */
            results: {
                gridWidth: 1.0,
                area: 0.0,
                cut: 0.0,
                fill: 0.0,
                total: 0.0
            },
            /**
             * 交互状态
             * @description 有以下状态值：inital:初始状态 running:正在运行（交互） completed:交互完成 cancelled：中途取消
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {string}
             * @readonly
             */
            get status() {
                if (this._initial) {
                    return 'initial';
                } else if (this.enabled) {
                    return 'running';
                    // } else if (this.editingBinding.heightEditing.editing.steps.lastStep) {
                } else if (this._completed) {
                    return 'completed';
                } else {
                    return 'cancelled';
                }
            },
            _initial: true,
            _completed: false
        }, {
            status: _mobx.computed
        });

        _this._disposers = _this._disposers || [];

        _this._disposers.push((0, _mobx.observe)(_this, 'enabled', function (changed) {
            _this._initial = false;
            if (changed.newValue) {
                _this._start();
            }
        }));

        _this._disposers.push((0, _mobx.intercept)(_this, function (changed) {
            if (changed.name === 'enabled' && changed.type === 'update') {
                if (changed.newValue) {
                    _this._initial = true;
                    _this._completed = false;
                }
            }

            return changed;
        }));

        _this._disposers.push((0, _mobx.intercept)(_this, 'enabled', function (changed) {
            if (!changed.newValue) {
                _this._cancel();
            }
            return changed;
        }));
        return _this;
    }

    (0, _createClass3.default)(CutFillComputing, [{
        key: '_start',
        value: function _start() {
            var _this2 = this;

            this.positions.length = 0;
            this.height = 0;
            this.editingBinding.target = this;

            this._beforeFlattenedEditingDisabled = (0, _mobx.intercept)(this.editingBinding, function (changed) {
                if (changed.name === 'target' && changed.type === 'update') {
                    if (changed.newValue) {
                        throw new Error('changed.newValue should not be true!');
                    }

                    var lastStep = _this2.editingBinding.heightEditing.editing.steps.lastStep;
                    if (lastStep) {
                        _this2._cancelFlattenedPolygonEditing();

                        // 说明所有步骤完成，执行挖填方计算
                        var cartesians = [];
                        var l = _this2.positions.length / 2;
                        for (var i = 0; i < l; ++i) {
                            cartesians.push(Cesium.Cartesian3.fromRadians(_this2.positions[i * 2], _this2.positions[i * 2 + 1], 0));
                        }

                        _this2.computing = true;
                        var area = _this2._xbsjCutFillComputing.area(cartesians);
                        var gridWidth = _this2.gridWidth;
                        _this2.progress = 0.0;
                        _this2._xbsjCutFillComputing.compute(cartesians, gridWidth, _this2.height, _this2._earth.czm.scene, function (results) {
                            results.area = area;
                            results.gridWidth = gridWidth;
                            _this2._getResult(results);
                            _this2.computing = false;
                            _this2._completed = true;
                            _this2.enabled = false;
                        }, function (progress) {
                            // console.log('progress: ' + progress);
                            _this2.progress = progress;
                        }, function (error) {
                            _this2.enabled = false;
                        });
                    } else {
                        // do nothing!
                        _this2.enabled = false;
                    }

                    return null;
                }
                return changed;
            });
        }
    }, {
        key: '_cancel',
        value: function _cancel() {
            if (this.editingBinding.target) {
                this._cancelFlattenedPolygonEditing();
            }
            if (this.computing) {
                this._cancelComputing();
            }
        }
    }, {
        key: '_cancelFlattenedPolygonEditing',
        value: function _cancelFlattenedPolygonEditing() {
            if (!this._beforeFlattenedEditingDisabled) {
                throw new Error('should not be undefined!');
            }
            this._beforeFlattenedEditingDisabled();
            this.editingBinding.target = undefined;
        }
    }, {
        key: '_cancelComputing',
        value: function _cancelComputing() {
            if (this.computing) {
                this._xbsjCutFillComputing.cancel();
                this.computing = false;
            }
        }
    }, {
        key: '_getResult',
        value: function _getResult(results) {
            var heightCartesians = results.heightCartesians,
                clampCartesians = results.clampCartesians,
                diffHeights = results.diffHeights,
                cut = results.cut,
                fill = results.fill,
                total = results.total,
                area = results.area,
                gridWidth = results.gridWidth;

            var resultGraphics = this._resultGraphics;

            resultGraphics.heightCartesians = heightCartesians;
            resultGraphics.clampCartesians = clampCartesians;
            resultGraphics.diffHeights = diffHeights;
            resultGraphics.gridWidth = gridWidth;

            this.results.gridWidth = gridWidth;
            this.results.area = area;
            this.results.cut = cut;
            this.results.fill = fill;
            this.results.total = total;
        }
    }, {
        key: 'clearResults',
        value: function clearResults() {
            this._resultGraphics.clear();
            var results = this.results;
            this._initial = true;
            this._completed = false;
            this.computing = false;
            results.gridWidth = 0.0;
            results.area = 0.0;
            results.cut = 0.0;
            results.fill = 0.0;
            results.total = 0.0;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._earth.czm.scene.primitives.remove(this._resultGraphics);
            this._xbsjCutFillComputing = this._xbsjCutFillComputing && this._xbsjCutFillComputing.destroy();
            return (0, _get3.default)(CutFillComputing.prototype.__proto__ || (0, _getPrototypeOf2.default)(CutFillComputing.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'editingBinding',
        get: function get() {
            return this._earth.interaction.flattenedPolygonCreatingBinding;
        }
    }]);
    return CutFillComputing;
}(_XbsjBase3.default);

exports.default = CutFillComputing;

/***/ }),
/* 470 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _XbsjEditing = __webpack_require__(19);

var _XbsjEditing2 = _interopRequireDefault(_XbsjEditing);

var _registerInteractionProperty = __webpack_require__(15);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 挖填方分析
 * @class
 * @memberof Analyzation
 * @extends XbsjBase
 */
var CutFillComputing = function (_XbsjBase) {
    (0, _inherits3.default)(CutFillComputing, _XbsjBase);

    function CutFillComputing(earth) {
        (0, _classCallCheck3.default)(this, CutFillComputing);

        var _this = (0, _possibleConstructorReturn3.default)(this, (CutFillComputing.__proto__ || (0, _getPrototypeOf2.default)(CutFillComputing)).call(this));

        _this._earth = earth;
        _this._xbsjCutFillComputing = new Cesium.XbsjCutFillComputing();
        _this.disposers.push(function () {
            _this._xbsjCutFillComputing.cancel();
            _this._xbsjCutFillComputing = _this._xbsjCutFillComputing && _this._xbsjCutFillComputing.destroy();
        });

        _this._resultGraphics = _this._earth.czm.scene.primitives.add(new Cesium.XbsjCutFillResultGraphics());
        _this.disposers.push(function () {
            _this._earth.czm.scene.primitives.remove(_this._resultGraphics);
        });

        (0, _mobx.extendObservable)(_this, {
            /**
             * 是否显示辅助面
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {boolean}
             * @default true
             */
            showHelper: true,
            /**
             * 计算网格大小，单位是米
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 1.0
             */
            gridWidth: 1.0,
            /**
             * 计算网格高度，单位是米
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 0.0
             */
            height: 0.0,
            /**
             * 计算网格所构成的多边形坐标位置，形如： [经度, 纬度, 经度, 纬度, ...]
             * @description 注意：必须是偶数个元素！
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number[]}
             * @default []
             */
            positions: [],
            /**
             * 是否正在进行网格计算
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {boolean}
             * @default false
             */
            computing: false,
            /**
             * 计算精度
             * @description 0-1之间，0表示刚开始，1表示完成
             * @instance
             * @memberof Analyzation.CutFillComputing
             * @type {number}
             * @default 0.0
             */
            progress: 0.0,
            /**
             * 计算结果
             * @instance
             * @memberof Earth
             * @type {object}
             * @property {number} gridWidth      - 计算时的网格大小
             * @property {number} area      - 面积，单位平方米
             * @property {number} cut      - 挖方体积，单位立方米
             * @property {number} fill      - 填方体积，单位立方米
             * @property {number} total      - 总填方体积，单位立方米
             * @readonly
             */
            results: {
                gridWidth: 1.0,
                area: 0.0,
                cut: 0.0,
                fill: 0.0,
                total: 0.0
            }
        });

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreating)(_this._earth, _this, {
            polygonCreating: 'polygonCreating'
        }));

        _this._polygon = new _Polygon2.default(_this._earth);
        _this.disposers.push(function () {
            _this._polygon = _this._polygon && _this._polygon.destroy();
        });

        var updatePolygon = function updatePolygon() {
            _this._polygon.positions = [].concat((0, _toConsumableArray3.default)(_this.positions));
            _this._polygon.height = _this.height;
            _this._polygon.show = _this.showHelper;
        };

        updatePolygon();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                height: _this.height,
                showHelper: _this.showHelper
            };
        }, updatePolygon));

        _this.disposers.push(function () {
            _this._cancelComputing();
        });
        return _this;
    }

    (0, _createClass3.default)(CutFillComputing, [{
        key: "compute",
        value: function compute() {
            var _this2 = this;

            var cartesians = [];
            var l = this.positions.length / 2;
            for (var i = 0; i < l; ++i) {
                cartesians.push(Cesium.Cartesian3.fromRadians(this.positions[i * 2], this.positions[i * 2 + 1], 0));
            }

            if (cartesians.length < 3) {
                console.warn('请创建挖填方区域！');
                return;
            }

            var area = this._xbsjCutFillComputing.area(cartesians);
            var gridWidth = this.gridWidth;
            this.progress = 0.0;
            this._cancelComputing();
            this.computing = true;
            this._xbsjCutFillComputing.compute(cartesians, gridWidth, this.height, this._earth.czm.scene, function (results) {
                results.area = area;
                results.gridWidth = gridWidth;
                _this2._getResult(results);
                _this2.computing = false;
            }, function (progress) {
                // console.log('progress: ' + progress);
                _this2.progress = progress;
            }, function (error) {
                _this2._cancelComputing();
            });
        }
    }, {
        key: "_cancelComputing",
        value: function _cancelComputing() {
            if (this.computing) {
                this._xbsjCutFillComputing.cancel();
                this.computing = false;
            }
        }
    }, {
        key: "_getResult",
        value: function _getResult(results) {
            var heightCartesians = results.heightCartesians,
                clampCartesians = results.clampCartesians,
                diffHeights = results.diffHeights,
                cut = results.cut,
                fill = results.fill,
                total = results.total,
                area = results.area,
                gridWidth = results.gridWidth;

            var resultGraphics = this._resultGraphics;

            resultGraphics.heightCartesians = heightCartesians;
            resultGraphics.clampCartesians = clampCartesians;
            resultGraphics.diffHeights = diffHeights;
            resultGraphics.gridWidth = gridWidth;

            this.results.gridWidth = gridWidth;
            this.results.area = area;
            this.results.cut = cut;
            this.results.fill = fill;
            this.results.total = total;
        }
    }, {
        key: "clearResults",
        value: function clearResults() {
            this._cancelComputing();

            this._resultGraphics.clear();
            var results = this.results;
            this._initial = true;
            this._completed = false;
            this.computing = false;
            results.gridWidth = 0.0;
            results.area = 0.0;
            results.cut = 0.0;
            results.fill = 0.0;
            results.total = 0.0;
        }
    }, {
        key: "editingBinding",
        get: function get() {
            // return this._earth.interaction.flattenedPolygonCreatingBinding;
            return this._earth.interaction.editingPolygonBinding;
        }
    }]);
    return CutFillComputing;
}(_XbsjBase3.default);

exports.default = CutFillComputing;

/***/ }),
/* 471 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _Debug = __webpack_require__(472);

var _Debug2 = _interopRequireDefault(_Debug);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 杂项
 * @class
 */
var Misc = function () {
    function Misc(earth) {
        (0, _classCallCheck3.default)(this, Misc);

        this._earth = earth;
        this._debug = new _Debug2.default(earth);
    }

    /**
     * 调试器类
     * @type {Misc.Debug}
     * @readonly
     */

    (0, _createClass3.default)(Misc, [{
        key: 'destroy',
        value: function destroy() {
            this._debug.destroy();
        }
    }, {
        key: 'debug',
        get: function get() {
            return this._debug;
        }
    }]);
    return Misc;
}();

Misc.Debug = _Debug2.default;

exports.default = Misc;

/***/ }),
/* 472 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _mobx = __webpack_require__(2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * Cesium调试类
 * @class
 * @memberof Misc
 */
var Debug = function (_XbsjBase) {
    (0, _inherits3.default)(Debug, _XbsjBase);

    function Debug(earth) {
        (0, _classCallCheck3.default)(this, Debug);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Debug.__proto__ || (0, _getPrototypeOf2.default)(Debug)).call(this));

        var viewer = earth.czm.viewer;

        (0, _mobx.extendObservable)(_this, {
            /**
             * 三维瓦片数据调试窗口可见性
             * @instance
             * @memberof Misc.Debug
             * @type {boolean}
             * @default false
             */
            tilesetInspectorVisibility: false,
            /**
             * Cesium程序调试窗口可见性
             * @instance
             * @memberof Misc.Debug
             * @type {boolean}
             * @default false
             */
            cesiumInspectorVisibility: false,
            /**
             * gltf模型强制双面(只对还未加载的模型有效！)
             * @instance
             * @memberof Misc.Debug
             * @type {boolean}
             * @default false
             */
            debugForceDoubleSided: false
        });

        viewer.extend(Cesium.viewerCesium3DTilesInspectorMixin);
        viewer.cesium3DTilesInspector.container.style.visibility = 'hidden';
        viewer.cesium3DTilesInspector.viewModel.picking = false; // 默认不拾取

        viewer.extend(Cesium.viewerCesiumInspectorMixin);
        viewer.cesiumInspector.container.style.visibility = 'hidden';

        _this.disposers.push((0, _mobx.autorun)(function () {
            viewer.cesium3DTilesInspector.container.style.visibility = _this.tilesetInspectorVisibility ? 'visible' : 'hidden';
            viewer.cesiumInspector.container.style.visibility = _this.cesiumInspectorVisibility ? 'visible' : 'hidden';
        }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            var debugForceDoubleSided = _this.debugForceDoubleSided;
            Cesium.Model.xbsjDebugForceDoubleSided = debugForceDoubleSided;
        }));
        return _this;
    }

    return Debug;
}(_XbsjBase3.default);

exports.default = Debug;

/***/ }),
/* 473 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
// bloom不能用，暂时注释，对模型有用，对几何体不起作用
// import { createBloomStage } from './createBloomStage';

function initViewer(container, cesiumOptions) {
    var viewer = Cesium.xbsjCreateViewer(container, cesiumOptions);

    viewer.extend(Cesium.xbsjMeasurementMixin);
    viewer.extend(Cesium.xbsjFlattenningMixin);
    Cesium.xbsjViewshedMixin(viewer.scene);
    Cesium.xbsjCameraImmersionMixin(viewer.scene);
    Cesium.xbsjPbrMixin(viewer.scene);
    Cesium.xbsjBoxPickMixin(viewer.scene);
    viewer.extend(Cesium.xbsjImageryProviderMixin); // 其实不用extend
    Cesium.xbsjWaterMixin(viewer.scene);
    Cesium.xbsjSubsurfaceMixin(viewer.scene);
    Cesium.xbsjODLineMixin(viewer.scene);
    Cesium.xbsjClippingPlaneMixin(viewer.scene);
    Cesium.xbsjRestrictImageryMixin(viewer.scene);

    // 去除系统默认事件
    viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_CLICK);
    viewer.screenSpaceEventHandler.removeInputAction(Cesium.ScreenSpaceEventType.LEFT_DOUBLE_CLICK);

    // 设置当前时间
    viewer.clock.currentTime = Cesium.JulianDate.fromDate(new Date('2019-09-07T07:12:24.934Z'));

    // Cesium 1.61以后会默认关闭反走样，对于桌面端而言还是开启得好，
    // TODO(vtxf): 但是对于移动端，还要考虑如何适应比较好。
    viewer.scene.postProcessStages.fxaa.enabled = true;

    var xbpa = new Cesium.XbsjBoxPickAction(viewer);
    // xbpa.enabled = true;
    // xbpa.objectsPicked.addEventListener(objects => {
    //     console.log(`objectsPicked: ${objects.length}`);
    //     viewModel.pickedTotal = '' + objects.length;
    // });
    // xbpa.mode = 'polygon'; // xbpa.mode = 'rect';

    viewer.xbsjBoxPickAction = xbpa;

    // viewer.scene._xbsjBloom = createBloomStage();

    return viewer;
}

exports.default = initViewer;

/***/ }),
/* 474 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function registerXbsjTerrain(earth) {
    if (!earth._xbsjTerrains) {
        earth._xbsjTerrains = [];
    }

    if (!earth._xbsjEllipsoidTerrainProvider) {
        earth._xbsjEllipsoidTerrainProvider = new Cesium.EllipsoidTerrainProvider();
    }

    if (!earth._xbsjTerrainZIndexDirty) {
        (0, _mobx.extendObservable)(earth, {
            _xbsjTerrainZIndexDirty: false
        });
    }

    if (!earth._xbsjTerrainZIndexListenerDisposer) {
        // reaction换成when就不起作用，不知道为啥。。
        earth._xbsjTerrainZIndexListenerDisposer = (0, _mobx.reaction)(function () {
            return earth._xbsjTerrainZIndexDirty;
        }, function () {
            if (!earth._xbsjTerrainZIndexDirty) return;
            earth._xbsjTerrainZIndexDirty = false;

            var terrains = earth._xbsjTerrains.filter(function (terrain) {
                return terrain.show;
            }).sort(function (l, r) {
                return l.xbsjZIndex - r.xbsjZIndex;
            });
            if (terrains.length > 0) {
                earth.czm.scene.terrainProvider = terrains[terrains.length - 1]._terrainProvider;
            } else {
                earth.czm.scene.terrainProvider = earth._xbsjEllipsoidTerrainProvider;
            }
        });
    }
}

function unregisterXbsjTerrain(earth) {
    if (earth._xbsjTerrainZIndexListenerDisposer) {
        earth._xbsjTerrainZIndexListenerDisposer();
        earth._xbsjTerrainZIndexListenerDisposer = undefined;

        earth._xbsjEllipsoidTerrainProvider = undefined;
    }
}

var XbsjTerrainListener = function () {
    function XbsjTerrainListener(earth) {
        (0, _classCallCheck3.default)(this, XbsjTerrainListener);

        this._earth = earth;
        registerXbsjTerrain(this._earth);
    }

    (0, _createClass3.default)(XbsjTerrainListener, [{
        key: "destroy",
        value: function destroy() {
            unregisterXbsjTerrain(this._earth);
        }
    }]);
    return XbsjTerrainListener;
}();

exports.default = XbsjTerrainListener;

/***/ }),
/* 475 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// TODO(vtxf): 隐藏的影响图层是否考虑不放进去，否则用户影像数据太多，可能会影响显示。


function registerXbsjImageryLayer(earth) {
    earth._xbsjImageries = [];

    earth.czm.scene.imageryLayers.removeAll(); // 删除XbsjCesium中默认的影像

    if (typeof earth._xbsjImageryZIndexDirty === 'undefined') {
        (0, _mobx.extendObservable)(earth, {
            _xbsjImageryZIndexDirty: false
        });
    }

    if (!earth._xbsjImageryZIndexListenerDisposer) {
        // earth._xbsjImageryZIndexDirty = true;
        // reaction换成when就不起作用，不知道为啥。。
        earth._xbsjImageryZIndexListenerDisposer = (0, _mobx.reaction)(function () {
            return earth._xbsjImageryZIndexDirty;
        }, function () {
            if (!earth._xbsjImageryZIndexDirty) return;
            earth._xbsjImageryZIndexDirty = false;

            var imageryLayers = [];
            var l = earth.czm.scene.imageryLayers.length;
            for (var i = 0; i < l; ++i) {
                var imageryLayer = earth.czm.scene.imageryLayers.get(i);
                imageryLayers.push(imageryLayer);
            }
            imageryLayers.sort(function (l, r) {
                return l.xbsjZIndex - r.xbsjZIndex;
            });

            // 影像图层设置 show -> removeAll(false) -> add 会导致程序报错 vtxf 为了避免用raiseToTop
            // earth.czm.scene.imageryLayers.removeAll(false);
            // imageryLayers.forEach(imageryLayer => {
            //     earth.czm.scene.imageryLayers.add(imageryLayer);
            // });
            imageryLayers.forEach(function (imageryLayer) {
                earth.czm.scene.imageryLayers.raiseToTop(imageryLayer);
            });
        });
    }
}

// TODO(vtxf) 暂时还无处卸载
function unregisterXbsjImageryLayer(earth) {
    if (earth._xbsjImageryZIndexListenerDisposer) {
        earth._xbsjImageryZIndexListenerDisposer();
        earth._xbsjImageryZIndexListenerDisposer = undefined;
    }
}

var XbsjImageryListener = function () {
    function XbsjImageryListener(earth) {
        (0, _classCallCheck3.default)(this, XbsjImageryListener);

        this._earth = earth;
        registerXbsjImageryLayer(this._earth);
    }

    (0, _createClass3.default)(XbsjImageryListener, [{
        key: "destroy",
        value: function destroy() {
            unregisterXbsjImageryLayer(this._earth);
        }
    }]);
    return XbsjImageryListener;
}();

exports.default = XbsjImageryListener;

/***/ }),
/* 476 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _mobx = __webpack_require__(2);

var _registerObject = __webpack_require__(197);

var _registerObject2 = _interopRequireDefault(_registerObject);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function registerObjectFromGuid(earth, selfObject, guidProperty, objectProperty) {
    var earthObjectProperty = objectProperty;
    var earthObjectGuidProperty = guidProperty;

    var currentAttachedObjectGuid = '';
    var unregisterEarthObject = undefined;
    var attchedObjectDisposers = [];
    attchedObjectDisposers.push(function () {
        currentAttachedObjectGuid = '';
        updateRegisterEarthObject();
    });

    var attachPath = function attachPath(path) {
        if (selfObject[earthObjectProperty]) {
            console.error('this._attachedPath should not exists!');
        }
        selfObject[earthObjectProperty] = path;
    };

    var detachPath = function detachPath() {
        selfObject[earthObjectProperty] = undefined;
    };

    var updateRegisterEarthObject = function updateRegisterEarthObject() {
        var attachedObjectGuid = selfObject[earthObjectGuidProperty];
        if (attachedObjectGuid === currentAttachedObjectGuid) {
            return;
        }

        if (currentAttachedObjectGuid) {
            unregisterEarthObject = unregisterEarthObject && unregisterEarthObject();
            currentAttachedObjectGuid = '';
        }

        if (attachedObjectGuid) {
            unregisterEarthObject = (0, _registerObject2.default)(earth, attachedObjectGuid, attachPath, detachPath);
            currentAttachedObjectGuid = attachedObjectGuid;
        }
    };

    attchedObjectDisposers.push((0, _mobx.autorun)(updateRegisterEarthObject));

    return function () {
        attchedObjectDisposers.forEach(function (d) {
            return d();
        });
        attchedObjectDisposers.length = 0;
    };
}

exports.default = registerObjectFromGuid;

/***/ }),
/* 477 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _Contour = __webpack_require__(478);

var _Contour2 = _interopRequireDefault(_Contour);

var _AspectRamp = __webpack_require__(479);

var _AspectRamp2 = _interopRequireDefault(_AspectRamp);

var _ElevationRamp = __webpack_require__(480);

var _ElevationRamp2 = _interopRequireDefault(_ElevationRamp);

var _SlopeRamp = __webpack_require__(481);

var _SlopeRamp2 = _interopRequireDefault(_SlopeRamp);

var _Restrict = __webpack_require__(482);

var _Restrict2 = _interopRequireDefault(_Restrict);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地形特效
 * @class
 */
var TerrainEffect = function (_XbsjBase) {
    (0, _inherits3.default)(TerrainEffect, _XbsjBase);

    function TerrainEffect(earth) {
        (0, _classCallCheck3.default)(this, TerrainEffect);

        var _this = (0, _possibleConstructorReturn3.default)(this, (TerrainEffect.__proto__ || (0, _getPrototypeOf2.default)(TerrainEffect)).call(this));

        _this._earth = earth;
        _this._scene = earth.czm.scene;
        _this._globe = _this._scene.globe;

        _this.contour = new _Contour2.default(_this);
        _this.elevation = new _ElevationRamp2.default(_this);
        _this.slope = new _SlopeRamp2.default(_this);
        _this.aspect = new _AspectRamp2.default(_this);

        _this.disposers.push(function () {
            _this.contour = _this.contour && _this.contour.destroy();
            _this.elevation = _this.elevation && _this.elevation.destroy();
            _this.slope = _this.slope && _this.slope.destroy();
            _this.aspect = _this.aspect && _this.aspect.destroy();
        });

        // vtxf 20190815
        _this.restrict = new _Restrict2.default(_this);
        _this.disposers.push(function () {
            return _this.restrict.destroy();
        });
        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'restrict'));

        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'contour'));
        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'elevation'));
        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'slope'));
        _this.disposers.push(_XbsjBase3.default.registerProperty(_this, 'aspect'));

        _this._defaultImage = 'data:image/jpeg;base64,/9j/4AAQSkZJRgABAQAAAQABAAD/2wBDAAMCAgICAgMCAgIDAwMDBAYEBAQEBAgGBgUGCQgKCgkICQkKDA8MCgsOCwkJDRENDg8QEBEQCgwSExIQEw8QEBD/2wBDAQMDAwQDBAgEBAgQCwkLEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBAQEBD/wAARCAABAGQDASIAAhEBAxEB/8QAGgABAQACAwAAAAAAAAAAAAAAAAYEBwUICf/EACEQAQAABQUAAwAAAAAAAAAAAAABAgUxcQMEBjJCNEGB/8QAGAEBAAMBAAAAAAAAAAAAAAAABwQGCAX/xAAkEQABAgQFBQAAAAAAAAAAAAAAAQYDBAUzMTJCcXI0NUGxwf/aAAwDAQACEQMRAD8A8x6NaVc0bzgF8bng5U2XdGvKuKV1gB0odtditRriblLsfpR7C8oKC69Q8sXScnP0hhha1wBVTxU0JL4IYU/eGV1xXxiADmsZVJMxbNx8V8Zg7BcF6aX4AMc/cZXn8DR1WDddJ+FIA0/TejhcU9APFuLuf//Z';
        //增加一个计算属性
        (0, _mobx.extendObservable)(_this, {
            /**
            * 当前启用的着色对象
            * @type {Object}
            * @default undefined
            * @readonly
            * @instance
            * @memberof TerrainEffect
            */
            get shading() {
                //根据启用性返回当前的着色
                if (this.elevation.enabled) {
                    return this.elevation;
                } else if (this.slope.enabled) {
                    return this.slope;
                } else if (this.aspect.enabled) {
                    return this.aspect;
                }
                return undefined;
            }
        }, {
            shading: _mobx.computed
        });

        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.subSurfaceEnabled;
        }, function () {
            //地下模式
            if (!_this._scene.xbsjSubsurfaceManager) {
                console.warn('地下模式插件未启用！此功能无效！');
                return;
            }

            _this._scene.xbsjSubsurfaceManager.subsurfaceEnabled = _this.subSurfaceEnabled;
        }));

        _this.disposers.push((0, _mobx.reaction)(function () {
            return _this.surfaceOpacity;
        }, function () {
            //地下模式
            if (!_this._scene.xbsjSubsurfaceManager) {
                console.warn('地下模式插件未启用！此功能无效！');
                return;
            }

            if (_this.depthTest) {
                console.warn('需要首先关闭地形深度检测(depthTest)，此功能才能有效！');
            }

            if (_this.surfaceOpacity <= 0.0) {
                _this._scene.xbsjSubsurfaceManager.transparentEnabled = false;
            } else {
                _this._scene.xbsjSubsurfaceManager.transparentEnabled = true;
                _this._scene.xbsjSubsurfaceManager.opacity = _this.surfaceOpacity;
            }
        }));

        //监控所有子的变化
        _this.disposers.push((0, _mobx.autorun)(function () {
            var a = _this.elevation;
            var b = _this.slope;
            var c = _this.aspect;
            var d = _this.contour;
            _this._update(a, b, c, d);

            _this._scene.logarithmicDepthBuffer = _this.logDepth;
            _this._globe._surface.tileProvider._debug.wireframe = _this.wireFrame;

            _this._globe.depthTestAgainstTerrain = _this.depthTest;

            //这玩意竟然是个只读属性
            // this._scene.terrainExaggeration = this.exaggeration;

            //全球光照
            _this._globe.enableLighting = _this.enableLighting;
            //是否显示
            _this._globe.show = _this.show;
        }));

        var c = _this.baseColor;
        earth.czm.viewer.scene.globe.baseColor = new Cesium.Color(c[0], c[1], c[2], c[3]);
        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this.baseColor));
        }, function () {
            var c = _this.baseColor;
            earth.czm.viewer.scene.globe.baseColor = new Cesium.Color(c[0], c[1], c[2], c[3]);
        }));
        return _this;
    }

    (0, _createClass3.default)(TerrainEffect, [{
        key: '_update',
        value: function _update() {
            //更新当前材质
            this._updateMaterial();

            //等高线起效
            this.contour._apply();
            //颜色着色起效
            if (this.shading) this.shading._apply();
        }
    }, {
        key: '_newContourMaterial',
        value: function _newContourMaterial(shading) {

            return new Cesium.Material({
                fabric: {
                    type: "Contour" + shading,
                    materials: {
                        contour: {
                            type: "ElevationContour"
                        },
                        shading: {
                            type: shading
                        }
                    },
                    components: {
                        diffuse: "contour.alpha == 0.0 ? shading.diffuse : contour.diffuse",
                        alpha: "max(contour.alpha, shading.alpha)"
                    }
                },
                translucent: false
            });
        }
    }, {
        key: '_updateMaterial',
        value: function _updateMaterial() {
            var currentMat = this._globe.material;
            //创建当前材质
            //高程着色的时候
            if (this.contour.enabled) {
                if (this.shading === this.elevation) {

                    if (currentMat && currentMat.type == 'ContourElevationRamp') {
                        return;
                    }
                    currentMat = this._newContourMaterial('ElevationRamp');
                } else if (this.shading == this.slope) {
                    if (currentMat && currentMat.type == 'ContourSlopeRamp') {
                        return;
                    }
                    currentMat = this._newContourMaterial('SlopeRamp');
                } else if (this.shading == this.aspect) {
                    if (currentMat && currentMat.type == 'ContourAspectRamp') {
                        return;
                    }
                    currentMat = this._newContourMaterial('AspectRamp');
                } else {
                    if (currentMat && currentMat.type == 'ElevationContour') {
                        return;
                    }
                    currentMat = Cesium.Material.fromType("ElevationContour");
                }
            } else {
                if (this.shading === this.elevation) {
                    if (currentMat && currentMat.type == 'ElevationRamp') {
                        return;
                    }
                    currentMat = Cesium.Material.fromType("ElevationRamp");
                } else if (this.shading == this.slope) {
                    if (currentMat && currentMat.type == 'SlopeRamp') {
                        return;
                    }
                    currentMat = Cesium.Material.fromType("SlopeRamp");
                } else if (this.shading == this.aspect) {
                    if (currentMat && currentMat.type == 'AspectRamp') {
                        return;
                    }
                    currentMat = Cesium.Material.fromType("AspectRamp");
                } else {
                    currentMat = undefined;
                }
            }

            //更新材质
            this._globe.material = currentMat;
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(TerrainEffect.prototype.__proto__ || (0, _getPrototypeOf2.default)(TerrainEffect.prototype), 'destroy', this).call(this);
        }
    }, {
        key: '_createImage',
        value: function _createImage(base64) {
            if (!base64 || base64 == "") base64 = this._defaultImage;

            var img = document.createElement("img");
            img.src = base64;
            return img;
        }
    }]);
    return TerrainEffect;
}(_XbsjBase3.default);

TerrainEffect.defaultOptions = {
    /**
     * 地形可见用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof TerrainEffect
     */
    show: true,
    /**
     * 地形光照
     * @type {boolean}
     * @default false
     * @instance
     * @memberof TerrainEffect
     */
    enableLighting: false,
    /**
     * 高程着色
     * @type {TerrainEffect.ElevationRamp}
     * @default  null
     * @instance
     * @memberof TerrainEffect
     */
    elevation: null,
    /**
     * 坡度着色
     * @type {TerrainEffect.SlopeRamp}
     * @default  null
     * @instance
     * @memberof TerrainEffect
     */
    slope: null,
    /**
     * 坡向着色
     * @type {TerrainEffect.AspectRamp}
     * @default  null
     * @instance
     * @memberof TerrainEffect
     */
    aspect: null,
    /**
     * 等高线
     * @type {TerrainEffect.Coutour}
     * @default null
     * @instance
     * @memberof TerrainEffect
     */
    contour: null,
    /**
     * 地形限制(地形剖切)
     * @type {TerrainEffect.Restrict}
     * @default null
     * @instance
     * @memberof TerrainEffect
     */
    restrict: null,
    /**
     * 深度检测
     * @type {boolean}
     * @default false
     * @instance
     * @memberof TerrainEffect
     */
    depthTest: false,
    /**
     * 地形三角网
     * @type {boolean}
     * @default false
     * @instance
     * @memberof TerrainEffect
     */
    wireFrame: false,
    /**
     * 对数深度
     * @type {boolean}
     * @default true
     * @instance
     * @memberof TerrainEffect
     */
    logDepth: true,
    /**
     * 地形夸张
     * @type {number}
     * @default 1.0
     * @instance
     * @memberof TerrainEffect
     */
    exaggeration: 1.0,
    /**
     * 启用地下模式
     * @type {boolean}
     * @default false
     * @instance
     * @memberof TerrainEffect
     */
    subSurfaceEnabled: false,
    /**
     * 地表不透明度
     * @description 0.0表示完全透明，1.0表示完全不透明，注意地形深度检测(depthTest)关闭以后此属性才起作用！
     * @type {number}
     * @default 1.0
     * @instance
     * @memberof TerrainEffect
     */
    surfaceOpacity: 0.0,
    /**
     * 全球背景颜色
     * @instance
     * @type {number[]}
     * @memberof Effect
     */
    baseColor: [0, 0, 0.5, 1]
};

exports.default = TerrainEffect;

/***/ }),
/* 478 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地形等高线
 * @extends XbsjBase 
 */
var Contour = function (_XbsjBase) {
    (0, _inherits3.default)(Contour, _XbsjBase);

    function Contour(ramp) {
        (0, _classCallCheck3.default)(this, Contour);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Contour.__proto__ || (0, _getPrototypeOf2.default)(Contour)).call(this, ramp._earth));

        _this._ramp = ramp;
        return _this;
    }

    (0, _createClass3.default)(Contour, [{
        key: '_apply',
        value: function _apply() {
            if (!this.enabled) return;
            //获取当前globe设置的材质，如果材质上没有
            var material = this._ramp._globe.material;
            if (!material) return;
            var uniforms = void 0;
            if (material.type == 'ElevationContour') {
                uniforms = material.uniforms;
            } else if (material.materials && material.materials.contour) {
                uniforms = material.materials.contour.uniforms;
            }

            //宽度和间隔
            uniforms.width = this.width;
            uniforms.spacing = this.spacing;
            //设置颜色
            uniforms.color.red = this.color[0];
            uniforms.color.green = this.color[1];
            uniforms.color.blue = this.color[2];
            uniforms.color.alpha = this.color[3];
        }
    }]);
    return Contour;
}(_XbsjBase3.default);

Contour.defaultOptions = {
    /**
     * 开启等高线
     * @type {boolean}
     * @default false
     * @instance
     * @memberof Contour
     */
    enabled: false,
    /**
    * 等高线宽度
    * @type {number}
    * @default 1
    * @instance
    * @memberof Contour
    */
    width: 1,
    /**
     * 等高线间隔
     * @type {number}
     * @default 100
     * @instance
     * @memberof Contour
     */
    spacing: 100,
    /**
     * 等高线颜色
     * @type {number[]}
     * @default [1,0,0,1]
     * @instance
     * @memberof Contour
     */
    color: [1, 0, 0, 1]
};

exports.default = Contour;

/***/ }),
/* 479 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地形坡向分析
 * @extends XbsjObject 
 */
var AspectRamp = function (_XbsjObject) {
    (0, _inherits3.default)(AspectRamp, _XbsjObject);

    function AspectRamp(ramp) {
        (0, _classCallCheck3.default)(this, AspectRamp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (AspectRamp.__proto__ || (0, _getPrototypeOf2.default)(AspectRamp)).call(this, ramp._earth));

        _this._ramp = ramp;
        return _this;
    }

    (0, _createClass3.default)(AspectRamp, [{
        key: '_apply',
        value: function _apply() {
            if (!this.enabled) return;
            //获取当前globe设置的材质，如果材质上没有
            var material = this._ramp._globe.material;
            if (!material) return;
            var uniforms = void 0;
            if (material.type == 'AspectRamp') {
                uniforms = material.uniforms;
            } else if (material.materials && material.materials.shading) {
                if (material.materials.shading.type == 'AspectRamp') uniforms = material.materials.shading.uniforms;
            }

            if (!uniforms) return;

            //设置image
            uniforms.image = this._ramp._createImage(this.image);
        }
    }]);
    return AspectRamp;
}(_XbsjObject3.default);

AspectRamp.defaultOptions = {
    /**
     * 坡向分析启用 和 高程着色分析 、坡度着色分析互斥
     * @type {boolean}
     * @default false
     * @instance
     * @memberof AspectRamp
     */
    enabled: false,
    /**
     * 坡向分析的色带图片
     * @type {string}
     * @default ''
     * @instance
     * @memberof AspectRamp
     */
    image: ''
};

_XbsjObject3.default.registerType(AspectRamp, 'AspectRamp');

exports.default = AspectRamp;

/***/ }),
/* 480 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地形高程着色分析
 * @extends XbsjObject 
 */
var ElevationRamp = function (_XbsjObject) {
    (0, _inherits3.default)(ElevationRamp, _XbsjObject);

    function ElevationRamp(ramp) {
        (0, _classCallCheck3.default)(this, ElevationRamp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ElevationRamp.__proto__ || (0, _getPrototypeOf2.default)(ElevationRamp)).call(this, ramp._earth));

        _this._ramp = ramp;
        return _this;
    }

    (0, _createClass3.default)(ElevationRamp, [{
        key: '_apply',
        value: function _apply() {
            if (!this.enabled) return;
            //获取当前globe设置的材质，如果材质上没有
            var material = this._ramp._globe.material;
            if (!material) return;
            var uniforms = void 0;
            if (material.type == 'ElevationRamp') {
                uniforms = material.uniforms;
            } else if (material.materials && material.materials.shading) {
                if (material.materials.shading.type == 'ElevationRamp') uniforms = material.materials.shading.uniforms;
            }

            if (!uniforms) return;

            //最小和最大高度
            uniforms.minimumHeight = this.minHeight;
            uniforms.maximumHeight = this.maxHeight;
            //设置image
            uniforms.image = this._ramp._createImage(this.image);
        }
    }]);
    return ElevationRamp;
}(_XbsjObject3.default);

ElevationRamp.defaultOptions = {
    /**
     * 高程着色分析 和 坡向分析启用 、坡度着色分析互斥
     * @type {boolean}
     * @default false
     * @instance
     * @memberof ElevationRamp
     */
    enabled: false,
    /**
    * 最小高程
    * @type {number}
    * @default 0
    * @instance
    * @memberof ElevationRamp
    */
    minHeight: 0,
    /**
    * 最大高程
    * @type {number}
    * @default 5000
    * @instance
    * @memberof ElevationRamp
    */
    maxHeight: 5000,
    /**
      * 高程分析的色带图片
      * @type {string}
      * @default ''
      * @instance
      * @memberof ElevationRamp
      */
    image: ''
};
_XbsjObject3.default.registerType(ElevationRamp, 'ElevationRamp');
exports.default = ElevationRamp;

/***/ }),
/* 481 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 地形坡度着色分析
 * @extends XbsjObject 
 */
var SlopeRamp = function (_XbsjObject) {
    (0, _inherits3.default)(SlopeRamp, _XbsjObject);

    function SlopeRamp(ramp) {
        (0, _classCallCheck3.default)(this, SlopeRamp);

        var _this = (0, _possibleConstructorReturn3.default)(this, (SlopeRamp.__proto__ || (0, _getPrototypeOf2.default)(SlopeRamp)).call(this, ramp._earth));

        _this._ramp = ramp;
        return _this;
    }

    (0, _createClass3.default)(SlopeRamp, [{
        key: '_apply',
        value: function _apply() {
            if (!this.enabled) return;
            //获取当前globe设置的材质，如果材质上没有
            var material = this._ramp._globe.material;
            if (!material) return;
            var uniforms = void 0;
            if (material.type == 'SlopeRamp') {
                uniforms = material.uniforms;
            } else if (material.materials && material.materials.shading) {
                if (material.materials.shading.type == 'SlopeRamp') uniforms = material.materials.shading.uniforms;
            }

            if (!uniforms) return;

            //设置image
            uniforms.image = this._ramp._createImage(this.image);
        }
    }]);
    return SlopeRamp;
}(_XbsjObject3.default);

SlopeRamp.defaultOptions = {
    /**
       * 坡度着色分析 和 坡向分析启用 、高程着色分析互斥
       * @type {boolean}
       * @default false
       * @instance
       * @memberof SlopeRamp
       */
    enabled: false,
    /**
     * 坡度分析的色带图片
     * @type {string}
     * @default ''
     * @instance
     * @memberof SlopeRamp
     */
    image: ''
};
_XbsjObject3.default.registerType(SlopeRamp, 'SlopeRamp');
exports.default = SlopeRamp;

/***/ }),
/* 482 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _maxSafeInteger = __webpack_require__(483);

var _maxSafeInteger2 = _interopRequireDefault(_maxSafeInteger);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _Polygon = __webpack_require__(50);

var _Polygon2 = _interopRequireDefault(_Polygon);

var _mobx = __webpack_require__(2);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _registerInteractionProperty = __webpack_require__(15);

var _Math = __webpack_require__(159);

var _Math2 = _interopRequireDefault(_Math);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function isClockwise(poly) {
    var sum = 0;
    for (var i = 0; i < poly.length / 2 - 1; i++) {
        sum += (poly[2 * (i + 1) + 0] - poly[2 * i + 0]) * (poly[2 * (i + 1) + 1] + poly[2 * i + 1]);
    }
    return sum > 0;
}

var temp = void 0;
function swap(array, i, j) {
    temp = array[i];
    array[i] = array[j];
    array[j] = temp;
}

function reversePositions(positions) {
    var pl = positions.length / 2;
    for (var i = 0; i < pl / 2; ++i) {
        swap(positions, i * 2, (pl - i - 1) * 2);
        swap(positions, i * 2 + 1, (pl - i - 1) * 2 + 1);
    }
}

/**
 * 地形限制(地形剖切)
 * @memberof SceneTree
 * @extends XbsjBase 
 */

var Restrict = function (_XbsjBase) {
    (0, _inherits3.default)(Restrict, _XbsjBase);

    function Restrict(terrainEffect) {
        (0, _classCallCheck3.default)(this, Restrict);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Restrict.__proto__ || (0, _getPrototypeOf2.default)(Restrict)).call(this));

        _this._terrainEffect = terrainEffect;
        _this._earth = terrainEffect._earth;

        _this._polygon = new _Polygon2.default(_this._earth);
        _this._polygon.color = [1, 1, 0, 0];

        _this.disposers.push(function () {
            return _this._polygon.destroy();
        });
        // this.disposers.push(XbsjBase.registerProperty(this, 'polygon'));

        // extendObservable(this, {
        //     positions: [],
        //     height: 0.0,
        //     enabled: false,
        //     showHelper: false,
        //     edgeWidth: 1,
        //     edgeColor: [1, 1, 1, 1],        
        //     unionClippingRegions: false,    
        // });

        // this.disposers.push(XbsjBase.registerArrayProperty(this, 'positions', positionJson => {
        //     return [...positionJson];
        // }, () => {}));

        _this.disposers.push((0, _bind.track)(_this._polygon, 'positions', _this, 'positions'));
        _this.disposers.push((0, _bind.track)(_this._polygon, 'height', _this, 'height'));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonCreating)(_this._earth, _this, {
            polygonPointAddingProperty: 'creating'
        }));

        _this.disposers.push((0, _registerInteractionProperty.registerPolygonEditing)(_this._earth, _this, {
            polygonEditingProperty: 'editing'
        }));

        // 编辑模式下自动关闭，否则会造成闪烁
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                creating: _this.creating,
                editing: _this.editing
            };
        }, function () {
            if (_this.creating || _this.editing) {
                _this.enabled = false;
            }
        }));

        _this.disposers.push((0, _mobx.autorun)(function () {
            _this._polygon.show = _this.showHelper;
        }));

        _this._alwayTopImageryLayer = undefined;

        var scene = _this._earth.czm.scene;
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                positions: [].concat((0, _toConsumableArray3.default)(_this.positions)),
                innerDiscard: _this.innerDiscard,
                enabled: _this.enabled
            };
        }, function () {
            scene.xbsjRestrictImagery = _this.enabled;

            if (_this._alwayTopImageryLayer) {
                scene.imageryLayers.remove(_this._alwayTopImageryLayer);
                _this._alwayTopImageryLayer = undefined;
            }

            if (_this.enabled) {
                _this._alwayTopImageryLayer = new Cesium.ImageryLayer(new Cesium.RestrictImageryProvider({
                    positions: _this.positions,
                    innerDiscard: _this.innerDiscard
                }));
                _this._alwayTopImageryLayer.xbsjZIndex = _maxSafeInteger2.default;
                scene.imageryLayers.add(_this._alwayTopImageryLayer);
            }

            _this._earth._xbsjImageryZIndexDirty = true;
        }));

        // // globe.depthTestAgainstTerrain = true;
        // const globe = this._earth.czm.scene.globe;
        // globe.clippingPlanes = new Cesium.ClippingPlaneCollection({
        //     modelMatrix : Cesium.Matrix4.clone(Cesium.Matrix4.IDENTITY),
        //     planes : [
        //         // new Cesium.ClippingPlane(new Cesium.Cartesian3( 0.0, -1.0, 0.0), -700.0)
        //     ],
        //     edgeWidth: this.edgeWidth,
        //     edgeColor: new Cesium.Color(...this.edgeColor),
        //     enabled : this.enabled,
        //     unionClippingRegions: false,
        // });

        // this.disposers.push(autorun(() => {
        //     globe.clippingPlanes.enabled = this.enabled;
        //     globe.clippingPlanes.edgeColor.red = this.edgeColor[0];
        //     globe.clippingPlanes.edgeColor.green = this.edgeColor[1];
        //     globe.clippingPlanes.edgeColor.blue = this.edgeColor[2];
        //     globe.clippingPlanes.edgeColor.alpha = this.edgeColor[3];

        //     globe.clippingPlanes.edgeWidth = this.edgeWidth;
        //     // globe.clippingPlanes.unionClippingRegions = this.unionClippingRegions;
        // }));

        // const scratchStart = new Cesium.Cartesian3();
        // const scratchEnd = new Cesium.Cartesian3();
        // const scratchCartesian = new Cesium.Cartesian3();
        // const scratchCartesian2 = new Cesium.Cartesian3();
        // const scratchCartesian3 = new Cesium.Cartesian3();
        // const scratchCartesian4 = new Cesium.Cartesian3();
        // const scratchCartesian5 = new Cesium.Cartesian3();
        // const scratchPlane = new Cesium.Plane(new Cesium.Cartesian3(0, 0, 1), 0.0);
        // this.disposers.push(autorun(() => {
        //     const planes = [];
        //     const l = globe.clippingPlanes.length;
        //     for (let i=0; i<l; ++i) {
        //         planes.push(globe.clippingPlanes.get(i));
        //     }
        //     globe.clippingPlanes.removeAll();

        //     if (this.positions.length >= 2*3) {
        //         let positions = this.positions;
        //         // 逆时针且union为true时，抛弃外围；顺时针且union为false时，挖坑
        //         if (this.innerDiscard) { // 挖坑
        //             globe.clippingPlanes.unionClippingRegions = false;
        //             if (!isClockwise(positions)) {
        //                 positions = [...positions];
        //                 reversePositions(positions);
        //             }
        //         } else {
        //             globe.clippingPlanes.unionClippingRegions = true;
        //             if (isClockwise(positions)) {
        //                 positions = [...positions];     
        //                 reversePositions(positions);
        //             }
        //         }

        //         const sum = [0, 0, 0];

        //         const l = positions.length / 2;

        //         for (let i=0; i<l; ++i) {
        //             sum[0] += positions[i*2];
        //             sum[1] += positions[i*2 + 1];
        //         }
        //         sum[0] /= l;
        //         sum[1] /= l;
        //         sum[2] = this.height;

        //         const center = Cesium.Cartesian3.fromRadians(sum[0], sum[1], sum[2], undefined, scratchCartesian);
        //         Cesium.Matrix4.fromTranslation(center, globe.clippingPlanes.modelMatrix);
        //         const up = Cesium.Cartesian3.normalize(center, scratchCartesian2);

        //         planes.length = l;
        //         for (let i=0; i<l; ++i) {
        //             const start = Cesium.Cartesian3.fromRadians(positions[i*2], positions[i*2+1], this.height, undefined, scratchStart);
        //             let ii = (i + 1) % l;
        //             const end = Cesium.Cartesian3.fromRadians(positions[ii*2], positions[ii*2+1], this.height, undefined, scratchEnd);
        //             if (Cesium.Cartesian3.distanceSquared(start, end) > 0.01) {
        //                 const dir = Cesium.Cartesian3.subtract(end, start, scratchCartesian3);
        //                 Cesium.Cartesian3.normalize(dir, dir);
        //                 const normal = Cesium.Cartesian3.cross(up, dir, scratchCartesian4);
        //                 Cesium.Cartesian3.normalize(normal, normal);
        //                 const point = Cesium.Cartesian3.subtract(start, center, scratchCartesian5);
        //                 const plane = Cesium.Plane.fromPointNormal(point, normal, scratchPlane);
        //                 planes[i] = Cesium.ClippingPlane.fromPlane(plane, planes[i]);
        //             }
        //         }
        //         planes.forEach(e => globe.clippingPlanes.add(e));
        //     }
        // }));
        return _this;
    }

    (0, _createClass3.default)(Restrict, [{
        key: 'flyTo',
        value: function flyTo() {
            var l = this.positions.length / 2;
            var center = [0, 0, 0];
            var min = [Number.POSITIVE_INFINITY, Number.POSITIVE_INFINITY];
            var max = [Number.NEGATIVE_INFINITY, Number.NEGATIVE_INFINITY];
            for (var i = 0; i < l; ++i) {
                var p0 = this.positions[i * 2 + 0];
                var p1 = this.positions[i * 2 + 1];
                center[0] += p0;
                center[1] += p1;
                min[0] = min[0] < p0 ? min[0] : p0;
                min[1] = min[1] < p1 ? min[1] : p1;
                max[0] = max[0] > p0 ? max[0] : p0;
                max[1] = max[1] > p1 ? max[1] : p1;
            }

            center[0] /= l;
            center[1] /= l;
            center[2] = this.height;

            var d = _Math2.default.geoDistance(min, max);

            this._earth.camera.flyTo(center, d);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(Restrict.prototype.__proto__ || (0, _getPrototypeOf2.default)(Restrict.prototype), 'destroy', this).call(this);
        }
    }]);
    return Restrict;
}(_XbsjBase3.default);

Restrict.defaultOptions = {
    /**
     * 计算网格所构成的多边形坐标位置，形如： [经度, 纬度, 经度, 纬度, ...]
     * @description 注意：必须是偶数个元素！
     * @instance
     * @memberof TerrainEffect.Restrict
     * @type {number[]}
     * @default []
     */
    positions: [],
    /**
     * 多边形区域高度
     * @instance
     * @memberof TerrainEffect.Restrict
     * @type {number}
     * @default 0.0
     */
    height: 0.0,
    /**
     * 是否开启
     * @instance
     * @memberof TerrainEffect.Restrict
     * @type {boolean}
     * @default false
     */
    enabled: false,
    /**
     * 是否显示辅助线框
     * @type {boolean}
     * @instance
     * @default false
     * @memberof TerrainEffect.Restrict
     */
    showHelper: false,
    /**
     * 边缘线宽度
     * @type {number}
     * @instance
     * @default 1
     * @memberof TerrainEffect.Restrict
     */
    edgeWidth: 1,
    /**
     * 等高线颜色
     * @type {number[]}
     * @default [1, 1, 1, 1]
     * @instance
     * @memberof TerrainEffect.Restrict
     */
    edgeColor: [1, 1, 1, 1],
    // unionClippingRegions: false,    
    /**
     * 是否裁切多边形内部（挖坑），若为false，则裁切多边形外部区域。
     * @type {boolean}
     * @instance
     * @default false
     * @memberof TerrainEffect.Restrict
     */
    innerDiscard: false
};

exports.default = Restrict;

/***/ }),
/* 483 */
/***/ (function(module, exports, __webpack_require__) {

module.exports = { "default": __webpack_require__(484), __esModule: true };

/***/ }),
/* 484 */
/***/ (function(module, exports, __webpack_require__) {

__webpack_require__(485);
module.exports = 0x1fffffffffffff;


/***/ }),
/* 485 */
/***/ (function(module, exports, __webpack_require__) {

// 20.1.2.6 Number.MAX_SAFE_INTEGER
var $export = __webpack_require__(16);

$export($export.S, 'Number', { MAX_SAFE_INTEGER: 0x1fffffffffffff });


/***/ }),
/* 486 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _Atmosphere = __webpack_require__(487);

var _Atmosphere2 = _interopRequireDefault(_Atmosphere);

var _Fog = __webpack_require__(488);

var _Fog2 = _interopRequireDefault(_Fog);

var _Moon = __webpack_require__(489);

var _Moon2 = _interopRequireDefault(_Moon);

var _Rain = __webpack_require__(490);

var _Rain2 = _interopRequireDefault(_Rain);

var _Snow = __webpack_require__(491);

var _Snow2 = _interopRequireDefault(_Snow);

var _Sun = __webpack_require__(492);

var _Sun2 = _interopRequireDefault(_Sun);

var _SkyBox = __webpack_require__(493);

var _SkyBox2 = _interopRequireDefault(_SkyBox);

var _WorldCloud = __webpack_require__(494);

var _WorldCloud2 = _interopRequireDefault(_WorldCloud);

var _RainPostProcess = __webpack_require__(495);

var _RainPostProcess2 = _interopRequireDefault(_RainPostProcess);

var _SnowPostProcess = __webpack_require__(505);

var _SnowPostProcess2 = _interopRequireDefault(_SnowPostProcess);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 天气
 * @class
 */
var Weather = function (_XbsjBase) {
    (0, _inherits3.default)(Weather, _XbsjBase);

    function Weather(earth) {
        (0, _classCallCheck3.default)(this, Weather);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Weather.__proto__ || (0, _getPrototypeOf2.default)(Weather)).call(this));

        _this._earth = earth;
        _this._scene = earth.czm.scene;
        _this._globe = _this._scene.globe;

        _this.atmosphere = new _Atmosphere2.default(earth);
        _this.sun = new _Sun2.default(earth);
        _this.skyBox = new _SkyBox2.default(earth);
        _this.snow = new _Snow2.default(earth);
        _this.rain = new _Rain2.default(earth);
        _this.moon = new _Moon2.default(earth);
        _this.fog = new _Fog2.default(earth);
        _this.cloud = new _WorldCloud2.default(earth);
        _this.rainPostProcess = new _RainPostProcess2.default(earth);
        _this.snowPostProcess = new _SnowPostProcess2.default(earth);

        _this._disposers = [];

        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'atmosphere'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'sun'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'skyBox'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'snow'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'rain'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'moon'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'fog'));
        _this._disposers.push(_XbsjBase3.default.registerProperty(_this, 'cloud'));
        return _this;
    }

    (0, _createClass3.default)(Weather, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            return (0, _get3.default)(Weather.prototype.__proto__ || (0, _getPrototypeOf2.default)(Weather.prototype), 'destroy', this).call(this);
        }
    }, {
        key: 'sunPosition',
        get: function get() {
            var viewer = this._earth.czm.viewer;
            var mat = Cesium.Transforms.computeTemeToPseudoFixedMatrix(viewer.clock.currentTime);
            var p = Cesium.Simon1994PlanetaryPositions.computeSunPositionInEarthInertialFrame(viewer.clock.currentTime);
            Cesium.Matrix3.multiplyByVector(mat, p, p);
            return p;
        }
    }, {
        key: 'moonPosition',
        get: function get() {
            var viewer = this._earth.czm.viewer;
            var mat = Cesium.Transforms.computeTemeToPseudoFixedMatrix(viewer.clock.currentTime);
            var p = Cesium.Simon1994PlanetaryPositions.computeMoonPositionInEarthInertialFrame(viewer.clock.currentTime);
            Cesium.Matrix3.multiplyByVector(mat, p, p);
            return p;
        }
    }]);
    return Weather;
}(_XbsjBase3.default);

Weather.defaultOptions = {
    /**
     * 雾
     * @type {Weather.Fog}
     * @instance
     * @memberof Weather
     */
    fog: {},
    /**
     * 太阳
     * @type {Weather.Sun}
     * @instance
     * @memberof Weather
     */
    sun: {},
    /**
     * 天空盒
     * @type {Weather.SkyBox}
     * @instance
     * @memberof Weather
     */
    skyBox: {},
    /**
     * 月亮
     * @type {Weather.Moon}
     * @instance
     * @memberof Weather
     */
    moon: {},
    /**
     * 雨
     * @type {Weather.Rain}
     * @instance
     * @memberof Weather
     */
    rain: {},
    /**
     * 雪
     * @type {Weather.Snow}
     * @instance
     * @memberof Weather
     */
    snow: {},
    /**
     * 云
     * @type {Weather.WorldCloud}
     * @instance
     * @memberof Weather
     */
    cloud: {},
    /**
     * 大气
     * @type {Weather.Atmosphere}
     * @instance
     * @memberof Weather
     */
    atmosphere: {}
};

exports.default = Weather;

/***/ }),
/* 487 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 大气
 * @class
 * @memberof Weather
 */
var Atmosphere = function (_XbsjBase) {
  (0, _inherits3.default)(Atmosphere, _XbsjBase);

  function Atmosphere(earth) {
    (0, _classCallCheck3.default)(this, Atmosphere);

    var _this = (0, _possibleConstructorReturn3.default)(this, (Atmosphere.__proto__ || (0, _getPrototypeOf2.default)(Atmosphere)).call(this));

    _this._earth = earth;

    //监控自己的值的变化，如果变化就设置到cesium中去
    _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {
      var skyAtmosphere = _this._earth.czm.scene.skyAtmosphere;
      skyAtmosphere.show = _this.enabled;
      skyAtmosphere.brightnessShift = _this.brightnessShift;
      skyAtmosphere.hueShift = _this.hueShift;
      skyAtmosphere.saturationShift = _this.saturationShift;
    });

    return _this;
  }

  (0, _createClass3.default)(Atmosphere, [{
    key: 'destroy',
    value: function destroy() {
      if (this.autoUpdateDisposer) {
        this.autoUpdateDisposer();
        this.autoUpdateDisposer = undefined;
      }
      return (0, _get3.default)(Atmosphere.prototype.__proto__ || (0, _getPrototypeOf2.default)(Atmosphere.prototype), 'destroy', this).call(this);
    }
  }]);
  return Atmosphere;
}(_XbsjBase3.default);

Atmosphere.defaultOptions = {
  /**
   * 是否启用
   * @type {boolean}
   * @default true
   * @instance
   * @memberof Weather.Atmosphere
   */
  enabled: true,
  /**
   * 亮度偏移
   * @type {number}
   * @default 0
   * @instance
   * @memberof Weather.Atmosphere
   */
  brightnessShift: 0,
  /**
   * 色调偏移
   * @type {number}
   * @default 0
   * @instance
   * @memberof Weather.Atmosphere
   */
  hueShift: 0,
  /**
   * 饱和度偏移
   * @type {number}
   * @default 0
   * @instance
   * @memberof Weather.Atmosphere
   */
  saturationShift: 0
};

exports.default = Atmosphere;

/***/ }),
/* 488 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 雾
 * @class
 * @memberof Weather
 */
var Fog = function (_XbsjBase) {
    (0, _inherits3.default)(Fog, _XbsjBase);

    function Fog(earth) {
        (0, _classCallCheck3.default)(this, Fog);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Fog.__proto__ || (0, _getPrototypeOf2.default)(Fog)).call(this));

        _this._earth = earth;

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var fog = _this._earth.czm.scene.fog;
            fog.enabled = _this.enabled;
            fog.density = _this.density;
            fog.minimumBrightness = _this.minimumBrightness;
            fog.screenSpaceErrorFactor = _this.screenSpaceErrorFactor;
        });
        return _this;
    }

    (0, _createClass3.default)(Fog, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(Fog.prototype.__proto__ || (0, _getPrototypeOf2.default)(Fog.prototype), 'destroy', this).call(this);
        }
    }]);
    return Fog;
}(_XbsjBase3.default);

Fog.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Fog
     */
    enabled: false,
    /**
     * 浓度
     * @type {number}
     * @default 2.0e-4
     * @instance
     * @memberof Weather.Fog
     */
    density: 2.0e-4,
    /**
     * 最小亮度
     * @type {number}
     * @default 0.1
     * @instance
     * @memberof Weather.Fog
     */
    minimumBrightness: 0.1,
    /**
     * 屏幕容错因子
     * @type {number}
     * @default 2.0
     * @instance
     * @memberof Weather.Fog
     */
    screenSpaceErrorFactor: 2.0
};

exports.default = Fog;

/***/ }),
/* 489 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 月亮
 * @class
 * @memberof Weather
 */
var Moon = function (_XbsjBase) {
    (0, _inherits3.default)(Moon, _XbsjBase);

    function Moon(earth) {
        (0, _classCallCheck3.default)(this, Moon);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Moon.__proto__ || (0, _getPrototypeOf2.default)(Moon)).call(this));

        _this._earth = earth;

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var moon = _this._earth.czm.scene.moon;
            moon.show = _this.enabled;
            moon.onlySunLighting = _this.onlySunLighting;
            // moon.textureUrl = this.textureUrl; 
        });

        return _this;
    }

    (0, _createClass3.default)(Moon, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(Moon.prototype.__proto__ || (0, _getPrototypeOf2.default)(Moon.prototype), 'destroy', this).call(this);
        }
    }]);
    return Moon;
}(_XbsjBase3.default);

Moon.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Moon
     */
    enabled: true,
    /**
     * 仅启用日光
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Moon
     */
    onlySunLighting: true
    /**
     * 纹理路径
     * @type {string}
     * @default '''
     * @instance
     * @memberof Weather.Moon
     */
    // textureUrl:''
};

exports.default = Moon;

/***/ }),
/* 490 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 雨
 * @class
 * @memberof Weather
 */
var Rain = function (_XbsjBase) {
    (0, _inherits3.default)(Rain, _XbsjBase);

    function Rain(earth) {
        (0, _classCallCheck3.default)(this, Rain);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Rain.__proto__ || (0, _getPrototypeOf2.default)(Rain)).call(this));

        _this._earth = earth;

        var rainSystem;
        var scene = _this._earth.czm.scene;

        //  const xbsjEarthScriptUrl = XbsjTools.getScriptBaseUrl('XbsjEarth');
        // var image = XbsjTools.getScriptBaseUrl('XbsjEarth')+'images/circular_particle.png';


        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            //如果不可见，那么直接销毁
            if (!_this.enabled) {
                if (rainSystem) {

                    scene.primitives.remove(rainSystem);
                    rainSystem = undefined;
                }
            } else {
                //如果没有，那么久创建 而且是视点位置
                if (!rainSystem) {

                    var rainParticleSize = scene.drawingBufferWidth / 80.0;
                    var rainRadius = 100000.0;
                    var rainImageSize = new Cesium.Cartesian2(rainParticleSize, rainParticleSize * 2.0);

                    var rainGravityScratch = new Cesium.Cartesian3();
                    var rainUpdate = function rainUpdate(particle, dt) {
                        rainGravityScratch = Cesium.Cartesian3.normalize(particle.position, rainGravityScratch);
                        rainGravityScratch = Cesium.Cartesian3.multiplyByScalar(rainGravityScratch, -1050.0, rainGravityScratch);

                        particle.position = Cesium.Cartesian3.add(particle.position, rainGravityScratch, particle.position);

                        var distance = Cesium.Cartesian3.distance(scene.camera.position, particle.position);
                        if (distance > rainRadius) {
                            particle.endColor.alpha = 0.0;
                        } else {
                            particle.endColor.alpha = rainSystem.endColor.alpha / (distance / rainRadius + 0.1);
                        }
                    };

                    rainSystem = new Cesium.ParticleSystem({
                        modelMatrix: new Cesium.Matrix4.fromTranslation(scene.camera.position),
                        speed: -1,
                        lifetime: 10,
                        emitter: new Cesium.SphereEmitter(rainRadius),
                        startScale: _this.startScale,
                        endScale: _this.endScale,
                        //  image:image,
                        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xOdTWsmQAAANMSURBVFhH7dc9j41BGMbx3bVrNwQJEq+dlwpB+AB0FEoaJQU+goSOEC3fAAndNgpaGq0CBRWV0ImIOK7fyT2bk33snuMUu4qd5J9M5r7ua56ZuWfO7sRa++9br9drTIapMB1mwmyYK/SNidHQ9vPGbs2gzNaF9WFD2BK2hR1hV6FvTIyGVs54H9KSgtVYGdOtYXfYFw6F4+FkoW9MjIZWjlweo39EE1eilWwKO8OBcCKcDufChXCx0DcmRkMrRy6P0T+ihG1yW7onHA6nwvlwNVwPt8K9Qt+YGA2tHLk8Fj5i2UYQnJut8/UMjoYz4VK4Ee6HR2E+PCv0jYnR0MqRy4MXz35NLNkEg+JxfrbQKhhdCXfCw/A8vA5vwttC35gYDa0cuTx48eRds/2lJegLbZcico620moYPgkvw7vwKXwJ3wp9Y2I0tHLk8uDFk/dkTddtCTonX6qSFZPztKVWxfhD+Bq+h5/hV6FvTIyGVo5cHrx48p6q6botQQ+JonGdVLSicq621upM8COY9PcijInR0MqRy4MXT97TNV23JahQPCjutGulshWX87XFVjk4eWuDH0FDK0cuD148ec/UdN2WoCfVq+ZhcbddLxWuyJyzrV48eWttnIZWjlwevHjynq3pui1B77qn1evmgXHHXTOVrtja6pdqYjS0cuTy4MWT91xN122CJVq1D1j1I1CE28NgET4OCupzGLUIaeXIHSxC3ssWYbuG+4Orcy08CC/C+zDqNaSVI5cHL55Dr2F7iLzfHg9bdzO4Tq/Cx2ACq7TVJoW+MTEaWjlyefDiOfQhGnyKDwZffjncDU8DY6uzxc5ZsUHfmBgNrRy5PHiN9BTDD8bG4AfkSDgbvGYMrcrWOl9FptKhb0yMhlaOXB68eA79MWq7oBg3h73hWGBkNbbUuSouFe6aQd+YGA2tHLk8eA3/OdYIglpwJRUNA6uwlc5TUans28Edh74xMRpaOXJ58Br+B4lGVLSP8PW20DkqJuaulYk8MNA3JkZDK0fuwuQYqTVxJdo656eIVLLr5E57WLxu0DcmRkMrR+6/Td5aSwrOTfGoYNfIlnpQvGqeVugbE6OhldM/c4zdmkGZWc3K/GOy1lamTUz8Af7rUXt1Ah4SAAAAAElFTkSuQmCC',
                        emissionRate: _this.emissionRate,
                        startColor: new Cesium.Color(_this.startColor[0], _this.startColor[1], _this.startColor[2], _this.startColor[3]),
                        endColor: new Cesium.Color(_this.endColor[0], _this.endColor[1], _this.endColor[2], _this.endColor[3]),
                        imageSize: rainImageSize,
                        updateCallback: rainUpdate
                    });
                    rainSystem.show = _this.enabled;
                    scene.primitives.add(rainSystem);
                }
            }

            //如果有其实属性更新，那么直接设置
            if (rainSystem) {

                rainSystem.emissionRate = _this.emissionRate;
                rainSystem.startScale = _this.startScale;
                rainSystem.endScale = _this.endScale;
                rainSystem.startColor = new Cesium.Color(_this.startColor[0], _this.startColor[1], _this.startColor[2], _this.startColor[3]);
                rainSystem.endColor = new Cesium.Color(_this.endColor[0], _this.endColor[1], _this.endColor[2], _this.endColor[3]);
            }
        });

        return _this;
    }

    (0, _createClass3.default)(Rain, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(Rain.prototype.__proto__ || (0, _getPrototypeOf2.default)(Rain.prototype), 'destroy', this).call(this);
        }
    }]);
    return Rain;
}(_XbsjBase3.default);

Rain.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Rain
     */
    enabled: false,
    /**
     * 发射速率
     * @type {number}
     * @default 5000.0,
     * @instance
     * @memberof Weather.Rain
     */
    emissionRate: 5000.0,
    /**
     * 初始缩放比
     * @type {number}
     * @default 1.0
     * @instance
     * @memberof Weather.Rain
     */
    startScale: 1.0,
    /**
     * 结束缩放比
     * @type {number}
     * @default 0.0
     * @instance
     * @memberof Weather.Rain
     */
    endScale: 0,
    /**
     * 初始颜色
     * @type {number[]}
     * @default [0.27, 0.5, 0.70, 0.0]
     * @instance
     * @memberof Weather.Rain
     */
    startColor: [0.27, 0.5, 0.70, 0.0],
    /**
     * 结束颜色
     * @type {number[]}
     * @default [0.27, 0.5, 0.70, 0.98]
     * @instance
     * @memberof Weather.Rain
     */
    endColor: [0.27, 0.5, 0.70, 0.98]
};

exports.default = Rain;

/***/ }),
/* 491 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 雪
 * @class
 * @memberof Weather
 */
var Snow = function (_XbsjBase) {
    (0, _inherits3.default)(Snow, _XbsjBase);

    function Snow(earth) {
        (0, _classCallCheck3.default)(this, Snow);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Snow.__proto__ || (0, _getPrototypeOf2.default)(Snow)).call(this));

        _this._earth = earth;
        var scene = earth.czm.scene;

        var snowSystem;

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            //如果不可见，那么直接销毁
            if (!_this.enabled) {
                if (snowSystem) {

                    scene.primitives.remove(snowSystem);
                    snowSystem = undefined;
                }
            } else {
                //如果没有，那么久创建 而且是视点位置
                if (!snowSystem) {

                    var snowParticleSize = scene.drawingBufferWidth / 100.0;
                    var snowRadius = 100000.0;
                    var minimumSnowImageSize = new Cesium.Cartesian2(snowParticleSize, snowParticleSize);
                    var maximumSnowImageSize = new Cesium.Cartesian2(snowParticleSize * 2.0, snowParticleSize * 2.0);

                    var snowGravityScratch = new Cesium.Cartesian3();
                    var snowUpdate = function snowUpdate(particle, dt) {
                        snowGravityScratch = Cesium.Cartesian3.normalize(particle.position, snowGravityScratch);
                        Cesium.Cartesian3.multiplyByScalar(snowGravityScratch, Cesium.Math.randomBetween(-30.0, -300.0), snowGravityScratch);
                        particle.velocity = Cesium.Cartesian3.add(particle.velocity, snowGravityScratch, particle.velocity);

                        var distance = Cesium.Cartesian3.distance(scene.camera.position, particle.position);
                        if (distance > snowRadius) {
                            particle.endColor.alpha = 0.0;
                        } else {
                            particle.endColor.alpha = snowSystem.endColor.alpha / (distance / snowRadius + 0.1);
                        }
                    };

                    snowSystem = new Cesium.ParticleSystem({
                        modelMatrix: new Cesium.Matrix4.fromTranslation(scene.camera.position),
                        minimumSpeed: -1.0,
                        maximumSpeed: 0.0,
                        lifetime: 15.0,
                        emitter: new Cesium.SphereEmitter(snowRadius),
                        startScale: _this.startScale,
                        endScale: _this.endScale,
                        image: 'data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABGdBTUEAALGPC/xhBQAAAAlwSFlzAAAOwgAADsIBFShKgAAAABl0RVh0U29mdHdhcmUAcGFpbnQubmV0IDQuMC4xOdTWsmQAAAxDSURBVHhe7dsJjG1FEQbgx1ORRXZBBBEkLAKiEQg+IIBBFpVFUNSASIgYEIn7vhNXFI1CNODKoiIoUYJbUCERcCEmBldUIBE0BFQ2FQSR9/y/Q9fJvTN3nsydYWbAqeRPn9NdXVW9VVf3uXfJIi3SIi3SfNKKFSuWtcf/H0qjVxnAmfXcih9eNNDQwtLgEQ3rBPe21LuyIf4m5qFFAw2oxj4Sli9f/qhg1Tw/GvK8T1K0X+B9VTx57viDoU5p4hcmlZHN4BphDdLg1ZKunnSN4DGQ97WCd+R5RUu7/GCNxquOulDyFmZnNKMGR7sb5TRAg9cM1s7zOsF6wQbBYyH5FwU64NstTxkeS2LtYM08k2HGkDk0K5r6+SNGNNQIGfHVkhpFI6zR6+d9w2DjPG+S9AlJn9jwp7zrgBu9tzI8Gwcb5nn9gIy18k4m2YMzYv5mQylnSAyzbrsRZ2ywbmBEHxdsGmye8i2TbhVsG2yX9z2CnpL3zFa2VV7xbh6oSwZZZJLdzYikdM5PJ5RSBjRDjIx1bbRMY0ZvFjwp2Dpl2yfdMXh6sEuwa/LeEPSUvDe1Mjw7JkudrQMyyCKTbMuDr+Aj5r4TShnFMcB0ZIiRsXY3CozaFsE2wVOCnQIN3iPp3sE+Aa9/btBT8r7ayvbOK95dA3XJIItMsumgy7IoRzk3nVBKKKQ4qClvnVvjmyU1zXcIGL9boNH7BQcGhwYvCF4UXBXenvL+m1aGB6866pJB1g5hI5sOuviHbkkED34nlPCmqGt8Ut7dtGSQNWuknhoYvb2C/YODw3d40iODY4Jjg+OCu5LfU97vbmV4jkyWOgcHZJBFJtl00EXnBuFjA1se3E5ogrvGBzXtjcLjA+u0pjvn9qykBwUacVSgYScErw5eH5wcnkmU/I81HrzqqEvGQSkm09KgY7uATrq7mZDywR1idjuAwGBpFInkyuFZh0aBIQzaOTgtODo4NDxHJNWIEwONfkvwzuCk4MKUT6LkX9R48Kqj7rEpIsvSOCDYM3hO8JHAkmDDeuFhUznG2Y0TmkA9KyAR2FBY017jjQrDjkn+bUnPCYzia4O3Bu8JPhB8ODDKPw/fJEr+LxsPXnXUJeP44OiwmA2fCG4Jnh/QbYsVN7CJbWxk69Jm/swogobWfWCr44kFMvbtavyzAwZ+Mbwa88fg1EBjTgkY/sng9OBmPBMp+X9tPHjVUfddwRsDHXJ14zs7oJNuNrCFTWwb8getGeNThBh9IWite07PdmT6PS3YPTA1eXAO7FXB9eFn6L3BTwKN/kzw+YDx/1E+ilJm9uD9VPDxwIy4OHBqVH59YBehk242sIVNbCt/wOaZzYII6EY/QvWonq2pb0+21dnfOSfr09p/ZfDmwCh2BqM8m7LfCb4UfLdlj6SUfz/QSTrra8FfWpGy+4IPBuVn6LY7sGWLvNdSGNoaW3OmTyoHjrE1+g4w4nVbkelnezoweZyUdVpTlYO6MvmDlKzlvwt+0d5HUivX8N+qcH/u/ZTXHwV0HJ9XOsULbGDLNsljm7CZrTULxusAFYPy/LX2haPdlpeyZUnt0db9ywLOynr9UGDtfy64LXxDlLx+ZoyilP8t+Ed77Sl5twb8Ah100Un3/ilmi22YbWzsfEEw/o6gUlCe3xZTa198rsdFaQIVe7XtisfmtKzbM4Kzgu8FQ6M4LkXMNwKy6aCLTrrZwBY2sa3zBanivFA7wtgd0E3/pM7mjqe8ra3HuhPPGwF7vT3b1DdCnNcXAutdfP/78M2IIsPSIZNsOuiiU4zABmEzm9jmWO34LUIcfxmopHKErB44gXEwjqlOaiIy6+8lgf1e4GJkbF88+NnhOT/pD4JfBSud9iuj1L0nySVJdSjZdNBFJ91s4IfYxLYtA47aMnCzNHYHdOs/qbUk6tskMMUcV005nt+2J3QVvX024MF/HdjPp9zqxiHymtyrgm8F/AzdbGALm9jGRrbWbtD5gdasB04qpbKtpFv/SXlYQYcz+2GB7eibwdXBv1I+5xS9dwVmmF2Dc9w32DZFbO38QFJtmF4HpELvACPAdDLd3x8ISG5M/oKl2PfnwB0jP2GH0BHTc4SYg92Dc4Kx1+8CIfafFezWmve/KczdDEgPCoA4P2uM4+HURsbxC4Vi303BxXk0A54bCN7GmgHVAWJrW6CTn5DTDc1RyXOq4/SuyzNPPecU3fcE1+aRL7JEnxew0QmRzRURjtcBAR/QhcCB/XX7YFngICIUtQ1VAPTl4LLgmmBSBDgbRG7A6doWRZpvD9hwRIoPCNjmMlW80oXEeZ9+MIS5VRrsADezfRAUOJG52nKb+75AlPbpQAxwXtILg8sD2+ItyRuLUtex+rI8XpDUIYkOuuikmw1sGQyG2Dp+B6BUGNoGm9DaBt3eOv5WFOiWx5Jw7D0z+ErAYOGrW55/Rs5YlLp3BjqTTLLpoIvOLhoM2MImtrGRreNvgyiVVknlwUCo7gAmBkKvCezBzu2OwUJWy0EY/PXgmsiYEUXGH5pMsumgi066JwZCdTcwGAhNb/SRSoFQmBBfZaYKhd0BlB+oUNj2aRnYNWbjMESM+4TBUJhOuieFwknFLmx2hzGzs0DQHYYizJVT3QFaa3UUfnlQy+CjQR2GjNio4/BKd4yUW/N3tteeknd7YPrTUdOf7u5IHNT6Z+NGqeIAN+PDUN0GWUuunwePw77lHRK8NHA0fVtQs8Bx+GepN0TJuy64vL2OpJRfEfAbdpOJFyI/Deigi0662cCWweOwDzW1/qfvAJFKwdCFSN5NrfoGIB6wHb4w4IheF7w7ODkYuvfL89+DSwM+QeNWdieonAPlQ4Tet7ciZa7E+AC66KSbDWzpLkTCVifB/iAUTL8DkIrByq7EOB4fQHz1eUVgWzI9bwhfGWwbPC+vfIJGadytyidS8u/Ak0e8lpBLFfv9lcF9jcelqLVPJ91sYMvsXokhlYNRl6JmgYjrGYETmNOhi8oTU35BwNCbA1uXfZtPcNvrTH9uMPKSJPnXNh686qjrY4s7xtPDUrfN5NJJNxvY0o1+MHuXoigCJl6L6+HOFyTPlbRPYaIwzsjUvCPPpu57A8uBT+AYeXA3vfbyK8IziZL/48aDVx11yTgpxS5AnP/NJs5Vh9PNhlr7FfzU6M/840iEDM2CpNZXfRh5cmD61ecqI1cOynLgEzgtnltjrF+e/PzImkTJd67Hg1cddckgi0x7vnUvNUPoZkP/YSRiZm/0iyKomwURrGddNtZScBcv9vZd0PV0fRA1OnyCGaFD+AWNMZVFcULZu1O3p7z/u+XjwauOumSQRSbZOpqunVPNjy4Gvwfw/LM3+kURVrOAV62l0H0Zzrs7OJ0gDN0zz7yy9clJ2aeNnD1b4CJ60zBxvFNkT3m/oZXhwauOumSQdVjYyDbbdsmzg5mgZ+gLcVI2zt7oFxFIcBT4RuiiVCc4I/hRU3XCTklFZJyT62rT1V6tETy30FXDfD26JLw95f2HrQwPXnXUJYOsfcNGNh3VeHd/3eewgE2zO/UHidAGS2HwBxIcj1HwucxBhFPimf3UxYgJVExdIau1q2G+Ip2R8p7yzuMrw4NXnUNSRIatjkyy6aCLTtty9wOJQOO7bQ+a2bNLTXj5g1G/EuGMHEZsSxyUAEWUJlR1dvA9T8NeHByX557yfkISZQ42eNVRt/+JTEA2HXQ57U1s/PhBzwMlCpqi6oRaDpwQT2w7EicIlupXI/2PpJL6oOmjipG9KSly3S1P2VQ/kiJz05TR0f1IKqhpPzeNL6KoKaSYAd3uEGNskaalEXImZ/RUP5PzPe/SpMj612BleCb9TC7vZFpu/c/kgrlvfBGFTTGnYyYwyHTkjY1QdYQZ4YTGaZnC1rAfSmrgKUmRz11Ocsrw4FXHiHcNT9qNelI6qvF0z33jiyhuYEi3JJL2HRE4k/MPpq2GTPyp7OF5t/5dafU/lQ3wqqNu9wtRMgPbXI165+2hmTN/1AzpZkMMtA93MyJgtOnKWWmIUdQoU9moCmL8isRoy1OGZ1111M1zP+JJa4+fv1GfihjUUMui64ygmxVJR/1cHhx+jHCXj6fxdqMdVKP7hkNTuzCpjGwGM9yUtUQm/mFCI/caeK8Gd/zBQ6fRU1EZP4B+hoxA39hCE/PwoomNLLTiRVqkRVqkRZobWrLkv2pLYf4WcPZRAAAAAElFTkSuQmCC',
                        emissionRate: _this.emissionRate,
                        startColor: new Cesium.Color(_this.startColor[0], _this.startColor[1], _this.startColor[2], _this.startColor[3]),
                        endColor: new Cesium.Color(_this.endColor[0], _this.endColor[1], _this.endColor[2], _this.endColor[3]),
                        minimumImageSize: minimumSnowImageSize,
                        maximumImageSize: maximumSnowImageSize,
                        updateCallback: snowUpdate
                    });
                    scene.primitives.add(snowSystem);
                }
            }

            //如果有其实属性更新，那么直接设置
            if (snowSystem) {
                snowSystem.emissionRate = _this.emissionRate;
                snowSystem.startScale = _this.startScale;
                snowSystem.endScale = _this.endScale;
                snowSystem.startColor = new Cesium.Color(_this.startColor[0], _this.startColor[1], _this.startColor[2], _this.startColor[3]);
                snowSystem.endColor = new Cesium.Color(_this.endColor[0], _this.endColor[1], _this.endColor[2], _this.endColor[3]);
            }
        });

        return _this;
    }

    (0, _createClass3.default)(Snow, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(Snow.prototype.__proto__ || (0, _getPrototypeOf2.default)(Snow.prototype), 'destroy', this).call(this);
        }
    }]);
    return Snow;
}(_XbsjBase3.default);

Snow.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Snow
     */
    enabled: false,
    /**
     * 发射速率
     * @type {number}
     * @default 7000.0
     * @instance
     * @memberof Weather.Snow
     */
    emissionRate: 7000.0,
    /**
     * 初始缩放比
     * @type {number}
     * @default 0.5
     * @instance
     * @memberof Weather.Snow
     */
    startScale: 0.5,
    /**
     * 结束缩放比
     * @type {number}
     * @default 1.0
     * @instance
     * @memberof Weather.Snow
     */
    endScale: 1.0,
    /**
     * 初始颜色
     * @type {number[]}
     * @default [1, 1, 1, 0.5]
     * @instance
     * @memberof Weather.Snow
     */
    startColor: [1, 1, 1, 0.5],
    /**
     * 结束颜色
     * @type {number[]}
     * @default [1, 1, 1, 1]
     * @instance
     * @memberof Weather.Snow
     */
    endColor: [1, 1, 1, 1]
};

exports.default = Snow;

/***/ }),
/* 492 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 太阳
 * @class
 * @memberof Weather
 */
var Sun = function (_XbsjBase) {
    (0, _inherits3.default)(Sun, _XbsjBase);

    function Sun(earth) {
        (0, _classCallCheck3.default)(this, Sun);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Sun.__proto__ || (0, _getPrototypeOf2.default)(Sun)).call(this));

        _this._earth = earth;

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var sun = _this._earth.czm.scene.sun;
            sun.show = _this.enabled;
            sun.glowFactor = _this.glowFactor;

            // Ceisum 1.65以后就没有sunColor了
            // this._earth.czm.scene.sunBloom = this.bloom;
            // this._earth.czm.scene.sunColor.x = this.color[0];
            // this._earth.czm.scene.sunColor.y = this.color[1];
            // this._earth.czm.scene.sunColor.z = this.color[2];
            var scene = _this._earth.czm.scene;
            if (scene.sunColor && scene.sunColor.x) {
                _this._earth.czm.scene.sunColor.x = _this.color[0];
                _this._earth.czm.scene.sunColor.y = _this.color[1];
                _this._earth.czm.scene.sunColor.z = _this.color[2];
            } else {
                scene.sunBloom = _this.bloom;
                scene.light.color = new (Function.prototype.bind.apply(Cesium.Color, [null].concat((0, _toConsumableArray3.default)(_this.color))))();
            }
        });
        return _this;
    }

    (0, _createClass3.default)(Sun, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(Sun.prototype.__proto__ || (0, _getPrototypeOf2.default)(Sun.prototype), 'destroy', this).call(this);
        }
    }]);
    return Sun;
}(_XbsjBase3.default);

Sun.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Sun
     */
    enabled: true,
    /**
     * 发光银子
     * @type {number}
     * @default 1.0
     * @instance
     * @memberof Weather.Sun
     */
    glowFactor: 1.0,
    /**
     * bloom
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.Sun
     */
    bloom: true,
    /**
     * 颜色
     * @type {number[]}
     * @default [1.8, 1.85, 2.0, 1]
     * @instance
     * @memberof Weather.Sun
     */
    color: [1.8, 1.85, 2.0, 1]
};

exports.default = Sun;

/***/ }),
/* 493 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 太阳
 * @class
 * @memberof Weather
 */
var SkyBox = function (_XbsjBase) {
    (0, _inherits3.default)(SkyBox, _XbsjBase);

    function SkyBox(earth) {
        (0, _classCallCheck3.default)(this, SkyBox);

        var _this = (0, _possibleConstructorReturn3.default)(this, (SkyBox.__proto__ || (0, _getPrototypeOf2.default)(SkyBox)).call(this));

        _this._earth = earth;

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.disposers.push((0, _mobx.autorun)(function () {

            var skyBox = _this._earth.czm.scene.skyBox;
            skyBox.show = _this.enabled;
        }));
        return _this;
    }

    (0, _createClass3.default)(SkyBox, [{
        key: 'destroy',
        value: function destroy() {
            return (0, _get3.default)(SkyBox.prototype.__proto__ || (0, _getPrototypeOf2.default)(SkyBox.prototype), 'destroy', this).call(this);
        }
    }]);
    return SkyBox;
}(_XbsjBase3.default);

SkyBox.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.SkyBox
     */
    enabled: true
};

exports.default = SkyBox;

/***/ }),
/* 494 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 云
 * @class
 * @memberof Weather
 */
var WorldCloud = function (_XbsjBase) {
    (0, _inherits3.default)(WorldCloud, _XbsjBase);

    function WorldCloud(earth) {
        (0, _classCallCheck3.default)(this, WorldCloud);

        var _this = (0, _possibleConstructorReturn3.default)(this, (WorldCloud.__proto__ || (0, _getPrototypeOf2.default)(WorldCloud)).call(this));

        _this._disposer = (0, _mobx.autorun)(function () {
            if (_this.enabled) {
                if (!_this._primitive) {
                    var xbsjEarthScriptUrl = _HTML2.default.getScriptBaseUrl('XbsjEarth');
                    console.log('xbsjEarthScriptUrl: ' + xbsjEarthScriptUrl);
                    _this._primitive = new Cesium.XbsjWorldCloud(xbsjEarthScriptUrl + 'images/earthclouds1k.jpg');
                    earth.czm.scene.primitives.add(_this._primitive);
                }
                _this._primitive.show = _this.enabled;
                _this._primitive.aroundTime = _this.aroundTime;
            } else {
                if (_this._primitive) {
                    earth.czm.scene.primitives.remove(_this._primitive);
                    _this._primitive = undefined;
                }
            }
        });
        return _this;
    }

    (0, _createClass3.default)(WorldCloud, [{
        key: 'destroy',
        value: function destroy() {
            this._disposer = this._disposer && this._disposer();
            return (0, _get3.default)(WorldCloud.prototype.__proto__ || (0, _getPrototypeOf2.default)(WorldCloud.prototype), 'destroy', this).call(this);
        }
    }]);
    return WorldCloud;
}(_XbsjBase3.default);

WorldCloud.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.WorldCloud
     */
    enabled: false,
    /**
     * 环绕地球速度
     * @description 转一圈耗时，单位秒
     * @type {number}
     * @default 120
     * @instance
     * @memberof Weather.WorldCloud
     */
    aroundTime: 120 // 转一圈多少秒
};

exports.default = WorldCloud;

/***/ }),
/* 495 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _PostProcess = __webpack_require__(133);

var _PostProcess2 = _interopRequireDefault(_PostProcess);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var rainglsl = '\nuniform sampler2D colorTexture;//\u8F93\u5165\u7684\u573A\u666F\u6E32\u67D3\u7167\u7247\nvarying vec2 v_textureCoordinates;\n\nfloat hash(float x){\n    return fract(sin(x*133.3)*13.13);\n}\n\nvoid main(void){\n\n    float time = czm_frameNumber / 60.0;\n    vec2 resolution = czm_viewport.zw;\n\n    vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n    vec3 c=vec3(.6,.7,.8);\n\n    float a=-.4;\n    float si=sin(a),co=cos(a);\n    uv*=mat2(co,-si,si,co);\n    uv*=length(uv+vec2(0,4.9))*.3+1.;\n\n    float v=1.-sin(hash(floor(uv.x*100.))*2.);\n    float b=clamp(abs(sin(20.*time*v+uv.y*(5./(2.+v))))-.95,0.,1.)*20.;\n    c*=v*b; //\u5C4F\u5E55\u4E0A\u96E8\u7684\u989C\u8272\n\n    gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(c,1), 0.5); //\u5C06\u96E8\u548C\u4E09\u7EF4\u573A\u666F\u878D\u5408\n}\n';

/**
 * 雨
 * @class
 * @memberof Weather
 */

var RainPostProcess = function (_XbsjBase) {
    (0, _inherits3.default)(RainPostProcess, _XbsjBase);

    function RainPostProcess(earth) {
        (0, _classCallCheck3.default)(this, RainPostProcess);

        var _this = (0, _possibleConstructorReturn3.default)(this, (RainPostProcess.__proto__ || (0, _getPrototypeOf2.default)(RainPostProcess)).call(this));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;

        _this._rain = undefined;
        _this.disposers.push(function () {
            if (_this._rain) {
                scene.postProcessStages.remove(_this._rain);
                _this._rain = undefined;
            }
        });

        var updateRain = function updateRain() {
            if (_this.enabled) {
                if (!_this._rain) {
                    _this._rain = new Cesium.PostProcessStage({
                        name: 'czm_rain',
                        fragmentShader: rainglsl
                    });
                    scene.postProcessStages.add(_this._rain);
                }
            } else {
                if (_this._rain) {
                    scene.postProcessStages.remove(_this._rain);
                    _this._rain = undefined;
                }
            }
        };

        updateRain();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return {
                enabled: _this.enabled
            };
        }, updateRain));
        return _this;
    }

    return RainPostProcess;
}(_XbsjBase3.default);

RainPostProcess.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.RainPostProcess
     */
    enabled: false
};

exports.default = RainPostProcess;

/***/ }),
/* 496 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 环境光遮蔽
 * @class
 * @extends XbsjObject
 */
var AmbientOcclusionStage = function (_XbsjObject) {
  (0, _inherits3.default)(AmbientOcclusionStage, _XbsjObject);

  function AmbientOcclusionStage(earth) {
    (0, _classCallCheck3.default)(this, AmbientOcclusionStage);

    var _this = (0, _possibleConstructorReturn3.default)(this, (AmbientOcclusionStage.__proto__ || (0, _getPrototypeOf2.default)(AmbientOcclusionStage)).call(this, earth));

    _this._earth = earth;
    var scene = _this._earth.czm.scene;
    //监控自己的值的变化，如果变化就设置到cesium中去
    _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {
      var ambientOcclusion = scene.postProcessStages.ambientOcclusion;
      ambientOcclusion.enabled = _this.enabled;
      ambientOcclusion.uniforms.ambientOcclusionOnly = _this.ambientOcclusionOnly;
      ambientOcclusion.uniforms.intensity = _this.intensity;
      ambientOcclusion.uniforms.bias = _this.bias;
      ambientOcclusion.uniforms.lengthCap = _this.lengthCap;
      ambientOcclusion.uniforms.stepSize = _this.stepSize;
      ambientOcclusion.uniforms.blurStepSize = _this.blurStepSize;
    });

    return _this;
  }

  (0, _createClass3.default)(AmbientOcclusionStage, [{
    key: 'destroy',
    value: function destroy() {
      if (this.autoUpdateDisposer) {
        this.autoUpdateDisposer();
        this.autoUpdateDisposer = undefined;
      }
      return (0, _get3.default)(AmbientOcclusionStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(AmbientOcclusionStage.prototype), 'destroy', this).call(this);
    }
  }]);
  return AmbientOcclusionStage;
}(_XbsjObject3.default);

AmbientOcclusionStage.defaultOptions = {
  /**
   * 是否启用
   * @type {boolean}
   * @default false
   * @memberof AmbientOcclusionStage
   */
  enabled: false,
  /**
   * 调试选项
   * @type {boolean}
   * @default false
   * @memberof AmbientOcclusionStage
   */
  ambientOcclusionOnly: false,
  /**
   * 强度
   * @type {number}
   * @default 3
   * @memberof AmbientOcclusionStage
   */
  intensity: 3.0,
  /**
   * 偏移
   * @type {number}
   * @default 0.1
   * @memberof AmbientOcclusionStage
   */
  bias: 0.1,
  /**
   * lengthCap
   * @type {number}
   * @default :0.03
   * @memberof AmbientOcclusionStage
   */
  lengthCap: 0.03,
  /**
   * 步长
   * @type {number}
   * @default :1
   * @memberof AmbientOcclusionStage
   */
  stepSize: 1,
  /**
   * 模糊步长
   * @type {number}
   * @default :0.86
   * @memberof AmbientOcclusionStage
   */
  blurStepSize: 0.86
};

_XbsjObject3.default.registerType(AmbientOcclusionStage, 'AmbientOcclusionStage');

exports.default = AmbientOcclusionStage;

/***/ }),
/* 497 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 发光后处理
 * @class
 * @extends XbsjObject
 */
var BloomStage = function (_XbsjObject) {
  (0, _inherits3.default)(BloomStage, _XbsjObject);

  function BloomStage(earth) {
    (0, _classCallCheck3.default)(this, BloomStage);

    var _this = (0, _possibleConstructorReturn3.default)(this, (BloomStage.__proto__ || (0, _getPrototypeOf2.default)(BloomStage)).call(this, earth));

    _this._earth = earth;
    var scene = _this._earth.czm.scene;
    //监控自己的值的变化，如果变化就设置到cesium中去
    _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {
      var bloom = scene.postProcessStages.bloom;
      bloom.enabled = _this.enabled;
      bloom.uniforms.glowOnly = _this.glowOnly;
      bloom.uniforms.contrast = _this.contrast;
      bloom.uniforms.delta = _this.delta;
      bloom.uniforms.brightness = _this.brightness;
      bloom.uniforms.stepSize = _this.stepSize;
      bloom.uniforms.sigma = _this.sigma;
      bloom.uniforms.stepSize = _this.stepSize;
    });

    return _this;
  }

  (0, _createClass3.default)(BloomStage, [{
    key: 'destroy',
    value: function destroy() {
      if (this.autoUpdateDisposer) {
        this.autoUpdateDisposer();
        this.autoUpdateDisposer = undefined;
      }
      return (0, _get3.default)(BloomStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(BloomStage.prototype), 'destroy', this).call(this);
    }
  }]);
  return BloomStage;
}(_XbsjObject3.default);

BloomStage.defaultOptions = {
  /**
   * 是否启用
   * @type {boolean}
   * @default false
   * @memberof BloomStage
   */
  enabled: false,
  glowOnly: false,
  /**
   * 对比度
   * @type {number}
   * @default 128
   * @memberof BloomStage
   */
  contrast: 128,
  /**
   * 亮度
   * @type {number}
   * @default -0.3
   * @memberof BloomStage
   */
  brightness: -0.3,
  /**
   * delta
   * @type {number}
   * @default 1
   * @memberof BloomStage
   */
  delta: 1.0,
  /**
   * sigma
   * @type {number}
   * @default 3.78
   * @memberof BloomStage
   */
  sigma: 3.78,
  /**
   * 步长
   * @type {number}
   * @default 5
   * @memberof BloomStage
   */
  stepSize: 5.0
};

_XbsjObject3.default.registerType(BloomStage, 'BloomStage');

exports.default = BloomStage;

/***/ }),
/* 498 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 黑白后处理
 * @class
 * @extends XbsjObject
 */
var BlackAndWhiteStage = function (_XbsjObject) {
    (0, _inherits3.default)(BlackAndWhiteStage, _XbsjObject);

    function BlackAndWhiteStage(earth) {
        (0, _classCallCheck3.default)(this, BlackAndWhiteStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (BlackAndWhiteStage.__proto__ || (0, _getPrototypeOf2.default)(BlackAndWhiteStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createBlackAndWhiteStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
                _this._stage.uniforms.gradations = _this.gradations;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(BlackAndWhiteStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(BlackAndWhiteStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(BlackAndWhiteStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return BlackAndWhiteStage;
}(_XbsjObject3.default);

BlackAndWhiteStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof BlackAndWhiteStage
     */
    enabled: false,
    /**
     * 渐变等级
     * @type {number}
     * @default 5
     * @memberof BlackAndWhiteStage
     */
    gradations: 5
};

_XbsjObject3.default.registerType(BlackAndWhiteStage, 'BlackAndWhiteStage');

exports.default = BlackAndWhiteStage;

/***/ }),
/* 499 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 明亮度后处理
 * @class
 * @extends XbsjObject
 */
var BrightnessStage = function (_XbsjObject) {
    (0, _inherits3.default)(BrightnessStage, _XbsjObject);

    function BrightnessStage(earth) {
        (0, _classCallCheck3.default)(this, BrightnessStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (BrightnessStage.__proto__ || (0, _getPrototypeOf2.default)(BrightnessStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createBrightnessStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
                _this._stage.uniforms.brightness = _this.brightness;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(BrightnessStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(BrightnessStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(BrightnessStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return BrightnessStage;
}(_XbsjObject3.default);

BrightnessStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof BrightnessStage
     */
    enabled: false,
    /**
     * 亮度
     * @type {number}
     * @default 0.5
     * @memberof BrightnessStage
     */
    brightness: 0.5
};

_XbsjObject3.default.registerType(BrightnessStage, 'BrightnessStage');

exports.default = BrightnessStage;

/***/ }),
/* 500 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 景深后处理
 * @class
 * @extends XbsjObject
 */
var DepthOfFieldStage = function (_XbsjObject) {
    (0, _inherits3.default)(DepthOfFieldStage, _XbsjObject);

    function DepthOfFieldStage(earth) {
        (0, _classCallCheck3.default)(this, DepthOfFieldStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (DepthOfFieldStage.__proto__ || (0, _getPrototypeOf2.default)(DepthOfFieldStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createDepthOfFieldStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
                var uniforms = _this._stage.uniforms;
                uniforms.focalDistance = _this.focalDistance;
                uniforms.delta = _this.delta;
                uniforms.sigma = _this.sigma;
                uniforms.stepSize = _this.stepSize;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(DepthOfFieldStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(DepthOfFieldStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(DepthOfFieldStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return DepthOfFieldStage;
}(_XbsjObject3.default);

DepthOfFieldStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof DepthOfFieldStage
     */
    enabled: false,
    /**
     * 焦距
     * @type {boolean}
     * @default 87
     * @memberof DepthOfFieldStage
     */
    focalDistance: 87,
    /**
     * delta
     * @type {number}
     * @default 1
     * @memberof BloomStage
     */
    delta: 1,
    /**
     * sigma
     * @type {number}
     * @default 3.78
     * @memberof BloomStage
     */
    sigma: 3.78,
    /**
     * 步长
     * @type {number}
     * @default 2.46
     * @memberof BloomStage
     */
    stepSize: 2.46
};

_XbsjObject3.default.registerType(DepthOfFieldStage, 'DepthOfFieldStage');

exports.default = DepthOfFieldStage;

/***/ }),
/* 501 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 马赛克后处理
 * @class
 * @extends XbsjObject
 */
var MosaicStage = function (_XbsjObject) {
    (0, _inherits3.default)(MosaicStage, _XbsjObject);

    function MosaicStage(earth) {
        (0, _classCallCheck3.default)(this, MosaicStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (MosaicStage.__proto__ || (0, _getPrototypeOf2.default)(MosaicStage)).call(this, earth));

        _this._earth = earth;

        var scene = _this._earth.czm.scene;
        var fragmentShaderSource = 'uniform sampler2D colorTexture; \n' + 'varying vec2 v_textureCoordinates; \n' + 'const int KERNEL_WIDTH=16; \n' + 'void main(void) \n' + '{ \n' + '    vec2 step = 1.0 / czm_viewport.zw; \n' + '    vec2 integralPos = v_textureCoordinates - mod(v_textureCoordinates, 8.0 * step); \n' + '    vec3 averageValue = vec3(0.0); \n' + '    for (int i = 0; i < KERNEL_WIDTH; i++) \n' + '    { \n' + '        for (int j = 0; j < KERNEL_WIDTH; j++) \n' + '        { \n' + '            averageValue += texture2D(colorTexture, integralPos + step * vec2(i, j)).rgb; \n' + '        } \n' + '    } \n' + '    averageValue /= float(KERNEL_WIDTH * KERNEL_WIDTH); \n' + '    gl_FragColor = vec4(averageValue, 1.0); \n' + '} \n';

        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = new Cesium.PostProcessStage({
                        fragmentShader: fragmentShaderSource
                    });
                    stages.add(_this._stage);
                }
                var uniforms = _this._stage.uniforms;
                // uniforms.KERNEL_WIDTH = this.KERNEL_WIDTH;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(MosaicStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(MosaicStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(MosaicStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return MosaicStage;
}(_XbsjObject3.default);

MosaicStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof MosaicStage
     */
    enabled: false
};

_XbsjObject3.default.registerType(MosaicStage, 'MosaicStage');

exports.default = MosaicStage;

/***/ }),
/* 502 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 夜视后处理
 * @class
 * @extends XbsjObject
 */
var NightVisionStage = function (_XbsjObject) {
    (0, _inherits3.default)(NightVisionStage, _XbsjObject);

    function NightVisionStage(earth) {
        (0, _classCallCheck3.default)(this, NightVisionStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (NightVisionStage.__proto__ || (0, _getPrototypeOf2.default)(NightVisionStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createNightVisionStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(NightVisionStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(NightVisionStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(NightVisionStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return NightVisionStage;
}(_XbsjObject3.default);

NightVisionStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof NightVisionStage
     */
    enabled: false
};

_XbsjObject3.default.registerType(NightVisionStage, 'NightVisionStage');

exports.default = NightVisionStage;

/***/ }),
/* 503 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 边界后处理
 * @class
 * @extends XbsjObject
 */
var XbsSilhouetteStage = function (_XbsjObject) {
    (0, _inherits3.default)(XbsSilhouetteStage, _XbsjObject);

    function XbsSilhouetteStage(earth) {
        (0, _classCallCheck3.default)(this, XbsSilhouetteStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (XbsSilhouetteStage.__proto__ || (0, _getPrototypeOf2.default)(XbsSilhouetteStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createSilhouetteStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
                var uniforms = _this._stage.uniforms;
                uniforms.color.red = _this.color[0];
                uniforms.color.green = _this.color[1];
                uniforms.color.blue = _this.color[2];
                uniforms.color.alpha = _this.color[3];
                uniforms.length = _this.length;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(XbsSilhouetteStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(XbsSilhouetteStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(XbsSilhouetteStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return XbsSilhouetteStage;
}(_XbsjObject3.default);

XbsSilhouetteStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof XbsSilhouetteStage
     */
    enabled: false,
    /**
     * 边界颜色
     * @type {number[]}
     * @default [0,1,0,1]
     * @memberof XbsSilhouetteStage
     */
    color: [0, 1, 0, 1],
    length: 0.5
};

_XbsjObject3.default.registerType(XbsSilhouetteStage, 'XbsSilhouetteStage');

exports.default = XbsSilhouetteStage;

/***/ }),
/* 504 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 镜头耀斑后处理
 * @class
 * @extends XbsjObject
 */
var LensFlareStage = function (_XbsjObject) {
    (0, _inherits3.default)(LensFlareStage, _XbsjObject);

    function LensFlareStage(earth) {
        (0, _classCallCheck3.default)(this, LensFlareStage);

        var _this = (0, _possibleConstructorReturn3.default)(this, (LensFlareStage.__proto__ || (0, _getPrototypeOf2.default)(LensFlareStage)).call(this, earth));

        _this._earth = earth;
        var scene = _this._earth.czm.scene;
        //监控自己的值的变化，如果变化就设置到cesium中去
        _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {

            var stages = scene.postProcessStages;

            if (_this.enabled) {
                if (!_this._stage) {
                    _this._stage = Cesium.PostProcessStageLibrary.createLensFlareStage();
                    stages.add(_this._stage);
                }
                _this._stage.enabled = true;
                var uniforms = _this._stage.uniforms;

                uniforms.intensity = _this.intensity;
                uniforms.distortion = _this.distortion;
                uniforms.ghostDispersal = _this.dispersion;
                uniforms.haloWidth = _this.haloWidth;
                uniforms.earthRadius = _this.earthRadius;
            } else {
                if (_this._stage) {
                    stages.remove(_this._stage);
                    _this._stage = undefined;
                }
            }
        });

        return _this;
    }

    (0, _createClass3.default)(LensFlareStage, [{
        key: 'destroy',
        value: function destroy() {
            if (this.autoUpdateDisposer) {
                this.autoUpdateDisposer();
                this.autoUpdateDisposer = undefined;
            }
            return (0, _get3.default)(LensFlareStage.prototype.__proto__ || (0, _getPrototypeOf2.default)(LensFlareStage.prototype), 'destroy', this).call(this);
        }
    }]);
    return LensFlareStage;
}(_XbsjObject3.default);

LensFlareStage.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default false
     * @memberof LensFlareStage
     */
    enabled: false,
    /**
     * 强度
     * @type {number}
     * @default 2
     * @memberof LensFlareStage
     */
    intensity: 2.0,
    distortion: 10.0,
    dispersion: 0.4,
    haloWidth: 0.4,
    earthRadius: 6378137
};

_XbsjObject3.default.registerType(LensFlareStage, 'LensFlareStage');

exports.default = LensFlareStage;

/***/ }),
/* 505 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

var _PostProcess = __webpack_require__(133);

var _PostProcess2 = _interopRequireDefault(_PostProcess);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 雨
 * @class
 * @memberof Weather
 */
var SnowPostProcess = function (_XbsjBase) {
    (0, _inherits3.default)(SnowPostProcess, _XbsjBase);

    function SnowPostProcess(earth) {
        (0, _classCallCheck3.default)(this, SnowPostProcess);

        var _this = (0, _possibleConstructorReturn3.default)(this, (SnowPostProcess.__proto__ || (0, _getPrototypeOf2.default)(SnowPostProcess)).call(this));

        _this._earth = earth;
        _this._createSnow();
        _this._createSnowCover();
        return _this;
    }

    (0, _createClass3.default)(SnowPostProcess, [{
        key: '_createSnow',
        value: function _createSnow() {
            var _this2 = this;

            var scene = this._earth.czm.scene;

            var snowglsl = '\n        uniform sampler2D colorTexture; //\u8F93\u5165\u7684\u573A\u666F\u6E32\u67D3\u7167\u7247\n        varying vec2 v_textureCoordinates;\n        \n        float snow(vec2 uv,float scale)\n        {\n            float time = czm_frameNumber / 60.0;\n            float w=smoothstep(1.,0.,-uv.y*(scale/10.));if(w<.1)return 0.;\n            uv+=time/scale;uv.y+=time*2./scale;uv.x+=sin(uv.y+time*.5)/scale;\n            uv*=scale;vec2 s=floor(uv),f=fract(uv),p;float k=3.,d;\n            p=.5+.35*sin(11.*fract(sin((s+p+scale)*mat2(7,3,6,5))*5.))-f;d=length(p);k=min(d,k);\n            k=smoothstep(0.,k,sin(f.x+f.y)*0.01);\n            return k*w;\n        }\n        \n        void main(void){\n            vec2 resolution = czm_viewport.zw;\n            vec2 uv=(gl_FragCoord.xy*2.-resolution.xy)/min(resolution.x,resolution.y);\n            vec3 finalColor=vec3(0);\n            //float c=smoothstep(1.,0.3,clamp(uv.y*.3+.8,0.,.75));\n            float c = 0.0;\n            c+=snow(uv,30.)*.0;\n            c+=snow(uv,20.)*.0;\n            c+=snow(uv,15.)*.0;\n            c+=snow(uv,10.);\n            c+=snow(uv,8.);\n            c+=snow(uv,6.);\n            c+=snow(uv,5.);\n            finalColor=(vec3(c)); //\u5C4F\u5E55\u4E0A\u96EA\u7684\u989C\u8272\n            gl_FragColor = mix(texture2D(colorTexture, v_textureCoordinates), vec4(finalColor,1), 0.5);  //\u5C06\u96EA\u548C\u4E09\u7EF4\u573A\u666F\u878D\u5408\n        }\n        ';

            this._snow = undefined;
            this.disposers.push(function () {
                if (_this2._snow) {
                    scene.postProcessStages.remove(_this2._snow);
                    _this2._snow = undefined;
                }
            });

            var updateSnow = function updateSnow() {
                if (_this2.enabled) {
                    if (!_this2._snow) {
                        _this2._snow = new Cesium.PostProcessStage({
                            name: 'czm_snow',
                            fragmentShader: snowglsl
                        });
                        scene.postProcessStages.add(_this2._snow);
                    }
                } else {
                    if (_this2._snow) {
                        scene.postProcessStages.remove(_this2._snow);
                        _this2._snow = undefined;
                    }
                }
            };

            updateSnow();
            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    enabled: _this2.enabled
                };
            }, updateSnow));
        }
    }, {
        key: '_createSnowCover',
        value: function _createSnowCover() {
            var _this3 = this;

            var scene = this._earth.czm.scene;

            var snowCoverGlsl = '\n            #extension GL_OES_standard_derivatives : enable\n            uniform sampler2D colorTexture;\n            uniform sampler2D depthTexture;\n            uniform float alpha;\n            varying vec2 v_textureCoordinates;\n            vec4 toEye(in vec2 uv, in float depth) {\n                vec2 xy = vec2((uv.x * 2.0 - 1.0), (uv.y * 2.0 - 1.0));\n                vec4 posInCamera = czm_inverseProjection * vec4(xy, depth, 1.0);\n                posInCamera = posInCamera / posInCamera.w;\n                return posInCamera;\n            }\n            float getDepth(in vec4 depth) {\n                float z_window = czm_unpackDepth(depth);\n                z_window = czm_reverseLogDepth(z_window);\n                float n_range = czm_depthRange.near;\n                float f_range = czm_depthRange.far;\n                return (2.0 * z_window - n_range - f_range) / (f_range - n_range);\n            }\n            void main() {\n                vec4 color = texture2D(colorTexture, v_textureCoordinates);\n                vec4 currD = texture2D(depthTexture, v_textureCoordinates);\n                if(currD.r >= 1.0) {\n                    gl_FragColor = color;\n                    return;\n                }\n                float depth = getDepth(currD);\n                vec4 positionEC = toEye(v_textureCoordinates, depth);\n                vec3 dx = dFdx(positionEC.xyz);\n                vec3 dy = dFdy(positionEC.xyz);\n                vec3 nor = normalize(cross(dx, dy));\n                vec4 positionWC = normalize(czm_inverseView * positionEC);\n                vec3 normalWC = normalize(czm_inverseViewRotation * nor);\n                float dotNumWC = dot(positionWC.xyz, normalWC);\n                if(dotNumWC <= 0.3) {\n                    gl_FragColor = mix(color, vec4(1.0), alpha*0.3);\n                    return;\n                }\n                gl_FragColor = mix(color, vec4(1.0), dotNumWC*alpha);\n            }\n        ';

            this._snowCover = undefined;
            // uia.earth.czm.scene.postProcessStages.add(snowCover)
            this.disposers.push(function () {
                if (_this3._snowCover) {
                    scene.postProcessStages.remove(_this3._snowCover);
                    _this3._snowCover = undefined;
                }
            });

            var updateSnow = function updateSnow() {
                if (_this3.alpha <= 0.0) {
                    if (_this3._snowCover) {
                        scene.postProcessStages.remove(_this3._snowCover);
                        _this3._snowCover = undefined;
                    }
                } else {
                    if (!_this3._snowCover) {
                        _this3._snowCover = new Cesium.PostProcessStage({
                            name: 'czm_snowCover',
                            fragmentShader: snowCoverGlsl,
                            uniforms: {
                                alpha: 0.5
                            }
                        });
                        scene.postProcessStages.add(_this3._snowCover);
                    }
                    var alpha = Cesium.Math.clamp(_this3.alpha, 0.0, 1.0);
                    _this3._snowCover.uniforms.alpha = alpha;
                }
            };

            updateSnow();
            this.disposers.push((0, _mobx.reaction)(function () {
                return {
                    alpha: _this3.alpha
                };
            }, updateSnow));
        }
    }]);
    return SnowPostProcess;
}(_XbsjBase3.default);

SnowPostProcess.defaultOptions = {
    /**
     * 是否启用
     * @type {boolean}
     * @default true
     * @instance
     * @memberof Weather.SnowPostProcess
     */
    enabled: false,
    /**
     * 积雪深度
     * @type {number}
     * @default 0.0
     * @instance
     * @memberof Weather.SnowPostProcess
     */
    alpha: 0.0
};

exports.default = SnowPostProcess;

/***/ }),
/* 506 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _Shadow = __webpack_require__(507);

var _Shadow2 = _interopRequireDefault(_Shadow);

var _ForceSunPos = __webpack_require__(508);

var _ForceSunPos2 = _interopRequireDefault(_ForceSunPos);

var _mobx = __webpack_require__(2);

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 特效管理
 * @class
 * @extends XbsjObject
 */
var Effect = function (_XbsjObject) {
    (0, _inherits3.default)(Effect, _XbsjObject);

    function Effect(earth) {
        (0, _classCallCheck3.default)(this, Effect);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Effect.__proto__ || (0, _getPrototypeOf2.default)(Effect)).call(this, earth));

        _this._earth = earth;

        _this.shadow = new _Shadow2.default(earth);
        _this.disposers.push(function () {
            return _this.shadow = _this.shadow && _this.shadow.destroy();
        });
        _XbsjBase2.default.registerProperty(_this, 'shadow');

        _this.forceSunPos = new _ForceSunPos2.default(earth);
        _this.disposers.push(function () {
            return _this.forceSunPos = _this.forceSunPos && _this.forceSunPos.destroy();
        });
        _XbsjBase2.default.registerProperty(_this, 'forceSunPos');
        return _this;
    }

    (0, _createClass3.default)(Effect, [{
        key: "destroy",
        value: function destroy() {
            return (0, _get3.default)(Effect.prototype.__proto__ || (0, _getPrototypeOf2.default)(Effect.prototype), "destroy", this).call(this);
        }
    }]);
    return Effect;
}(_XbsjObject3.default);

Effect.defaultOptions = {
    /**
     * 阴影效果
     * @instance
     * @type {Effect.Shadow}
     * @memberof Effect
     */
    shadow: null,
    /**
     * 强制光照
     * @instance
     * @type {Effect.ForceSunPos}
     * @memberof Effect
     */
    forceSunPos: null
};

_XbsjObject3.default.registerType(Effect, 'Effect');

exports.default = Effect;

/***/ }),
/* 507 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
  value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjObject2 = __webpack_require__(9);

var _XbsjObject3 = _interopRequireDefault(_XbsjObject2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
  return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 阴影 特效 
 * @class 
 * @memberof Effect
 * @extends XbsjObject
 */
var Shadow = function (_XbsjObject) {
  (0, _inherits3.default)(Shadow, _XbsjObject);

  function Shadow(earth) {
    (0, _classCallCheck3.default)(this, Shadow);

    // this._earth = earth;

    //监控自己的值的变化，如果变化就设置到cesium中去
    var _this = (0, _possibleConstructorReturn3.default)(this, (Shadow.__proto__ || (0, _getPrototypeOf2.default)(Shadow)).call(this, earth));

    _this.autoUpdateDisposer = (0, _mobx.autorun)(function () {
      var shadowMap = _this._earth.czm.scene.shadowMap;

      shadowMap.enable = _this.enabled;
      shadowMap.softShadows = _this.softShadows;
      shadowMap.size = _this.size;
      shadowMap.darkness = _this.darkness;
      shadowMap.maximumDistance = _this.maximumDistance;
      shadowMap.normalOffset = _this.normalOffset;
      _this._earth.czm.viewer.shadows = _this.enabled;
      _this._earth.czm.viewer.terrainShadows = _this.enabled && _this.terrainShadow ? Cesium.ShadowMode.ENABLED : Cesium.ShadowMode.DISABLED;
    });
    return _this;
  }

  (0, _createClass3.default)(Shadow, [{
    key: 'destroy',
    value: function destroy() {
      if (this.autoUpdateDisposer) {
        this.autoUpdateDisposer();
        this.autoUpdateDisposer = undefined;
      }
      return (0, _get3.default)(Shadow.prototype.__proto__ || (0, _getPrototypeOf2.default)(Shadow.prototype), 'destroy', this).call(this);
    }
  }]);
  return Shadow;
}(_XbsjObject3.default);

Shadow.defaultOptions = {
  /**
   * 是否启用阴影
   * @instance
   * @type {boolean}
   * @default false
   * @memberof Shadow
   */
  enabled: false,
  /**
   * enabled=true之后 是否启用地形阴影 
   * @instance
   * @type {boolean}
   * @default true
   * @memberof Shadow
   */
  terrainShadow: true,
  /**
   * enabled=true之后 是否启用软阴影
   * @instance
   * @type {boolean}
   * @default false
   * @memberof Shadow
   */
  softShadows: false,
  /**
   * 阴影纹理大小
   * @instance
   * @type {number}
   * @default 2048
   * @memberof Shadow
   */
  size: 2048,
  /**
   * 阴影黑暗度
   * @instance
   * @type {number}
   * @default 0.3
   * @memberof Shadow
   */
  darkness: 0.3,
  /**
   * 阴影作用距离
   * @instance
   * @type {number}
   * @default 5000
   * @memberof Shadow
   */
  maximumDistance: 5000.0,
  /**
   * 阴影法向量偏移
   * @instance
   * @type {boolean}
   * @default true
   * @memberof Shadow
   */
  normalOffset: true
};

_XbsjObject3.default.registerType(Shadow, 'Shadow');

exports.default = Shadow;

/***/ }),
/* 508 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * 强制太阳光方向
 * @class 
 * @memberof Effect
 * @extends XbsjBase
 */
var ForceSunPos = function (_XbsjBase) {
    (0, _inherits3.default)(ForceSunPos, _XbsjBase);

    function ForceSunPos(earth) {
        (0, _classCallCheck3.default)(this, ForceSunPos);

        var _this = (0, _possibleConstructorReturn3.default)(this, (ForceSunPos.__proto__ || (0, _getPrototypeOf2.default)(ForceSunPos)).call(this));

        _this._earth = earth;

        //监控自己的值的变化，如果变化就设置到cesium中去
        var updateProp = function updateProp() {
            var scene = _this._earth.czm.scene;
            scene.xbsjPbr.forceSunPos.enabled = _this.enabled;
            scene.xbsjPbr.forceSunPos.useCameraPos = _this.useCameraPos;
        };
        updateProp();
        _this.disposers.push((0, _mobx.autorun)(updateProp));

        _this._scratchCartesian = new Cesium.Cartesian3();
        var updatePosition = function updatePosition() {
            var _Cesium$Cartesian;

            var scene = _this._earth.czm.scene;
            var cartesian = (_Cesium$Cartesian = Cesium.Cartesian3).fromRadians.apply(_Cesium$Cartesian, (0, _toConsumableArray3.default)(_this.position).concat([undefined, _this._scratchCartesian]));
            scene.xbsjPbr.forceSunPos.position = cartesian;
        };
        updatePosition();
        _this.disposers.push((0, _mobx.reaction)(function () {
            return [].concat((0, _toConsumableArray3.default)(_this.position));
        }, updatePosition));
        return _this;
    }

    return ForceSunPos;
}(_XbsjBase3.default);

ForceSunPos.defaultOptions = {
    /**
     * 是否强制改变光照位置
     * @instance
     * @type {boolean}
     * @default false
     * @memberof ForceSunPos
     */
    enabled: false,
    /**
     * 太阳位置，forceSet为true且useCameraPos为false时才有效
     * @instance
     * @type {number[]}
     * @default true
     * @memberof ForceSunPos
     */
    position: [116.39 / 180.0 * Math.PI, 39.9 / 180.0 * Math.PI, 10000000],
    /**
     * forceSet为true如果useCameraPos为true相当于开启头顶光
     * @instance
     * @type {boolean}
     * @default false
     * @memberof ForceSunPos
     */
    useCameraPos: false
};

exports.default = ForceSunPos;

/***/ }),
/* 509 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Context = function (_XbsjBase) {
    (0, _inherits3.default)(Context, _XbsjBase);

    function Context(earth) {
        (0, _classCallCheck3.default)(this, Context);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Context.__proto__ || (0, _getPrototypeOf2.default)(Context)).call(this, earth));

        (0, _mobx.extendObservable)(_this, {
            _drawingBufferWidth: 0,
            _drawingBufferHeight: 0,
            _resolutionScale: 0,
            _widgetWidth: 0,
            _widgetHeight: 0,
            get drawingBufferWidth() {
                return _drawingBufferWidth;
            },
            get drawingBufferHeight() {
                return _drawingBufferHeight;
            },
            get resolutionScale() {
                return _resolutionScale;
            },
            get widgetWidth() {
                return _widgetWidth;
            },
            get widgetHeight() {
                return _widgetHeight;
            }
        }, {
            drawingBufferWidth: _mobx.computed,
            drawingBufferHeight: _mobx.computed,
            resolutionScale: _mobx.computed,
            widgetWidth: _mobx.computed,
            widgetHeight: _mobx.computed
        });

        _this._disposer = earth.czm.viewer.clock.onTick.addEventListener(function () {
            _this._drawingBufferWidth = earth.czm.scene.context.drawingBufferWidth;
            _this._drawingBufferHeight = earth.czm.scene.context.drawingBufferHeight;
            _this._resolutionScale = earth.czm.viewer.resolutionScale;
            _this._widgetWidth = earth.czm.viewer.cesiumWidget._canvasWidth;
            _this._widgetHeight = earth.czm.viewer.cesiumWidget._canvasHeight;
        });
        return _this;
    }

    (0, _createClass3.default)(Context, [{
        key: 'destory',
        value: function destory() {
            this._disposer = this._disposer && this._disposer();
        }
    }]);
    return Context;
}(_XbsjBase3.default);

exports.default = Context;

/***/ }),
/* 510 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _MouseEventSource = __webpack_require__(511);

var _MouseEventSource2 = _interopRequireDefault(_MouseEventSource);

var _ContextSizeChanged = __webpack_require__(512);

var _ContextSizeChanged2 = _interopRequireDefault(_ContextSizeChanged);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var EventSource = function () {
    function EventSource(earth) {
        (0, _classCallCheck3.default)(this, EventSource);

        this._earth = earth;
        this._mouseEventSource = new _MouseEventSource2.default(earth);
        this._contextSizeChanged = new _ContextSizeChanged2.default(earth);

        this._disposers = this._disposers || [];

        var cameraChangedObserver = undefined;
        var cameraChanged$ = new rxjs.Observable(function (obs) {
            cameraChangedObserver = obs;
        });
        var scene = earth.czm.scene;
        this._disposers.push(scene.camera.changed.addEventListener(function () {
            cameraChangedObserver && cameraChangedObserver.next();
        }));

        this._cameraChanged = cameraChanged$.pipe(
        // rxjs.operators.map(x => { console.log('camera changed!'); return x; }),
        rxjs.operators.share());
    }

    (0, _createClass3.default)(EventSource, [{
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
        }
    }, {
        key: 'mouse',
        get: function get() {
            return this._mouseEventSource;
        }
    }, {
        key: 'contextSizeChanged',
        get: function get() {
            return this._contextSizeChanged.source;
        }
    }, {
        key: 'cameraChanged',
        get: function get() {
            return this._cameraChanged;
        }
    }]);
    return EventSource;
}();

exports.default = EventSource;

/***/ }),
/* 511 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// Cesium.ScreenSpaceEventType
// LEFT_DOWN
// LEFT_UP
// LEFT_CLICK
// LEFT_DOUBLE_CLICK
// RIGHT_DOWN
// RIGHT_UP
// RIGHT_CLICK
// MIDDLE_DOWN
// MIDDLE_UP
// MIDDLE_CLICK
// MOUSE_MOVE
// WHEEL
// PINCH_START
// PINCH_END
// PINCH_MOVE

// Cesium.KeyboardEventModifier
// SHIFT
// CTRL
// ALT

var MouseEventSource = function () {
    function MouseEventSource(earth) {
        (0, _classCallCheck3.default)(this, MouseEventSource);

        this._earth = earth;
        this._screenSpaceEventHandler = new Cesium.ScreenSpaceEventHandler(this._earth.czm.scene.canvas);
        this._actionsMap = {};
    }

    (0, _createClass3.default)(MouseEventSource, [{
        key: 'get',
        value: function get(type) {
            var modifier = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : '';

            var error = typeof type === 'undefined' || typeof Cesium.ScreenSpaceEventType[type] === 'undefined' || modifier && typeof Cesium.KeyboardEventModifier[modifier] === 'undefined';

            if (error) {
                throw new Error('鼠标事件出错！');
            }

            var key = type + modifier;
            if (typeof this._actionsMap[key] === 'undefined') {
                var observer = undefined;
                var eventSource = new rxjs.Observable(function (obs) {
                    observer = obs;
                }).pipe(
                // rxjs.operators.debounceTime(300),
                rxjs.operators.share());
                var action = function action(movement) {
                    observer && observer.next(movement);
                };
                this._screenSpaceEventHandler.setInputAction(action, Cesium.ScreenSpaceEventType[type], modifier ? Cesium.KeyboardEventModifier[modifier] : undefined);
                this._actionsMap[key] = eventSource;
            }

            return this._actionsMap[key];
        }
    }, {
        key: '_pickPosition',
        value: function _pickPosition(movePosition, resultPosition) {
            return this._earth.pickPosition(movePosition, resultPosition);
        }
    }, {
        key: 'destroy',
        value: function destroy() {
            this._screenSpaceEventHandler = this._screenSpaceEventHandler && this._screenSpaceEventHandler.destroy();
        }
    }, {
        key: 'mouseMove',
        get: function get() {
            this.mouseMove$ = this.mouseMove$ || this.get('MOUSE_MOVE').pipe(rxjs.operators.observeOn(rxjs.animationFrameScheduler), rxjs.operators.throttleTime(20), rxjs.operators.share());

            return this.mouseMove$;
        }
    }, {
        key: 'ctrlMouseMove',
        get: function get() {
            this.ctrlMouseMove$ = this.ctrlMouseMove$ || this.get('MOUSE_MOVE', 'CTRL').pipe(rxjs.operators.observeOn(rxjs.animationFrameScheduler), rxjs.operators.throttleTime(20), rxjs.operators.share());

            return this.ctrlMouseMove$;
        }
    }, {
        key: 'shiftMouseMove',
        get: function get() {
            this.shiftMouseMove$ = this.shiftMouseMove$ || this.get('MOUSE_MOVE', 'SHIFT').pipe(rxjs.operators.observeOn(rxjs.animationFrameScheduler), rxjs.operators.throttleTime(20), rxjs.operators.share());

            return this.shiftMouseMove$;
        }
    }, {
        key: 'leftClick',
        get: function get() {
            this.leftClick$ = this.leftClick$ || this.get('LEFT_CLICK');

            return this.leftClick$;
        }
    }, {
        key: 'ctrlLeftClick',
        get: function get() {
            this.ctrlLeftClick$ = this.ctrlLeftClick$ || this.get('LEFT_CLICK', 'CTRL');

            return this.ctrlLeftClick$;
        }
    }, {
        key: 'shiftLeftClick',
        get: function get() {
            this.shiftLeftClick$ = this.shiftLeftClick$ || this.get('LEFT_CLICK', 'SHIFT');

            return this.shiftLeftClick$;
        }
    }, {
        key: 'rightClick',
        get: function get() {
            this.rightClick$ = this.rightClick$ || this.get('RIGHT_CLICK');

            return this.rightClick$;
        }
    }, {
        key: 'ctrlRightClick',
        get: function get() {
            this.ctrlRightClick$ = this.ctrlRightClick$ || this.get('RIGHT_CLICK', 'CTRL');

            return this.ctrlRightClick$;
        }
    }, {
        key: 'shiftRightClick',
        get: function get() {
            this.shiftRightClick$ = this.shiftRightClick$ || this.get('RIGHT_CLICK', 'SHIFT');

            return this.shiftRightClick$;
        }
    }, {
        key: 'mouseMovePickedPosition',
        get: function get() {
            var _this = this;

            this.scratchMouseMovePickedPosition = this.scratchMouseMovePickedPosition || [0, 0, 0];
            var scratchPosition = this.scratchMouseMovePickedPosition;

            this.mouseMovePickedPosition$ = this.mouseMovePickedPosition$ || this.get('MOUSE_MOVE').pipe(rxjs.operators.observeOn(rxjs.animationFrameScheduler), rxjs.operators.throttleTime(100), rxjs.operators.map(function (movement) {
                return {
                    position: _this._pickPosition(movement.endPosition, scratchPosition),
                    movement: movement
                };
            }), rxjs.operators.share());

            return this.mouseMovePickedPosition$;
        }
    }, {
        key: 'leftClickPickedPosition',
        get: function get() {
            var _this2 = this;

            this.scratchleftClickPickedPosition = this.scratchleftClickPickedPosition || [0, 0, 0];
            var scratchPosition = this.scratchleftClickPickedPosition;

            this.leftClickPickedPosition$ = this.leftClickPickedPosition$ || this.get('LEFT_CLICK').pipe(rxjs.operators.map(function (movement) {
                return {
                    position: _this2._pickPosition(movement.position, scratchPosition),
                    movement: movement
                };
            }), rxjs.operators.share());

            return this.leftClickPickedPosition$;
        }
    }]);
    return MouseEventSource;
}();

exports.default = MouseEventSource;

/***/ }),
/* 512 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var ContextSizeChanged = function () {
    function ContextSizeChanged(earth) {
        (0, _classCallCheck3.default)(this, ContextSizeChanged);

        this._earth = earth;

        this._disposers = this._disposers || [];

        var observer = undefined;
        var contextSizeChanged$ = new rxjs.Observable(function (obs) {
            observer = obs;
        });

        var context = earth.czm.scene.context;
        this._disposers.push((0, _mobx.reaction)(function () {
            return {
                drawingBufferWidth: context.drawingBufferWidth,
                drawingBufferHeight: context.drawingBufferHeight,
                resolutionScale: context.resolutionScale,
                widgetWidth: context.widgetWidth,
                widgetHeight: context.widgetHeight
            };
        }, function (changed) {
            observer.next(changed);
        }));

        this._source = contextSizeChanged$.pipe(rxjs.operators.share());
    }

    (0, _createClass3.default)(ContextSizeChanged, [{
        key: 'destory',
        value: function destory() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;
            // do nothing
        }
    }, {
        key: 'source',
        get: function get() {
            return this._source;
        }
    }]);
    return ContextSizeChanged;
}();

exports.default = ContextSizeChanged;

/***/ }),
/* 513 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function capture(scene, width, height, format) {
    if (!width || typeof width != "number") width = 128;
    if (!height || typeof height != "number") height = 128;
    var captureScreenCanvas;
    return new _promise2.default(function (resolve, reject) {
        var removeEventListenFunc = scene._postRender.addEventListener(function () {

            var sceneCanvas = scene.canvas;
            var sceneWidth = sceneCanvas.width;
            var sceneHeight = sceneCanvas.height;

            if (!Cesium.defined(captureScreenCanvas)) {
                captureScreenCanvas = document.createElement('canvas');
            }
            captureScreenCanvas.setAttribute('width', width);
            captureScreenCanvas.setAttribute('height', height);

            var sx = void 0,
                sy = void 0,
                sw = void 0,
                sh = void 0;
            //裁剪范围 判定按 w  或者 h 缩放
            if (sceneWidth / width < sceneHeight / height) {
                sx = 0;
                sw = sceneWidth;
                sh = height * sceneWidth / width;
                sy = (sceneHeight - sh) * 0.5;
            } else {
                sy = 0;
                sh = sceneHeight;
                sw = width * sceneHeight / height;
                sx = (sceneWidth - sw) * 0.5;
            }

            var ctx = captureScreenCanvas.getContext('2d');
            ctx.drawImage(sceneCanvas, sx, sy, sw, sh, 0, 0, width, height);
            var img64 = captureScreenCanvas.toDataURL(format ? format : 'image/jpeg');
            resolve(img64);
            removeEventListenFunc();
        }, null);
    });
}

exports.default = capture;

/***/ }),
/* 514 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var scratchCartesian = void 0;
var scratchCarto = void 0;

function pickPosition(scene, movePosition, result) {
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    scratchCarto = scratchCarto || new Cesium.Cartographic();
    var pickedPosition = Cesium.xbsjPickPosition(scene, movePosition, scratchCartesian);
    if (!pickedPosition) {
        return undefined;
    }

    var carto = Cesium.Cartographic.fromCartesian(pickedPosition, undefined, scratchCarto);

    if (!result) {
        result = [0, 0, 0];
    }

    result[0] = carto.longitude;
    result[1] = carto.latitude;
    result[2] = carto.height;

    return result;
}

exports.default = pickPosition;

/***/ }),
/* 515 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
var scratchCartesian = void 0;

function getSceneSize(scene, position, screenSize) {
    scratchCartesian = scratchCartesian || new Cesium.Cartesian3();
    var cartesian = Cesium.Cartesian3.fromRadians(position[0], position[1], position[2], undefined, scratchCartesian);
    return Cesium.xbsjGetScreenScale(scene, cartesian, screenSize);
}

exports.default = getSceneSize;

/***/ }),
/* 516 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

var _extendFPS = __webpack_require__(517);

var _extendFPS2 = _interopRequireDefault(_extendFPS);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Status = function (_XbsjBase) {
    (0, _inherits3.default)(Status, _XbsjBase);

    function Status(earth) {
        (0, _classCallCheck3.default)(this, Status);

        var _this = (0, _possibleConstructorReturn3.default)(this, (Status.__proto__ || (0, _getPrototypeOf2.default)(Status)).call(this));

        _this._earth = earth;
        (0, _extendFPS2.default)(_this);
        return _this;
    }

    return Status;
}(_XbsjBase3.default);

exports.default = Status;

/***/ }),
/* 517 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

function extendFPS(status) {
    (0, _mobx.extendObservable)(status, {
        _fps: 0,
        _elapsedTime: 0,
        get fps() {
            return status._fps;
        },
        get elapsedTime() {
            return status._elapsedTime;
        }
    }, {
        fps: _mobx.computed,
        elapsedTime: _mobx.computed
    });

    var getTimestamp = Cesium.getTimestamp;

    status._lastFpsSampleTime = getTimestamp();
    status._lastMsSampleTime = getTimestamp();
    status._fpsFrameCount = 0;
    status._msFrameCount = 0;

    var scene = status._earth.czm.scene;
    status.disposers.push(scene.preUpdate.addEventListener(function () {
        var time = getTimestamp();

        status._fpsFrameCount++;
        var fpsElapsedTime = time - status._lastFpsSampleTime;
        if (fpsElapsedTime > 1000) {
            // var fps = Number.NaN;
            status._fps = status._fpsFrameCount * 1000 / fpsElapsedTime | 0;

            status._lastFpsSampleTime = time;
            status._fpsFrameCount = 0;
        }

        status._msFrameCount++;
        var msElapsedTime = time - status._lastMsSampleTime;
        if (msElapsedTime > 200) {
            // var ms = Number.NaN;
            status._elapsedTime = msElapsedTime / status._msFrameCount;

            status._lastMsSampleTime = time;
            status._msFrameCount = 0;
        }
    }));
}

exports.default = extendFPS;

/***/ }),
/* 518 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _promise = __webpack_require__(38);

var _promise2 = _interopRequireDefault(_promise);

var _HTML = __webpack_require__(21);

var _HTML2 = _interopRequireDefault(_HTML);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var loadingRxjs = void 0;
function loadRxjs() {
    // loadingRxjs 用来判断当前是否正在加载 
    // typeof rxjs === 'undefined' 用来判断是否已加载
    if (!loadingRxjs && typeof rxjs === 'undefined') {
        loadingRxjs = _HTML2.default.loadJS(_HTML2.default.xbsjEarthDir + 'thirdParty/rxjs/6.5.2/rxjs.umd.min.js').then(function () {
            loadingRxjs = undefined;
        });
        return loadingRxjs;
    } else {
        return _promise2.default.resolve();
    }
}

var loadingCesium = void 0;
function loadCesium() {
    if (!loadingCesium && typeof Cesium === 'undefined') {
        loadingCesium = _HTML2.default.loadCesium(_HTML2.default.nativeCesiumDir).then(function () {
            return loadingCesium = undefined;
        });
        return loadingCesium;
    } else {
        return _promise2.default.resolve();
    }
}

var loadingXbsjCesium = void 0;
function loadXbsjCesium() {
    // Cesium.xbsj 如果加载的Cesium.js中包含了XbsjCesium，则这个变量会有值，就不需要再单独加载XbsjCesium了。补充注释
    if (!loadingXbsjCesium && typeof Cesium.xbsj === 'undefined') {
        loadingXbsjCesium = _HTML2.default.loadJS(_HTML2.default.cesiumDir + 'XbsjCesium.js').then(function () {
            return loadingXbsjCesium = undefined;
        });
        return loadingXbsjCesium;
    } else {
        return _promise2.default.resolve();
    }
}

var loadingViewerCesiumNavigationMixin = void 0;
function loadViewerCesiumNavigationMixin() {
    if (!loadingViewerCesiumNavigationMixin && !Cesium.viewerCesiumNavigationMixin) {
        loadingViewerCesiumNavigationMixin = _HTML2.default.loadJS(_HTML2.default.xbsjEarthDir + 'thirdParty/navigator/standalone/viewerCesiumNavigationMixin.js').then(function () {
            return loadingViewerCesiumNavigationMixin = undefined;
        });
        return loadingViewerCesiumNavigationMixin;
    } else {
        return _promise2.default.resolve();
    }
}

/**
 * 加载XbsjEarth和Cesium的相关资源，
 * @description 注意这是一个异步函数
 * @returns {Promise} 
 * @memberof XE
 * @example 
 * XE.ready().then(() => {
 *     var earth = new XE.Earth('earthContainer');
 * });
 */
function ready() {
    //调试模式下，rxjs要在loadCesium之前调用，否则会导致加载不进来，原始是loadCesium会调用require.js，require.js则会导致rxj
    if (false) {
        return loadRxjs().then(loadCesium).then(loadXbsjCesium).then(loadViewerCesiumNavigationMixin).then(function () {
            return ready.isReady = true;
        });
    } else {
        // 同时加载尽可能多的js包，已提升加载速度！
        return _promise2.default.all([loadRxjs(), loadCesium().then(loadXbsjCesium).then(loadViewerCesiumNavigationMixin)]).then(function () {
            return ready.isReady = true;
        });
    }
}

exports.default = ready;

/***/ }),
/* 519 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _extends2 = __webpack_require__(63);

var _extends3 = _interopRequireDefault(_extends2);

var _watch = __webpack_require__(520);

var _watch2 = _interopRequireDefault(_watch);

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _binds = __webpack_require__(521);

var binds = _interopRequireWildcard(_binds);

var _debugSlider = __webpack_require__(522);

var _debugSlider2 = _interopRequireDefault(_debugSlider);

var _mobx = __webpack_require__(2);

var mobx = _interopRequireWildcard(_mobx);

function _interopRequireWildcard(obj) {
    if (obj && obj.__esModule) {
        return obj;
    } else {
        var newObj = {};if (obj != null) {
            for (var key in obj) {
                if (Object.prototype.hasOwnProperty.call(obj, key)) newObj[key] = obj[key];
            }
        }newObj.default = obj;return newObj;
    }
}

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * MVVM 命名空间
 * @description 用来实现响应式数据对象或者属性绑定的方法集合
 * @namespace
 */
var MVVM = (0, _extends3.default)({
    reaction: mobx,
    extend: mobx.extendObservable,
    watch: _watch2.default,
    bind: _bind2.default,
    track: _bind.track
}, binds, {
    debugSlider: _debugSlider2.default
});

exports.default = MVVM;

/***/ }),
/* 520 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _stringify = __webpack_require__(26);

var _stringify2 = _interopRequireDefault(_stringify);

var _toConsumableArray2 = __webpack_require__(8);

var _toConsumableArray3 = _interopRequireDefault(_toConsumableArray2);

var _typeof2 = __webpack_require__(36);

var _typeof3 = _interopRequireDefault(_typeof2);

var _assign = __webpack_require__(37);

var _assign2 = _interopRequireDefault(_assign);

var _mobx = __webpack_require__(2);

var _LocalObject = __webpack_require__(107);

var _LocalObject2 = _interopRequireDefault(_LocalObject);

var _types = __webpack_require__(76);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

/**
 * watch <br/>
 * 用来实现对响应式属性对象的监控，需要1-3个参数，具体使用请看示例。<br/>
 * 注意这里的watch不能跟踪vue的属性，vue的属性跟踪，请使用Vue.$watch来操作。
 * @memberof MVVM
 * @example
 * // 示例1：只需要一个参数，该参数是一个回调函数，函数中任意一个用到的响应式属性发生变化，
 * // 函数即会响应。但需要注意，如果函数中有很多响应式属性时，这种方式容易引起死循环。
 * // 相当于a变化，会引起b的变化；b的变化，又到至a继续变化。这样就导致了死循环。
 * var uw = XE.MVVM.watch(() => {
 * 	console.log('当前位置：' + path1.currentD);
 * });
 * 
 * // 示例2：需要三个参数，第一个参数是监控的对象，第二个参数是该对象的属性，注意要用字符串表示
 * // 第三个参数是一个回调函数，当属性的值发生变化时，该函数会响应。
 * var uw2 = XE.MVVM.watch(path1, 'currentD', () => {
 * 	console.log('当前位置：' + path1.currentD);
 * });
 * 
 * // 示例3：需要两个参数，第一个参数是监控的对象
 * // 第二个参数是一个回调函数，当监控对象内部发生变化时，该函数会响应。
 * // 比如path.positions是一个位置数组，如果数组的长度，内容发生变化，就会引起函数调用。
 * var uw3 = XE.MVVM.watch(path1.positions, () => {
 * 	console.log('positions发生变化！');
 * });
 * 
 * // 示例4：需要两个参数，第一个参数是回调函数，需要有返回值
 * // 第二个参数是一个回调函数，当第一个参数构成的回调函数的返回值发生变化时，该回调函数就会响应。
 * var uw4 = XE.MVVM.watch(() => { 
 *     return path1.show;
 * }, show => {
 * 	console.log(`路径状态：${show ? '显示' : '隐藏'}`);
 * });
 */
function watch() {
    for (var _len = arguments.length, params = Array(_len), _key = 0; _key < _len; _key++) {
        params[_key] = arguments[_key];
    }

    if (params.length === 1) {
        if (typeof params[0] === 'function') {
            return (0, _mobx.autorun)(params[0]);
        }
    }

    // params[2]也是有可能的
    if (params.length >= 2) {
        if (typeof params[1] === 'function') {
            if (typeof params[0] === 'function') {
                var options = (0, _assign2.default)({ fireImmediately: true }, params[2]);
                return (0, _mobx.reaction)(params[0], params[1], options);
            } else if ((0, _mobx.isObservable)(params[0])) {
                return (0, _mobx.observe)(params[0], function (changed) {
                    params[1](changed.object);
                });
            }
        }
    }

    if (params.length === 3) {
        if ((0, _typeof3.default)(params[0]) === 'object' && typeof params[1] === 'string' && typeof params[2] === 'function') {
            var localObject = void 0;
            try {
                localObject = new _LocalObject2.default(params[0], params[1]);
            } catch (error) {
                localObject = undefined;
            }

            if (localObject) {
                // return observe(localObject.lastReactObject, localObject.lastPropertyName, changed => {
                //     if (changed.type === 'update') {
                //         params[2](changed.newValue);
                //     }
                // });
                var reactFunc = params[2];
                return (0, _mobx.reaction)(function () {
                    if (typeof localObject.d === 'undefined') {
                        return undefined;
                    } else if ((0, _types.isNativeArray)(localObject.d)) {
                        return [].concat((0, _toConsumableArray3.default)(localObject.d));
                        // return [...l2.d]; // 不创建新数组，但是不执行是否会有别的问题 vtxf
                        // 有问题，会导致不更新！
                        // const na = scratchEqualArray;
                        // na.splice(0, na.length, ...l2.d);
                        // return na;
                    } else if ((0, _types.isNative)(localObject.d)) {
                        return localObject.d;
                    } else {
                        // return JSON.parse(JSON.stringify(l2.d)); // 这样返回会导致死循环，因为用不相等
                        // return JSON.stringify(localObject.d); // 直接返回字符串！
                        return JSON.parse((0, _stringify2.default)(localObject.d));
                    }
                }, reactFunc);
            }
        }
    }

    console.error('MVVM参数设置错误。');
}

exports.default = watch;

/***/ }),
/* 521 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});
exports.bindPosition = exports.bindRotation = exports.bindDegreeRadian = undefined;

var _bind = __webpack_require__(10);

var _bind2 = _interopRequireDefault(_bind);

var _LocalObject = __webpack_require__(107);

var _LocalObject2 = _interopRequireDefault(_LocalObject);

var _types = __webpack_require__(76);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var tr = void 0,
    td = void 0,
    ee = void 0;
var er = 6378137;

function _init() {
    tr = tr || Cesium.Math.toRadians;
    td = td || Cesium.Math.toDegrees;
    ee = ee || function (l, r) {
        return Cesium.Math.equalsEpsilon(l, r, 0, Cesium.Math.EPSILON4);
    };
}

// degreeObject是角度，radianObject是弧度

/**
 * MVVM双向绑定针对角度弧度转化的简化函数
 * @memberof MVVM
 * @description 双向数据绑定，前者为角度属性，后者为弧度属性。注意：绑定的只能是number类型的值！
 * @param {object} degreeObject 第一个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} degreeProperty 第一个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} radianObject 第二个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} radianProperty 第二个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 */
function bindDegreeRadian(degreeObject, degreeProperty, radianObject, radianProperty) {
    var degreeL = new _LocalObject2.default(degreeObject, degreeProperty);
    var radianL = new _LocalObject2.default(radianObject, radianProperty);
    if (typeof degreeL.d !== 'number' || typeof radianL.d !== 'number') {
        throw new Error('bindDegreeRadian 类型错误');
    }

    return (0, _bind2.default)(degreeObject, degreeProperty, radianObject, radianProperty, {
        r1Tor2: function r1Tor2(r1) {
            return Cesium.Math.toRadians(r1);
        },
        r2Tor1: function r2Tor1(r2) {
            return Cesium.Math.toDegrees(r2);
        },
        equals: function equals(r1, r2) {
            var result = Cesium.Math.equalsEpsilon(Cesium.Math.toRadians(r1), r2, 0, Cesium.Math.EPSILON4);
            return result;
        }
    });
}

/**
 * MVVM双向绑定针对角度弧度转化的简化函数，针对rotation属性
 * @memberof MVVM
 * @description 双向数据绑定，前者为角度属性，后者为弧度属性。注意：绑定的只能是一个长度为3的数组。该数组中的元素必须是number类型。
 * @param {object} degreesObject 第一个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} degreesPropery 第一个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} radiansObject 第二个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} radiansProperty 第二个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 */
function bindRotation(degreesObject, degreesPropery, radiansObject, radiansProperty) {
    _init();

    var degreesL = new _LocalObject2.default(degreesObject, degreesPropery);
    var radiansL = new _LocalObject2.default(radiansObject, radiansProperty);
    if (!(0, _types.isNativeArray)(degreesL.d, 3, 'number') || !(0, _types.isNativeArray)(radiansL.d, 3, 'number')) {
        throw new Error('bindRotation 类型错误');
    }

    return (0, _bind2.default)(degreesObject, degreesPropery, radiansObject, radiansProperty, {
        r1Tor2: function r1Tor2(r1, result) {
            result.splice(0, 3, tr(r1[0]), tr(r1[1]), tr(r1[2]));
            return result;
        },
        r2Tor1: function r2Tor1(r2, result) {
            result.splice(0, 3, td(r2[0]), td(r2[1]), td(r2[2]));
            return result;
        },
        equals: function equals(r1, r2) {
            var result = ee(tr(r1[0]), r2[0]) && ee(tr(r1[1]), r2[1]) && ee(tr(r1[2]), r2[2]);
            return result;
        }
    });
}

/**
 * MVVM双向绑定针对角度弧度转化的简化函数，针对position属性
 * @memberof MVVM
 * @description 双向数据绑定，前者为角度属性，后者为弧度属性。注意：绑定的只能是一个长度为3的数组。该数组中的元素必须是number类型。
 * @param {object} degreesObject 第一个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} degreesPropery 第一个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 * @param {object} radiansObject 第二个绑定对象，可以是vue对象，或者是XbsjEarth中的对象
 * @param {string} radiansProperty 第二个绑定对象的属性名，必须是字符串类型，形式如：'prop1.prop2.prop3'
 */
function bindPosition(degreesObject, degreesPropery, radiansObject, radiansProperty) {
    _init();

    var degreesL = new _LocalObject2.default(degreesObject, degreesPropery);
    var radiansL = new _LocalObject2.default(radiansObject, radiansProperty);
    if (!(0, _types.isNativeArray)(degreesL.d, 3, 'number') || !(0, _types.isNativeArray)(radiansL.d, 3, 'number')) {
        throw new Error('bindPosition 类型错误');
    }

    return (0, _bind2.default)(degreesObject, degreesPropery, radiansObject, radiansProperty, {
        r1Tor2: function r1Tor2(r1, result) {
            result.splice(0, 3, tr(r1[0]), tr(r1[1]), r1[2]);
            return result;
        },
        r2Tor1: function r2Tor1(r2, result) {
            result.splice(0, 3, td(r2[0]), td(r2[1]), r2[2]);
            return result;
        },
        equals: function equals(r1, r2) {
            // *er的目的是提升精度比较
            var result = ee(tr(r1[0]) * er, r2[0] * er) && ee(tr(r1[1]) * er, r2[1] * er) && ee(r1[2], r2[2]);
            return result;
        }
    });
}

exports.bindDegreeRadian = bindDegreeRadian;
exports.bindRotation = bindRotation;
exports.bindPosition = bindPosition;

/***/ }),
/* 522 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _mobx = __webpack_require__(2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

// 创建调试UI
function _getPanel() {
    var panel = document.getElementById('vtxf_panel');

    if (!panel) {
        panel = document.createElement('div');

        var cssText = '\n            position: absolute;\n            width: 240px;\n            background: rgba(0, 0, 0, 0.6);\n            min-height: 10px;\n            top: 10px;\n            left: 10px;\n            margin: 5px;\n            padding: 5px 15px 5px 15px;\n            border-radius: 5px;\n            ';

        panel.style.cssText = cssText;
        document.body.appendChild(panel);

        panel.id = 'vtxf_panel';
    }

    return panel;
}

// 滑动条

var Slider = function () {
    function Slider(mobxObject, property) {
        var _this = this;

        var _ref = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : {},
            _ref$min = _ref.min,
            min = _ref$min === undefined ? 0.0 : _ref$min,
            _ref$max = _ref.max,
            max = _ref$max === undefined ? 1.0 : _ref$max,
            _ref$step = _ref.step,
            step = _ref$step === undefined ? 0.01 : _ref$step,
            _ref$title = _ref.title,
            title = _ref$title === undefined ? property : _ref$title;

        (0, _classCallCheck3.default)(this, Slider);

        (0, _mobx.extendObservable)(this, {
            min: min,
            max: max,
            step: step,
            title: title,
            value: mobxObject[property]
        });

        var container = _getPanel();
        this._container = container;

        var spanE = document.createElement('span');
        spanE.style.cssText = 'color: white';
        container.appendChild(spanE);

        var inputE = document.createElement('input');
        inputE.style.cssText = 'width: 100%';
        inputE.type = 'range';
        container.appendChild(inputE);

        inputE.oninput = function (event) {
            _this.value = +event.target.value;
        };

        this._el = inputE;

        this._disposers = [];

        this._disposers.push((0, _mobx.reaction)(function () {
            return mobxObject[property];
        }, function (data, reaction) {
            _this.value = mobxObject[property];
        }));

        this._disposers.push((0, _mobx.autorun)(function () {
            spanE.innerText = _this.title + ' ' + _this.value;
            inputE.min = '' + _this.min;
            inputE.max = '' + _this.max;
            inputE.step = '' + _this.step;
            inputE.value = '' + _this.value;
            mobxObject[property] = _this.value;
        }));
    }

    (0, _createClass3.default)(Slider, [{
        key: 'destroy',
        value: function destroy() {
            this._disposers.forEach(function (d) {
                return d();
            });
            this._disposers.length = 0;

            this._container.removeChild(this._el);
            this._container = undefined;
            this._el = undefined;
        }
    }]);
    return Slider;
}();

function debugSlider(mobxObject, property, options) {
    var slider = new Slider(mobxObject, property, options);
    return function dispose() {
        slider.destroy();
    };
}

exports.default = debugSlider;

/***/ }),
/* 523 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _map = __webpack_require__(79);

var _map2 = _interopRequireDefault(_map);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var XbsjPool = function () {
    function XbsjPool() {
        (0, _classCallCheck3.default)(this, XbsjPool);

        this._freeObjectsMap = new _map2.default();
        this._currentUsedListStack = [];
    }

    // 自动标记，可能嵌套！


    (0, _createClass3.default)(XbsjPool, [{
        key: "begin",
        value: function begin() {
            this._currentUsedList = [];
            this._currentUsedListStack.push(this._currentUsedList);
        }
    }, {
        key: "get",
        value: function get(objClass) {
            var newObj = void 0;
            var freeList = this._freeObjectsMap.get(objClass);
            if (!freeList) {
                freeList = [];
                this._freeObjectsMap.set(objClass, freeList);
            }
            if (freeList.length > 0) {
                newObj = freeList.pop();
            } else {
                newObj = new objClass();
            }
            this._currentUsedList.push(newObj);
            return newObj;
        }

        // 自动回收

    }, {
        key: "end",
        value: function end() {
            var _this = this;

            this._currentUsedList.forEach(function (e) {
                var objClass = e.constructor;
                var freeList = _this._freeObjectsMap.get(objClass);
                freeList.push(e);
            });
            this._currentUsedListStack.pop();
        }
    }]);
    return XbsjPool;
}();

exports.default = XbsjPool;

/***/ }),
/* 524 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _XbsjBase = __webpack_require__(7);

var _XbsjBase2 = _interopRequireDefault(_XbsjBase);

var _XbsjObject = __webpack_require__(9);

var _XbsjObject2 = _interopRequireDefault(_XbsjObject);

var _XbsjCzmObj = __webpack_require__(11);

var _XbsjCzmObj2 = _interopRequireDefault(_XbsjCzmObj);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var Core = {
    XbsjBase: _XbsjBase2.default,
    XbsjObject: _XbsjObject2.default,
    XbsjCzmObj: _XbsjCzmObj2.default
};

exports.default = Core;

/***/ }),
/* 525 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getMapVLayer = __webpack_require__(526);

var _getMapVLayer2 = _interopRequireDefault(_getMapVLayer);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var mixins = {
    get mapVLayer() {
        return (0, _getMapVLayer2.default)();
    }
};

exports.default = mixins;

/***/ }),
/* 526 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

var _getMapVRenderer = __webpack_require__(527);

var _getMapVRenderer2 = _interopRequireDefault(_getMapVRenderer);

var _XbsjBase2 = __webpack_require__(7);

var _XbsjBase3 = _interopRequireDefault(_XbsjBase2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var mapVLayer = void 0;

function getMapVLayers() {
    if (!mapVLayer && typeof mapv !== 'undefined') {
        var defIndex = 0;

        var MapVRenderer = (0, _getMapVRenderer2.default)(mapv);

        var MapVLayer = function (_XbsjBase) {
            (0, _inherits3.default)(MapVLayer, _XbsjBase);

            /**
             *Creates an instance of MapVLayer.
             * @param {*} viewer
             * @param {*} dataset
             * @param {*} options
             * @param {*} container default viewer.container
             * @memberof MapVLayer
             */
            function MapVLayer(viewer, dataset, options, container) {
                (0, _classCallCheck3.default)(this, MapVLayer);

                var _this = (0, _possibleConstructorReturn3.default)(this, (MapVLayer.__proto__ || (0, _getPrototypeOf2.default)(MapVLayer)).call(this));

                _this.map = viewer;
                _this.scene = viewer.scene;
                _this.mapvBaseLayer = new MapVRenderer(viewer, dataset, options, _this);
                _this.disposers.push(function () {
                    _this.removeAllData();
                    _this.mapvBaseLayer.clear(_this.mapvBaseLayer.getContext());
                    _this.mapvBaseLayer = undefined;
                });

                _this.mapVOptions = options;
                _this.devicePixelRatio = window.devicePixelRatio || 1;
                _this.canvas = _this._createCanvas();
                _this.disposers.push(function () {
                    _this.canvas.parentElement.removeChild(_this.canvas);
                });

                if (container) {
                    _this.container = container;
                } else {
                    var inner = viewer.container.querySelector('.cesium-viewer-cesiumWidgetContainer');
                    _this.container = inner ? inner : viewer.container;
                }
                _this.container.appendChild(_this.canvas);

                var screenSpaceEventHandler = new Cesium.ScreenSpaceEventHandler(_this.scene.canvas);
                _this.scene.camera.changed.addEventListener(_this._reset, _this);
                _this.disposers.push(function () {
                    screenSpaceEventHandler.destroy();
                });

                _this._reset();
                return _this;
            }

            (0, _createClass3.default)(MapVLayer, [{
                key: 'addData',
                value: function addData(t, e) {
                    void 0 != this.mapvBaseLayer && this.mapvBaseLayer.addData(t, e);
                }
            }, {
                key: 'updateData',
                value: function updateData(t, e) {
                    void 0 != this.mapvBaseLayer && this.mapvBaseLayer.updateData(t, e);
                }
            }, {
                key: 'getData',
                value: function getData() {
                    return this.mapvBaseLayer && (this.dataSet = this.mapvBaseLayer.getData()), this.dataSet;
                }
            }, {
                key: 'removeData',
                value: function removeData(t) {
                    void 0 != this.mapvBaseLayer && this.mapvBaseLayer && this.mapvBaseLayer.removeData(t);
                }
            }, {
                key: 'removeAllData',
                value: function removeAllData() {
                    void 0 != this.mapvBaseLayer && this.mapvBaseLayer.clearData();
                }
            }, {
                key: '_createCanvas',
                value: function _createCanvas() {
                    var t = document.createElement("canvas");
                    t.id = this.mapVOptions.layerid || "mapv" + defIndex++, t.style.position = "absolute", t.style.top = "0px", t.style.left = "0px", t.style.pointerEvents = "none", t.style.zIndex = this.mapVOptions.zIndex || 0, t.width = parseInt(this.map.canvas.width), t.height = parseInt(this.map.canvas.height), t.style.width = this.map.canvas.style.width, t.style.height = this.map.canvas.style.height;
                    var e = this.devicePixelRatio;
                    return "2d" == this.mapVOptions.context && t.getContext(this.mapVOptions.context).scale(e, e), t;
                }
            }, {
                key: '_reset',
                value: function _reset() {
                    this.resizeCanvas();;
                    void 0 != this.mapvBaseLayer && this.mapvBaseLayer._canvasUpdate();
                }
            }, {
                key: 'show',
                value: function show() {
                    this._visiable();
                }
            }, {
                key: 'hide',
                value: function hide() {
                    this._unvisiable();
                }
            }, {
                key: 'update',
                value: function update(t) {
                    void 0 != t && this.updateData(t.data, t.options);
                }
            }, {
                key: 'resizeCanvas',
                value: function resizeCanvas() {
                    if (void 0 != this.canvas && null != this.canvas) {
                        var t = this.canvas;
                        t.style.position = "absolute", t.style.top = "0px", t.style.left = "0px", t.width = parseInt(this.map.canvas.width), t.height = parseInt(this.map.canvas.height), t.style.width = this.map.canvas.style.width, t.style.height = this.map.canvas.style.height;
                    }
                }
            }]);
            return MapVLayer;
        }(_XbsjBase3.default);

        mapVLayer = function mapVLayer(viewer, dataSet, mapVOptions, container) {
            return new MapVLayer(viewer, dataSet, mapVOptions, container);
        };
    }

    return mapVLayer;
}

exports.default = getMapVLayers;

/***/ }),
/* 527 */
/***/ (function(module, exports, __webpack_require__) {

"use strict";


Object.defineProperty(exports, "__esModule", {
    value: true
});

var _getPrototypeOf = __webpack_require__(3);

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = __webpack_require__(0);

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = __webpack_require__(1);

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = __webpack_require__(4);

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = __webpack_require__(6);

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = __webpack_require__(5);

var _inherits3 = _interopRequireDefault(_inherits2);

function _interopRequireDefault(obj) {
    return obj && obj.__esModule ? obj : { default: obj };
}

var MapVRendererClass = void 0;

function getMapVRenderer(mapv) {
    if (MapVRendererClass) {
        return MapVRendererClass;
    }

    var BaseLayer = mapv.baiduMapLayer.prototype.__proto__.constructor;
    var DataSet = mapv.DataSet;

    var MapVRenderer = function (_BaseLayer) {
        (0, _inherits3.default)(MapVRenderer, _BaseLayer);

        /**
         * Creates an instance of MapVRenderer.
         * @param {*} viewer cesium viewer
         * @param {*} dataset mapv dataset
         * @param {*} option mapvOptions
         * @param {*} mapVLayer
         * @memberof MapVRenderer
         */
        function MapVRenderer(viewer, dataset, option, mapVLayer) {
            (0, _classCallCheck3.default)(this, MapVRenderer);

            var _this = (0, _possibleConstructorReturn3.default)(this, (MapVRenderer.__proto__ || (0, _getPrototypeOf2.default)(MapVRenderer)).call(this, viewer, dataset, option));

            if (!BaseLayer) {
                return (0, _possibleConstructorReturn3.default)(_this);
            }
            _this.map = viewer, _this.scene = viewer.scene, _this.dataSet = dataset;
            option = option || {}, _this.init(option), _this.argCheck(option), _this.initDevicePixelRatio(), _this.canvasLayer = mapVLayer, _this.stopAniamation = !1, _this.animation = option.animation, _this.clickEvent = _this.clickEvent.bind(_this), _this.mousemoveEvent = _this.mousemoveEvent.bind(_this), _this.bindEvent();
            return _this;
        }

        (0, _createClass3.default)(MapVRenderer, [{
            key: "initDevicePixelRatio",
            value: function initDevicePixelRatio() {
                this.devicePixelRatio = window.devicePixelRatio || 1;
            }
        }, {
            key: "clickEvent",
            value: function clickEvent(t) {
                var e = t.point;
                (0, _get3.default)(MapVRenderer.prototype.__proto__ || (0, _getPrototypeOf2.default)(MapVRenderer.prototype), "clickEvent", this).call(this, e, t);
            }
        }, {
            key: "mousemoveEvent",
            value: function mousemoveEvent(t) {
                var e = t.point;
                (0, _get3.default)(MapVRenderer.prototype.__proto__ || (0, _getPrototypeOf2.default)(MapVRenderer.prototype), "mousemoveEvent", this).call(this, e, t);
            }
        }, {
            key: "addAnimatorEvent",
            value: function addAnimatorEvent() {}
        }, {
            key: "animatorMovestartEvent",
            value: function animatorMovestartEvent() {
                var t = this.options.animation;
                this.isEnabledTime() && this.animator && (this.steps.step = t.stepsRange.start);
            }
        }, {
            key: "animatorMoveendEvent",
            value: function animatorMoveendEvent() {
                this.isEnabledTime() && this.animator;
            }
        }, {
            key: "bindEvent",
            value: function bindEvent() {
                this.map;
                this.options.methods && (this.options.methods.click, this.options.methods.mousemove);
            }
        }, {
            key: "unbindEvent",
            value: function unbindEvent() {
                var t = this.map;
                this.options.methods && (this.options.methods.click && t.off("click", this.clickEvent), this.options.methods.mousemove && t.off("mousemove", this.mousemoveEvent));
            }
        }, {
            key: "getContext",
            value: function getContext() {
                return this.canvasLayer.canvas.getContext(this.context);
            }
        }, {
            key: "init",
            value: function init(t) {
                this.options = t, this.initDataRange(t), this.context = this.options.context || "2d", this.options.zIndex && this.canvasLayer && this.canvasLayer.setZIndex(this.options.zIndex), this.initAnimator();
            }
        }, {
            key: "_canvasUpdate",
            value: function _canvasUpdate(t) {
                this.map;
                var e = this.scene;
                if (this.canvasLayer && !this.stopAniamation) {
                    var i = this.options.animation,
                        n = this.getContext();
                    if (this.isEnabledTime()) {
                        if (void 0 === t) return void this.clear(n);
                        "2d" === this.context && (n.save(), n.globalCompositeOperation = "destination-out", n.fillStyle = "rgba(0, 0, 0, .1)", n.fillRect(0, 0, n.canvas.width, n.canvas.height), n.restore());
                    } else this.clear(n);
                    if ("2d" === this.context) for (var o in this.options) {
                        n[o] = this.options[o];
                    } else n.clear(n.COLOR_BUFFER_BIT);
                    var a = {
                        transferCoordinate: function transferCoordinate(t) {
                            var i = Cesium.Cartesian3.fromDegrees(t[0], t[1]),
                                n = Cesium.SceneTransforms.wgs84ToWindowCoordinates(e, i);
                            return void 0 == n ? [-1, -1] : [n.x, n.y];
                        }
                    };
                    void 0 !== t && (a.filter = function (e) {
                        var n = i.trails || 10;
                        return !!(t && e.time > t - n && e.time < t);
                    });
                    var c = this.dataSet.get(a);
                    this.processData(c), "m" == this.options.unit && this.options.size, this.options._size = this.options.size;
                    var h = Cesium.SceneTransforms.wgs84ToWindowCoordinates(e, Cesium.Cartesian3.fromDegrees(0, 0));
                    this.drawContext(n, new DataSet(c), this.options, h), this.options.updateCallback && this.options.updateCallback(t);
                }
            }
        }, {
            key: "updateData",
            value: function updateData(t, e) {
                var i = t;
                i && i.get && (i = i.get()), void 0 != i && this.dataSet.set(i), (0, _get3.default)(MapVRenderer.prototype.__proto__ || (0, _getPrototypeOf2.default)(MapVRenderer.prototype), "update", this).call(this, {
                    options: e
                });
            }
        }, {
            key: "addData",
            value: function addData(t, e) {
                var i = t;
                t && t.get && (i = t.get()), this.dataSet.add(i), this.update({
                    options: e
                });
            }
        }, {
            key: "getData",
            value: function getData() {
                return this.dataSet;
            }
        }, {
            key: "removeData",
            value: function removeData(t) {
                if (this.dataSet) {
                    var e = this.dataSet.get({
                        filter: function filter(e) {
                            return null == t || "function" != typeof t || !t(e);
                        }
                    });
                    this.dataSet.set(e), this.update({
                        options: null
                    });
                }
            }
        }, {
            key: "clearData",
            value: function clearData() {
                this.dataSet && this.dataSet.clear(), this.update({
                    options: null
                });
            }
        }, {
            key: "draw",
            value: function draw() {
                this.canvasLayer.draw();
            }
        }, {
            key: "clear",
            value: function clear(t) {
                t && t.clearRect && t.clearRect(0, 0, t.canvas.width, t.canvas.height);
            }
        }]);
        return MapVRenderer;
    }(BaseLayer);

    MapVRendererClass = MapVRenderer;
    return MapVRendererClass;
}

exports.default = getMapVRenderer;

/***/ })
/******/ ]);